!function(){"use strict";angular.module("epgu").directive("addToHome",function(){function e(e,t,n){e.close=function(){sessionStorage.setItem("_ios_tooltip",!0),e.fadeout=!0,e.show&&(setTimeout(function(){e.$apply(function(){e.fadein=!1,e.fadeout=!1})},1500),e.show=!1)},n.bind("click",e.close),n=sessionStorage.getItem("_ios_tooltip"),SmartPhone.isIPhone()&&!n&&(e.show=!0,setTimeout(function(){e.$apply(function(){e.fadein=!0})},0),setTimeout(function(){e.show&&e.close()},5e3))}return e.$inject=["$scope","$rootScope","$element"],{restrict:"E",replace:!0,template:'<span ng-show="show" ng-class="{bubble_fadein : fadein, bubble_fadeout : fadeout}" class="bubble"><i class="bubble__app"></i><span class="bubble__title">Добавьте Госуслуги в&nbsp;iPhone</span><span class="bubble__text">Нажмите внизу <i class="bubble__icon  bubble__icon_ios7"></i> и выберите пункт "На экран Домой"</span><i id="bubble-close" class="bubble__close"><i class="bubble__close__inner"></i></i></span>',controller:e}})}(),function(){"use strict";function e(o,a){return{restrict:"EA",replace:!0,controller:t,controllerAs:"SwipeCtrl",link:function(e,t,n,i){o(function(){i.init(),a.$emit("swipeLoaded")})}}}function t(a){var s=this;s.element=null,s.init=function(){if(!s.element)throw"Swipe requires an element to work.";var e,n=s.options.callback||function(){},i=(s.options.callback=function(e,t){a.$apply(),n(e,t)},s.options.callback||function(){}),o=(s.options.dragStart=function(e,t){a.$apply(),i(e,t)},s.options.callback||function(){}),t=(s.options.dragEnd=function(e,t){a.$apply(),o(e,t)},new Swipe(s.element,s.options));for(e in t)s[e]=t[e];a.$parent.SwipeController=s}}angular.module("swipe",[]).directive("swipeWrap",e).directive("swipeSlider",function(){return{restrict:"EA",require:"^swipeWrap",scope:{options:"="},replace:!0,transclude:!0,template:'<div class="swipe"><div class="swipe-wrap" ng-transclude></div></div>',link:{pre:function(e,t,n,i){i.options=e.options||{},i.element=t[0]}}}}).directive("swipeItem",function(){return{restrict:"EA",replace:!0,transclude:!0,require:"^swipeSlider",template:"<div ng-transclude></div>"}}),e.$inject=["$timeout","$rootScope"],t.$inject=["$scope"]}(),function(){"use strict";angular.module("epgu").directive("animationOfLandings",["$rootScope","$timeout",function(p,f){return{restrict:"AE",replace:!0,scope:{imgs:"@",blocks:"@",styles:"@",offsetsTop:"@",offsetsBottom:"@"},link:function(e){var n,i,t,o=e.blocks.split(", "),a=[],s=e.imgs.split("; "),r=e.styles.split(", "),l=e.offsetsTop.split("; "),c=e.offsetsBottom.split("; ");function d(){for(var t=0;t<s.length;t++)window.pageYOffset>a[t]-+n[t]&&window.pageYOffset<a[t+1]+ +i[t]?s[t].forEach(function(e){$("."+e).hasClass(r[t])||$("."+e).addClass(r[t])}):s[t].forEach(function(e){$("."+e).hasClass(r[t])&&$("."+e).removeClass(r[t])})}function u(){t||(t=!0,o.forEach(function(e){a.push($("#"+e).offset().top)}),window.addEventListener("scroll",d),e.$on("$destroy",function(){window.removeEventListener("scroll",d,!1)}))}s.forEach(function(e,t){s[t]=e.split(", ")}),l.forEach(function(e,t){l[t]=e.split(", ")}),c.forEach(function(e,t){c[t]=e.split(", ")}),i="mob"==p.version?(n=l[2],c[2]):"pad"==p.version?(n=l[1],c[1]):(n=l[0],c[0]),angular.element(window).load(u),f(u,3e3,!1)}}}])}(),function(){"use strict";angular.module("epgu").directive("cardFeeds",["$rootScope","$moment","$window","CatalogService","userTypeService",function(o,n,a,e,t){return{restrict:"E",replace:!0,transclude:!0,templateUrl:window.templatePath+"/tpl/directives/card-feeds-feec536d02.html",$scope:{pageSize:"=?",date:"=?",passCode:"=?",epguCode:"=?"},link:function(i){i.showMoreEmbeddedFeeds=function(){window.SMUAdapter.notify({eventType:"open_screen",eventParams:[{key:"screen",value:"Feed"},{key:"passCode",value:i.passCode},{key:"epguCode",value:i.epguCode}]})},i.checkExpireSnippet=function(e,t){return"PAYMENT"!==e.type||"reject_no_pay"===t.status||!e.sum||!e.payDate||n(e.payDate)>=n()},i.setFeedCardLink=function(e){var t,n;window.isEmbedded?"DRAFT"!==(n=e).feedType?window.SMUAdapter.notify({eventType:"submitForm",eventParams:[{key:"orderId",value:n.extId}]}):window.SMUAdapter.notify({eventType:"open_screen",eventParams:[{key:"screen",value:"WebFormService"},{key:"serviceEpguId",value:i.passCode},{key:"passportEpguId",value:i.epguCode},{key:"orderId",value:n.extId}]}):"DRAFT"!==e.feedType?(t=o.lkUrl+"/notifications/details/"+e.id,o.isOp?a.open(t,"_blank"):window.location=t):(t=o.betaUrl+i.passCode+"/"+i.epguCode+"/form/order/"+e.extId,o.isOp?o.$broadcast("open-draft-op",e.extId):window.location=t)},i.isUnread=function(e){return"DRAFT"!=e.feedType&&e.unread},i.showNotificationDate=function(e){return!e.data.snippets||!e.data.snippets.length||0==e.data.snippets.filter(function(e){return"EQUEUE"==e.type}).length},i.addFeedElectionData=function(e){if(!e)return"";function t(e){return e.ppzNum||""}var n="";switch(+e.ppzType){case 1:n=n+" через УИК №"+t(e);break;case 2:n=n+" через МФЦ "+('"'+(e.mfcName||"")+'"');break;case 3:n=n+" через ТИК №"+t(e)}return n&&e.ppzRegion?n+", "+e.ppzRegion:n},"P"===o.userType&&"P"===t.getUserType().userTypeGosBar?e.getFeedsInfo(i.passCode,i.epguCode,i.pageSize,i.date).then(function(e){e&&e.data?(i.feedsIsLoad=!0,i.feedsData=e.data,i.feedsData.items&&i.feedsData.items.length&&(window.isEmbedded?i.feedLink=o.lkUrl+"/notifications":i.feedLink=o.lkUrl+"/notifications?q="+i.feedsData.items[0].subTitle,i.getElectionOrderInfo)&&i.setElectionOrderInfo()):i.feedsIsLoad=!0},function(e){i.feedsIsLoad=!0,i.feedsError=!0}):i.feedsIsLoad=!0}}}])}(),function(){"use strict";angular.module("epgu").directive("modalNotice",["CMSService","$rootScope","$timeout",function(e,o,a){function t(t){var e,n,i;localStorage.getItem("modalNotice")||o.modalNotice&&o.modalNotice.length&&(n=o.modalNotice.find(function(e){return e.code===t.code}))&&n.regions.some(function(e){return o.serverRegion.match(new RegExp(e))})&&(e=n.start,n=n.end,e=new Date(e),n=new Date(n),i=new Date,e<=i)&&i<=n&&(a(function(){t.modalNoticeObj={showModal:!0}},1e3),localStorage.setItem("modalNotice",!0))}return t.$inject=["$scope"],{scope:{code:"=",bannerMnemonic:"=",banners:"="},restrict:"E",template:'<popup-modal close-on-destroy="true" class-name="modal-notice-popup" show="modalNoticeObj.showModal">\n    <div data-banner-place data-banners="banners" data-mnemonic="bannerMnemonic"></div>\n</popup-modal>',controller:t}}])}(),function(){"use strict";angular.module("epgu").directive("modalSearch",["$rootScope","$timeout","ToggleCookie",function(a,s,e){var r="",t=a.userId?e.readCookie("u"):e.readCookie("nau");function n(o){a.$on("showModalSearch",function(e,t){var n,i;1===(n=1,i=a.modalUserCounter,i=n+Math.random()*(i+1-n),Math.floor(i))&&(r=t,a.showModalSearch)&&s(function(){o.modalSearch={showModal:!0}},1e3)}),a.$on("popupCloseEvent",function(e){metricReachGoal("modalSearch",{action:"new-search-close",id:t})}),o.goToNewSearch=function(){metricReachGoal("modalSearch",{action:"new-search",id:t});var e=encodeURIComponent(location.href);window.location=a.betaUrl+"newsearch?control=search_button&link="+e+"query="+r},o.onClose=function(){metricReachGoal("modalSearch",{action:"old-search",id:t})}}return n.$inject=["$scope"],{restrict:"E",template:'<popup-modal close-on-destroy="true" class-name="prompt" show="modalSearch.showModal">\n    <div class="search-modal-wrapper">\n       <div class="service-h3 bold search-modal-wrapper--title">Попробуйте новый поиск с цифровым ассистентом</div>\n       <div class="plain-text search-modal-wrapper--text">Предлагает подходящие услуги, задаёт уточняющие вопросы \nи помнит, о чем его спрашивали</div>\n<div class="flex-container sm-flex-column-reverse lg-offset-top-30 md-offset-top-30 sm-offset-top-30"><button ng-click="goToNewSearch()" class="button-base button-medium button-blue button-long-phone sm-offset-top-20 mr-lg-20 mr-md-20">Попробовать</button><button ng-click=" onClose(); $parent.closePopup($event);" class="button-second button-medium button-white button-long-phone">Не сейчас</button></div>    </div>\n</popup-modal>',controller:n}}])}(),function(){"use strict";angular.module("epgu").directive("catalogOnMain",["$rootScope","CatalogService",function(n,e){function t(t){t.loading=!0,e.getRootCategories().then(function(e){t.loading=!1,e.data&&(t.categories=splitRows(e.data,"dk"==n.version?4:3))})}return t.$inject=["$scope"],{restrict:"AE",templateUrl:n.staticDomainUrl+"htdocs/tpl/directives/catalog-on-main-315a6ed8d9.html",replace:!0,controller:t}}])}(),function(){"use strict";angular.module("epgu").directive("bannerPlace",["CMSService","$rootScope","$timeout","MainPageMetric",function(l,c,d,u){function e(i){var t,n,e,o;function a(e,t){c.disableMetric||metricReachGoal(e,{banner:t,banner_place:i.mnemonic})}function s(e){u.legalEntitySend("Баннеры","Ротатор",e)}function r(){d.cancel(t),n=!0}i.slider={activeIndex:0},i.banners&&i.banners.length&&(a("showBanner",i.banners[0].mnemonic),e=l.getBannersBCodes(i.banners))&&e.length&&l.sendTargetBannersStatistic(e,"VIEW"),i.bulletClick=function(e,t){i.slider.activeIndex=e,a("bulletClick",t),s("Выбор баннера"),i.SwipeController&&i.SwipeController.slide(e,400),i.slider.activeIndex=e,r()},i.nextBanner=function(e){r(),i.slider.activeIndex<i.banners.length-1?i.slider.activeIndex+=1:i.slider.activeIndex=0,i.SwipeController&&i.SwipeController.next(),a("arrowClick",e),s("Вправо")},i.prevBanner=function(e){r(),0===i.slider.activeIndex?i.slider.activeIndex=i.banners.length-1:--i.slider.activeIndex,i.SwipeController&&i.SwipeController.prev(),a("arrowClick",e),s("Влево")},i.closeBanner=function(e,t){l.removeTargetSlide(e.mnemonic,e.bcode),a("closeBanner",e.mnemonic),i.SwipeController&&1<i.banners.length&&i.slider.activeIndex>=i.banners.length-1&&i.SwipeController.next(),i.banners.splice(t,1),i.slider.activeIndex=i.slider.activeIndex<=i.banners.length-1?t:0,i.SwipeController&&1===i.banners.length&&i.SwipeController.disable(!0),setTimeout(function(){i.$apply()},0)},i.clickBanner=function(e){e.bcode&&l.sendTargetBannersStatistic([e.bcode],"CLICK")},window.sliderTimer&&!window.mobileVersion&&(o=function e(){if(!n&&i.banners)return t=d(function(){i.hoverState||(i.slider.activeIndex<i.banners.length-1?i.slider.activeIndex+=1:i.slider.activeIndex=0,e())},+window.sliderTimer),e}()),i.hoverIn=function(){"main_banner_1"===i.mnemonic&&"dk"===c.version&&window.sliderTimer&&(d.cancel(t),i.hoverState=!0)},i.hoverOut=function(){i.hoverState&&window.sliderTimer&&(i.hoverState=!1,o())},i.$on("$destroy",function(){t&&d.cancel(t)}),c.$on("swipeLoaded",function(){i.swipe&&(i.bannerSliderConfig={startSlide:0,auto:window.sliderTimer?+window.sliderTimer:0,draggable:!1,continuous:!!window.sliderTimer,disableScroll:!1,stopPropagation:!1,callback:function(e,t,n){i.slider.activeIndex=e,i.$apply()},transitionEnd:function(e,t){}})})}return e.$inject=["$scope"],{scope:{banners:"=",mnemonic:"=",swipe:"="},restrict:"A",template:'<div data-ng-if="$root.mobileVersion && mnemonic === \'main_banner_1\' && bannerSliderConfig" data-ng-mouseover="hoverIn()" data-ng-mouseleave="hoverOut()" class="banner-place-wrap">\n  <swipe-wrap id="swipe" class="banner-place-wrap-second swipe">\n   <swipe-slider data-options="bannerSliderConfig" id="slider-banner-text" class="banner-place-wrap-third">\n     <swipe-item data-ng-style="{\'background\': item.bgImage}" class="swipe banner-place-item" data-ng-repeat="item in banners track by $index">\n        <div data-ng-click="clickBanner(item)" data-compile-html="item.content"></div>\n        <a data-ng-click="closeBanner(item, $index)" data-ng-if="item.closable" href class="banner-place-close"><span class="visually-hidden">закрыть</span></a>\n     </swipe-item>\n   </swipe-slider>\n        <div class="md-offset-top-24 sm-offset-top-16" data-ng-if="banners.length > 1">           <div class="grid-wrap__row">               <div class="grid-wrap__col-md-11 grid-wrap__col-md-land-16 grid-wrap__col-offset-md-1 grid-wrap__col-offset-land-2 grid-wrap__col-sm-6 sm-offset-left-4">                   <div data-ng-click="prevBanner(item.mnemonic)" data-ng-if="banners.length > 1" class="banner-place-prev"></div>                   <span class="banner-place-bullet" data-ng-click="bulletClick($index, bullet.mnemonic)" data-ng-class="{\'active\': slider.activeIndex == $index}" data-ng-if="banners.length" data-ng-repeat="bullet in banners"></span>                   <div data-ng-click="nextBanner(item.mnemonic)" data-ng-if="banners.length > 1" class="banner-place-next"></div>               </div>           </div>       </div>\n  </swipe-wrap>\n</div>\n<div data-ng-if="mnemonic !== \'main_banner_1\' || (!$root.mobileVersion && mnemonic === \'main_banner_1\')" data-ng-mouseover="hoverIn()" data-ng-mouseleave="hoverOut()" class="banner-place-wrap">\n  <div class="banner-place-wrap-second">\n   <div class="banner-place-wrap-third">\n     <div data-ng-style="{\'background\': item.bgImage}" class="banner-place-item" data-ng-if="$index == slider.activeIndex && mnemonic === \'main_banner_1\'" data-ng-repeat="item in banners">\n        <div data-ng-click="clickBanner(item)" data-compile-html="item.content"></div>\n        <a data-ng-click="closeBanner(item, $index)" data-ng-if="item.closable" href class="banner-place-close"><span class="visually-hidden">закрыть</span></a>\n        <div class="lg-offset-top-24 md-offset-top-24 sm-offset-top-16" data-ng-if="banners.length > 1">           <div class="grid-wrap__row">               <div class="grid-wrap__col-lg-14 grid-wrap__col-md-11 grid-wrap__col-md-land-16 grid-wrap__col-offset-lg-2 grid-wrap__col-offset-md-1 grid-wrap__col-offset-land-2 grid-wrap__col-sm-6 sm-offset-left-4">                   <div data-ng-click="prevBanner(item.mnemonic)" data-ng-if="banners.length > 1" class="banner-place-prev"></div>                   <span class="banner-place-bullet" data-ng-click="bulletClick($index, bullet.mnemonic)" data-ng-class="{\'active\': slider.activeIndex == $index}" data-ng-if="banners.length" data-ng-repeat="bullet in banners"></span>                   <div data-ng-click="nextBanner(item.mnemonic)" data-ng-if="banners.length > 1" class="banner-place-next"></div>               </div>           </div>       </div>\n     </div>\n     <div data-ng-style="{\'background\': item.bgImage}" class="banner-place-item" data-ng-if="mnemonic !== \'main_banner_1\'" data-ng-repeat="item in banners">\n        <div data-compile-html="item.content"></div>\n     </div>\n   </div>\n  </div>\n</div>',controller:e}}]).directive("sliderBannerPlace",["$rootScope","$timeout",function(s,r){function e(i){var n,e,t;function o(){t=r(function(){i.nextBanner(!0),o()},+window.sliderTimer)}function a(){t&&r.cancel(t)}i.limitCount=+i.limitCount||3,i.isSwipe="dk"!==s.version,i.isSwipe?i.sliderGroups=function(e,t){var n=e-1,i=0,o=!0,a=[];for(;o;){for(var s=[],r=0;r<t;r++)s.push(i),i===n?i=0:i++;a.push(s),s[s.length-1]===n&&(o=!1)}return a}(i.banners.length,i.limitCount):i.doubledBanners=(e=i.banners,[].concat(e.slice(-2),e,e.slice(0,-2))),i.prevBanner=function(e){if(e||(n=!0),i.SwipeController)i.SwipeController.prev();else{for(var e=i.bannersPosition[0],t=0;t<i.bannersPosition.length-1;t++)i.bannersPosition[t]=i.bannersPosition[t+1];i.bannersPosition[i.bannersPosition.length-1]=e,0===i.firstSlide?i.firstSlide=i.bannersPosition.length-1:i.firstSlide--,0===i.lastSlide?i.lastSlide=i.bannersPosition.length-1:i.lastSlide--}},i.nextBanner=function(e){if(e||(n=!0),i.SwipeController)i.SwipeController.next();else{for(var e=i.bannersPosition[i.bannersPosition.length-1],t=i.bannersPosition.length-1;0<t;t--)i.bannersPosition[t]=i.bannersPosition[t-1];i.bannersPosition[0]=e,i.firstSlide===i.bannersPosition.length-1?i.firstSlide=0:i.firstSlide++,i.lastSlide===i.bannersPosition.length-1?i.lastSlide=0:i.lastSlide++}},window.sliderTimer&&!i.isSwipe&&o(),i.$on("$destroy",function(){t&&a()}),i.hoverIn=function(){t&&a()},i.hoverOut=function(){window.sliderTimer&&!n&&o()},i.isSwipe&&(i.bannerSliderConfig={startSlide:0,auto:window.sliderTimer?+window.sliderTimer:0,draggable:!1,continuous:!!window.sliderTimer,disableScroll:!1,stopPropagation:!1,callback:function(e,t,n){i.$apply()},transitionEnd:function(e,t){}})}return e.$inject=["$scope"],{scope:{banners:"=",title:"@?",limitCount:"@"},restrict:"A",template:'<div data-ng-show="isReady" data-ng-mouseover="hoverIn()" data-ng-mouseleave="hoverOut()" class="slider-banner-place">  <div class="flex-container justify-between align-items-center lg-offset-bottom-32 md-offset-bottom-32 sm-offset-bottom-24">    <div data-ng-if="title" class="lg-title-36 md-title-26 sm-title-22 bold">{{title}}</div>    <div class="slider-controls-wrapper flex-container" data-ng-if="banners.length > limitCount">       <div data-ng-click="prevBanner(item.mnemonic)" class="slider-arrow-prev"></div>       <div data-ng-click="nextBanner(item.mnemonic)" class="slider-arrow-next"></div>    </div>  </div>  <div data-ng-if="isSwipe" id="sliderFrame">    <swipe-wrap id="isSwipe" class="slider-frame swipe">     <swipe-slider data-options="bannerSliderConfig">       <swipe-item class="swipe banner-place-item" data-ng-repeat="group in sliderGroups track by $index">         <div class="flex-container justify-between align-items-center">           <div data-ng-repeat="item in group" class="slider-item-wrapper" style="width: calc(100% / {{+limitCount}})">             <div data-compile-html="banners[item].content"></div>           </div>         </div>        </swipe-item>      </swipe-slider>    </swipe-wrap>  </div>  <div data-ng-if="!isSwipe" id="sliderFrame">    <div class="flex-container justify-between slider-wrapper"          data-ng-style="{width: sliderItemsWrapperWidth + \'px\'}">      <div data-ng-repeat="banner in doubledBanners track by $index" class="slider-item-wrapper"            data-ng-class="{invisible: $index === firstSlide || $index === lastSlide }"           data-ng-style="{width: sliderItemWidth + \'px\', left: bannersPosition[$index] + \'px\'}">        <div data-compile-html="banner.content"></div>      </div>    </div>  </div></div>',controller:e,link:function(n){n.limitCount=+n.limitCount,n.isReady=!n.isSwipe,n.isSwipe?r(function(){n.isReady=!0}):r(function(){var e=document.getElementById("sliderFrame").offsetWidth;n.sliderItemWidth=e/n.limitCount,n.sliderItemsWrapperWidth=n.sliderItemWidth*(+n.limitCount+2),n.bannersPosition=[],n.doubledBanners.forEach(function(e,t){n.bannersPosition.push(n.sliderItemWidth*(t-2))}),n.firstSlide=0,n.lastSlide=n.bannersPosition.length-1})}}}])}(),function(){"use strict";angular.module("epgu").directive("landingMobileApp",function(){return{restrict:"AE",templateUrl:window.templatePath+"/tpl/landings/mobile-app-bcfaba617e.html",scope:{text:"=",pay:"=",subtext:"=",main:"=",link:"="}}})}(),function(){"use strict";angular.module("epgu").directive("adviceLike",function(){return{restrict:"E",template:'<div scroll-anchor class="advice type_like"><div class="limiter">\n            <h2 class="advice_h">\n                <span class="advice_ico"></span>\n                <span>{{title}}</span>\n            </h2>\n            <div class="last-update clear" ng-if="lastUpdated">\n                   <span class="last-update-clock"></span>\n                   <span class="last-update-text">\n                   Информация актуальна <span class="nobr">на {{lastUpdated}}</span>\n                   </span>\n                   </div>        </div></div>',scope:{title:"@",lastUpdated:"@",refPage:"@",href:"@"},replace:!0}})}(),function(){"use strict";angular.module("epgu").directive("adviceNot",["$compile",function(e){return{restrict:"E",template:'<div scroll-anchor>\n            <div class="advice type_not"><div class="limiter">\n                <h2 class="advice_h">\n                    <span class="advice_ico"></span>\n                    <span>Что-то пошло не так</span>\n                </h2>\n\n                <p> В данный момент сервис недоступен. Подпишитесь на разовое уведомление о восстановлении работоспособности сервиса. Данные будут отправлены на почту, указанные в вашем личном кабинете. </p>\n\n                <div class="subscribe-form">\n                    <em class="wrapper w{{$parent.mobileVersion ? 90 : 66}}">\n                        <epgu-input ng-model="email" type="email" label="E-mail" readonly="!emailSend" floating></epgu-input>\n                    </em><em class="wrapper w{{$parent.mobileVersion ? 10 : 33}}">\n                        <checkbox model="emailSend"></checkbox>\n                   </em>\n                </div>\n            <div class="btns-footer">\n                <input type="button" class="btn-base medium btn_field float-right"\n                       value="Получить уведомление" data-ng-disabled="!(email && emailSend)"\n                       ng-click="subscribe()">\n                <a href="/" class="btn-sec medium btn_field larr"><span>На главную</span></a>\n            </div></div>\n     </div>',replace:!0,transclude:!0,scope:{email:"=",emailSend:"=",subscribe:"&"}}}]).directive("emptyAdviceNot",["$compile",function(e){return{restrict:"E",template:'<div scroll-anchor>\n            <div class="advice type_not"><div class="limiter">\n                <h2 class="advice_h">\n                    <span class="advice_ico"></span>\n                    <span>{{adviceTitle}}</span>\n                </h2>\n\n                <p> {{adviceText}} </p>\n\n                <div class="subscribe-form">\n                    <em class="wrapper w{{$parent.mobileVersion ? 90 : 66}}">\n                        <epgu-input ng-model="email" type="email" label="E-mail" readonly="!emailSend" floating></epgu-input>\n                    </em><em class="wrapper w{{$parent.mobileVersion ? 10 : 33}}">\n                        <checkbox model="emailSend"></checkbox>\n                    </em>\n                </div>\n            <div class="btns-footer">\n                <input type="button" class="button-base button-medium button-blue btn_field offset-bottom-x-sm {hideBackBtn ? /float-right/ : /float-left/ }"\n                       value="Получить уведомление" data-ng-disabled="!((email && emailSend) || (phone && phoneSend)) || (!email && emailSend) || (!phone && phoneSend)"\n                       ng-click="subscribe()">\n                <a href="/" class="btn-sec medium btn_field larr" ng-hide="hideBackBtn"><span>На главную</span></a>\n            </div></div>\n     </div>',replace:!0,transclude:!0,scope:{email:"=",emailSend:"=",hideBackBtn:"=?",subscribe:"&",adviceTitle:"@",adviceText:"@"}}}]).directive("notificationSubscribe",["$rootScope","paymentAuth","$timeout","FormServer",function(n,i,o,a){return{template:'<div id="subscribeForm">   <simplest-advice data-ng-if="!subscribed"                     img-path="htdocs/img/landings/sandglass-1f3777c2dc.svg" img-position="left-left-top"                    items-align="top" classes="mobHideIcon">       <div class="lg-title-20 md-title-20 sm-title-20 bold subscribeForm-title" ng-bind-html="title"></div>       <div class="sm-flex-container sm-flex-column">           <div class="lg-h-title-16 md-h-title-16 sm-h-title-16 dark-gray all-offset-top-24 flex-order-1" ng-bind-html="text"></div>           <div class="all-offset-top-16 input-block">               <epgu-input ng-model="subscribeModel.email" type="email" label="E-mail" class-name="subscribe_email-field" floating                           ng-keyup="$event.keyCode == 13 && subscribeModel.email ? subscribe(): false"></epgu-input>           </div>       </div>       <div class="all-offset-top-32">           <input type="button"                  class="button-base button-medium button-blue button-long-phone"                  value="Получить уведомление" data-ng-disabled="!subscribeModel.email"                  data-ng-click="subscribe()">           <input type="button"                   class="button-base button-medium button-second button-white button-long-phone lg-offset-left-16 md-offset-left-16 sm-offset-top-16"                   value="Вернуться"                  data-ng-click="$root.goBack()">       </div>   </simplest-advice>   <simplest-advice data-ng-if="subscribed" img-path="htdocs/img/icon/all_be_ok-5c1aedcd81.svg" img-position="left-left-top" items-align="top">       <div class="lg-title-20 md-title-20 sm-title-20 bold">Вы подписаны на уведомление</div>           <div class="lg-h-title-16 md-h-title-16 sm-h-title-16 dark-gray all-offset-top-16">               После восстановления работоспособности сервиса вам будет отправлено автоматическое уведомление по&nbsp;указанным               вами контактным данным, и&nbsp;вы&nbsp;сможете вернуться к&nbsp;получению услуги.           </div>   </simplest-advice></div>',link:function(t){function e(e){return"INFORMER"===e.type}t.title=t.title||(e(t.requestData)?"Не получается загрузить начисления":"Не получается загрузить начисление"),t.text=t.text||(e(t.requestData)?'Возникла ошибка при поиске начислений в системе государственных и муниципальных платежей (<a href="https://www.gosuslugi.ru/help/faq/voprosy_po_oplate/2543">ГИС ГМП</a>).<br>Попробуйте оплатить позже или подпишитесь на уведомление и мы сможем сообщить вам, когда ошибку исправят.':'Возникла ошибка при поиске начисления в системе государственных и муниципальных платежей (<a href="https://www.gosuslugi.ru/help/faq/voprosy_po_oplate/2543">ГИС ГМП</a>).<br>Попробуйте оплатить позже или подпишитесь на уведомление и мы сможем сообщить вам, когда ошибку исправят.'),t.subscribeModel={email:n.user.email},t.subscribe=function(){var e;3===t.requestData.fkSmevVersion?(e={type:t.requestData.type,uin:t.requestData.uin,requestId:t.requestData.requestId,email:t.subscribeModel.email},i.ipshSubscribe(e).then(function(){console.log("succesfull subscribe")}).catch(function(e){console.log(e)}).finally(function(){t.subscribed=!0})):(n.gisGmp||(n.gisGmp={}),n.gisGmp.request={emailSend:!0,email:t.subscribeModel.email,uin:t.requestData.billId},o.cancel(t.tGisGmp),t.tGisGmp=o(function(){a.request("gisGmp",function(e){t.subscribed=!0},!0)},25))}},scope:{title:"@",text:"@",requestData:"="}}}])}(),function(){"use strict";angular.module("epgu").directive("adviceSimple",function(){return{restrict:"E",template:'<div ng-class="type" class="advice">\n                <div class="limiter"><div class="service-h3 bold advice-title">\n                    <span class="advice_ico"></span>\n                    <span class="advice_simple_title {{titleClass ? titleClass : \'\'}}">{{title}}</span>\n                </div>\n\n                <div class="plain-text advice-text" ng-transclude></div>\n\n            </div></div>\n',replace:!0,transclude:!0,scope:{type:"@",title:"@",titleClass:"="}}}).directive("adviceSimpleBind",function(){return{restrict:"E",template:'<div ng-class="type" class="advice">\n                <div class="limiter"><div class="service-h3 bold advice-title">\n                    <span class="advice_ico"></span>\n                    <span>{{title}}</span>\n                </div>\n\n                <div data-ng-bind-html="text | to_trusted" ng-class="{\'plain-text advice-text-wrap\' : buttonLink}"></div>\n\n                <div class="offset-top-sm offset-bottom-x-sm" ng-if="buttonLink && buttonTitle">\n                    <a ng-href="{{$root.betaUrl}}{{buttonLink}}" ng-class="{\'button-long\' : $root.version === \'mob\'}" class="btn-sec medium" target="_self">{{buttonTitle}}</a>\n                </div>\n            </div></div>\n',replace:!0,scope:{type:"@",title:"@",text:"@",buttonTitle:"@",buttonLink:"@"}}}).directive("adviceTwo",function(){return{restrict:"E",template:'<div ng-class="type" class="advice2">\n               <h2 data-ng-if="title" data-ng-bind-html="title | to_trusted"></h2>\n               <div ng-transclude></div>\n           </div>\n',replace:!0,transclude:!0,scope:{type:"@",title:"@"}}}).directive("adviceBindHtml",function(){return{restrict:"E",template:'<div ng-class="type" class="advice">                <div class="limiter">                    <div class="service-h3 bold advice-title">                        <span class="advice_ico"></span>                        <span ng-bind-html="title | to_trusted"></span>                    </div>                    <div class="plain-text" ng-bind-html="text | to_trusted"></div>                </div>          </div>',replace:!0,scope:{type:"@",title:"@",text:"@"}}}).directive("adviceSimpleFlex",function(){return{restrict:"E",template:'<div class="flex-container flex-column advice-icon-block"><div class="flex-container"><img class="advice-icon-block__image flex-0" data-ng-src="{{$root.staticDomainUrl}}{{path}}" alt=""><div class="flex-container flex-column justify-center advice-icon-block__header lg-offset-top-16"><div class="lg-title-20 md-title-20 sm-h-title-18 bold flex-container align-items-end advice-icon-block__title">{{title || titleStr}}</div></div> </div><div class="lg-h-title-16-big md-h-title-16 sm-h-title-14 plain lg-offset-top-16 md-offset-bottom-32 advice-icon-block advice-icon-block__text" ng-transclude></div></div>',replace:!0,transclude:!0,scope:{title:"@?",titleStr:"=?",path:"="}}}).directive("adviceSimpleFlexMob",function(){return{restrict:"E",template:'<div class="fluid-wrap"><div class="advice-mob flex-container flex-column advice-icon-block"><div class="flex-container"><img class="advice-icon-block__image sm-flex-auto" data-ng-src="{{$root.staticDomainUrl}}{{path}}" alt=""><div class="flex-container flex-column justify-center advice-icon-block__header"><div class="flex-container align-items-end bold service-h3">{{title || titleStr}}</div><div class="offset-top-x-sm advice-icon-block plain-text" ng-transclude></div></div> </div></div></div>',replace:!0,transclude:!0,scope:{title:"@?",titleStr:"=?",path:"="}}}).directive("simplestAdvice",function(){return{restrict:"E",template:'<div class="flex-container align_{{itemsAlign}} img_{{imgPosition}} {{classes}}">   <div class="advice__icon">       <img data-ng-src="{{$root.staticDomainUrl}}{{imgPath}}">   </div>   <div class="advice__text" ng-transclude></div></div>',replace:!1,transclude:!0,scope:{imgPath:"@",imgPosition:"@",itemsAlign:"@",classes:"@"}}})}(),function(){"use strict";angular.module("epgu").directive("adviceSubscribed",function(){return{restrict:"E",template:'<div scroll-anchor class="advice type_ok"><div class="limiter">\n            <div class="service-h3 bold advice-title">\n                <span class="advice_ico"></span>\n                <span>Вы подписаны на уведомление</span>\n            </div>\n\n            <p class="advice-text" ng-transclude></p>           </div>',transclude:!0,replace:!0}})}(),function(){"use strict";angular.module("epgu").directive("checkbox",function(){function e(t){t.click=function(e){e.stopPropagation(),t.target&&e.target.className===t.target?t.$emit("checkBoxTarget",e.target):t.model=t.fixed?t.model:!t.model,t.change&&(e=t.change())&&"function"==typeof e&&e({checked:t.model,value:t.value})}}return e.$inject=["$scope"],{restrict:"E",controller:e,template:'<div class="epgu-checkbox-wrapper">   <div ng-class="{checked : model, \'epgu-checkbox-fixed\': fixed, \'epgu-checkbox-disabled\': disabled}"    class="epgu-checkbox" ng-click="click($event)"><div></div></div><label data-ng-show="label && label != \'false\'"><span data-ng-click="click($event)" data-ng-bind-html="label | to_trusted"></span></label></div>',replace:!0,scope:{model:"=",fixed:"=",target:"=",label:"@",disabled:"=",change:"&",value:"="}}})}(),function(){"use strict";angular.module("epgu").directive("collapse",function(){return{restrict:"AE",template:function(e,t){return t.collapseType&&"default"!=t.collapseType?"checkbox"==t.collapseType?'<div class="collapse-block"><checkbox model="collapsed" label="{{showTitle}}"/>\n                    <div data-ng-show="!collapsed" class="collapsed_content" data-ng-transclude>\n                    </div>\n                </div>':void 0:'<div class="collapse-block">\n                    <span class="pseudo" data-ng-model="collapsed" data-ng-click="collapsed=!collapsed">\n                        <em data-ng-show="collapsed" class="slide_down">{{showTitle ? showTitle : \'Показать подробности\'}}</em>\n                        <em data-ng-show="!collapsed" class="slide_up">{{hideTitle ? hideTitle : \'Скрыть подробности\'}}</em>\n                    </span>\n\n                    <div data-ng-show="!collapsed" class="collapsed_content" data-ng-transclude>\n                    </div>\n                </div>'},replace:!0,scope:{showTitle:"@",hideTitle:"@"},link:function(e,t,n){e.collapsed=void 0!==n.$attr.collapsed},transclude:!0}}).directive("collapseBottom",function(){return{restrict:"E",template:'<div>\n                    <div data-ng-show="!collapsed" class="collapsed_content" data-ng-transclude>\n                    </div>\n                    <span class="text-link dashed" data-ng-class="{\'show-more\' : collapsed, \'show-less\' : !collapsed}" data-ng-click="collapsed = !collapsed">\n                        {{collapsed ? (showTitle ? showTitle : \'Показать подробности\') :\n                           (hideTitle ? hideTitle : \'Скрыть подробности\')}}\n                    </span>\n                </div>',replace:!0,scope:{showTitle:"@",hideTitle:"@"},link:function(e,t,n){e.collapsed=void 0!==n.$attr.collapsed},transclude:!0}}).directive("collapseFull",function(){function e(e){e.isShort=!0,e.showFull=function(){e.isShort=!1}}return e.$inject=["$scope"],{restrict:"E",controller:e,template:'<div class="attention"><b>Примечание:</b>\n              <div>\n               {{beginText}}<span data-ng-show="isShort">...<a data-ng-click="showFull()" class="fullText">Развернуть</a></span>\n               <span data-ng-show="!isShort">{{end}}</span>\n              </div></div>',replace:!0,scope:{end:"@",beginText:"@"}}}).directive("lineCollapseBlock",[function(){return{restrict:"E",transclude:!0,scope:{lineHeight:"=",linesLimit:"=",expandText:"=",collapseText:"="},controller:["$scope","$element",function(n,t){n.showMoreLink=!1,n.contentsCollapsed=!0,n.fixedHeight=function(){return(n.lineHeight||20)*(n.linesLimit||3)},n.get=function(e){return angular.element(t[0].querySelector("."+e))},n.getContainer=function(){return n.get("line-collapse-container")},n.$watch(function(){return(t[0].firstChild&&t[0].firstChild.classList.contains("line-collapse-panel")?t[0].firstChild.firstChild:t[0]).textContent},function(e,t){n.update()}),n.update=function(){n.getContainer().css({height:n.fixedHeight()+"px"}),n.get("line-collapse-contents")[0].clientHeight>n.fixedHeight()&&!n.showMoreLink?n.showMoreLink=!0:(n.showMoreLink=!1,n.getContainer().css({height:"auto"}))},n.switchState=function(){n.contentsCollapsed=!n.contentsCollapsed,n.contentsCollapsed?n.getContainer().css({height:n.fixedHeight()+"px"}):n.getContainer().css({height:"auto"})}}],link:function(e,t,n){e.getContainer().css({"line-height":(e.lineHeight||20)+"px"}),e.update()},template:"<div class='line-collapse-panel collapse-block'><div class='line-collapse-container' data-ng-class='{collapsed: contentsCollapsed, expanded: !contentsCollapsed}' data-ng-style='{\"overflow\": contentsCollapsed ? \"hidden\" : \"visible\"}'><div class='line-collapse-contents' ng-transclude></div></div><div class='show-more-container offset-top-8' data-ng-show='showMoreLink'><a class='show-more-link text-link dashed' data-ng-class='{collapsed: contentsCollapsed, expanded: !contentsCollapsed}' href='#' data-ng-click='switchState()'>{{contentsCollapsed ? (expandText || 'Показать подробности') : (collapseText || 'Скрыть подробности')}}<div class='inline-block' data-ng-class='{slide_down: contentsCollapsed, slide_up: !contentsCollapsed}'></div></a></div></div>"}}]).directive("collapsePanel",function(){return{restrict:"E",template:'<div class="collapse-panel" data-ng-class="{expanded: !isCollapsed, collapsed: isCollapsed}"><div class="panel-header" data-ng-click="toggle()" data-ng-tap="toggle()"> <div class="header-wrapper"><span class="panel-title">{{header}}</span></div><div class="expand-button-wrapper"><div class="expand-collapse" data-ng-class="{collapsed: isCollapsed}"></div></div></div><div class="panel-content" data-ng-class="{collapsed: isCollapsed, hidden: initiallyCollapsed}" ng-transclude></div> </div>',scope:{header:"=",collapsed:"="},controller:["$scope","$element","$timeout",function(e,t,n){e.isCollapsed=e.collapsed,e.initiallyCollapsed=e.collapsed,e.expandedBefore=!e.initiallyCollapsed,e.notifyFirstExpand=function(){e.$broadcast("PANEL_EXPANDED_FIRST_TIME"),e.expandedBefore=!0},e.toggle=function(){jQuery(".panel-content",t).animate({height:"toggle"},function(){e.isCollapsed=!e.isCollapsed,e.isCollapsed||e.expandedBefore||e.notifyFirstExpand(),e.$apply()})},n(function(){e.initiallyCollapsed&&(jQuery(".panel-content",t).hide(),delete e.initiallyCollapsed)},500),n(function(){e.initiallyCollapsed||e.notifyFirstExpand()},100)}],transclude:!0}})}(),function(){"use strict";angular.module("epgu").directive("dropdownSelect",["$rootScope","$document","$timeout",function(i,t,e){function n(a,n,e){a.floating=void 0!==e.$attr.floating,a.search=void 0!==e.$attr.search,a.combobox=void 0!==e.$attr.combobox,a.id=IDSequence.get(),a.selectStart=!0,a.labelField=null!=e.label?e.label:"text",a.placeholder=null!=e.placeholder?e.placeholder:"",a.select=function(e,t){t.stopPropagation(),a.selectStart=!!e.isLabel,n.removeClass("opened"),e!==a.model&&(a.model=e),a.filter="",a.change({selected:e})},a.hasValue=function(){return a.model&&!$.isEmptyObject(a.model)&&!a.disabled},a.checkDisabledData=function(){return a.model&&!$.isEmptyObject(a.model)},a.filter="",t.find("body"),a.$on("body-click",function(e,t){!angular.element(t).closest(n).length&&n.filter(".epgu-selectbox.opened")&&(n.removeClass("opened"),a.combobox||(a.filter=""))}),n.bind("click",function(e){var t;e.stopPropagation(),a.disabled||(angular.element(document).find(".epgu-selectbox.opened").filter(function(e,t){return 0===angular.element(t).find("#_epgu_el"+a.id).length}).removeClass("opened"),n.hasClass("opened")?(n.removeClass("opened"),a.combobox||(a.filter=""),i.$$phase||a.$apply()):(n.addClass("opened"),0<(t=(e=n.find(".dropdown-el ul")).find(".selected")).length&&e.scrollToElement(t,0,150)))}),n.find("input").bind("keydown",function(){n.hasClass("opened")||n.addClass("opened")}),a.combobox&&a.change&&a.$watch("filter",function(e,t){e&&e!=t&&(a.change({selected:e}),a.model=null)}),a.$watch("disabled",function(e,t){e!==t&&(e&&(a.model={}),a.change({selected:a.model}))}),a.label=function(e,t){if(a.formatter&&a.hasOwnProperty("formatter"))return a.formatter({item:e,items:t});for(var t=a.labelField,n=(t=(t=t.replace(/\[(\w+)\]/g,".$1")).replace(/^\./,"")).split("."),i=e;n.length;){var o=n.shift();if(!(o in i))return"";i=i[o]}return i}}return n.$inject=["$scope","$element","$attrs"],{restrict:"E",replace:!0,scope:{items:"=",model:"=",change:"&",formatter:"&?",disabled:"=",partners:"=",title:"@",itemClass:"@?"},controller:n,template:"<div class=\"epgu-selectbox\" data-ng-class=\"{'disabled' : disabled, 'has-title': title, 'floating-placeholder' : floating, 'has_content' : model, 'partners' : partners}\">"+'    <label data-ng-show="title" for="_epgu_el{{id}}">{{title}}</label>    <div class="select-el" id="_epgu_el{{id}}">      <input data-ng-show="search" type="text" ng-required="required" class="select-text" data-ng-model="filter" placeholder="{{hasValue() ? label(model, items) : placeholder}}"/>      <div data-ng-show="!search" class="select-text" data-ng-class=\'{"select-text-start": selectStart}\'>        {{hasValue() ? label(model, items) : (checkDisabledData() ? label(model, items) :  placeholder)}}      </div>\n      <div class="trigger">\n       <div class="trigger-arrow"></div>      </div>\n    </div>    <div class="dropdown-el">\n        <div class="dropdown-el__triange"></div>\n        <ul>\n            <li data-ng-class="[{selected : model == item}, itemClass]" data-ng-repeat="item in items | dropdown_filter:labelField:filter"               data-compile-html="label(item, items)" data-ng-click="select(item, $event)">\n        </li>\n       </ul>\n    </div>\n</div>'}}])}(),function(){"use strict";angular.module("epgu").directive("dropdownSearch",["$rootScope","$document","$timeout",function(t,l,c){function e(i,n,e){var o,a,s,r;i.floating=void 0!==e.$attr.floating,i.search=void 0!==e.$attr.search,i.combobox=void 0!==e.$attr.combobox,i.id=IDSequence.get(),i.lastFilterModel="",i.withFakeLabel="true"===i.withFakeLabel,i.select=function(e,t){t.stopPropagation(),n.removeClass("opened"),e!==i.model&&(i.model=e),i.lastFilterModel=e.title,i.filterModel=e.title,i.change({selected:e})},i.hasValue=function(){return i.model&&!$.isEmptyObject(i.model)&&!i.disabled},i.checkDisabledData=function(){return i.model&&!$.isEmptyObject(i.model)},l.find("body"),t.$on("body-click",function(e,t){n===t||n[0].contains(t)||(n.removeClass("opened"),i.filterModel=i.lastFilterModel||i.model&&i.model.title)}),n.find(".select-text-input").bind("focus",function(e){i.filterModel="",n.hasClass("opened")||n.addClass("opened")}),n.find(".select-text-input").bind("blur",function(e){i.originalList&&(i.items=JSON.parse(JSON.stringify(i.originalList)))}),i.$on("refreshDpSearchModel",function(){c(function(){i.filterModel=i.model&&i.model.title})}),n.find(".trigger").bind("click",function(e){i.disabled||i.hasFilter||(i.lastFilterModel=i.filterModel,i.$apply(function(){n.hasClass("opened")?(i.filterModel=i.lastFilterModel||i.model&&i.model.title,n.removeClass("opened")):(i.filterModel="",n.addClass("opened"))}))}),n.find("input").bind("keydown",function(e){var t=angular.element(this).val().length,e=e.keyCode||e.charCode;!n.hasClass("opened")&&1<t&&8!=e&&46!=e&&n.addClass("opened")}),i.modelChanged=function(){i.requestSearch&&(i.serverError=!1,i.requestSearch({searchText:i.filterModel}).then(function(e){i.items=e},function(e){i.serverError=!0}))},i.withDebounce?i.modelChangedWithDebounce=(o=i.modelChanged,a=i.withDebounce,function(){var e=this,t=arguments,n=s&&!r;clearTimeout(r),r=setTimeout(function(){r=null,s||o.apply(e,t)},a),n&&o.apply(e,t)}):i.modelChangedWithDebounce=i.modelChanged,i.loadMore=function(){i.loadingNextItemsEnabled&&i.loadNextItemsCallback&&(i.loadingNextItems=!0,i.loadNextItemsCallback().then(function(e){i.items=e,i.loadingNextItems=!1}))},void 0!==e.$attr.clickOnFilter&&(i.hasFilter=!0,i.$on("requestWithFavorites",function(e,t){var n;i.items.length?(n=[],i.items.forEach(function(e){t.favoriteIds[e.value]||n.push(e)}),i.items=t.items.concat(n)):i.items=t.items.concat(i.items)}),i.$on("requestWithFilters",function(){i.requestSearch().then(function(e){n.hasClass("opened")||n.addClass("opened"),i.items=e})}),i.onShowFilterSettings=function(e){e&&n.hasClass("opened")&&n.removeClass("opened"),"function"==typeof i.clickOnFilter&&i.clickOnFilter()}),i.toggleAction=function(e){e.isSelected=!e.isSelected}}return e.$inject=["$scope","$element","$attrs"],{restrict:"E",replace:!0,scope:{items:"=",model:"=",change:"&",title:"@",placeholder:"@",bottomPlaceholder:"@",isUniversityMode:"@",clickOnFilter:"&",withFakeLabel:"@",disabled:"=?",serverErrorText:"=?",requestSearch:"&?",requestSearchEnabled:"=?",withDebounce:"=?",originalList:"=?",loadNextItemsCallback:"&",loadingNextItemsEnabled:"=?"},controller:e,template:"<div class=\"epgu-selectbox epgu-selectbox_search\" data-ng-class=\"{'disabled' : disabled, 'has-title': title, 'floating-placeholder' : floating, 'has_content' : model}\">"+'    <label data-ng-show="title" for="_epgu_el{{id}}">{{title}}</label>    <div class="select-el relative" id="_epgu_el{{id}}">      <input type="text" data-ng-init="filterModel=model.title" class="select-text select-text-input"               data-ng-model="filterModel" data-ng-change="modelChangedWithDebounce()" ng-disabled="disabled" placeholder="{{placeholder}}"/>      <div data-ng-if="withFakeLabel && model.fakeLabelText" class="select-text select-text-data" data-ng-bind-html="model.fakeLabelText"></div>\n      <div class="trigger" data-ng-class="{\'has-filter\' : hasFilter}">\n       <div class="trigger-arrow"></div>       <div class="trigger-magnifier"></div>       <div data-ng-if="hasFilter" data-ng-click="onShowFilterSettings()" class="trigger-filter"></div>      </div>\n    </div>    <div data-ng-if="isUniversityMode" class="select-el-bottom-placeholder lg-flex-container md-flex-container lg-justify-between md-justify-between sm-offset-top-16">       <div class="select-el-bottom-placeholder-text">{{bottomPlaceholder}}</div>       <div class="lg-flex-0-1"><a data-ng-href="" class="select-el-bottom-placeholder-link" data-ng-click="onShowFilterSettings(true)">Настроить параметры поиска</a></div>    </div>    <div data-ng-if="!requestSearchEnabled && !isUniversityMode" class="dropdown-el">       <ul>            <li data-ng-class="{selected : model == item}"                  data-ng-repeat="item in items | dropdownsearch_filter:\'title\':filterModel"                data-ng-click="select(item, $event)"                 data-ng-bind-html="item.fakeLabelText || item.title">            </li>            <li class="nothing-found">Ничего не найдено</li>       </ul>    </div>    <div data-ng-if="requestSearchEnabled && !isUniversityMode" class="dropdown-el">       <ul data-when-scrolled="loadMore()">            <li data-ng-class="{selected : model.value == item.value}"                  data-ng-repeat="item in items"                data-ng-mousedown="select(item, $event)"                 data-ng-bind-html="item.fakeLabelText || item.title">            </li>            <li data-ng-if="loadingNextItems" class="loading-more-throbber">\n                <span data-throbber="throbber-small"></span>\n            </li>            <li class="nothing-found" data-ng-if="!items.length && !loadingNextItems">Ничего не найдено</li>       </ul>    </div>    <div data-ng-if="isUniversityMode" class="dropdown-el dropdown-el_university">       <ul>            <li class="select-el-bottom-placeholder select-el-bottom-placeholder_inItem">{{bottomPlaceholder}}</li>            <li data-ng-class="{                   \'selected\' : item.isSelected,                   \'select-el__item-favorite\' : item.isFavorite,                }"                  data-ng-repeat="item in items"                class="select-el__item"                data-ng-click="select(item, $event)"                 >               <div class="flex-container align-items-center">                   <div class="select-el__item-title"                         data-ng-bind-html="item.fakeLabelText || item.title"                   ></div>               </div>            </li>            <li data-ng-if="loadingNextItems" class="loading-more-throbber">\n                <span data-throbber="throbber-small"></span>\n            </li>            <li class="select-el__item_filter" data-ng-if="items.length">Не нашли нужный ВУЗ? Уточните запрос или <a data-ng-href="" data-ng-click="onShowFilterSettings(true)">настройте параметры поиска</a></li>       </ul>    </div>    <div data-ng-if="serverError" class="achievement__file-error achievement__file-error_offset-left-0 lg-h-title-14 md-h-title-14 sm-h-title-10" data-ng-bind-html="serverErrorText">    </div></div>'}}])}(),function(){"use strict";angular.module("epgu").directive("dropdownSelectForPayment",["$rootScope","$document","$timeout","PaymentService",function(o,t,e,n){function i(n,i,e){n.floating=void 0!==e.$attr.floating,n.combobox=void 0!==e.$attr.combobox,n.id=IDSequence.get(),n.selectStart=!0,n.labelField=null!=e.label?e.label:"text",n.select=function(e,t){t.stopPropagation(),n.selectStart=!!e.isLabel,i.removeClass("opened"),e!==n.model&&(n.model=e),n.filter="",n.change({selected:e})},n.hasValue=function(){return n.model&&!$.isEmptyObject(n.model)&&!n.disabled},n.getTitle=function(){return n.model&&!$.isEmptyObject(n.model)?n.model.cardInfo?"**** **** "+n.model.itemTitle:n.model.itemTitle:n.placeholder},n.checkDisabledData=function(){return n.model&&!$.isEmptyObject(n.model)},n.filter="",t.find("body"),n.$on("body-click",function(e,t){!angular.element(t).closest(i).length&&i.filter(".epgu-selectbox.opened")&&(i.removeClass("opened"),n.combobox||(n.filter=""))}),i.bind("click",function(e){var t;e.stopPropagation(),n.disabled||(angular.element(document).find(".epgu-selectbox.opened").filter(function(e,t){return 0===angular.element(t).find("#_epgu_el"+n.id).length}).removeClass("opened"),i.hasClass("opened")?(i.removeClass("opened"),n.combobox||(n.filter=""),o.$$phase||n.$apply()):(i.addClass("opened"),0<(t=(e=i.find(".dropdown-el ul")).find(".selected")).length&&e.scrollToElement(t,0,150)))}),i.find("input").bind("keydown",function(){i.hasClass("opened")||i.addClass("opened")}),n.combobox&&n.change&&n.$watch("filter",function(e,t){e&&e!=t&&(n.change({selected:e}),n.model=null)}),n.$watch("disabled",function(e,t){e!==t&&(e&&(n.model={}),n.change({selected:n.model}))}),n.label=function(e,t){for(var n=(t=(t=t.replace(/\[(\w+)\]/g,".$1")).replace(/^\./,"")).split(".");n.length;){var i=n.shift();if(!(i in e))return;e=e[i]}return e}}return i.$inject=["$scope","$element","$attrs"],{restrict:"E",replace:!0,scope:{items:"=",model:"=",change:"&",placeholder:"@",deleteInstrument:"&"},controller:i,template:'<div class="epgu-selectbox select-for-payment" data-ng-class="{\'floating-placeholder\' : floating, \'has_content\' : model}">    <div class="select-el" id="_epgu_el{{id}}">      <div class="select-text selected-item  {{\'payment-icons-\' + model.icon}}" data-ng-class=\'{"select-text-start": selectStart, "card": model.cardInfo || model.new_card}\'>        {{getTitle()}}      </div>\n      <div class="trigger">\n           <div class="trigger-arrow"></div>      </div>\n    </div>    <div class="dropdown-el">\n        <ul>\n            <li data-ng-repeat="item in items" data-ng-click="select(item, $event)">                   <div data-ng-if="item.cardInfo || item.new_card" class="item {{item.new_card ? \'new-card\' : \'\'}}"><div data-ng-class="{\'checked\' : model.code == item.code}"></div>                   <div class="payment-icon {{\'payment-icons-\' + item.icon}}"></div>                   <div class="item-title">{{!item.new_card ? "**** ****" : ""}} {{item.itemTitle}}</div>                   <div data-ng-if="item.cardInfo" class="delete-card" data-ng-click="deleteInstrument({item:item, e:$event})"></div></div>\n                   <div data-ng-if="!item.cardInfo && !item.new_card" class="item"><div data-ng-class="{\'checked\' : model.code == item.code}"></div>                   <div class="item-title simple">{{item.itemTitle}}</div>                   <div class="payment-icon {{\'payment-icons-\' + item.icon}} simple"></div></div>            </li>       </ul>\n    </div>\n</div>'}}])}(),function(){"use strict";angular.module("epgu").directive("epguValDate",["$moment",function(o){return{restrict:"A",require:"ngModel",link:function(n,e,i,t){n.$parent.epguInputChange=function(){i.boundField&&i.boundRule&&t.$validate()},t.$validators.epguValDate=function(e){if(i.boundField&&i.boundRule&&i.boundScope){var t=n[i.boundScope][i.boundField];if(t)return!!t.match(new RegExp(i.boundRule))||o(e,"DD.MM.YYYY").isValid()}return o(e,"DD.MM.YYYY").isValid()}}}}]).directive("epguValDateNotFuture",["$moment",function(o){return{restrict:"A",require:"ngModel",link:function(e,t,n,i){i.$validators.epguValDateNotFuture=function(e){e=o(e,"DD.MM.YYYY");return!e.isValid()||e.isBefore(new Date)}}}}]).directive("epguValDateDateBefore",["$moment",function(a){return{restrict:"A",require:"ngModel",link:function(e,t,n,i){var o=a(n.epguValDateDateBefore,"DD.MM.YYYY");i.$validators.epguValDateDateBefore=function(e){e=a(e,"DD.MM.YYYY");return!e.isValid()||e.isBefore(o)}}}}]).directive("epguValDateAfter",["$moment",function(o){return{restrict:"A",require:"ngModel",link:function(e,t,n,i){i.$validators.epguValDateAfter=function(e){e=o(e,"DD.MM.YYYY");return!e.isValid()||e.isAfter(new Date)}}}}]).directive("epguNumber",["$moment",function(e){return{restrict:"A",require:"ngModel",link:function(e,t,n,i){i.$validators.epguNumber=function(e){return!isNaN(e)}}}}]).directive("epguMin",[function(){return{restrict:"A",require:"ngModel",link:function(e,t,n,i){var o=n.epguMin;i.$validators.min=function(e){return!n.required&&0==i.$viewValue.length||"1"===o&&"0"===i.$viewValue&&!n.required||e>=parseFloat(o)}}}}]).directive("epguMax",[function(){return{restrict:"A",require:"ngModel",link:function(e,t,n,i){var o=n.epguMax;i.$validators.max=function(e){return e<=parseFloat(o)}}}}]).directive("unique",["$rootScope",function(r){return{restrict:"A",require:"ngModel",link:function(i,e,t){var o=t.unique,a="epguField",s=o+"Form";function n(){for(var e,t=i.cars.concat().sort(function(e,t){return e[o]>t[o]?1:e[o]<t[o]?-1:0}),n=0;n<i.cars.length;n++)e=t[n-1]&&t[n-1][o]==t[n][o]||t[n+1]&&t[n+1][o]==t[n][o],t[n][s][a]&&t[n][s][a].$setValidity(o,!e)}i.epguInputChange=function(){n()},r.$on("revalidateUnique",function(){n()})}}}]).directive("maskedOptional",[function(){return{restrict:"A",require:"ngModel",link:function(t,e,n,i){var o;e.on("keyup",function(e){i.$viewValue?i.$viewValue&&1===i.$viewValue.length&&!o&&(e.target.selectionStart=t.epguFieldForm.epguField.$viewValue.indexOf("_")):(t.epguFieldForm.epguField.$setViewValue(""),t.epguFieldForm.epguField.$render(),t.epguFieldForm.epguField.$setValidity("mask",!0),t.epguFieldForm.epguField.$setValidity("parse",!0)),o=i.$viewValue})}}}]).directive("epguMoney",["$filter",function(o){return{restrict:"A",require:"ngModel",link:function(e,t,n,i){i.$formatters.push(function(e){return o("to_money")(e)}),i.$validators.epguMoney=function(e){return!e||(e=e.toString(),/^\d*?(\.\d{1,2})?$/.test(e))},i.$parsers.push(function(e){return"string"==typeof e?e.replace(/,/g,"."):e})}}}]).directive("epguInput",["$compile","$parse","$rootScope",function(f,m,g){var h=function(e,t,n){var i=t.type||e.type||"text";return"textarea"==i?'<div class="textarea-padding-up"></div>\n<textarea    id="_epgu_el'+n+'"\n    name="epguField"\n    ng-model="$parent.'+t.ngModel+'"    ng-change="epguInputChange()"\n'+(t.ngRequired?'    ng-required="'+t.ngRequired+'"\n':"")+(void 0!==e.placeholder||void 0!==t.placeholder?' placeholder="'+(e.placeholder||t.placeholder)+'"\n':"")+(e.required?" required ":"")+(e.trim?' ng-trim="true" ':"")+(t.readonly?'    ng-readonly="'+t.readonly+'"\n':"")+(e.minLength?' ng-minlength="'+e.minLength+'"':"")+(e.maxLength?' ng-maxlength="'+e.maxLength+'"':"")+(e.inputMaxLength?' maxlength="'+e.inputMaxLength+'"\n':"")+(e.focus?' ng-focus="'+e.focus+'"':"")+(e.blur?' ng-blur="'+e.blur+'"':"")+(e.keydown?' ng-keydown="'+e.keydown+'" ':"")+(e.inputMaxLength?' maxlength="'+e.inputMaxLength+'"':"")+"></textarea>\n":'<input    id="_epgu_el'+n+'"\n    name="epguField"\n    ng-model="$parent.'+t.ngModel+'"\n    type="'+("email"===i?i:"text")+'"\n    ng-change="epguInputChange()"\n'+(t.readonly?'    ng-readonly="'+t.readonly+'"\n':"")+(t.ngRequired?'    ng-required="'+t.ngRequired+'"\n':"")+(e.required?"    required\n":"")+(e.trim?' ng-trim="true" ':"")+(e.unique?' unique="'+e.unique+'" ':"")+(e.init?' ng-init="'+e.init+'" ':"")+(e.focus?' ng-focus="'+e.focus+'" ':"")+(e.blur?' ng-blur="'+e.blur+'" ':"")+(e.keydown?' ng-keydown="'+e.keydown+'" ':"")+(e.minLength?'    ng-minlength="'+e.minLength+'"\n':"")+(e.maxLength?' ng-maxlength="'+e.maxLength+'"':"")+(e.realMaxLength?' maxlength="'+e.realMaxLength+'"':"")+(e.inputMaxLength?' maxlength="'+e.inputMaxLength+'"\n':"")+(e.boundField?'    data-bound-field="'+e.boundField+'"\n':"")+(e.boundRule?'    data-bound-rule="'+e.boundRule+'"\n':"")+(e.boundScope?'    data-bound-scope="'+e.boundScope+'"\n':"")+(e.modelOptions?'    ng-model-options="'+e.modelOptions+'"\n':"")+("date"==i?'    ui-mask="99.99.9999"\n    ui-mask-save="viewValue"\n    epgu-val-date\n'+(e.uiOptions?'    ui-options="'+e.uiOptions+'"\n':"")+(e.notFuture?"    epgu-val-date-not-future\n":"")+(e.dateAfter?"    epgu-val-date-after\n":""):"number"==i?e.money?"  epgu-money":"  epgu-number"+(e.min?'    epgu-min="'+e.min+'"\n':"")+(e.max?'    epgu-max="'+e.max+'"\n':""):(e.mask?'    ui-mask="'+e.mask+'"\n':"")+(void 0!==e.uiMaskPlaceholderChar?'   ui-mask-placeholder-char="'+e.uiMaskPlaceholderChar+'"\n':"")+(e.maskSave?'    ui-mask-save="'+e.maskSave+'"\n':"")+(e.maskPlaceholder?' ui-mask-placeholder="'+e.maskPlaceholder+'"\n':"")+(void 0!==e.uiMaskPlaceholderChar?'   ui-mask-placeholder-char="'+e.uiMaskPlaceholderChar+'"\n':"")+(void 0!==e.placeholder||void 0!==t.placeholder?' placeholder="'+(e.placeholder||t.placeholder)+'"\n':"")+(e.notFuture?"    epgu-val-date-not-future\n":"")+(e.dateAfter?"    epgu-val-date-after\n":"")+(e.uiOptions?'    ui-options="'+e.uiOptions+'"\n':"")+("date"!=i&&e.pattern&&!e.mask?'    ng-pattern="'+e.pattern+'"\n':"")+(e.pattern&&e.mask?'    ui-mask-pattern="'+e.pattern+'"\n':"")+(t.isupper?'    class="car-docs-to-upper"':"")+(t.uiPlaceholder?' placeholder="'+t.uiPlaceholder+'"':"")+(e.mask&&t.optional?" masked-optional":""))+" />\n"};return{restrict:"E",link:function(n,e,i){var t,o,a,s,r=m(i.ngModel),l=m(i.field)(n.$parent)||{},c=IDSequence.get(),d=(t=l,a=c,d=(o=i).label||t.label,s=o.longLableLength?"dk"===g.version?o.longLableLength.split(";")[0]:o.longLableLength.split(";")[1]:"",s=o.longLable&&s&&d.length>s&&"mob"!==g.version,s='<div ng-form="epguFieldForm" class="epgu-input-text'+(angular.isDefined(o.floating)?" floating-placeholder":"")+(angular.isDefined(o.className)?" "+o.className:"")+"\" ng-class=\"{'invalid-field' : "+(t.externalErrorPath||"epguFieldForm.epguField.$invalid")+'}">\n'+(d?'<label for="_epgu_el'+a+"\" data-ng-class=\"{'label-long-input':"+s+'}">'+d+"</label>\n":"")+h(t,o,a),t.subText&&(s+='<div class="epgu-input-subtext">'+t.subText+"</div>"),angular.isDefined(t.showErrors)&&!t.showErrors||(s+='    <div class="errors-wrapper" data-ng-show="epguFieldForm.epguField.$invalid">\n        <div  class="field-error">\n             <p data-ng-repeat="(error, val) in epguFieldForm.epguField.$error"  data-ng-bind="errorMessage(error, val, epguFieldForm.epguField)"></p>\n        </div>\n    </div>\n'),s+="</div>\n"),u=(e.html(d),f(e.contents())(n),e.children(0)),p=e.find("input,textarea");if(1<p.length)throw"template error";n.$watch(function(){return r(n.$parent)},function(e,t){e!==t&&(0<p.val().length?(u.addClass("has_content"),g.epguInputModelLength=p.val().length):document.activeElement!==p[0]&&u.removeClass("has_content"),m(i.ngChange)(n.$parent))}),n.errorMessage=function(e,t,n){if(l.errorMessages&&l.errorMessages[e])return l.errorMessages[e];switch(l.hasCustomErrors&&(n.$viewValue&&n.$viewValue.length&&0===n.$viewValue.length||!n.$viewValue)&&"parse"===e&&(e="required"),e=l.requiredAndMask&&"parse"===e?"required":e){case"required":return"Поле обязательно для заполнения";case"pattern":return"Значение должно соответствовать шаблону example@example.ru";case"minlength":return"Значение должно содержать "+l.minLength+" символов";case"maxlength":return"Значение не может содержать более "+l.maxLength+" символов";case"min":return"Значение не должно быть менее "+l.min;case"max":return"Значение не должно превышать "+l.max;case"mask":return"Значение не соответствует маске"+(l.maskMessage?" "+l.maskMessage:"");case"epguValDate":return"Укажите дату в формате ДД.ММ.ГГГГ";case"epguValDateNotFuture":return"Дата должна быть в прошлом";case"epguValDateDateBefore":return"Дата должна быть ранее "+l.epguValDateDateBefore;case"epguValDateAfter":return"Дата должна быть в прошлом "+l.epguValDateDateBefore;case"epguNumber":return"Укажите валидное число";case"epguMoney":return"Можно ввести только цифры, запятую или точку для ввода копеек. Пример ввода: 250,50";case"email":return"Укажите корректный email"}},i.keyup&&p.bind("keyup",function(e){n.$apply(function(){l.onChange(p)})}),p.bind("focus",function(){l.readonly||u.addClass("has_content"),l.hideErrorsOnBlur&&u.find(".errors-wrapper").show()}),p.bind("blur mask-blur",function(){l.readonly||(0<p.val().length?u.addClass("has_content"):u.removeClass("has_content")),l.hideErrorsOnBlur&&e.find(".errors-wrapper").hide(),l.onBlur&&l.onBlur(p)}),p.bind("paste",function(e){l.readonly||(e=(e.originalEvent||e).clipboardData.getData("text/plain"))&&0<e.length&&(g.epguInputModelLength=e.length)}),(l.readonly||r(n.$parent))&&u.addClass("has_content"),l.onInit&&l.onInit(p,c)},scope:!0}}])}(),function(){"use strict";angular.module("epgu").directive("fileUpload",["$rootScope","$filter","$location","PerformanceService",function(h,v,b,y){return{restrict:"E",templateUrl:function(e,t){t=t.viewType&&"import-cars"===t.viewType?"fileupload-cars.html":"fileupload-documents.html";return h.staticDomainUrl+"htdocs/tpl/directives/formelements/"+t},replace:!0,scope:{name:"@",fieldName:"@",sizeLimit:"@",mode:"@",customUrl:"@",allowMultiple:"@",gepsMessage:"@",extentions:"@",gepsAttachments:"=",edsAttachments:"=",selectedFiles:"=?",headers:"=?",uploadedFiles:"&"},require:"^form",link:function(r,e,s,t){function n(){o.removeClass("hover")}var i=$(e[0]),e=i.find("label"),o=i.find(".dropzone"),a=(i.find("input[type=hidden][name=files]"),r.files=r.selectedFiles||[],r.manualLaunch=void 0!==s.manual,r.viewType=s.viewType,r.manualLaunch&&r.$root.$on("uploader-launch",function(){r.inprogress=!0,"achievements"===r.mode&&y.measureStart("upload"),p.start()}),r.$watchCollection("files",function(e){r.selectedFiles=e}),o.on("dragenter",function(){o.addClass("hover")}),o.on("dragleave",n),o.on("drop",n),SmartPhone.isAny()||i.addClass("dnd-supported"),s.sizeLimit||(s.sizeLimit=10),s.fieldName||"file");function l(){var e;return"geps"===r.mode?(e=b.protocol(),e=(0===h.gepsApiUrl.indexOf("http")?"":e+":")+h.gepsApiUrl+"file/upload?messageId="+r.gepsMessage):(e=c()?r.customUrl:"eds"===r.mode?h.lkApi+"eds/upload/":"achievements"===r.mode?r.customUrl:h.lkApi+"feedback/fupload").startsWith("//")&&(e=-1!=h.betaUrl.indexOf("http://")?"http:"+e:"https:"+e),e}function c(){return"custom"===r.mode}function d(e,t,n,i){return e.length>i&&(t.error="Превышено количество загружаемых файлов",t.size="",t.type="any",t.name=e.map(function(e){return r.removeFile(e),e.name}).join(", "),r.files.push(t),!0)}function u(e,t){var n,i,o=g(e);return o<0?(n=m(e,t),r.files.push(n)):n=r.files[o],c()&&!r.multipleAllowed&&1<r.files.length&&(i=[],r.files.forEach(function(e){i.push(e)}),d(i,n,0,1),i.length=0),n}r.limitLeft=f(),r.limitLeftStatic=1024*s.sizeLimit*1024,r.$watch(f,function(e,t){t!=e&&(r.limitLeft=e)}),r.multipleAllowed=!["achievements","eds"].includes(r.mode)&&(!c()||void 0!==r.allowMultiple&&"true"===r.allowMultiple);var e={runtimes:"html5, flash, html4",browse_button:e[0],url:l(),flash_swf_url:"/htdocs/js/lib/plupload/plupload.flash.swf",headers:r.headers||{},required_features:"send_browser_cookies",file_data_name:a,dragdrop:!0,drop_element:i[0],multi_selection:r.multipleAllowed},p=(r.extentions&&(e.filters=e.filters||{},e.filters.mime_types=[{title:"Custom files",extensions:r.extentions||""}]),r.sizeLimit&&(e.filters=e.filters||{},e.filters.max_file_size=r.sizeLimit+"mb"),new plupload.Uploader(e));function f(){for(var t=0,e=("geps"==r.mode&&angular.forEach(r.gepsAttachments,function(e){t+=e.fileSize}),1024*s.sizeLimit*1024),n=e-t,i=0;i<r.files.length;i++){var o=r.files[i];o.error||(n-=o.size)}var a=n<0?0:n;return isNaN(a)?e:a}function m(e,t){return{hash:"",id:e.id,name:e.name,size:e.size,loadingPercent:e.percent||e.loadingPercent||0,error:t}}function g(e){for(var t=r.files,n=e,i=0;i<t.length;i++){var o=t[i];if(!n.id&&n.name===o.name&&n.size===o.size||n.id&&n.id==o.id)return i}return-1}r.multipleAllowed||(r.$on("clearUploaders",function(){r.files&&r.files.length&&r.files.forEach(function(e){r.removeFile(e)})}),p.bind("FileFiltered",function(e,t){r.files&&r.files.length&&r.files.forEach(function(e){r.removeFile(e)})})),"eds"===r.mode&&p.bind("BeforeUpload",function(e,t){var n=l();r.extentions&&r.extentions.length?(e.settings.url=n+"sign?name="+t.name,r.edsAttachments&&r.edsAttachments.file.fileId&&(e.settings.url+="&fileId="+r.edsAttachments.file.fileId)):e.settings.url=n+"data?name="+t.name}),"achievements"===r.mode&&p.bind("BeforeUpload",function(e,t){var n;r.files&&r.files.length&&(n=r.files.find(function(e){return t.id===e.id}))&&(e.settings.multipart_params=n.params,console.log(n.params))}),p.bind("FilesAdded",function(e,a){angular.forEach(a,function(e){var t,n,i,o=!1;!function(e){for(var t=0;t<r.files.length;t++){var n=r.files[t];if(n.name==e.name&&n.size==e.size)return 1}return}(e)?(n=f(),t=m(e),o||!c()||r.multipleAllowed||(o=!!(t=u(t)).error)&&p.removeFile(e),!o&&t.size>n&&(n=r.limitLeft?v("file_size")(r.limitLeft):t.size,t.error="Размер файла превышает допустимые "+n+". Необходимо его уменьшить.",o=!0,p.removeFile(e)),o||!s.extentions||function(e){if(e&&e.name){var t=s.extentions.split(","),n=e.name.lastIndexOf(".");if(0<=n){n=e.name.substring(n+1).toLowerCase();if(n&&0<=t.indexOf(n))return e.type=n,1}}return}(t)||(n=function(){for(var e="",t=s.extentions.split(","),n=0;n<t.length;n++)e+=n<t.length-1?t[n]+", ":t[n];return e}(s.extentions),t.error="Файл имеет неверный тип. Только файлы с расширениями "+n+" доступны к загрузке",t.type="any",o=!0,p.removeFile(e)),o||"eds"!==r.mode||(r.extentions&&r.extentions.length&&$.isEmptyObject(r.edsAttachments.file)&&(t.error="Сначала загрузите подписанный файл",o=!0,p.removeFile(e)),o=o||d(a,t,0,1)),i=g(t),r.$root.$safeApply(function(){i<0?r.files.push(t):r.files[i]=t,r.selectedFiles=r.files}),r.uploadProgress(t)):r.removeFile(e),r.uploadedFiles&&r.uploadedFiles({files:r.files})}),r.manualLaunch||p.start()}),r.uploadProgress=function(n){p.bind("uploadProgress",function(e,t){r.$root.$safeApply(function(){n.loadingPercent=t.percent,n.inprogress=!0,r.inprogress=!0,100==t.percent&&r.setCompleteUpload(n)})})},r.setCompleteUpload=function(e){e.loaded=!0,e.inprogress=!1},p.bind("FileUploaded",function(e,t,n){var i=u(t);if(n){if("geps"==r.mode)try{var o=JSON.parse(n.response);r.removeFile(t),r.$root.$safeApply(function(){r.gepsAttachments.push(o)})}catch(e){r.$root.$safeApply(function(){i.error="Ошибка при загрузке файла"})}else if("eds"==r.mode){var o=JSON.parse(n.response),a=t.name.substring(t.name.lastIndexOf("."+r.extentions),t.name.length),s={};o.uploadId=t.id,o.hash&&(t.hash=o.hash),r.extentions&&r.extentions.length&&a=="."+r.extentions?s.sign=o:s.file=o,r.limitLeft=1024*r.sizeLimit*1024,r.$root.$safeApply(function(){angular.extend(r.edsAttachments,s)})}else if("achievements"===r.mode)200===n.status?(y.measureEnd("upload",0),i.defer&&i.defer.resolve()):i.defer&&(i.defer.reject(),y.measureEnd("upload",1,{ServiceError:1}));else try{o=n.response;r.$root.$safeApply(function(){o&&200==n.status?(i.hash=o,r.limitLeft=f()):i.error="Ошибка при загрузке файла"})}catch(e){r.$root.$safeApply(function(){i.error="Ошибка при загрузке файла"})}r.inprogress=!1,r.$root.$emit("uploader-success",n,i)}}),p.bind("Error",function(e,t){var n,i,o=t.message;if(-600===t.code||-601===t.code||-200===t.code){switch(t.code){case-600:o="Превышен допустимый размер файла";break;case-601:o="Файл имеет неверный тип"}-200!==t.code&&s.viewType&&"import-cars"===s.viewType&&(o="Внимание! "+o),"eds"==r.mode?(r.files=[],n=m(t.file,o),r.$root.$safeApply(function(){r.files.push(n)})):((i=u(t.file,o)).type="any",i.inprogress=!1,r.inprogress=!1,r.$root.$safeApply(),"achievements"===r.mode&&(y.measureEnd("upload",1,{BrowserError:t?t.code:""}),i.error="Не удалось загрузить файл. Удалите достижение, приложите другой файл или попробуйте загрузить файл еще раз",i.defer)&&i.defer.reject())}}),function e(){i.is(":visible")?p.init():setTimeout(e,100)}(),r.removeFile=function(e){var t=g(e);if(0<=t&&r.$root.$safeApply(function(){p.removeFile(e),r.files.splice(t,1),r.uploadedFiles({files:r.files})}),"eds"==r.mode)for(var n in r.edsAttachments)e.id==r.edsAttachments[n].uploadId&&(r.edsAttachments[n]={});r.selectedFiles=r.files}}}}])}(),function(){"use strict";angular.module("epgu").directive("fineSimple",function(){return{restrict:"E",template:'<span class="article-offenses break-word"></span>',replace:!0,link:function(e,t,n){var i,o,a,s=n.limit;void 0!==n.$attr.article&&(o="",o=(i=n.article.trim().toUpperCase())?s?(a=n.out,s=s,(a=a.split("<br />"))[0].length<s?a[0]:(a=a[0].substring(0,s-3)).substr(0,Math.min(a.length,a.lastIndexOf(" ")))+"..."):n.out:i.replace(/[,.!?]/g,function(e,t,n){return e+" "}),t.html(o))}}})}(),function(){"use strict";angular.module("epgu").directive("indexInformer",function(){function e(t,n,i){function e(){n.$safeApply(function(){t.informerEnabled=n.logined,t.model.informer&&"fns"===t.model.informer.toLowerCase()&&(t.informerEnabled=n.logined&&10<n.user.al)})}t.model.informer&&(t.informer=n.informers[t.model.informer]),e(),n.$on("user-loaded",e),t.informerClick=function(e){n.logined&&t.informer&&"E"===t.informer.state?i.url(t.model.href+"/result/informer"):i.url(t.model.staticHref)}}return e.$inject=["$scope","$rootScope","$location"],{restrict:"E",template:'<div class="epgu-informer" ng-click="informerClick($event);"><div class="epgu-informer-body-wrapper">\n            <div class="headline">\n                <div class="service {{model.icon}}"></div>\n            </div>\n            <div class="body">\n                <h3>{{model.title}}</h3>\n                <div ng-if="!informer || informer.state ==\'D\' || !informerEnabled" class="disabled-block" data-ng-bind-html="model.content | to_trusted"></div>\n                <div ng-if="informerEnabled && informer && informer.state == \'U\'" class="loading-block">Данные обновляются...</div>\n                <div ng-if="informerEnabled && informer && informer.state == \'E\' && informer.data.total == 0" class="empty-block" ng-bind-html="model.notFoundMessage | to_trusted"></div>\n                <a ng-if="informerEnabled && informer && informer.state == \'E\' && informer.data.total != 0" class="result-block" href="{{model.href}}/result/informer">               {{model.totalMessage}}&nbsp;<strong class="summ">{{informer.data.total.replace(\'.00\', \'\').replace(\' \', \'&nbsp;\')}}</strong>&nbsp;<nobr class="rouble">p</nobr></a>\n                <div ng-if="informerEnabled && informer && informer.state == \'F\'" class="error-block">Ошибка получения данных</div>\n            </div>\n            <div class="search-link view-dk">\n                <span href="{{model.staticHref}}" class="btn-sec small">{{model.button}}</span>\n            </div>\n        </div></div>',scope:{model:"="},transclude:!0,replace:!0,controller:e}})}(),function(){"use strict";angular.module("epgu").directive("infoAlert",function(){return{restrict:"E",template:'                   <div class="info-block_wrap">                       <div class="info_block type_{{type}}">\n                          <p class="info-block_h"><b>{{title}}</b></p>\n                          <p ng-transclude></p>\n                          <span class="icomoon">"</span>\n                      </div>                   </div>',scope:{title:"@",type:"@"},transclude:!0,replace:!0}})}(),function(){"use strict";angular.module("epgu").directive("infoColumnInformer",function(){function e(o,e,t){function n(){var e=o.warn=!1;if("E"==a.state){var t=a.data.request,n=function(e,t){return void 0!==t&&null!=t||(t=""),(""+(e=void 0!==e&&null!=e?e:"")).toLowerCase()==(""+t).toLowerCase()};if(t&&s)switch(o.code){case"fssp":e=n(t.firstName,s.firstName)&&n(t.lastName,s.lastName)&&n(t.middleName,s.middleName)&&t.birthDate==s.birthDate;break;case"fns":e=t.userInn==s.userInn;break;case"gibdd":if(e=n(t.vuNumber,s.vuNumber)){for(var i=0;-1!==Object.keys(t).indexOf("stsNumber"+i)&&-1!==Object.keys(s).indexOf("stsNumber"+i)&&-1!==Object.keys(t).indexOf("carNumber"+i)&&-1!==Object.keys(s).indexOf("carNumber"+i)&&(n(t["carNumber"+i],s["carNumber"+i])||(e=!1),n(t["stsNumber"+i],s["stsNumber"+i])||(e=!1),i++,e););n(t["carNumber"+i],s["carNumber"+i])||(e=!1),n(t["stsNumber"+i],s["stsNumber"+i])||(e=!1)}}else e=!1;e||(o.warn=!0)}o.state=e}var a=e.informers[o.code],s=e[o.code].request;o.warn=!1,n(),e.$watch("informers."+o.code+".state",function(e,t){e!==t&&n()}),e.$watch("informers."+o.code+".data.request",function(e,t){angular.equals(e,t)||n()}),o.toggle=function(){o.state?t.deleteInformer(o.code,!0,function(){e.$apply()}):t.saveInformer(o.code,function(){e.$apply()})}}return e.$inject=["$scope","$rootScope","FormServer"],{restrict:"E",template:'<li class="info_block bg_c0" >\n<div class="switcher">\n                        <div ng-class="{off : !state}" ng-click="toggle()" class="cover">\n                            <div class="left">Вкл</div>\n                            <div class="movable"></div>\n                            <div class="right">Откл</div>\n                        </div>\n                    </div><h4 class="add_pad">Информер</h4>\n<p ng-transclude></p>\n<p ng-if="warn">В данный момент информер активирован по другому поисковому запросу. Повторно активируйте информер, если желаете обновить поисковый запрос.</p>\n</li>',replace:!0,scope:{code:"@"},transclude:!0,controller:e}})}(),function(){"use strict";angular.module("epgu").directive("infoColumnItem",function(){return{restrict:"E",link:function(e,t,n){e.closeInfo=function(){e.removeinfo()}},template:'<li class="info_block type_{{type}}">\n<h4 data-ng-if="title" class="info-block-title">{{title}}</h4>\n<div data-ng-class="{\'offset-top-extra-min\': !title}" data-ng-if="text" data-bind-html-compile="text"></div>\n<div data-ng-class="{\'offset-top-extra-min\': !title}" ng-transclude></div>\n<span class="icon-info"></span>\n<span data-ng-if="close" data-ng-click="closeInfo()" class="info-close-btn"></span>\n</li>',scope:{title:"@",type:"@",close:"@",text:"=",removeinfo:"&"},transclude:!0,replace:!0}})}(),function(){"use strict";window.userId&&angular.module("epgu").directive("informerKnd",[function(){function e(e,n,t,i){e.selfClick=function(e){return t(i.setKndFormPath),e.stopPropagation(),!1},e.setInformerCls=function(e){return i.setCls("informer-duty__item informer-duty__item--knd",e)},e.updateInformerState=function(e,t){"H"!=t&&"U"!=t&&(e.stopPropagation(),n.informerKnd.state="U",i.getInformerData().then(function(e){"F"!=(n.informerKnd=e).state&&"D"!=e.state&&(n.informerKnd.informerData=n.informerKnd.getStatuses())}))}}e.$inject=["$scope","$rootScope","$timeout","KndInformerService"];return{restrict:"E",template:'<div class="grid-wrap__col-lg-6 grid-wrap__col-md-auto grid-wrap__col-sm-auto informer-duty md-flex-auto sm-flex-auto informer-item"     data-ng-click="selfClick($event);" data-ng-class="setInformerCls(state)">   <div class="flex-container align-items-center md-align-items-start sm-align-items-start md-land-justify-start">       <div class="flex-container align-items-center md-align-items-start">           <div data-ng-click="updateInformerState($event, state)" class="informer-duty__image">               <div class="hexagon">                   <svg class="hexagon__image" xmlns="http://www.w3.org/2000/svg" width="48" height="52" viewBox="0 0 48 52"><path d="M43.06 9.507s-3.176-2.352-7.164-4.684C31.906 2.488 28.308.875 28.308.875 25.9-.203 21.96-.203 19.553.875c0 0-3.6 1.613-7.588 3.948C7.975 7.155 4.8 9.507 4.8 9.507 2.672 11.08.702 14.537.42 17.187c0 0-.42 3.965-.42 8.632 0 4.666.42 8.63.42 8.63.283 2.65 2.253 6.108 4.378 7.68 0 0 3.177 2.353 7.167 4.688 3.99 2.332 7.588 3.945 7.588 3.945 2.407 1.078 6.347 1.078 8.755 0 0 0 3.597-1.613 7.587-3.945 3.99-2.335 7.166-4.688 7.166-4.688 2.127-1.572 4.097-5.03 4.38-7.68 0 0 .42-3.964.42-8.63 0-4.668-.42-8.632-.42-8.632-.283-2.65-2.253-6.108-4.38-7.68z" fill="#FFF"/></svg>                   <div class="hexagon__loading"></div>                   <div class="loader-state"></div>               </div>           </div>       </div>       <div class="title-white">           <div class="informer-duty__title">{{title}}</div>           <div class="lg-h-title-12 md-h-title-14 sm-h-title-14" data-ng-if="state == \'F\'">               <div class="tile-transparent lg-offset-top-8">{{errorMessage}}</div>               <div class="lg-h-title-12 underline transparent-80 lg-offset-top-8" data-ng-click="updateInformerState($event, state)">Повторить</div>           </div>           <div data-ng-if="state == \'U\'" class="lg-h-title-12 md-h-title-14 sm-h-title-14 tile-transparent lg-offset-top-8">{{updateMessage || \'Идет поиск...\'}}</div>           <div data-ng-if="state == \'D\'" class="lg-h-title-12 md-h-title-14 sm-h-title-14 tile-transparent lg-offset-top-8">{{emptyMessage}}</div>           <div data-ng-if="state == \'E\'" class="lg-h-title-12 md-h-title-12-small sm-h-title-12 transparent-80">               <div data-ng-if="informer.entries.amountUpcoming != 0" class="lg-offset-top-8 md-offset-top-4">Будущие - {{informer.entries.amountUpcoming}}</div>               <div data-ng-if="informer.entries.amountCurrent != 0" class="lg-offset-top-8 md-offset-top-4">Текущие - {{informer.entries.amountCurrent}}</div>               <div data-ng-if="informer.entries.amountCurrent == 0 && informer.entries.amountUpcoming == 0 && informer.entries.amountLast != 0" class="lg-offset-top-8 md-offset-top-4">Прошедшие - {{informer.entries.amountLast}}</div>           </div>       </div>   </div></div>',scope:{informer:"=",state:"=",errorMessage:"@",updateMessage:"@",emptyMessage:"@",updateTitle:"@",title:"@"},replace:!0,controller:e}}]).directive("informerKno",["$rootScope","$location",function(e,t){return{restrict:"E",template:'<div class="grid-wrap__col-lg-6 grid-wrap__col-md-auto grid-wrap__col-sm-auto informer-duty informer-item flex-order-2">  <a class="display-block informer-duty__item informer-duty__item--kno without-fines" data-ng-href="{{$root.lkUrl}}inspect">    <div class="flex-container align-items-center md-align-items-start sm-align-items-start md-land-justify-start">      <div class="informer-duty__image">        <div class="hexagon">          <svg class="hexagon__image" xmlns="http://www.w3.org/2000/svg" width="48" height="52" viewBox="0 0 48 52"><path d="M43.06 9.507s-3.176-2.352-7.164-4.684C31.906 2.488 28.308.875 28.308.875 25.9-.203 21.96-.203 19.553.875c0 0-3.6 1.613-7.588 3.948C7.975 7.155 4.8 9.507 4.8 9.507 2.672 11.08.702 14.537.42 17.187c0 0-.42 3.965-.42 8.632 0 4.666.42 8.63.42 8.63.283 2.65 2.253 6.108 4.378 7.68 0 0 3.177 2.353 7.167 4.688 3.99 2.332 7.588 3.945 7.588 3.945 2.407 1.078 6.347 1.078 8.755 0 0 0 3.597-1.613 7.587-3.945 3.99-2.335 7.166-4.688 7.166-4.688 2.127-1.572 4.097-5.03 4.38-7.68 0 0 .42-3.964.42-8.63 0-4.668-.42-8.632-.42-8.632-.283-2.65-2.253-6.108-4.38-7.68z" fill="#FFF"></path></svg>        </div>      </div>      <div>        <div class="informer-duty__title nowrap">Присвоение степени риска</div>        <div class="lg-h-title-12 underline title-white offset-top-8">Подробнее</div>      </div>     </div>    </div>  </a></div>'}}]).directive("informerDuty",["$location","$rootScope",function(c,e){function t(n,i,e,o,t,a,s){function r(t){n.informerDuty.state="U",o.getData().then(function(e){e&&e.data&&200==e.status&&(e=e.data).total&&parseFloat(e.total)?(n.informerDuty.loading=!1,n.informerDuty.state="E",n.informerDuty.total=e.total?parseFloat(e.total):null,n.informerDuty.originalTotal=e.originalTotal?parseFloat(e.originalTotal):null,n.informerDuty.total&&n.mainInformers.informers&&i.$emit("informerDutyEnabled",t),e.list&&1==e.list.length?(n.informerDuty.orderId=e.list[0].orderId,n.informerDuty.link="/payment/"+e.list[0].uin):e.list&&1<e.list.length&&(n.informerDuty.orderId=null,n.informerDuty.orderIDCollection=[],e.list.forEach(function(e){e.orderId&&n.informerDuty.orderIDCollection.push(e.orderId)}),n.informerDuty.orderIDCollection)&&(n.informerDuty.items=e.list.length)):i.$emit("informerDutyDisabled"),n.informerDuty.loading=!1},function(){n.informerDuty.loading=!1,i.$emit("informerDutyDisabled")})}n.informerDuty.setInformerDutyCls=function(e){var t="informer-duty__item";switch(e.state){case"E":t+=" informer-duty__item--enabled",e.originalTotal&&(t+=" informer-duty__item--discount");break;case"U":t+=" informer-update"}return t},n.informerDuty.selfClick=function(e){if(e.stopPropagation(),s.send("informerAction","service","salefines"),"U"==n.informerDuty.state)return!1;n.informerDuty.link?n.informerDuty.orderId?c.path(n.informerDuty.link).search({orderId:n.informerDuty.orderId}):c.path(n.informerDuty.link):(t.createCookie("orderIdPayment",n.informerDuty.orderIDCollection),window.location=i.lkUrl+"notifications?type=ORDER")},n.informerDuty.updateInformerDuty=function(e){e.stopPropagation(),s.send("informerUpdate","service"),r(!0)};var l=c.path();i.informerDutyShow&&i.userId&&("/"===l||-1!==l.indexOf("/r/")||-1!==l.indexOf("/o/"))&&r()}return t.$inject=["$scope","$rootScope","InformersService","DutyInformerService","ToggleCookie","$http","MainPageMetric"],{restrict:"E",templateUrl:e.templatePath+"/tpl/informerDuty-5bcd74ec97.html",replace:!0,controller:t,scope:{informerDuty:"=",mainInformers:"=",sortInformers:"&sortInformers"}}}]).directive("informerWithDuty",["$location","$rootScope",function(r,e){function t(o,e,n,a,t,s){o.versionDesk="dk"===e.version,o.detectMob=function(){return SmartPhone.isPhone()},o.selfClick=function(e,t,n){var i;o.informer&&o.informer.code&&(i="receipt"==e?"uin":e,"H"==t?s.send("informerAction",i,"needdata"):"E"==t&&0!=o.informer.data.total?o.informer.data.originalTotal&&o.informer.data.withDiscounts?s.send("informerAction",i,"salefines"):s.send("informerAction",i,"fines"):s.send("informerAction",i,"zero"),i=t,"receipt"===(t=e)?r.path(o.informer.receiptLink).search({uin:!0}):r.url(a.setInformerResultPath(t,i)))},o.getInformerItemsLen=function(e){return a.getInformerItemsLen(e)},o.setInformerCls=function(e){return a.setInformerCls("informer-duty__item informer-duty__item--"+e.code,e)},o.updateInformerState=function(e,t){"H"!=t.state&&"U"!=t.state&&(e.stopPropagation(),"receipt"===o.informer.code?r.path(o.informer.receiptLink).search({uin:!0}):(s.send("informerUpdate",o.informer.code),n.invalidateInformer(o.informer.code,"?refresh=true")))}}return t.$inject=["$scope","$rootScope","FormServer","InformersService","DutyInformerService","MainPageMetric"],{restrict:"E",templateUrl:e.templatePath+"/tpl/informerWithDuty-3d161f0209.html",scope:{title:"@",informer:"=?",disabledMessage:"@",receiptLink:"@",successMessage:"@",errorMessage:"@",updateMessage:"@",discountMessage:"@",versionDesk:"=?"},replace:!0,controller:t}}]).directive("informerNotify",["$location","$rootScope",function(s,e){function t(i,e,o,a){i.versionDesk="dk"===e.version,i.detectMob=function(){return SmartPhone.isPhone()},i.selfClick=function(e,t,n){i.informer&&i.informer.code&&(angular.element(n.target).hasClass("js-update-el")?o.invalidateInformer(i.informer.code,"?refresh=true"):s.url(a.setInformerResultPath(e,t)))},i.getInformerItemsLen=function(e){return a.getInformerItemsLen(e)},i.setInformerCls=function(e){return a.setInformerCls("epgu-informer-notify",e)}}t.$inject=["$scope","$rootScope","FormServer","InformersService"];return{restrict:"E",template:'<div data-ng-show="informer && informer.state != \'D\'"           data-ng-click="selfClick(informer.code, informer.state, $event);"           data-ng-class="setInformerCls(informer)">\n           <div data-ng-if="informer.state == \'U\'" data-throbber="throbber-small" data-show-heading="false"></div>    <div class="body">\n        <h4>{{title}}</h4>\n        <div data-ng-if="informer && (informer.state == \'U\')" class="loading-block plain-text">{{updateMessage}}</div>\n        <div data-ng-if="informer.state == \'F\'" class="result-block">{{errorMessage}}</div> \n        <div data-ng-if="informer && informer.state == \'E\' && (getInformerItemsLen(informer.data.items) > 0 && informer.data.total != 0)" class="result-block">            {{informer.data.total.replace(\'.00\', \'\').replace(\' \', \'&nbsp;\')}}&nbsp;<nobr class="rouble">p</nobr>        </div>\n        <div data-ng-if="informer && informer.state == \'E\' && (getInformerItemsLen(informer.data.items) > 0 && informer.data.total != 0) && informer.data.withDiscounts" class="result-block-discounts">{{discountMessage}}</div>        <div data-ng-if="informer && informer.state == \'E\' && (getInformerItemsLen(informer.data.items) == 0 || informer.data.total == 0)">            {{successMessage}}        </div>\n        <div data-ng-if="informer && informer.state == \'H\'" class="plain-text">            {{disabledMessage}}        </div>\n    </div>\n  <span class="informer-update js-update-el" data-ng-if="informer.state != \'H\' && informer.state != \'U\'"></span></div>',scope:{title:"@",informer:"=?",disabledMessage:"@",successMessage:"@",errorMessage:"@",updateMessage:"@",discountMessage:"@",versionDesk:"=?"},replace:!0,controller:t}}]).directive("informerSingle",["$rootScope",function(e){function t(n,i,t,o,e,a,s,r,l){function c(){var e;s.getUserRoles(),n.userRoles=[],i.profile.roles.forEach(function(e){"AGENCY"===e.personType||"LEGAL"===e.personType?n.userRoles.push("L"):"PERSON"===e.personType?n.userRoles.push("P"):n.userRoles.push("B")}),n.usersRole=(e=i.user.empEpguRole,"P"===i.userType?"FL":"L"===i.userType?i.user.branchOid?"ULF":"chief"===e?"ULR":"admin"===e?"ULA":"ULS":"B"===i.userType?"chief"===e?"IPR":"admin"===e?"IPA":"IPS":"IG"),n.userCanSeeInformers=(e=!!i.user.groups&&i.user.groups.find(function(e){return["ESIA","PGU"].includes(e.itSystem)&&"ORG_ADMIN"===e.grp_id}),(i.user.isOrgChief||e)&&i.userType===userType&&i.userId&&!i.user.branchOid),n.limitedLB="P"!==i.userType&&!n.userCanSeeInformers,n.additionsToShowMetric={role:n.usersRole,screen:n.usersDevice}}n.isDebt=!1,n.isError=!1,n.isAL1520="AL10"!==i.assuranceLevel,i.profile=l.get(),n.userOnHisPage=i.userType===i.userTypeGosBar||!i.userTypeGosBar,n.usersDevice="dk"===i.version?"desk":"pad"===i.version?"tab":"mob",n.sliderConfig={startSlide:0,auto:!1,draggable:!1,continuous:!1,disableScroll:!1,stopPropagation:!1},n.limitedLWithRigth=!1,n.informerForF=!1,i.restrictionEmbedded=i.restrictionShow&&"P"===i.userType,i.userId&&(Object.keys(i.user).length&&!i.userLoading?c():i.$on("user-loaded",c));var d,u,p=[],f={fine:{type:"штраф"},fssp:{type:"судебная задолженность"},fns:{type:"налоговая задолженность"},stateDuty:{type:"госпошлина"},account:{type:"счет"}},m={isAL10:{noDeptCaptureText:"Укажите больше данных для&nbsp;поиска начислений",noDeptLink:i.lkUrl+"info",noDeptLinkText:"Профиль",noDeptIcon:"informer-no-icon",metricType:"informerProfileAction",metricValue:n.additionsToShowMetric},error:{noDeptCaptureText:"Узнайте свои задолженности",noDeptLink:i.betaUrl+"pay",noDeptLinkText:"Проверить",noDeptIcon:"informer-search-icon",metricType:"informerErrorAction",metricValue:n.additionsToShowMetric},isNotDebt:{noDeptCaptureText:"У вас нет неоплаченных задолженностей",noDeptLink:i.betaUrl+"pay",noDeptLinkText:"Подробнее",noDeptIcon:"informer-ok-icon",metricType:"informerPayAction",metricValue:n.additionsToShowMetric},LPageCreate:{noDeptCaptureText:"Подключите вашу организацию к порталу Госуслуг",noDeptLink:"/help/faq/yuridicheskim_licam/2202?personType=LEGAL",noDeptLinkText:"Подробнее",noDeptIcon:"informer-business-icon",metricType:"informerCreateAccount",metricValue:n.additionsToShowMetric},BPageCreate:{noDeptCaptureText:"Регистрация на портале в качестве ИП",noDeptLink:"/help/faq/registraciya-2181/2186",noDeptLinkText:"Подробнее",noDeptIcon:"informer-business-icon",metricType:"informerCreateAccount",metricValue:n.additionsToShowMetric},LPageEnter:{noDeptCaptureText:"Для поиска начислений и проверок войдите как сотрудник"+("mob"!==i.version?" организации":""),noDeptLink:i.lkUrl+"roles",noDeptLinkText:"Войти",noDeptIcon:"informer-business-icon",metricType:"informerLogin",metricValue:n.additionsToShowMetric},BPageEnter:{noDeptCaptureText:"Для поиска начислений и проверок войдите как"+("mob"!==i.version?" предприниматель или":"")+" сотрудник",noDeptLink:i.lkUrl+"roles",noDeptLinkText:"Войти",noDeptIcon:"informer-business-icon",metricType:"informerLogin",metricValue:n.additionsToShowMetric},FPageEnter:{noDeptCaptureText:"Для поиска новых начислений войдите как частное лицо",noDeptLink:i.lkUrl+"roles",noDeptLinkText:"Войти",noDeptIcon:"informer-person-icon",metricType:"informerLogin",metricValue:n.additionsToShowMetric},noEnoughRights:{noDeptCaptureText:"Недостаточно прав для просмотра начислений",noDeptLink:"/help/faq/yuridicheskim_licam/2761",noDeptLinkText:"О ролях в системе",noDeptIcon:"informer-no-icon",metricType:"informerNoEnoughRightsAction",metricValue:n.additionsToShowMetric}},g={"00":{link:i.lkUrl+"docs",text:"Укажите <span class='blue'>больше данных</span> для поиска начислений"},"01":{link:i.betaUrl+"pay?categories=stateDuty",text:"Оплатите <span class='blue'>пошлину по вашему заявлению</span>"},"02":{link:i.betaUrl+"pay?categories=stateDuty",textWithDay:"на <span class='blue'>оплату госпошлины</span>"},"03":{link:i.betaUrl+"pay?categories=fine",textWithDay:" на <span class='blue'>оплату со скидкой 50%</span>"},"04":{link:i.betaUrl+"pay?categories=fine",textWithDay:" на <span class='blue'>оплату штрафа</span>"},"05":{link:i.betaUrl+"pay?categories=fns",text:"Заплатите <span class='blue'>налоги</span>, на них начисляются пени"}};function h(e){n.noDeptCaptureText=m[e].noDeptCaptureText,n.noDeptLink=m[e].noDeptLink,n.noDeptLinkText=m[e].noDeptLinkText,n.noDeptIcon=m[e].noDeptIcon,n.metricType=m[e].metricType,n.metricValue=m[e].metricValue}function v(e){g[e].textWithDay?(1==u.days?n.hintText="Остался последний день ":n.hintText=o.getWord(u.days,"остался")+" "+u.days+" "+o.getWord(u.days,"день")+" ",n.hintText+=g[e].textWithDay):n.hintText=g[e].text,n.linkHint=g[e].link,n.mnemonicHint=e}function b(e){n.userRoles.includes(e)?h(e+"PageEnter"):h(e+"PageCreate")}function y(){n.informerLoading=!0,t.getInformerShort().then(function(e){e&&e.data&&e.data.error&&50===e.data.error.code?h("noEnoughRights"):e&&e.data&&e.data.result?(d=e.data.result,n.resultTotal=d.total,n.limitedLWithRight=!0,d.total&&(n.isDebt=!0,n.discountPrice=a("to_money_no_zero")(d.amount),d.originalAmount&&0!==d.originalAmount&&(n.price=a("to_money_no_zero")(d.originalAmount)),Object.keys(f).forEach(function(e){d[e]&&d[e].amount&&p.push(e)}),n.colNtypeAccruals="К оплате "+d.total+" "+o.getWord(d.total,1===p.length?f[p[0]].type:"начисление"),n.deptCount={},p.forEach(function(e){n.deptCount[e]=d[e].total}),n.totalDept=d.total,n.metricDataDeptShow={counter:d.total,types:n.deptCount,screen:n.usersDevice,role:n.usersRole}),e.data.hint?(u=e.data.hint,v(Object.keys(g).find(function(e){return u.code===e}))):"P"==i.userType&&v("00"),n.isDebt||(n.isAL1520?h("isNotDebt"):h("isAL10"))):(n.isError=!0,h("error"),console.log("informerSingle - error",e&&e.data&&e.data.error));e=e&&e.data||{};t.synchronizeFullAndShortInformers("short",e.error,e.result),n.informerLoading=!1}).catch(function(e){n.isError=!0,h("error"),n.informerLoading=!1,console.log("informerSingle - error",e)})}n.sendMetric=function(e,t){e&&(("P"!==i.userType&&"informerShow"!==e||"informerHistoryAction"===e)&&(t.user="L"===i.user.realOrgType?"UL":"B"===i.user.realOrgType?"IP":"OGV"),r.send(e,t),"informerCreateAccount"===e)&&r.legalEntitySend("Подключите вашу организацию","Подробнее")},n.userOnHisPage?y():"P"===i.userTypeGosBar?"F"===i.userType?(n.informerForF=!0,y()):h("FPageEnter"):"L"===i.userTypeGosBar?b("L"):"B"===i.userTypeGosBar&&b("B"),n.sendMetric("informerShow",n.metricDataDeptShow||n.additionsToShowMetric),e.getTargetPlaces("informer_banner").then(function(e){for(var t in e)n[t]=e[t].list,n[t+"_len"]=e[t].list?e[t].list.length:0,0==e[t].list.length&&(n[t]=e[t][t+"_bg"])})}t.$inject=["$scope","$rootScope","paymentAuth","FinesText","CMSService","$filter","ProfileTabService","MainPageMetric","RolesConfig"];var n="dk"===e.version?"/tpl/informerSingle-dk-8feea8908a.html":"pad"===e.version?"/tpl/informerSingle-pad-23c7d10a4c.html":"/tpl/informerSingle-mob-7dff67ce0e.html";return{restrict:"EA",templateUrl:e.templatePath+n,controller:t}}]).directive("informerKndNew",["$rootScope",function(){function e(e,o,a,s){e.selfClick=function(e){var t,n,i;return a.setKndFormPath(),"D"!==o.informerKnd.state&&(t="dk"===o.version?"desk":"pad"===o.version?"tab":"mob",n="L"===o.user.realOrgType?"UL":"B"===o.user.realOrgType?"IP":"OGV",i=o.informerKnd.informerData.entries,s.send("informerKNDAction",{last:i.amountLast,current:i.amountCurrent,upcoming:i.amountUpcoming,"user ":n,screen:t})),e.stopPropagation,!1},e.updateInformerState=function(e,t){"U"!=t&&(e.stopPropagation(),o.informerKnd.state="U",a.getInformerData().then(function(e){"F"!=(o.informerKnd=e).state&&"D"!=e.state&&(o.informerKnd.informerData.entries=o.informerKnd.getStatuses())}).catch(function(e){o.informerKnd.state="F",console.log("informerKndNew - error",e)}))}}e.$inject=["$scope","$rootScope","KndInformerService","MainPageMetric"];return{restrict:"EA",template:'<div class="block-informer-single md-height-80 sm-height-104 knd-block" data-ng-click="$root.informerKnd.state != \'F\' ? selfClick($event) : updateInformerState($event, $root.informerKnd.state)">   <div data-ng-class="{\'grid-wrap__row\': $root.version === \'mob\', \'height-100\': $root.version !== \'dk\'}">       <div class="grid-wrap__col-sm-5 flex-container flex-column justify-between" data-ng-class="{\'height-100\': $root.version === \'pad\'}">           <div class="grid-wrap__row flex-container height-100 align-items-center">               <div data-ng-if="$root.version !== \'pad\'" class="grid-wrap__col-lg-1 grid-wrap__col-md-3 grid-wrap__col-sm-1 lg-offset-top-16 lg-offset-bottom-16 md-offset-top-12 md-offset-bottom-8 sm-offset-top-16 sm-offset-bottom-12">                   <div class="knd-list-icon lg-offset-left-16 md-offset-left-16 sm-offset-left-16"></div>               </div>               <div data-ng-if="$root.version !== \'pad\'" class="{{$root.informerKnd.state == \'F\' ? \'grid-wrap__col-lg-4 grid-wrap__col-md-6\' : \'grid-wrap__col-lg-5 grid-wrap__col-md-9\'}} grid-wrap__col-sm-5 lg-offset-top-16 lg-offset-bottom-16 md-offset-top-12 sm-offset-top-16 sm-offset-bottom-12">                   <div class="lg-h-title-12 md-h-title-12-small sm-h-title-14 dark bold lg-offset-left-10 lg-offset-bottom-4 md-offset-bottom-8 sm-offset-left-24">{{$root.informerKnd.title}}</div>                   <div data-ng-if="$root.version == \'dk\'" class="lg-h-title-12 dark-gray lg-offset-left-10"><div data-ng-if="$root.informerKnd.state == \'U\'" class="loader-knd">{{$root.informerKnd.updateMessage}}</div><div data-ng-if="$root.informerKnd.state == \'D\'">{{$root.informerKnd.emptyMessage}}</div><div data-ng-if="$root.informerKnd.state == \'E\' && $root.informerKnd.informerData.entries.amountCurrent == 0 && $root.informerKnd.informerData.entries.amountUpcoming == 0 && $root.informerKnd.informerData.entries.amountLast != 0">Прошедшие - <b class="black">{{$root.informerKnd.informerData.entries.amountLast}}</b></div><div data-ng-if="$root.informerKnd.state == \'E\' && $root.informerKnd.informerData.entries.amountUpcoming != 0" class="inline-block lg-offset-right-16 md-offset-right-8 sm-offset-right-8">Будущие - <b class="black">{{$root.informerKnd.informerData.entries.amountUpcoming}}</b></div><div data-ng-if="$root.informerKnd.state == \'E\' && $root.informerKnd.informerData.entries.amountCurrent != 0" class="inline-block">Текущие - <b class="black">{{$root.informerKnd.informerData.entries.amountCurrent}}</b></div><div data-ng-if="$root.informerKnd.state == \'F\'">{{$root.informerKnd.errorMessage}}</div>                   </div>               </div>                              <div data-ng-if="$root.version === \'pad\'" class="{{$root.informerKnd.state == \'F\' ? \'grid-wrap__col-md-9\' : \'grid-wrap__col-md-12\'}} height-100 flex-container align-items-center">                   <div class="knd-list-icon md-offset-left-16 flex-0"></div>                   <div class="md-h-title-12-small dark bold md-offset-left-16">{{$root.informerKnd.title}}</div>               </div>                              <div data-ng-if="$root.informerKnd.state == \'F\'" class="grid-wrap__col-lg-1 grid-wrap__col-md-3 md-align-self-start lg-offset-top-16 lg-offset-bottom-16 md-offset-top-12 hide-for-sm">                   <div class="informer-knd-error md-offset-right-12 md-pull-right"></div>               </div>           </div>           <div class="grid-wrap__row">               <div data-ng-if="$root.version != \'dk\'" class="grid-wrap__col-md-12 grid-wrap__col-sm-6 md-h-title-12-small sm-h-title-12 dark-gray md-offset-left-16 md-offset-bottom-12 sm-offset-left-16 sm-offset-bottom-16"><div data-ng-if="$root.informerKnd.state == \'U\'" class="loader-knd">{{$root.informerKnd.updateMessage}}</div><div data-ng-if="$root.informerKnd.state == \'D\'">{{$root.informerKnd.emptyMessage}}</div><div data-ng-if="$root.informerKnd.state == \'E\' && $root.informerKnd.informerData.entries.amountCurrent == 0 && $root.informerKnd.informerData.entries.amountUpcoming == 0 && $root.informerKnd.informerData.entries.amountLast != 0">Прошедшие - <b class="black">{{$root.informerKnd.informerData.entries.amountLast}}</b></div><div data-ng-if="$root.informerKnd.state == \'E\' && $root.informerKnd.informerData.entries.amountUpcoming != 0" class="inline-block lg-offset-right-16 md-offset-right-8 sm-offset-right-8">Будущие - <b class="black">{{$root.informerKnd.informerData.entries.amountUpcoming}}</b></div><div data-ng-if="$root.informerKnd.state == \'E\' && $root.informerKnd.informerData.entries.amountCurrent != 0" class="inline-block">Текущие - <b class="black">{{$root.informerKnd.informerData.entries.amountCurrent}}</b></div><div data-ng-if="$root.informerKnd.state == \'F\'">{{$root.informerKnd.errorMessage}}</div>               </div>           </div>       </div>       <div data-ng-if="$root.version == \'mob\'" class="grid-wrap__col-sm-1">           <a data-ng-if="$root.informerKnd.state != \'F\'" class="text-link right-arrow sm-flex-container sm-align-items-center height-100 sm-offset-right-16 sm-h-title-14"></a>           <div data-ng-if="$root.informerKnd.state == \'F\'" class="informer-knd-error sm-offset-right-16 sm-offset-top-16"></div>       </div>   </div></div>',controller:e}}]).directive("informerRestrictions",["$rootScope","PerformanceService",function(e,i){function t(t,n,e){t.status="loading",t.map={error:{icon:"error",text:"Для проверки запрета<br>на выезд обновите страницу"},hasRestriction:{icon:"has-restriction",text:"Запрещён выезд из&nbsp;России"},hasNotRestriction:{icon:"has-not-restriction",text:'Нет запрета на выезд<br class="hide-for-md">из&nbsp;России'}},i.measureStart("restrictions-informer"),e.getRestrictionsInfo().then(function(e){200===e.status?t.status=e.data.hasRestrictions?"hasRestriction":"hasNotRestriction":204===e.status?n.restrictionEmbedded=!1:t.status="error",i.measureEnd("restrictions-informer","error"===t.status?1:0,{BrowserError:e.status,utm_source:e&&e.data&&e.data.hasRestrictions?"has_restriction":"no_restrictions"})}).catch(function(e){t.status="error",i.measureEnd("restrictions-informer",1,{BrowserError:e.status})})}return t.$inject=["$scope","$rootScope","Restrictions"],{restrict:"EA",templateUrl:e.templatePath+"/tpl/restrictions/restrictions-9fc26b2869.html",controller:t}}]),angular.module("epgu").directive("informerNotifyNew",["$location","$rootScope",function(d){function e(i,o,n,a,e,s,r,l){function c(){i.informer.state="U",e.getData().then(function(e){e&&e.data&&200==e.status&&(e=e.data).total&&parseFloat(e.total)?(i.informer.loading=!1,i.informer.state="E",i.informer.data.withDiscounts=e.originalTotal&&0!=e.originalTotal,e.list&&1==e.list.length?(i.informer.data.total=e.total?parseFloat(e.total):null,i.informer.data.originalTotal=e.originalTotal?parseFloat(e.originalTotal):null,i.informer.orderId=e.list[0].orderId,i.informer.link="/payment/"+e.list[0].uin):e.list&&1<e.list.length&&(i.informer.orderId=null,i.informer.orderIDCollection=[],e.list.forEach(function(e){e.orderId&&i.informer.orderIDCollection.push(e.orderId)}),i.informer.orderIDCollection)&&(i.informer.items=i.informer.orderIDCollection),i.informer.data.items=e.list):(i.informer.state="D",o.$emit("informerDutyDisabled")),i.informer.loading=!1})}"duty"===i.informer.code&&o.userId&&(o.informerDutyShow?c():i.informer.state="D"),i.scrollToAnchorLink=function(e,t){e&&e.preventDefault(),r(t),l(function(){r(t)},50)},i.selfClick=function(e,t,n){i.informer&&i.informer.code&&(e=e,t=t,o.userId&&"D"!==t?"duty"===e?"U"!=i.informer.state&&(i.informer.link?i.informer.orderId?d.path(i.informer.link).search({orderId:i.informer.orderId}):d.path(i.informer.link):(s.createCookie("orderIdPayment",i.informer.orderIDCollection),window.location=o.lkUrl+"notifications?type=ORDER")):d.url(a.setInformerResultPath(e,t)):i.informer.hash?i.scrollToAnchorLink(null,i.informer.hash):["gibdd","fns","fssp"].includes(e)?window.location="/auth/esia/?redirectPage="+encodeURIComponent(i.defaultLink):d.url(i.defaultLink))},i.updateInformerState=function(e,t){"D"==t.state?(i.selfClick(t.code,t.state),e.stopPropagation()):"U"!=t.state&&(e.stopPropagation(),"duty"==t.code?c():n.invalidateInformer(i.informer.code,"?refresh=true"))},i.getInformerItemsLen=function(e){return a.getInformerItemsLen(e)},i.setInformerCls=function(e){return o.userId||(e.state="D"),a.setInformerCls("informer-duty__item informer-duty__item--"+e.code,e)}}e.$inject=["$scope","$rootScope","FormServer","InformersService","DutyInformerService","ToggleCookie","$anchorScroll","$timeout"];return{restrict:"E",template:'<div class="informer-duty informer-duty-landing informer-item" data-ng-class="setInformerCls(informer)" data-ng-click="selfClick(informer.code, informer.state, $event);">   <div class="grid-wrap__row">       <div class="grid-wrap__col-lg-2 grid-wrap__col-md-4 grid-wrap__col-md-land-4 grid-wrap__col-sm-2">           <div data-ng-click="updateInformerState($event, informer)" class="informer-duty__image">               <div data-ng-if="informer.state !== \'D\'" class="hexagon">                   <svg class="hexagon__image" xmlns="http://www.w3.org/2000/svg" width="64" height="68" viewBox="0 0 48 52"><path d="M43.06 9.507s-3.176-2.352-7.164-4.684C31.906 2.488 28.308.875 28.308.875 25.9-.203 21.96-.203 19.553.875c0 0-3.6 1.613-7.588 3.948C7.975 7.155 4.8 9.507 4.8 9.507 2.672 11.08.702 14.537.42 17.187c0 0-.42 3.965-.42 8.632 0 4.666.42 8.63.42 8.63.283 2.65 2.253 6.108 4.378 7.68 0 0 3.177 2.353 7.167 4.688 3.99 2.332 7.588 3.945 7.588 3.945 2.407 1.078 6.347 1.078 8.755 0 0 0 3.597-1.613 7.587-3.945 3.99-2.335 7.166-4.688 7.166-4.688 2.127-1.572 4.097-5.03 4.38-7.68 0 0 .42-3.964.42-8.63 0-4.668-.42-8.632-.42-8.632-.283-2.65-2.253-6.108-4.38-7.68z" fill="#FFF"/></svg>                   <div class="hexagon__loading"></div>                   <div class="loader-state"></div>               </div>               <div data-ng-if="informer.state == \'D\'" class="{{$root.userId ? \'informer-duty__disabled-image\' : \'informer-duty__unlogined-image\'}}"></div>           </div>       </div>       <div class="grid-wrap__col-lg-6 grid-wrap__col-md-8 grid-wrap__col-md-land-12 grid-wrap__col-sm-4 flex-container flex-column justify-center">           <div>               <div class="lg-h-title-18-big md-h-title-18 sm-h-title-14 bold dark">{{title}}</div>               <div data-ng-if="informer.state == \'F\'" class="lg-h-title-16-big md-h-title-16 sm-h-title-14 offset-top-8 informer-error-message">{{errorMessage}}</div>           </div>           <div data-ng-if="informer.state != \'F\' && informer.state != \'U\'">               <div class="flex-container align-items-baseline offset-top-8 flex-wrap" data-ng-if="informer && informer.state == \'E\' && (getInformerItemsLen(informer.data.items) > 0 && informer.data.total && informer.data.total != 0)">                   <div class="lg-h-title-18-big md-h-title-18 sm-h-title-18 informer-total">                       {{informer.data.total | to_money_no_zero}}&nbsp;<nobr class="rouble">p</nobr>                   </div>                   <div data-ng-if="informer.data.withDiscounts && informer.data.originalTotal" class="informer-original-total">                       {{informer.data.originalTotal | to_money_no_zero}}&nbsp;<nobr class="rouble">p</nobr>                   </div>               </div>               <div data-ng-if="informer && informer.state == \'E\' && informer.code == \'duty\' && informer.items.length > 1" class="lg-h-title-16-big md-h-title-16 sm-h-title-14 offset-top-8 dark-gray underline">                   {{informer.items.length | dutyCounter}}               </div>               <div data-ng-if="informer && (informer.state == \'E\' && (getInformerItemsLen(informer.data.items) == 0 || informer.data.total == 0) || informer.state == \'H\')" class="lg-h-title-16-big md-h-title-16 sm-h-title-14 offset-top-8 dark-gray">                   {{successMessage}}               </div>               <div data-ng-if="informer && informer.state == \'D\'" class="lg-h-title-16-big md-h-title-16 sm-h-title-14 offset-top-8 dark-gray">{{defaultMessage}}</div>               <div class="offset-top-8">'+"                   <span class=\"text-link link-arrow\" data-ng-if=\"!(informer.code == 'duty' && informer.data.items.length != 1) && informer.code != 'receipt'\">{{informer.data.total && informer.data.total != 0 ? 'Перейти к оплате' : 'Проверить'}}</span>                   <span data-ng-if=\"informer.state == 'D' && (informer.code == 'receipt' || informer.code == 'duty')\" class=\"text-link dashed\" href=\"{{defaultLink}}\">Подробнее</span>               </div>           </div>       </div>   </div></div>",scope:{title:"@",informer:"=?",disabledMessage:"@",successMessage:"@",errorMessage:"@",updateMessage:"@",defaultMessage:"@",defaultLink:"@"},replace:!0,controller:e}}])}(),function(){"use strict";angular.module("epgu").directive("informerNotifyAdd",function(){function e(t,n){var i=[{code:"gibdd",title:"Штрафы"},{code:"fns",title:"Налоговая задолженность"},{code:"fssp",title:"Судебная задолженность"}];function o(){var e=i.filter(function(e){return"D"===n.informers[e.code].state});e.length===i.length?(t.shown=!0,t.title="Состояние задолженностей"):e.length?(t.shown=!0,t.title=e[Math.floor(Math.random()*e.length)].title):t.shown=!1}t.shown=!1,o(),n.$watch("informers.gibdd.state + informers.fns.state + informers.fssp.state",function(e,t){angular.equals(e,t)||o()})}return e.$inject=["$scope","$rootScope"],{restrict:"E",template:'<a ng-show="shown" ng-href="{{$parent.lkUrl}}notification-setup" class="epgu-informer-notify-add">   <div class="body">       <h4>{{title}}</h4>       <div>Подключите информирование и&nbsp;получайте актуальные данные <span class="text-link-arrow">&nbsp;</span></div>   </div></a>',replace:!0,controller:e}})}(),function(){"use strict";angular.module("epgu").directive("informerGepsHeader",[function(){function e(e,t,n,i){t.user.avatarLink=t.user.userAvatarLink||t.user.avatarLink,e.click=function(e){i.send("personHeader","avatar"),e.stopPropagation(),n.init()}}return e.$inject=["$scope","$rootScope","ShowLkFeeds","MainPageMetric"],{restrict:"E",controller:e,template:function(e,t){return"<"+(/span/.test(t.template)?"span":"a")+' data-ng-click="click($event)"        class="informer-notify-header informer-notify-header-show" data-ng-style=\'{"background-image": "url(" + $root.user.avatarLink + ")"}\' data-ng-class=\'{"avatar": $root.user.avatarLink}\'> \n        <span data-ng-if="$root.userCounters && $root.isLk" class="sub"\n           data-ng-show="$root.userCounters.total">{{$root.userCounters.total | ninety_nine}}</span>\n</'+("span"==t.template?"span":"a")+">"},replace:!0}}])}(),function(){"use strict";angular.module("epgu").directive("informerWithSetup",function(){function e(t,n,e,i,o,a){function s(){t.state="E"==n.informers[t.code].state||"F"==n.informers[t.code].state||"H"==n.informers[t.code].state,t.disabled=!1}s(),t.betaUrl=n.betaUrl,n.$watch("informers."+t.code+".state + informers."+t.code+".data.request",function(e,t){angular.equals(e,t)||s()}),t.toggle=function(){t.disabled=!0,t.canNotOn=!1,void 0!==t.reqActive&&t.reqActive++,t.state?(n.informers[t.code].state="U",e.deleteInformer(t.code,!0,function(){s(),void 0!==t.reqActive&&t.reqActive--,n.$apply()})):(n.informers[t.code].state="U",e.activateInformer(t.code,function(e){s(),t.canNotOn=Boolean(e),void 0!==t.reqActive&&t.reqActive--,n.$apply()}))},t.setInformerCls=function(e){return a.setInformerCls("epgu-informer-with-setup",e)},t.getInformerItemsLen=function(e){return a.getInformerItemsLen(e)},t.goToInformersResult=function(e,t,n){angular.element(n.target).parent().hasClass("angular-switcher")||(n=a.setInformerResultPath(e,t),e=o(n),window.location=e)}}return e.$inject=["$scope","$rootScope","FormServer","$location","beta_urlFilter","InformersService"],{restrict:"E",template:'<div data-ng-click="goToInformersResult(informer.code, informer.state, $event)" class="informer-with-setup-link" data-ng-class="setInformerCls(informer)">\n            <div data-ng-if="informer && (informer.state == \'U\' || disabled)" class="with-setup-throbber informer-update with-fines" data-throbber="throbber-small" data-show-heading="false"></div>\n            <div class="switcher">\n               <div data-ng-class="{off : !state}" data-ng-click="toggle()" class="cover angular-switcher">\n                   <div class="left">Вкл</div>\n                   <div class="movable"></div>\n                   <div class="right">Откл</div>\n               </div>\n            </div>            <div class="body">\n                <h4>{{title}}</h4>\n                <div data-ng-if="canNotOn" class="disabled-block" data-ng-transclude></div>\n                <div data-ng-if="informer && (informer.state == \'U\' || disabled)">{{updateMessage}}</div>\n                <div data-ng-if="informer && informer.state == \'E\' && (getInformerItemsLen(informer.data.items) == 0 || informer.data.total == 0)" class="empty-block">{{successMessage}}</div>\n                <div data-ng-if="informer && informer.state == \'E\' && (getInformerItemsLen(informer.data.items) > 0 && informer.data.total != 0)" class="result-block">               {{totalMessage}}{{informer.data.total.replace(\'.00\', \'\').replace(\' \', \'&nbsp;\')}}&nbsp;<nobr class="rouble">p</nobr></div>\n        <div data-ng-if="informer && informer.state == \'E\' && (getInformerItemsLen(informer.data.items) > 0 && informer.data.total != 0) && informer.data.withDiscounts" class="result-block-discounts">{{discountMessage}}</div>        <div data-ng-if="informer && informer.state == \'D\' && !disabled" class="plain-text">            {{disabledMessage}}        </div>\n        <div data-ng-if="informer && informer.state == \'H\'" class="plain-text">            {{disabledMessage}}        </div>\n                <div data-ng-if="informer && informer.state == \'F\'" class="error-block result-block">{{errorMessage}}</div>\n            </div><div class="disabler" data-ng-show="disabled || informer.state == \'U\'"></div>\n        </div>',scope:{title:"@",href:"@",informer:"=",reqActive:"=",code:"@",totalMessage:"@",disabledMessage:"@",successMessage:"@",errorMessage:"@",updateMessage:"@",discountMessage:"@"},transclude:!0,replace:!0,controller:e}})}(),function(){"use strict";angular.module("epgu").directive("inputSearch",["$rootScope","$document","$timeout",function(s,n,r){function e(i,o,e){var t,a=o.find("input");i.loading=!1,i.floating=void 0!==e.$attr.floating,i.id=IDSequence.get(),i.placeholder="Выберите область, округ, край или республику",i.select=function(e){e!==i.cur&&(i.cur=e),a.val(e.name),i.change({selected:e})},i.filter="",n.find("body").bind("click",function(){o.removeClass("opened"),i.filter="",s.$$phase||i.$apply()}),o.bind("click",function(e){var t;e.stopPropagation(),0<i.items.length&&(i._items||(i._items=i.items),angular.element(document).find(".epgu-selectbox.opened").filter(function(e,t){return 0===angular.element(t).find("#_epgu_el"+i.id).length}).removeClass("opened"),o.hasClass("opened")?(o.removeClass("opened"),t=o.find(".dropdown-el ul").find(e.target),i.filter="",s.$$phase||i.$apply()):(o.addClass("opened"),0<(t=(e=o.find(".dropdown-el ul")).find(".selected")).length&&e.scrollToElement(t,0,150)))}),a.bind("keydown",function(){clearTimeout(t),t=setTimeout(function(){var t,n,e=a.val();i.items=(t=e,e=i._items,n=[],angular.forEach(e,function(e){t&&e.name.toLowerCase().indexOf(t.toLowerCase())<0||n.push(e)}),n),o.addClass("opened"),r(function(){var e=o.find(".dropdown-el ul");e.find(".selected");e.scrollTop(0,150)},0),s.$$phase||i.$apply()},700)})}return e.$inject=["$scope","$element","$attrs"],{restrict:"E",replace:!0,scope:{items:"=",change:"&"},controller:e,template:'<div class="epgu-selectbox has_content" ng-class="{disabled : disabled, \'floating-placeholder\' : floating}"><label ng-if="title" for="_epgu_el{{id}}">{{title}}</label><div class="select-el" id="_epgu_el{{id}}"><input type="search" class="select-text" ng-class="{\'loading\' : loading}" placeholder="{{cur ? cur.name : placeholder}}"/></div><div class="dropdown-el"><ul><li ng-class="{selected : cur.name == item.name}" ng-repeat="item in items" ng-bind="item.name" ng-click="select(item)"></li></ul></div></div>'}}])}(),function(){"use strict";angular.module("epgu").directive("searchHelp",["$rootScope","$document","$timeout","$http","$location","userTypeService",function(s,e,o,r,l,c){function t(n,a,e){function t(e){var t;n.items.length&&(n.activeItem?(t=n.activeItem.code,"up"===e?t<=0?t=n.items.length-1:--t:t+1>=n.items.length||t<0?t=0:++t,n.activeItem=n.items[t],o(function(){var e,t,n,i,o;e=a.find("ul"),t=e[0].getBoundingClientRect(),n=t.top,t=t.height,i=e.find(".active")[0].getBoundingClientRect(),o=i.top,i=i.height,o<n?angular.element(e)[0].scrollTop+=o-n:n+t<o+i&&(angular.element(e)[0].scrollTop+=o+i-n-t)},100)):n.activeItem=n.items[0])}var i;n.items=[],n.floating=void 0!==e.$attr.floating,n.notFound=!1,n.select=function(){n.activeItem&&n.activeItem.href&&(a.removeClass("opened"),l.url(n.activeItem.href))},n.openDropdown=function(){n.filterModel&&2<n.filterModel.length&&n.items.length&&a.addClass("opened")},n.$on("body-click",function(e,t){angular.element(t).closest(a).length||a.removeClass("opened")}),n.mouseenterElement=function(e){n.activeItem=e},n.mouseleaveElement=function(){n.activeItem=!1},n.keyDownCallback=function(e){switch(e.keyCode){case 38:t("up");break;case 40:t("down");break;case 13:e.preventDefault(),n.select();break;case 27:a.removeClass("opened"),e.preventDefault()}},n.modelChange=function(){clearTimeout(i),i=setTimeout(function(){var o,t=n.filterModel;t&&0!==t.length?2<t.length?(o=c.getHeaderFilter()||c.getUserType().searchSputnikParam,r({method:"GET",url:s.ngAPI+"search",params:{q:t,t:"faq",s:100,serviceRecipient:o,_:Math.random()},withCredentials:!0}).success(function(e){var i;n.items=[],n.search=t,n.notFound=!1,e&&0<e.length?(i="gosuslugi.ru",n.items=e.map(function(e,t){var n=e.u+("all"!==o?"?personType="+o:"");return{href:n=n.substr(n.indexOf(i)+i.length),code:t,icon:e.i,title:e.t}})):n.notFound=!0,a.addClass("opened")})):a.removeClass("opened"):(n.items=[],a.removeClass("opened"))},400)},n.searchTrigger=function(){var e=function(e){e=e.replace(/  +/g," ");return 32<(e=e.split(" ")).length&&(e.length=32),e.join(" ")}(n.search);e&&o(function(){l.url("search?query="+e)},0)}}return t.$inject=["$scope","$element","$attrs"],{restrict:"E",replace:!0,scope:{label:"@"},controller:t,template:"<div class='fluid-wrap'>   <div class='row fluid-row'>       <div class='span_4 search-help service-text-bold'>Что вы ищете?</div>       <div class='span_18 col-12 col-6 epgu-selectbox search-data'             data-ng-class='{\"floating-placeholder\": floating, \"has_content\": filterModel}'>           <label data-ng-if='$root.version !== \"mob\"'>{{label}}</label>           <div class='serach-input select-el'>               <input type='text' class='select-text'                      data-ng-model='filterModel'                      data-ng-change='modelChange()'                      data-ng-focus='openDropdown()'                      data-ng-keydown='keyDownCallback($event)'                      placeholder='{{label}}'>               <div class='search-ico-container'>                   <div class='search-ico'></div>               </div>           </div>           <div class='dropdown-el'>               <ul>                   <li data-ng-class='{active: item.code === activeItem.code}'                        data-ng-repeat='item in items'                         data-ng-click='select(item)'                        data-ng-mouseleave='mouseleaveElement()'                        data-ng-mouseenter='mouseenterElement(item)'>                       <span data-ng-if='item.icon' class='icon'>{{item.title}}</span>                   </li>                   <li class='send-search' data-ng-class='{message : notFound}'>                       <div class='offset-bottom-extra-sm plain-text' data-ng-if='notFound'>Ничего не найдено</div>                       <div data-ng-click='searchTrigger()'>Посмотреть результаты поиска по сайту</div>                   </li>               </ul>           </div>       </div>   </div></div>"}}])}(),function(){"use strict";angular.module("epgu").directive("mobileHelper",function(){return{restrict:"E",template:'<div ng-class="{shown : show}" class="wrap_helper"><div class="coner"></div><div class="wrap_helper-inner"><div class=""><p ng-transclude></p></div></div></div>',transclude:!0,replace:!0,link:function(e,t,n){},scope:{show:"="}}})}(),function(){"use strict";angular.module("epgu").directive("avatar",[function(){function e(e,t,n,i){e.getAvatarImage=function(){return i.getAvatarImage()},i.afterLoad().then(function(){t.user.avatarLink=e.getAvatarImage()}),e.click=function(e){n.send("personHeader","avatar")}}return e.$inject=["$scope","$rootScope","MainPageMetric","UserService"],{restrict:"E",controller:e,template:function(e,t){return'<span data-ng-click="click($event)"        class="avatar-header" data-ng-style=\'{"background-image": "url(" + $root.user.avatarLink + ")"}\' data-ng-class=\'{"avatar": $root.user.avatarLink}\'> \n        <span data-ng-if="$root.userCounters" class="avatar-message-dot"\n           data-ng-show="$root.userCounters.total"></span>\n</span>'},replace:!0}}])}(),function(){"use strict";angular.module("epgu").directive("counter",[function(){function e(e){e.getCounterByType=function(e,t){return e&&"all"===e?t.total:e&&t[e]}}return e.$inject=["$scope"],{restrict:"E",controller:e,scope:{type:"=",counters:"="},template:function(e,t){return'<span data-ng-show="counters[type] > 0 && counters.total != 0" class="counter-container">{{getCounterByType(type, counters) | ninety_nine}}</span>'},replace:!0}}])}(),function(){"use strict";angular.module("epgu").directive("popupMap",["$rootScope","$http",function(s,r){return{restrict:"E",template:'<div>   <div class="popup_fade" data-ng-class="{\'modal-show\' : show}" data-sticky-top="50">\n        <div class="popup"><div class="map-popup-content-wrapper">\n            <div class="close_popup_x" ng-click="closePopup()"><b data-ng-if="$root.version == \'mob\'">Назад</b></div>\n           <h2 class="service-h3 bold">Место нарушения</h2>           <p class="plain-text"><span class="plain-text-bold">Адрес</span> {{address}}</p>            <div ng-if="show && !error">\n                <ya-map ya-options="{suppressMapOpenBlock: true}" ya-controls="" ya-center="{{center}}"  ya-zoom="16" ya-before-init="beforeInit($target)" ya-after-init="afterInit($target)">                   <ya-geo-object ya-source="geoObject" ya-options="'+("{iconLayout: 'default#image',iconImageOffset: [-19, -54], iconImageHref: '"+s.staticDomainUrl+"htdocs/img/pins_deep_blue-a9169a07a2.svg', iconImageSize:[38, 54],balloonPanelMaxMapArea: 0, hideIconOnBalloonOpen: false}")+'"></ya-geo-object>                </ya-map>            </div>            <div ng-show="error"><p>Недостаточно данных, чтобы показать на карте</p>               <span class="btn-base"  ng-click="show = false"><b>Продолжить</b></span>            </div>\n        </div></div>\n    </div></div>',scope:{show:"=",address:"@",closeFunc:"&?"},link:function(i,e,o){var a;$("#modal-container").append(a=e.find(".popup_fade")),o.id&&a.attr("id",o.id),~Object.keys(o).indexOf("hideBack")&&(i.hideBackButton=!0),e.on("$destroy",function(){a.remove()}),i.$watch("show",function(e,t){e!=t&&(i.$root.modalShow=!!e)}),i.closePopup=function(){i.closeFunc?i.closeFunc():i.show=!1},i.afterInit=function(e){e.behaviors.enable("scrollZoom"),e.controls.add("zoomControl",{float:"none",position:{right:10,top:"auto",bottom:40,left:"auto"}})},i.beforeInit=function(){var e=angular.element(window).height(),t=a.find(".popup"),n=a.find("ya-map");t.css({top:""}),n.css({height:""}),e<=2*parseInt(t.css("top"),10)+(n=t.outerHeight(!0))&&(Math.floor((e-n)/2),t.css({top:50})),r({url:s.nsiApi+"address/resolve",contentType:"application/json",data:JSON.stringify({address:[o.address]}),method:"POST",dataType:"json"}).then(function(e){(e=e.data)&&!e.error&&0<e.coords.length&&(e=e.coords[0]).longitude&&e.latitude?(e=[e.longitude,e.latitude],i.center=e,i.geoObject={geometry:{type:"Point",coordinates:e}}):i.error=!0},function(){i.error=!0})}},replace:!0}}]).directive("simpleMap",["$rootScope","$http","CoordsService",function(e,t,i){return{scope:{address:"@",mapObj:"=?",mapWidth:"@",mapHeight:"@",mapMinWidth:"@",mapMinHeight:"@",errorState:"=?",loadState:"=?",dragDisable:"@"},link:function(t,e,n){t.afterInit=function(e){e.behaviors.enable("scrollZoom"),e.controls.add("zoomControl",{size:"auto",float:"none",position:{right:10,top:10,bottom:"auto",left:"auto"}}),"true"===t.dragDisable&&e.behaviors.disable("drag")},t.loadState=!0,t.beforeInit=function(){t.mapObj&&t.mapObj.center?(t.center=t.mapObj.center,t.geoObject=t.mapObj.geoObject||{},t.loadState=!1):i.get([t.address],!0).then(function(e){if((e=e.data)&&!e.error&&0<e.coords.length){e=e.coords[0];if(!e.longitude||!e.latitude)return void(t.errorState=!0);e=[e.longitude,e.latitude];t.center=e,t.geoObject={geometry:{type:"Point",coordinates:e}},t.mapObj={center:t.center,geoObject:t.geoObject}}else t.errorState=!0;t.loadState=!1},function(){t.errorState=!0,t.loadState=!1})}},template:'<div ng-style="{width: mapWidth, height: mapHeight, \'min-width\': mapMinWidth, \'min-height\': mapMinHeight}">   <div data-ng-if="loadState" class="content-in-center">       <div data-throbber="throbber-big" data-show-heading="false"></div>   </div>   <div data-ng-show="!errorState && !loadState">       <ya-map ya-options="{suppressMapOpenBlock: true}"                ya-controls=""                ya-center="{{center}}"                 ya-zoom="14"                ya-before-init="beforeInit($target)"                ya-after-init="afterInit($target)"               ng-style="{width: mapWidth, height: mapHeight, \'min-width\': mapMinWidth, \'min-height\': mapMinHeight}">           <ya-geo-object ya-source="geoObject" ya-options="'+("{iconLayout: 'default#image',iconImageOffset: [-19, -54], iconImageHref: '"+e.staticDomainUrl+"htdocs/img/pins_deep_blue-a9169a07a2.svg', iconImageSize:[38, 54],balloonPanelMaxMapArea: 0, hideIconOnBalloonOpen: false}")+'"></ya-geo-object>       </ya-map>   </div></div>'}}])}(),function(){"use strict";angular.module("epgu").directive("popupMapSearch",["$rootScope","$timeout",function(s,r){return{restrict:"E",template:'<div><div class="filter-modal-wrap"><div class="filter-modal-container"><div class="button-block filter-modal-item"><a data-ng-href="" data-ng-click="setBackPath()" class="button-modal button-medium button-white button-icon-before button-long-mob button-medium-arrow-left-blue">Назад</a></div><div class="search-map-filter-wrap filter-modal-item" data-ng-class="(activeSection.isActive != \'showMobileAdditionalInfo\') ? \'\' : \'full-screen\'"><div class="smart-map-throbber" data-ng-if="!hideThrobber" data-throbber="throbber-big" data-show-heading="true"></div><search-filter-map ng-if="activeSection" offices="offices" active-section="activeSection.isActive" loading="toggleThrobber()"></search-filter-map></div><div data-ng-if="activeSection.isActive != \'showMobileAdditionalInfo\'" class="filter-modal-item"><div class="filter-modal-controls"><a data-ng-repeat="state in buttonStates" data-ng-href="" data-ng-class="{\'active\' : state.active}" data-ng-click="btnSearchHandler(state)" class="filter-modal-controls-item filter-modal-{{state.cls}}-btn"><span></span></a></div></div></div></div></div>',scope:{show:"=",offices:"=",loading:"&"},link:function(i,e,t,n,o){var a=$("#modal-container-search");a.empty()&&a.append(e.find(".filter-modal-wrap")),i.toggleThrobber=function(){i.hideThrobber=!0},i.buttonStates=[{active:!1,id:"list",cls:"list"},{active:!0,id:"geo",cls:"geo"},{active:!1,id:"search",cls:"search"}],i.activeSection={isActive:i.buttonStates[1].id,last:"geo",showFilterModal:!1},i.clearSelectedBtn=function(){angular.forEach(i.buttonStates,function(e){e.active=!1})},i.btnSearchHandler=function(e){i.clearSelectedBtn(),e.active=!0,i.activeSection.isActive=e.id,i.activeSection.last=e.id,r(function(){$(".ya-map-template-wrap").hide().fadeIn("fast")},10)},i.setBackPath=function(){"showMobileAdditionalInfo"==i.activeSection.isActive?i.activeSection.isActive=i.activeSection.last:(i.clearSelectedBtn(),i.activeSection.showFilterModal=!i.activeSection.showFilterModal,i.activeSection.isActive=i.buttonStates[1].id,i.buttonStates[1].active=!0,i.activeSection.last="geo",r(function(){return s.popupSearchModalShow=!1,window.history.back(),!1},0))},i.$on("$locationChangeStart",function(e,t,n){"showMobileAdditionalInfo"==i.activeSection.isActive&&(i.activeSection.isActive=i.activeSection.last,e.preventDefault())}),i.$on("$locationChangeSuccess",function(e,t,n){-1<n.indexOf("#map")&&(s.popupSearchModalShow=!1)})}}}])}(),function(){"use strict";angular.module("epgu").directive("popupModal",["$rootScope",function(o){return{restrict:"E",template:'<div>       <div class="popup_fade {{className}}" data-ng-class="{\'modal-show\' : show}">\n           <div class="popup">\n               <b class="close_popup_x" ng-click="closePopup($event)"><span class="mobile-close text-link link-btn view-iphone">Назад</span></b>\n               <div ng-transclude></div>\n               <b ng-show="!hideBackButton" class="close_popup_bottom view-iphone" ng-click="show = false">Вернуться назад</b>\n           </div>\n       </div>\n      </div>',scope:{showGosbar:"=",closeOnDestroy:"=",show:"=",hideBack:"=",close:"&",className:"@",removeGosBar:"="},replace:!1,transclude:!0,link:function(n,e,t){var i;$("#modal-container").append(i=e.find(".popup_fade")),t.id&&i.attr("id",t.id),~Object.keys(t).indexOf("hideBack")&&(n.hideBackButton=!0),e.on("$destroy",function(){n.closeOnDestroy&&(o.modalShow=!1),i.remove()}),n.toggleGosBar=function(e){n.removeGosBar&&(o.hideModalGosBar=e)},n.$watch("show",function(e,t){e!=t&&(e?(n.toggleGosBar(!0),n.$root.modalShow=!0,n.showGosbar&&(o.showModalGosbar=!0)):(n.toggleGosBar(!1),n.$root.modalShow=!1,o.showModalGosbar=!1))}),n.closePopup=function(e){e.preventDefault(),e.stopPropagation(),o.$emit("popupCloseEvent"),n.show=!1,n.close()&&"function"==typeof n.close()&&n.close().call()}}}}])}(),function(){"use strict";angular.module("epgu").directive("popupSearch",[function(){function e(e,t,n,i,o,a,s,r,l,c){1==e.popupSettings.needScroll&&window.addEventListener("scroll",function(){function e(e){return e.getBoundingClientRect().top}var t=document.getElementById("footer-wrapper"),n=document.getElementById("popupSearch");t&&n&&(e(n)+document.body.scrollTop+n.offsetHeight>=e(t)+document.body.scrollTop-75&&n.classList.add("stopped"),document.body.scrollTop+window.innerHeight<e(t)+document.body.scrollTop)&&n.classList.remove("stopped")}),e.sendData=function(){return e.popupSettings.send=!0,c({method:"POST",url:i.bigBroUrl+e.popupSettings.url,data:e.popupSettings.data,cache:!1,withCredentials:!0,params:{_:Math.random()}})},e.close=function(){e.popupSettings.showSearchPopup=!1}}return e.$inject=["$scope","$element","$attrs","$rootScope","$location","$window","$document","$timeout","$moment","$http"],{restrict:"E",controller:e,replace:!0,scope:{popupSettings:"=",model:"="},transclude:!0,template:'<div class="d-popup-search"><div class="popup-search__wrap {{popupSettings.send ? \'feedback-sended-wrap\' : \'\'}}"><div class="search-modal"><div class="md-title-22  sm-title-18 {{popupSettings.send ? \'lg-title-18 bold\' : \'lg-offset-bottom-24 md-offset-bottom-24 sm-offset-bottom-20 lg-title-22\'}}"> <div class="feedback-sended-icon" data-ng-if="popupSettings.send"></div><span class="{{popupSettings.send ? \'feedback-sended-title\' : \'\'}}">{{popupSettings.send ? popupSettings.sendTitle : popupSettings.title}}</span></div><div data-ng-if="!popupSettings.send" class="align-center"><input type="text" class="lg-offset-bottom-24 md-offset-bottom-24 sm-offset-bottom-20" maxlength="1000" placeholder="{{popupSettings.placeholder}}" data-ng-model="popupSettings.data.text"/><input type="button" data-ng-click="sendData()" class="button-base button-small button-blue button-long-phone" data-ng-disabled="!popupSettings.data.text || popupSettings.data.text.length == 0 || popupSettings.data.text.length > 1000" value="{{popupSettings.buttonText}}" /></div><div data-ng-click="close()" class="close-search-modal"></div></div></div></div>'}}])}(),function(){"use strict";angular.module("epgu").directive("searchModal",[function(){function e(e,t,n,o,i,a,s,r){var l;e.$on("search-modal-click",function(e,t,n){n.isTouch,l=n.isClick;var i=s.find(".select-text")[0];i&&o.searchModalShow&&r(function(){i.focus()},500),l&&o.searchModalShow&&t&&"-1"!=["close-search-modal","search-modal-screen"].indexOf(t.target.className)&&r(function(){o.searchModalShow=!1},0)}),$("body").append('<div class="search-modal-screen"></div>'),e.closeSearchModal=function(){o.searchModalShow=!o.searchModalShow},e.getSearch=function(e){e&&r(function(){"/search"===i.path()&&o.$emit("updateSearchPage",e),i.path("/search").search("query",e)},0),o.searchModalShow=!1},angular.element(a).bind("scroll",function(){0<a.pageYOffset&&!e.isScrolled?(e.isScrolled=!0,e.$digest()):0==a.pageYOffset&&e.isScrolled&&(e.isScrolled=!1,e.$digest())})}return e.$inject=["$scope","$element","$attrs","$rootScope","$location","$window","$document","$timeout"],{restrict:"E",controller:e,replace:!0,transclude:!0,template:'<div class="search-modal-wrap"><div id="search-modal" class="content-center-box search-modal"><div class="searchBox" ng-transclude></div><div data-ng-click="closeSearchModal()" class="close-search-modal"></div></div></div>'}}])}(),function(){"use strict";angular.module("epgu").controller("EzpSubscriptionController",["$scope","$rootScope","RegionService","$http","$location","LkService","MailDeliveryService","userTypeService","PerformanceService",function(i,o,e,t,n,a,s,r,l){i.current={value:void 0},i.popupType="P"===o.userType?"person":"business";var c=s.deliveryStatusObj&&s.deliveryStatusObj.data,d=(i.ezpMessage=c&&c.hint&&c.hint.popup,i.ezpMobMessage=c&&c.hint&&c.hint.mobilePopup,i.agreeUrl=c&&c.hint&&c.hint.url,i.deliveryStatus=c&&c.status,i.ngDialogData.depts&&i.ngDialogData.depts.length&&(i.depts=i.ngDialogData.depts.filter(function(e){return"EZP_COPY"!==e.code})),i.withPR=i.depts&&i.depts.length&&"PR"===i.depts[i.depts.length-1].code,[]);i.sendEzpStatus=function(t){if("REMIND_LATER"===t||"DENY_SUBSCRIPTION"===t)d=i.depts.map(function(e){return e.code});else if("person"===i.popupType&&i.noAddresses)return void i.redirectToLk();i.statusSending=!0;var n="/api/lk/geps/subscription/v2/";l.measureStart(n),s.updateMultiSubscriptionState(d,t,i.addresses).then(function(){i.closeThisDialog(),i.statusSending=!1,l.measureEnd(n,0,{userType:o.healthUserTypes[o.userType]})},function(e){"REMIND_LATER"!==t&&"DENY_SUBSCRIPTION"!==t||i.closeThisDialog(),i.ezpSendError=!0,i.statusSending=!1,l.measureEnd(n,1,{userType:o.healthUserTypes[o.userType],BrowserError:e?.status})})},i.withPR&&"person"===i.popupType&&s.getDeliveryAddresses(function(e){e&&e.messageCode&&("error.service.internal"===e.messageCode||"service.error.rp.snils.invalid"===e.messageCode)&&(i.isNewUser=!0),i.addresses=[],i.gepsAddresses=[];var n=[];e&&e.addresses&&e.addresses.length&&(e.addresses.forEach(function(e){i.addresses.push(e)}),i.addresses=e.addresses),o.user.addresses&&o.user.addresses.length&&(i.userAddresses=[],o.user.addresses.forEach(function(e){var t=s.makeFullAddressFromEsia(e,"ESIA","popup");i.userAddresses.some(function(e){return e.asString===t})||(n.push(t),i.userAddresses.push({asString:t}))}),i.addresses.length&&i.addresses.forEach(function(e){n.indexOf(e.asString)<0&&i.gepsAddresses.push(e)}),i.addresses=i.gepsAddresses.concat(i.userAddresses)),i.addressesLoaded=!0,i.noAddresses=!i.addresses.length}),i.redirectToLk=function(){i.closeThisDialog(),location.href=o.lkUrl+"mail/delivery"},i.changeCheckbox=function(e,t){var n=d.indexOf(t);-1<n?d.splice(n,1):d.push(t)}}])}(),function(){"use strict";angular.module("epgu").directive("headerInfoBar",["$rootScope","$q","SelectedOccasion",function(e,t,c){function n(o,e,t,n,a,i){function s(e){console.log("error",e)}function r(i){function e(t,n){var e=i.options.filter(function(e){return e[t]==n});o.userInfo=e[0]}a.logined?"P"===a.userType?e("assuranceLevel",a.assuranceLevel):"B"===a.userType?e("userType","B"):"L"===a.userType&&e("userType","L"):e("logined",!1)}function l(e){if(o.data){e&&(a.changeHeaderFilter=e);var t=function(t){angular.forEach(o.data,function(e){e.catalogType===t&&r(e)})};switch(a.changeHeaderFilter||a.userType||a.userTypeGosBar){case"P":t("P");break;case"B":t("B");break;case"L":t("L");break;default:t("P")}}}i.getHeaderInfoBarInfo().then(function(e){e&&e.data?(o.data=e.data,l()):s(e)},function(e){s(e)}),o.$watch(function(){return a.changeHeaderFilter},function(){a.changeHeaderFilter&&(c.clear(),l())},!0),o.userTypeObj=n.getUserType(),o.setUserConfig=function(){var t=n.getHeaderFilter();o.config={list:o.userTypeObj.list.filter(function(e){return"PA"!=e.userTypeGosBar}),setModel:function(){angular.forEach(o.userTypeObj.list,function(e){t&&e.userTypeGosBar==o.userTypeObj.userTypeGosBar?o.config.userTypeObj=t:e.userTypeGosBar==o.userTypeObj.userTypeGosBar&&(o.config.userTypeObj=e)})},changeUserType:function(e){n.saveHeaderFilter(e),n.setUserType(e),o.config.userTypeObj=e}},setTimeout(function(){o.config.setModel(),o.$apply()})},o.$watch(function(){return a.userTypeGosBar},function(){o.setUserConfig(),l(a.userTypeGosBar),a.changeHeaderFilter&&e.search("personType",null)},!0)}return n.$inject=["$scope","$location","eventService","userTypeService","$rootScope","CatalogService"],{restrict:"A",templateUrl:window.templatePath+(SmartPhone.isAny()?SmartPhone.isPhone()?"/tpl/components/header-info-bar-mob-d17dd36485.html":"/tpl/components/header-info-bar-pad-3a1eb39584.html":"/tpl/components/header-info-bar-159b5e5ff1.html"),replace:!0,scope:{title:"@",faqLink:"="},controller:n}}])}(),function(){"use strict";angular.module("epgu").directive("qhelper",function(){return{restrict:"E",template:'<i class="q">?   <span class="Q-PopupHintOuterArrow"></span>   <span class="Q-PopupHintOuter">       <span class="Q-PopupHintContent">           {{text ? text : $root.throbber.header}}       </span>   </span></i>',replace:!0,scope:{text:"@"}}})}(),function(){"use strict";angular.module("epgu").directive("articleFeedback",["CMSService","$log","$location",function(t,n,i){return{restrict:"E",scope:{resource:"="},controller:["$scope",function(e){angular.extend(e,{loading:!1,alreadyVotedThisSession:!1,vote:function(e){this.startLoading(),t.voteForResource("faq",this.resource?this.resource.code||this.resource.id:"",e,i.absUrl()).then(this.onSuccessVoting.bind(this),this.onVotingProblem.bind(this))},voteYes:function(){this.vote(1)},voteNo:function(){this.vote(-1)},onSuccessVoting:function(e){this.endLoading(),e&&200==e.status?this.markAlreadyVoted():this.onVotingProblem(e)},onVotingProblem:function(e){this.endLoading();e=e&&(e.text||e.message||e.statusText);n.error("Error raised during article feedback voting: "+e),this.markAlreadyVoted()},startLoading:function(){this.loading=!0},endLoading:function(){this.loading=!1},markAlreadyVoted:function(){this.alreadyVotedThisSession=!0}})}],templateUrl:window.templatePath+"/tpl/directives/article-feedback-0af9b2feb7.html"}}])}(),function(){"use strict";angular.module("epgu").directive("starRating",function(){function e(n,t,e,i,o,a){var s;n.ratingObj={disabled:!0,disabledStars:!1,commentingDisabled:!1,loading:!1,star:null,thanks:!0,message:"",show:function(){t.disableMetric||metricReachGoal("star_rating_show"),n.ratingObj.showRating=!0},change:function(e){n.ratingObj.disabled=!1,5===e?(n.ratingObj.message="",n.ratingObj.commentingDisabled=!0):n.ratingObj.commentingDisabled=!1},lockOnSend:function(){n.ratingObj.loading=!0,n.ratingObj.disabled=!0,n.ratingObj.disabledStars=!0},unlockOnSuccess:function(){n.ratingObj.loading=!1,n.ratingObj.disabled=!0,n.ratingObj.disabledStars=!0},unlockOnError:function(){n.ratingObj.loading=!1,n.ratingObj.disabled=!1,n.ratingObj.disabledStars=!1},getCurrentRating:function(){if(n.rateReader)return this.lockOnSend(),n.rateReader().then(function(e){n.ratingObj.star=e,n.ratingObj.loading=!1,e&&(n.ratingObj.disabled=!0,n.ratingObj.disabledStars=!0)},function(e){n.ratingObj.unlockOnError()})},save:function(){var t=this;return this.lockOnSend(),s=this.star,n.rateWriter?n.rateWriter()(this.star,this.message).then(function(e){n.ratingObj.finished=s,t.unlockOnSuccess()},t.onFail.bind(t)):e.sendStarRating(n.detail.message.skufId,this.star,this.message).then(t.onSuccess.bind(t),t.onError.bind(t))},onSuccess:function(e){e&&200===e.status?(t.disableMetric||metricReachGoal("star_rating_complete",{feedback_mark:s}),this.unlockOnSuccess(),n.ratingObj.showRating=!1,t.modalShow=!1,i.reload()):n.ratingObj.onError(e)},onError:function(e){t.disableMetric||metricReachGoal("star_rating_error"),this.onFail(e)},onFail:function(){this.unlockOnError(),n.ratingObj.error={title:"Ваша оценка не была сохранена!",message:"Во время сохранения вашей оценки возникла ошибка. Пожалуйста попробуйте еще раз."}},clear:function(e){console.log(e),n.ratingObj.loading=!1,n.ratingObj.showRating=!1,n.ratingObj.error=!1}},n.detail.feedbackNps&&!n.detail.allowNps&&(n.ratingObj.finished=n.detail.feedbackNps.evaluation,n.ratingObj.disabledStars=!!n.ratingObj.finished),o.showRating&&n.detail.allowNps&&a(function(){n.ratingObj.show()})}return e.$inject=["$scope","$rootScope","LkService","$route","$routeParams","$timeout"],{restrict:"E",scope:{detail:"=",details:"=",loading:"=",error:"=",title:"@",embedded:"=",noComments:"=",noLabels:"=",theme:"@",rateReader:"&?",rateWriter:"&?"},controller:e,templateUrl:window.templatePath+"/tpl/directives/star-rating-6bbfb67a01.html",replace:!0}})}(),function(){"use strict";angular.module("epgu").directive("searchFilterMap",["$filter","$rootScope","makeAddressService","CoordsToAddress","templateLayoutFactory","$timeout",function(n,i,o,e,a,s){return{restrict:"E",replace:!0,templateUrl:window.templatePath+(SmartPhone.isAny()?SmartPhone.isPhone()||SmartPhone.isIPhone()?"/tpl/structure/structure-info-map-mob-f3139318c8.html":"/tpl/structure/structure-info-map-pad-41e85dc36d.html":"/tpl/structure/structure-info-map-d20c2bf9ca.html"),scope:{offices:"=",loading:"&",activeSection:"="},link:function(r,e,t){r.overridesBalloon={build:function(){a.get("templateOrganizer").superclass.build.call(this),angular.element(document.getElementById("map-arrow-link")).bind("click",this.arrowClick)},arrowClick:function(){r.activeSection="showMobileAdditionalInfo"}},r.officesWithCoords=[],r.userFilter={},r.copyOffices=r.offices,r.copyCoordsOffices=r.officesWithCoords,r.initialStateGeo=!0,r.currentCoords=[],r.createGeoObject=function(e,t,n,i,o,a){var s;e.geoObject={geometry:{type:"Point",coordinates:[o,a]},properties:{title:n,address:i,contacts:e.contacts.phone||" Не указано",schedule:e.schedule||" Не указано",person:e.contactpersons,balloonContentHeader:n,balloonContentBody:(n=e.contacts.phone||" Не указано",s=e.schedule||" Не указано","<p>Адрес: "+i+"</p><p>Контакты: "+n+"</p><p>Режим работы: "+s+"</p>")},numId:t},o&&a||(e.geoObject.isNotFound=!0),e.marker=e.geoObject,o&&a&&r.officesWithCoords.push(e)},r.offices.forEach(function(e,t){e.addressString=o.getAddress(e.address),e.numId=t,e.latitude&&e.longitude&&r.createGeoObject(e,t,e.title,e.addressString,e.longitude,e.latitude)}),r.onFilterChange=function(e){r.removeInfoColumn(),r.offices=n("filter")(r.copyOffices,e),r.officesWithCoords=n("filter")(r.copyCoordsOffices,e)},r.clearSelectedOffice=function(){angular.forEach(r.offices,function(e){e.isActive=""})},r.setCenterMap=function(e){for(var t=0,n=r.offices.length;t<n;){var i=r.offices[t].latitude,o=r.offices[t].longitude;if(i&&o){e.setCenter([o,i]);break}t++}},r.afterMapInit=function(n){r.setCenterMap(n),r.loading(),n.behaviors.enable("scrollZoom"),n.controls.add("zoomControl",{float:"none",position:{right:10,top:"mob"!=i.version?190:80,left:"auto"}}),n.balloon.events.add("userclose",function(e){e.get("target").options.set({iconImageHref:i.staticDomainUrl+"htdocs/img/pins_deep_blue-a9169a07a2.svg"}),r.showBalloon=!1,r.clearSelectedOffice(),r.showAdditionalInfo=!1}),n.balloon.events.add("open",function(e){e.get("target").options.set({iconImageHref:i.staticDomainUrl+"htdocs/img/pins_light_blue-03106d9ae8.svg"}),r.lastBalloon=e.get("target")}),n.balloon.events.add("close",function(e){e.get("target").options.set({iconImageHref:i.staticDomainUrl+"htdocs/img/pins_deep_blue-a9169a07a2.svg"})}),n.geoObjects.events.add("click",function(e){e=e.get("target");e.balloon&&!e.balloon.isOpen()&&e.options.set({iconImageHref:i.staticDomainUrl+"htdocs/img/pins_light_blue-03106d9ae8.svg"}),r.lastBalloon&&r.lastBalloon.options.set({iconImageHref:i.staticDomainUrl+"htdocs/img/pins_deep_blue-a9169a07a2.svg"}),r.lastBalloon=e}),n.events.add("boundschange",function(e){e.get("newZoom")!=e.get("oldZoom")&&r.setMapOnBoundChange()}),r.setMapOnBoundChange=function(){0!=r.currentCoords.length&&(n.setCenter(r.currentCoords,25,{checkZoomRange:!0}),s(function(){var e;"object"==typeof n.getGlobalPixelCenter()&&(e=n.getGlobalPixelCenter()),"dk"==i.version?n.setGlobalPixelCenter([e[0],e[1]-100]):"pad"==i.version?n.setGlobalPixelCenter([e[0]-40,e[1]-160]):n.setGlobalPixelCenter([e[0]+103,e[1]-60])}))},r.runBalloon=function(t,e){n.balloon.close(!0),"mob"!=i.version&&e.isActive||(r.activeSection="showMobileAdditionalInfo",r.clearSelectedOffice(),e.isActive=!e.isActive,r.showWarning=!1,!t||t.isNotFound?(r.timeoutCenterMap&&s.cancel(r.timeoutCenterMap),r.showBalloon=!1,r.showAdditionalInfo=!1,r.showWarning=!0):(r.currentCoords=[t.geometry.coordinates[0],t.geometry.coordinates[1]],n.setCenter(r.currentCoords,25,{checkZoomRange:!0}),r.timeoutCenterMap=s(function(){var e;"object"==typeof n.getGlobalPixelCenter()&&(e=n.getGlobalPixelCenter()),"pad"==i.version?n.setGlobalPixelCenter([e[0]-35,e[1]+5]):"mob"==i.version&&n.setGlobalPixelCenter([e[0]+35,e[1]]),"mob"!=i.version&&s(function(){r.showBalloon=t},400)},100)),r.setAdditionalInfo(e))},r.baloonClick=function(t){r.currentCoords=[t.geometry.coordinates[0],t.geometry.coordinates[1]],r.removeInfoColumn(),angular.forEach(r.offices,function(e){e.isActive="",e.numId==t.numId&&(e.isActive||r.setAdditionalInfo(e),e.isActive=!e.isActive)}),"pad"!=i.version&&"dk"!=i.version||r.scrollToPin(t)}},r.scrollToPin=function(e){var t=angular.element(".point-list"),n=t.offset().top,e=angular.element("#point-"+e.numId).offset().top;t.animate({scrollTop:e-n+t.scrollTop()},"fast")},r.removeInfoColumn=function(){r.showAdditionalInfo=!1,r.showWarning=!1,r.clearSelectedOffice()},r.setAdditionalInfo=function(e){var t;r.showAdditionalInfo=!0,r.pinTitle=e.title,r.pinAddress=e.addressString,r.pinContactsPhone=e.contacts.phone,r.pinContactsFax=e.contacts.fax,r.pinSchedule=e.schedule,r.pinExpeditionSchedule=e.expeditionSchedule,r.pinOrgInn=e.inn,r.pinOrgOgrn=e.officeOgrn,r.pin={contacts:e.contacts},e.contactpersons&&0<e.contactpersons.length&&(r.pinPersons=e.contactpersons),e.financialDetails&&0<e.financialDetails.length&&e.financialDetails&&(t=[],e.financialDetails.forEach(function(e){Object.keys(e).length&&t.push(e)}),r.pinFinancialDetails=t)}}}}])}(),function(){"use strict";angular.module("epgu").directive("radioItem",function(){function e(e){e.valueObj&&(e.value=e.valueObj)}return e.$inject=["$scope"],{controller:e,restrict:"E",template:'<div class="radio-group-item"><div class="radio-label" data-ng-click="select()" data-ng-class="{\'checked\' : model == value,  \'epgu-radio-disabled\': disabled}">   <span class="icon"></span><div class="radio-content" data-ng-bind-html="label | to_trusted"><span data-ng-transclude></span></div></div></div>',replace:!0,transclude:!0,scope:{model:"=",value:"@",valueObj:"=",label:"@",disabled:"=",change:"&"},link:function(e,t,n){e.id=IDSequence.get(),e.select=function(){e.disabled||(e.model=e.value,e.change&&"function"==typeof e.change&&e.change({value:e.model}))}}}})}(),function(){"use strict";angular.module("epgu").directive("radioItems",function(){return{restrict:"E",template:'<div class="radio-group-item"><input id="{{id}}" type="radio" ng-model="model" ng-value="value"><label for="{{id}}" onclick=""><span class="icon"></span>{{label}}</label></div>',replace:!0,scope:{model:"=",value:"@",label:"@"},link:function(e,t,n){e.id=IDSequence.get()}}})}(),function(){"use strict";angular.module("epgu").directive("region",["$compile",function(e){function t(t,n,e){function i(){e.get().then(function(e){n.$$phase?(t.selectedRegion=e,n.selectedRegion=t.selectedRegion):t.$apply(function(){t.selectedRegion=e,n.selectedRegion=t.selectedRegion})})}i(),t.select=function(){window.isEmbeddedZkh?window.SMUAdapter.notify({eventType:"regionSelect",eventParams:[]}):n.$broadcast("region-select")},n.$on("region-changed",function(e,t){i()})}return t.$inject=["$scope","$rootScope","RegionService"],{restrict:"E",template:function(e,t){var n='<a class="location-container-link" ng-click="select()"><span class="location-container-title">{{selectedRegion.title}}</span></a>';switch(t.template){case"link":return n;case"link-with-baloon":return'<div class="location inline">   <div class="location-container"><a class="location-container-link" ng-click="select()"><span class="location-container-title">{{selectedRegion.title}}</span></a>   </div></div>';default:return'<li class="location"><div class="location-container">'+n+"</div></li>"}},replace:!0,transclude:!0,scope:{},controller:t}}])}(),function(){"use strict";angular.module("epgu").directive("regionNotSupported",function(){function e(t,n,i,e){t.user=n.user,t.loading=!0,t.subscribeServiceError=!1,t.codeClean=t.code.replace(/\//g,""),n.logined&&!t.noSubscribe&&i.checkNotification(t.codeClean,function(e){t.subscribed=!!(e&&e.data&&e.data.subscribed),t.loading=!1}),i.get().then(function(e){t.region=e,t.moscowAppointmentDoctor="10067"===t.code&&"1"===t.targetCode&&"45000000000"===t.region.id,n.$$phase||t.$apply(),t.loading=!1}),t.selectRegion=function(){n.$broadcast("region-select")},t.getRegionPath=function(e){if(e)return e.path.split("/")[0].trim()},t.notify=function(){var e="";t.errorData&&"TARGET_UNAVAILABLE"===t.errorData.errorCode&&(e=t.targetCode),t.loading=!0,i.saveNotification(t.codeClean,function(e){e&&200==e.status?t.subscribed=!0:t.subscribeServiceError=!0,t.loading=!1},e)}}return e.$inject=["$scope","$rootScope","RegionService","$routeParams"],{restrict:"E",controller:e,scope:{code:"@",targetCode:"@",passportIcon:"=?",title:"@",noSubscribe:"=?",errorData:"="},templateUrl:window.templatePath+(SmartPhone.isAny()?SmartPhone.isPhone()?"/tpl/directives/region-not-supported-mob-a910473274.html":"/tpl/directives/region-not-supported-pad-cd3ad5c0de.html":"/tpl/directives/region-not-supported-502c4bf7ee.html"),replace:!0}})}(),function(){"use strict";angular.module("epgu").directive("regionSearch",["$rootScope","$document","$timeout","$http",function(d,t,u,p){function e(o,a,e){function n(){for(var e=0;e<o.items.length;e++)if(o.model.id==o.items[e].code)return e;return-1}var i,s=a.find("input"),r=a.find(".dropdown-el ul"),l=(o.loading=!1,o.floating=void 0!==e.$attr.floating,o.id=IDSequence.get(),o.placeholder=o.placeholder||"Выберите область, округ, край или республику",o.select=function(e,t){o.filter=e.origName,o.change({selected:{id:e.code,title:e.origName,path:e.path}}),t?u(function(){l()},0):a.removeClass("opened")},o.hasValue=function(){return o.model&&!$.isEmptyObject(o.model)&&!o.disabled},o.filter="",t.find("body"),o.$on("body-click",function(e,t){0==angular.element(t).closest(a).length&&(a.removeClass("opened"),a.closest(".region-select-container")?0===r.find(".selected").length&&d.$safeApply(function(){o.filter="",o.change({selected:{}}),o.items=[]}):d.$safeApply(function(){o.filter=""}))}),o.items=[],function(){var e=r.find(".selected");0<e.length&&r.scrollToElement(e,0,150)});function c(e,t,n,i){p({method:"GET",url:d.nsiApi+"epgu/region/",withCredentials:!0,params:{_:d.cacheRequestStamp,q:e,pageSize:t,pageNum:n}}).then(function(e){o.items=i?o.items:[],e&&e.data&&(e.data.forEach(function(e){var t;e.origName=e.name,~e.path.indexOf("/")&&((t=e.path).substr(0,e.path.lastIndexOf("/")).replace(/\//g," / "),e.name=e.name+" ("+t+")")}),i?(o.allDataLoaded=!e.data.length||e.data.length<10,o.items=o.items.concat(e.data)):(o.items=e.data,a.addClass("opened"),u(function(){a.find(".dropdown-el ul").scrollTop(0,150)},0))),o.loading=!1,d.$$phase||o.$apply()})}s.on("click",function(){!a.hasClass("opened")&&0<o.items.length&&(a.addClass("opened"),l())}),s.bind("focus",function(){a.addClass("has_content")}),s.bind("blur",function(){a.toggleClass("has_content",0<s.val().length)}),s.bind("keydown",function(e){switch(e.keyCode){case 38:if(0!=o.items.length){if(!o.model)return void o.select(o.items[0]);var t=n();t<=0?t=o.items.length-1:--t,o.select(o.items[t],!0)}return;case 40:if(0!=o.items.length){if(!o.model)return void o.select(o.items[0]);t=n();t+1>=o.items.length||t<0?t=0:++t,o.select(o.items[t],!0)}return}clearTimeout(i),i=setTimeout(function(){o.query=s.val(),o.pageNum=0,o.allDataLoaded=!1,0==o.query.length?(o.items=[],d.$$phase||o.$apply()):2<o.query.length&&(o.loading=!0,d.$$phase||o.$apply(),c(o.query,10,0))},700)}),r.bind("scroll",function(){o.allDataLoaded||this.scrollTop+this.offsetHeight>=this.scrollHeight&&(o.loading=!0,c(o.query,10,++o.pageNum,!0))}),o.$on("$destroy",function(){s.unbind(),r.unbind()}),d.$on("region-select",function(){o.filter=""})}return e.$inject=["$scope","$element","$attrs"],{restrict:"E",replace:!0,scope:{model:"=",change:"&",error:"=",fixplaceholder:"@"},controller:e,template:'<div class="epgu-selectbox region-select" ng-class="{disabled : disabled, \'floating-placeholder\' : floating, \'invalid-field\' : error, \'has_content\' : filter}">\n    <label ng-if="fixplaceholder || (model ? model.path : placeholder)" for="_epgu_el{{id}}_input">{{fixplaceholder || (model ? model.path : placeholder)}}</label>    <div class="select-el" id="_epgu_el{{id}}">      <input type="search" class="select-text" ng-class="{\'loading\' : loading}" ng-model="filter" id="_epgu_el{{id}}_input"/>       <div data-ng-if="loading" class="throbber-search" data-throbber="throbber-small" data-show-heading="false"></div>    </div>    <div class="dropdown-el">\n        <ul>\n            <li ng-class="{selected : model.id == item.code}" ng-repeat="item in items"               ng-bind="item.name" ng-click="select(item)">\n        </li>\n       </ul>\n    </div>\n</div>'}}])}(),function(){"use strict";angular.module("epgu").directive("regionSearchKladr",["$rootScope","$document","$timeout","$http",function(a,s,r,l){function e(n,i,e){var t,o=i.find("input");n.loading=!1,n.floating=void 0!==e.$attr.floating,n.id=IDSequence.get(),n.filter=n.filter||"",n.placeholder=n.placeholder||"Адресная строка",n.select=function(e,t){n.model=e,n.filter=n.model.address,n.model.code,l({method:"GET",withCredentials:!0,url:a.nsiApi+"fias"}).success(function(e){if(e&&e.error&&0===e.error.code&&e.address){switch(e.address.fiasCode){case"0c5b2444-70a0-4932-980c-b4dc0d3f02b5":e.address.elements.push({data:"Москва",level:4,elmCode:"45000000000",fiasCode:"0c5b2444-70a0-4932-980c-b4dc0d3f02b5",kladrCode:"77000000000",type:"Город"});break;case"c2deb16a-0330-4f05-821f-1d09c93331e6":e.address.elements.push({data:"Санкт-Петербург",level:4,elmCode:"40000000000",fiasCode:"c2deb16a-0330-4f05-821f-1d09c93331e6",kladrCode:"78000000000",type:"Город"});break;case"63ed1a35-4be6-4564-a1ec-0c51f7383314":e.address.elements.push({data:"Байконур",level:4,elmCode:"55000000000",fiasCode:"63ed1a35-4be6-4564-a1ec-0c51f7383314",kladrCode:"99000000000",type:"Город"});break;case"6fdecb78-893a-4e3f-a5ba-aa062459463b":e.address.elements.push({data:"Севастополь",level:4,elmCode:"",fiasCode:"6fdecb78-893a-4e3f-a5ba-aa062459463b",kladrCode:"92000000000",type:"Город"})}n.model.details=e.address,a.$broadcast("addressUpdated",{fiasCode:e.address.fiasCode})}}),i.removeClass("opened"),t&&t.stopPropagation()},n.hasValue=function(){return n.model&&!$.isEmptyObject(n.model)&&!n.disabled},s.find("body").bind("click",function(){i.removeClass("opened"),a.$$phase||n.$apply()}),i.bind("click",function(e){var t;e.stopPropagation(),n.error=void 0,0<n.items.length&&(angular.element(document).find(".epgu-selectbox.opened").filter(function(e,t){return 0===angular.element(t).find("#_epgu_el"+n.id).length}).removeClass("opened"),i.hasClass("opened")?(i.removeClass("opened"),a.$$phase||n.$apply()):(i.addClass("opened"),0<(t=(e=i.find(".dropdown-el ul")).find(".selected")).length&&e.scrollToElement(t,0,150)))}),n.items=[],o.bind("focus",function(){i.addClass("has_content")}),o.bind("blur",function(){0<o.val().length?i.addClass("has_content"):i.removeClass("has_content")}),o.bind("keydown",function(){t&&r.cancel(t),t=r(function(){var e,t;e=n.filter,t=e.replace(/\s+/g,""),!e||0==e.length||t.match(/^\d+$/)?n.items=[]:2<e.length&&(n.loading=!0,6==(t=e.split(","))[0].length&&+t[0]&&t.splice(0,1),e=t.join(",").trim(),l({method:"GET",params:{q:e},url:a.nsiApi+"fias",withCredentials:!0}).success(function(e){e&&e.error&&0===e.error.code&&(n.items=e.addresses,i.addClass("opened"),r(function(){var e=i.find(".dropdown-el"),e=(e.height()+e.offset().top-window.scrollY>$(window).height()&&e.css({top:"auto",bottom:"52px"}),i.find(".dropdown-el ul"));e.find(".selected");e.scrollTop(0,150)},0),n.loading=!1)}))},700)})}return e.$inject=["$scope","$element","$attrs"],{restrict:"E",replace:!0,scope:{model:"=",change:"&",error:"=",filter:"=",fixplaceholder:"@"},controller:e,template:'<div class="epgu-selectbox region-select" ng-class="{disabled : disabled, \'floating-placeholder\' : floating, \'invalid-field\' : error, \'has_content\' : (filter)}">\n    <label ng-if="fixplaceholder || (model ? model.address : placeholder)" for="_epgu_el{{id}}_input">{{fixplaceholder || placeholder}}</label>    <div class="select-el" id="_epgu_el{{id}}">      <input type="search" class="select-text" ng-class="{\'loading\' : loading}" ng-model="filter" id="_epgu_el{{id}}_input"/>       <div data-ng-if="loading" class="throbber-search" data-throbber="throbber-small" data-show-heading="false"></div>    </div>    <div class="dropdown-el">\n        <ul>\n            <li ng-class="{selected : model == item}" ng-repeat="item in items"               ng-bind="item.address" ng-click="select(item, $event)">\n        </li>\n       </ul>\n    </div>\n</div>'}}])}(),function(){"use strict";angular.module("epgu").controller("RegionSelectorController",["$scope","$rootScope","RegionService","$element","$timeout","$http","$location","LkService",function(a,s,i,r,l,c,d,e){a.current={value:void 0},i.get().then(function(e){s.$$phase?(a.oldRegion=e,a.selectedRegion=e):a.$apply(function(){a.oldRegion=e,a.selectedRegion=e}),void 0!==s.firstTimeShow||"00000000000"!==e.id&&void 0!==e.id?(s.firstTimeShow=!1,a.current.value="current"):(s.firstTimeShow=!0,a.disabledBtn=!0)}),navigator.geolocation&&(a.allowAuto=!0),a.autoRegion="Определить автоматически",a.autoSuccess=!1,a.$watch("current.value",function(e,t){var n;function i(e){var t={};t.latitude=e&&e.coords.latitude||0,t.longitude=e&&e.coords.longitude||0,t.needIpDetect=!s.firstTimeShow,t.platform=SmartPhone.isAny()?SmartPhone.isPhone()?"EPGUV3_MOB":"EPGUV3_TAB":"EPGUV3_DESK",t._=Math.random(),c({method:"GET",url:s.nsiApi+"epgu/region/geo",withCredentials:!0,params:t}).then(function(e){var t,n;e&&e.data&&e.data.code&&e.data.name&&204!=e.status?(a.autoDetectionFail=!1,a.timeZone=e.data.timeZone,t=e.data.path,n=e.data.code,e=e.data.name,a.selectedRegion={id:n,title:e},a.byIp=!0,a.autoSuccess=!0,a.autoRegion=t,a.selectedRegion.path=t,a.disabledBtn=!1,a.autoLoading=!1):o()},o)}function o(){s.$applyAsync(function(){a.autoDetectionFail=!0,a.autoLoading=!1,a.disabledBtn=!0})}t===e||"current"!==e||s.firstTimeShow?t!==e&&"auto"===e?(a.autoLoading=!0,s.$$phase||a.$apply(),"http"!==d.$$protocol?navigator.geolocation.getCurrentPosition(i,o):i()):t!==e&&"manual"===e&&(n=r.find('input[type="search"]'),l(function(){n.focus(),l(function(){r[0].scrollTop=n.offset().top},700)},200),a.selectedRegion)&&a.selectedRegion.id&&(a.disabledBtn=s.firstTimeShow&&"00000000000"===a.selectedRegion.id):(a.selectedRegion=a.oldRegion,a.disabledBtn=!1)}),a.select=function(e){"manual"===a.current.value&&(a.disabledBtn=!(e&&e.id),a.$safeApply(function(){a.selectedRegion=e}))},r.on("keydown",function(e){13===e.keyCode&&a.save()}),a.save=function(e){function t(){var e=d.path().replace(/\/[r|o]\/(.*)/,"")+location.search+location.hash;window.location=e}var n;a.disabledBtn||(e&&(e.preventDefault(),e.stopPropagation()),s.disableMetric||(e=s.firstTimeShow?" GEO_FIRST_FORM":"GEO_GOSBAR_FORM","manual"===a.current.value&&metricReachGoal24845174(e,{save_manual:{OKATO:a.selectedRegion.id}}),"auto"===a.current.value&&((n={})[s.firstTimeShow||!a.byIp?"save_html5":"save_ip"]={OKATO:a.selectedRegion.id},metricReachGoal24845174(e,n))),a.disabledBtn)||(a.oldRegion=a.selectedRegion,i.set(a.selectedRegion),a.close("saving"),"/"!==d.path()&&d.search("scroll","true"),"auto"===a.current.value&&s.userId&&a.timeZone?(e=Number.parseInt(a.timeZone.replace("UTC",""))-3,c({method:"POST",url:s.lkApi+"settings/notifications/notificationperiod",params:{onlyTimeZone:!0,offset:0<e?"+"+e:e+""},withCredentials:!0}).then(function(){t()},function(){t()})):t())},a.close=function(e){"saving"===e||s.disableMetric||metricReachGoal24845174(s.firstTimeShow?"GEO_FIRST_FORM":"GEO_GOSBAR_FORM","close"),s.firstTimeShow=!1,a.disabledBtn=!1,a.closeThisDialog()},a.$on("$destroy",function(){r.unbind()}),a.$on("$destroy",function(){r.off()})}])}(),function(){"use strict";angular.module("epgu").directive("smartFaq",["$rootScope",function(e){return{restrict:"E",templateUrl:window.templatePath+"/tpl/catalog/smart-faq-9636e477cb.html",replace:!0,transclude:!0,scope:{contentSrc:"=?",contentCatSrc:"=?",wrapType:"=?",elmId:"=?",noMobileRow:"=?"}}}]).directive("smartNews",["$rootScope","$moment",function(e,t){return{restrict:"E",templateUrl:window.templatePath+"/tpl/catalog/smart-news-94dbe48e63.html",replace:!0,transclude:!0,link:function(e){angular.forEach(e.contentSrc,function(e){e.pubDate&&(e.pubDateMs=t(e.pubDate).valueOf())})},scope:{contentSrc:"=?",wrapType:"=?",elmId:"=?",noMobileRow:"=?"}}}]).directive("smartLs",["$rootScope",function(e){return{restrict:"E",templateUrl:window.templatePath+"/tpl/catalog/smart-ls-130f1fc847.html",replace:!0,transclude:!0,scope:{contentSrc:"=?",buttonData:"=?",wrapType:"=?",elmId:"=?",lsTitle:"=?"}}}]).directive("smartPromo",["$rootScope",function(e){return{restrict:"E",templateUrl:window.templatePath+"/tpl/catalog/smart-promo-aff111d922.html",replace:!0,transclude:!0,scope:{contentSrc:"=?"},link:function(e){e.styleTag=e.contentSrc.bgImage?"background-image:"+e.contentSrc.bgImage+"; background-repeat: no-repeat":""}}}]).directive("smartSeo",["$rootScope",function(e){return{restrict:"E",templateUrl:window.templatePath+"/tpl/catalog/smart-seo-6ff4adbc07.html",replace:!0,transclude:!0,scope:{contentSrc:"=?",elmId:"=?",wrapType:"=?"}}}]).directive("smartServices",["$rootScope",function(e){return{restrict:"E",templateUrl:window.templatePath+"/tpl/catalog/smart-services-884ca7337d.html",replace:!0,transclude:!0,scope:{contentSrc:"=?",wrapType:"=?",elmId:"=?",srcType:"=?",simple:"=?"}}}]).directive("smartRightBar",["$rootScope","$anchorScroll","$timeout","animatedIdScroll",function(e,t,n,i){return{restrict:"AE",templateUrl:window.templatePath+"/tpl/catalog/smart-right-bar-6a973146d8.html",replace:!0,scope:{links:"=?",elmLinks:"=?",wrapType:"=?"},link:function(e){e.scrollToAnchorLink=function(e,t){e.preventDefault(),i.scrollToElement("",t)}}}}])}(),function(){"use strict";angular.module("epgu").directive("epguCircularProgress",["$rootScope",function(e){return{restrict:"E",scope:{filled:"=?",all:"=?",percents:"=?",settings:"=?"},link:function(t,e,n){var i=document.createElement("canvas"),o=(i.width=t.settings&&t.settings.width||200,i.height=t.settings&&t.settings.height||200,document.createElement("span")),a=(o.classList.add("epgu-progress-bar-percents"),i.getContext("2d")),s=(a.lineWidth=15,a.lineCap="round",a.translate(i.height/2,i.height/2),a.rotate(-90*Math.PI/180),e.append(i),e.append(o),null!=t.percents?t.$watch("percents",function(e){void 0!==e&&(r(),o.textContent=t.percents+"%"||"")}):t.filled&&t.$watch("filled",function(e){void 0!==e&&r()}),function(e,t,n){a.beginPath(),a.strokeStyle=e,a.lineCap="round";e=(i.width-a.lineWidth)/2;a.arc(0,0,e,0,2*Math.PI*n,!1),a.stroke()});function r(){var e=t.percents||Math.round(t.filled/t.all*100)||0;a.clearRect(0,0,i.width,i.height),s("#F3F3F3",i.lineWidth,1),0<e&&s("#1C881F",i.lineWidth,e/100)}}}}]).directive("epguLineProgress",["$rootScope",function(e){return{restrict:"E",scope:{filled:"=?",all:"=?",percents:"=?",settings:"=?"},link:function(n,e,t){var i=document.getElementById("content-wrapper")&&document.getElementById("content-wrapper").clientWidth,o=document.createElement("canvas"),a=(o.width=n.settings&&n.settings.width||i,o.height=n.settings&&n.settings.height||15,document.createElement("span")),s=(a.classList.add("epgu-progress-bar-percents"),o.getContext("2d")),r=(e.append(o),e.append(a),null!=n.percents?n.$watch("percents",function(e){void 0!==e&&(l(),a.textContent=n.percents+"%"||"")}):n.filled&&n.$watch("filled",function(e){void 0!==e&&l()}),function(e,t){s.fillStyle=e,s.fillRect(0,0,t,o.height)});function l(){var e=n.percents||Math.round(n.filled/n.all*100)||0,t=(100==e&&(a.style.color="#FFFFFF"),Math.round(o.width/100*e));s.clearRect(0,0,o.width,o.height),r("#F3F3F3",o.width),0<e&&r("#1C881F",t)}}}}])}(),function(){"use strict";angular.module("epgu").directive("socialLinks",["$rootScope",function(e){function t(i){i.socialShare=function(e){var t=i.href,n=(0==t.indexOf("/")&&(t=i.$root.betaUrl+t.substr(1)),$("meta[property='og:url']").prop("content",t),console.log($("meta[property='og:title']").val()),location.href);switch(e){case"vk":Share.vkontakte(t||n,"");break;case"fb":Share.facebook(t||n,"");break;case"ok":Share.odnoklassniki(t||n,"");break;case"twitter":Share.twitter(t||n,"")}return!1},i.socialGroup=function(e){window.open(e,"")}}return t.$inject=["$scope"],{restrict:"E",scope:{onlyIcons:"=",href:"@",footerIcons:"=",socialGroupText:"="},templateUrl:e.staticDomainUrl+"htdocs/tpl/social/social-2d8b314bec.html",controller:t}}])}(),function(){"use strict";angular.module("epgu").directive("textInput",["$compile",function(t){return{restrict:"E",template:'<div class="epgu-input-text" ng-class="{\'floating-placeholder\' : floating, \'invalid-field\' : error}">\n                            <label for="_epgu_el{{id}}">{{label}}</label>\n                            <div data-ng-show="type === \'textarea\'" class="textarea-padding-up"></div>\n                            <input id="_epgu_el{{id}}" name="{{name}}" type="{{type}}" maxlength="{{maxlength}}" ng-model="model" ng-readonly="readonly"                               ui-mask="{{mask}}" ui-mask-save="{{maskSave}}" ui-mask-pattern="{{pattern}}"                               ng-required="required" placeholder="{{placeholder}}"/>\n                            <textarea id="_epgu_el{{id}}" maxlength="{{maxlength}}" name="{{name}}" ng-model="model" ng-readonly="readonly"                               ng-required="required"></textarea>\n                            <div class="epgu-input-subtext" ng-if="subtext">{{subtext}}</div>                            <div class="error-tooltipe" ng-if="showErrorTooltip && error && error.errorRusText">{{error.errorRusText}}</div>                           <div class="errors-wrapper" ng-transclude></div>\n                        </div>',replace:!0,transclude:!0,scope:{model:"=",label:"@",name:"@",maxlength:"@",classNamee:"@",type:"@",mask:"@",maskSave:"@",pattern:"@",readonly:"=",onunique:"&",subtext:"@",showErrorTooltip:"@",numbersonly:"=",error:"=",placeholder:"@"},link:function(n,i,e){n.required=void 0!==e.$attr.required,n.floating=void 0!==e.$attr.floating,n.id=IDSequence.get(),angular.element(i.children()["textarea"===n.type?2:3]).remove();var o=angular.element(i.children()[2]);o.bind("focus",function(){n.readonly||(i.addClass("has_content"),n.error=void 0)}),o.bind("blur mask-blur",function(){n.readonly||(0<o.val().length?i.addClass("has_content"):i.removeClass("has_content"))}),n.$watch("model",function(e,t){e!==t&&(document.activeElement!==o[0]&&(void 0===e||""==e?i.removeClass("has_content"):i.addClass("has_content")),"string"==typeof e)&&n.numbersonly&&(n.model=+n.model.replace(/[^0-9]/g,"")?+n.model.replace(/[^0-9]/g,""):""),n.onunique()&&"function"==typeof n.onunique()&&n.onunique()(n,i,e)}),void 0!==n.model&&0<(n.model+"").length&&i.addClass("has_content"),i.attr("class-name")&&i.addClass(i.attr("class-name")),n.required&&!n.model?(i.find("input").addClass("ng-invalid ng-invalid-required"),i.find("input").removeClass("ng-valid ng-valid-required")):(i.find("input").removeClass("ng-invalid ng-invalid-required"),i.find("input").addClass("ng-valid ng-valid-required")),n.required&&e.ngForm&&e.name&&(i.find(".errors-wrapper").append(e=angular.element('<span class="field-error" ng-show="$parent.'+e.ngForm+"."+e.name+'.$error.required">Поле&nbsp;обязательно&nbsp;для&nbsp;заполнения</span>')),t(e)(n))}}}])}(),function(){"use strict";angular.module("epgu").directive("throbber",function(){var e=0<window.navigator.userAgent.indexOf("MSIE ")||navigator.userAgent.match(/Trident.*rv\:11\./)?"/tpl/directives/throbber-gif-55e463082c.html":"/tpl/directives/throbber-svg-f4d631f835.html";return{restrict:"A",templateUrl:window.templatePath+e,scope:{header:"@",subHeader:"@",throbber:"@",showHeading:"=",inlineHeader:"@"}}})}(),function(){"use strict";angular.module("epgu").directive("throbberHexagon",function(){return{restrict:"E",templateUrl:window.templatePath+"/tpl/directives/throbber-hexagon-bcc3f3a849.html",scope:{size:"@size"}}})}(),function(){"use strict";angular.module("epgu").directive("year",["$rootScope",function(e){return{restrict:"E",template:"<span>{{year}} </span>",replace:!0,scope:{},link:function(e,t,n){e.year=(new Date).getFullYear()}}}])}(),function(){"use strict";angular.module("epgu").directive("regionCase",["$rootScope","MainPageMetric",function(e,i){function t(t,e,n){t.selectRegion=function(){e.$broadcast("region-select"),i.legalEntitySend("Выбор региона")},n.getCurrentRegionCases().then(function(e){e&&e.cases&&(t.regionCase=e.cases[t.caseItem-1])})}return t.$inject=["$scope","$rootScope","RegionCaseSrv"],{restrict:"E",template:'<div><span data-ng-if="regionCase" class="{{prefixCls}}">{{prefix}} <a class="{{linkCls}}" href data-ng-click="selectRegion()">{{regionCase}}</a> {{postfix}}</span></div>',replace:!0,scope:{prefix:"=",prefixCls:"=",linkCls:"=",caseItem:"=",postfix:"=?"},controller:t}}]).factory("RegionCaseSrv",["$rootScope","MainPageService","$location","$q",function(n,i,o,a){return{getCurrentRegionCases:function(){var e,t=a.defer();return o.$$path&&~o.$$path.indexOf("/r/")&&n.manualRegions?(e=n.manualRegions[o.$$path.replace("/r/","")],t.resolve(e)):i.getAll().then(function(){t.resolve(i.getRegionCases())}),t.promise}}}])}(),function(){"use strict";angular.module("epgu").directive("q",function(){return{restrict:"E",template:'<i class="q">\n<span class="icomoon">&gt;</span>\n   <div class="q_hover {{position}}" data-ng-if="!onlyQ && touched" data-ng-transclude>\n   </div>\n</i>',transclude:!0,replace:!0,link:function(n,i,e){n.touched=!SmartPhone.isAny(),(n.onlyQ||SmartPhone.isAny())&&n.$on("body-click",function(e,t){0<angular.element(t).closest(i).length&&!n.touched?(n.id&&n.$root.$broadcast("show-q-"+n.id),n.touched=!0):(n.id&&n.$root.$broadcast("hide-q-"+n.id),n.touched=!1)})},scope:{position:"@",id:"@",onlyQ:"="}}}).directive("qTooltip",["$rootScope",function(o){function a(e){var t=window,n=document.documentElement||document.body.parentNode||document.body,i=t.pageXOffset||n.scrollLeft,t=t.pageYOffset||n.scrollTop,n=e.getBoundingClientRect();return i||t?{bottom:n.bottom+t,left:n.left+i,right:n.right+i,top:n.top+t,height:n.height,width:n.width}:n}return{restrict:"EA",template:'<i class="q">                    <span class="icomoon"><div class="q-epgu-popover-rect"></div></span>                </i>',replace:!0,scope:{id:"@qTooltip"},link:function(n,i){n.touched=!SmartPhone.isAny(),(n.onlyQ||SmartPhone.isAny())&&(n.touched=!SmartPhone.isAny(),n.$on("body-click",function(e,t){0<angular.element(t).closest(i).length&&!n.touched?(n.$root.$broadcast("show-q-popover-"+n.id,a(i[0]),i[0]),n.touched=!0):(n.$root.$broadcast("hide-q-popover-"+n.id,i[0],"mob"==o.version),n.touched=!1)})),i.hover(function(){n.$root.$broadcast("show-q-popover-"+n.id,a(i[0]),i[0])},function(){n.$root.$broadcast("hide-q-popover-"+n.id,i[0])})}}}]).directive("qTooltipContainer",["$timeout","$rootScope","$animate",function(c,e,d){function t(e,t,i,n){var o,a;"dk"==i.version?(o=angular.element('<div id="epgu-popover-'+t.id+'" class="q-epgu-popover"><div class="q-epgu-popover-before"></div><div class="q-epgu-popover-block"></div></div>').addClass((t.placement,t.placement)),c(function(){angular.element($("[data-q-tooltip="+t.id+"]")).append(o)})):(o=e).addClass("q-epgu-popover"),n(function(e,t){("dk"==i.version?o.find(".q-epgu-popover-block"):o).append(e),a=t});var s,r=!1,l=t.offsetTopByHeight;i.$on("show-q-popover-"+t.id,function(e,t,n){r||("dk"==i.version&&(l?o.css("top",(o.height()-t.height)/2):o.css("top",t.height/2)).css("left","20px"),o.addClass("show-q-popover-showed"),$(n).find(".q-epgu-popover-rect").addClass("show-q-popover-showed"),r=!0,o.find(".q-epgu-popover-block").scrollTop(0))}),i.$on("hide-q-popover-"+t.id,function(e,t,n){n?(d.removeClass(o,"show-q-popover-showed"),d.removeClass($(t).find(".q-epgu-popover-rect"),"show-q-popover-showed"),r=!1):(c.cancel(s),s=c(function(){d.removeClass(o,"show-q-popover-showed"),$(t).find(".q-epgu-popover-rect").removeClass("show-q-popover-showed"),r=!1},500))}),t.$on("$destroy",function(){o.remove(),a.$destroy()})}return t.$inject=["$element","$scope","$rootScope","$transclude"],{restrict:"EA",transclude:!0,controller:t,scope:{placement:"@",offsetTopByHeight:"@qOffsetTopByHeight",id:"@qTooltipContainer"}}}]).directive("questionTip",["$rootScope","$document","$timeout",function(i,o,a){return{restrict:"E",transclude:!0,scope:{direction:"@?",directionBind:"=?",contentClass:"@?",iconClass:"@?",onOpen:"&?"},link:function(t,n){function e(){t.tipShown=!1,t.$apply()}t.onOpenDesk=function(){i.isDesktop()&&t.onOpen&&t.onOpen()&&t.onOpen()(n)},t.toggle=function(e){t.tipShown=!t.tipShown,e.stopPropagation(),a(function(){t.tipShown&&t.scrollDocumentMob()}),t.tipShown&&t.onOpen&&t.onOpen()(n)},t.scrollDocumentMob=function(){var e,t;i.isMobile()&&(e=angular.element(n).find(".bubble-help"),(e=window.outerHeight-(e[0].getBoundingClientRect().y+e.height()))<20)&&(e=20-e,t=angular.element("html, body").scrollTop(),angular.element("html, body").animate({scrollTop:t+e},300))},o.on("click",e),o.on("tap",e),t.$on("$destroy",function(){o.off("click",e),o.off("tap",e)})},template:'<div data-ng-class="[{\'question-sign\': !$root.isMobile(), \'question-sign_mob\': $root.isMobile(), \'show-on-hover\': $root.isDesktop(), \'shown\': tipShown}, iconClass]" data-ng-click="toggle($event);" data-ng-mouseover="onOpenDesk()"><div class="bubble-help" data-ng-class="[\'bubble-\' + (direction || directionBind || \'left\'), contentClass]"><div class="arrow-before"/><div class="arrow-after"/><div class="bubble-content" data-ng-transclude/></div>'}}])}(),function(){"use strict";angular.module("epgu").directive("disclaimer",["$rootScope","ipCookie","$q","$http","DisclaimerService",function(e,t,n,i,c){function o(t,n,e){t.arrSubscription=[];var i,o,a=!t.disclaimer.isHidden;function s(e){t.show=a,t.emailField={showErrors:!1},e&&a&&(t.sendEmail=!0),n.isDisclaimersShow=!!a||n.isDisclaimersShow,a&&(t.disclaimer.subscription=!1,t.disclaimer.sendToEmail="",t.isReadonly=!1,t.disclaimer.notificationEnabled)&&d.promise.then(function(){t.disclaimer.sendToEmail=n.user&&n.user.email&&"P"==n.userType&&n.user.emailVerified?n.user.email:"",t.disclaimer.sendToEmail&&(t.isReadonly=n.user.emailVerified||!1,t.sendEmail=!0,t.sendLoading=!0,t.sendEmailError=!1,t.disclaimerChecked=!0,c.checkSubscriptionDisclaimer(t.disclaimer.id,n.user.email).then(function(e){t.sendEmail=!1,t.sendLoading=!1,t.sendEmailError=!1},function(e){e&&409==e.status?(t.sendEmail=!0,t.sendLoading=!1):(t.sendEmail=!1,t.sendLoading=!1,t.sendEmailError=!1)}))})}function r(e){e.isPriority&&(c.counts.priorityDisclaimersCount--,c.counts.priorityDisclaimersCount<=0&&n.$broadcast("closedAllPriorityDisclaimers"),"PGU"===e.mnemonic)&&c.counts.mainDisclaimersPriorityCount--}function l(){a=!1,s(),i=n.$on("closedAllPriorityDisclaimers",function(){a=!0,s(),i()}),t.$on("$destroy",function(){i&&i()})}$.jStorage.storageAvailable()&&!(a=!e("disclaimerClosed-"+t.disclaimer.id)&&!$.jStorage.get("disclaimer-closed["+t.disclaimer.id+"]",!1)&&!t.disclaimer.isHidden)&&r(t.disclaimer),a&&!t.disclaimer.isPriority&&(0<c.counts.priorityDisclaimersCount?l():o=n.$on("addedPriorityDisclaimers",function(){o(),l()})),s(!0),t.close=function(){e("disclaimerClosed-"+t.disclaimer.id,t.disclaimer.id,{domain:n.cookieDomain,path:"/",expires:8760,expirationUnit:"hours"}),$.jStorage.set("disclaimer-closed["+t.disclaimer.id+"]",!0),n.$safeApply(function(){t.show=!1}),r(t.disclaimer)},t.sendSubscription=function(e){e.preventDefault(),e.stopPropagation(),t.disclaimer.subscription=!!t.sendEmailError||!t.disclaimer.subscription,t.disclaimerChecked||(t.sendEmailRun=!1,t.sendEmailError=!1,t.sendEmail=!1,t.sendLoading=!1)},t.callSubscription=function(e){e.preventDefault(),e.stopPropagation(),t.sendEmail=!0,t.sendLoading=!0,t.sendSuccess=!1,t.sendEmailError=!1;e=t.disclaimer.mnemonic&&-1!=["PGU","EPGU_V3","EPGU_V3_DESKTOP","EPGU_V3_MOBILE","SMU_MAIN"].indexOf(t.disclaimer.mnemonic)&&(-1==["/entrepreneur","/legal-entity","/","/foreign-citizen","lk"].indexOf(location.pathname)||n.isLk)?n.betaUrl:location.href,e={id:t.disclaimer.id,email:t.disclaimer.sendToEmail,url:e};c.sendSubscriptionDisclaimer(e).then(function(e){t.sendSuccess=!0,t.sendEmail=!0,t.sendLoading=!1,t.sendEmailError=!1},function(e){e&&409==e.status?(t.sendEmail=!0,t.sendEmailError=!1,t.sendLoading=!1):(t.sendEmail=!0,t.sendLoading=!1,t.sendEmailError=!0)})}}var d=n.defer();e.$on("user-loaded",function(){d.resolve()});return o.$inject=["$scope","$rootScope","ipCookie","DisclaimerService"],{restrict:"E",template:'<div data-ng-show="show" class="disclaimer-container {{disclaimer.level}}" data-ng-class="{\'disclaimer-page-type\': disclaimer.mnemonic===\'page\'}">   <div class="disclaimer" data-ng-class="disclaimer.level">       <h4>Внимание!</h4>       <p data-ng-bind-html="disclaimer.text | to_trusted"></p>       <span class="icomoon"></span>       <a class="close" data-ng-click="close()"></a>       <div><a class="text-link dashed" data-ng-if="disclaimer.notificationEnabled" data-ng-click="sendSubscription($event)">Подпишитесь на уведомление</a>           <div class="offset-top-x-sm" data-ng-if="disclaimer.subscription && !sendEmail && !sendLoading" data-ng-form="sendForm">\n               <div class="row" data-ng-class="{ \'row\': $root.version == \'dk\', \'fluid-row\': $root.version != \'dk\'}">\n                   <div data-ng-class="{ \'span_8\': $root.version == \'dk\', \'col-6\': $root.version != \'dk\'}">\n                       <div><epgu-input data-field="emailField" name="test" readonly="isReadonly" data-ng-model="disclaimer.sendToEmail" type="email" floating required label="Адрес электронной почты"></epgu-input></div>\n                   </div>\n                   <div data-ng-class="{ \'span_7\': $root.version == \'dk\', \'offset-top-x-sm col-6\': $root.version == \'mob\'}">\n                       <a data-ng-click="sendForm.$valid && callSubscription($event)" data-ng-disabled="sendForm.$invalid || sendEmailRun" data-ng-class="{\'button-long\': $root.version == \'mob\'}" class="button-medium button-base button-blue">Получить уведомление</a>                   </div>\n               </div>\n               <div class="offset-top-extra-sm"><span class="plain-text">Мы сообщим, когда проблема будет решена</span></div>\n   </div>           <div data-ng-if="disclaimer.subscription && sendEmail">       <div data-ng-if="sendLoading" class="cleanfix offset-top-x-sm"><div class="wait-check"><div data-throbber="throbber-small" data-inline-header="Подписка выполняется" data-show-heading="false"></div></div></div>\n             <div data-ng-if="!sendLoading && !sendEmailError && !sendSuccess" class="cleanfix offset-top-x-sm send-subscription"><result-subscription text="<span class=\'send-message plain-text\'>Подписка для <span class=\'bold\'>{{disclaimer.sendToEmail}}</span> уже оформлена</span>" type="type_repeat"></result-subscription></div>\n              <div data-ng-if="!sendLoading && sendSuccess" class="cleanfix offset-top-x-sm send-subscription"><result-subscription text="<span class=\'send-message plain-text\'>Уведомление придет на <span class=\'bold\'>{{disclaimer.sendToEmail}}</span></span>" type="type_ok"></result-subscription></div>\n              <div data-ng-if="!sendLoading && sendEmailError" class="cleanfix offset-top-x-sm send-subscription"><result-subscription text="<span class=\'send-message plain-text\'>Ошибка. Попробуйте еще раз</span>" type="type_repeat"></result-subscription></div>\n       </div></div></div></div>',replace:!0,controller:o,scope:{disclaimer:"="}}}]).directive("resultSubscription",[function(e){return{restrict:"E",template:'<div ng-class="type" class="">\n               <div data-ng-bind-html="text | to_trusted"></div>\n           </div>\n',replace:!0,transclude:!0,scope:{type:"@",text:"@"}}}])}(),function(){"use strict";angular.module("epgu").factory("cmsData",["MainPageService","$rootScope","$http",function(e,t,n){var i=SmartPhone.isAny()?SmartPhone.isPhone()?"EPGUV3_MOB":"EPGUV3_TAB":"EPGUV3_DESK";return{getData:function(){return"PARTNERS"!==t.viewType?e.getAll().then(function(){return e.getSearchConfig()}):n({method:"GET",url:t.cmsUrl+"search-cfg/"+i,params:{_:t.cacheRequestStamp,region:t.userSelectedRegion},withCredentials:!0})}}}]).directive("searchSputnik",["$rootScope","cmsData","MainPageMetric",function(o,a,s){function e(n,i,e){n.items=[],n.loading=!1,n.floating=void 0!==e.$attr.floating,n.id=IDSequence.get(),n.search=n.search||{query:""},n.search.query||window.addEventListener("pageshow",function(){window.document.getElementById("search-sputnik-input").value=""});var t="";n.getDataExample=function(){return t?t.split(", "):""},a.getData().then(function(e){t=(e=e||{}).example||"",n.placeholder=n.customLabel||e.placeholder||"Введите название услуги или ведомства",n.label||SmartPhone.isPhone()||(n.label=n.placeholder)},function(){n.placeholder=n.customLabel||"Введите название услуги или ведомства",n.label||SmartPhone.isPhone()||(n.label=n.placeholder)}),n.sendSearch=function(e){var t;(n.activeItem||n.search.query)&&(t=n.modal?"searchHeaderButton":"searchButton",s.send(t,n.activeItem&&n.activeItem.link||n.search.query)),e&&(e.preventDefault(),e.stopPropagation()),n.activeItem&&n.activeItem.link?window.location.href=n.activeItem.link:n.search.query&&n.searchTrigger(n.search.query),i.removeClass("opened")},n.searchTrigger=function(e){window.location.href=o.betaUrl+"search?query="+encodeURIComponent(e)},n.searchFocus=function(){n.items.length&&i.addClass("opened"),s.send("searchMain")}}return e.$inject=["$scope","$element","$attrs"],{restrict:"E",replace:!0,scope:{modal:"=?",items:"=?",change:"&?",label:"@",example:"@",search:"=?",searchModal:"=?",customLabel:"@",help:"=?",buttonColor:"@"},controller:e,template:'<div class="epgu-selectbox search-data search-sputnik" ng-class="{\'floating-placeholder\' : floating, \'has_content\' : search.query}">   <label for="_epgu_el{{id}}">{{label}}</label>   <div class="search-input select-el" id="_epgu_el{{id}}">       <div>           <form data-ng-submit="searchTrigger(search.query)"><input aria-label="Введите название услуги" type="text"                  data-ng-model="search.query"                  data-ng-focus="searchFocus()"                  data-ng-keydown=\'keyDownCallback($event)\'                  id="search-sputnik-input"                  maxlength="400"                  class="select-text"                  data-ng-class="{\'loading\' : loading}"                  placeholder="{{placeholder}}"></form>       </div>   </div>   <a class="btn-base medium search"       data-ng-class="{\'defender-enabled\': $root.defenderDay === \'enabled\'}"       data-ng-click="sendSearch($event)"       data-ng-style="{\'background-color\': $root.celebration && $root.pageNameCls === \'index-page\' ? $root.celebration : buttonColor}">       <span class="search-label">Найти</span>   </a>   <div ng-if="help && example"         data-ng-class="{\'example-block\': example}"         class="plain-text">           <span class="help">Например: <span ng-click="searchTrigger(exampleWord)" ng-repeat="exampleWord in getDataExample()"><span class="word-example">{{exampleWord}}</span><span data-ng-if="!$last">, </span></span></span>   </div></div>'}}]).directive("scrollToSelect",[function(){return{restrict:"A",scope:{scrollToSelect:"="},link:function(e,t,n){e.$watch("scrollToSelect",function(e){e&&0<$(t).length&&$(t).parent("ul").scrollToElement(t,0,150)})}}}])}(),function(){"use strict";angular.module("epgu").directive("failbackImg",["$http","$compile",function(e,t){return{restrict:"A",link:function(e,t,n){var i=n.ngSrc,o=n.failbackImg;t.bind("error",function(){o&&i!==o?t.attr("src",o):t.remove()})},replace:!0,transclude:!0}}])}(),function(){"use strict";angular.module("epgu").directive("catalogTabsAndSearch",["$location","userTypeService","CatalogService",function(t,i){function e(n){n.userTypeForTabs=i.getCurrentUserType(),n.$watch("search",function(e,t){e!=t&&n.$emit("catalog-tab-search",e)}),n.getSearch=function(e){e&&(e=function(e){e=e.replace(/  +/g," ");return 32<(e=e.split(" ")).length&&(e.length=32),e.join(" ")}(e),t.path("/search").search({query:e,serviceRecipient:i.getHeaderFilter().searchSputnikParam||i.getUserType().searchSputnikParam}))}}return e.$inject=["$scope"],{templateUrl:window.templatePath+(SmartPhone.isAny()&&SmartPhone.isPhone(),"/tpl/catalog/tabs-c6f15551fd.html"),replace:!0,scope:{active:"@",hideTab:"="},controller:e}}])}(),function(){"use strict";angular.module("epgu").directive("department",["$rootScope",function(o){function e(e){e.openBrowser=function(e,t){e&&(e.preventDefault(),e.stopPropagation()),t.includes(o.betaUrl)||(t=o.betaUrl+t),window.SMUAdapter.notify({eventType:"open_browser",eventParams:[{key:"url",value:t}]})}}return e.$inject=["$scope"],{restrict:"E",controller:e,template:function(e,t){var n=o.posEnabled,i='<div class="lg-offset-top-20 md-offset-top-20 sm-offset-top-20" data-ng-if="addPos">\n   <a href="'+o.posCardUrl+'" class="text-link text-link--comment">{{::$root.posButtonName}}</a>\n</div>\n';return'<div class="support-department">\n   <div data-ng-if="orgCode" class="img">\n      <img data-ng-if="orgIcon" data-ng-src="{{orgIcon}}" alt="{{orgName}}" /><structure-img data-ng-if="!orgIcon" data-org-code="{{orgCode}}" alt="{{orgName}}"></structure-img>\n   </div>\n   <div class="department-title lg-offset-top-16 lg-offset-bottom-40 sm-offset-bottom-24">\n       <div class="lg-h-title-16-big md-h-title-16 sm-h-title-14 sm-offset-bottom-8 sm-offset-top-8 bold lg-offset-bottom-16 md-offset-top-8 md-offset-bottom-8" data-ng-if="!orgLine || orgLine == \'true\'">Услугу предоставляет</div>\n       <div data-ng-if="orgLine && orgLine == \'false\'" class="clear"></div>\n       <div class="department-link">{{orgName}}</div>\n'+(n?i:"")+"   </div>\n</div>\n"},replace:!0,transclude:!0,scope:{orgIcon:"@",orgCode:"@",orgHref:"@",orgName:"@",orgLine:"@",addPos:"=?"}}}]).directive("structureImg",["$rootScope",function(t){function o(e){var t;return e?(t=n+(-1!=e.indexOf("img_")?"structure-logo/":"structure-logo/img_")+e,-1!=e.indexOf(".png")&&-1!=e.indexOf(".svg")&&(t+=".png"),t):n+"structure-logo/img_RUSSIA.png"}var n=t.imgPath||"https://gu-st.ru/htdocs/img/";return{restrict:"E",template:'<img data-ng-src="{{imgSrc}}"/>',link:function(n,i,e){n.imgSrc=o(n.orgCode),i.bind("error",function(){i.unbind("error"),i.attr("src",t.imgPath+"structure-logo/img_RUSSIA.png")}),n.$watch("orgCode",function(e,t){e!=t&&i.attr("src",o(n))})},scope:{orgCode:"@"},replace:!0,transclude:!0}}])}(),function(){"use strict";angular.module("epgu").directive("occasion",["$rootScope",function(o){return{restrict:"EA",template:'<div>\n<a class="row" data-ng-if="$root.version == \'dk\'" data-ng-href="/situation/{{occasion.name}}" class="occasion-banner-container">\n   <div class="span_2">\n<img width="80" height="84" data-ng-src="{{icon}}">\n   </div>\n   <div class="span_8">\n       <section class="occasion-inner">\n           <h2 class="service-h3 bold">{{occasion.shortTitle}}</h2>\n           <p class="plain-text">{{occasion.description}}</p>\n       </section>\n   </div>\n</a>\n<a class="fluid-row" data-ng-if="$root.version == \'pad\'" data-ng-href="/situation/{{occasion.name}}" class="occasion-banner-container">\n<div class="col-nested-6">\n   <div class="col-nested-2 occasion-icon-wrap">\n<img width="102" height="108" data-ng-src="{{icon}}">\n   </div>\n   <div class="col-nested-4">\n       <section class="occasion-inner">\n           <h2 class="service-h3 bold">{{occasion.shortTitle}}</h2>\n           <p class="plain-text">{{occasion.description}}</p>\n       </section>\n   </div>\n   </div>\n</a>\n<a class="fluid-row" data-ng-if="$root.version == \'mob\'" data-ng-href="/situation/{{occasion.name}}" class="occasion-banner-container">\n<div class="col-2 occasion-icon-wrap">\n<img width="86" height="92" data-ng-src="{{icon}}">\n</div>\n<div class="col-4">\n       <section class="occasion-inner">\n           <h2 class="service-h3 bold">{{occasion.shortTitle}}</h2>\n           <p class="plain-text">{{occasion.description}}</p>\n       </section>\n</div>\n</a>\n</div>',transclude:!0,replace:!0,link:function(e,t,n){var i;o.isPageServiceEnabled?e.icon=e.occasion.icon:(e.occasion.icons&&(i=e.occasion.icons.find(function(e){if("small"==e.iconType)return!0})),e.icon=i?i.path:null)},scope:{occasion:"="}}}])}(),function(){"use strict";angular.module("epgu").directive("occasionSmall",["$rootScope",function(o){return{restrict:"EA",template:'<div>\n<a class="row" data-ng-if="$root.version == \'dk\'" data-ng-href="/situation/{{occasion.name}}" class="occasion-banner-container">\n   <div class="span_3">\n<img data-ng-src="{{icon}}">\n   </div>\n   <div class="span_5">\n       <section class="occasion-inner">\n           <h2 class="service-h4 bold">{{occasion.title}}</h2>\n           <p class="plain-text offset-bottom-none">{{occasion.description}}</p>\n       </section>\n   </div>\n</a>\n<a class="fluid-row" data-ng-if="$root.version == \'pad\'" data-ng-href="/situation/{{occasion.name}}" class="occasion-banner-container">\n<div class="col-nested-6">\n   <div class="col-nested-2 occasion-icon-wrap">\n<img data-ng-src="{{icon}}">\n   </div>\n   <div class="col-nested-4">\n       <section class="occasion-inner">\n           <h2 class="service-h4 bold">{{occasion.title}}</h2>\n           <p class="plain-text offset-bottom-none">{{occasion.description}}</p>\n       </section>\n   </div>\n   </div>\n</a>\n<a class="fluid-row" data-ng-if="$root.version == \'mob\'" data-ng-href="/situation/{{occasion.name}}" class="occasion-banner-container">\n<div class="col-2 occasion-icon-wrap">\n<img data-ng-src="{{icon}}">\n</div>\n<div class="col-4">\n       <section class="occasion-inner">\n           <h2 class="service-h4 bold">{{occasion.title}}</h2>\n           <p class="plain-text offset-bottom-none">{{occasion.description}}</p>\n       </section>\n</div>\n</a>\n</div>',transclude:!0,replace:!0,link:function(e,t,n){var i;o.isPageServiceEnabled?e.icon=e.occasion.icon:(e.occasion.icons&&(i=e.occasion.icons.find(function(e){if("small"==e.iconType)return!0})),e.icon=i?i.path:null)},scope:{occasion:"=occasionSmall"}}}])}(),function(){"use strict";angular.module("epgu").directive("paymentBanner",["$rootScope","$document","$window",function(t,e,n){return{restrict:"E",template:'<div ng-init="show = true" class="offset-top"><div class="payment-banner" ng-show="show"> <div class="banner-icon-block">   <div class="icon-center {{bIcon}}"></div> </div> <div class="banner-text-block">   <div class="service-h4" data-ng-bind-html="bTitle"></div>   <div class="plain-text"  data-ng-bind-html="bText"></div>   <div class="banner-button-block">       <a data-ng-class="{\'button-medium\':$root.version === \'mob\', \'button-small\':$root.version !== \'mob\'}" class="btn-base  button-blue" href="{{btnLink}}" ng-mousedown="setMetric()">{{btnText}}</a>   </div> </div> <div >   <a class="close-banner" ng-click="show = !show"></a> </div></div></div>',link:function(e){e.setMetric=function(){t.disableMetric||metricReachGoal("banner_togo_debt")}},replace:!0,scope:{bIcon:"@",bTitle:"@",bText:"@",btnText:"@",btnLink:"@"}}}]).directive("notificationsBanner",["$rootScope","$document","$window","MailDeliveryService","ipCookie",function(e,t,n,o,a){return{restrict:"E",template:'<div><div class="payment-banner" data-ng-class="{\'background-h352\': bBackground === \'h352\', \'background-h340\': bBackground === \'h340\', \'background-w945\': bBackground === \'w945\'}" ng-show="show && !mailsDeliveryOn && mailsDeliveryReady"> <div class="banner-icon-block">   <div class="icon-center {{bIcon}}"></div> </div> <div class="banner-text-block">   <div class="service-h4" data-ng-bind-html="bTitle"></div>   <div class="plain-text"  data-ng-bind-html="bText"></div>   <div class="banner-button-block">       <a data-ng-class="{\'button-medium\':$root.version === \'mob\', \'button-small\':$root.version !== \'mob\'}" class="btn-base  button-blue" target="_self" href="{{btnLink}}">{{btnText}}</a>   </div> </div> <div >   <a class="close-banner" ng-click="bannerClose()"></a> </div></div></div>',link:function(n){function i(e,t){n.mailsDeliveryOn=200!=t||e&&e.status&&"SUBSCRIBED"===e.status,n.mailsDeliveryReady=!0}n.show=!0,navigator.cookieEnabled&&(void 0!==a("mailBanner")?n.show=a("mailBanner"):(a("mailBanner",!0,{domain:e.cookieDomain,path:"/"}),n.show=!0)),n.bannerClose=function(){navigator.cookieEnabled&&a("mailBanner",!1,{domain:e.cookieDomain,path:"/"}),n.show=!1},n.$root.user&&n.$root.user.assuranceLevel&&"AL20"===n.$root.user.assuranceLevel?(n.mailsDeliveryOn=!1,n.mailsDeliveryReady=!1,o.deliveryStatusObj.isChecked?i(o.deliveryStatusObj.data,o.deliveryStatusObj.status):o.checkDeliveryStatus(function(e,t){i(e,t)})):(n.mailsDeliveryOn=!1,n.mailsDeliveryReady=!0)},replace:!0,scope:{bIcon:"@",bTitle:"@",bText:"@",btnText:"@",btnLink:"@",bBackground:"@"}}}])}(),function(){"use strict";angular.module("epgu").directive("occasions",function(){return{restrict:"EA",template:'<div class="other-occasions">\n   <div class="row" data-ng-if="$root.version == \'dk\'">\n       <div data-ng-class-even="\'offset_span_2\'" data-ng-class-odd="\'offset_span_1 clear\'" class="span_10 occasions-tab-block" data-ng-repeat="occasion in occasions"  data-occasion="occasion"></div>\n   </div><div class="fluid-wrap">\n   <div data-ng-if="$root.version == \'pad\'">\n       <div class="fluid-row">\n           <div data-ng-class-odd="\'other-occasions-pad-odd\'" class="col-6 occasions-tab-block" data-ng-repeat="occasion in occasions" data-occasion="occasion"></div>\n       </div>\n   </div>\n</div>\n<div class="fluid-wrap">\n   <div data-ng-if="$root.version == \'mob\'">\n       <div class="offset-top" data-ng-repeat="occasion in occasions" data-occasion="occasion"></div>\n   </div>\n</div>',transclude:!0,replace:!0,link:function(e,t,n){e.splittedOccasions=splitRows(e.occasions,2)},scope:{occasions:"="}}})}(),function(){"use strict";angular.module("epgu").factory("SelectedOccasion",[function(){var t=null;return{set:function(e){t=e},get:function(){return t},clear:function(){t=null}}}]).directive("occasionsMain",["$rootScope","$location","SelectedOccasion",function(i,t,o){function e(n,e){n.loading=!0,n.$watchGroup(["userTypeGosBar","changeHeaderFilter"],function(){e.getMainOccasions().then(function(e){if(!e||200!=e.status)return i.businessmanOccasionDisabled=!0,t.path("/category"),!1;n.occasionsMain=e.data,n.loading=!1,n.createParentUrl=function(e){return i.betaUrl+e.url},n.createChildrenUrl=function(e,t){return t.url?i.betaUrl+t.url:i.betaUrl+"situation/"+e.name+"/"+t.name},n.occasionsNav={clickHandler:function(e){if(e.active)return!1;o.set(e),this.setCategory(e),this.scrollTopButtonTrigger(),this.showScrollButtonInit()},scrollTopButtonTrigger:function(){n.$broadcast("change")},setSavedCategory:function(t){n.occasionsMain.forEach(function(e){t.title===e.title&&t.mnemonic==e.mnemonic&&(e.active=!0)})},setCategory:function(e){n.occasionsMain.forEach(function(e){e.active=!1}),e.active=!0},showScrollButtonInit:function(){var t=0;if("dk"!==i.version)return!1;n.occasionsMain.filter(function(e){return 1==e.active}).forEach(function(e){e.parent&&e.parent.length&&e.parent.forEach(function(){t+=1})}),n.showScrollButton=4<=t},setActiveSelectModel:function(){return n.occasionsMain.filter(function(e){return!0===e.active})[0]}},t.search().category?(console.log(t.search().category),n.occasionsNav.setCategory(n.occasionsMain.filter(function(e){return e.mnemonic===t.search().category})[0])):o.get()?n.occasionsNav.setSavedCategory(o.get()):n.occasionsNav.setCategory(n.occasionsMain[0]),n.occasionsNav.showScrollButtonInit()})})}return e.$inject=["$scope","CatalogService"],{restrict:"EA",templateUrl:window.templatePath+"/tpl/occasionsMain-b030732efa.html",replace:!0,controller:e}}])}(),function(){"use strict";angular.module("epgu").directive("occasionsSmall",function(){return{restrict:"EA",template:'<div class="other-occasions">\n   <div class="row" data-ng-if="$root.version == \'dk\'">\n       <div data-ng-class-even="\'offset_span_1\'" data-ng-class-odd="\'clear\'" class="span_8 occasions-tab-block offset-bottom-md" data-ng-repeat="occasion in occasions" data-ng-if="$index < 4" data-occasion-small="occasion"></div>\n   </div><div data-ng-if="$root.version == \'pad\'" class="fluid-wrap">\n   <div>\n       <div class="fluid-row">\n           <div data-ng-class-odd="\'other-occasions-pad-odd\'" class="col-6 occasions-tab-block offset-bottom-md" data-ng-repeat="occasion in occasions" data-occasion-small="occasion"></div>\n       </div>\n   </div>\n</div>\n<div data-ng-if="$root.version == \'mob\'" class="fluid-wrap offset-bottom-md">\n   <div>\n       <div class="offset-top" data-ng-repeat="occasion in occasions" data-occasion-small="occasion"></div>\n   </div>\n</div>',transclude:!0,replace:!0,scope:{occasions:"=occasionsSmall"}}})}(),function(){"use strict";angular.module("epgu").directive("occasionCatalog",["$rootScope",function(o){return{restrict:"EA",template:'<div class="occasion-catalog-wrap">\n<a class="row" data-ng-if="$root.version == \'dk\'" data-ng-href="/situation/{{occasion.name}}" class="occasion-banner-container">\n   <div class="span_2">\n<img data-ng-src="{{icon}}">\n   </div>\n   <div class="span_8">\n       <section class="occasion-inner">\n           <h2 class="service-h4 bold">{{occasion.title}}</h2>\n           <p class="plain-text offset-top-extra-sm offset-bottom-none">{{occasion.description}}</p>\n       </section>\n   </div>\n</a>\n<a class="fluid-row" data-ng-if="$root.version == \'pad\'" data-ng-href="/situation/{{occasion.name}}" class="occasion-banner-container">\n<div class="col-nested-6">\n   <div class="col-nested-2 occasion-icon-wrap">\n<img data-ng-src="{{icon}}">\n   </div>\n   <div class="col-nested-4">\n       <section class="occasion-inner">\n           <h2 class="service-h4 bold">{{occasion.title}}</h2>\n           <p class="plain-text  offset-top-extra-sm offset-bottom-none">{{occasion.description}}</p>\n       </section>\n   </div>\n   </div>\n</a>\n<a class="fluid-row" data-ng-if="$root.version == \'mob\'" data-ng-href="/situation/{{occasion.name}}" class="occasion-banner-container">\n<div class="col-2 occasion-icon-wrap">\n<img data-ng-src="{{icon}}">\n</div>\n<div class="col-4">\n       <section class="occasion-inner">\n           <h2 class="service-h4 bold">{{occasion.title}}</h2>\n           <p class="plain-text  offset-top-extra-sm offset-bottom-none">{{occasion.description}}</p>\n       </section>\n</div>\n</a>\n</div>',transclude:!0,replace:!0,link:function(e,t,n){var i;o.isPageServiceEnabled?e.icon=e.occasion.icon:(e.occasion.icons&&(i=e.occasion.icons.find(function(e){if("small"==e.iconType)return!0})),e.icon=i?i.path:null)},scope:{occasion:"=occasionCatalog"}}}])}(),function(){"use strict";angular.module("epgu").directive("occasionsCatalog",function(){return{restrict:"EA",template:'<div class="other-occasions">\n<div class="fluid-wrap"><h3 class="service-h4 bold offset-top-none catalog-occasions-title">{{title}} <span class="tag-new-catalog">Новинка</span></h3>\n<div class="plain-text catalog-occasions-sign" data-ng-bind-html="sign"></div></div>\n   <div class="row" data-ng-if="$root.version == \'dk\'">\n       <div data-ng-class-even="\'offset_span_2\'" data-ng-class-odd="\'clear\'" class="span_10 occasions-tab-block offset-bottom-md" data-ng-repeat="occasion in occasions" data-ng-if="$index < 4" data-occasion-catalog="occasion"></div>\n   </div><div data-ng-if="$root.version == \'pad\'" class="fluid-wrap">\n   <div>\n       <div class="fluid-row">\n           <div data-ng-class-odd="\'other-occasions-pad-odd\'" class="col-6 occasions-tab-block" data-ng-class="{\'offset-bottom-md\': $index  <= 1, \'offset-bottom-sm\': $index  > 1}" data-ng-repeat="occasion in occasions" data-ng-if="$index < 4" data-occasion-catalog="occasion"></div>\n       </div>\n   </div>\n</div>\n<div data-ng-if="$root.version == \'mob\'" class="fluid-wrap">\n   <div>\n       <div class="offset-top-md" data-ng-repeat="occasion in occasions" data-ng-if="$index < 4" data-occasion-catalog="occasion"></div>\n   </div>\n</div>',transclude:!0,replace:!0,scope:{occasions:"=occasionsCatalog",title:"=",sign:"="}}})}(),function(){"use strict";angular.module("epgu").directive("scrollTo",function(){return{restrict:"A",scope:{scrollTo:"@"},link:function(e,t,n){t.on("click",function(){$("html,body").animate({scrollTop:$(e.scrollTo||t.attr("href")).offset().top},"slow")})}}})}(),function(){"use strict";angular.module("epgu").directive("scrollTopButton",["$timeout",function(o){return{restrict:"A",scope:{topShow:"=",stopElId:"="},link:function(t,n,e){var i=$("#"+t.stopElId);t.$on("change",function(){o(t.scrollFunction)}),t.scrollFunction=function(){var e=i.offset().top;document.body.scrollTop>t.topShow||document.documentElement.scrollTop>t.topShow?(n.css({display:"block"}),n.offset().top+n.height()>=e-t.topShow&&n.css({position:"absolute"}),$(document).scrollTop()+window.innerHeight<e&&n.css("position","fixed")):n.css({display:"none"})},n.on("click",function(){document.body.scrollTop=0,document.documentElement.scrollTop=0}),angular.element(window).bind("scroll",t.scrollFunction),t.$on("$destroy",function(){angular.element(window).off("scroll",t.scrollFunction)})}}}])}(),function(){"use strict";angular.module("epgu").directive("epguQuiz",function(){function e(t,e,n){t.check&&n.checkQuiz(t.quiz,function(){t.showLike=!0},function(e){t.showLike=!1})}return e.$inject=["$scope","$rootScope","quizService"],{restrict:"AE",controller:e,templateUrl:window.templatePath+"/tpl/quiz/"+(SmartPhone.isAny()?SmartPhone.isPhone()?"block-quiz-mob.html":"block-quiz-pad.html":"block-quiz.html"),replace:!0,scope:{quiz:"=quiz",check:"@",href:"@"}}})}(),function(){"use strict";angular.module("epgu").directive("draftButtons",["$rootScope",function(e){return{restrict:"A",transclude:!0,template:"<div data-ng-transclude></div>",link:function(e,t){var n=angular.element(document.querySelector("#footer-wrapper")),i=angular.element(t);window.onscroll=function(){i.offset().top+i.height()>=n.offset().top&&i.addClass("stop").removeClass("move"),$(document).scrollTop()+window.innerHeight<n.offset().top&&i.addClass("move").removeClass("stop")}}}}])}(),function(){"use strict";angular.module("epgu").directive("discountInfo",function(){return{restrict:"E",template:'<div class="disclaimers-container"><div class="disclaimer discount-disclaimer">   <div data-ng-transclude></div>   <span class="icomoon"></span></div></div>',replace:!0,transclude:!0,scope:{}}})}(),function(){"use strict";angular.module("epgu").directive("infoWidget",function(){return{restrict:"E",template:'<div class="b-info-widget {{cls}}" data-ng-style="{\'backgroundColor\': bg}"><div data-ng-if="title" class="plain-text-bold">{{title}}</div><img data-ng-style="{width: iconWidth ? iconWidth : \'auto\'}" data-ng-src="{{$root.staticDomainUrl + icon}}" class="b-info-widget__image" alt="">   <div data-ng-transclude></div></div>',replace:!0,transclude:!0,scope:{bg:"=",icon:"=",title:"=",iconWidth:"=",cls:"="}}})}(),function(){"use strict";angular.module("epgu").directive("timerCounter",["$moment","$interval","$rootScope",function(c,d,u){return{restrict:"E",template:'<span class="b-timer-counter"> {{date}} </span>',replace:!0,link:function(e,t,n){var i,o,a,s,r=c.duration(e.end,"milliseconds"),l=c.duration(e.start,"milliseconds");e.widget&&(s=d(function(){r=c.duration(r-1e3,"milliseconds"),l=c.duration(l-1e3,"milliseconds"),i=r.hours(),o=r.minutes(),a=Math.floor(r.asDays()),e.date=a+" д. "+i+" ч. "+o+" м.",0<l.asMilliseconds()?(e.widget.isSoon=!0,e.widget.isActive=!1,e.widget.isDisabled=!1,u.hideOrderButton=!0):r.asMilliseconds()<=0||a<=0&&i<=0&&o<=0?(d.cancel(s),e.widget.isActive=!1,e.widget.isDisabled=!0,u.hideOrderButton=!0):(e.widget.isActive=!0,e.widget.isDisabled=!1,u.hideOrderButton=!1)},1e3))},scope:{end:"=",start:"=",widget:"=",cb:"&"}}}])}(),function(){"use strict";angular.module("epgu").directive("integration",function(){return{restrict:"E",template:'<div class="im-info offset-top-x-sm"><div><img data-ng-src="{{icon}}" alt="{{name}}"></div><div class="im-info-title plain-text-bold">{{title}}</div><div class="im-info-name plain-text">{{name}}</div></div>',replace:!0,scope:{icon:"=",title:"@",name:"="}}})}(),function(){"use strict";angular.module("epgu").directive("integrationCancel",function(){function e(n,i,o){function a(e){e&&409==e.status?location.reload():(n.details.error="При отклонении запроса произошла ошибка. <br> Пожалуйста, попробуйте еще раз.",n.details.showCancelModal=!1,n.isDisabled=!1)}function s(e){e&&200==e.status&&(n.backLink?location.href=n.backLink:location.reload()),n.isDisabled=!1}n.isDisabled=!1,n.details.integrationCancel=function(e,t){window.isEmbedded?window.SMUAdapter.notify({eventType:"im_block",eventParams:[{key:"href",value:n.backLink},{key:"isBlocked",value:t}]}):n.isDisabled||(n.isDisabled=!0,(t?(o.disableMetric||metricReachGoal("lk_company_block"),i.integrationBlock(e)):(o.disableMetric||metricReachGoal("lk_request_cancel"),i.integrationCancel(e))).then(s,a))}}return e.$inject=["$scope","LkService","$rootScope"],{restrict:"E",templateUrl:window.templatePath+"/tpl/notifications/details/integration-cancel-206c635646.html",replace:!0,scope:{details:"=",backLink:"@"},controller:e}})}(),function(){"use strict";angular.module("epgu").directive("infiniteScroll",[function(){return{restrict:"A",link:function(e,t,n){var i=t[0];t.bind("scroll",function(){i.scrollTop+i.offsetHeight>=i.scrollHeight&&e.$apply(n.infiniteScroll)})}}}])}(),function(){"use strict";angular.module("epgu").directive("floatSideBar",["$rootScope","$document","$window",function(t,p,f){return{restrict:"A",link:function(e,s,r){var l=parseFloat(r.floatSideBarOffsetTop),c=s.find("#"+r.floatSideBarParentId),d=s.find("#"+r.floatSideBarTargetId),u=s.find("#"+r.floatSideBarRelativeTargetId);"dk"===t.version&&p.on("scroll",function(){var e,t,n,i,o,a;u&&u.length||(u=s.find("#"+r.floatSideBarRelativeTargetId)),d&&d.length||(d=s.find("#"+r.floatSideBarTargetId)),e=f.innerHeight,t=c.offset().top,n=d.height(),i=u.height(),o=u.offset().top,a=p.scrollTop(),t=l<=a-t,o=o+i-e<a,!(i<n)&&t?o?d.css({position:"absolute",bottom:0,top:"auto"}):d.css({position:"fixed",top:l+"px"}):d.css({position:"static"})})}}}])}(),function(){"use strict";angular.module("epgu").directive("touchScrollContainer",[function(){return{restriction:"A",link:function(e,t){var n,i;t[0]&&(t[0].addEventListener("touchstart",function(e){n=t.scrollLeft(),i=e.touches[0].pageX},!1),t[0].addEventListener("touchend",function(e){i=null},!1),t[0].addEventListener("touchmove",function(e){null!==i&&t.scrollLeft(n+(i-e.touches[0].pageX))},!1))}}}]).directive("touchstart",[function(){return function(t,e,n){e.on("touchstart",function(e){t.$apply(function(){t.$eval(n.touchstart)})})}}])}(),function(){"use strict";angular.module("epgu").directive("npsQuiz",function(){return{restrict:"E",template:'<div>\n       <h4>{{answer.title}}</h4>\n       <span class="plain-text">Выберите оценку на шкале от 1 до 10, где 1&nbsp;&ndash;&nbsp;наименьшая вероятность рекомендации, <br class="hide-for-md hide-for-sm">а 10&nbsp;&ndash;&nbsp;наибольшая</span>\n       <div class="submessage cleanfix">\n           <div class="left">\n               <span class="sub-text">Никогда не порекомендую</span>\n<p class="vertical"><span></span></p>\n           </div>\n           <div class="right">\n               <span class="sub-text">Обязательно порекомендую</span>\n<p class="vertical"><span ></span></p>           </div>\n           </div>\n       <div class="choice-all clearfix">\n  <input id="slider" type="text"/>\n    </div>\n</div>\n<div class="choice clearfix">\n    <span class="plain-text">Для нас очень важно знать ваше мнение. Примите участие в опросе, и таким образом вы поможете усовершенствовать наш портал.</span>\n    <span class="plain-text">Что бы мы могли улучшить при оказании услуг на портале?</span>\n</div>\n<div class="wrapper w100">\n    <text-input model="answer.message" type="text" label="Текст сообщения" show-error-tooltip="true" floating></text-input>\n</div>\n</div>',scope:{answer:"="},replace:!1,transclude:!0,link:function(t){t.slider=new Slider("#slider",{ticks:t.answer.labels,ticks_labels:t.answer.labels,value:0,handle:"triangle",tooltip:"always"}),$(t.slider.handle1).css("display","none"),$(t.slider.ticks[0]).css("background","#f1f1f1"),$(t.slider.sliderElem).find(".slider-tick:first, .slider-tick-label:first").one("click",function(){return $(t.slider.handle1).css("display","block"),t.answer.id=t.answer.ticks[0],!0}),t.slider.on("change",function(e){return e.oldValue!=e.newValue&&(e=t.slider.getValue(),$(t.slider.handle1).css("display","block"),$(t.slider.ticks[0]).css("background","#0063b0"),t.answer.id=t.answer.ticks[e-1],t.$apply()),!1})}}})}(),function(){"use strict";angular.module("epgu").directive("popularService",function(){function e(t,e,n){t.serviceClick=function(e){e&&(e.preventDefault(),e.stopPropagation(e)),n.url(t.model.staticHref)}}return e.$inject=["$scope","$rootScope","$location"],{restrict:"E",template:'<div class="epgu-informer" ng-click="serviceClick($event);"><div class="epgu-informer-body-wrapper">\n            <div class="headline">\n                <div class="service" style="background-image: url({{model.icon}})"></div>\n            </div>\n            <div class="body">\n                <h3>{{model.shortTitle}}</h3>\n                <div  class="disabled-block" data-ng-bind-html="model.content | to_trusted"></div>\n            </div>\n        </div></div>',scope:{model:"="},transclude:!0,replace:!0,controller:e}})}(),function(){"use strict";angular.module("epgu").directive("compileHtml",["$compile",function(o){return function(t,n,i){t.$watch(function(e){return e.$eval(i.compileHtml)},function(e){n.html(e),o(n.contents())(t)})}}])}(),function(){"use strict";angular.module("epgu").directive("occasionScroll",["$rootScope","$timeout","$compile",function(u,e,t){return{restrict:"A",scope:{occasionScroll:"=",pageType:"=?"},link:function(d,e,t){function n(){var e=$("#right-bar")[0],t=$("#arrow")[0];if(t&&(t.style.display=d.pageType&&"notLs"==d.pageType?"none":"block"),null==d.fakeBar){var n=document.getElementById("right-bar")&&document.getElementById("right-bar").getBoundingClientRect();if(u.loading||!n||!n.height||!n.width)return;for(var i=getComputedStyle(e,""),o="",a=0;a<i.length;a++)0!=i[a].indexOf("overflow")&&0!=i[a].indexOf("padding")&&0!=i[a].indexOf("border")&&0!=i[a].indexOf("outline")&&0!=i[a].indexOf("box-shadow")&&0!=i[a].indexOf("background")||(o+=i[a]+": "+i.getPropertyValue(i[a])+"; ");d.fakeBar=$("#fakeBar")[0]||document.createElement("div"),d.fakeBar.id="fakeBar",d.fakeBar.style.cssText=o+" box-sizing: border-box; width: "+e.offsetWidth+"px;",e.insertBefore(d.fakeBar,e.firstChild);for(var s=e.childNodes.length,a=1;a<s;a++)d.fakeBar.appendChild(e.childNodes[1]);e.style.height=d.fakeBar.getBoundingClientRect().height+"px",e.style.padding="0",e.style.border="0"}var n=window.outerHeight-e.getBoundingClientRect().height-200,r=$("#custom-footer")[0]||$("#footer-wrapper")[0],l=e.getBoundingClientRect(),c="";d.pageType&&"notLs"==d.pageType?(d.fakeBar.style.height="0px",c=Math.round(l.top-r.getBoundingClientRect().top+300),d.fakeBar.style.height="0px"):(t&&(t.style.marginTop=(120<=n?n:120)+"px"),c=Math.round(l.top+d.fakeBar.getBoundingClientRect().height-r.getBoundingClientRect().top+25)),t=window.outerHeight<e.getBoundingClientRect().height+250?window.outerHeight-e.getBoundingClientRect().height-235:85,l.top-t<=0?l.top-t<=c?(d.fakeBar.className="stop-bar",d.fakeBar.style.top=-c+"px"):(d.fakeBar.className="sticky-bar",d.fakeBar.style.top=t+"px"):(d.fakeBar.className="",d.fakeBar.style.top="")}e[0];d.fakeBar=null,angular.element(window).bind("scroll",n),angular.element(window).bind("click",n),d.$on("$destroy",function(){angular.element(window).off("scroll",n),angular.element(window).off("click",n)})}}}])}(),function(){"use strict";angular.module("epgu").directive("imageSlider",["$rootScope",function(a){return{restrict:"E",template:'<div class="popup_fade popup_mob" data-ng-class="{\'modal-show\' : show}">   <div class="close_slider_mob" ng-click="close()"><span class="mobile-close link-btn view-iphone">Назад</span></div>   <div class="slider-popup">       <div class="icon close-slider" ng-click="close()"></div>       <div data-ng-show="!images.length && !errorLoad" class="slider-load-block">           <div data-throbber="throbber-big" data-show-heading="false"></div>           <div class="lg-h-title-16 md-h-title-18 sm-h-title-16 title-white bold offset-top-extra-sm">Идет загрузка...</div>       </div>       <div data-ng-show="errorLoad" class="slider-load-block">           <div>               <svg width="99px" height="100px" viewBox="0 0 99 100">\n                   <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">\n                       <g id="Error" transform="translate(-603.000000, -331.000000)" fill="#EA405A" fill-rule="nonzero">\n                           <g id="all_be_bad" transform="translate(603.000000, 331.000000)">\n                               <path d="M58.0545229,50 L64.9938042,43.0607187 C67.2242875,40.8302354 67.2242875,37.2366791 64.9938042,35.0061958 C62.7633209,32.7757125 59.1697646,32.7757125 56.9392813,35.0061958 L50,41.9454771 L43.0607187,35.0061958 C40.8302354,32.7757125 37.2366791,32.7757125 35.0061958,35.0061958 C32.7757125,37.2366791 32.7757125,40.8302354 35.0061958,43.0607187 L41.9454771,50 L35.0061958,56.9392813 C32.7757125,59.1697646 32.7757125,62.7633209 35.0061958,64.9938042 C37.2366791,67.2242875 40.8302354,67.2242875 43.0607187,64.9938042 L50,58.0545229 L56.9392813,64.9938042 C59.1697646,67.2242875 62.7633209,67.2242875 64.9938042,64.9938042 C67.2242875,62.7633209 67.2242875,59.1697646 64.9938042,56.9392813 L58.0545229,50 Z" id="Shape"/>\n                               <path d="M49.382716,0 C76.6666667,0 98.7654321,22.345679 98.7654321,50 C98.7654321,77.654321 76.6666667,100 49.382716,100 C22.0987654,100 0,77.654321 0,50 C0,22.345679 22.0987654,0 49.382716,0 Z M49.382716,90.1234568 C71.1111111,90.1234568 88.8888889,72.0987654 88.8888889,50 C88.8888889,27.9012346 71.1111111,9.87654321 49.382716,9.87654321 C27.654321,9.87654321 9.87654321,27.9012346 9.87654321,50 C9.87654321,72.0987654 27.654321,90.1234568 49.382716,90.1234568 Z" id="Shape"/>\n                           </g>\n                       </g>\n                   </g>\n                </svg>           </div>           <div class="lg-h-title-16 md-h-title-18 sm-h-title-16 title-white bold offset-top-sm">При загрузке изображения произошла ошибка</div>       </div>       <div data-ng-show="images.length">           <div class="icon left-arrow" ng-if="images.length > 1" ng-click="previous()"></div>           <div class="icon right-arrow" ng-if="images.length > 1" ng-click="next()"></div>           <div ng-repeat="image in images" ng-show="$index == slideIndex">               <img ng-show="$index == slideIndex" class="slide" ng-src="{{isBase64 == \'true\' ? image : ($root.gepsApiUrl + \'file/download/\' + image)}}">           </div>       </div>   </div></div>',scope:{show:"=",images:"=",slideIndex:"=?",errorLoad:"=",isBase64:"@",closeFunc:"&?"},link:function(t,e,n){var i;function o(e){"Escape"==e.code&&(t.show=!1,t.$apply())}$("#modal-container").append(i=e.find(".popup_fade")),t.isBase64="true"===t.isBase64,t.$watch("show",function(e,t){e!=t&&(a.modalShow=!!e),"dk"===a.version&&(a.modalShow?document.addEventListener("keydown",o):document.removeEventListener("keydown",o))}),t.slideIndex=0,t.next=function(){var e=t.images.length;0<e&&(t.slideIndex=t.slideIndex==e-1?0:t.slideIndex+1)},t.previous=function(){var e=t.images.length;0<e&&(t.slideIndex=0==t.slideIndex?e-1:t.slideIndex-1)},t.close=function(){t.closeFunc?t.closeFunc():t.show=!1},e.on("$destroy",function(){i.remove()})}}}]).directive("simpleImageSlider",["$rootScope",function(e){return{restrict:"E",template:'<div class="simpleImageSlider" ng-style="{width: maxImageWidth, height: maxImageHeight}"      data-ng-class="{inner_bullet : innerBullet === \'true\', imageSlider_withBullet : images.length > 1}">       <div data-ng-show="!images.length" class="content-in-center">           <div data-throbber="throbber-big" data-show-heading="false"></div>       </div>       <div data-ng-show="images.length" class="imageSlider">           <div class="imageSlider_slides-container">               <div ng-if-start="images.length > 1" class="imageSlider_arrow imageSlider_arrow-left"></div>               <div ng-if-end class="imageSlider_switch" ng-click="previous()"></div>               <div class="imageSlider_slides">                   <div ng-repeat="image in images track by $index" ng-show="$index == slideIndex" class="imageSlider_slide">                       <img ng-src="{{isBase64 ? image : ($root.gepsApiUrl + \'file/download/\' + image)}}">                   </div>               </div>               <div ng-if-start="images.length > 1" class="imageSlider_arrow imageSlider_arrow-right"></div>               <div ng-if-end class="imageSlider_switch" ng-click="next()"></div>           </div>           <div data-ng-show="images.length > 1" class="imageSlider_bullet-container">               <span class="imageSlider_bullet"                     data-ng-repeat="image in images track by $index"                     data-ng-class="{\'imageSlider_bullet-selected\' : $index == slideIndex}"                     data-ng-click="$parent.slideIndex = $index"></span>           </div>       </div></div>',scope:{images:"=",slideIndex:"=?",isBase64:"@",maxImageWidth:"@",maxImageHeight:"@",outsideArrow:"@",innerBullet:"@"},link:function(t,e,n){t.slideIndex=0,t.next=function(){var e=t.images.length;0<e&&(t.slideIndex=t.slideIndex==e-1?0:t.slideIndex+1)},t.previous=function(){var e=t.images.length;0<e&&(t.slideIndex=0==t.slideIndex?e-1:t.slideIndex-1)},t.close=function(){t.closeFunc?t.closeFunc():t.show=!1}}}}])}(),function(){"use strict";angular.module("epgu").directive("notificationDashboard",["CMSService","$controller","$ocLazyLoad","MainPageUser","LkService",function(e,n,i,o,t){function a(e,t){i.load(t.pageCtrlPath+"profile-notifications"+(t.disableMetric?".js":"-min.js")).then(function(){e.dashboardContext=!0,n("profileNotificationCtrl",{$scope:e}),o()&&(t.breadcrumbs=[]),e.loadingFeeds=!0})}return a.$inject=["$scope","$rootScope"],{restrict:"A",templateUrl:window.templatePath+"/tpl/notifications/feedsList-b9118c7073.html",controller:a}}])}(),function(){"use strict";angular.module("epgu").directive("incomingWidget",["$rootScope","$timeout","$location","animatedIdScroll",function(u,p,f,m){return{restrict:"E",template:'<div id="{{widgetId}}">               <div data-ng-show="show" id="incoming-widget-{{widgetId}}"></div>               <div data-ng-if="loading" data-throbber="throbber-big" data-show-heading="true"></div>          </div>',scope:{url:"=",urlParams:"=?",renderType:"=?",requestMethod:"=?",widgetId:"@",widgetProps:"=?",widgetMetrics:"=?"},link:function(s,n,e){s.widgetId=s.widgetId||"epgu-incoming-widget",s.show=!1,s.loading=!0,s.needListenClick=s.widgetMetrics&&s.widgetMetrics.onclick,f.hash()===s.widgetId&&p(function(){m.scrollToElement(s.widgetId)},0);function r(e){var t,n=s.widgetMetrics;!u.disableMetric&&n&&n.name&&n[e]&&((t={})[n.name]=n[e],metricReachGoal24845174(n.name,t))}function t(){var e=document.getElementById("incoming-widget-"+s.widgetId);window.rooxWidgetStart&&e?(0,window.rooxWidgetStart)({scheme:"https",wrsHost:s.wrsHost,wrs:"wrs-4.1",widget:u.openPlatformUrl+"widgets/iframe-wrapper/iframe-wrapper.xml",method:"GET",params:s.rooxRequestParams,auth:{tokens:{st:"esia_1.0_",rt:"esia_1.0_"}}},document.getElementById("incoming-widget-"+s.widgetId)).onReady(function(){u.$applyAsync(function(){s.show=!0,s.loading=!1}),window.addEventListener("message",i,!1),s.$on("$destroy",function(){window.removeEventListener("blur",i,!1)});var e={type:"showWidget-"+(s.widgetMetrics&&s.widgetMetrics.name||f.path()),srcUrl:location.href};u.userId&&(e.userId=u.userId),window.postMessage(JSON.stringify({id:"widget.display",pguData:e}),"*"),r("onload")}).onError(function(e,t){s.loading=!1}):p(t,500,!1)}function i(e){if(e&&e.origin&&e.origin===s.originHost)try{var t="widgetClick"===e.data?e.data:JSON.parse(e.data);t&&t.height?(d||(s.widgetProps&&s.widgetProps.userDataFields&&window.postMessage(JSON.stringify({id:"widget.setData",pguData:s.widgetProps.userDataFields}),"*"),d=!0),$(n).find("iframe").height(t.height)):"widgetClick"===t&&s.needListenClick&&l(!0)}catch(e){console.log(e)}}var o,a,l=function(e){var t,n,i,o,a;e?r("onclick"):(t=!1,n=document.querySelector("#incoming-widget iframe"),i=function(){t&&(r("onclick"),u.$applyAsync(function(){top.focus()}))},o=function(){t=!0},a=function(){t=!1},window.addEventListener("blur",i,!1),n.addEventListener("mouseover",o),n.addEventListener("mouseout",a),s.$on("$destroy",function(){window.removeEventListener("blur",i,!1),n.removeEventListener("mouseover",o),n.removeEventListener("mouseout",a)}))},c=document.createElement("a"),d=(c.href=s.url,s.originHost=c.protocol+"//"+c.host.replace(":"+c.port,""),c.href=u.openPlatformUrl,s.wrsHost=c.host,s.rooxRequestParams={renderType:s.renderType||"inline",doTokenInjection:"true",up_requestMethod:s.requestMethod||"post",up_iframeUrl:s.url,features_loaded:"org.jquery.core-1.7.2:org.jquery.core-1.9.1"},s.urlParams&&(s.rooxRequestParams.up_customParams=JSON.stringify(s.urlParams)),!1);window.rooxWidgetStart||((c=document.createElement("script")).src=u.openPlatformUrl+"wrs-4.1/gadgets/js/com.rooxteam.dynamicsize.js",(o=document.createElement("script")).src=u.openPlatformUrl+"widgets/res/js/embed/addwidget-1.2.5.min.js",(a=$("body")).append(c),a.append(o)),t()}}}])}(),function(){"use strict";angular.module("epgu").directive("seoBlock",["CMSService","$rootScope","$location","$timeout",function(e,t,n,i){function o(e){e.seoBlockHTML="",e.block&&e.block[0].content&&(e.seoBlockHTML=e.block[0].content),e.block&&e.block[0].bgImage&&(e.backgroundColor=e.block[0].bgImage),e.selectRegion=function(){t.$broadcast("region-select")},window.APP={regionSelect:{show:e.selectRegion}},i(function(){var e=document.querySelector(".more-block-position"),n=document.getElementById("moreSeoInfoBlock");e.addEventListener("click",function(e){var e=e.target,t=e.id;"showMoreSeoInfoBlock"===t?(n.classList.remove("hide"),e.nextElementSibling.classList.remove("hide")):"hideMoreSeoInfoBlock"===t&&(n.classList.add("hide"),e.previousElementSibling.classList.remove("hide")),e.classList.add("hide")})})}return o.$inject=["$scope"],{scope:{block:"="},restrict:"A",template:'<div ng-if="seoBlockHTML" class="main-seo-block" data-ng-style="{\'background\' : backgroundColor}">   <div class="grid-wrap">       <div compile-html="seoBlockHTML"></div>   </div></div>',controller:o}}])}(),function(){"use strict";angular.module("epgu").directive("dateRangePicker",["$moment","$timeout",function(c,i){return{restrict:"E",link:function(s){s.daysOfWeek=["Пн","Вт","Ср","Чт","Пт","Сб","Вс"],s.enabledMonths=[],s.years=[],s.months=[{key:0,value:"Январь"},{key:1,value:"Февраль"},{key:2,value:"Март"},{key:3,value:"Апрель"},{key:4,value:"Май"},{key:5,value:"Июнь"},{key:6,value:"Июль"},{key:7,value:"Август"},{key:8,value:"Сентябрь"},{key:9,value:"Октябрь"},{key:10,value:"Ноябрь"},{key:11,value:"Декабрь"}];var e=c().year(),t=c().month();s.beginOfCalendar=s.beginOfCalendar||c().year(e-10).startOf("year"),s.endOfCalendar=s.endOfCalendar||c().year(e+10).endOf("year").startOf("day"),s.beginOfCalendarYear=c(s.beginOfCalendar).year(),s.beginOfCalendarMonth=c(s.beginOfCalendar).month(),s.endOfCalendarYear=c(s.endOfCalendar).year(),s.endOfCalendarMonth=c(s.endOfCalendar).month();for(var n=s.endOfCalendarYear;n>=s.beginOfCalendarYear;n--)s.years.push({key:n,value:n});function r(){$(".first-date-in-range").removeClass("first-date-in-range"),$(".last-date-in-range").removeClass("last-date-in-range"),i(function(){$("tr").find("td.date-in-range:first").addClass("first-date-in-range"),$("tr").find("td.date-in-range:last").addClass("last-date-in-range")})}function l(e,t){var n;return e.some(function(e){if(e.key==t)return n=e,!0}),n}s.selectedYear=s.beginOfRange?c(s.beginOfRange).year():e,s.selectedMonth=s.beginOfRange?c(s.beginOfRange).month():t,s.weeks=[],s.selectDay=function(e){!e||e.isBefore(s.beginOfCalendar,"day")||e.isAfter(s.endOfCalendar,"day")||(!s.beginOfRange||s.beginOfRange&&s.endOfRange||!s.endOfRange&&s.beginOfRange.isSame(e,"day")?(s.beginOfRange=e,s.endOfRange=void 0):e<s.beginOfRange?(s.endOfRange=s.beginOfRange,s.beginOfRange=e):s.endOfRange=e,r(),s.rangeChange({begin:s.beginOfRange,end:s.endOfRange}))},s.monthChange=function(e){s.weeks=[],s.selectedMonth=e,s.selectedMonthObj=l(s.enabledMonths,e);var e=c().set({year:s.selectedYear,month:e}),t=e.startOf("month").isoWeekday(),n=e.daysInMonth(),i=0;if(s.weeks.push([]),1<t)for(var o=1;o<t;o++)s.weeks[0].push(0);for(o=1;o<=n;o++){s.weeks[i].length&&s.weeks[i].length%7==0&&(i++,s.weeks.push([]));var a=c([s.selectedYear,s.selectedMonth,o]);s.weeks[i].push({number:o,date:a})}if(s.weeks[i].length<7)for(;s.weeks[i].length<7;)s.weeks[i].push(0);r()},s.yearChange=function(e){s.selectedYear=e,s.selectedYearObj=l(s.years,e),e==s.endOfCalendarYear?s.enabledMonths=s.months.slice(0,s.endOfCalendarMonth+1):e==s.beginOfCalendarYear?s.enabledMonths=s.months.slice(s.beginOfCalendarMonth):s.enabledMonths=s.months;e=s.selectedMonth;(s.selectedMonth<s.enabledMonths[0].key||s.selectedMonth>s.enabledMonths[s.enabledMonths.length-1].key)&&(e=s.enabledMonths[0].key),s.monthChange(e)},s.monthSwitch=function(e){if(0<e){if(s.selectedYear==s.endOfCalendarYear&&s.selectedMonth==s.endOfCalendarMonth)return;11==s.selectedMonth?(s.selectedYear++,s.yearChange(s.selectedYear),s.selectedMonth=0):s.selectedMonth++}else{if(s.selectedYear==s.beginOfCalendarYear&&s.selectedMonth==s.beginOfCalendarMonth)return;0==s.selectedMonth?(s.selectedYear--,s.yearChange(s.selectedYear),s.selectedMonth=11):s.selectedMonth--}s.monthChange(s.selectedMonth)},s.yearChange(s.selectedYear)},scope:{beginOfCalendar:"=?",endOfCalendar:"=?",beginOfRange:"=?",endOfRange:"=?",rangeChange:"&"},template:'<div class="date-range-picker">   <div class="dateRangePicker-head">       <div class="switches-block">           <div class="switch-arrow switch-arrow-left"                data-ng-class="{\'switch-arrow-disabled\' : selectedYear == beginOfCalendarYear && selectedMonth == beginOfCalendarMonth}"                data-ng-click="monthSwitch(-1)"></div>           <simple-select list="enabledMonths"                          selected-item-change-callback="monthChange(item)"                          selected-item-change="setMonth(selectedMonth)"                          selected-item="selectedMonthObj"></simple-select>           <simple-select list="years"                          selected-item-change-callback="yearChange(item)"                          selected-item="selectedYearObj"></simple-select>           <div class="switch-arrow switch-arrow-right"                data-ng-class="{\'switch-arrow-disabled\' : selectedYear == endOfCalendarYear && selectedMonth == endOfCalendarMonth}"                data-ng-click="monthSwitch(1)"></div>       </div>       <div class="daysOfWeek-block">           <div data-ng-repeat="dayOfWeek in daysOfWeek">{{dayOfWeek}}</div>       </div>   </div>   <div class="dateRangePicker-body">       <table>           <tr data-ng-repeat="week in weeks">               <td data-ng-repeat="day in week track by $index"                   data-ng-click="selectDay(day.date)"'+"                   data-ng-class=\"{'date-border' : day.date && (beginOfRange && day.date.isSame(beginOfRange, 'day') || endOfRange && day.date.isSame(endOfRange, 'day')),                                   'date-in-range' : beginOfRange && endOfRange && day.date.isBetween(beginOfRange, endOfRange, 'day'),                                   'day-disabled' : beginOfCalendar && endOfCalendar && (day.date < beginOfCalendar || endOfCalendar < day.date)}\">                   <div class=\"cell-content\">{{day.number || \"\"}}</div>               </td>           </tr>       </table>   </div></div>"}}]).directive("dateRangeSelector",["$moment","$timeout","$rootScope",function(a,s,e){return{restrict:"E",replace:!1,link:function(o){function n(t){o.fakeLabelText="",o.dropdownDates[5].beginOfRange=void 0,o.dropdownDates[5].endOfRange=void 0,t?o.dropdownDates.some(function(e){if(e.key===t.key)return"calendar"===t.key&&(angular.extend(e,t),o.fakeLabelText=t.beginOfRange.format("DD.MM.YY")+" - "+t.endOfRange.format("DD.MM.YY")),o.selectedDropdownDate=e,!0}):o.selectedDropdownDate=o.dropdownDates[0]}o.dropdownDates=[{key:"all",beginOfRange:"inf",endOfRange:"inf",name:"За все время"},{key:"1month",beginOfRange:1e3*a().subtract(1,"months").startOf("day").unix(),endOfRange:1e3*a().startOf("day").unix(),name:"Месяц"},{key:"3months",beginOfRange:1e3*a().subtract(3,"months").startOf("day").unix(),endOfRange:1e3*a().startOf("day").unix(),name:"Три месяца"},{key:"6months",beginOfRange:1e3*a().subtract(6,"months").startOf("day").unix(),endOfRange:1e3*a().startOf("day").unix(),name:"Шесть месяцев"},{key:"1year",beginOfRange:1e3*a().subtract(1,"years").startOf("day").unix(),endOfRange:1e3*a().startOf("day").unix(),name:"Год"},{key:"calendar",beginOfRange:"",endOfRange:"",name:"Указать период"}],o.showAdditionalBlock=!1,o.beginOfCalendar=a().year(2010).startOf("year"),o.endOfCalendar=a().startOf("day"),o.selectedDropdownDate?n(o.selectedDropdownDate):o.selectedDropdownDate=o.dropdownDates[0],o.selectDropdownDate=function(e){if("calendar"===o.selectedDropdownDate.key)o.prevSelectedDropdownDate=angular.copy(o.selectedDropdownDate);else{if(o.selectedDropdownDate==e)return;o.prevSelectedDropdownDate=o.selectedDropdownDate}"calendar"===(o.selectedDropdownDate=e).key?s(function(){o.showAdditionalBlock=!0}):(o.fakeLabelText="",o.dropdownDates[5].beginOfRange=void 0,o.dropdownDates[5].endOfRange=void 0,o.callbackOnChange({selectedDate:o.selectedDropdownDate}))},o.rangeChange=function(e,t){var n,i;e&&t&&(o.fakeLabelText=e.format("DD.MM.YY")+" - "+t.format("DD.MM.YY"),o.dropdownDates[5].beginOfRange=e,o.dropdownDates[5].endOfRange=t,s(function(){o.showAdditionalBlock=!1},500),n=a(o.prevSelectedDropdownDate.beginOfRange),i=a(o.prevSelectedDropdownDate.endOfRange),n.isSame(e,"day")&&i.isSame(t,"day")||o.callbackOnChange({selectedDate:o.selectedDropdownDate}))},o.clickOutCalendar=function(){!o.showAdditionalBlock||o.selectedDropdownDate.beginOfRange&&o.selectedDropdownDate.endOfRange||("calendar"===o.prevSelectedDropdownDate.key?angular.extend(o.selectedDropdownDate,o.prevSelectedDropdownDate):(o.selectedDropdownDate=o.prevSelectedDropdownDate,o.dropdownDates[5].beginOfRange=void 0)),o.showAdditionalBlock=!1},o.$on("formTabChange",function(e,t){n(t)})},scope:{selectedDropdownDate:"=?",callbackOnChange:"&"},template:'<div class="dropdown-dates-block"     data-ng-class="{\'opened-additional-block\' : showAdditionalBlock}">       <dropdown-select items="dropdownDates" model="selectedDropdownDate" label="name" change="selectDropdownDate(selected)"></dropdown-select>       <div class="fake-label" data-ng-show="fakeLabelText">{{fakeLabelText}}</div>       <div click-out="clickOutCalendar()" class="calendar-block" data-ng-if="showAdditionalBlock">           <date-range-picker               begin-of-calendar="beginOfCalendar"               end-of-calendar="endOfCalendar"               begin-of-range="dropdownDates[5].beginOfRange"               end-of-range="dropdownDates[5].endOfRange"               range-change="rangeChange(begin, end)">           </date-range-picker>       </div></div>'}}])}(),angular.module("epgu").directive("primitiveInput",["$rootScope","$timeout",function(e,t){return{templateUrl:window.templatePath+"/js/js/directives/primitives/input/primitiveInput-a407d80ce1.html",replace:!1,restrict:"E",scope:{pguDisabled:"=",valid:"=",label:"@",required:"=",value:"=",maxLength:"@"},link:function(n,e,t){n.id=Math.random().toString(36).substr(2,9),n.valid||(n.valid={isInvalid:!1,message:""}),n.required&&n.$watch("value",function(e,t){e!==t&&void 0===e&&n.validate(e)}),n.validate=function(e,t){e?(n.valid.isInvalid=!1,n.valid.message=""):(n.valid.isInvalid=!0,n.valid.message=t||"Поле обязательно для заполнения")}}}}]),angular.module("epgu").directive("primitiveCheckbox",["$rootScope",function(e){return{restrict:"E",replace:!1,templateUrl:window.templatePath+"/js/js/directives/primitives/checkbox/primitiveCheckbox-9f7bf6a1a1.html",scope:{required:"=",disabled:"=",label:"@",value:"=",onChangeFunc:"&"},link:function(e,t,n){e.toggleChecked=function(){e.disabled||(e.value=!e.value,e.onChangeFunc&&e.onChangeFunc({val:e.value}))}}}}]),angular.module("epgu").directive("primitiveDropdown",["$rootScope","$timeout",function(c,o){return{restrict:"E",replace:!1,templateUrl:window.templatePath+"/js/js/directives/primitives/dropdown/primitiveDropdown-d648a6ed53.html",scope:{required:"=",disabled:"=",label:"@",value:"=",defaultValue:"=",list:"=",otherFields:"=",valid:"=",searchCallback:"&",selectElementCallback:"&",blurCallback:"&",originalList:"=",closeAfterSelect:"=",id:"=",type:"@"},link:function(r,l,e){r.$root=c,r.id=r.id||Math.random().toString(36).substr(2,9),r.isOpen=!1,r.needEmptyField=r.needEmptyField||!1,r.list=r.list||[],r.originalList=r.originalList||r.list&&r.list.slice()||[],r.isSearching=!1,r.closeAfterSelect=void 0===r.closeAfterSelect||r.closeAfterSelect,r.toggleDropdown=function(e){r.isOpen=void 0!==e?e:!r.isOpen,c.$emit("togglePrimitiveDropdown:"+r.id,r.isOpen)},r.selectElement=function(e){r.isSearching=!1,r.isLoading=!1,r.searchCallback&&n(""),e?(r.selectedElement=e,r.value=e.textValue):r.selectedElement=void 0,r.selectedElement&&r.selectElementCallback&&r.selectElementCallback({item:r.selectedElement,list:r.originalList}),"dadata"===r.type&&(r.fullAddress=!r.valid.isInvalid)},r.blurDropdown=function(){r.blurCallback?r.blurCallback():(r.value=r.selectedElement&&r.selectedElement.textValue||"",r.searchCallback&&n("")),r.isSearching=!1,r.closeAfterSelect&&r.toggleDropdown(!1)},r.clickOut=function(){r.toggleDropdown(!1)},r.setHoveredItem=function(e){r.hoveredItem=e},r.keycodes={13:"enter",27:"esc",38:"up",40:"down"},$(document).on("keydown",function(e){r.isOpen&&r.keycodes[e.keyCode]&&(e.preventDefault(),e=r.keycodes[e.keyCode],r.navigation(e))}),r.navigation=function(e){switch(e){case"esc":r.toggleDropdown(!1),$(l).find(".PGU-PrimitiveDropdown-Field").blur();break;case"down":t("next");break;case"up":t("prev");break;case"enter":t("enter")}function t(e){var t,o,a;"enter"===e&&r.list&&r.list.length?r.selectElement(r.hoveredItem):"next"!==e&&"prev"!==e||(o=(t="next"===e)?r.list.length-1:0,a=t?1:-1,r.hoveredItem?r.list.some(function(e,n,i){return r.hoveredItem&&e.value===r.hoveredItem.value&&(t?n<o:o<n)?(c.$applyAsync(function(){r.hoveredItem=i[n+a];var e=l.find("ul"),t=e.find("li")[n+a],t=t?t.offsetHeight:0;e.scrollTop((n+a)*t)}),!0):i.length-1===n&&e.value!==r.hoveredItem.value&&(s(),!0)}):s())}function s(){c.$applyAsync(function(){r.hoveredItem=r.list[0]})}},r.searchCallback&&(r.$watch("value",function(e,t){r.useSearchCallback&&o.cancel(r.useSearchCallback),e!==t&&void 0!==e&&r.isSearching?("dadata"===r.type&&(r.fullAddress=!1),r.useSearchCallback=o(function(){c.$applyAsync(function(){n(e)})},400,!1)):void 0===e&&(n(""),r.selectedElement=void 0)}),n=function(e){r.list=r.searchCallback({searchValue:e,list:r.originalList})}),r.$watch("list",function(e,t){r.hoveredItem&&e&&e.length&&JSON.stringify(e)!==JSON.stringify(t)&&(r.hoveredItem=e[0])});var n,i=r.$watch("defaultValue",function(e,t){e&&(r.selectedElement={textValue:e},i())})}}}]),angular.module("epgu").directive("simpleSelect",["$rootScope","$timeout",function(t,o){return{restrict:"E",replace:!1,link:function(n,i,e){n.list=n.list||[],n.selectedItem=n.selectedItem||n.list[0],n.selectItem=function(e){n.selectedItem=e,n.showList=!1,n.selectedItemChangeCallback({item:e.key})},n.clickOut=function(){n.showList=!1},n.toggle=function(){n.showList=!n.showList,n.showList&&o(function(){var e=angular.element(".simple-select_list .ps-container",i),t=(i.trigger("touchend"),n.list.indexOf(n.selectedItem));-1!==t&&12<=t&&(e.scrollTop(22*(t-3)),e.perfectScrollbar("update"))},50)},t.isDesktop()||(i.on("touchstart",function(e){e.stopPropagation()}),i.on("touchmove",function(e){e.stopPropagation()}),i.on("touchend",function(e){e.stopPropagation()}))},scope:{list:"=?",selectedItem:"=?",selectedItemChangeCallback:"&"},template:'<div class="simple-select"      click-out="clickOut()">   <div class="simple-select_selected-item" data-ng-click="toggle()">       <div class="selected-item-label"             data-ng-class="{\'selected-item-label_focus\' : showList}">{{selectedItem.value}}</div>       <div class="open-arrow-block">           <div class="{{showList ? \'open-arrow-reverse\' : \'open-arrow\'}}"></div>       </div>   </div>   <div class="simple-select_list" data-ng-show="showList">       <perfect-scrollbar wheel-propagation="false">           <ul>               <li data-ng-repeat="item in list"                    data-ng-click="selectItem(item)"                   data-ng-class="{\'is-selected\' : item.key == selectedItem.key}">{{item.value}}</li>           </ul>       </perfect-scrollbar>   </div></div>'}}]),angular.module("epgu").directive("primitiveTag",["$rootScope",function(e){return{restrict:"E",replace:!1,template:'<div class="PGU-Primitive-Tag" ng-if="!hidden"><span class="PGU-Primitive-Tag-Content" ng-bind-html="content"></span><span ng-if="needClose" class="PGU-Primitive-Tag-Close" ng-click="closeTag();"></span><div ng-if="showHint">   <span class="PGU-Primitive-Tag-Hint">       <span data-q-tooltip="{{hint.id}}"></span>       <div data-q-tooltip-container="{{hint.id}}">           <span ng-bind-html="hint.content"></span>       </div>   </span></div></div>',scope:{content:"=",closeCallback:"&",hint:"=?",needClose:"=?"},link:function(n,e,t){n.needClose=void 0===n.needClose||n.needClose,n.closeTag=function(){n.hidden=!0,n.closeCallback&&n.closeCallback()},n.$watch("hint",function(e,t){e&&e.content?(n.hint.id=e.id||Math.random().toString(36).substr(2,9),n.showHint=!0):n.showHint=!1})}}}]),angular.module("epgu").directive("primitiveErrorHint",["$rootScope",function(e){return{restrict:"E",replace:!1,template:'<div class="PGU-Primitive-ErrorHint"><div class="PGU-Primitive-error-bg"></div><div class="PGU-Primitive-error-icon" aria-haspopup="true"></div><div class="PGU-Primitive-error-content">{{error}}</div></div>',scope:{error:"="},link:function(e,t,n){}}}]),angular.module("epgu").directive("clickOut",[function(){return{restrict:"A",scope:{clickOut:"&"},link:function(t,n,e){function i(e){n[0].getBoundingClientRect().width&&n[0].getBoundingClientRect().height&&(n===e.target||n[0].contains(e.target)||t.$applyAsync(t.clickOut()))}document.addEventListener("mousedown",i),t.$on("$destroy",function(){document.removeEventListener("mousedown",i)})}}}]),angular.module("epgu").directive("whenScrolled",["$rootScope","$timeout","$compile",function(e,t,n){return{restrict:"A",link:function(e,t,n){var i=t[0];t.bind("scroll",function(){i.scrollTop+i.offsetHeight>=i.scrollHeight&&e.$apply(n.whenScrolled)})}}}]),function(){"use strict";angular.module("epgu").directive("datePicker",["$rootScope","$moment","$timeout","$window",function(x,I,e,E){var D="DD.MM.YYYY";function O(e,t){return e.find(function(e){return e.key===t})}function _(e){return e&&(e.startsWith("+")||e.startsWith("-"))}function M(e,t){return e+parseInt(t)}function T(e,t){var n=/^[+\-](\d+y)?(\d+m)?(\d+d)?$/;if(!t||!n.test(t))throw"Invalid date shift pattern";for(var i=t.match(n),o="+"===t[0],a=I(e),s=1;s<=3;s++){var r=i[s];if(r){var l=parseInt(r.substring(0,r.length-1))*(o?1:-1);switch(r[r.length-1].toUpperCase()){case"Y":a.add(l,"year");break;case"M":a.add(l,"month");break;case"D":a.add(l,"day")}}}return a}return{restrict:"E",require:"ngModel",link:function(s,i,t,n){var e=s,o=t;void 0!==o.minimalYear?_(o.minimalYear)?e.minYear=M(I().year(),o.minimalYear):e.minYear=parseInt(o.minimalYear):e.minYear=I().year(),void 0!==o.maximalYear?_(o.maximalYear)?e.maxYear=M(I().year(),o.maximalYear):e.maxYear=parseInt(o.maximalYear):e.maxYear=I().year(),void 0!==o.minimalDate&&("today"===o.minimalDate.toLowerCase()?e.minDate=I():_(o.minimalDate)?e.minDate=T(I(),o.minimalDate):e.minDate=I(o.minimalDate),e.minYear=e.minDate.year()),void 0!==o.maximalDate&&("today"===o.maximalDate.toLowerCase()?e.maxDate=I():_(o.maximalDate)?e.maxDate=T(I(),o.maximalDate):e.maxDate=I(o.maximalDate),e.maxYear=e.maxDate.year()),e.years=[];for(var a=e.minYear;a<=e.maxYear;a++)e.years.push({key:a,value:a});function r(e){return void 0!==t[e]&&"false"!==t[e]}e.months=[{key:0,value:"Январь"},{key:1,value:"Февраль"},{key:2,value:"Март"},{key:3,value:"Апрель"},{key:4,value:"Май"},{key:5,value:"Июнь"},{key:6,value:"Июль"},{key:7,value:"Август"},{key:8,value:"Сентябрь"},{key:9,value:"Октябрь"},{key:10,value:"Ноябрь"},{key:11,value:"Декабрь"}],e.weeks=[],e.daysOfWeek=["Пн","Вт","Ср","Чт","Пт","Сб","Вс"];function l(){s.ignoreBubbledClickTap||s.hideCalendar(),s.ignoreBubbledClickTap=!1}function c(e){g()&&s.hideCalendar()}function d(){s.scheduleTouchAction=!0}function u(){s.scheduleTouchAction=!1}function p(){s.scheduleTouchAction&&!s.ignoreBubbledClickTap&&s.hideCalendar(),s.ignoreBubbledClickTap=!1}var f=function(){return r("literalModelValue")},m=function(){return r("allowInvalidDates")},g=function(){return r("fixedPositioning")},h=function(){return r("resetDateAllowed")},v=function(){return r("alignRight")},b=function(e){return e?f()?I(e).format(D):e:null},y=function(e){return e&&e!==C.attr("ui-mask-placeholder")?moment(e,D,!0).isValid()?I(e,D).toDate():void 0:null},w=function(e){return e?I(e).format(D):""},k=function(e){return e?f()?I(e,D).isValid()?I(e,D).toDate():null:e:null},S=function(e){return e?f()?e:I(e).format(D):""},C=i.find(".date-picker-input"),$=i.find(".date-picker");n.$render=function(){var e,t;e=s,t=k(n.$modelValue),e.selectedDate=t,e.selectedDateFormatted=I(t).format(D),t=t||I(),e.selectedMonth=I(t).month(),e.selectedYear=I(t).year(),e.selectedYear<e.minYear&&(e.selectedYear=e.minYear),e.selectedYear>e.maxYear&&(e.selectedYear=e.maxYear),e.monthChange(e.selectedMonth),e.yearChange(e.selectedYear),s.selectedDateFormatted=S(n.$modelValue)},C.on("change",function(){var e=y(C.val());s.checkDate(e)?s.selectDay(e):f()&&m()?n.$setViewValue(C.val()||null):n.$render()}),s.onBlur&&C.on("blur",s.onBlur),s.onOpenOrFocus&&C.on("focus",s.onOpenOrFocus),s.hideCalendar=function(){$.hide()},s.preventHiding=function(e){e&&e.stopPropagation()},s.toggle=function(e){var t,n;s.readonly||($.toggle(),g()&&(t=v()?C.outerWidth(!0)-275:0,n=C[0].getBoundingClientRect(),$.css({position:"fixed",left:(n.x||n.left)+t+"px",top:(n.y||n.top)+C.outerHeight(!1)+"px"})),$.is(":visible")&&s.onOpenOrFocus?(s.ignoreBubbledClickTap=!0,s.correctPositionAndScrollIfNeeded(),s.onOpenOrFocus&&s.onOpenOrFocus(i)):e.stopPropagation())},s.correctPositionAndScrollIfNeeded=function(){var e,t=window.outerWidth-($.offset().left+$.width());t<10?(e=10-t,t=($.css("left")||"0px").replace(/\s*/,""),t=parseInt(t.substring(0,t.length-2)),$.css("left",t-e+"px")):g()||$.css("left","unset"),x.isMobile()&&(t=window.outerHeight-($[0].getBoundingClientRect().y+$.height()))<10&&(e=10-t,t=angular.element("html, body").scrollTop(),angular.element("html, body").animate({scrollTop:t+e},300))};E.addEventListener("click",l),E.addEventListener("touchstart",d),E.addEventListener("touchmove",u),E.addEventListener("touchend",p),E.addEventListener("scroll",c),s.$on("HIDE_CALENDAR",s.hideCalendar),s.$on("$destroy",function(){E.removeEventListener("click",l),E.removeEventListener("touchstart",d),E.removeEventListener("touchmove",u),E.removeEventListener("touchend",p),E.removeEventListener("scroll",c)}),s.checkDate=function(e){var t;return null===e?h():(t=!!e,e&&s.minDate&&I(e).isBefore(s.minDate)&&(t=!1),e&&s.maxDate&&I(e).isAfter(s.maxDate)&&(t=!1),(!e||!(I(e).year()<s.minYear||I(e).year()>s.maxYear))&&t)},s.selectDay=function(e){s.checkDate(e)&&(s.selectedDate=e,s.selectedDateFormatted=w(e),n.$setViewValue(b(e)),n.$render(),s.onDateChange&&s.onDateChange(e),s.hideCalendar())},s.monthChange=function(e){s.weeks=[],s.selectedMonth=e,s.selectedMonthItem=O(s.months,e);var e=I().set({year:s.selectedYear,month:e}),t=e.startOf("month").isoWeekday(),n=e.daysInMonth(),i=0;if(s.weeks.push([]),1<t)for(var o=1;o<t;o++)s.weeks[0].push(0);for(o=1;o<=n;o++){s.weeks[i].length&&s.weeks[i].length%7==0&&(i++,s.weeks.push([]));var a=I([s.selectedYear,s.selectedMonth,o]);s.weeks[i].push({number:o,date:a,isLocked:s.minDate&&a.isBefore(s.minDate)||s.maxDate&&a.isAfter(s.maxDate)})}if(s.weeks[i].length<7)for(;s.weeks[i].length<7;)s.weeks[i].push(0)},s.yearChange=function(e){s.selectedYear=e,s.selectedYearItem=O(s.years,e),s.monthChange(s.selectedMonth)},s.monthSwitch=function(e){this.preventHiding(),0<e?s.selectedYear===s.maxYear&&11===s.selectedMonth||(11===s.selectedMonth?(s.selectedMonth=0,s.yearChange(s.selectedYear+1)):s.monthChange(s.selectedMonth+1)):s.selectedYear===s.minYear&&0===s.selectedMonth||(0===s.selectedMonth?(s.selectedMonth=11,s.yearChange(s.selectedYear-1)):s.monthChange(s.selectedMonth-1))}},scope:{literalModelValue:"@",minimalYear:"@",maximalYear:"@",minimalDate:"@",maximalDate:"@",resetDateAllowed:"@",allowInvalidDates:"@",fixedPositioning:"@",externalClass:"=",alignRight:"@",onDateChange:"&",onOpenOrFocus:"&",onBlur:"&",readonly:"=?"},template:'<div class="date-picker-container relative" data-ng-class="[externalClass]">   <div class="date-picker-field epgu-input-text">       <input type="text" class="date-picker-input" ui-mask="99.99.9999" ui-mask-placeholder="__.__.____" placeholder="__.__.____"           data-ng-model="selectedDateFormatted" data-ng-readonly="readonly"/>       <div class="date-picker-icon" data-ng-if="!readonly" data-ng-click="toggle($event)" data-ng-tap="toggle($event)"></div>   </div>   <div class="date-picker normal" data-ng-class="{\'align-right\': alignRight !== undefined && alignRight !== \'false\'}" style="display: none"             data-ng-scroll="preventHiding($event)" data-ng-click="preventHiding($event)" data-ng-tap="preventHiding($event)">       <div class="datePicker-head">           <div class="switches-block">               <div class="switch-arrow switch-arrow-left"                   data-ng-class="{\'switch-arrow-disabled\' : selectedYear === minYear && selectedMonth === 0}"                   data-ng-click="monthSwitch(-1)" data-ng-tap="monthSwitch(-1)"></div>               <simple-select list="months" data-ng-tap="preventHiding($event)"                          selected-item-change-callback="monthChange(item)"                          selected-item="selectedMonthItem"></simple-select>               <simple-select list="years" data-ng-tap="preventHiding($event)"                          selected-item-change-callback="yearChange(item)"                          selected-item="selectedYearItem"></simple-select>               <div class="switch-arrow switch-arrow-right"                   data-ng-class="{\'switch-arrow-disabled\' : selectedYear === maxYear && selectedMonth === 11}"                   data-ng-click="monthSwitch(1)" data-ng-tap="monthSwitch(1)"></div>           </div>           <div class="daysOfWeek-block">               <div data-ng-repeat="dayOfWeek in daysOfWeek">{{dayOfWeek}}</div>           </div>       </div>       <div class="datePicker-body">           <table>               <tr data-ng-repeat="week in weeks">                   <td data-ng-repeat="day in week track by $index"                       data-ng-click="selectDay(day.date.toDate())" data-ng-tap="selectDay(day.date.toDate())"                       data-ng-class="{\'date-selected\' : day.date.isSame(selectedDate, \'day\'), \'day-disabled\': day.isLocked}">                       <div class="cell-content">{{day.number || ""}}</div>                   </td>               </tr>           </table>       </div>   </div></div>'}}])}(),angular.module("epgu").directive("dadataWidget",["$rootScope","$timeout","DadataService","ngDialog","$q",function(t,c,s,i,o){return{restrict:"E",replace:!1,templateUrl:window.templatePath+"/js/js/directives/dadata/dadata-dac7a63074.html",scope:{addressStr:"=",onChange:"&",placeholder:"@",isGeps:"=",dropdownClass:"=?"},link:function(r,n,e){function l(e,t,n){var i=r.checkboxWidget,o=r.fields,t=t+"",a=s.getCaptionAndValidMsgs(e,t,n);"valid"!=t&&+t<=7&&(r.canOpenFields=-1===["1","6","7"].indexOf(t)),"validate"===e?("4"==t?o.houseCheckbox.value?(!o.building1.value&&r.isOpenedFields&&(o.building1.valid.isInvalid=!o.building1.value,a="Укажите корпус"),o.apartmentCheckbox.value?(a="",r.validateCheckBox()):(a=n?"Укажите офис":"Укажите квартиру/помещение",r.isOpenedFields||c(function(){r.validateCheckBox()}))):a=n?"Проверьте правильность дома":"Укажите дом":"5"==t&&(a=o.apartmentCheckbox.value?"":n?"Укажите офис":"Укажите квартиру/помещение"),a||!r.isOpenedFields||o.apartment.value||o.apartmentCheckbox.value||"valid"==t||(a="Укажите квартиру/помещение",o.apartment.valid.isInvalid=!0),o.addressString.valid.message=a,o.addressString.valid.isInvalid=!!a):"caption"===e&&("4"!=t||r.isOpenedFields||"apartment"===i.lastState?"5"!=t||o.apartment.value?a="":r.isOpenedFields||r.validateCheckBox():r.validateCheckBox(),o.addressString.otherFields.firstFields[0].content=a)}r.dadataId=Math.random().toString(36).substr(2,9),r.mobileVersion="mob"===t.version,r.canOpenFields=!1,r.isOpenedFields=!1,r.checkboxWidget={},r.checkboxWidget.visible=!1,r.placeholder||(r.placeholder="Укажите адрес полностью"),r.fields=s.getStructure(r.addressStr,r.dadataId),angular.extend(r.fields.addressString,{searchCallback:function(e,t){if(e=e&&e.textValue||e,r.checkboxWidget.visible=!1,!e||e.length<3)return r.canOpenFields=!1,r.fields.addressString.value?t:[];var n=[];(t={}).q=e,r.fields.addressString.loading=!0,s.getDadataSuggestions(t,function(e){return l("validate",e.normalized.dadataQcComplete,e.normalized.unparsedParts),l("caption",e.normalized.dadataQcComplete,e.normalized.unparsedParts),e.suggestions.addresses.forEach(function(e,t){n[t]={},n[t].textValue=e.address,n[t].value=e.code,n[t].level=e.level}),r.fields.addressString.list=JSON.parse(JSON.stringify(n)),r.fields.addressString.loading=!1,n},function(){r.fields.addressString.loading=!1,l("validate",6)})},selectElementCallback:function(e,t){r.canOpenFields=!!e,r.fields.addressString.searchCallback(e,t),!r.fields.addressString.valid.isInvalid&&t.length<=1&&(e=r.fields.addressString,(t={}).q=e.value,r.setVisibleAllFields(!0),r.goToNormalize(!1,t)),c(function(){var e=$(n).find(".PGU-PrimitiveDropdown-Field"),t=e.val().length;e.focus(),e[0].setSelectionRange(t,t)},250)},blurCallback:function(){var e={},t=r.fields.addressString.value;r.oldValAddress=t,r.fields.addressString.searchCallback(t),e.q=t,r.clearAllFields(),r.setValidAllFields(!1),r.setDisableAllFields(!1),r.setVisibleAllFields(!0),r.goToNormalize(!1,e)},checkNormalize:function(e,t){r.checkNormalized(e,t)}}),angular.extend(r.fields.houseCheckbox,{callback:function(e){var t=r.fields.house,n=r.fields.building1,i=r.fields.houseCheckbox,o=(r.fields.apartmentCheckbox,!!e);r.fields.houseCheckbox.value=!!e,i.houseVal=o?t.value:i.houseVal,t.disabled=o,t.value=o?void 0:i.houseVal,t.valid={isInvalid:!o&&!t.value,message:o?"":"Поле обязательно для заполнения"},r.isGeps&&(n.valid={isInvalid:o,message:"Поле обязательно для заполнения"}),r.isOpenedFields||l("validate",4)}}),angular.extend(r.fields.apartmentCheckbox,{callback:function(e){var t=r.fields.apartment,n=r.fields.apartmentCheckbox,e=!!e;r.fields.apartmentCheckbox.value=e,n.apartmentVal=e?t.value:n.apartmentVal,t.disabled=e,t.value=e?void 0:n.apartmentVal,t.valid={isInvalid:!e&&!t.value,message:e?"":"Поле обязательно для заполнения"},r.checkboxWidget.visible=!1,r.isOpenedFields||l("validate",5)}}),r.checkBuilding1Valid=function(){r.fields.house;r.fields.houseCheckbox.value&&(r.fields.building1.valid.isInvalid=!r.fields.building1.value)},r.checkNormalized=function(e,t){r.isGeps&&(r.checkValidOfAddrString(),r.fields.addressString.valid.isInvalid)||e.value&&!r.popup.isOpened&&t&&t.done&&t.done(r.lastNormalizedAddresses)},r.prepareAddressStr=function(e){var o="",a="";return e.elements.forEach(function(e,t,n){var i=e.data,t=t<n.length-1?", ":"";6===e.level?(r.hasSixthLevel=!0,r.sixthLevelData=(e.shortType?e.shortType+". ":"")+i):65===e.level&&r.hasSixthLevel&&(e.shortType&&e.shortType,r.sixthLevelData,i=i+" ("+r.sixthLevelData+")"),6!==e.level&&(o+=e.shortType+". "+i+t),65===e.level&&r.hasSixthLevel?a=o:a+=e.shortType+". "+i+t}),a},r.goToNormalize=function(n,e){var t,i=o.defer();for(t in r.fields)r.fields.hasOwnProperty(t)&&(r.fields[t].shortType="");return s.normalizeDadataAddress(e,function(s){var e,t;r.canOpenFields=!!n,s&&!s.emptyCode&&(r.lastNormalizedAddresses=s.address,e=r.prepareAddressStr(s.address),r.fields.index.value=s.postalCode||"",r.fields.index.disabled=!!s.postalCode,s.address.elements.forEach(function(e,t,n){var i=e.data,o=65===e.level?6:e.level,a=11===o&&r.fields.houseCheckbox.value?r.getFieldByLevel(12):r.getFieldByLevel(o);-1===r.excludeToDisableFields.indexOf(e.level)&&(a.disabled=!0),6===o?(r.hasSixthLevel=!0,r.sixthLevelData=(e.shortType?e.shortType+". ":"")+i):65===o&&r.hasSixthLevel&&(i=i+" "+(e.shortType?e.shortType+".":"")+" ("+r.sixthLevelData+")"),a.value=i,a.abbr=e.shortType+".",r.setVisibleFieldByLevel(o),t===n.length-1&&(r.fields.house.disabled=r.fields.house.disabled||r.fields.houseCheckbox.value,r.fields.apartment.disabled=r.fields.apartment.disabled||r.fields.apartmentCheckbox.value,r.setErrorsFields(o),l("validate",s.dadataQcComplete,s.unparsedParts),l("caption",s.dadataQcComplete,s.unparsedParts)),r.isOpenedFields&&r.checkValidOfAddrString()}),t=r.fields.index.value?r.fields.index.value+", ":"",n||"1"!==s.dadataQc&&"2"!==s.dadataQc||"-1"===s.fiasLevel?(r.fields.addressString.value=t+e,r.isDrawed=!0,r.fields.addressString.loading=!1,c(function(){r.dadataDone=!0},1e3)):(r.popup.userAddress=r.oldValAddress,r.popup.normalizeAddress=t+e,r.popup.openDialog()),i.resolve())},function(){}),i.promise},r.openDadataFields=function(e){r.dadataDone=!1;var t=r.fields.addressString.value;r.checkboxWidget.visible=!1,e?(r.dadataDone=!0,r.checkBuilding1Valid()):(r.isDrawed=!1,r.fields.addressString.loading=!0,e={},r.fields.index.value,r.isOpenedFields?(r.canOpenFields=!0,r.isDrawed=!0,r.fields.addressString.loading=!1,r.fields.addressString.valid.message="",r.dadataDone=!0,r.checkValidOfAddrString(),r.checkBuilding1Valid(),r.setErrorsFields(1)):(e.q=t,r.clearAllFields(),r.setValidAllFields(!1),r.setVisibleAllFields(!0),r.setDisableAllFields(!1),r.goToNormalize(!0,e).then(function(){r.validateCheckBox(),r.checkValidOfAddrString(),r.checkBuilding1Valid(),r.setErrorsFields(1)})))},r.levelToField={1:"region",3:"district",4:"city",5:"inCityDist",6:"town",7:"street",11:"house",12:"building1",13:"building2",14:"apartment",90:"additionalArea",91:"additionalStreet",100:"index"},r.excludeToDisableFields=[11,12,13,14],r.setVisibleFieldByLevel=function(e){e={3:[4],4:[3],5:[3,4],6:[3,4,5],7:[3,4,5,6,90,91],90:[3,4,5,6,7,91],91:[3,4,5,6,7,90]}[e];e&&e.length&&e.forEach(function(e){e=r.getFieldByLevel(e);e.visible=!!e.value})},r.checkValidOfAddrString=function(){var t=[];Object.keys(r.fields).forEach(function(e){t.push(r.fields[e])}),r.fields.addressString.valid.isInvalid=!1;for(var e=0;e<t.length;e++)if(t[e].valid&&!0===t[e].valid.isInvalid&&!0===t[e].visible){r.fields.addressString.valid.isInvalid=!0;break}},r.validateCheckBox=function(){r.checkboxWidget=s.getCheckBoxParams("default"),r.fields.houseCheckbox.value&&r.fields.apartmentCheckbox.value?r.checkboxWidget.visible=!1:(r.fields.houseCheckbox.value?r.fields.apartmentCheckbox.value||r.fields.apartment.value||(r.checkboxWidget=s.getCheckBoxParams("apartment"),r.checkboxWidget.callback=r.fields.apartmentCheckbox.callback):r.fields.house.value?!r.fields.house.value||r.fields.apartmentCheckbox.value||r.fields.apartment.value||(r.checkboxWidget=s.getCheckBoxParams("apartment"),r.checkboxWidget.callback=r.fields.apartmentCheckbox.callback):(r.checkboxWidget=s.getCheckBoxParams("house"),r.checkboxWidget.callback=r.fields.houseCheckbox.callback),r.fields.addressString.valid.message=r.checkboxWidget.msg,r.fields.addressString.valid.isInvalid=!!r.checkboxWidget.msg)},r.clearAllFields=function(){r.setSomethingAllFields("value","")},r.setVisibleAllFields=function(e){r.setSomethingAllFields("visible",e)},r.setDisableAllFields=function(e){r.setSomethingAllFields("disabled",e)},r.setValidAllFields=function(t){r.fields.addressString.valid.isInvalid=t,Object.keys(r.levelToField).forEach(function(e){r.getFieldByLevel(e).valid.isInvalid=t})},r.setSomethingAllFields=function(t,n){Object.keys(r.levelToField).forEach(function(e){r.getFieldByLevel(e)[t]=n})},r.setErrorsFields=function(e){e={1:[3,4,6,7,11,12,13,14,100],3:[6,7,11,14,100],4:[6,7,11,14,100],5:[7,11,14,100],6:[7,11,14,100],7:[11,14,100],11:[11,14],12:[12,13],14:[14],90:[11,14,100],91:[11,14,100]}[e];e&&e.length&&e.forEach(function(e){var t,n,i=r.getFieldByLevel(e);3===e||4===e?(t=!(r.getFieldByLevel(3).value||r.getFieldByLevel(4).value),i.valid.isInvalid=t):6===e?(t=!!r.getFieldByLevel(3).value&&!i.value,i.valid.isInvalid=t):7===e?(t=!!r.getFieldByLevel(4).value&&!r.getFieldByLevel(6).value&&!i.value,i.valid.isInvalid=t):11===e?(t=!(n=r.fields.houseCheckbox).value&&!n.houseVal&&!i.value,i.valid.isInvalid=t):14===e?(t=!(n=r.fields.apartmentCheckbox).value&&!n.apartmentVal&&!i.value,i.valid.isInvalid=t):12===e||13===e?(t=!!(n=r.fields.houseCheckbox).value&&!(r.getFieldByLevel(13===e?12:13).value||i.value),i.valid.isInvalid=t):i.valid.isInvalid=!i.value})},r.getFieldByLevel=function(e){e=r.levelToField[e];return r.fields[e]},r.addressStr&&!r.isGeps&&(r.fields.addressString.searchCallback(r.addressStr),r.isOpenedFields=!0,r.openDadataFields()),r.$watch("fields",function(e,t){r.onChange&&r.onChange({dadata:r.fields,id:r.dadataId});var n,i,o,a=r.fields.addressString;r.isOpenedFields&&r.dadataDone?(n=Object.keys(r.fields),i=["addressString","apartmentCheckbox","houseCheckbox"],o="",n.forEach(function(e,t){var n;-1===i.indexOf(e)&&("index"===e?(n=r.fields[e].value,r.fields.index.valid.isInvalid=!n,n&&(o=n+", "+o)):r.fields[e].value&&(o+=(1<t?", ":"")+(r.fields[e].value?(r.fields[e].shortType||r.fields[e].abbr)+" "+r.fields[e].value:"")))}),a.value=o,r.setErrorsFields(1),a.value=a.value.replace(/[ \t]{2,}/g," ").trim(),","===a.value[a.value.length-1]&&(a.value=a.value.slice(0,-1)),r.checkValidOfAddrString()):""!==a.value&&void 0!==a.value||l("validate","valid")},!0),r.popup={},r.popup.openDialog=function(){r.popup.closedBy="",r.popup.dialog=i.open({template:window.templatePath+"/js/js/directives/dadata/dadataPopup-a3c50d8d9c.html",scope:r.$new(!1,r),preCloseCallback:function(e){"save"!==r.popup.closedBy&&r.popup.edit(void 0,!0)}}),r.popup.isOpened=!0},r.popup.isOpened=!1,r.popup.save=function(e){e&&(e.preventDefault(),e.stopPropagation()),r.fields.addressString.value=r.popup.normalizeAddress,t.$emit("togglePrimitiveDropdown:"+r.dadataId,!0),r.popup.normalizeAddress="",r.popup.userAddress="",r.popup.isOpened=!1,r.popup.closedBy="save",r.popup.dialog.close()},r.popup.edit=function(e,t){e&&(e.preventDefault(),e.stopPropagation()),r.popup.closedBy="edit",t||r.popup.dialog.close(),r.fields.addressString.value=r.popup.normalizeAddress,r.isOpenedFields=!0,r.dadataDone=!0,r.isDrawed=!0,r.openDadataFields(!0),r.popup.isOpened=!1},t.$on("openDadataFields:"+r.dadataId,function(){r.isOpenedFields=!0,r.openDadataFields()}),t.$on("togglePrimitiveDropdown:"+r.dadataId,function(e,t){t&&(r.isOpenedFields=!1,r.dadataDone=!1,r.fields.addressString.searchCallback(r.fields.addressString.value))})}}}]),angular.module("epgu").factory("DadataService",["$rootScope","$timeout","$http",function(i,e,o){return{normalizeDadataAddress:function(e,t,n){e&&e.q?o({url:i.nsiApi+"dadata/normalize"+(e?"?"+$.param(e):""),method:"GET"}).then(function(e){e=e.data;(e&&e.error&&0===e.error.code?t:n)(e)},function(e){n(e)}):"function"==typeof t&&t({emptyCode:!0})},getDadataSuggestions:function(e,t,n){o({method:"GET",url:i.nsiApi+"dadata/suggestions"+(e?"?"+$.param(e):"")}).then(function(e){e=e.data;(e&&e.suggestions&&e.suggestions.addresses&&e.suggestions.addresses.length?t:n)(e)},function(e){n(e)})},getStructure:function(e,t){return{addressString:{list:[],value:e||"",loading:!1,valid:{isInvalid:!1,message:""},otherFields:{firstFields:[{content:"Выберите вариант или продолжите ввод"}],lastFields:[{content:'Не нашли нужный вариант? <a ng-href="" ng-mousedown="$root.$emit(\'openDadataFields:'+t+"'); toggleDropdown(false);\">Укажите адрес вручную</a>"}]}},region:{disabled:!1,valid:{isInvalid:!1,message:"Укажите регион"},required:!1,value:"",level:1,visible:!0,abbr:"обл."},city:{disabled:!1,valid:{isInvalid:!1,message:"Поле обязательно для заполнения"},required:!1,value:"",level:4,visible:!0,abbr:"г."},district:{disabled:!1,valid:{isInvalid:!1,message:"Поле обязательно для заполнения"},required:!1,value:"",level:3,visible:!0,abbr:"р-н."},town:{disabled:!1,valid:{isInvalid:!1,message:"Поле обязательно для заполнения"},required:!1,value:"",level:6,visible:!0,abbr:"пос."},inCityDist:{disabled:!1,valid:{isInvalid:!1,message:"Поле обязательно для заполнения"},required:!1,value:"",level:5,visible:!0,abbr:"тер."},street:{disabled:!1,valid:{isInvalid:!1,message:"Поле обязательно для заполнения"},required:!1,value:"",level:7,visible:!0,abbr:"ул."},additionalArea:{disabled:!1,valid:{isInvalid:!1,message:"Поле обязательно для заполнения"},required:!1,value:"",level:90,visible:!0,abbr:"доп. тер."},additionalStreet:{disabled:!1,valid:{isInvalid:!1,message:"Поле обязательно для заполнения"},required:!1,value:"",level:91,visible:!0,abbr:"доп. ул."},house:{disabled:!1,valid:{isInvalid:!1,message:"Поле обязательно для заполнения"},required:!1,value:"",level:11,visible:!0,abbr:"д."},houseCheckbox:{disabled:!1,required:!1,value:!1,houseVal:""},building1:{disabled:!1,valid:{isInvalid:!1,message:"Поле обязательно для заполнения"},required:!1,value:"",level:12,visible:!0,abbr:"корп."},building2:{disabled:!1,valid:{isInvalid:!1,message:"Поле обязательно для заполнения"},required:!1,value:"",level:13,visible:!0,abbr:"стр."},apartment:{disabled:!1,valid:{isInvalid:!1,message:"Поле обязательно для заполнения"},required:!1,value:"",level:14,visible:!0,abbr:"кв."},apartmentCheckbox:{disabled:!1,required:!1,value:!1,apartmentVal:""},index:{disabled:!1,valid:{isInvalid:!1,message:"Поле обязательно для заполнения"},required:!0,value:"",level:100,visible:!0,abbr:""}}},getCaptionAndValidMsgs:function(e,t,n){return{validate:{1:"Укажите регион",2:n?"Проверьте правильность названия города или населенного пункта":"Укажите город или населенный пункт",3:n?"Проверьте правильность названия улицы":"Укажите улицу",6:"Проверьте правильность адреса",7:"Укажите адрес на территории РФ, использование иностранного адреса недопустимо",valid:""},caption:{1:"Выберите или продолжите ввод региона",2:"Выберите или продолжите ввод города или населенного пункта",3:"Выберите или продолжите ввод улицы",4:"Выберите или продолжите ввод дома",5:"Продолжите ввод квартиры",6:"Выберите вариант или продолжите ввод",7:"Укажите адрес на территории РФ, использование иностранного адреса недопустимо"}}[e][t]||""},getCheckBoxParams:function(e){return{house:{label:"Нет дома",msg:"Укажите дом",value:!1,visible:!0,lastState:"house"},apartment:{label:"Нет квартиры",msg:"Укажите квартиру",value:!1,visible:!0,lastState:"apartment"},default:{label:"",msg:"",value:!0,visible:!1,lastState:""}}[e]}}}]),function(){"use strict";angular.module("epgu").directive("snippets",["$rootScope","$moment","CatalogService","ResetMessages","$location","$filter",function(a,n,e,s,r,i){return{restrict:"E",replace:!0,templateUrl:window.templatePath+"/tpl/directives/snippets-4690eec6de.html",$scope:{notification:"=",snippet:"="},link:function(o){o.openDetails=function(e){var t=a.isLk?"/":a.lkUrl;"GEPS"==e.feedType?e.status&&"draft"===e.status?t+="mail/draft/"+e.extId:t+="mail/message/"+e.id:"DRAFT"==e.feedType&&"B"!==a.userType&&"L"!==a.userType?t+="draft/"+e.extId:t+="notifications/details/"+e.id,!o.dashboardContext&&(r.search("type",null),a.isLk)?r.path(t):window.location=t},o.goToSnippet=function(e,t,n){if(e.preventDefault(),e.stopPropagation(),"Range"!==window.getSelection().type){e=function(e){a.isLk?r.path(e).search("type",null):window.location=a.lkUrl.slice(0,-1)+e};if(n.unread&&s.updateCounter(n.id),t&&t.url&&"EQUEUE"==t.type&&("ORDER"==n.feedType||"DRAFT"==n.feedType||"APPEAL"==n.feedType))e(t.url);else if(t&&"PAYMENT"==t.type)if(n.data.reminder)e("draft/"+n.extId);else{var i="?billNumber="+t.uin;switch(n.feedType){case"ORDER":i+="&orderId="+n.extId+"&senderType=ORDER";break;case"GEPS":i+="&senderType=GEPS"}e=a.paymentUrl+i;window.location=e}else t&&"DRAFT"===t.type&&!a.isOp?-1!==t.url.indexOf("http")?window.location=t.url:o.openDetails(n):t&&"DRAFT"===t.type&&a.isOp?a.$broadcast("open-draft-op",n&&n.extId,!0):o.openDetails(n);return!1}},o.calculateCancelReservationDate=function(e){var t=n(),e=n(e).diff(t,"hours");return e<1||!e?" в ближайшее время":" через "+i("decline")(e,["час","часа","часов"])},o.getGepsDiscountDate=function(e,t){return n(e.discountDate||t.data.DiscountDate).format("DD.MM.YYYY")}}}}])}(),function(){"use strict";angular.module("epgu").directive("regionSearchMap",["$rootScope","$document","$timeout","$http","EpguRegionSearchService",function(u,p,f,e,m){function t(o,a,e){var t,n=a.find("input"),i=a.find(".dropdown-el ul"),s=(o.loading=!1,o.floating=void 0!==e.$attr.floating,o.id=IDSequence.get(),o.placeholder=o.placeholder||"Выберите область, округ, край или республику",o.mapping||{value:"code",originTitle:"name",path:"path",title:"name"}),r=o.withoutpagingonscroll||"",l=o.datainstance||"",c=(o.select=function(e,t,n){o.textValue=t.originTitle,o.change({selected:{id:t.value,title:t.originTitle,path:t.path}}),n?(e.stopPropagation(),f(function(){c()},0)):a.removeClass("opened")},o.hasValue=function(){return o.model&&!$.isEmptyObject(o.model)&&!o.disabled},o.setHighlighted=function(e){o.highlighted=e},o.textValue="",p.find("body"),o.$on("body-click",function(e,t){a.removeClass("opened")}),o.items=[],function(){var e=i.find(".selected");0<e.length&&i.scrollToElement(e,0,150)});function d(e,t,n,i){return o.searchIsEmpty=!1,o.loading=!0,m.loadData({query:e,pageSize:t,pageNum:n,dataInstance:l,mapping:s}).then(function(e){var t;o.items=i?o.items:[],e&&e.list&&e.list.length?(t=function(e){return e.startsWith("Russia, ")?e.substring("Russia, ".length):e.startsWith("Россия, ")?e.substring("Россия, ".length):e},e.list.forEach(function(e){e.title&&(e.title=t(e.title)),e.path&&(e.path=t(e.path)),e.originTitle&&(e.originTitle=t(e.originTitle))}),i?(o.allDataLoaded=!e.list||e.list.length<10,o.items=o.items.concat(e.list)):(o.items=e.list,o.highlighted=null,a.addClass("opened"),f(function(){a.find(".dropdown-el ul").scrollTop(0,150)},0))):o.searchIsEmpty=!0,o.loading=!1},function(e){o.loading=!1})}n.on("click",function(e){!a.hasClass("opened")&&0<o.items.length&&(a.addClass("opened"),o.highlighted=null,c(),e.stopPropagation())}),n.bind("focus",function(){a.addClass("has_content")}),n.bind("blur",function(){a.toggleClass("has_content",0<n.val().length)}),n.bind("keydown",function(e){var t,n=(o.items||[]).findIndex(function(e){return e==o.highlighted});switch(e.keyCode){case 38:a.hasClass("opened")&&(-1===n?n=0:n--,n<0&&(n=(o.items||[]).length-1),o.items)&&o.items.length&&o.$evalAsync(function(){o.highlighted=o.items[n]});break;case 40:a.hasClass("opened")&&(-1===n?n=0:n++,t=function(){n>=(o.items||[]).length&&(n=0),o.items&&o.items.length&&o.$evalAsync(function(){o.highlighted=o.items[n]})},r||o.allDataLoaded?t():d(o.query,10,++o.pageNum,!0).then(t));break;case 13:a.hasClass("opened")&&o.highlighted?o.select(null,o.highlighted,!1):a.toggleClass("opened")}}),n.bind("input",function(){t&&clearTimeout(t),t=setTimeout(function(){o.query=n.val(),o.pageNum=0,o.allDataLoaded=!1,o.highlighted=null,0===o.query.length?(o.searchIsEmpty=!1,o.items=[]):2<o.query.length&&d(o.query,10,0)},700)}),r||i.bind("scroll",function(){o.allDataLoaded||this.scrollTop+this.offsetHeight>=this.scrollHeight&&d(o.query,10,++o.pageNum,!0)}),o.$on("$destroy",function(){n.unbind(),i.unbind()}),u.$on("region-select",function(){o.textValue=""}),o.toggleWidthSearch=function(){o.widthSearch=!o.widthSearch}}return t.$inject=["$scope","$element","$attrs"],{restrict:"E",replace:!0,scope:{model:"=",change:"&",error:"=",fixplaceholder:"@",mapping:"=",withoutpagingonscroll:"=",datainstance:"@"},controller:t,template:"<div class=\"epgu-selectbox region-select region-map-select-container\" ng-class=\"{disabled : disabled, 'floating-placeholder' : floating, 'invalid-field' : error, 'has_content' : !!textValue, 'widthSearchToIcon': widthSearch}\">\n"+'    <label ng-if="fixplaceholder || (model ? model.path : placeholder)" for="_epgu_el{{id}}_input">{{fixplaceholder || (model ? model.path : placeholder)}}</label>    <div class="select-el" id="_epgu_el{{id}}">      <input type="search" epgu-layout-switch class="select-text" ng-class="{\'loading\' : loading}" ng-model="textValue" id="_epgu_el{{id}}_input"/>       <div data-ng-if="loading" class="throbber-search" data-throbber="throbber-small" data-show-heading="false"></div>    </div>    <div class="region-select__wrap_icon_search"><div class="region-select__icon_search" data-ng-click="toggleWidthSearch();"></div></div>    <div class="dropdown-el">\n        <ul>\n            <li ng-class="{selected : model.path == item.path, highlighted : highlighted === item}" ng-repeat="item in items track by $index"               ng-bind="item.title" ng-click="select($event, item)" ng-mouseenter="setHighlighted(item)" ng-mouseleave="setHighlighted(null)">\n        </li>\n       </ul>\n    </div>\n    <div data-ng-show="searchIsEmpty" class="region-select__search-is-empty">Ничего не найдено    </div>\n</div>'}}]).factory("EpguRegionSearchService",["$rootScope","$q","$http",function(n,a,o){return{loadData:function(e){var t;return"yandex"===e.dataInstance?this.geoSearchFromServer(e.query,e.mapping):"dadata"===e.dataInstance?this.geoSearchFromServer(e.query):(t={method:(t={method:e.method||"GET",url:e.url||n.nsiApi+"epgu/region/",cache:e.cache||!0,withCredentials:e.withCredentials||!0}).method,url:t.url,withCredentials:t.withCredentials,cache:t.cache},e.queryParams||(t.params={q:e.query,pageSize:e.pageSize,pageNum:e.pageNum}),this.loadDataRegionsReciver(t,e.mapping))},loadDataRegionsReciver:function(e,t){var n=this,i=a.defer();return o(e).then(function(e){i.resolve({list:n.mapLoadedData(e.data,t,"title",n.convertNameOnPathData)})},function(e){i.reject({error:!0})}),i.promise},mapLoadedData:function(e,i,o,a){return e.map(function(e){var t,n={};for(t in i)i.hasOwnProperty(t)&&(n[t]=e[i[t]],o)&&t===o&&(n[t]=a(e));return n})},convertNameOnPathData:function(e){var t;return~e.path.indexOf("/")?((t=e.path).substr(0,e.path.lastIndexOf("/")).replace(/\//g," / "),e.name+" ("+t+")"):e.name},geoSearchFromServer:function(e,t){var n=this,i=a.defer(),o=window.ymaps;return o?o.geocode(e,{results:5}).then(function(e){var t={list:[]};e.geoObjects.getLength()?t.list=n.geoSearchFromServerMap(e.geoObjects):t.searchIsEmpty=!0,i.resolve(t)},function(e){i.reject({error:!0})}):i.reject({error:"ymaps is not defined"}),i.promise},geoSearchFromServerMap:function(e){for(var t,n=[],i=0,o=e.getLength();i<o;i++)t=e.get(i),n.push({title:t.properties.get("text"),value:t.properties.get("boundedBy"),originTitle:t.properties.get("text"),path:t.properties.get("text")});return n}}}])}(),function(){"use strict";function i(e,t){return e.geometry.coordinates[0]===t.geometry.coordinates[0]&&e.geometry.coordinates[1]===t.geometry.coordinates[1]}angular.module("epgu").directive("epguYandexMap",["$rootScope","$timeout","$q","EpguMapPageService",function(a,e,t,n){var s=function(o){function i(){}function n(e,t){var n;if(e.length)return n=e.position(),new ymaps.shape.Rectangle(new ymaps.geometry.pixel.Rectangle([[n.left,n.top],[n.left+e[0].offsetWidth,n.top+e[0].offsetHeight]]));try{return t.call(this)}catch(e){return new ymaps.shape.Rectangle(new ymaps.geometry.pixel.Rectangle([0,0],[20,20]))}}function a(e,t){var n;if(e.length)return n=e.position(),new ymaps.shape.Rectangle(new ymaps.geometry.pixel.Rectangle([[n.left,n.top],[n.left+e[0].offsetWidth+e.find(".map-balloon-tooltip-tail")[0].offsetWidth,n.top+e[0].offsetHeight]]));try{return t.call(this)}catch(e){return new ymaps.shape.Rectangle(new ymaps.geometry.pixel.Rectangle([0,0],[200,300]))}}function s(e,t){function n(e){return e._el.find(".map-balloon-tooltip-layout")}function i(e){return e._contentLayout}return angular.extend(e,{startDragging:function(e){n(this).removeClass("with-transition"),this.draggingStartPosition=e.originalEvent.touches[0].clientY,this.draggingInitialHeight=n(this).height(),this.dragMoveDetected=!1},dragMove:function(e){this.draggingStartPosition&&this.draggingInitialHeight&&(e=e.originalEvent.touches[0].clientY-this.draggingStartPosition,n(this).css({height:this.draggingInitialHeight-e}),this.dragMoveDetected=!0)},endDragging:function(e){var t;this.draggingStartPosition&&(t=n(this).height(),n(this).addClass("with-transition"),this.dragMoveDetected&&(t>this.draggingInitialHeight?this.expandPanel():this.collapsePanel()),this.draggingStartPosition=this.draggingInitialHeight=this.dragMoveDetected=null)},createContentAreaScroll:function(e){var t=i(this);t&&(t=t.enableScroll(),!o.isMobile())&&e&&(t?n(this).removeClass("auto-height"):n(this).addClass("auto-height"))},destroyContentAreaScroll:function(){var e=i(this);e&&e.disableScroll(),o.isMobile()||n(this).removeClass("auto-height")},collapsePanel:function(){n(this).removeClass("expanded").css({height:""}),this.destroyContentAreaScroll()},expandPanel:function(){var e=angular.element("#"+t).height();n(this).addClass("expanded").css({height:350<.67*e?.67*e:e}),setTimeout(this.createContentAreaScroll.bind(this),300)},toggleExpandCollapse:function(e){n(this).is(".expanded")?this.collapsePanel():this.expandPanel(),e&&e.stopPropagation()}})}i.createZoomInOutLayout=function(){var e=ymaps.templateLayoutFactory.createClass("<div class='controls-container'><div class='zoom-in round-button'></div><div class='zoom-out round-button'></div></div>",{build:function(){e.superclass.build.call(this),angular.element(".zoom-in",this.getElement()).on("click",this.zoomIn.bind(this)),angular.element(".zoom-out",this.getElement()).on("click",this.zoomOut.bind(this))},clear:function(){angular.element(".zoom-in",this.getElement()).off("click"),angular.element(".zoom-out",this.getElement()).off("click"),e.superclass.clear.call(this)},zoomIn:function(){var e=this.getData().control.getMap();e.setZoom(e.getZoom()+1,{checkZoomRange:!0})},zoomOut:function(){var e=this.getData().control.getMap();e.setZoom(e.getZoom()-1,{checkZoomRange:!0})}});return e},i.createGeolocationLayout=function(e){var t=ymaps.templateLayoutFactory.createClass("<div class='controls-container'><div class='geolocation round-button'></div></div>",{build:function(){t.superclass.build.call(this),angular.element(".geolocation",this.getElement()).on("click",this.geolocation.bind(this))},clear:function(){angular.element(".geolocation",this.getElement()).off("click"),t.superclass.clear.call(this)},geolocation:function(){e.navigateHome()}});return t},i.createSingleObjectIconLayout=function(){var t=ymaps.templateLayoutFactory.createClass('<div class="map-pin-icon{% if properties.isHovered %} hovered{% endif %}{% if properties.isSelected %} selected{% endif %}"><div class="map-pin-single-object"></div></div>',{onSublayoutSizeChange:function(){t.superclass.onSublayoutSizeChange.apply(this,arguments),this.events.fire("shapechange")},getShape:function(){var e=angular.element(this.getElement()).find(".map-pin-single-object");return n.call(this,e,t.superclass.getShape)}});return t},i.createClusterIconLayout=function(){var t=ymaps.templateLayoutFactory.createClass('<div class="map-pin-icon{% if properties.isHovered %} hovered{% endif %}{% if properties.isSelected %} selected{% endif %}"><div class="{% if properties.isDivisive %}map-pin-cluster-cluster{% endif %}{% if !properties.isDivisive %}map-pin-cluster-group{% endif %}"><span class="map-pin-items-count">{{ properties.geoObjects.length }}</span></div></div>',{onSublayoutSizeChange:function(){t.superclass.onSublayoutSizeChange.apply(this,arguments),this.events.fire("shapechange")},getShape:function(){var e=angular.element(this.getElement()).find(".map-pin-cluster-group, .map-pin-cluster-cluster");return n.call(this,e,t.superclass.getShape)}});return t},i.createBalloonContentLayout=function(){var e=ymaps.templateLayoutFactory.createClass("<div class='balloon-content-layout'>{% if properties %}<div class='balloon-content-header'><span class='lg-h-title-16-big md-h-title-16-big sm-h-title-16-big bold'>{{properties.officeName}}</span></div><div class='balloon-content-wrap'><div class='balloon-content-scroll-container'><div class='balloon-content-pane break-word'>{% if properties.fullName %}<div class='baloon-content-properties baloon-content-fullname offset-top-extra-sm'><span class='balloon-content-properties-title lg-h-title-14 md-h-title-14 sm-h-title-14 gray'>{{properties.fullName}}</span></div>{%endif %}{% if properties.worktime %}<div class='balloon-content-properties balloon-content-worktime offset-top-extra-sm'><span class='balloon-content-properties-title lg-h-title-14 md-h-title-14 sm-h-title-14 gray'>Режим работы</span><br/><span class='balloon-content-property-value lg-h-title-14 md-h-title-14 sm-h-title-14 dark-gray'>{{properties.worktime|raw}}</span></div>{% endif %}{% if properties.services && properties.services.length %}<div class='balloon-content-properties balloon-content-services offset-top-extra-sm'><span class='balloon-content-properties-title lg-h-title-14 md-h-title-14 sm-h-title-14 gray'>Услуги</span><br/><ul class='balloon-content-properties-list'>{% for service in properties.services %}<li class='balloon-content-properties-item'><span class='balloon-content-property-value lg-h-title-14 md-h-title-14 sm-h-title-14 dark-gray'>{{service.title|raw}}</span></li>{% endfor %}</ul></div>{% endif %}{% if properties.address || properties.email || properties.phones || properties.contacts %}<div class='balloon-content-properties balloon-content-contacts offset-top-extra-sm'><span class='balloon-content-properties-title lg-h-title-14 md-h-title-14 sm-h-title-14 gray'>Адрес и контакты</span><br/>{% if properties.address %}<span class='balloon-content-property-value lg-h-title-14 md-h-title-14 sm-h-title-14 dark-gray'>{{properties.address|raw}}</span><br/>{% endif %}{% if properties.phones %}{% for phone in properties.phones %}<a class='balloon-content-property-value lg-h-title-14 md-h-title-14 sm-h-title-14' href='tel:{{phone}}'>{{phone}}</a>&nbsp;{% endfor %}<br/>{% endif %}{% if properties.email %}<a class='balloon-content-property-value lg-h-title-14 md-h-title-14 sm-h-title-14' href='mailto:{{properties.email}}'>{{properties.email}}</a><br/>{% endif %}{% if properties.contacts %}{% for contact in properties.contacts %}<span class='balloon-content-property-value lg-h-title-14 md-h-title-14 sm-h-title-14 dark-gray'>{{contact}}</span>&nbsp;{% endfor %}{% endif %}</div>{% endif %}{% if properties.urlCard %}<a href='{{properties.urlCard}}' class='display-block offset-bottom-extra-sm'>Перейти к услугам</a><br/>{% endif %}{% if properties.comment %}<div class='balloon-content-properties balloon-content-comment offset-top-extra-sm'><span class='balloon-content-properties-title lg-h-title-14 md-h-title-14 sm-h-title-14 gray'>Комментарий</span><br/><span class='balloon-content-property-value lg-h-title-14 md-h-title-14 sm-h-title-14 dark-gray'>{{properties.comment|raw}}</span></div>{% endif %}</div></div></div>{% endif %}</div>",{build:function(){e.superclass.build.call(this),this._scrollContainer=angular.element(".balloon-content-scroll-container",this.getElement())},clear:function(){this.disableScroll(),e.superclass.clear.call(this)},disableScroll:function(){this._scrollContainer.perfectScrollbar("destroy"),this._scrollContainer.off("touchstart"),this._scrollContainer.parent().addClass("no-shadow")},enableScroll:function(){return this._scrollContainer.perfectScrollbar({suppressScrollX:!0}),this._scrollContainer.on("touchstart",function(e){e.stopPropagation()}),this._scrollContainer.parent().toggleClass("no-shadow",!this._scrollContainer.is(".ps-active-y")),this._scrollContainer.is(".ps-active-y")}});return e};return i.createBalloonLayout=function(e){var t=ymaps.templateLayoutFactory.createClass('<div class="map-balloon-tooltip"><div class="map-balloon-tooltip-layout with-transition"><div class="map-balloon-tooltip-expand-collapse"></div><div class="map-balloon-tooltip-close"></div><div class="map-balloon-tooltip-content">$[[options.contentLayout]]</div></div><div class="map-balloon-tooltip-tail"></div></div>',s({build:function(){var e;t.superclass.build.call(this),this._el=angular.element(this.getElement()),o.isMobile()&&o.isLandscape()&&this._el.find(".map-balloon-tooltip").addClass("landscape-mob"),this._el.find(".map-balloon-tooltip-close").on("click",this.closeBalloon.bind(this)),this._el.find(".map-balloon-tooltip-expand-collapse").on("click",this.toggleExpandCollapse.bind(this)),this._contentLayout=this._sublayouts&&this._sublayouts.length?this._sublayouts[0].instance:null,o.isMobile()&&((e=this._el.find(".map-balloon-tooltip-content")).on("touchstart",this.startDragging.bind(this)),e.on("touchend",this.endDragging.bind(this)),e.on("touchmove",this.dragMove.bind(this))),setTimeout(function(){o.isMobile()?this.destroyContentAreaScroll():this.createContentAreaScroll(!0)}.bind(this))},clear:function(){this._el.find(".map-balloon-tooltip-close").off("click"),this._el.find(".map-balloon-tooltip-expand-collapse").off("click"),o.isMobile()&&this._el.find(".map-balloon-tooltip-content").off(["touchstart","touchend","touchmove"]),this.constructor.superclass.clear.call(this)},onSublayoutSizeChange:function(){t.superclass.onSublayoutSizeChange.apply(this,arguments),this.events.fire("shapechange")},getShape:function(){return a(this._el.find(".map-balloon-tooltip"),t.superclass.getShape)},closeBalloon:function(e){e.preventDefault(),this.events.fire("userclose")}},e));return t},i.createClusterBalloonLayout=function(e){var t=i.createBalloonContentLayout(),n=ymaps.templateLayoutFactory.createClass('<div class="map-balloon-tooltip cluster-balloon-tooltip"><div class="map-balloon-tooltip-layout with-transition"><div class="map-balloon-tooltip-close"></div><div class="map-balloon-tooltip-content"><div class="map-balloon-tooltip-cluster-layout"><div class="map-balloon-tooltip-cluster-switch-panel">{% if properties.geoObjects && properties.geoObjects.length %}<div class="spacer"></div><ul class="map-balloon-tooltip-cluster-switch-panel-list">{% for object in properties.geoObjects %}<li class="map-balloon-tooltip-cluster-switch-panel-item break-word" object-id="{{object.id}}"><a class="map-balloon-tooltip-cluster-switch-panel-link">{{object.properties.officeName}}</a></li>{% endfor  %}</ul>{% endif %}</div><div class="map-balloon-tooltip-cluster-content-panel"></div><div class="map-balloon-tooltip-cluster-back-button"></div><div class="map-balloon-tooltip-expand-collapse"></div></div></div></div><div class="map-balloon-tooltip-tail"></div></div>',s({build:function(){this.constructor.superclass.build.call(this),this._el=angular.element(this.getElement()),o.isMobile()&&o.isLandscape()&&this._el.find(".map-balloon-tooltip").addClass("landscape-mob"),this._el.find(".map-balloon-tooltip-cluster-back-button").on("click",this.resetObjectsSelection.bind(this)),this._el.find(".map-balloon-tooltip-close").on("click",this.closeBalloon.bind(this)),this._el.find(".map-balloon-tooltip-expand-collapse").on("click",this.toggleExpandCollapse.bind(this)),this._el.find(".map-balloon-tooltip-cluster-switch-panel").perfectScrollbar({suppressScrollX:!0}),this._contentLayout=null,o.isMobile()&&((e=this._el.find(".map-balloon-tooltip-content")).on("touchstart",this.startDragging.bind(this)),e.on("touchend",this.endDragging.bind(this)),e.on("touchmove",this.dragMove.bind(this)));var e=this.getData().object,t=e.properties.geoObjects;t&&t.length&&t.forEach(function(e){this._el.find(".map-balloon-tooltip-cluster-switch-panel-item[object-id="+e.id+"] .map-balloon-tooltip-cluster-switch-panel-link").on("click",function(){this.switchObject(e)}.bind(this))}.bind(this)),e.properties.activeObject?(this.switchObject(e.properties.activeObject),delete e.properties.activeObject):o.isMobile()||this.switchObject(t[0])},clear:function(){this._el.find(".map-balloon-tooltip-cluster-switch-panel-link").off("click"),this._el.find(".map-balloon-tooltip-cluster-switch-panel").perfectScrollbar("destroy"),this._el.find(".map-balloon-tooltip-close").off("click"),this._el.find(".map-balloon-tooltip-expand-collapse").off("click"),this._el.find(".map-balloon-tooltip-cluster-back-button").off("click"),o.isMobile()&&this._el.find(".map-balloon-tooltip-content").off(["touchstart","touchend","touchmove"]),this.constructor.superclass.clear.call(this)},onSublayoutSizeChange:function(){n.superclass.onSublayoutSizeChange.apply(this,arguments),this.events.fire("shapechange")},getShape:function(){return a(this._el.find(".map-balloon-tooltip"),n.superclass.getShape)},resetObjectsSelection:function(){this.collapsePanel(),setTimeout(function(){this._el.find(".map-balloon-tooltip-cluster-switch-panel-item").removeClass("selected"),o.isMobile()&&this._el.find(".map-balloon-tooltip-cluster-layout").removeClass("content-expanded"),setTimeout(function(){this._el.find(".map-balloon-tooltip-cluster-content-panel").empty()}.bind(this),500)}.bind(this),300)},switchObject:function(e){this._el.find(".map-balloon-tooltip-cluster-switch-panel-item").removeClass("selected"),this._el.find(".map-balloon-tooltip-cluster-switch-panel-item[object-id="+e.id+"]").addClass("selected"),o.isMobile()&&this._el.find(".map-balloon-tooltip-cluster-layout").addClass("content-expanded"),this._contentLayout&&(this.destroyContentAreaScroll(),this._contentLayout.destroy()),this._contentLayout=new t({properties:e.properties}),this._contentLayout.setParentElement(this._el.find(".map-balloon-tooltip-cluster-content-panel")[0]),setTimeout(function(){o.isMobile()?this.destroyContentAreaScroll():this.createContentAreaScroll(!1)}.bind(this))},closeBalloon:function(e){e.preventDefault(),this.events.fire("userclose")}},e));return n},i}(a),r={homeCoordinates:[],init:function(n,i,o){if(window.ymaps)return window.ymaps.ready().then(function(){this.map=new ymaps.Map(n,{center:[37.64,55.76],zoom:10,controls:[]},{suppressMapOpenBlock:!0});var e=new ymaps.control.GeolocationControl({options:{layout:s.createGeolocationLayout(r),float:"none",position:{top:"calc(100vh/2 - 40px - 98px)",right:24}}}),t=new ymaps.control.ZoomControl({options:{layout:s.createZoomInOutLayout(),float:"none",position:{top:"calc(100vh/2 - 40px - 54px)",right:24}}});this.map.controls.add(e),this.map.controls.add(t),a.isMobile()||(this.map.margin.addArea({left:0,top:0,width:"100%",height:250}),this.map.margin.addArea({right:0,top:0,width:250,height:"100%"})),this.map.events.add("actionend",function(e){this.preventCloseBalloon||this.closeBalloon()}.bind(this)),this.map.events.add("boundschange",function(e){this.requestPoints(e.newBounds),this.preventCloseBalloon||this.closeBalloon()}.bind(this)),this.initObjectManager(i,n),this.refresh(),o&&o.call(i)(this)}.bind(this));throw"Unable to Initialize Map, yandex api missing!"},requestPoints:function(e){return this.map&&this.pointsProvider?this.pointsProvider.getPoints(e||this.map.getBounds()).then(function(e){this.addPoints(e)}.bind(this)):Promise.resolve()},refresh:function(){return this.requestPoints().then(function(){this.map.container.fitToViewport()}.bind(this))},navigateTo:function(e){var t;return this.map&&e&&Array.isArray(e)?e.every(function(e){return Array.isArray(e)})?(t=ymaps.util.bounds.getCenterAndZoom(e,this.map.container.getSize()),this.map.panTo(t.center,{flying:0,duration:1e3}).then(function(){return this.map.setZoom(t.zoom,{smooth:!0,position:t.center,centering:!0})}.bind(this))):this.map.panTo(e,{flying:0,duration:1e3}):Promise.resolve()},navigateHome:function(){this.homeCoordinates&&2===this.homeCoordinates.length&&this.setCenterTo(this.homeCoordinates)},setCenterTo:function(e){this.map&&e&&this.map.setCenter(e)},memorizeHomeCoordinates:function(e){this.homeCoordinates=e},openBalloonFor:function(t){var e;if(this.map&&this.objectManager&&t)return this.closeBalloon(),e=Promise.resolve(),(e=this.objectManager.objects.getById(t.id)?e:this.requestPoints(this.extendPointToLesserArea(t.geometry.coordinates))).then(function(){return this.centerMapOn(t.geometry.coordinates,!0).then(function(){var e;this.objectManager.objects.getAll().find(function(e){return i(t,e)&&t.id!==e})&&this.objectManager.getObjectState(t.id).isClustered?((e=this.objectManager.getObjectState(t.id).cluster).properties=e.properties||{},e.properties.activeObject=t,this.objectManager.clusters.balloon.open(e.id)):this.objectManager.objects.balloon.open(t.id)}.bind(this))}.bind(this))},closeBalloon:function(){this.map.balloon.close(),this.resetObjectsSelection()},applyFilter:function(e){this.closeBalloon(),this.objectManager.setFilter(e),this.refresh()},assignPointsProvider:function(e){this.objectManager&&this.objectManager.removeAll(),(this.pointsProvider=e)&&e.hasCachedState()&&this.addPoints(e.getCachedState()),this.refresh()},resetObjectsSelection:function(){function e(e){var t=e.getData();t&&t.properties&&(t.properties.isSelected=t.properties.isHovered=!1,e.setData(t))}this.objectManager.clusters.overlays.each(e),this.objectManager.objects.overlays.each(e)},selectObject:function(e,t){function n(e){var t=e.getData();t&&t.properties&&(t.properties.isSelected=!0,e.setData(t))}n((t?this.objectManager.clusters:this.objectManager.objects).overlays.getById(e))},destroy:function(){this.objectManager.removeAll(),this.map.destroy()},initObjectManager:function(i,e){function t(n,i){return function(e){var t,e=e.get("objectId");this.objectManager[n?"clusters":"objects"].balloon.isOpen(e)||(t=this.objectManager[n?"clusters":"objects"].getById(e))&&t.properties&&(t.properties.isHovered=i,this.objectManager[n?"clusters":"objects"].overlays.getById(e).setData(t))}}function n(n){return function(e){this.preventCloseBalloon=!0;var e=e.get("objectId"),t=(n?this.objectManager.clusters:this.objectManager.objects).getById(e);this.resetObjectsSelection(),this.selectObject(e,n),this.centerMapOn(t.geometry.coordinates,!1).always(function(){this.preventCloseBalloon=!1}.bind(this)),i.$emit("BALLOON_OPENED")}}function o(){return function(){this.map.container.fitToViewport(),i.$emit("BALLOON_CLOSED")}}this.objectManager=new ymaps.ObjectManager({balloonOffset:[0,-12],useMapMargin:!0,clusterize:!0,minClusterSize:2,gridSize:128,groupByCoordinates:!1}),this.objectManager.objects.options.set({iconLayout:s.createSingleObjectIconLayout(),hideIconOnBalloonOpen:!1}),this.objectManager.clusters.options.set({clusterIconLayout:s.createClusterIconLayout(),disableClickZoom:!0,hideIconOnBalloonOpen:!1}),this.objectManager.objects.events.add("add",function(e){e=this.objectManager.objects.getById(e.get("objectId"));e&&e.properties&&(e.properties.isHovered=e.properties.isSelected=!1)}.bind(this)),this.objectManager.clusters.events.add("add",function(e){var e=this.objectManager.clusters.getById(e.get("objectId")),t=!this.isSameCoordinatesForAllObjects(e.features);e&&e.properties&&(e.properties.isDivisive=t,e.properties.isHovered=e.properties.isSelected=!1)}.bind(this)),this.objectManager.objects.options.set("balloonLayout",s.createBalloonLayout(e)),this.objectManager.objects.options.set("balloonPanelLayout",s.createBalloonLayout(e)),this.objectManager.clusters.options.set("balloonLayout",s.createClusterBalloonLayout(e)),this.objectManager.clusters.options.set("balloonPanelLayout",s.createClusterBalloonLayout(e)),this.objectManager.objects.options.set("balloonContentLayout",s.createBalloonContentLayout()),this.objectManager.clusters.options.set("balloonContentLayout",s.createBalloonContentLayout()),a.isMobile()&&(this.objectManager.objects.options.set("balloonPanelMaxMapArea","Infinity"),this.objectManager.clusters.options.set("balloonPanelMaxMapArea","Infinity")),this.map.events.add("click",function(e){this.closeBalloon()}.bind(this)),this.objectManager.clusters.overlays.events.add("click",function(e){var t=this.objectManager.clusters.getById(e.get("objectId"));if(t&&t.properties&&void 0!==t.properties.isDivisive&&!t.properties.isDivisive)return e.preventDefault(),this.objectManager.clusters.balloon.open(t.id),!1}.bind(this)),this.objectManager.objects.overlays.events.add("mouseenter",t(!1,!0),this),this.objectManager.objects.overlays.events.add("mouseleave",t(!1,!1),this),this.objectManager.clusters.overlays.events.add("mouseenter",t(!0,!0),this),this.objectManager.clusters.overlays.events.add("mouseleave",t(!0,!1),this),this.objectManager.objects.events.add("click",function(e){e=e.get("objectId");this.objectManager.objects.balloon.isOpen(e)||(this.preventCloseBalloon=!0)}.bind(this)),this.objectManager.objects.events.add("balloonopen",n(!1),this),this.objectManager.clusters.events.add("balloonopen",n(!0),this),this.objectManager.objects.balloon.events.add("userclose",this.resetObjectsSelection,this),this.objectManager.clusters.balloon.events.add("userclose",this.resetObjectsSelection,this);this.objectManager.clusters.events.add("balloonclose",o(),this),this.objectManager.objects.events.add("balloonclose",o(),this),this.map.geoObjects.add(this.objectManager)},centerMapOn:function(n,e){return e?this.map.zoomRange.get(n).then(function(t){return this.map.panTo(n).then(function(){var e=1<t.length?Math.min(t[1],16):12;return this.map.setZoom(e,{smooth:!0,position:n,centering:!0}).then(function(){return this.map.panTo(n,{useMapMargin:!0})}.bind(this))}.bind(this))}.bind(this)):this.map.panTo(n,{useMapMargin:!0})},addPoints:function(e){this.map&&this.objectManager&&e&&e.length&&(e=e.filter(function(e){return!this.objectManager.objects.getById(e.id)}.bind(this))).length&&this.objectManager.objects.add(e)},isSameCoordinatesForAllObjects:function(e){var t=e[0];return e.every(function(e){return i(e,t)})},extendPointToLesserArea:function(e){return[[e[0]-1e-4,e[1]-1e-4],[e[0]+1e-4,e[1]+1e-4]]}};return{restrict:"E",template:'<div id="{{yid}}" class="epgu-yandex-map"></div>',scope:{yid:"@yid",afterMapInit:"&?",pointsProvider:"=?",pointsProviderProperty:"@?",filter:"&?",filterProperty:"@"},link:function(t,e,n){var i=[];r.init(t.yid,t,t.afterMapInit).then(function(){i.push(t.$on("MAP_REFRESH",r.refresh.bind(r))),i.push(t.$on("MAP_NAVIGATE_TO",function(e,t){r.navigateTo(t)})),i.push(t.$on("MAP_SET_CENTER_TO",function(e,t){r.memorizeHomeCoordinates(t),r.navigateHome()})),i.push(t.$on("MAP_OPEN_BALLOON_FOR",function(e,t){r.openBalloonFor(t)})),i.push(t.$on("MAP_CLOSE_BALLOON",r.closeBalloon.bind(r))),void 0!==n.pointsProviderProperty?i.push(t.$parent.$watch(n.pointsProviderProperty,function(e){r.assignPointsProvider(e)})):r.assignPointsProvider(t.pointsProvider),void 0!==n.filterProperty?i.push(t.$parent.$watch(n.filterProperty,function(e){r.applyFilter(e)})):r.applyFilter(t.filter)}).catch(function(e){console.error("Map failed to initialize, error: "+e)}),t.$on("$destroy",function(){i.forEach(function(e){e.call(t)}),r.destroy()})}}}])}(),function(){"use strict";angular.module("epgu").controller("electionController",["$scope","$rootScope","$location","$filter","ElectionService","$moment","ngDialog",function(u,p,e,i,f,m,t){u.candidateInfo=null;var a=u.scrollOffset=document.getElementById("profile-review").offsetTop;function s(e,t){return t[4<e%100&&e%100<20?2:[2,0,1,1,1,2][e%10<5?e%10:5]]}function n(e,t){var n=parseInt(e.kolGol,10);t?e.quantityText=i("number")(n)+" "+s(n,[" голос"," голоса"," голосов"]):(e.quantity=n,e.quantityText=s(n,[" голос"," голоса"," голосов"])),e.elected=parseInt(e.perGol,10)>p.izbirkollsElectionPercents}function o(e){var t,n;e.numPostRegProp&&e.datePostRegProp?(t=e.numPostRegProp,n=e.datePostRegProp,e.registrationInfo="Постановление ИКСРФ о регистрации списка кандидатов: №"+t+" от "+n):e.numPostZavProp&&e.datePostZavProp&&(t=e.numPostZavProp,n=e.datePostZavProp,e.registrationInfo="Постановление ИКСРФ о заверении списка кандидатов: №"+t+" от "+n)}function r(e,t){t=t?[" участник референдума"," участника референдума"," участников референдума"]:[" избиратель"," избирателя"," избирателей"];return i("number")(e)+" "+s(e,t)}function l(e,t,n){var i=-1<(n=n||"0,00").indexOf(".")?".":",",n=n.split(i);e[t]={rub:n[0],kop:n[1]}}function c(t,e,n){var i;f.getElectionPayments(e,n).then(function(e){e&&e.data&&(l(i=e.data,"incoming",i.incomingPayments),l(i,"outgoing",i.outgoingPayments),l(i,"return",i.returnPayments),t.payments=i)})}function d(e){e.singleCandidateResultProtocol.results=[];var t=parseInt(e.singleCandidateResultProtocol.kolYes.split(": ")[1],10),n=parseInt(e.singleCandidateResultProtocol.kolNo.split(": ")[1],10),i={quantity:t,quantityText:s(t,[" голос"," голоса"," голосов"]),resultTitle:"За",perGol:e.singleCandidateResultProtocol.kolYesP},o={quantity:n,quantityText:s(n,[" голос"," голоса"," голосов"]),resultTitle:"Против",perGol:e.singleCandidateResultProtocol.kolNoP};e.singleCandidateResultProtocol.results=[i,o].sort(function(e,t){return t.quantity-e.quantity}),e.candidates[0].prVic=n<t}function g(o,e){function t(e,t){var n,i;e.length&&-1<(n=e.findIndex(function(e){return e===o}))&&t[e[n]]&&(t=t[e[n]],f.filterElections(t,t.elections),u.importantElections=t.referendums,i=[],u.importantElections.forEach(function(t){i=i.concat(u.referendums.filter(function(e){return e.vrnVibRef!==t.vrnVibRef}))}),u.referendums=i)}var n=[],n=(u.isImportant=!1,p.pastElections[o]&&p.pastElections[o].elections&&(n=n.concat(p.pastElections[o].elections)),p.importantElections[o]&&p.importantElections[o].elections&&(u.isImportant=!0,n=n.concat(p.importantElections[o].elections)),p.futureElections[o]&&p.futureElections[o].elections&&(n=n.concat(p.futureElections[o].elections)),{elections:n=p.lastVipElections[o]&&p.lastVipElections[o].elections?n.concat(p.lastVipElections[o].elections):n});f.filterElections(n,n.elections),u.electionCampaigns=n.electionCampaigns,u.referendums=n.referendums,u.electionDate=m(o,f.COMMON_DATE_FORMAT).format(f.NSI_DATE_FORMAT),u.isLast=e,u.importantElections=[];t(u.pastDays,p.importantElections),t(u.pastDays,p.lastVipElections)}function h(t,n){window.scrollTo(0,a),f.getCandidateInfo(t).then(function(e){e&&e.data&&(u.candidateInfo=e.data,u.candidateInfo.campaignName=n.namVibor,u.candidateInfo.isElectionResult=n.isElectionResult,c(u.candidateInfo,n.vrnVibRef,t))})}p.tabDkVersion=p.isPad()||!p.isPad()&&!p.isMobile(),u.mobileVersion=p.isMobile(),u.stepMap=f.stepMap,u.urovProved=f.urovProved,p.electionCodes=f.electionCodes,u.actualDate="Данные представлены по состоянию на "+(m(p.actualElectionInfoDate,"DD.MM.YYYY").format("D MMMM YYYY")||m().format("DD.MM.YYYY"))+" года",u.getElectionFullInfo=function(t){var e={urlParams:{electionId:t.vrnVibRef,electionType:t.vidVibref},body:{electionSystem:t.sxemaVib,subjCode:t.subjCod,numUik:t.numUik}};f.getElectionFullInfo(e).then(function(e){e.data&&(Object.assign(t,e.data),t.isElectionResult=!1,t.izbirkiollsHeaderProtocol&&(t.isElectionResult=!0,t.izbirkiollsHeaderProtocol.kolYesVoters=r(t.izbirkiollsHeaderProtocol.kolYes)),t.izbirkolls.forEach(function(e){n(e,!0),o(e)}),t.izbirkollStatus&&(t.statusName=t.izbirkollStatus.statusName,t.fullDescription=t.izbirkollStatus.description),t.groupedCandidates.forEach(function(e){e.candidatesGroupHeaderProtocol&&(e.isElectionResult=!0,t.isElectionResult=!0,e.candidatesGroupHeaderProtocol.kolYesVoters=r(e.candidatesGroupHeaderProtocol.kolYes),e.singleCandidateResultProtocol?d(e):e.candidates.forEach(function(e){n(e)})),e.candidatesGroupStatus&&(e.statusName=e.candidatesGroupStatus.statusName,e.fullDescription=e.candidatesGroupStatus.description)}),t.candidatesHeaderProtocol&&(t.isElectionResult=!0,t.candidatesHeaderProtocol.kolYesVoters=r(t.candidatesHeaderProtocol.kolYes),t.singleCandidateResultProtocol?d(t):t.candidates.forEach(function(e){n(e)})),t.candidatesStatus&&(t.statusName=t.candidatesStatus.statusName,t.fullDescription=t.candidatesStatus.description),t.candidates.length)&&t.candidates.forEach(function(e){e.otch=e.otch||""})},function(e){})},u.getElectionUnitPayments=function(t){f.getElectionUnitPayments(t.vrnVibRef).then(function(e){e&&e.data&&(l(e=e.data,"incoming",e.incomingPayments),l(e,"outgoing",e.outgoingPayments),l(e,"return",e.returnPayments),t.payments=e)})},u.getReferendumInfo=function(t){f.getReferendumFullInfo(t.vrnVibRef).then(function(e){e.data&&(t.referendumInfo=e.data,t.referendumInfo.questions.forEach(function(e){var t,n;e.protocolWithResults&&(e.filteredResults=[],t=parseInt(e.protocolWithResults.kolYes,10),t={percent:e.protocolWithResults.kolYesP,quantity:t,quantityText:s(t,[" голос"," голоса"," голосов"]),text:e.ansYes,result:""},n=parseInt(e.protocolWithResults.kolNo,10),n={percent:e.protocolWithResults.kolNoP,quantity:n,quantityText:s(n,[" голос"," голоса"," голосов"]),text:e.ansNo,result:""},t.quantity>n.quantity?(t.result="Принятое решение",e.filteredResults=[t,n]):(n.result="Принятое решение",e.filteredResults=[n,t]))}),t.referendumInfo.mainHeaderProtocol&&(t.hasMainProtocol=!0),t.referendumInfo.status)&&(e=t.referendumInfo.status,t.namVibor===p.importantElectionName&&(e.statusName=e.statusName.toLowerCase().replace("референдум","Общероссийское голосование").replace("состоялся","состоялось").replace("проводился","проводилось").replace("признан","признано")),t.referendumInfo.statusName=e.statusName,t.referendumInfo.fullDescription=e.description,e.statusCode)&&(e=parseInt(e.statusCode,10),t.referendumInfo.hideResultStatus=p.referendumResultHideStatuses.includes(e))})},u.getAnotherDays=function(){return p.importantElectionDays.some(function(e){return p.importantElections[e]&&p.importantElections[e].voteDate!==u.electionDate})||p.nextElection.some(function(e){return p.futureElections[e]&&p.futureElections[e].voteDate!==u.electionDate})},u.getUikInfo=function(d){var e={subjCode:d.subjCode,uikNum:d.uikNumber};!d.primaryUik&&p.primaryUik&&(e.mainUikNum=d.mainUikNum||p.primaryUik.uikNumber,e.mainSubjCode=d.mainSubjCode||p.primaryUik.regCode),u.step="",f.getUikInfo(e).then(function(e){var t,n,i,o,a,s,r,l,c;e.data&&(Object.assign(d,e.data),n=t=!1,e=d.elections,l=f.NSI_DATE_FORMAT,i=p.actualTimeWithoutOffsets,c=m(d.voteDate,l).subtract(p.changeUikStartDays||45,"days"),o=m(d.voteDate,l).subtract(p.changeUikFinishDays||4,"days"),a=m(d.voteDate,l).subtract(p.homeVotingStartDays||10,"days"),s=m(d.voteDate,l).subtract(p.homeVotingFinishDays||2,"days"),r=m(d.voteDate,l).subtract(p.showCikCallDays||2,"days").endOf("d"),d.homeVotingOrderId&&(p.homeVotingOrderId=d.homeVotingOrderId),r=p.rejectShow=i.diff(r)<0,p.showCikHomeBlock=!r&&!p.homeVotingOrderId,d.changeUikEndDate=o.format(l),d.homeVotingEndDate=s.format(l),d.showChangeUikForm=-1===p.regionsWithoutForm.indexOf(d.regCode)&&(i.isAfter(c)&&i.isBefore(o)||d.regOrderId||d.fedOrderId),d.showHomeVotingForm=!p.showCikHomeBlock&&(i.isAfter(a)&&i.isBefore(s)||d.homeVotingOrderId),d.showFormBlock=d.showChangeUikForm||d.showHomeVotingForm,-1<(l=(e=(r=(d.selfCampaigns||[]).concat(d.selfReferendums||[])).length?r:d.elections).findIndex(function(e){return e.namVibor===p.importantElectionName}))&&(e[l].vipElection=!0),d.regElections=e.filter(function(e){return"1"!==e.vidVibref&&"2"!==e.vidVibref||(n=!0),"0"===e.vidVibref&&e.namVibor!==p.importantElectionName&&(t=!0),"2"===e.urovProved}),d.fedElections=e.filter(function(e){return"1"===e.urovProved}),d.otherLevelElections=e.filter(function(e){return"1"!==e.urovProved&&"2"!==e.urovProved}),c="в день голосования",d.electionsTitle="",n&&t&&(d.electionsTitle=-1===l?"Избирательные кампании и референдумы ":"Избирательные кампании, референдумы "),n&&!t&&(d.electionsTitle="Избирательные кампании "),!n&&t&&(d.electionsTitle="Референдумы "),-1<l?d.electionsTitle?d.electionsTitle=d.electionsTitle+"и общероссийское голосование "+c:d.electionsTitle="":d.electionsTitle+=c,u.step="uik-info")})},u.showDay=function(e){return e!==m(u.electionDate,f.NSI_DATE_FORMAT).format(f.COMMON_DATE_FORMAT)},u.showUikInfo=function(e,t,n,i){window.scrollTo(0,a),u.step="uik-info",t&&n&&(t=(i?p.importantElections:p.futureElections)[m(n,f.NSI_DATE_FORMAT).format(f.COMMON_DATE_FORMAT)],p.uikInfoBase=t.elections[0].uik,p.uikInfoBase.hasConflict=t.hasConflict),u.uikInfo=p.uikInfoBase,u.uikInfo.isImportant=u.isImportant,u.getUikInfo(u.uikInfo),p.hasThirdLevelUik&&u.getUikInfo(p.primaryUik),p.conflictElection&&u.uikInfo.uikNumber!==p.conflictElection.uikNumber&&(u.conflictUikInfo=p.conflictElection,u.getUikInfo(u.conflictUikInfo)),p.disableMetric||window.metricReachGoal24845174("LkElection",{event:u.isImportant?"LkUikORG":e,platform:u.platform,region:p.userSelectedRegion,matchResult:p.primaryUik&&1===p.primaryUik.result?"matched":"unmatched"})},u.openElectionItem=function(e,t){u.step="uik-election-info",e.isOpen=!1,g(e.datGol,!1),"1"===e.vidVibref||"2"===e.vidVibref?u.toggleCampaign(e):u.toggleReferendum(e,null,t),p.disableMetric||window.metricReachGoal24845174("LkElection",{event:"ElectionsFromUik",platform:u.platform,region:p.userSelectedRegion,matchResult:p.primaryUik&&1===p.primaryUik.result?"matched":"unmatched"})},u.toggleCampaign=function(t,e){var n=t.isOpen,i=(e?setTimeout(function(){e.target.scrollIntoView({block:"center",behavior:"smooth"})},200):window.scrollTo(0,a),u.importantElections.forEach(function(e){e.isOpen=!1}),u.electionCampaigns.forEach(function(e){e.isOpen=!1}),u.referendums.forEach(function(e){e.isOpen=!1}),u.electionCampaigns.find(function(e){return e.vrnVibRef===t.vrnVibRef}));i.isOpen=!n,i.isOpen&&(u.getElectionFullInfo(i),u.getElectionUnitPayments(i)),p.campaign=i},u.toggleReferendum=function(t,e,n,i){var o;i||(i=t.isOpen,e?setTimeout(function(){e.target.scrollIntoView({block:"center",behavior:"smooth"})},200):window.scrollTo(0,a),u.electionCampaigns.forEach(function(e){e.isOpen=!1}),n?(u.referendums.forEach(function(e){e.isOpen=!1}),o=u.importantElections.find(function(e){return e.vrnVibRef===t.vrnVibRef}),u.importantElections.forEach(function(e){e.isOpen=!1})):(u.importantElections.forEach(function(e){e.isOpen=!1}),o=u.referendums.find(function(e){return e.vrnVibRef===t.vrnVibRef}),u.referendums.forEach(function(e){e.vrnVibRef!==o.vrnVibRef&&(e.isOpen=!1)})),o.isOpen=!i,o.isOpen&&(u.getReferendumInfo(o),u.getElectionUnitPayments(o)))},u.toggleReferendumProtocol=function(e,t){t.isProtocolOpen=!t.isProtocolOpen,t.isProtocolOpen&&!t.mainProtocol&&f.getReferendumProtocol(t.vrnVibRef).then(function(e){e&&e.data&&(t.mainProtocol=e.data)})},u.toggleIzbirkollProtocol=function(e,t){t.isIzbirkollProtocolOpen=!t.isIzbirkollProtocolOpen,t.isIzbirkollProtocolOpen&&!t.mainIzbircollProtocol&&f.getCommonProtocol(t.vrnVibRef).then(function(e){e&&e.data&&(t.mainIzbircollProtocol=e.data)})},u.toggleGroupProtocol=function(e,t,n){var i;t.isProtocolOpen=!t.isProtocolOpen,t.isProtocolOpen&&!t.mainGroupProtocol&&(i=0<t.okrMaj.numOkr?t.okrMaj.numOkr:null,f.getCommonProtocol(n,i).then(function(e){e&&e.data&&(t.mainGroupProtocol=e.data)}))},u.toggleCandidateProtocol=function(e,t){t.isCandidateProtocolOpen=!t.isCandidateProtocolOpen,t.isCandidateProtocolOpen&&!t.mainCandidateProtocol&&f.getCommonProtocol(t.vrnVibRef).then(function(e){e&&e.data&&(t.mainCandidateProtocol=e.data)})},u.openConsignmentInfo=function(e,n,i){e.preventDefault(),u.step="consignment-info",window.scrollTo(0,a),f.getConsignmentInfo(i.vrnVibRef,n.vrnIO,i.isElectionResult).then(function(t){var e;t.data&&(u.izbirkollInfo=n,u.izbirkollInfo.isElectionResult=i.isElectionResult,u.izbirkollInfo.vrnVibRef=i.vrnVibRef,u.izbirkollInfo.areaPartCandidates=[],u.izbirkollInfo.namVibor=i.namVibor,u.izbirkollInfo.registrationInfo="",o(u.izbirkollInfo),(e=Object.keys(t.data))&&e.length&&e.forEach(function(e){"0"===e?u.izbirkollInfo.commonPartCandidates=t.data[e]:u.izbirkollInfo.areaPartCandidates.push({area:e})}),c(u.izbirkollInfo,i.vrnVibRef,n.vrnIO))})},u.openConsignmentInfoByOkrugNum=function(e,t,n,i,o){e.preventDefault(),t.isOpen=!t.isOpen,t.isOpen&&!t.candidates&&f.getConsignmentInfo(n,o,i,t.area).then(function(e){t.candidates=e.data[t.area]})},u.openConsignmentCandidateInfo=function(e){u.step="candidate-info",h(e.candidate.vrnCand,e.campaign)},u.openFreeCandidateInfo=function(e){u.step="free-candidate-info",h(e.candidate.vrnCand,e.campaign)},p.returnPrevStep=u.returnPrevStep=function(e){e.preventDefault(),"info"===u.stepMap[u.step]&&(p.electionFullMode=!1),"election-info"===u.stepMap[u.step]&&"history-info"===p.initialStep?u.step="history-info":u.step=u.stepMap[u.step]||"/info",window.scrollTo(0,a)},u.openStep=function(e,t){e.preventDefault(),window.scrollTo(0,a),u.step=t},u.openHistory=function(e,t,n){e.preventDefault(),window.scrollTo(0,a),g(t,!f.isDateInFuture(t,m(p.actualTime,f.COMMON_DATE_FORMAT))),u.tryOpenElectionItem(),p.disableMetric||window.metricReachGoal24845174("LkElection",{event:"LkOtherDays",platform:u.platform,region:p.userSelectedRegion,matchResult:p.primaryUik&&1===p.primaryUik.result?"matched":"unmatched"})},u.callEbsCheck=function(){location.href="/auth/bioesia"},u.tryOpenElectionItem=function(){var e=1===u.electionCampaigns.length&&!u.referendums.length&&!u.importantElections.length,t=1===u.referendums.length&&!u.electionCampaigns.length&&!u.importantElections.length,n=1===u.importantElections.length&&!u.electionCampaigns.length&&!u.referendums.length;e?(u.electionCampaigns[0].isOpen=!1,u.toggleCampaign(u.electionCampaigns[0])):t?(u.referendums[0].isOpen=!1,u.toggleReferendum(u.referendums[0])):n&&(u.importantElections[0].isOpen=!1,u.toggleReferendum(u.importantElections[0],null,!0))}}]).controller("evotingController",["$scope","$rootScope","$location","$filter","ElectionService","$moment","$route","ToggleCookie",function(t,n,e,i,o,a,s,r){t.stepMap=o.stepMap,t.urovProved=o.urovProved,n.electionCodes=o.electionCodes,t.loading=!0,n.ebsEnabled?(o.getEvotingStatus().then(function(e){e&&!e.data?(e=r.readCookie("bio_session_id"),r.readCookie("bior_t")?e?o.getEbsAuthResult().then(function(e){e&&e.data&&e.data.extendedResult?(t.loading=!1,t.mockData={campaignName:"Выборы Главы Администрации Липецкой области",urovProved:"2",uikNum:2206,selected:null,candidates:[{id:1,famil:"Петров",imia:"Владимир",otch:"Сергеевич",birthDate:"13.12.1973",pol:"1",izbirkollShortName:'Липецкое региональное отделение Партии "ЕДИНАЯ РОССИЯ"',mestoRoj:"",address:"",proffObr:"",mestoRab:"",dolj:"",mestoDep:""},{id:2,famil:"Васильева",imia:"Алевтина",otch:"Родионовна",birthDate:"24.07.1973",pol:"2",izbirkollShortName:"",mestoRoj:"",address:"",proffObr:"",mestoRab:"",dolj:"",mestoDep:""},{id:3,famil:"Иванов",imia:"Антон",otch:"Семенович",birthDate:"11.03.1980",pol:"1",izbirkollShortName:"Липецкое областное отделение политической партии КПРФ",mestoRoj:"",address:"",proffObr:"",mestoRab:"",dolj:"",mestoDep:""}]}):location.href=n.lkUrl},function(e){o.startEbsAuth().then(function(e){e&&e.data&&e.data.location&&(location.href=e.data.location)})}):location.href=n.lkUrl:location.href="/auth/bio-result-esia"):location.href=n.lkUrl}),t.ebsVote=function(){t.mockData.selected&&o.saveVote().then(function(e){r.eraseCookie("bio_t"),r.eraseCookie("bior_t"),r.eraseCookie("bio_session_id"),t.mockData.votingResult=!0})},t.goToLk=function(){location.href=n.lkUrl}):location.href="/info"}]).directive("profileElectionFull",["$rootScope","ElectionService","$routeParams","ngDialog","$moment",function(t,i,o,a,s){return{restrict:"E",templateUrl:window.templatePath+"/tpl/lk/features/profile-election-full-91734d7c62.html",controller:"electionController",link:function(n){var e;t.ebsEnabled&&n.$watch("step",function(e,t){"election-info"!==e&&"uik-election-info"!==e||i.getEvotingStatus().then(function(e){n.showEvotingButton=e&&e.data})}),window.scrollTo(0,n.scrollOffset),n.step=t.initialStep||"election-info",n.electionCampaigns=t.profileElections.electionCampaigns||[],n.importantElections=t.profileElections.importantElections||[],n.referendums=t.profileElections.referendums||[],n.electionDate=t.profileElections.electionDate,n.isLast=t.profileElections.isLast,n.isImportant=t.profileElections.isImportant,n.pastDays=[].concat(t.importantElectionDays).concat(t.nextElection),n.pastDays=n.pastDays.filter(function(e,t,n){return n.indexOf(e)===t}),n.pastDays.sort(function(e,t){var n=i.COMMON_DATE_FORMAT;return s(e,n).isBefore(s(t,n))?-1:1}),n.platform=t.webViewMode?"MP":"EPGUV3_"+("dk"==t.version?"DESK":"mob"==t.version?"MOB":"TAB"),"uik-info"!==n.step?(n.tryOpenElectionItem(),t.ebsEnabled&&(o.bioLogin&&(n.step="election-info",i.startEbsAuth().then(function(e){e&&e.data&&e.data.location&&(location.href=e.data.location)})),t.userCanVote)&&((e=function(e){e.goToEVoting=function(){location.href="/evoting"}}).$inject=["$scope"],a.open({template:window.templatePath+"/tpl/directives/ebs-check-popup-45fae008a6.html",controller:e}))):n.showUikInfo("LkUik")}}}]).directive("candidates",function(){return{restrict:"E",templateUrl:window.templatePath+"/tpl/lk/features/election/candidates-eeb2450512.html",replace:!0,transclude:!0}}).directive("candidateFull",function(){return{restrict:"E",templateUrl:window.templatePath+"/tpl/lk/features/election/candidate-full-97ac548640.html",replace:!0,transclude:!0}}).directive("groupedCandidates",function(){return{restrict:"E",templateUrl:window.templatePath+"/tpl/lk/features/election/grouped-candidates-1b08264598.html",replace:!0,transclude:!0}}).directive("candidateItem",["$rootScope",function(e){return{restrict:"E",templateUrl:window.templatePath+(e.webViewMode?"/tpl/lk/features/election/candidate-item-webview-415a13c134.html":SmartPhone.isAny()&&SmartPhone.isPhone()?"/tpl/lk/features/election/candidate-item-mob-e368a79901.html":"/tpl/lk/features/election/candidate-item-be00b8ec1a.html"),replace:!0,transclude:!0,scope:{campaign:"=",candidate:"=",openCandidate:"&",index:"="},link:function(i){i.onCandidateClick=function(e,t,n){e.preventDefault(),i.openCandidate({msg:{candidate:t,campaign:n}})}}}}]).directive("uikInfo",function(){return{restrict:"E",templateUrl:window.templatePath+"/tpl/lk/features/election/uik-info-2676f83624.html",replace:!0,transclude:!0}}).directive("uik",["$rootScope",function(e){return{restrict:"E",templateUrl:window.templatePath+"/tpl/lk/features/election/uik-c6c0f92c0d.html",scope:{uikInfo:"=",electionClick:"&",hasConflict:"=",originHomeVotingOrderId:"=?",conflictHomeVotingOrderId:"=?",isOrigin:"="},link:function(n){n.openElectionItem=function(e,t){n.electionClick({electionItem:e,vipElection:t})},n.uikInfo.isFullInfoOpened=!1,n.showMap=!1,!e.conflictElection&&n.uikInfo.fedElections.length&&n.uikInfo.regElections.length&&n.uikInfo.homeVotingOrderId&&!n.uikInfo.regOrderId&&!n.uikInfo.fedOrderId&&(n.homeVotingInOneUik=!0);var i=!(n.toggleInfo=function(){var e,t;n.uikInfo.latP&&n.uikInfo.lonP&&!i&&(e=parseFloat(n.uikInfo.latP),t=parseFloat(n.uikInfo.lonP),n.center=[t,e],n.geoObject={geometry:{type:"Point",coordinates:n.center}},n.showMap=!0),n.uikInfo.isFullInfoOpened=!n.uikInfo.isFullInfoOpened});n.afterMapInit=function(e){e.behaviors.enable("scrollZoom"),e.controls.add("zoomControl",{float:"none",position:{right:10,top:50,left:"auto"}}),i||(i=!0,e.events.add("boundschange",function(e){n.showThrobber=!0}))}}}}]).directive("izbirkollInfo",function(){return{restrict:"E",templateUrl:window.templatePath+"/tpl/lk/features/election/izbirkolls-7343072ffc.html",replace:!0,transclude:!0}}).directive("consignmentInfo",function(){return{restrict:"E",templateUrl:window.templatePath+"/tpl/lk/features/election/consignment-info-eb77670e80.html",replace:!0,transclude:!0}}).directive("referendums",function(){return{restrict:"E",templateUrl:window.templatePath+"/tpl/lk/features/election/referendums-0ec383e031.html",replace:!0,transclude:!0}}).directive("electionPayment",["$moment",function(e){return{restrict:"E",templateUrl:window.templatePath+"/tpl/lk/features/election/election-payment-f15fdd676d.html",transclude:!0,scope:{payments:"=",isConsignment:"=",title:"=",isReferendum:"="},link:function(e){e.isReferendum?e.returnInfoText="Неизрасходованные средства возвращаются в сроки, предусмотренные законодательством о референдумах":e.returnInfoText="Неизрасходованные средства возвращаются в сроки, предусмотренные избирательным законодательством"}}}]).directive("singleCandidateProtocol",["$rootScope",function(e){return{restrict:"E",templateUrl:window.templatePath+"/tpl/lk/features/election/single-candidate-protocol-edd67e628d.html",transclude:!0,scope:{target:"=",campaign:"=",onCandidateClick:"&"},link:function(t){t.openFreeCandidateInfo=function(e){t.onCandidateClick({msg:e})}}}}]).directive("formHelper",["$rootScope","$location",function(a,s){return{restrict:"E",templateUrl:window.templatePath+"/tpl/lk/features/election/form-helper-a634b91249.html",scope:{uikInfo:"=",mode:"=",hasConflict:"=",originHomeVotingOrderId:"=?",conflictHomeVotingOrderId:"=?",isOrigin:"=",isImportant:"=?",isDeg:"=?"},link:function(n){n.platform=a.webViewMode?"MP":"EPGUV3_"+("dk"==a.version?"DESK":"mob"==a.version?"MOB":"TAB"),a.regionsWithoutForm=a.regionsWithoutForm||[];var e=!1,t=n.showCikHomeBlock=a.showCikHomeBlock,i=n.uikInfo.showHomeVotingForm,o=n.uikInfo.showChangeUikForm;"reg"===n.mode&&n.uikInfo.regElections&&n.uikInfo.regElections.length&&(n.formUrl=a.betaUrl+a.regVotingUrl,n.mobileFormUrl=a.betaUrl+"mobile/card/"+a.regVotingUrl,n.mobileFormMatchedOrgUrl=a.betaUrl+"mobile/form/"+a.regVotingUrl,n.orderUrl="/notifications/details/order/"+n.uikInfo.regOrderId,n.orderId=n.uikInfo.regOrderId),"fed"===n.mode&&n.uikInfo.fedElections&&n.uikInfo.fedElections.length&&(n.formUrl=a.betaUrl+a.fedVotingUrl,n.mobileFormUrl=a.betaUrl+"mobile/card/"+a.fedVotingUrl,n.mobileFormMatchedOrgUrl=a.betaUrl+"mobile/form/"+a.fedVotingUrl,n.orderUrl="/notifications/details/order/"+n.uikInfo.fedOrderId,n.orderId=n.uikInfo.fedOrderId),n.mobileHomeVotingFormUrl=a.betaUrl+"mobile/card/"+a.homeVotingUrl,n.mobileHomeVotingFormMatchedOrg=a.betaUrl+"mobile/form/"+a.homeVotingUrl,n.homeVotingFormUrl=a.betaUrl+a.homeVotingUrl,n.uikInfo.homeVotingOrderId&&(n.homeOrderUrl="/notifications/details/order/"+n.uikInfo.homeVotingOrderId),n.hideDelimiter=t&&(!n.orderId||!i)||!t&&(!o||!i||!n.orderId&&n.uikInfo.homeVotingOrderId),n.showHomeBlock=n.uikInfo.showHomeVotingForm||n.uikInfo.homeVotingOrderId,e=n.uikInfo.primaryUik?(n.showPrimaryConflictBlock=n.hasConflict,n.checkCrossOrders=!0,!n.hasConflict):(n.checkCrossOrders=n.isOrigin&&!n.conflictHomeVotingOrderId||!n.isOrigin&&!n.originHomeVotingOrderId,-1===a.regionsWithoutForm.indexOf(n.uikInfo.regCode)&&(n.hasConflict||n.orderId)||-1<a.regionsWithoutForm.indexOf(n.uikInfo.regCode)&&(n.checkCrossOrders||n.uikInfo.homeVotingOrderId)),n.showFormHelper=(!t||n.orderId||n.uikInfo.homeVotingOrderId)&&(e||n.showPrimaryConflictBlock),n.openForm=function(e){!a.disableMetric&&n.uikInfo.isImportant&&window.metricReachGoal24845174("LkElection",{event:"LkUiktoMiORG",platform:n.platform,region:a.userSelectedRegion,matchResult:a.primaryUik&&1===a.primaryUik.result?"matched":"unmatched"}),e.preventDefault(),a.webViewMode&&window.SMUAdapter?n.isImportant&&a.primaryUik&&1===a.primaryUik.result?window.location.href=n.mobileFormMatchedOrgUrl:window.location.href=n.mobileFormUrl:n.isImportant&&a.primaryUik&&1===a.primaryUik.result?window.location.href=n.formUrl+"form":window.location.href=n.formUrl},n.openDetails=function(e,t){e.preventDefault(),a.webViewMode&&window.SMUAdapter?window.SMUAdapter.notify({eventType:"open_screen",eventParams:[{key:"screen",value:"OrderDetails"},{key:"orderId",value:t?n.uikInfo.homeVotingOrderId:n.orderId}]}):s.path(t?n.homeOrderUrl:n.orderUrl)},n.openHomeVotingForm=function(e){e.preventDefault(),!a.disableMetric&&n.uikInfo.isImportant&&window.metricReachGoal24845174("LkElection",{event:"LkUiktoHomeORG",platform:n.platform,region:a.userSelectedRegion,matchResult:a.primaryUik&&1===a.primaryUik.result?"matched":"unmatched"}),a.webViewMode&&window.SMUAdapter?n.isImportant&&a.primaryUik&&1===a.primaryUik.result?window.location.href=n.mobileHomeVotingFormMatchedOrg:window.location.href=n.mobileHomeVotingFormUrl:n.isImportant&&a.primaryUik&&1===a.primaryUik.result?window.location.href=n.homeVotingFormUrl+"form":window.location.href=n.homeVotingFormUrl}}}}])}(),function(){"use strict";angular.module("epgu").directive("epguUniversityHandExamResult",["$rootScope","$q","EpguUniversityHandExamResultSrv","UniversityPageService",function(e,t,o,n){return{replace:!0,restrict:"E",templateUrl:window.templatePath+(SmartPhone.isAny()&&SmartPhone.isPhone(),"/tpl/university/hand-exam-result-c5a41ef3cc.html"),scope:{props:"="},link:function(i){i.items=[],i.resultItems=i.props.examsFromServer&&i.props.examsFromServer.concat()||[],i.onShowMode=function(e,t){"edit"===e&&t&&n.sendReachGoal("editEge"),i.mode=e||""},i.editMode=i.props.editMode,i.onAddSubject=function(e){i.dirty=!0,i.resultItemsLengthError=!1,o.addSubject(i.items,e)},o.getExamSubjects().then(function(e){i.resultItems.length?(i.onShowMode("result"),i.resultItems.forEach(function(e){i.onAddSubject(e.points[0])})):i.onShowMode("edit"),i.subjectSelected={},i.yearSelected={},i.pointsRegexp=/^[0-9]$|^[1-9][0-9]$|^(100)$| (^$)/,i.ddList=e,i.yearsList=o.getYears()}),i.onChangeSubject=function(e,t){t=o.getSubject(i.items,t);t.subject.title=e.title,t.subject.value=e.value,i.resultItemsLengthError=!1},i.onChangeYear=function(e,t){t=o.getSubject(i.items,t);t.year.value=e.value,t.year.title=e.title},i.onDelete=function(e){var t=o.getSubject(i.items,e);t.wasSaved&&n.deleteExamsResult(t.subject.value),o.deleteSubject(i.items,e),i.items.length<3&&(i.resultItems=[],"function"==typeof i.props.onSave)&&i.props.onSave(i.resultItems)},i.onSaveResult=function(){if(i.uploadResult)return!1;n.sendReachGoal("saveEge"),i.resultItemsLengthError=!1,i.uploadResult=!0,i.resultItems=o.getResultBySubjects(i.items),i.resultItems.length<i.props.egeSubjectsCount?(i.uploadResult=!1,i.resultItemsLengthError=!0):n.saveExamsResults(i.resultItems,!0).then(function(e){"function"==typeof i.props.onSave&&(i.items.forEach(function(e){e.wasSaved=!0}),i.props.onSave(i.resultItems),i.onShowMode("result")),i.uploadResult=!1},function(e){i.uploadResult=!1})},i.onChangeBySubject=function(t,e){var e=o.getSubject(i.resultItems,e),n=(e.selected||(e.selected={}),e.points.find(function(e){return e.value===t.value}));n&&(e.selected.point=n.point,e.selected.pointDigit=n.pointDigit,e.selected.year=n.year,e.selected.subject=n.subject,e.selected.subjectCode=n.subjectCode)}}}}]).factory("EpguUniversityHandExamResultSrv",["$rootScope","$q","$http","declineOfUnit",function(e,n,i,s){var o=[];return{addSubject:function(i,o){var a=this;a.getExamSubjects().then(function(e){var t=a.getYears(),n=t[t.length-1],t={initSubject:{},subject:{},subjects:e,years:t,value:"",title:"",point:0,initYear:{title:n.value,value:n.value},year:{title:n.value,value:n.value}};o?(t.subject.title=o.subject,t.subject.value=o.subjectCode,t.initSubject.title=o.subject,t.initSubject.value=o.subjectCode,t.point=o.point,t.initYear.title=o.year,t.initYear.value=o.year,t.year.value=o.year,t.year.title=o.year,t.initYear.title=o.year,t.wasSaved=!0):(n=a.getNextItemBySelected(i,e),t.subject.title=n.title,t.subject.value=n.value,t.initSubject.title=n.title,t.initSubject.value=n.value),i.push(t)})},getNextItemBySelected:function(e,t){var n={title:"",value:""},i=0,o=e[e.length-1];return o&&(t.forEach(function(e,t){o.subject.value?e.value===o.subject.value&&(i=t):e.value===o.initSubject.value&&(i=t)}),i=t.length-1>i?i+1:0),n.title=t[i].title,n.value=t[i].value,n},deleteSubject:function(e,t){e.splice(t,1)},getSubject:function(e,t){return e[t]},getYears:function(){for(var e=(new Date).getFullYear(),t=[],n=e-4,i=e;n<=i;n++)t.push({title:n,value:n});return t},getResultBySubjects:function(e){var t,n,i=[],o={},a=this;for(n in e.forEach(function(e,t){var n=" (результаты "+e.year.value+")",i=a.getPointText(e.point);o[e.subject.value]||(o[e.subject.value]={title:e.subject.title,points:[]}),o[e.subject.value].points.push({title:e.point+" "+i+n,value:e.point+"_"+e.year.value,point:e.point,pointDigit:parseInt(e.point,10),pointText:i,year:e.year.value,yearText:n,subject:e.subject.title,subjectCode:e.subject.value})}),o)o.hasOwnProperty(n)&&(1<o[n].points.length&&o[n].points.sort(s.sortByAttr("pointDigit",!0)),t=o[n].points[0],o[n].selected={title:t.title,value:t.value,point:t.point,pointDigit:t.pointDigit,year:t.value,subject:t.subject,subjectCode:t.subjectCode},i.push(o[n]));return i},getPointText:function(e){return s.get(e,["балл","балла","баллов"])},getExamSubjects:function(){var t=n.defer();return o.length?t.resolve(o):i({url:e.nsiApi+"dictionary/VUZ_SUBJECTS",method:"POST",withCredentials:!0,data:{filter:{union:{unionKind:"AND",subs:[{simple:{attributeName:"ege",condition:"EQUALS",value:{asString:"true"}}},{simple:{attributeName:"actual",condition:"EQUALS",value:{asString:"true"}}}]}},orderBy:[{attributeName:"id",sortDirection:"ASC"}],pageNum:"1",selectAttributes:["*"],treeFiltering:"ONELEVEL",tx:""}}).then(function(e){o=e.data.items.map(function(e){var t=(e.attributes||[]).find(function(e){return"id"===e.name});return{title:(e.attributeValues||{}).name,value:t.value.value}}),t.resolve(o)},function(e){t.resolve([])}),t.promise}}}])}(),function(){"use strict";angular.module("epgu").directive("epguUniversitySelectGroups",["$rootScope","$q","EpguUniversitySelectGroupsSrv","declineOfUnit","ngDialog","UniversityPageService",function(e,t,p,f,m,g){return{replace:!0,restrict:"E",templateUrl:window.templatePath+(SmartPhone.isAny()&&SmartPhone.isPhone(),"/tpl/university/university-select-groups-1fe57c5508.html"),scope:{props:"="},link:function(s){var i={},e={},t=(s.getUniError=!1,s.getUniErrorText="Не удается загрузить информацию о вузе. Попробуйте добавить вузы позже или обратитесь в <a href='/feedback'>службу поддержки</a>",s.getUniEmptyText="Информация по направлениям подготовки и конкурсным группам не предоставлены вузом. Обратитесь в <a href='/feedback'>службу поддержки</a>",s.showFilter=!1,s.prices=g.getPrices(),s.needHostel=s.props.needHostel||!1,s.needHostelShow=!0,s.needHostel),n=(s.needHostelChange=function(e){t=e.checked},s.props.id),o=s.props.savedId,a=s.props.favoriteSpecIds,r="",l=(s.props.list&&(s.items=s.props.list),s.props.examResult),c=(s.editMode=s.props.editMode,"1"===s.editMode&&(s.needHostelShow=p.checkNeedHostelByUniversityId(n,g.getUniversityIds())),s.allSelectedSpecialities=0,["группы","групп","групп"]),d={},u=s.props.editGroups?s.props.editGroups.concat():null;"view"===s.props.mode?s.onDelete=function(n){var i=-1;s.items.forEach(function(e,t){e.id===n.id&&(i=t)}),~i&&s.items.splice(i,1),"function"==typeof s.props.onDelete&&s.props.onDelete(n,o)}:(s.items=[],p.clearOriginContestGroups(),s.setItems=function(t){t||(s.getUniError=!1,s.EmptyTrainingAreas=!1),p.setUniversityGroups(n,!0,u,l,d,a,t).then(function(e){s.items.length=0,s.items=e.response,t||(e.error?s.getUniError=!0:e.isEmptyTrainingAreas&&(s.emptyTrainingAreas=!0))})},s.setItems(),s.onShowFilterSettings=function(e){s.showFilter=e},s.onGetGroupsWithFilters=function(){e=angular.extend({},i),s.showFilter?((e=angular.extend({},i)).query=r.toLowerCase(),r&&e.checkedCounter++):(e={query:r.toLowerCase()},r&&(e.checkedCounter=1)),s.setItems(e),s.onShowFilterSettings(!1)},s.filterList=p.getFilters(),s.changeFilter=function(e){return function(e){var t,n=0;for(t in s.filterList.forEach(function(e,t){e.items.reduce(function(e,t){return e[t.code]=t.checked,e},i)}),i[e.value]=e.checked,i)i.hasOwnProperty(t)&&"boolean"==typeof i[t]&&i[t]&&(n+=1);i.checkedCounter=n}},s.searchQuery="",s.onChangeQuery=function(e){r=e,s.onGetGroupsWithFilters()},s.onSelectGroup=function(e,t){var n={},i=!1;if(!1===e.editable&&"1"===s.editMode)return!1;s.notSelectedMessage=!1,e.isSelect=!e.isSelect,"1"===s.editMode&&(s.needHostelShow=p.checkNeedHostelByGroupsId(e.id,g.getGroupsIds()),s.needHostelShow)&&!e.isSelect&&(g.getGroupsIds().forEach(function(e){n[e]=!0}),s.items.forEach(function(e){e.contestGroups.forEach(function(e){e.isSelect&&!n[e.id]&&(i=!0)})}),i||(s.needHostelShow=!1));var o=0,a=0;d[t.id]&&d[t.id].isSelected&&void 0!==d[t.id].isSelected[e.id]&&(d[t.id].isSelected[e.id]=e.isSelect),t.contestGroups.forEach(function(e){e.isSelect&&o++}),t.selectedGroups=o,s.items.forEach(function(e){e.selectedGroups&&a++}),a<3?s.items.forEach(function(e){e.selectedGroups||(e.hide=!1)}):3===a&&s.items.forEach(function(e){e.selectedGroups||(e.hide=!0)}),s.allSelectedSpecialities=a,t.selectedGroupsText=f.get(t.contestGroups.length,c)},s.onSaveSelectedSpecialities=function(){var e=p.checkSelected(s.items),n=[];e&&"function"==typeof s.props.onSave?(u&&u.length&&u.forEach(function(t){d[t.id]&&t.contestGroups.concat().forEach(function(e){void 0===d[t.id].isSelected[e.id]||d[t.id].isSelected[e.id]||(e.isSelect=!1,e.isChecked=!1,s.props.onSelected(e,t),"1"!==s.props.editMode&&n.push(g.deleteUniversity(e.itemId)))})}),s.items.forEach(function(t){t.selectedGroups&&(t.originalGroupsLength=t.contestGroups.length,t.contestGroups.forEach(function(e){e.isSelect&&s.props.onSelected(e,t)}))}),s.props.onSave(t,s.items.length,n),m.closeAll()):s.notSelectedMessage=!0},s.onCancelSelectedSpecialities=function(){"function"==typeof s.props.onCancel&&s.props.onCancel(),m.closeAll()}),s.onToggleGroup=function(e){e.isOpen=!e.isOpen}}}}]).factory("EpguUniversitySelectGroupsSrv",["$rootScope","$q","$http","declineOfUnit",function(a,s,r,p){var t=[];return{getOriginContestGroups:function(){return t.concat()},setOriginContestGroups:function(e){t=t.concat(e)},clearOriginContestGroups:function(){t.length=0},checkNeedHostelByUniversityId:function(e,t){var n=!0;return n=~t.indexOf(e)?!1:n},checkNeedHostelByGroupsId:function(e,t){var n=!0;return n=~t.indexOf(e)?!1:n},searchManager:function(e,t){return~t.indexOf(e)},filterManager:function(a){return function(e){var t,n,i,o=0;return!a.checkedCounter||(t=e.form.replace(/\s/g,""),n=e.name.toLowerCase(),i=e.comment?e.comment.toLowerCase():"",a.query&&~n.indexOf(a.query)&&(o+=1),a.query&&i&&~i.indexOf(a.query)&&(o+=1),a[t]&&(o+=1),a[e.scoreLevel]&&(o+=1),e.subjects&&e.subjects.length&&e.subjects.forEach(function(e){e=e.subject.replace(/\s/g,"");a[e]&&(o+=1)}),o===a.checkedCounter)}},filterOriginContestGroups:function(i,o){var a=[],s=this;return this.getOriginContestGroups().forEach(function(e){var t=angular.extend({},e),n=e.name.toLowerCase();(o.query&&1===o.checkedCounter&&s.searchManager(o.query,n)||(t.contestGroups=e.contestGroups.filter(i),t.contestGroups.length))&&a.push(t)}),a},getCourse:function(){},setSelected:function(){},getSelected:function(){},checkSelected:function(e){var t=!1;return e.forEach(function(e){t||e.contestGroups.forEach(function(e){e.isSelect&&(t=!0)})}),t},setUniversityGroups:function(e,t,r,n,l,c,i){var o=this,d=s.defer(),u=["группа","группы","групп"];return o.getUniversityGroups(e,t).then(function(e){var t=e.trainingAreas,a={},s=(i&&(t=o.filterOriginContestGroups(o.filterManager(i),i)),{});r&&r.forEach(function(t){t.isFavorite&&(a[t.id]=!0),l[t.id]={selectedGroups:t.selectedGroups||0,selectedGroupsText:t.selectedGroupsText||"",isSelected:{},isEditable:{}},t.contestGroups.forEach(function(e){l[t.id].isSelected[e.id]=!0,l[t.id].isEditable[e.id]=e.editable})}),n&&n.length&&n.forEach(function(e){var t,e=e.selected||e.points[0];e&&(t=e.subject.replace(/\s/g,""),s[t]=e.pointDigit)}),t.forEach(function(e){var t,n,i={},o={};for(t in c[e.id]&&(e.isFavorite=!0),a[e.id]&&(e.isFavorite=!0),l[e.id]&&(e.selectedGroups=l[e.id].selectedGroups,e.selectedGroupsText=l[e.id].selectedGroupsText),!r||3!==r.length||l[e.id]||(e.hide=!0),e.contestGroups.forEach(function(n){l[e.id]&&(n.isSelect=l[e.id].isSelected[n.id],n.editable=l[e.id].isEditable[n.id]),i[n.form]||(i[n.form]=!0),n.subjects.forEach(function(e){var t=e.subject.replace(/\s/g,"");(!o[e.subject]||o[e.subject]>e.minScore)&&(o[e.subject]=e.minScore),s[t]&&s[t]<e.minScore&&(e.lowScore=!0,n.lowScore=!0)}),n.scoreLevel=n.lowScore?"lowScore":"normalScore"}),e.forms=[],e.subjects=[],i)i.hasOwnProperty(t)&&e.forms.push(t);for(n in o)o.hasOwnProperty(n)&&e.subjects.push({subject:n,minScore:o[n]});e.groupsText=p.get(e.contestGroups.length,["конкурсная","конкурсных","конкурсных"])+" "+p.get(e.contestGroups.length,u)}),i?d.resolve({response:t}):(o.setOriginContestGroups(t),d.resolve({response:o.getOriginContestGroups(),error:e.error,isEmptyTrainingAreas:e.isEmptyTrainingAreas}))}),d.promise},getUniversityGroups:function(e,t){var n=s.defer(),i=this.getOriginContestGroups(),e=a.universityApiUrl+"universities/"+e,o={};return t&&(o.full=!0,o._=Math.random()),i.length?n.resolve({trainingAreas:[]}):r({url:e,params:o,method:"GET",dataType:"json",withCredentials:!0}).then(function(e){e=e.data;e&&e.trainingAreas&&e.trainingAreas.length?n.resolve({trainingAreas:e.trainingAreas}):n.resolve({trainingAreas:[],isEmptyTrainingAreas:!0})},function(e){n.resolve({trainingAreas:[],error:!0})}),n.promise},getFilters:function(){return[{title:"Форма обучения",items:[{code:"Очнаяформа",title:"Очная",checked:!1},{code:"Очно-заочная",title:"Очно-заочная",checked:!1},{code:"Заочнаяформа",title:"Заочная",checked:!1}]},{title:"Уровень образования",items:[{code:"Бакалавриат",title:"Бакалавриат",checked:!1},{code:"Специалитет",title:"Специалитет",checked:!1}]},{title:"Экзамены",items:[{code:"Математика",title:"Математика",checked:!1},{code:"Русскийязык",title:"Русский язык",checked:!1},{code:"Физика",title:"Физика",checked:!1},{code:"Информатика",title:"Информатика",checked:!1}]}]},getCourses:function(){return[{title:"Прикладная математика и информатика 01.02.03",id:1,educationTypes:"Бакалавриат, Очная/Очно-заочная формы",examsAll:"Русский язык (от 40), Математика (от 40), Физика (от 40) / Информатика (от 40)",points:"от 205 (бюджет)",selectedGroups:0,groups:[{name:"ФПМИ Математика и информатика",subdivision:"МФТИ (ГУ), Долгопрудный",educationType:"Бакалавриат Очная форма",id:"1",exams:[{value:"Физика",priority:!0},{value:"Математика",priority:!1},{value:"Русский язык",priority:!1}],budgetPoints:226,contractPoints:205},{name:"Computer Science",subdivision:"МФТИ (ГУ), Долгопрудный",educationType:"Бакалавриат Очная форма",id:"2",exams:[{value:"Физика",priority:!0},{value:"Математика",priority:!1},{value:"Русский язык",priority:!1}],budgetPoints:226,contractPoints:205}]},{title:"Прикладная математика 01.02.04",id:2,educationTypes:"Бакалавриат, Очная/Очно-заочная формы",examsAll:"Русский язык, Математика, Физика/Информатика",points:"от 205 (бюджет)",selectedItems:0,groups:[{name:"ФПМИ Математика и информатика",subdivision:"МФТИ (ГУ), Долгопрудный",educationType:"Бакалавриат Очная форма",id:1,exams:[{value:"Физика",priority:!0},{value:"Математика",priority:!1},{value:"Русский язык",priority:!1}],budgetPoints:226,contractPoints:205},{name:"ФПМИ Экономика & ERP",subdivision:"МФТИ (ГУ), Долгопрудный",educationType:"Бакалавриат Очная форма",id:2,exams:[{value:"Физика",priority:!0},{value:"Математика",priority:!1},{value:"Русский язык",priority:!1}],budgetPoints:226,contractPoints:205}]}]}}}])}(),function(){"use strict";angular.module("epgu").directive("epguUniversityAddAchievements",["$rootScope","$q","$timeout","EpguUniversityAddAchievementsSrv","UniversityPageService","ngDialog",function(c,d,e,u,p,f){return{replace:!0,restrict:"E",templateUrl:window.templatePath+(SmartPhone.isAny()&&SmartPhone.isPhone(),"/tpl/university/add-achievements-8c5757daa8.html"),scope:{props:"="},link:function(o){o.getCategoriesError=!1,o.getCategoriesChildError=!1,o.getCategoriesErrorText="Не удалось получить данные. Попробуйте позже или обратитесь в <a href='/feedback'>службу поддержки</a>",p.getAchievementCategories().then(function(e){e.error&&(o.getCategoriesError=!0),o.ddList=e.achievementCategories},function(e){o.ddList=e.achievementCategories}),o.onChangeAchievements=function(n,e,t){o.getCategoriesChildError=!1,a.categoryTitle="",a.categoryValue="",o.ddListChild=[],p.getAchievementCategoriesChilds(t?"":n.value).then(function(e){var t=e.items,t=(t.length&&(o.ddListChild=t),e.error&&(o.getCategoriesChildError=!0),o.ddList.find(function(e){return e.value==n.value})),e=t&&t.attributeValues||n.attributeValues||{};a.title=n.title,a.value=n.value,a.upload="true"===e.UPLOAD,o.showOtherInfo="13"==n.value,o.showUploader=a.upload,o.description=p.getDescription(e),a.description=o.description,l()})};var a={title:"",value:"",message:"",otherDescription:"",files:[]},n=o.props.orderId,i=o.props.businessName,s=o.props.fileIndex,e=(o.formIsValid=!1,o.selectedFiles=[],o.otherDescription={value:""},o.props.itemSelected),r=e&&e.files?e.files:[];function t(){return!(0===o.selectedFiles.length||o.selectedFiles.some(function(e){return e.error}))}function l(){var e=!1;a.value&&(a.upload?13==a.value&&!o.otherDescription.value||(e=t()):e=!0),o.formIsValid=e}o.showUploader=!0,o.$watch("otherDescription.value",function(e,t){void 0!==e&&e!==t&&l()}),e&&(o.isEdit=!0,o.achievement={title:e.title,value:e.value},o.description=e.description,a.value=e.value,a.title=e.title,a.serverId=e.serverId,o.onChangeAchievements(e,null,!0),o.otherDescription.value=e.otherDescription||"",o.selectedFiles=r.concat(),l()),o.uploadUrl="",o.uploadUrlfP=c.formPlayerStorageUrl+"/upload",o.uploadInProgress=!1,o.uploadedFiles=function(e){p.onAddedItemWrapper(!0).then(function(){l()}),e.forEach(function(e){var t;e.mnemonic||(t="unvAchieve__"+(uuidv4?uuidv4():""),e.mnemonic=t,e.params={objectType:"2",objectId:n,BusinessName:i,mimeType:e.type,mnemonic:t},s++)})},o.onChangeAchievementsChild=function(e,t){a.categoryTitle=e.title,a.categoryValue=e.value,l()},o.onDelete=function(e){u.deleteSubject(o.items,e)},o.onAddSubject=function(){u.addSubject(o.items)},o.onSaveAchievements=function(){o.uploadInProgress=!0;var t=[],n=(o.selectedFiles.forEach(function(e){e.wasSaved||o.props.editMode||(e.defer=d.defer(),t.push(e.defer.promise))}),o.uploadInProgress=!1,{}),e=[];if(a.otherDescription=13==a.value?o.otherDescription.value:"","function"==typeof o.props.onAdded){if(a.files=o.showUploader?o.selectedFiles:[],r.length)for(var i in r.forEach(function(e,t){n[e.mnemonic]=!0}),a.files.forEach(function(e){n[e.mnemonic]&&(n[e.mnemonic]=!1)}),n)n.hasOwnProperty(i)&&n[i]&&!o.props.editMode&&e.push(i);o.props.onAdded(a,s,e,t),"2"!==o.props.editMode&&c.$emit("uploader-launch"),f.closeAll()}},o.onClosePopup=function(){f.closeAll()}}}}]).factory("EpguUniversityAddAchievementsSrv",["$rootScope","$q","$http",function(e,n,t){return{addSubject:function(e){e.push({value:"",title:"",point:""})},deleteSubject:function(e,t){e.splice(t,1)},getSubject:function(e,t){return e[t]},getExamSubjects:function(){return[{title:"Окончание школы с отличием или медалью",value:"1"},{title:"Диплом о среднем профессиональном образовании с отличием",value:"2"},{title:"Итоговое сочинение",value:"3"},{title:"Дипломы об участии и победах в олимпиадах",value:"diplomas_olympiads"},{title:"Статус чемпиона и призера международных спортивных состязаний",value:"sport_status_champion"},{title:"Золотой знак отличия ГТО",value:"gto_gold_sign"},{title:"Победитель чемпионата по профессиональному мастерству «Абилимпикс»",value:"ability_master_champion"},{title:"Волонтерская деятельность",value:"volunteer"},{title:"Иные достижения",value:"other"}]},wrapFile:function(e){var t=n.defer();if(e.isUploaded)return t.promise}}}])}();