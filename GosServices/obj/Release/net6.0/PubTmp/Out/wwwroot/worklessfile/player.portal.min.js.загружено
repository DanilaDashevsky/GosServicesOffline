function handleAtmosphere(transport,url,token,params,method,responseCallback,headers){function handleResponse(response){try{var data=response.responseBody&&JSON.parse(response.responseBody);responseCallback&&responseCallback(data),subSocket.close()}catch(e){responseCallback&&responseCallback(null)}}var request,socket=jQuery.atmosphere;if(!$.isFunction(responseCallback))throw"Response callback not set, or has incorrect type";request=new jQuery.atmosphere.AtmosphereRequest,request.url=url,request.method=method||"POST",request.data=params,request.contentType="application/json",request.fallbackTransport=null,request.reconnect=!1,request.withCredentials=!0,request.headers={Accept:"application/json","test-scope":"http://lk.gosuslugi.ru/informers"},token&&(request.headers.Authorization="bearer "+token),headers&&angular.extend(request.headers,headers),request.logLevel="debug",request.onMessage=function(response){null!=response&&handleResponse(response)},request.onOpen=function(){$.atmosphere.log("info",["socket open"])},request.onClose=function(){$.atmosphere.log("info",["socket onClose"])},request.onError=function(){$.atmosphere.log("info",["socket onError"]),subSocket.close(),responseCallback({error_description:"Ошибка esia",error:"-2"})},request.onReconnect=function(){$.atmosphere.log("info",["socket onReconnect"])},request.onMessagePublished=function(){$.atmosphere.log("info",["socket onMessagePublished"])},request.onTransportFailure=function(){$.atmosphere.log("info",["socket onTransportFailure"])},request.onLocalMessage=function(){$.atmosphere.log("info",["socket onLocalMessage"])},request.onClientTimeout=function(){$.atmosphere.log("info",["socket onClientTimeout"])},request.onFailureToReconnect=function(){$.atmosphere.log("info",["socket onFailureToReconnect"])};var subSocket=socket.subscribe(request.url,null,request)}!function(b){"function"==typeof define&&define.amd?define(["jquery"],b):"object"==typeof exports?module.exports=b(require("jquery")):b(jQuery||Zepto)}(function(b){var y=function(a,c,d){a=b(a);var l,g=this,k=a.val();c="function"==typeof c?c(a.val(),void 0,a,d):c;var e={invalid:[],getCaret:function(){try{var q,b=0,e=a.get(0),f=document.selection,c=e.selectionStart;return f&&-1===navigator.appVersion.indexOf("MSIE 10")?(q=f.createRange(),q.moveStart("character",a.is("input")?-a.val().length:-a.text().length),b=q.text.length):(c||"0"===c)&&(b=c),b}catch(d){}},setCaret:function(q){try{if(a.is(":focus")){var b,c=a.get(0);c.setSelectionRange?c.setSelectionRange(q,q):c.createTextRange&&(b=c.createTextRange(),b.collapse(!0),b.moveEnd("character",q),b.moveStart("character",q),b.select())}}catch(f){}},events:function(){a.on("input.mask keyup.mask",e.behaviour).on("paste.mask drop.mask",function(){setTimeout(function(){a.keydown().keyup()},100)}).on("change.mask",function(){a.data("changed",!0)}).on("blur.mask",function(){k===a.val()||a.data("changed")||a.triggerHandler("change"),a.data("changed",!1)}).on("blur.mask",function(){k=a.val()}).on("focus.mask",function(a){!0===d.selectOnFocus&&b(a.target).select()}).on("focusout.mask",function(){d.clearIfNotMatch&&!l.test(e.val())&&e.val("")})},getRegexMask:function(){for(var b,e,f,d,a=[],h=0;h<c.length;h++)(b=g.translation[c.charAt(h)])?(e=b.pattern.toString().replace(/.{1}$|^.{1}/g,""),f=b.optional,(b=b.recursive)?(a.push(c.charAt(h)),d={digit:c.charAt(h),pattern:e}):a.push(f||b?e+"?":e)):a.push(c.charAt(h).replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&"));return a=a.join(""),d&&(a=a.replace(new RegExp("("+d.digit+"(.*"+d.digit+")?)"),"($1)?").replace(new RegExp(d.digit,"g"),d.pattern)),new RegExp(a)},destroyEvents:function(){a.off("input keydown keyup paste drop blur focusout ".split(" ").join(".mask "))},val:function(b){var c=a.is("input")?"val":"text";return 0<arguments.length?(a[c]()!==b&&a[c](b),c=a):c=a[c](),c},getMCharsBeforeCount:function(a,b){for(var e=0,f=0,d=c.length;f<d&&f<a;f++)g.translation[c.charAt(f)]||(a=b?a+1:a,e++);return e},caretPos:function(a,b,d,f){return g.translation[c.charAt(Math.min(a-1,c.length-1))]?Math.min(a+d-b-f,d):e.caretPos(a+1,b,d,f)},behaviour:function(a){a=a||window.event,e.invalid=[];var c=a.keyCode||a.which;if(-1===b.inArray(c,g.byPassKeys)){var d=e.getCaret(),f=e.val().length,n=d<f,h=e.getMasked(),k=h.length,m=e.getMCharsBeforeCount(k-1)-e.getMCharsBeforeCount(f-1);return e.val(h),!n||65===c&&a.ctrlKey||(8!==c&&46!==c&&(d=e.caretPos(d,f,k,m)),e.setCaret(d)),e.callbacks(a)}},getMasked:function(a){var t,w,b=[],k=e.val(),f=0,n=c.length,h=0,l=k.length,m=1,p="push",u=-1;for(d.reverse?(p="unshift",m=-1,t=0,f=n-1,h=l-1,w=function(){return-1<f&&-1<h}):(t=n-1,w=function(){return f<n&&h<l});w();){var x=c.charAt(f),v=k.charAt(h),r=g.translation[x];r?(v.match(r.pattern)?(b[p](v),r.recursive&&(-1===u?u=f:f===t&&(f=u-m),t===u&&(f-=m)),f+=m):r.optional?(f+=m,h-=m):r.fallback?(b[p](r.fallback),f+=m,h-=m):e.invalid.push({p:h,v:v,e:r.pattern}),h+=m):(a||b[p](x),v===x&&(h+=m),f+=m)}return a=c.charAt(t),n!==l+1||g.translation[a]||b.push(a),b.join("")},callbacks:function(b){var g=e.val(),l=g!==k,f=[g,b,a,d],n=function(a,b,c){"function"==typeof d[a]&&b&&d[a].apply(this,c)};n("onChange",!0===l,f),n("onKeyPress",!0===l,f),n("onComplete",g.length===c.length,f),n("onInvalid",0<e.invalid.length,[g,b,a,e.invalid,d])}};g.mask=c,g.options=d,g.remove=function(){var b=e.getCaret();return e.destroyEvents(),e.val(g.getCleanVal()),e.setCaret(b-e.getMCharsBeforeCount(b)),a},g.getCleanVal=function(){return e.getMasked(!0)},g.init=function(c){c=c||!1,d=d||{},g.byPassKeys=b.jMaskGlobals.byPassKeys,g.translation=b.jMaskGlobals.translation,g.translation=b.extend({},g.translation,d.translation),g=b.extend(!0,{},g,d),l=e.getRegexMask(),!1===c?(d.placeholder&&a.attr("placeholder",d.placeholder),b("input").length&&!1=="oninput"in b("input")[0]&&"on"===a.attr("autocomplete")&&a.attr("autocomplete","off"),e.destroyEvents(),e.events(),c=e.getCaret(),e.val(e.getMasked()),e.setCaret(c+e.getMCharsBeforeCount(c,!0))):(e.events(),e.val(e.getMasked()))},g.init(!a.is("input"))};b.maskWatchers={};var A=function(){var a=b(this),c={},d=a.attr("data-mask");if(a.attr("data-mask-reverse")&&(c.reverse=!0),a.attr("data-mask-clearifnotmatch")&&(c.clearIfNotMatch=!0),"true"===a.attr("data-mask-selectonfocus")&&(c.selectOnFocus=!0),z(a,d,c))return a.data("mask",new y(this,d,c))},z=function(a,c,d){d=d||{};var g=b(a).data("mask"),k=JSON.stringify;a=b(a).val()||b(a).text();try{return"function"==typeof c&&(c=c(a)),"object"!=typeof g||k(g.options)!==k(d)||g.mask!==c}catch(l){}};b.fn.mask=function(a,c){c=c||{};var d=this.selector,g=b.jMaskGlobals,k=b.jMaskGlobals.watchInterval,l=function(){if(z(this,a,c))return b(this).data("mask",new y(this,a,c))};return b(this).each(l),d&&""!==d&&g.watchInputs&&(clearInterval(b.maskWatchers[d]),b.maskWatchers[d]=setInterval(function(){b(document).find(d).each(l)},k)),this},b.fn.unmask=function(){return clearInterval(b.maskWatchers[this.selector]),delete b.maskWatchers[this.selector],this.each(function(){var a=b(this).data("mask");a&&a.remove().removeData("mask")})},b.fn.cleanVal=function(){return this.data("mask").getCleanVal()},b.applyDataMask=function(a){a=a||b.jMaskGlobals.maskElements,(a instanceof b?a:b(a)).filter(b.jMaskGlobals.dataMaskAttr).each(A)};var p={maskElements:"input,td,span,div",dataMaskAttr:"*[data-mask]",dataMask:!0,watchInterval:300,watchInputs:!0,watchDataMask:!1,byPassKeys:[9,16,17,18,36,37,38,39,40,91],translation:{0:{pattern:/\d/},9:{pattern:/\d/,optional:!0},"#":{pattern:/\d/,recursive:!0},A:{pattern:/[a-zA-Z0-9]/},S:{pattern:/[a-zA-Z]/}}};b.jMaskGlobals=b.jMaskGlobals||{},p=b.jMaskGlobals=b.extend(!0,{},p,b.jMaskGlobals),p.dataMask&&b.applyDataMask(),setInterval(function(){b.jMaskGlobals.watchDataMask&&b.applyDataMask()},p.watchInterval)}),$.fn.hyphenate=function(){var e="[абвгдеёжзийклмнопрстуфхцчшщъыьэюя]",t="[аеёиоуыэюя]",n="[бвгджзклмнпрстфхцчшщ]",s=new RegExp("([йъь])("+e+e+")","ig"),o=new RegExp("("+t+")("+t+e+")","ig"),u=new RegExp("("+t+n+")("+n+t+")","ig"),a=new RegExp("("+n+t+")("+n+t+")","ig"),f=new RegExp("("+t+n+")("+n+n+t+")","ig"),l=new RegExp("("+t+n+n+")("+n+n+t+")","ig");this.each(function(){var e=$(this).html();e=e.replace(s,"$1­$2"),e=e.replace(o,"$1­$2"),e=e.replace(u,"$1­$2"),e=e.replace(a,"$1­$2"),e=e.replace(f,"$1­$2"),e=e.replace(l,"$1­$2"),$(this).html(e)})},jQuery.atmosphere=function(){jQuery(window).unload(function(){jQuery.atmosphere.unsubscribe()});var parseHeaders=function(headerString){for(var match,rheaders=/^(.*?):[ \t]*([^\r\n]*)\r?$/gm,headers={};match=rheaders.exec(headerString);)headers[match[1]]=match[2];return headers};return{version:"1.0",requests:[],callbacks:[],onError:function(response){},onClose:function(response){},onOpen:function(response){},onMessage:function(response){},onReconnect:function(request,response){},onMessagePublished:function(response){},onTransportFailure:function(response){},AtmosphereRequest:function(options){function _init(){_uuid=0,_subscribed=!0,_abordingConnection=!1,_requestCount=0,_websocket=null,_sse=null,_activeRequest=null,_ieStream=null}function _reinit(){_clearState(),_init()}function _subscribe(options){_reinit(),_request=jQuery.extend(_request,options),_uuid=jQuery.atmosphere.guid()}function _supportWebsocket(){return null!=_request.webSocketImpl||window.WebSocket||window.MozWebSocket}function _supportSSE(){return window.EventSource}function _execute(){"websocket"!=_request.transport&&"sse"!=_request.transport?(_open("opening",_request.transport,_request),_executeRequest()):"websocket"==_request.transport?_supportWebsocket()?_executeWebSocket(!1):_reconnectWithFallbackTransport("Websocket is not supported, using request.fallbackTransport ("+_request.fallbackTransport+")"):"sse"==_request.transport&&(_supportSSE()?_executeSSE(!1):_reconnectWithFallbackTransport("Server Side Events(SSE) is not supported, using request.fallbackTransport ("+_request.fallbackTransport+")"))}function _open(state,transport,request){request.close=function(){_close(),request.reconnect=!1},_response.request=request;var prevState=_response.state;_response.state=state,_response.status=200;var prevTransport=_response.transport;_response.transport=transport,_invokeCallback(),_response.state=prevState,_response.transport=prevTransport}function _jsonp(request){var rq=_request;null!=request&&void 0!==request&&(rq=request);var url=rq.url,data=rq.data;rq.attachHeadersAsQueryString&&(url=_attachHeaders(rq),""!=data&&(url+="&X-Atmosphere-Post-Body="+data),data=""),_jqxhr=jQuery.ajax({url:url,type:rq.method,dataType:"jsonp",error:function(jqXHR,textStatus,errorThrown){jqXHR.status<300&&rq.requestCount++<rq.maxRequest?_reconnect(_jqxhr,rq):_prepareCallback(textStatus,"error",jqXHR.status,rq.transport)},jsonp:"jsonpTransport",success:function(json){if(rq.requestCount++<rq.maxRequest){rq.executeCallbackBeforeReconnect&&_reconnect(_jqxhr,rq);var msg=json.message;if(null!=msg&&"string"!=typeof msg)try{msg=jQuery.stringifyJSON(msg)}catch(err){}_prepareCallback(msg,"messageReceived",200,rq.transport),rq.executeCallbackBeforeReconnect||_reconnect(_jqxhr,rq)}else jQuery.atmosphere.log(_request.logLevel,["JSONP reconnect maximum try reached "+_request.requestCount]),_onError()},data:rq.data,beforeSend:function(jqXHR){_doRequest(jqXHR,rq,!1)}})}function _ajax(request){var rq=_request;null!=request&&void 0!==request&&(rq=request);var url=rq.url,data=rq.data;rq.attachHeadersAsQueryString&&(url=_attachHeaders(rq),""!=data&&(url+="&X-Atmosphere-Post-Body="+data),data=""),_jqxhr=jQuery.ajax({url:url,type:rq.method,error:function(jqXHR,textStatus,errorThrown){jqXHR.status<300&&rq.requestCount++<rq.maxRequest?_reconnect(_jqxhr,rq):_prepareCallback(textStatus,"error",jqXHR.status,rq.transport)},success:function(data,textStatus,jqXHR){rq.requestCount++<rq.maxRequest?(rq.executeCallbackBeforeReconnect&&_reconnect(_jqxhr,rq),_prepareCallback(data,"messageReceived",200,rq.transport),rq.executeCallbackBeforeReconnect||_reconnect(_jqxhr,rq)):(jQuery.atmosphere.log(_request.logLevel,["AJAX reconnect maximum try reached "+_request.requestCount]),_onError())},data:rq.data,beforeSend:function(jqXHR){_doRequest(jqXHR,rq,!1)}})}function _getWebSocket(location){return null!=_request.webSocketImpl?_request.webSocketImpl:window.WebSocket?new WebSocket(location):new MozWebSocket(location)}function _buildWebSocketUrl(){var url=_request.url;return url=_attachHeaders(),decodeURI(jQuery('<a href="'+url+'"/>')[0].href.replace(/^http/,"ws"))}function _buildSSEUrl(){_request.url;return _attachHeaders()}function _executeSSE(sseOpened){_response.transport="sse";var location=_buildSSEUrl(_request.url);if(jQuery.atmosphere.log(_request.logLevel,["Invoking executeSSE"]),"debug"==_request.logLevel&&jQuery.atmosphere.debug("Using URL: "+location),sseOpened&&_open("re-opening","sse",_request),!_request.reconnect)return void(null!=_sse&&_sse.close());_sse=new EventSource(location,{withCredentials:_request.withCredentials}),_request.connectTimeout>0&&(_request.id=setTimeout(function(){sseOpened||_sse.close()},_request.connectTimeout)),_sse.onopen=function(event){"debug"==_request.logLevel&&jQuery.atmosphere.debug("SSE successfully opened"),sseOpened||_open("opening","sse",_request),sseOpened=!0,"POST"==_request.method&&(_response.state="messageReceived",_sse.send(_request.data))},_sse.onmessage=function(message){_response.state="messageReceived",_response.status=200;var message=message.data,skipCallbackInvocation=_trackMessageSize(message,_request,_response);0==jQuery.trim(message).length&&(skipCallbackInvocation=!0),skipCallbackInvocation||(_invokeCallback(),_response.responseBody="")},_sse.onerror=function(message){clearTimeout(_request.id),_response.state="closed",_response.responseBody="",_response.status=sseOpened?200:501,_invokeCallback(),_abordingConnection?jQuery.atmosphere.log(_request.logLevel,["SSE closed normally"]):sseOpened?_request.reconnect&&"sse"==_response.transport&&(_requestCount++<_request.maxRequest?(_request.requestCount=_requestCount,_response.responseBody="",_executeSSE(!0)):(_sse.close(),jQuery.atmosphere.log(_request.logLevel,["SSE reconnect maximum try reached "+_request.requestCount]),_onError())):_reconnectWithFallbackTransport("SSE failed. Downgrading to fallback transport and resending")}}function _executeWebSocket(webSocketOpened){_response.transport="websocket";var location=_buildWebSocketUrl(_request.url),closed=!1;if(jQuery.atmosphere.log(_request.logLevel,["Invoking executeWebSocket"]),"debug"==_request.logLevel&&jQuery.atmosphere.debug("Using URL: "+location),webSocketOpened&&_open("re-opening","websocket",_request),!_request.reconnect)return void(null!=_websocket&&_websocket.close());_websocket=_getWebSocket(location),_request.connectTimeout>0&&(_request.id=setTimeout(function(){if(!webSocketOpened){var _message={code:1002,reason:"",wasClean:!1};_websocket.onclose(_message);try{_websocket.close()}catch(e){}}},_request.connectTimeout)),_websocket.onopen=function(message){"debug"==_request.logLevel&&jQuery.atmosphere.debug("Websocket successfully opened"),webSocketOpened||_open("opening","websocket",_request),webSocketOpened=!0,"POST"==_request.method&&(_response.state="messageReceived",_websocket.send(_request.data))},_websocket.onmessage=function(message){-1!=message.data.indexOf("parent.callback")&&jQuery.atmosphere.log(_request.logLevel,["parent.callback no longer supported with 0.8 version and up. Please upgrade"]),_response.state="messageReceived",_response.status=200;var message=message.data;_trackMessageSize(message,_request,_response)||(_invokeCallback(),_response.responseBody="")},_websocket.onerror=function(message){clearTimeout(_request.id)},_websocket.onclose=function(message){if(!closed){var reason=message.reason;if(""===reason)switch(message.code){case 1e3:reason="Normal closure; the connection successfully completed whatever purpose for which it was created.";break;case 1001:reason="The endpoint is going away, either because of a server failure or because the browser is navigating away from the page that opened the connection.";break;case 1002:reason="The endpoint is terminating the connection due to a protocol error.";break;case 1003:reason="The connection is being terminated because the endpoint received data of a type it cannot accept (for example, a text-only endpoint received binary data).";break;case 1004:reason="The endpoint is terminating the connection because a data frame was received that is too large.";break;case 1005:reason="Unknown: no status code was provided even though one was expected.";break;case 1006:reason="Connection was closed abnormally (that is, with no close frame being sent)."}jQuery.atmosphere.warn("Websocket closed, reason: "+reason),jQuery.atmosphere.warn("Websocket closed, wasClean: "+message.wasClean),_response.state="closed",_response.responseBody="",_response.status=webSocketOpened?200:501,_invokeCallback(),clearTimeout(_request.id),closed=!0,_abordingConnection?jQuery.atmosphere.log(_request.logLevel,["Websocket closed normally"]):webSocketOpened?_request.reconnect&&"websocket"==_response.transport&&(_request.reconnect&&_requestCount++<_request.maxRequest?(_request.requestCount=_requestCount,_response.responseBody="",_executeWebSocket(!0)):(jQuery.atmosphere.log(_request.logLevel,["Websocket reconnect maximum try reached "+_request.requestCount]),jQuery.atmosphere.warn("Websocket error, reason: "+message.reason),_onError())):_reconnectWithFallbackTransport("Websocket failed. Downgrading to Comet and resending")}}}function _onError(){_response.state="error",_response.responseBody="",_response.status=500,_invokeCallback()}function _trackMessageSize(message,request,response){if(request.trackMessageLength){var messageStart=message.indexOf(request.messageDelimiter),length=response.expectedBodySize;if(-1!=messageStart&&(length=message.substring(0,messageStart),message=message.substring(messageStart+1),response.expectedBodySize=length),-1!=messageStart?response.responseBody=message:response.responseBody+=message,response.responseBody.length!=length)return!0}else response.responseBody=message;return!1}function _reconnectWithFallbackTransport(errorMessage){jQuery.atmosphere.log(_request.logLevel,[errorMessage]),void 0!==_request.onTransportFailure?_request.onTransportFailure(errorMessage,_request):void 0!==jQuery.atmosphere.onTransportFailure&&jQuery.atmosphere.onTransportFailure(errorMessage,_request),_request.transport=_request.fallbackTransport,(_request.reconnect&&"none"!=_request.transport||null==_request.transport)&&(_request.method=_request.fallbackMethod,_response.transport=_request.fallbackTransport,_execute())}function _attachHeaders(request){var rq=_request;null!=request&&void 0!==request&&(rq=request);var url=rq.url;return rq.attachHeadersAsQueryString?-1!=url.indexOf("X-Atmosphere-Framework")?url:(url+=-1!=url.indexOf("?")?"&":"?",url+="X-Atmosphere-tracking-id="+_uuid,url+="&X-Atmosphere-Framework="+jQuery.atmosphere.version,url+="&X-Atmosphere-Transport="+rq.transport,rq.trackMessageLength&&(url+="&X-Atmosphere-TrackMessageSize=true"),void 0!=rq.lastTimestamp?url+="&X-Cache-Date="+rq.lastTimestamp:url+="&X-Cache-Date=0",""!=rq.contentType&&(url+="&Content-Type="+rq.contentType),jQuery.each(rq.headers,function(name,value){var h=jQuery.isFunction(value)?value.call(this,rq,request,_response):value;null!=h&&(url+="&"+encodeURIComponent(name)+"="+encodeURIComponent(h))}),url):url}function _buildAjaxRequest(){var ajaxRequest;if(jQuery.browser.msie)for(var activexmodes=["Msxml2.XMLHTTP","Microsoft.XMLHTTP"],i=0;i<activexmodes.length;i++)try{ajaxRequest=new ActiveXObject(activexmodes[i])}catch(e){}else window.XMLHttpRequest&&(ajaxRequest=new XMLHttpRequest);return ajaxRequest}function _executeRequest(request){var rq=_request;if(null==request&&void 0===request||(rq=request),"jsonp"==rq.transport||rq.enableXDR&&jQuery.atmosphere.checkCORSSupport())return void _jsonp(rq);if("ajax"==rq.transport)return void _ajax(request);if("streaming"==rq.transport&&jQuery.browser.msie)return void(rq.enableXDR&&window.XDomainRequest?_ieXDR(rq):_ieStreaming(rq));if(rq.enableXDR&&window.XDomainRequest)return void _ieXDR(rq);if(rq.requestCount++<rq.maxRequest){var ajaxRequest=_buildAjaxRequest();_doRequest(ajaxRequest,rq,!0),rq.suspend&&(_activeRequest=ajaxRequest),"polling"!=rq.transport&&(_response.transport=rq.transport);var error=!1;jQuery.browser.msie||(ajaxRequest.onerror=function(){error=!0;try{_response.status=XMLHttpRequest.status}catch(e){_response.status=404}_response.state="error",_invokeCallback(),ajaxRequest.abort(),_activeRequest=null}),ajaxRequest.onreadystatechange=function(){if(!_abordingConnection){var skipCallbackInvocation=!1,update=!1;if("streaming"==rq.transport&&rq.readyState>2&&4==ajaxRequest.readyState)return rq.readyState=0,rq.lastIndex=0,void _reconnect(ajaxRequest,rq,!0);if(rq.readyState=ajaxRequest.readyState,4==ajaxRequest.readyState?jQuery.browser.msie?update=!0:"streaming"==rq.transport?update=!0:"long-polling"==rq.transport&&(update=!0,clearTimeout(rq.id)):jQuery.browser.msie||3!=ajaxRequest.readyState||200!=ajaxRequest.status||"long-polling"==rq.transport?clearTimeout(rq.id):update=!0,update){var responseText=ajaxRequest.responseText;if(!_request.dropAtmosphereHeaders)try{var tempDate=ajaxRequest.getResponseHeader("X-Cache-Date");null==tempDate&&void 0==tempDate||(_request.lastTimestamp=tempDate.split(" ").pop())}catch(e){}if(this.previousLastIndex=rq.lastIndex,"streaming"==rq.transport){var text=responseText.substring(rq.lastIndex,responseText.length);if(_response.isJunkEnded=!0,0==rq.lastIndex&&-1!=text.indexOf("\x3c!-- Welcome to the Atmosphere Framework.")&&(_response.isJunkEnded=!1),_response.isJunkEnded){skipCallbackInvocation=_trackMessageSize(responseText.substring(rq.lastIndex,responseText.length),rq,_response)}else{var endOfJunkLenght="\x3c!-- EOD --\x3e".length,junkEnd=text.indexOf("\x3c!-- EOD --\x3e")+endOfJunkLenght;junkEnd>endOfJunkLenght&&junkEnd!=text.length?_response.responseBody=text.substring(junkEnd):skipCallbackInvocation=!0}if(rq.lastIndex=responseText.length,jQuery.browser.opera&&jQuery.atmosphere.iterate(function(){if(ajaxRequest.responseText.length>rq.lastIndex){try{_response.status=ajaxRequest.status,_response.headers=parseHeaders(ajaxRequest.getAllResponseHeaders()),_request.headers&&jQuery.each(_request.headers,function(name){var v=ajaxRequest.getResponseHeader(name);v&&(_response.headers[name]=v)})}catch(e){_response.status=404}_response.state="messageReceived",_response.responseBody=ajaxRequest.responseText.substring(rq.lastIndex),rq.lastIndex=ajaxRequest.responseText.length,_invokeCallback(),"streaming"==rq.transport&&ajaxRequest.responseText.length>rq.maxStreamingLength&&(ajaxRequest.abort(),_doRequest(ajaxRequest,rq,!0))}},0),skipCallbackInvocation)return}else skipCallbackInvocation=_trackMessageSize(responseText,rq,_response),rq.lastIndex=responseText.length;try{_response.status=ajaxRequest.status,_response.headers=parseHeaders(ajaxRequest.getAllResponseHeaders()),_request.headers&&jQuery.each(_request.headers,function(name){var v=ajaxRequest.getResponseHeader(name);v&&(_response.headers[name]=v)})}catch(e){_response.status=404}rq.suspend?_response.state=0==_response.status?"closed":"messageReceived":_response.state="messagePublished",rq.executeCallbackBeforeReconnect||_reconnect(ajaxRequest,rq,!1),-1!=_response.responseBody.indexOf("parent.callback")&&jQuery.atmosphere.log(rq.logLevel,["parent.callback no longer supported with 0.8 version and up. Please upgrade"]),_invokeCallback(),rq.executeCallbackBeforeReconnect&&_reconnect(ajaxRequest,rq,!1),"streaming"==rq.transport&&responseText.length>rq.maxStreamingLength&&(ajaxRequest.abort(),_doRequest(ajaxRequest,rq,!0))}}},ajaxRequest.send(rq.data),rq.suspend&&(rq.id=setTimeout(function(){_subscribed&&(ajaxRequest.abort(),_subscribe(rq),_execute())},rq.timeout)),_subscribed=!0}else jQuery.atmosphere.log(rq.logLevel,["Max re-connection reached."]),_onError()}function _doRequest(ajaxRequest,request,create){var url=jQuery.atmosphere.prepareURL(request.url);create&&(ajaxRequest.open(request.method,url,!0),request.connectTimeout>-1&&(request.id=setTimeout(function(){0==request.requestCount&&(ajaxRequest.abort(),_prepareCallback("Connect timeout","closed",200,request.transport))},request.connectTimeout))),_request.withCredentials&&"withCredentials"in ajaxRequest&&(ajaxRequest.withCredentials=!0),_request.dropAtmosphereHeaders||(ajaxRequest.setRequestHeader("X-Atmosphere-Framework",jQuery.atmosphere.version),ajaxRequest.setRequestHeader("X-Atmosphere-Transport",request.transport),void 0!=request.lastTimestamp?ajaxRequest.setRequestHeader("X-Cache-Date",request.lastTimestamp):ajaxRequest.setRequestHeader("X-Cache-Date",0),request.trackMessageLength&&ajaxRequest.setRequestHeader("X-Atmosphere-TrackMessageSize","true"),""!=request.contentType&&ajaxRequest.setRequestHeader("Content-Type",request.contentType),ajaxRequest.setRequestHeader("X-Atmosphere-tracking-id",_uuid),jQuery.each(request.headers,function(name,value){var h=jQuery.isFunction(value)?value.call(this,ajaxRequest,request,create,_response):value;null!=h&&ajaxRequest.setRequestHeader(name,h)}))}function _reconnect(ajaxRequest,request,force){(force||request.suspend&&200==ajaxRequest.status&&"streaming"!=request.transport&&_subscribed)&&(_open("re-opening",request.transport,request),request.reconnect&&_executeRequest())}function _ieXDR(request){_ieStream=_configureXDR(request),_ieStream.open()}function _configureXDR(request){var rq=_request;null!=request&&void 0!==request&&(rq=request);var transport=rq.transport,lastIndex=0,xdrCallback=function(xdr){var responseBody=xdr.responseText,isJunkEnded=!1;if(-1!=responseBody.indexOf("\x3c!-- Welcome to the Atmosphere Framework.")&&(isJunkEnded=!0),isJunkEnded){var endOfJunkLenght="\x3c!-- EOD --\x3e".length,junkEnd=responseBody.indexOf("\x3c!-- EOD --\x3e")+endOfJunkLenght;responseBody=responseBody.substring(junkEnd+lastIndex),lastIndex+=responseBody.length}_prepareCallback(responseBody,"messageReceived",200,transport)},xdr=new window.XDomainRequest,rewriteURL=rq.rewriteURL||function(url){var match=/(?:^|;\s*)(JSESSIONID|PHPSESSID)=([^;]*)/.exec(document.cookie);switch(match&&match[1]){case"JSESSIONID":return url.replace(/;jsessionid=[^\?]*|(\?)|$/,";jsessionid="+match[2]+"$1");case"PHPSESSID":return url.replace(/\?PHPSESSID=[^&]*&?|\?|$/,"?PHPSESSID="+match[2]+"&").replace(/&$/,"")}};return xdr.onprogress=function(){xdrCallback(xdr)},xdr.onerror=function(){_prepareCallback(xdr.responseText,"error",500,transport)},xdr.onload=function(){""!=xdr.responseText&&xdrCallback(xdr),"long-polling"==rq.transport&&_executeRequest()},{open:function(){"POST"==rq.method&&(rq.attachHeadersAsQueryString=!0);var url=_attachHeaders(rq);"POST"==rq.method&&(url+="&X-Atmosphere-Post-Body="+rq.data),xdr.open(rq.method,rewriteURL(url)),xdr.send(),rq.connectTimeout>-1&&(rq.id=setTimeout(function(){0==rq.requestCount&&(xdr.abort(),_prepareCallback("Connect timeout","closed",200,rq.transport))},rq.connectTimeout))},close:function(){xdr.abort(),_prepareCallback(xdr.responseText,"closed",200,transport)}}}function _ieStreaming(request){_ieStream=_configureIE(request),_ieStream.open()}function _configureIE(request){var rq=_request;null!=request&&void 0!==request&&(rq=request);var stop,doc=new window.ActiveXObject("htmlfile");doc.open(),doc.close();var url=rq.url;return"polling"!=rq.transport&&(_response.transport=rq.transport),{open:function(){var iframe=doc.createElement("iframe");url=_attachHeaders(rq),""!=rq.data&&(url+="&X-Atmosphere-Post-Body="+rq.data),url=jQuery.atmosphere.prepareURL(url),iframe.src=url,doc.body.appendChild(iframe);var cdoc=iframe.contentDocument||iframe.contentWindow.document;stop=jQuery.atmosphere.iterate(function(){try{if(!cdoc.firstChild)return;if("complete"===cdoc.readyState)try{jQuery.noop(cdoc.fileSize)}catch(e){return _prepareCallback("Connection Failure","error",500,rq.transport),!1}var res=cdoc.body?cdoc.body.lastChild:cdoc,readResponse=function(){var clone=res.cloneNode(!0);clone.appendChild(cdoc.createTextNode("."));var text=clone.innerText,isJunkEnded=!0;if(-1==text.indexOf("\x3c!-- Welcome to the Atmosphere Framework.")&&(isJunkEnded=!1),isJunkEnded){var endOfJunkLenght="\x3c!-- EOD --\x3e".length,junkEnd=text.indexOf("\x3c!-- EOD --\x3e")+endOfJunkLenght;text=text.substring(junkEnd)}return text.substring(0,text.length-1)};if(!jQuery.nodeName(res,"pre")){var head=cdoc.head||cdoc.getElementsByTagName("head")[0]||cdoc.documentElement||cdoc,script=cdoc.createElement("script");script.text="document.write('<plaintext>')",head.insertBefore(script,head.firstChild),head.removeChild(script),res=cdoc.body.lastChild}return _prepareCallback(readResponse(),"opening",200,rq.transport),stop=jQuery.atmosphere.iterate(function(){var text=readResponse();if(text.length>rq.lastIndex&&(_response.status=200,_prepareCallback(text,"messageReceived",200,rq.transport),res.innerText="",rq.lastIndex=0),"complete"===cdoc.readyState)return _prepareCallback("","re-opening",200,rq.transport),_ieStreaming(rq),!1},null),!1}catch(err){jQuery.atmosphere.error(err)}})},close:function(){stop&&stop(),doc.execCommand("Stop"),_prepareCallback("","closed",200,rq.transport)}}}function _push(message){null!=_activeRequest||null!=_sse?_pushAjaxMessage(message):null!=_ieStream?_pushIE(message):null!=_jqxhr?_pushJsonp(message):null!=_websocket&&_pushWebSocket(message)}function _pushAjaxMessage(message){_executeRequest(_getPushRequest(message))}function _pushIE(message){_pushAjaxMessage(message)}function _pushJsonp(message){_pushAjaxMessage(message)}function _getStringMessage(message){var msg=message;return"object"==typeof msg&&(msg=message.data),msg}function _getPushRequest(message){var msg=_getStringMessage(message),rq={connected:!1,timeout:6e4,method:"POST",url:_request.url,contentType:_request.contentType,headers:{},reconnect:!0,callback:null,data:msg,suspend:!1,maxRequest:60,logLevel:"info",requestCount:0,transport:"polling"};return"object"==typeof message&&(rq=jQuery.extend(rq,message)),rq}function _pushWebSocket(message){var data,msg=_getStringMessage(message);try{data=null!=_request.webSocketUrl?_request.webSocketPathDelimiter+_request.webSocketUrl+_request.webSocketPathDelimiter+msg:msg,_websocket.send(data)}catch(e){_websocket.onclose=function(message){},_websocket.close(),_reconnectWithFallbackTransport("Websocket failed. Downgrading to Comet and resending "+data),_pushAjaxMessage(message)}}function _prepareCallback(messageBody,state,errorCode,transport){"messageReceived"==state&&_trackMessageSize(messageBody,_request,_response)||(_response.transport=transport,_response.status=errorCode,-1==_response.expectedBodySize&&(_response.responseBody=messageBody),_response.state=state,_invokeCallback())}function _invokeFunction(response){_f(response,_request),_f(response,jQuery.atmosphere)}function _f(response,f){switch(response.state){case"messageReceived":void 0!==f.onMessage&&f.onMessage(response);break;case"error":void 0!==f.onError&&f.onError(response);break;case"opening":void 0!==f.onOpen&&f.onOpen(response);break;case"messagePublished":void 0!==f.onMessagePublished&&f.onMessagePublished(response);break;case"re-opening":void 0!==f.onReconnect&&f.onReconnect(_request,response);break;case"closed":void 0!==f.onClose&&f.onClose(response)}}function _invokeCallback(){var call=function(index,func){func(_response)},messages="string"==typeof _response.responseBody?_response.responseBody.split(_request.messageDelimiter):new Array(_response.responseBody);for(i=0;i<messages.length;i++)if(!(messages.length>1&&0==messages[i].length)){if(_response.responseBody=jQuery.trim(messages[i]),_invokeFunction(_response),jQuery.atmosphere.callbacks.length>0){jQuery.atmosphere.debug("Invoking "+jQuery.atmosphere.callbacks.length+" global callbacks: "+_response.state);try{jQuery.each(jQuery.atmosphere.callbacks,call)}catch(e){jQuery.atmosphere.log(_request.logLevel,["Callback exception"+e])}}
if("function"==typeof _request.callback){"debug"==_request.logLevel&&jQuery.atmosphere.debug("Invoking request callbacks");try{_request.callback(_response)}catch(e){jQuery.atmosphere.log(_request.logLevel,["Callback exception"+e])}}}}function _close(){_request.reconnect=!1,_response.request=_request,_subscribed=!1,_abordingConnection=!0,_response.state="unsubscribe",_response.responseBody="",_response.status=408,_invokeCallback(),_clearState()}function _clearState(){null!=_ieStream&&(_ieStream.close(),_ieStream=null),null!=_jqxhr&&(_jqxhr.abort(),_jqxhr=null),null!=_activeRequest&&(_activeRequest.abort(),_activeRequest=null),null!=_websocket&&(_websocket.close(),_websocket=null),null!=_sse&&(_sse.close(),_sse=null)}var _request={timeout:3e5,method:"GET",headers:{},contentType:"",callback:null,url:"",data:"",suspend:!0,maxRequest:60,reconnect:!0,maxStreamingLength:1e7,lastIndex:0,logLevel:"info",requestCount:0,fallbackMethod:"GET",fallbackTransport:"streaming",transport:"long-polling",webSocketImpl:null,webSocketUrl:null,webSocketPathDelimiter:"@@",enableXDR:!1,rewriteURL:!1,attachHeadersAsQueryString:!0,executeCallbackBeforeReconnect:!1,readyState:0,lastTimestamp:0,withCredentials:!1,trackMessageLength:!1,messageDelimiter:"|",connectTimeout:-1,dropAtmosphereHeaders:!1,onError:function(response){},onClose:function(response){},onOpen:function(response){},onMessage:function(response){},onReconnect:function(request,response){},onMessagePublished:function(response){},onTransportFailure:function(reason,request){}},_response={status:200,responseBody:"",expectedBodySize:-1,headers:[],state:"messageReceived",transport:"polling",error:null,request:null,id:0},_uuid=0,_websocket=null,_sse=null,_activeRequest=null,_ieStream=null,_jqxhr=null,_subscribed=!0,_requestCount=0,_abordingConnection=!1;_subscribe(options),this.subscribe=function(options){_subscribe(options),_execute()},this.execute=function(){_execute()},this.invokeCallback=function(){_invokeCallback()},this.close=function(){_close()},this.getUrl=function(){return _request.url},this.push=function(message){_push(message)},this.response=_response},subscribe:function(url,callback,request){"function"==typeof callback&&jQuery.atmosphere.addCallback(callback),"string"!=typeof url?request=url:request.url=url;var rq=new jQuery.atmosphere.AtmosphereRequest(request);return rq.execute(),jQuery.atmosphere.requests[jQuery.atmosphere.requests.length]=rq,rq},addCallback:function(func){-1==jQuery.inArray(func,jQuery.atmosphere.callbacks)&&jQuery.atmosphere.callbacks.push(func)},removeCallback:function(func){var index=jQuery.inArray(func,jQuery.atmosphere.callbacks);-1!=index&&jQuery.atmosphere.callbacks.splice(index,1)},unsubscribe:function(){if(jQuery.atmosphere.requests.length>0)for(var i=0;i<jQuery.atmosphere.requests.length;i++)jQuery.atmosphere.requests[i].close(),clearTimeout(jQuery.atmosphere.requests[i].id);jQuery.atmosphere.requests=[],jQuery.atmosphere.callbacks=[]},unsubscribeUrl:function(url){var idx=-1;if(jQuery.atmosphere.requests.length>0)for(var i=0;i<jQuery.atmosphere.requests.length;i++){var rq=jQuery.atmosphere.requests[i];if(rq.getUrl()==url){rq.close(),clearTimeout(rq.id),idx=i;break}}idx>=0&&jQuery.atmosphere.requests.splice(idx,1)},publish:function(request){"function"==typeof request.callback&&jQuery.atmosphere.addCallback(callback),request.transport="polling";var rq=new jQuery.atmosphere.AtmosphereRequest(request);return jQuery.atmosphere.requests[jQuery.atmosphere.requests.length]=rq,rq},checkCORSSupport:function(){return!(!jQuery.browser.msie||window.XDomainRequest)||(!!jQuery.browser.opera||!!(navigator.userAgent.toLowerCase().indexOf("android")>-1))},S4:function(){return(65536*(1+Math.random())|0).toString(16).substring(1)},guid:function(){return jQuery.atmosphere.S4()+jQuery.atmosphere.S4()+"-"+jQuery.atmosphere.S4()+"-"+jQuery.atmosphere.S4()+"-"+jQuery.atmosphere.S4()+"-"+jQuery.atmosphere.S4()+jQuery.atmosphere.S4()+jQuery.atmosphere.S4()},prepareURL:function(url){var ts=jQuery.now(),ret=url.replace(/([?&])_=[^&]*/,"$1_="+ts);return ret+(ret===url?(/\?/.test(url)?"&":"?")+"_="+ts:"")},param:function(data){return jQuery.param(data,jQuery.ajaxSettings.traditional)},iterate:function(fn,interval){var timeoutId;return interval=interval||0,function loop(){timeoutId=setTimeout(function(){!1!==fn()&&loop()},interval)}(),function(){clearTimeout(timeoutId)}},log:function(level,args){if(window.console){var logger=window.console[level];"function"==typeof logger&&logger.apply(window.console,args)}},warn:function(){jQuery.atmosphere.log("warn",arguments)},info:function(){jQuery.atmosphere.log("info",arguments)},debug:function(){jQuery.atmosphere.log("debug",arguments)},error:function(){jQuery.atmosphere.log("error",arguments)}}}(),function(jQuery){function quote(string){return'"'+string.replace(escapable,function(a){var c=meta[a];return"string"==typeof c?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"'}function f(n){return n<10?"0"+n:n}function str(key,holder){var i,v,len,partial,value=holder[key],type=typeof value;switch(value&&"object"==typeof value&&"function"==typeof value.toJSON&&(value=value.toJSON(key),type=typeof value),type){case"string":return quote(value);case"number":return isFinite(value)?String(value):"null";case"boolean":return String(value);case"object":if(!value)return"null";switch(Object.prototype.toString.call(value)){case"[object Date]":return isFinite(value.valueOf())?'"'+value.getUTCFullYear()+"-"+f(value.getUTCMonth()+1)+"-"+f(value.getUTCDate())+"T"+f(value.getUTCHours())+":"+f(value.getUTCMinutes())+":"+f(value.getUTCSeconds())+'Z"':"null";case"[object Array]":for(len=value.length,partial=[],i=0;i<len;i++)partial.push(str(i,value)||"null");return"["+partial.join(",")+"]";default:partial=[];for(i in value)Object.prototype.hasOwnProperty.call(value,i)&&(v=str(i,value))&&partial.push(quote(i)+":"+v);return"{"+partial.join(",")+"}"}}}var escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};jQuery.stringifyJSON=function(value){return window.JSON&&window.JSON.stringify?window.JSON.stringify(value):str("",{"":value})}}(jQuery),function(t,e){function i(e){return!t(e).parents().andSelf().filter(function(){return"hidden"===t.curCSS(this,"visibility")||t.expr.filters.hidden(this)}).length}function a(e,a){var n=e.nodeName.toLowerCase();if("area"===n){var r,s=e.parentNode,o=s.name;return!(!e.href||!o||"map"!==s.nodeName.toLowerCase())&&(!!(r=t("img[usemap=#"+o+"]")[0])&&i(r))}return(/input|select|textarea|button|object/.test(n)?!e.disabled:"a"==n?e.href||a:a)&&i(e)}t.ui=t.ui||{},t.ui.version||(t.extend(t.ui,{version:"1.8.18",keyCode:{ALT:18,BACKSPACE:8,CAPS_LOCK:20,COMMA:188,COMMAND:91,COMMAND_LEFT:91,COMMAND_RIGHT:93,CONTROL:17,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,INSERT:45,LEFT:37,MENU:93,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SHIFT:16,SPACE:32,TAB:9,UP:38,WINDOWS:91}}),t.fn.extend({propAttr:t.fn.prop||t.fn.attr,_focus:t.fn.focus,focus:function(e,i){return"number"==typeof e?this.each(function(){var a=this;setTimeout(function(){t(a).focus(),i&&i.call(a)},e)}):this._focus.apply(this,arguments)},scrollParent:function(){var e;return e=t.browser.msie&&/(static|relative)/.test(this.css("position"))||/absolute/.test(this.css("position"))?this.parents().filter(function(){return/(relative|absolute|fixed)/.test(t.curCSS(this,"position",1))&&/(auto|scroll)/.test(t.curCSS(this,"overflow",1)+t.curCSS(this,"overflow-y",1)+t.curCSS(this,"overflow-x",1))}).eq(0):this.parents().filter(function(){return/(auto|scroll)/.test(t.curCSS(this,"overflow",1)+t.curCSS(this,"overflow-y",1)+t.curCSS(this,"overflow-x",1))}).eq(0),/fixed/.test(this.css("position"))||!e.length?t(document):e},zIndex:function(i){if(i!==e)return this.css("zIndex",i);if(this.length)for(var a,n,r=t(this[0]);r.length&&r[0]!==document;){if(("absolute"===(a=r.css("position"))||"relative"===a||"fixed"===a)&&(n=parseInt(r.css("zIndex"),10),!isNaN(n)&&0!==n))return n;r=r.parent()}return 0},disableSelection:function(){return this.bind((t.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",function(t){t.preventDefault()})},enableSelection:function(){return this.unbind(".ui-disableSelection")}}),t.each(["Width","Height"],function(i,a){function n(e,i,a,n){return t.each(r,function(){i-=parseFloat(t.curCSS(e,"padding"+this,!0))||0,a&&(i-=parseFloat(t.curCSS(e,"border"+this+"Width",!0))||0),n&&(i-=parseFloat(t.curCSS(e,"margin"+this,!0))||0)}),i}var r="Width"===a?["Left","Right"]:["Top","Bottom"],s=a.toLowerCase(),o={innerWidth:t.fn.innerWidth,innerHeight:t.fn.innerHeight,outerWidth:t.fn.outerWidth,outerHeight:t.fn.outerHeight};t.fn["inner"+a]=function(i){return i===e?o["inner"+a].call(this):this.each(function(){t(this).css(s,n(this,i)+"px")})},t.fn["outer"+a]=function(e,i){return"number"!=typeof e?o["outer"+a].call(this,e):this.each(function(){t(this).css(s,n(this,e,!0,i)+"px")})}}),t.extend(t.expr[":"],{data:function(e,i,a){return!!t.data(e,a[3])},focusable:function(e){return a(e,!isNaN(t.attr(e,"tabindex")))},tabbable:function(e){var i=t.attr(e,"tabindex"),n=isNaN(i);return(n||i>=0)&&a(e,!n)}}),t(function(){var e=document.body,i=e.appendChild(i=document.createElement("div"));i.offsetHeight,t.extend(i.style,{minHeight:"100px",height:"auto",padding:0,borderWidth:0}),t.support.minHeight=100===i.offsetHeight,t.support.selectstart="onselectstart"in i,e.removeChild(i).style.display="none"}),t.extend(t.ui,{plugin:{add:function(e,i,a){var n=t.ui[e].prototype;for(var r in a)n.plugins[r]=n.plugins[r]||[],n.plugins[r].push([i,a[r]])},call:function(t,e,i){var a=t.plugins[e];if(a&&t.element[0].parentNode)for(var n=0;n<a.length;n++)t.options[a[n][0]]&&a[n][1].apply(t.element,i)}},contains:function(t,e){return document.compareDocumentPosition?16&t.compareDocumentPosition(e):t!==e&&t.contains(e)},hasScroll:function(e,i){if("hidden"===t(e).css("overflow"))return!1;var a=i&&"left"===i?"scrollLeft":"scrollTop",n=!1;return e[a]>0||(e[a]=1,n=e[a]>0,e[a]=0,n)},isOverAxis:function(t,e,i){return t>e&&e+i>t},isOver:function(e,i,a,n,r,s){return t.ui.isOverAxis(e,a,r)&&t.ui.isOverAxis(i,n,s)}}))}(jQuery),function(t,e){if(t.cleanData){var i=t.cleanData;t.cleanData=function(e){for(var a,n=0;null!=(a=e[n]);n++)try{t(a).triggerHandler("remove")}catch(r){}i(e)}}else{var a=t.fn.remove;t.fn.remove=function(e,i){return this.each(function(){return i||(!e||t.filter(e,[this]).length)&&t("*",this).add([this]).each(function(){try{t(this).triggerHandler("remove")}catch(e){}}),a.call(t(this),e,i)})}}t.widget=function(e,i,a){var n,r=e.split(".")[0];e=e.split(".")[1],n=r+"-"+e,a||(a=i,i=t.Widget),t.expr[":"][n]=function(i){return!!t.data(i,e)},t[r]=t[r]||{},t[r][e]=function(t,e){arguments.length&&this._createWidget(t,e)};var s=new i;s.options=t.extend(!0,{},s.options),t[r][e].prototype=t.extend(!0,s,{namespace:r,widgetName:e,widgetEventPrefix:t[r][e].prototype.widgetEventPrefix||e,widgetBaseClass:n},a),t.widget.bridge(e,t[r][e])},t.widget.bridge=function(i,a){t.fn[i]=function(n){var r="string"==typeof n,s=Array.prototype.slice.call(arguments,1),o=this;return n=!r&&s.length?t.extend.apply(null,[!0,n].concat(s)):n,r&&"_"===n.charAt(0)?o:(r?this.each(function(){var a=t.data(this,i),r=a&&t.isFunction(a[n])?a[n].apply(a,s):a;return r!==a&&r!==e?(o=r,!1):void 0}):this.each(function(){var e=t.data(this,i);e?e.option(n||{})._init():t.data(this,i,new a(n,this))}),o)}},t.Widget=function(t,e){arguments.length&&this._createWidget(t,e)},t.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",options:{disabled:!1},_createWidget:function(e,i){t.data(i,this.widgetName,this),this.element=t(i),this.options=t.extend(!0,{},this.options,this._getCreateOptions(),e);var a=this;this.element.bind("remove."+this.widgetName,function(){a.destroy()}),this._create(),this._trigger("create"),this._init()},_getCreateOptions:function(){return t.metadata&&t.metadata.get(this.element[0])[this.widgetName]},_create:function(){},_init:function(){},destroy:function(){this.element.unbind("."+this.widgetName).removeData(this.widgetName),this.widget().unbind("."+this.widgetName).removeAttr("aria-disabled").removeClass(this.widgetBaseClass+"-disabled ui-state-disabled")},widget:function(){return this.element},option:function(i,a){var n=i;if(0===arguments.length)return t.extend({},this.options);if("string"==typeof i){if(a===e)return this.options[i];n={},n[i]=a}return this._setOptions(n),this},_setOptions:function(e){var i=this;return t.each(e,function(t,e){i._setOption(t,e)}),this},_setOption:function(t,e){return this.options[t]=e,"disabled"===t&&this.widget()[e?"addClass":"removeClass"](this.widgetBaseClass+"-disabled ui-state-disabled").attr("aria-disabled",e),this},enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_trigger:function(e,i,a){var n,r,s=this.options[e];if(a=a||{},i=t.Event(i),i.type=(e===this.widgetEventPrefix?e:this.widgetEventPrefix+e).toLowerCase(),i.target=this.element[0],r=i.originalEvent)for(n in r)n in i||(i[n]=r[n]);return this.element.trigger(i,a),!(t.isFunction(s)&&!1===s.call(this.element[0],i,a)||i.isDefaultPrevented())}}}(jQuery),function($,undefined){function isArray(t){return t&&($.browser.safari&&"object"==typeof t&&t.length||t.constructor&&t.constructor.toString().match(/\Array\(\)/))}function extendRemove(t,e){$.extend(t,e);for(var i in e)(null==e[i]||e[i]==undefined)&&(t[i]=e[i]);return t}function bindHover(t){var e="button, .ui-datepicker-prev, .ui-datepicker-next, .ui-datepicker-calendar td a";return t.bind("mouseout",function(t){var i=$(t.target).closest(e);!i.length||i.removeClass("ui-state-hover ui-datepicker-prev-hover ui-datepicker-next-hover")}).bind("mouseover",function(i){var a=$(i.target).closest(e);!$.datepicker._isDisabledDatepicker(instActive.inline?t.parent()[0]:instActive.input[0])&&!!a.length&&(a.parents(".ui-datepicker-calendar").find("a").removeClass("ui-state-hover"),a.addClass("ui-state-hover"),a.hasClass("ui-datepicker-prev")&&a.addClass("ui-datepicker-prev-hover"),a.hasClass("ui-datepicker-next")&&a.addClass("ui-datepicker-next-hover"))})}function Datepicker(){this.debug=!1,this._curInst=null,this._keyEvent=!1,this._disabledInputs=[],this._datepickerShowing=!1,this._inDialog=!1,this._mainDivId="ui-datepicker-div",this._inlineClass="ui-datepicker-inline",this._appendClass="ui-datepicker-append",this._triggerClass="ui-datepicker-trigger",this._dialogClass="ui-datepicker-dialog",this._disableClass="ui-datepicker-disabled",this._unselectableClass="ui-datepicker-unselectable",this._currentClass="ui-datepicker-current-day",this._dayOverClass="ui-datepicker-days-cell-over",this.regional=[],this.regional[""]={closeText:"Done",prevText:"Prev",nextText:"Next",currentText:"Today",monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],monthNamesShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayNamesShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],dayNamesMin:["Su","Mo","Tu","We","Th","Fr","Sa"],weekHeader:"Wk",dateFormat:"mm/dd/yy",firstDay:0,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},this._defaults={showOn:"focus",showAnim:"fadeIn",showOptions:{},defaultDate:null,appendText:"",buttonText:"...",buttonImage:"",buttonImageOnly:!1,hideIfNoPrevNext:!1,navigationAsDateFormat:!1,gotoCurrent:!1,changeMonth:!1,changeYear:!1,yearRange:"c-10:c+10",showOtherMonths:!1,selectOtherMonths:!1,showWeek:!1,calculateWeek:this.iso8601Week,shortYearCutoff:"+10",minDate:null,maxDate:null,duration:"fast",beforeShowDay:null,beforeShow:null,onSelect:null,onChangeMonthYear:null,onClose:null,numberOfMonths:1,showCurrentAtPos:0,stepMonths:1,stepBigMonths:12,altField:"",altFormat:"",constrainInput:!0,showButtonPanel:!1,autoSize:!1,disabled:!1},$.extend(this._defaults,this.regional[""]),this.dpDiv=bindHover($('<div id="'+this._mainDivId+'" class="ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all"></div>'))}$.extend($.ui,{datepicker:{version:"1.8.18"}});var PROP_NAME="datepicker",dpuuid=(new Date).getTime(),instActive;$.extend(Datepicker.prototype,{markerClassName:"hasDatepicker",maxRows:4,log:function(){this.debug},_widgetDatepicker:function(){return this.dpDiv},setDefaults:function(t){return extendRemove(this._defaults,t||{}),this},_attachDatepicker:function(target,settings){var inlineSettings=null;for(var attrName in this._defaults){var attrValue=target.getAttribute("date:"+attrName);if(attrValue){inlineSettings=inlineSettings||{};try{inlineSettings[attrName]=eval(attrValue)}catch(err){inlineSettings[attrName]=attrValue}}}var nodeName=target.nodeName.toLowerCase(),inline="div"==nodeName||"span"==nodeName;target.id||(this.uuid+=1,target.id="dp"+this.uuid);var inst=this._newInst($(target),inline);inst.settings=$.extend({},settings||{},inlineSettings||{}),"input"==nodeName?this._connectDatepicker(target,inst):inline&&this._inlineDatepicker(target,inst)},_newInst:function(t,e){return{id:t[0].id.replace(/([^A-Za-z0-9_-])/g,"\\\\$1"),input:t,selectedDay:0,selectedMonth:0,selectedYear:0,drawMonth:0,drawYear:0,inline:e,dpDiv:e?bindHover($('<div class="'+this._inlineClass+' ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all"></div>')):this.dpDiv}},_connectDatepicker:function(t,e){var i=$(t);e.append=$([]),e.trigger=$([]),i.hasClass(this.markerClassName)||(this._attachments(i,e),i.addClass(this.markerClassName).keydown(this._doKeyDown).keypress(this._doKeyPress).keyup(this._doKeyUp).bind("setData.datepicker",function(t,i,a){e.settings[i]=a}).bind("getData.datepicker",function(t,i){return this._get(e,i)}),this._autoSize(e),$.data(t,PROP_NAME,e),e.settings.disabled&&this._disableDatepicker(t))},_attachments:function(t,e){var i=this._get(e,"appendText"),a=this._get(e,"isRTL");e.append&&e.append.remove(),i&&(e.append=$('<span class="'+this._appendClass+'">'+i+"</span>"),t[a?"before":"after"](e.append)),t.unbind("focus",this._showDatepicker),e.trigger&&e.trigger.remove();var n=this._get(e,"showOn");if(("focus"==n||"both"==n)&&t.focus(this._showDatepicker),"button"==n||"both"==n){var r=this._get(e,"buttonText"),s=this._get(e,"buttonImage");e.trigger=$(this._get(e,"buttonImageOnly")?$("<img/>").addClass(this._triggerClass).attr({src:s,alt:r,title:r}):$('<button type="button"></button>').addClass(this._triggerClass).html(""==s?r:$("<img/>").attr({src:s,alt:r,title:r}))),t[a?"before":"after"](e.trigger),e.trigger.click(function(){return $.datepicker._datepickerShowing&&$.datepicker._lastInput==t[0]?$.datepicker._hideDatepicker():$.datepicker._datepickerShowing&&$.datepicker._lastInput!=t[0]?($.datepicker._hideDatepicker(),$.datepicker._showDatepicker(t[0])):$.datepicker._showDatepicker(t[0]),!1})}},_autoSize:function(t){if(this._get(t,"autoSize")&&!t.inline){var e=new Date(2009,11,20),i=this._get(t,"dateFormat");if(i.match(/[DM]/)){var a=function(t){for(var e=0,i=0,a=0;a<t.length;a++)t[a].length>e&&(e=t[a].length,i=a);return i};e.setMonth(a(this._get(t,i.match(/MM/)?"monthNames":"monthNamesShort"))),e.setDate(a(this._get(t,i.match(/DD/)?"dayNames":"dayNamesShort"))+20-e.getDay())}t.input.attr("size",this._formatDate(t,e).length)}},_inlineDatepicker:function(t,e){var i=$(t);i.hasClass(this.markerClassName)||(i.addClass(this.markerClassName).append(e.dpDiv).bind("setData.datepicker",function(t,i,a){e.settings[i]=a}).bind("getData.datepicker",function(t,i){return this._get(e,i)}),$.data(t,PROP_NAME,e),this._setDate(e,this._getDefaultDate(e),!0),this._updateDatepicker(e),this._updateAlternate(e),e.settings.disabled&&this._disableDatepicker(t),e.dpDiv.css("display","block"))},_dialogDatepicker:function(t,e,i,a,n){var r=this._dialogInst;if(!r){this.uuid+=1;var s="dp"+this.uuid;this._dialogInput=$('<input type="text" id="'+s+'" style="position: absolute; top: -100px; width: 0px; z-index: -10;"/>'),this._dialogInput.keydown(this._doKeyDown),$(".PGU-widgets-container").append(this._dialogInput),r=this._dialogInst=this._newInst(this._dialogInput,!1),r.settings={},$.data(this._dialogInput[0],PROP_NAME,r)}if(extendRemove(r.settings,a||{}),e=e&&e.constructor==Date?this._formatDate(r,e):e,this._dialogInput.val(e),this._pos=n?n.length?n:[n.pageX,n.pageY]:null,!this._pos){var o=document.documentElement.clientWidth,d=document.documentElement.clientHeight,c=document.documentElement.scrollLeft||document.body.scrollLeft,u=document.documentElement.scrollTop||document.body.scrollTop;this._pos=[o/2-100+c,d/2-150+u]}return this._dialogInput.css("left",this._pos[0]+20+"px").css("top",this._pos[1]+"px"),r.settings.onSelect=i,this._inDialog=!0,this.dpDiv.addClass(this._dialogClass),this._showDatepicker(this._dialogInput[0]),$.blockUI&&$.blockUI(this.dpDiv),$.data(this._dialogInput[0],PROP_NAME,r),this},_destroyDatepicker:function(t){var e=$(t),i=$.data(t,PROP_NAME);if(e.hasClass(this.markerClassName)){var a=t.nodeName.toLowerCase();$.removeData(t,PROP_NAME),"input"==a?(i.append.remove(),i.trigger.remove(),e.removeClass(this.markerClassName).unbind("focus",this._showDatepicker).unbind("keydown",this._doKeyDown).unbind("keypress",this._doKeyPress).unbind("keyup",this._doKeyUp)):("div"==a||"span"==a)&&e.removeClass(this.markerClassName).empty()}},_enableDatepicker:function(t){var e=$(t),i=$.data(t,PROP_NAME);if(e.hasClass(this.markerClassName)){var a=t.nodeName.toLowerCase();if("input"==a)t.disabled=!1,i.trigger.filter("button").each(function(){this.disabled=!1}).end().filter("img").css({opacity:"1.0",cursor:""});else if("div"==a||"span"==a){var n=e.children("."+this._inlineClass);n.children().removeClass("ui-state-disabled"),n.find("select.ui-datepicker-month, select.ui-datepicker-year").removeAttr("disabled")}this._disabledInputs=$.map(this._disabledInputs,function(e){return e==t?null:e})}},_disableDatepicker:function(t){var e=$(t),i=$.data(t,PROP_NAME);if(e.hasClass(this.markerClassName)){var a=t.nodeName.toLowerCase();if("input"==a)t.disabled=!0,i.trigger.filter("button").each(function(){this.disabled=!0}).end().filter("img").css({opacity:"0.5",cursor:"default"});else if("div"==a||"span"==a){var n=e.children("."+this._inlineClass);n.children().addClass("ui-state-disabled"),n.find("select.ui-datepicker-month, select.ui-datepicker-year").attr("disabled","disabled")}this._disabledInputs=$.map(this._disabledInputs,function(e){return e==t?null:e}),this._disabledInputs[this._disabledInputs.length]=t}},_isDisabledDatepicker:function(t){if(!t)return!1;for(var e=0;e<this._disabledInputs.length;e++)if(this._disabledInputs[e]==t)return!0;return!1},_getInst:function(t){try{return $.data(t,PROP_NAME)}catch(e){throw"Missing instance data for this datepicker"}},_optionDatepicker:function(t,e,i){var a=this._getInst(t);if(2==arguments.length&&"string"==typeof e)return"defaults"==e?$.extend({},$.datepicker._defaults):a?"all"==e?$.extend({},a.settings):this._get(a,e):null;var n=e||{};if("string"==typeof e&&(n={},n[e]=i),a){this._curInst==a&&this._hideDatepicker();var r=this._getDateDatepicker(t,!0),s=this._getMinMaxDate(a,"min"),o=this._getMinMaxDate(a,"max");extendRemove(a.settings,n),null!==s&&n.dateFormat!==undefined&&n.minDate===undefined&&(a.settings.minDate=this._formatDate(a,s)),null!==o&&n.dateFormat!==undefined&&n.maxDate===undefined&&(a.settings.maxDate=this._formatDate(a,o)),this._attachments($(t),a),this._autoSize(a),this._setDate(a,r),this._updateAlternate(a),this._updateDatepicker(a)}},_changeDatepicker:function(t,e,i){this._optionDatepicker(t,e,i)},_refreshDatepicker:function(t){var e=this._getInst(t);e&&this._updateDatepicker(e)},_setDateDatepicker:function(t,e){var i=this._getInst(t);i&&(this._setDate(i,e),this._updateDatepicker(i),this._updateAlternate(i))},_getDateDatepicker:function(t,e){var i=this._getInst(t);return i&&!i.inline&&this._setDateFromField(i,e),i?this._getDate(i):null},_doKeyDown:function(t){var e=$.datepicker._getInst(t.target),i=!0,a=e.dpDiv.is(".ui-datepicker-rtl");if(e._keyEvent=!0,$.datepicker._datepickerShowing)switch(t.keyCode){case 9:$.datepicker._hideDatepicker(),i=!1;break;case 13:var n=$("td."+$.datepicker._dayOverClass+":not(."+$.datepicker._currentClass+")",e.dpDiv);n[0]&&$.datepicker._selectDay(t.target,e.selectedMonth,e.selectedYear,n[0]);var r=$.datepicker._get(e,"onSelect");if(r){var s=$.datepicker._formatDate(e);r.apply(e.input?e.input[0]:null,[s,e])}else $.datepicker._hideDatepicker();return!1;case 27:$.datepicker._hideDatepicker();break;case 33:$.datepicker._adjustDate(t.target,t.ctrlKey?-$.datepicker._get(e,"stepBigMonths"):-$.datepicker._get(e,"stepMonths"),"M");break;case 34:$.datepicker._adjustDate(t.target,t.ctrlKey?+$.datepicker._get(e,"stepBigMonths"):+$.datepicker._get(e,"stepMonths"),"M");break;case 35:(t.ctrlKey||t.metaKey)&&$.datepicker._clearDate(t.target),i=t.ctrlKey||t.metaKey;break;case 36:(t.ctrlKey||t.metaKey)&&$.datepicker._gotoToday(t.target),i=t.ctrlKey||t.metaKey;break;case 37:(t.ctrlKey||t.metaKey)&&$.datepicker._adjustDate(t.target,a?1:-1,"D"),i=t.ctrlKey||t.metaKey,t.originalEvent.altKey&&$.datepicker._adjustDate(t.target,t.ctrlKey?-$.datepicker._get(e,"stepBigMonths"):-$.datepicker._get(e,"stepMonths"),"M");break;case 38:(t.ctrlKey||t.metaKey)&&$.datepicker._adjustDate(t.target,-7,"D"),i=t.ctrlKey||t.metaKey;break;case 39:(t.ctrlKey||t.metaKey)&&$.datepicker._adjustDate(t.target,a?-1:1,"D"),i=t.ctrlKey||t.metaKey,t.originalEvent.altKey&&$.datepicker._adjustDate(t.target,t.ctrlKey?+$.datepicker._get(e,"stepBigMonths"):+$.datepicker._get(e,"stepMonths"),"M");break;case 40:(t.ctrlKey||t.metaKey)&&$.datepicker._adjustDate(t.target,7,"D"),i=t.ctrlKey||t.metaKey;break;default:i=!1}else 36==t.keyCode&&t.ctrlKey?$.datepicker._showDatepicker(this):i=!1;i&&(t.preventDefault(),t.stopPropagation())},_doKeyPress:function(t){var e=$.datepicker._getInst(t.target);if($.datepicker._get(e,"constrainInput")){var i=$.datepicker._possibleChars($.datepicker._get(e,"dateFormat")),a=String.fromCharCode(t.charCode==undefined?t.keyCode:t.charCode);return t.ctrlKey||t.metaKey||" ">a||!i||i.indexOf(a)>-1}},_doKeyUp:function(t){var e=$.datepicker._getInst(t.target);if(e.input.val()!=e.lastVal)try{$.datepicker.parseDate($.datepicker._get(e,"dateFormat"),e.input?e.input.val():null,$.datepicker._getFormatConfig(e))&&($.datepicker._setDateFromField(e),$.datepicker._updateAlternate(e),$.datepicker._updateDatepicker(e))}catch(t){$.datepicker.log(t)}return!0},_showDatepicker:function(t){if(t=t.target||t,"input"!=t.nodeName.toLowerCase()&&(t=$("input",t.parentNode)[0]),!$.datepicker._isDisabledDatepicker(t)&&$.datepicker._lastInput!=t){var e=$.datepicker._getInst(t);$.datepicker._curInst&&$.datepicker._curInst!=e&&($.datepicker._curInst.dpDiv.stop(!0,!0),e&&$.datepicker._datepickerShowing&&$.datepicker._hideDatepicker($.datepicker._curInst.input[0]));var i=$.datepicker._get(e,"beforeShow"),a=i?i.apply(t,[t,e]):{};if(!1===a)return;extendRemove(e.settings,a),e.lastVal=null,$.datepicker._lastInput=t,$.datepicker._setDateFromField(e),$.datepicker._inDialog&&(t.value=""),$.datepicker._pos||($.datepicker._pos=$.datepicker._findPos(t),$.datepicker._pos[1]+=t.offsetHeight);var n=!1;$(t).parents().each(function(){return!(n|="fixed"==$(this).css("position"))}),n&&$.browser.opera&&($.datepicker._pos[0]-=document.documentElement.scrollLeft,$.datepicker._pos[1]-=document.documentElement.scrollTop);var r={left:$.datepicker._pos[0],top:$.datepicker._pos[1]};if($.datepicker._pos=null,e.dpDiv.empty(),e.dpDiv.css({position:"absolute",display:"block",top:"-1000px"}),$.datepicker._updateDatepicker(e),r=$.datepicker._checkOffset(e,r,n),e.dpDiv.css({position:$.datepicker._inDialog&&$.blockUI?"static":n?"fixed":"absolute",display:"none",left:r.left+"px",top:r.top+"px",width:r.width+"px"}),!e.inline){var s=$.datepicker._get(e,"showAnim"),o=$.datepicker._get(e,"duration"),d=function(){var t=e.dpDiv.find("iframe.ui-datepicker-cover");if(t.length){var i=$.datepicker._getBorders(e.dpDiv);t.css({left:-i[0],top:-i[1],width:e.dpDiv.outerWidth(),height:e.dpDiv.outerHeight()})}};e.dpDiv.zIndex($(t).zIndex()+1),$.datepicker._datepickerShowing=!0,$.effects&&$.effects[s]?e.dpDiv.show(s,$.datepicker._get(e,"showOptions"),o,d):e.dpDiv[s||"show"](s?o:null,d),(!s||!o)&&d(),e.input.is(":visible")&&!e.input.is(":disabled")&&e.input.focus(),$.datepicker._curInst=e}}},_updateDatepicker:function(t){this.maxRows=4;var i=$.datepicker._getBorders(t.dpDiv);instActive=t,t.dpDiv.empty().append(this._generateHTML(t));var a=t.dpDiv.find("iframe.ui-datepicker-cover");!a.length||a.css({left:-i[0],top:-i[1],width:t.dpDiv[0].clientWidth,height:t.dpDiv.outerHeight()}),t.dpDiv.find("."+this._dayOverClass+" a").mouseover();var n=this._getNumberOfMonths(t),r=n[1];if(t.dpDiv.removeClass("ui-datepicker-multi-2 ui-datepicker-multi-3 ui-datepicker-multi-4"),r>1&&t.dpDiv.addClass("ui-datepicker-multi-"+r).css("width",17*r+"em"),t.dpDiv[(1!=n[0]||1!=n[1]?"add":"remove")+"Class"]("ui-datepicker-multi"),t.dpDiv[(this._get(t,"isRTL")?"add":"remove")+"Class"]("ui-datepicker-rtl"),t==$.datepicker._curInst&&$.datepicker._datepickerShowing&&t.input&&t.input.is(":visible")&&!t.input.is(":disabled")&&t.input[0]!=document.activeElement&&t.input.focus(),t.yearshtml){var o=t.yearshtml;setTimeout(function(){o===t.yearshtml&&t.yearshtml&&t.dpDiv.find("select.ui-datepicker-year:first").replaceWith(t.yearshtml),o=t.yearshtml=null},0)}},_getBorders:function(t){var e=function(t){return{thin:1,medium:2,thick:3}[t]||t};return[parseFloat(e(t.css("border-left-width"))),parseFloat(e(t.css("border-top-width")))]},_checkOffset:function(t,e,i){var a=t.dpDiv.outerWidth(),n=t.dpDiv.outerHeight(),r=t.input?t.input.outerWidth():0,s=t.input?t.input.outerHeight():0,o=document.documentElement.clientWidth+$(document).scrollLeft(),d=document.documentElement.clientHeight+$(document).scrollTop();return e.left-=this._get(t,"isRTL")?a-r:0,e.left-=i&&e.left==t.input.offset().left?$(document).scrollLeft():0,e.top-=i&&e.top==t.input.offset().top+s?$(document).scrollTop():0,e.left-=Math.min(e.left,e.left+a>o&&o>a?Math.abs(e.left+a-o):0),e.left-=$(".PGU-widgets-container").offset().left,e.top-=Math.min(e.top,e.top+n>d&&d>n?Math.abs(n+s):0),window.outerWidth>480?window.innerHeight-(t.input.offset().top-window.scrollY)-t.input.height()>=n.height()?e.top=t.input.offset().top-($(".PGU-widgets-container").offset().top-$("body").offset().top)+t.input.outerHeight(!0):e.top=t.input.offset().top-($(".PGU-widgets-container").offset().top-$("body").offset().top)-n.outerHeight(!0):e.top=t.input.offset().top-($(".PGU-widgets-container").offset().top-$("body").offset().top)+t.input.outerHeight(!0),e.width=t.input.outerWidth().width()+22,e},_findPos:function(t){for(var e=this._getInst(t),i=this._get(e,"isRTL");t&&("hidden"==t.type||1!=t.nodeType||$.expr.filters.hidden(t));)t=t[i?"previousSibling":"nextSibling"];var a=$(t).offset();return[a.left,a.top,a.width]},_hideDatepicker:function(t){var e=this._curInst;if(e&&(!t||e==$.data(t,PROP_NAME))&&this._datepickerShowing){var i=this._get(e,"showAnim"),a=this._get(e,"duration"),n=this,r=function(){$.datepicker._tidyDialog(e),n._curInst=null};$.effects&&$.effects[i]?e.dpDiv.hide(i,$.datepicker._get(e,"showOptions"),a,r):e.dpDiv["slideDown"==i?"slideUp":"fadeIn"==i?"fadeOut":"hide"](i?a:null,r),i||r(),this._datepickerShowing=!1;var s=this._get(e,"onClose");s&&s.apply(e.input?e.input[0]:null,[e.input?e.input.val():"",e]),this._lastInput=null,this._inDialog&&(this._dialogInput.css({position:"absolute",left:"0",top:"-100px"}),$.blockUI&&($.unblockUI(),$(".PGU-widgets-container").append(this.dpDiv))),this._inDialog=!1}},_tidyDialog:function(t){t.dpDiv.removeClass(this._dialogClass).unbind(".ui-datepicker-calendar")},
_checkExternalClick:function(t){if($.datepicker._curInst){var e=$(t.target),i=$.datepicker._getInst(e[0]);(e[0].id!=$.datepicker._mainDivId&&0==e.parents("#"+$.datepicker._mainDivId).length&&!e.hasClass($.datepicker.markerClassName)&&!e.closest("."+$.datepicker._triggerClass).length&&$.datepicker._datepickerShowing&&(!$.datepicker._inDialog||!$.blockUI)||e.hasClass($.datepicker.markerClassName)&&$.datepicker._curInst!=i)&&$.datepicker._hideDatepicker()}},_adjustDate:function(t,e,i){var a=$(t),n=this._getInst(a[0]);this._isDisabledDatepicker(a[0])||(this._adjustInstDate(n,e+("M"==i?this._get(n,"showCurrentAtPos"):0),i),this._updateDatepicker(n))},_gotoToday:function(t){var e=$(t),i=this._getInst(e[0]);if(this._get(i,"gotoCurrent")&&i.currentDay)i.selectedDay=i.currentDay,i.drawMonth=i.selectedMonth=i.currentMonth,i.drawYear=i.selectedYear=i.currentYear;else{var a=new Date;i.selectedDay=a.getDate(),i.drawMonth=i.selectedMonth=a.getMonth(),i.drawYear=i.selectedYear=a.getFullYear()}this._notifyChange(i),this._adjustDate(e)},_selectMonthYear:function(t,e,i){var a=$(t),n=this._getInst(a[0]);n["selected"+("M"==i?"Month":"Year")]=n["draw"+("M"==i?"Month":"Year")]=parseInt(e.options[e.selectedIndex].value,10),this._notifyChange(n),this._adjustDate(a)},_selectDay:function(t,e,i,a){var n=$(t);if(!$(a).hasClass(this._unselectableClass)&&!this._isDisabledDatepicker(n[0])){var r=this._getInst(n[0]);r.selectedDay=r.currentDay=$("a",a).html(),r.selectedMonth=r.currentMonth=e,r.selectedYear=r.currentYear=i,this._selectDate(t,this._formatDate(r,r.currentDay,r.currentMonth,r.currentYear))}},_clearDate:function(t){var e=$(t);this._getInst(e[0]),this._selectDate(e,"")},_selectDate:function(t,e){var i=$(t),a=this._getInst(i[0]);e=null!=e?e:this._formatDate(a),a.input&&a.input.val(e),this._updateAlternate(a);var n=this._get(a,"onSelect");n?n.apply(a.input?a.input[0]:null,[e,a]):a.input&&a.input.trigger("change"),a.inline?this._updateDatepicker(a):(this._hideDatepicker(),this._lastInput=a.input[0],"object"!=typeof a.input[0]&&a.input.focus(),this._lastInput=null)},_updateAlternate:function(t){var e=this._get(t,"altField");if(e){var i=this._get(t,"altFormat")||this._get(t,"dateFormat"),a=this._getDate(t),n=this.formatDate(i,a,this._getFormatConfig(t));$(e).each(function(){$(this).val(n)})}},noWeekends:function(t){var e=t.getDay();return[e>0&&6>e,""]},iso8601Week:function(t){var e=new Date(t.getTime());e.setDate(e.getDate()+4-(e.getDay()||7));var i=e.getTime();return e.setMonth(0),e.setDate(1),Math.floor(Math.round((i-e)/864e5)/7)+1},parseDate:function(t,e,i){if(null==t||null==e)throw"Invalid arguments";if(""==(e="object"==typeof e?e.toString():e+""))return null;var a=(i?i.shortYearCutoff:null)||this._defaults.shortYearCutoff;a="string"!=typeof a?a:(new Date).getFullYear()%100+parseInt(a,10);for(var n=(i?i.dayNamesShort:null)||this._defaults.dayNamesShort,r=(i?i.dayNames:null)||this._defaults.dayNames,s=(i?i.monthNamesShort:null)||this._defaults.monthNamesShort,o=(i?i.monthNames:null)||this._defaults.monthNames,d=-1,c=-1,u=-1,l=-1,h=!1,p=function(e){var i=D+1<t.length&&t.charAt(D+1)==e;return i&&D++,i},g=function(t){var i=p(t),a="@"==t?14:"!"==t?20:"y"==t&&i?4:"o"==t?3:2,n=new RegExp("^\\d{1,"+a+"}"),r=e.substring(m).match(n);if(!r)throw"Missing number at position "+m;return m+=r[0].length,parseInt(r[0],10)},f=function(t,i,a){var n=$.map(p(t)?a:i,function(t,e){return[[e,t]]}).sort(function(t,e){return-(t[1].length-e[1].length)}),r=-1;if($.each(n,function(t,i){var a=i[1];return e.substr(m,a.length).toLowerCase()==a.toLowerCase()?(r=i[0],m+=a.length,!1):void 0}),-1!=r)return r+1;throw"Unknown name at position "+m},_=function(){if(e.charAt(m)!=t.charAt(D))throw"Unexpected literal at position "+m;m++},m=0,D=0;D<t.length;D++)if(h)"'"!=t.charAt(D)||p("'")?_():h=!1;else switch(t.charAt(D)){case"d":u=g("d");break;case"D":f("D",n,r);break;case"o":l=g("o");break;case"m":c=g("m");break;case"M":c=f("M",s,o);break;case"y":d=g("y");break;case"@":var k=new Date(g("@"));d=k.getFullYear(),c=k.getMonth()+1,u=k.getDate();break;case"!":var k=new Date((g("!")-this._ticksTo1970)/1e4);d=k.getFullYear(),c=k.getMonth()+1,u=k.getDate();break;case"'":p("'")?_():h=!0;break;default:_()}if(m<e.length)throw"Extra/unparsed characters found in date: "+e.substring(m);if(-1==d?d=(new Date).getFullYear():100>d&&(d+=(new Date).getFullYear()-(new Date).getFullYear()%100+(a>=d?0:-100)),l>-1)for(c=1,u=l;;){var v=this._getDaysInMonth(d,c-1);if(v>=u)break;c++,u-=v}var k=this._daylightSavingAdjust(new Date(d,c-1,u));if(k.getFullYear()!=d||k.getMonth()+1!=c||k.getDate()!=u)throw"Invalid date";return k},ATOM:"yy-mm-dd",COOKIE:"D, dd M yy",ISO_8601:"yy-mm-dd",RFC_822:"D, d M y",RFC_850:"DD, dd-M-y",RFC_1036:"D, d M y",RFC_1123:"D, d M yy",RFC_2822:"D, d M yy",RSS:"D, d M y",TICKS:"!",TIMESTAMP:"@",W3C:"yy-mm-dd",_ticksTo1970:24*(718685+Math.floor(492.5)-Math.floor(19.7)+Math.floor(4.925))*60*60*1e7,formatDate:function(t,e,i){if(!e)return"";var a=(i?i.dayNamesShort:null)||this._defaults.dayNamesShort,n=(i?i.dayNames:null)||this._defaults.dayNames,r=(i?i.monthNamesShort:null)||this._defaults.monthNamesShort,s=(i?i.monthNames:null)||this._defaults.monthNames,o=function(e){var i=h+1<t.length&&t.charAt(h+1)==e;return i&&h++,i},d=function(t,e,i){var a=""+e;if(o(t))for(;a.length<i;)a="0"+a;return a},c=function(t,e,i,a){return o(t)?a[e]:i[e]},u="",l=!1;if(e)for(var h=0;h<t.length;h++)if(l)"'"!=t.charAt(h)||o("'")?u+=t.charAt(h):l=!1;else switch(t.charAt(h)){case"d":u+=d("d",e.getDate(),2);break;case"D":u+=c("D",e.getDay(),a,n);break;case"o":u+=d("o",Math.round((new Date(e.getFullYear(),e.getMonth(),e.getDate()).getTime()-new Date(e.getFullYear(),0,0).getTime())/864e5),3);break;case"m":u+=d("m",e.getMonth()+1,2);break;case"M":u+=c("M",e.getMonth(),r,s);break;case"y":u+=o("y")?e.getFullYear():(e.getYear()%100<10?"0":"")+e.getYear()%100;break;case"@":u+=e.getTime();break;case"!":u+=1e4*e.getTime()+this._ticksTo1970;break;case"'":o("'")?u+="'":l=!0;break;default:u+=t.charAt(h)}return u},_possibleChars:function(t){for(var e="",i=!1,a=function(e){var i=n+1<t.length&&t.charAt(n+1)==e;return i&&n++,i},n=0;n<t.length;n++)if(i)"'"!=t.charAt(n)||a("'")?e+=t.charAt(n):i=!1;else switch(t.charAt(n)){case"d":case"m":case"y":case"@":e+="0123456789";break;case"D":case"M":return null;case"'":a("'")?e+="'":i=!0;break;default:e+=t.charAt(n)}return e},_get:function(t,e){return t.settings[e]!==undefined?t.settings[e]:this._defaults[e]},_setDateFromField:function(t,e){if(t.input.val()!=t.lastVal){var i,a,n=this._get(t,"dateFormat"),r=t.lastVal=t.input?t.input.val():null;i=a=this._getDefaultDate(t);var s=this._getFormatConfig(t);try{i=this.parseDate(n,r,s)||a}catch(o){this.log(o),r=e?"":r}t.selectedDay=i.getDate(),t.drawMonth=t.selectedMonth=i.getMonth(),t.drawYear=t.selectedYear=i.getFullYear(),t.currentDay=r?i.getDate():0,t.currentMonth=r?i.getMonth():0,t.currentYear=r?i.getFullYear():0,this._adjustInstDate(t)}},_getDefaultDate:function(t){return this._restrictMinMax(t,this._determineDate(t,this._get(t,"defaultDate"),new Date))},_determineDate:function(t,e,i){var r=null==e||""===e?i:"string"==typeof e?function(e){try{return $.datepicker.parseDate($.datepicker._get(t,"dateFormat"),e,$.datepicker._getFormatConfig(t))}catch(i){}for(var a=(e.toLowerCase().match(/^c/)?$.datepicker._getDate(t):null)||new Date,n=a.getFullYear(),r=a.getMonth(),s=a.getDate(),o=/([+-]?[0-9]+)\s*(d|D|w|W|m|M|y|Y)?/g,d=o.exec(e);d;){switch(d[2]||"d"){case"d":case"D":s+=parseInt(d[1],10);break;case"w":case"W":s+=7*parseInt(d[1],10);break;case"m":case"M":r+=parseInt(d[1],10),s=Math.min(s,$.datepicker._getDaysInMonth(n,r));break;case"y":case"Y":n+=parseInt(d[1],10),s=Math.min(s,$.datepicker._getDaysInMonth(n,r))}d=o.exec(e)}return new Date(n,r,s)}(e):"number"==typeof e?isNaN(e)?i:function(t){var e=new Date;return e.setDate(e.getDate()+t),e}(e):new Date(e.getTime());return r=r&&"Invalid Date"==r.toString()?i:r,r&&(r.setHours(0),r.setMinutes(0),r.setSeconds(0),r.setMilliseconds(0)),this._daylightSavingAdjust(r)},_daylightSavingAdjust:function(t){return t?(t.setHours(t.getHours()>12?t.getHours()+2:0),t):null},_setDate:function(t,e,i){var a=!e,n=t.selectedMonth,r=t.selectedYear,s=this._restrictMinMax(t,this._determineDate(t,e,new Date));t.selectedDay=t.currentDay=s.getDate(),t.drawMonth=t.selectedMonth=t.currentMonth=s.getMonth(),t.drawYear=t.selectedYear=t.currentYear=s.getFullYear(),(n!=t.selectedMonth||r!=t.selectedYear)&&!i&&this._notifyChange(t),this._adjustInstDate(t),t.input&&t.input.val(a?"":this._formatDate(t))},_getDate:function(t){return!t.currentYear||t.input&&""==t.input.val()?null:this._daylightSavingAdjust(new Date(t.currentYear,t.currentMonth,t.currentDay))},_generateHTML:function(t){var e=new Date;e=this._daylightSavingAdjust(new Date(e.getFullYear(),e.getMonth(),e.getDate()));var i=this._get(t,"isRTL"),a=this._get(t,"showButtonPanel"),n=this._get(t,"hideIfNoPrevNext"),r=this._get(t,"navigationAsDateFormat"),s=this._getNumberOfMonths(t),o=this._get(t,"showCurrentAtPos"),d=this._get(t,"stepMonths"),c=1!=s[0]||1!=s[1],u=this._daylightSavingAdjust(t.currentDay?new Date(t.currentYear,t.currentMonth,t.currentDay):new Date(9999,9,9)),l=this._getMinMaxDate(t,"min"),h=this._getMinMaxDate(t,"max"),p=t.drawMonth-o,g=t.drawYear;if(0>p&&(p+=12,g--),h){var f=this._daylightSavingAdjust(new Date(h.getFullYear(),h.getMonth()-s[0]*s[1]+1,h.getDate()));for(f=l&&l>f?l:f;this._daylightSavingAdjust(new Date(g,p,1))>f;)0>--p&&(p=11,g--)}t.drawMonth=p,t.drawYear=g;var _=this._get(t,"prevText");_=r?this.formatDate(_,this._daylightSavingAdjust(new Date(g,p-d,1)),this._getFormatConfig(t)):_;var m=this._canAdjustMonth(t,-1,g,p)?'<a class="ui-datepicker-prev ui-corner-all" onclick="DP_jQuery_'+dpuuid+".datepicker._adjustDate('#"+t.id+"', -"+d+", 'M');\" title=\""+_+'"><span class="ui-icon ui-icon-circle-triangle-'+(i?"e":"w")+'">'+_+"</span></a>":n?"":'<a class="ui-datepicker-prev ui-corner-all ui-state-disabled" title="'+_+'"><span class="ui-icon ui-icon-circle-triangle-'+(i?"e":"w")+'">'+_+"</span></a>",D=this._get(t,"nextText");D=r?this.formatDate(D,this._daylightSavingAdjust(new Date(g,p+d,1)),this._getFormatConfig(t)):D;var k=this._canAdjustMonth(t,1,g,p)?'<a class="ui-datepicker-next ui-corner-all" onclick="DP_jQuery_'+dpuuid+".datepicker._adjustDate('#"+t.id+"', +"+d+", 'M');\" title=\""+D+'"><span class="ui-icon ui-icon-circle-triangle-'+(i?"w":"e")+'">'+D+"</span></a>":n?"":'<a class="ui-datepicker-next ui-corner-all ui-state-disabled" title="'+D+'"><span class="ui-icon ui-icon-circle-triangle-'+(i?"w":"e")+'">'+D+"</span></a>",v=this._get(t,"currentText"),y=this._get(t,"gotoCurrent")&&t.currentDay?u:e;v=r?this.formatDate(v,y,this._getFormatConfig(t)):v;var w=t.inline?"":'<button type="button" class="ui-datepicker-close ui-state-default ui-priority-primary ui-corner-all" onclick="DP_jQuery_'+dpuuid+'.datepicker._hideDatepicker();">'+this._get(t,"closeText")+"</button>",b=a?'<div class="ui-datepicker-buttonpane ui-widget-content">'+(i?w:"")+(this._isInRange(t,y)?'<button type="button" class="ui-datepicker-current ui-state-default ui-priority-secondary ui-corner-all" onclick="DP_jQuery_'+dpuuid+".datepicker._gotoToday('#"+t.id+"');\">"+v+"</button>":"")+(i?"":w)+"</div>":"",M=parseInt(this._get(t,"firstDay"),10);M=isNaN(M)?0:M;for(var C=this._get(t,"showWeek"),I=this._get(t,"dayNames"),x=(this._get(t,"dayNamesShort"),this._get(t,"dayNamesMin")),N=this._get(t,"monthNames"),S=this._get(t,"monthNamesShort"),A=this._get(t,"beforeShowDay"),T=this._get(t,"showOtherMonths"),Y=this._get(t,"selectOtherMonths"),F=(this._get(t,"calculateWeek")||this.iso8601Week,this._getDefaultDate(t)),P="",O=0;O<s[0];O++){var E="";this.maxRows=4;for(var j=0;j<s[1];j++){var R=this._daylightSavingAdjust(new Date(g,p,t.selectedDay)),K=" ui-corner-all",W="";if(c){if(W+='<div class="ui-datepicker-group',s[1]>1)switch(j){case 0:W+=" ui-datepicker-group-first",K=" ui-corner-"+(i?"right":"left");break;case s[1]-1:W+=" ui-datepicker-group-last",K=" ui-corner-"+(i?"left":"right");break;default:W+=" ui-datepicker-group-middle",K=""}W+='">'}W+='<div class="ui-datepicker-header ui-widget-header ui-helper-clearfix'+K+'">'+(/all|left/.test(K)&&0==O?i?k:m:"")+(/all|right/.test(K)&&0==O?i?m:k:"")+this._generateMonthYearHeader(t,p,g,l,h,O>0||j>0,N,S)+'</div><table class="ui-datepicker-calendar"><thead><tr>';for(var H=C?'<th class="ui-datepicker-week-col">'+this._get(t,"weekHeader")+"</th>":"",L=0;7>L;L++){var U=(L+M)%7;H+="<th"+((L+M+6)%7>=5?' class="ui-datepicker-week-end"':"")+'><span title="'+I[U]+'">'+x[U]+"</span></th>"}W+=H+"</tr></thead><tbody>";var B=this._getDaysInMonth(g,p);g==t.selectedYear&&p==t.selectedMonth&&(t.selectedDay=Math.min(t.selectedDay,B));var z=(this._getFirstDayOfMonth(g,p)-M+7)%7,G=Math.ceil((z+B)/7),Q=c&&this.maxRows>G?this.maxRows:G;this.maxRows=Q;for(var V=this._daylightSavingAdjust(new Date(g,p,1-z)),J=0;Q>J;J++){W+="<tr>";for(var q=C?'<td class="ui-datepicker-week-col">'+this._get(t,"calculateWeek")(V)+"</td>":"",L=0;7>L;L++){var X=A?A.apply(t.input?t.input[0]:null,[V]):[!0,""],Z=V.getMonth()!=p,tt=Z&&!Y||!X[0]||l&&l>V||h&&V>h;q+='<td class="'+((L+M+6)%7>=5?" ui-datepicker-week-end":"")+(Z?" ui-datepicker-other-month":"")+(V.getTime()==R.getTime()&&p==t.selectedMonth&&t._keyEvent||F.getTime()==V.getTime()&&F.getTime()==R.getTime()?" "+this._dayOverClass:"")+(tt?" "+this._unselectableClass+" ui-state-disabled":"")+(Z&&!T?"":" "+X[1]+(V.getTime()==u.getTime()?" "+this._currentClass:"")+(V.getTime()==e.getTime()?" ui-datepicker-today":""))+'"'+(Z&&!T||!X[2]?"":' title="'+X[2]+'"')+(tt?"":' onclick="DP_jQuery_'+dpuuid+".datepicker._selectDay('#"+t.id+"',"+V.getMonth()+","+V.getFullYear()+', this);return false;"')+">"+(Z&&!T?"&#xa0;":tt?'<span class="ui-state-default">'+V.getDate()+"</span>":'<a class="ui-state-default'+(V.getTime()==e.getTime()?" ui-state-highlight":"")+(V.getTime()==u.getTime()?" ui-state-active":"")+(Z?" ui-priority-secondary":"")+'" href="#">'+V.getDate()+"</a>")+"</td>",V.setDate(V.getDate()+1),V=this._daylightSavingAdjust(V)}W+=q+"</tr>"}p++,p>11&&(p=0,g++),W+="</tbody></table>"+(c?"</div>"+(s[0]>0&&j==s[1]-1?'<div class="ui-datepicker-row-break"></div>':""):""),E+=W}P+=E}return P+=b+($.browser.msie&&parseInt($.browser.version,10)<7&&!t.inline?'<iframe src="javascript:false;" class="ui-datepicker-cover" frameborder="0"></iframe>':""),t._keyEvent=!1,P},_generateMonthYearHeader:function(t,e,i,a,n,r,s,o){var d=this._get(t,"changeMonth"),c=this._get(t,"changeYear"),u=this._get(t,"showMonthAfterYear"),l='<div class="ui-datepicker-title">',h="";if(r||!d)h+='<span class="ui-datepicker-month">'+s[e]+"</span>";else{var p=a&&a.getFullYear()==i,g=n&&n.getFullYear()==i;h+='<select class="ui-datepicker-month" onchange="DP_jQuery_'+dpuuid+".datepicker._selectMonthYear('#"+t.id+"', this, 'M');\" >";for(var f=0;12>f;f++)(!p||f>=a.getMonth())&&(!g||f<=n.getMonth())&&(h+='<option value="'+f+'"'+(f==e?' selected="selected"':"")+">"+o[f]+"</option>");h+="</select>"}if(u||(l+=h+(!r&&d&&c?"":"&#xa0;")),!t.yearshtml)if(t.yearshtml="",r||!c)l+='<span class="ui-datepicker-year">'+i+"</span>";else{var _=this._get(t,"yearRange").split(":"),m=(new Date).getFullYear(),D=function(t){var e=t.match(/c[+-].*/)?i+parseInt(t.substring(1),10):t.match(/[+-].*/)?m+parseInt(t,10):parseInt(t,10);return isNaN(e)?m:e},k=D(_[0]),v=Math.max(k,D(_[1]||""));for(k=parseInt(t.settings.minDate.split(".")[2]),v=n?Math.min(v,n.getFullYear()):v,t.yearshtml+='<select class="ui-datepicker-year" onchange="DP_jQuery_'+dpuuid+".datepicker._selectMonthYear('#"+t.id+"', this, 'Y');\" >";n.getFullYear()>=k;k++)t.yearshtml+='<option value="'+k+'"'+(k==i?' selected="selected"':"")+">"+k+"</option>";t.yearshtml+="</select>",l+=t.yearshtml,t.yearshtml=null}return l+=this._get(t,"yearSuffix"),u&&(l+=(!r&&d&&c?"":"&#xa0;")+h),l+="</div>"},_adjustInstDate:function(t,e,i){var a=t.drawYear+("Y"==i?e:0),n=t.drawMonth+("M"==i?e:0),r=Math.min(t.selectedDay,this._getDaysInMonth(a,n))+("D"==i?e:0),s=this._restrictMinMax(t,this._daylightSavingAdjust(new Date(a,n,r)));t.selectedDay=s.getDate(),t.drawMonth=t.selectedMonth=s.getMonth(),t.drawYear=t.selectedYear=s.getFullYear(),("M"==i||"Y"==i)&&this._notifyChange(t)},_restrictMinMax:function(t,e){var i=this._getMinMaxDate(t,"min"),a=this._getMinMaxDate(t,"max"),n=i&&i>e?i:e;return n=a&&n>a?a:n},_notifyChange:function(t){var e=this._get(t,"onChangeMonthYear");e&&e.apply(t.input?t.input[0]:null,[t.selectedYear,t.selectedMonth+1,t])},_getNumberOfMonths:function(t){var e=this._get(t,"numberOfMonths");return null==e?[1,1]:"number"==typeof e?[1,e]:e},_getMinMaxDate:function(t,e){return this._determineDate(t,this._get(t,e+"Date"),null)},_getDaysInMonth:function(t,e){return 32-this._daylightSavingAdjust(new Date(t,e,32)).getDate()},_getFirstDayOfMonth:function(t,e){return new Date(t,e,1).getDay()},_canAdjustMonth:function(t,e,i,a){var n=this._getNumberOfMonths(t),r=this._daylightSavingAdjust(new Date(i,a+(0>e?e:n[0]*n[1]),1));return 0>e&&r.setDate(this._getDaysInMonth(r.getFullYear(),r.getMonth())),this._isInRange(t,r)},_isInRange:function(t,e){var i=this._getMinMaxDate(t,"min"),a=this._getMinMaxDate(t,"max");return(!i||e.getTime()>=i.getTime())&&(!a||e.getTime()<=a.getTime())},_getFormatConfig:function(t){var e=this._get(t,"shortYearCutoff");return e="string"!=typeof e?e:(new Date).getFullYear()%100+parseInt(e,10),{shortYearCutoff:e,dayNamesShort:this._get(t,"dayNamesShort"),dayNames:this._get(t,"dayNames"),monthNamesShort:this._get(t,"monthNamesShort"),monthNames:this._get(t,"monthNames")}},_formatDate:function(t,e,i,a){e||(t.currentDay=t.selectedDay,t.currentMonth=t.selectedMonth,t.currentYear=t.selectedYear);var n=e?"object"==typeof e?e:this._daylightSavingAdjust(new Date(a,i,e)):this._daylightSavingAdjust(new Date(t.currentYear,t.currentMonth,t.currentDay));return this.formatDate(this._get(t,"dateFormat"),n,this._getFormatConfig(t))}}),$.fn.datepicker=function(t){if(!this.length)return this;$.datepicker.initialized||($(document).mousedown($.datepicker._checkExternalClick).find(".PGU-widgets-container").append($.datepicker.dpDiv),$.datepicker.initialized=!0);var e=Array.prototype.slice.call(arguments,1);return"string"!=typeof t||"isDisabled"!=t&&"getDate"!=t&&"widget"!=t?"option"==t&&2==arguments.length&&"string"==typeof arguments[1]?$.datepicker["_"+t+"Datepicker"].apply($.datepicker,[this[0]].concat(e)):this.each(function(){"string"==typeof t?$.datepicker["_"+t+"Datepicker"].apply($.datepicker,[this].concat(e)):$.datepicker._attachDatepicker(this,t)}):$.datepicker["_"+t+"Datepicker"].apply($.datepicker,[this[0]].concat(e))},$.datepicker=new Datepicker,$.datepicker.initialized=!1,$.datepicker.uuid=(new Date).getTime(),$.datepicker.version="1.8.18",window["DP_jQuery_"+dpuuid]=$}(jQuery),function(){var root="object"==typeof self&&self.self===self&&self||"object"==typeof global&&global.global===global&&global||this,previousUnderscore=root._,ArrayProto=Array.prototype,ObjProto=Object.prototype,SymbolProto="undefined"!=typeof Symbol?Symbol.prototype:null,push=ArrayProto.push,slice=ArrayProto.slice,toString=ObjProto.toString,hasOwnProperty=ObjProto.hasOwnProperty,nativeIsArray=Array.isArray,nativeKeys=Object.keys,nativeCreate=Object.create,Ctor=function(){},_=function(obj){return obj instanceof _?obj:this instanceof _?void(this._wrapped=obj):new _(obj)};"undefined"==typeof exports||exports.nodeType?root._=_:("undefined"!=typeof module&&!module.nodeType&&module.exports&&(exports=module.exports=_),exports._=_),_.VERSION="1.8.3";var builtinIteratee,optimizeCb=function(func,context,argCount){if(void 0===context)return func;switch(null==argCount?3:argCount){case 1:return function(value){return func.call(context,value)};case 3:return function(value,index,collection){return func.call(context,value,index,collection)};case 4:return function(accumulator,value,index,collection){return func.call(context,accumulator,value,index,collection)}}return function(){return func.apply(context,arguments)}},cb=function(value,context,argCount){return _.iteratee!==builtinIteratee?_.iteratee(value,context):null==value?_.identity:_.isFunction(value)?optimizeCb(value,context,argCount):_.isObject(value)?_.matcher(value):_.property(value)};_.iteratee=builtinIteratee=function(value,context){return cb(value,context,1/0)};var restArgs=function(func,startIndex){return startIndex=null==startIndex?func.length-1:+startIndex,function(){for(var length=Math.max(arguments.length-startIndex,0),rest=Array(length),index=0;index<length;index++)rest[index]=arguments[index+startIndex];switch(startIndex){case 0:return func.call(this,rest);case 1:return func.call(this,arguments[0],rest);case 2:return func.call(this,arguments[0],arguments[1],rest)}var args=Array(startIndex+1);for(index=0;index<startIndex;index++)args[index]=arguments[index];return args[startIndex]=rest,func.apply(this,args)}},baseCreate=function(prototype){if(!_.isObject(prototype))return{};if(nativeCreate)return nativeCreate(prototype);Ctor.prototype=prototype;var result=new Ctor;return Ctor.prototype=null,result},property=function(key){return function(obj){return null==obj?void 0:obj[key]}},MAX_ARRAY_INDEX=Math.pow(2,53)-1,getLength=property("length"),isArrayLike=function(collection){var length=getLength(collection);return"number"==typeof length&&length>=0&&length<=MAX_ARRAY_INDEX};_.each=_.forEach=function(obj,iteratee,context){iteratee=optimizeCb(iteratee,context);var i,length;if(isArrayLike(obj))for(i=0,length=obj.length;i<length;i++)iteratee(obj[i],i,obj);else{var keys=_.keys(obj);for(i=0,length=keys.length;i<length;i++)iteratee(obj[keys[i]],keys[i],obj)}return obj},_.map=_.collect=function(obj,iteratee,context){iteratee=cb(iteratee,context);for(var keys=!isArrayLike(obj)&&_.keys(obj),length=(keys||obj).length,results=Array(length),index=0;index<length;index++){var currentKey=keys?keys[index]:index;results[index]=iteratee(obj[currentKey],currentKey,obj)}return results};var createReduce=function(dir){var reducer=function(obj,iteratee,memo,initial){var keys=!isArrayLike(obj)&&_.keys(obj),length=(keys||obj).length,index=dir>0?0:length-1;for(initial||(memo=obj[keys?keys[index]:index],index+=dir);index>=0&&index<length;index+=dir){var currentKey=keys?keys[index]:index;memo=iteratee(memo,obj[currentKey],currentKey,obj)}return memo};return function(obj,iteratee,memo,context){var initial=arguments.length>=3;return reducer(obj,optimizeCb(iteratee,context,4),memo,initial)}};_.reduce=_.foldl=_.inject=createReduce(1),_.reduceRight=_.foldr=createReduce(-1),_.find=_.detect=function(obj,predicate,context){var keyFinder=isArrayLike(obj)?_.findIndex:_.findKey,key=keyFinder(obj,predicate,context);if(void 0!==key&&-1!==key)return obj[key]},_.filter=_.select=function(obj,predicate,context){var results=[];return predicate=cb(predicate,context),_.each(obj,function(value,index,list){predicate(value,index,list)&&results.push(value)}),results},_.reject=function(obj,predicate,context){return _.filter(obj,_.negate(cb(predicate)),context)},_.every=_.all=function(obj,predicate,context){predicate=cb(predicate,context);for(var keys=!isArrayLike(obj)&&_.keys(obj),length=(keys||obj).length,index=0;index<length;index++){var currentKey=keys?keys[index]:index;if(!predicate(obj[currentKey],currentKey,obj))return!1}return!0},_.some=_.any=function(obj,predicate,context){predicate=cb(predicate,context);for(var keys=!isArrayLike(obj)&&_.keys(obj),length=(keys||obj).length,index=0;index<length;index++){var currentKey=keys?keys[index]:index;if(predicate(obj[currentKey],currentKey,obj))return!0}return!1},_.contains=_.includes=_.include=function(obj,item,fromIndex,guard){return isArrayLike(obj)||(obj=_.values(obj)),("number"!=typeof fromIndex||guard)&&(fromIndex=0),_.indexOf(obj,item,fromIndex)>=0},_.invoke=restArgs(function(obj,method,args){var isFunc=_.isFunction(method);return _.map(obj,function(value){var func=isFunc?method:value[method];return null==func?func:func.apply(value,args)})}),_.pluck=function(obj,key){return _.map(obj,_.property(key))},_.where=function(obj,attrs){return _.filter(obj,_.matcher(attrs))},_.findWhere=function(obj,attrs){return _.find(obj,_.matcher(attrs))},_.max=function(obj,iteratee,context){var value,computed,result=-1/0,lastComputed=-1/0;if(null==iteratee||"number"==typeof iteratee&&"object"!=typeof obj[0]&&null!=obj){obj=isArrayLike(obj)?obj:_.values(obj);for(var i=0,length=obj.length;i<length;i++)null!=(value=obj[i])&&value>result&&(result=value)}else iteratee=cb(iteratee,context),_.each(obj,function(v,index,list){((computed=iteratee(v,index,list))>lastComputed||computed===-1/0&&result===-1/0)&&(result=v,lastComputed=computed)});return result},_.min=function(obj,iteratee,context){var value,computed,result=1/0,lastComputed=1/0;if(null==iteratee||"number"==typeof iteratee&&"object"!=typeof obj[0]&&null!=obj){obj=isArrayLike(obj)?obj:_.values(obj);for(var i=0,length=obj.length;i<length;i++)null!=(value=obj[i])&&value<result&&(result=value)}else iteratee=cb(iteratee,context),_.each(obj,function(v,index,list){((computed=iteratee(v,index,list))<lastComputed||computed===1/0&&result===1/0)&&(result=v,lastComputed=computed)});return result},_.shuffle=function(obj){return _.sample(obj,1/0)},_.sample=function(obj,n,guard){if(null==n||guard)return isArrayLike(obj)||(obj=_.values(obj)),obj[_.random(obj.length-1)];var sample=isArrayLike(obj)?_.clone(obj):_.values(obj),length=getLength(sample);n=Math.max(Math.min(n,length),0);for(var last=length-1,index=0;index<n;index++){var rand=_.random(index,last),temp=sample[index];sample[index]=sample[rand],sample[rand]=temp}return sample.slice(0,n)},_.sortBy=function(obj,iteratee,context){var index=0;return iteratee=cb(iteratee,context),_.pluck(_.map(obj,function(value,key,list){return{value:value,index:index++,criteria:iteratee(value,key,list)}}).sort(function(left,right){var a=left.criteria,b=right.criteria;if(a!==b){if(a>b||void 0===a)return 1;if(a<b||void 0===b)return-1}return left.index-right.index}),"value")};var group=function(behavior,partition){return function(obj,iteratee,context){var result=partition?[[],[]]:{};return iteratee=cb(iteratee,context),_.each(obj,function(value,index){var key=iteratee(value,index,obj);behavior(result,value,key)}),result}};_.groupBy=group(function(result,value,key){_.has(result,key)?result[key].push(value):result[key]=[value]}),_.indexBy=group(function(result,value,key){result[key]=value}),_.countBy=group(function(result,value,key){_.has(result,key)?result[key]++:result[key]=1});var reStrSymbol=/[^\ud800-\udfff]|[\ud800-\udbff][\udc00-\udfff]|[\ud800-\udfff]/g;_.toArray=function(obj){return obj?_.isArray(obj)?slice.call(obj):_.isString(obj)?obj.match(reStrSymbol):isArrayLike(obj)?_.map(obj,_.identity):_.values(obj):[]},_.size=function(obj){return null==obj?0:isArrayLike(obj)?obj.length:_.keys(obj).length},_.partition=group(function(result,value,pass){result[pass?0:1].push(value)},!0),_.first=_.head=_.take=function(array,n,guard){if(null!=array)return null==n||guard?array[0]:_.initial(array,array.length-n)},_.initial=function(array,n,guard){return slice.call(array,0,Math.max(0,array.length-(null==n||guard?1:n)))},_.last=function(array,n,guard){if(null!=array)return null==n||guard?array[array.length-1]:_.rest(array,Math.max(0,array.length-n))},_.rest=_.tail=_.drop=function(array,n,guard){return slice.call(array,null==n||guard?1:n)},_.compact=function(array){return _.filter(array,Boolean)};var flatten=function(input,shallow,strict,output){output=output||[];for(var idx=output.length,i=0,length=getLength(input);i<length;i++){var value=input[i];if(isArrayLike(value)&&(_.isArray(value)||_.isArguments(value)))if(shallow)for(var j=0,len=value.length;j<len;)output[idx++]=value[j++];else flatten(value,shallow,strict,output),idx=output.length;else strict||(output[idx++]=value)}return output};_.flatten=function(array,shallow){return flatten(array,shallow,!1)},_.without=restArgs(function(array,otherArrays){return _.difference(array,otherArrays)}),_.uniq=_.unique=function(array,isSorted,iteratee,context){_.isBoolean(isSorted)||(context=iteratee,iteratee=isSorted,isSorted=!1),null!=iteratee&&(iteratee=cb(iteratee,context));for(var result=[],seen=[],i=0,length=getLength(array);i<length;i++){var value=array[i],computed=iteratee?iteratee(value,i,array):value;isSorted?(i&&seen===computed||result.push(value),seen=computed):iteratee?_.contains(seen,computed)||(seen.push(computed),result.push(value)):_.contains(result,value)||result.push(value)}return result},_.union=restArgs(function(arrays){return _.uniq(flatten(arrays,!0,!0))}),_.intersection=function(array){for(var result=[],argsLength=arguments.length,i=0,length=getLength(array);i<length;i++){var item=array[i];if(!_.contains(result,item)){var j;for(j=1;j<argsLength&&_.contains(arguments[j],item);j++);j===argsLength&&result.push(item)}}return result},_.difference=restArgs(function(array,rest){return rest=flatten(rest,!0,!0),_.filter(array,function(value){return!_.contains(rest,value)})}),_.unzip=function(array){for(var length=array&&_.max(array,getLength).length||0,result=Array(length),index=0;index<length;index++)result[index]=_.pluck(array,index);return result},_.zip=restArgs(_.unzip),_.object=function(list,values){for(var result={},i=0,length=getLength(list);i<length;i++)values?result[list[i]]=values[i]:result[list[i][0]]=list[i][1];return result};var createPredicateIndexFinder=function(dir){return function(array,predicate,context){predicate=cb(predicate,context);for(var length=getLength(array),index=dir>0?0:length-1;index>=0&&index<length;index+=dir)if(predicate(array[index],index,array))return index;return-1}};_.findIndex=createPredicateIndexFinder(1),_.findLastIndex=createPredicateIndexFinder(-1),_.sortedIndex=function(array,obj,iteratee,context){iteratee=cb(iteratee,context,1);for(var value=iteratee(obj),low=0,high=getLength(array);low<high;){var mid=Math.floor((low+high)/2);iteratee(array[mid])<value?low=mid+1:high=mid}return low};var createIndexFinder=function(dir,predicateFind,sortedIndex){return function(array,item,idx){var i=0,length=getLength(array);if("number"==typeof idx)dir>0?i=idx>=0?idx:Math.max(idx+length,i):length=idx>=0?Math.min(idx+1,length):idx+length+1;else if(sortedIndex&&idx&&length)return idx=sortedIndex(array,item),array[idx]===item?idx:-1;if(item!==item)return idx=predicateFind(slice.call(array,i,length),_.isNaN),idx>=0?idx+i:-1;for(idx=dir>0?i:length-1;idx>=0&&idx<length;idx+=dir)if(array[idx]===item)return idx;return-1}};_.indexOf=createIndexFinder(1,_.findIndex,_.sortedIndex),_.lastIndexOf=createIndexFinder(-1,_.findLastIndex),_.range=function(start,stop,step){null==stop&&(stop=start||0,start=0),step||(step=stop<start?-1:1);for(var length=Math.max(Math.ceil((stop-start)/step),0),range=Array(length),idx=0;idx<length;idx++,start+=step)range[idx]=start;return range},_.chunk=function(array,count){if(null==count||count<1)return[];for(var result=[],i=0,length=array.length;i<length;)result.push(slice.call(array,i,i+=count));return result};var executeBound=function(sourceFunc,boundFunc,context,callingContext,args){if(!(callingContext instanceof boundFunc))return sourceFunc.apply(context,args);var self=baseCreate(sourceFunc.prototype),result=sourceFunc.apply(self,args);return _.isObject(result)?result:self};_.bind=restArgs(function(func,context,args){if(!_.isFunction(func))throw new TypeError("Bind must be called on a function");var bound=restArgs(function(callArgs){return executeBound(func,bound,context,this,args.concat(callArgs))});return bound}),_.partial=restArgs(function(func,boundArgs){var placeholder=_.partial.placeholder,bound=function(){for(var position=0,length=boundArgs.length,args=Array(length),i=0;i<length;i++)args[i]=boundArgs[i]===placeholder?arguments[position++]:boundArgs[i];for(;position<arguments.length;)args.push(arguments[position++]);return executeBound(func,bound,this,this,args)};return bound}),_.partial.placeholder=_,_.bindAll=restArgs(function(obj,keys){keys=flatten(keys,!1,!1)
;var index=keys.length;if(index<1)throw new Error("bindAll must be passed function names");for(;index--;){var key=keys[index];obj[key]=_.bind(obj[key],obj)}}),_.memoize=function(func,hasher){var memoize=function(key){var cache=memoize.cache,address=""+(hasher?hasher.apply(this,arguments):key);return _.has(cache,address)||(cache[address]=func.apply(this,arguments)),cache[address]};return memoize.cache={},memoize},_.delay=restArgs(function(func,wait,args){return setTimeout(function(){return func.apply(null,args)},wait)}),_.defer=_.partial(_.delay,_,1),_.throttle=function(func,wait,options){var timeout,context,args,result,previous=0;options||(options={});var later=function(){previous=!1===options.leading?0:_.now(),timeout=null,result=func.apply(context,args),timeout||(context=args=null)},throttled=function(){var now=_.now();previous||!1!==options.leading||(previous=now);var remaining=wait-(now-previous);return context=this,args=arguments,remaining<=0||remaining>wait?(timeout&&(clearTimeout(timeout),timeout=null),previous=now,result=func.apply(context,args),timeout||(context=args=null)):timeout||!1===options.trailing||(timeout=setTimeout(later,remaining)),result};return throttled.cancel=function(){clearTimeout(timeout),previous=0,timeout=context=args=null},throttled},_.debounce=function(func,wait,immediate){var timeout,result,later=function(context,args){timeout=null,args&&(result=func.apply(context,args))},debounced=restArgs(function(args){if(timeout&&clearTimeout(timeout),immediate){var callNow=!timeout;timeout=setTimeout(later,wait),callNow&&(result=func.apply(this,args))}else timeout=_.delay(later,wait,this,args);return result});return debounced.cancel=function(){clearTimeout(timeout),timeout=null},debounced},_.wrap=function(func,wrapper){return _.partial(wrapper,func)},_.negate=function(predicate){return function(){return!predicate.apply(this,arguments)}},_.compose=function(){var args=arguments,start=args.length-1;return function(){for(var i=start,result=args[start].apply(this,arguments);i--;)result=args[i].call(this,result);return result}},_.after=function(times,func){return function(){if(--times<1)return func.apply(this,arguments)}},_.before=function(times,func){var memo;return function(){return--times>0&&(memo=func.apply(this,arguments)),times<=1&&(func=null),memo}},_.once=_.partial(_.before,2),_.restArgs=restArgs;var hasEnumBug=!{toString:null}.propertyIsEnumerable("toString"),nonEnumerableProps=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"],collectNonEnumProps=function(obj,keys){var nonEnumIdx=nonEnumerableProps.length,constructor=obj.constructor,proto=_.isFunction(constructor)&&constructor.prototype||ObjProto,prop="constructor";for(_.has(obj,prop)&&!_.contains(keys,prop)&&keys.push(prop);nonEnumIdx--;)(prop=nonEnumerableProps[nonEnumIdx])in obj&&obj[prop]!==proto[prop]&&!_.contains(keys,prop)&&keys.push(prop)};_.keys=function(obj){if(!_.isObject(obj))return[];if(nativeKeys)return nativeKeys(obj);var keys=[];for(var key in obj)_.has(obj,key)&&keys.push(key);return hasEnumBug&&collectNonEnumProps(obj,keys),keys},_.allKeys=function(obj){if(!_.isObject(obj))return[];var keys=[];for(var key in obj)keys.push(key);return hasEnumBug&&collectNonEnumProps(obj,keys),keys},_.values=function(obj){for(var keys=_.keys(obj),length=keys.length,values=Array(length),i=0;i<length;i++)values[i]=obj[keys[i]];return values},_.mapObject=function(obj,iteratee,context){iteratee=cb(iteratee,context);for(var keys=_.keys(obj),length=keys.length,results={},index=0;index<length;index++){var currentKey=keys[index];results[currentKey]=iteratee(obj[currentKey],currentKey,obj)}return results},_.pairs=function(obj){for(var keys=_.keys(obj),length=keys.length,pairs=Array(length),i=0;i<length;i++)pairs[i]=[keys[i],obj[keys[i]]];return pairs},_.invert=function(obj){for(var result={},keys=_.keys(obj),i=0,length=keys.length;i<length;i++)result[obj[keys[i]]]=keys[i];return result},_.functions=_.methods=function(obj){var names=[];for(var key in obj)_.isFunction(obj[key])&&names.push(key);return names.sort()};var createAssigner=function(keysFunc,defaults){return function(obj){var length=arguments.length;if(defaults&&(obj=Object(obj)),length<2||null==obj)return obj;for(var index=1;index<length;index++)for(var source=arguments[index],keys=keysFunc(source),l=keys.length,i=0;i<l;i++){var key=keys[i];defaults&&void 0!==obj[key]||(obj[key]=source[key])}return obj}};_.extend=createAssigner(_.allKeys),_.extendOwn=_.assign=createAssigner(_.keys),_.findKey=function(obj,predicate,context){predicate=cb(predicate,context);for(var key,keys=_.keys(obj),i=0,length=keys.length;i<length;i++)if(key=keys[i],predicate(obj[key],key,obj))return key};var keyInObj=function(value,key,obj){return key in obj};_.pick=restArgs(function(obj,keys){var result={},iteratee=keys[0];if(null==obj)return result;_.isFunction(iteratee)?(keys.length>1&&(iteratee=optimizeCb(iteratee,keys[1])),keys=_.allKeys(obj)):(iteratee=keyInObj,keys=flatten(keys,!1,!1),obj=Object(obj));for(var i=0,length=keys.length;i<length;i++){var key=keys[i],value=obj[key];iteratee(value,key,obj)&&(result[key]=value)}return result}),_.omit=restArgs(function(obj,keys){var context,iteratee=keys[0];return _.isFunction(iteratee)?(iteratee=_.negate(iteratee),keys.length>1&&(context=keys[1])):(keys=_.map(flatten(keys,!1,!1),String),iteratee=function(value,key){return!_.contains(keys,key)}),_.pick(obj,iteratee,context)}),_.defaults=createAssigner(_.allKeys,!0),_.create=function(prototype,props){var result=baseCreate(prototype);return props&&_.extendOwn(result,props),result},_.clone=function(obj){return _.isObject(obj)?_.isArray(obj)?obj.slice():_.extend({},obj):obj},_.tap=function(obj,interceptor){return interceptor(obj),obj},_.isMatch=function(object,attrs){var keys=_.keys(attrs),length=keys.length;if(null==object)return!length;for(var obj=Object(object),i=0;i<length;i++){var key=keys[i];if(attrs[key]!==obj[key]||!(key in obj))return!1}return!0};var eq,deepEq;eq=function(a,b,aStack,bStack){if(a===b)return 0!==a||1/a==1/b;if(null==a||null==b)return a===b;if(a!==a)return b!==b;var type=typeof a;return("function"===type||"object"===type||"object"==typeof b)&&deepEq(a,b,aStack,bStack)},deepEq=function(a,b,aStack,bStack){a instanceof _&&(a=a._wrapped),b instanceof _&&(b=b._wrapped);var className=toString.call(a);if(className!==toString.call(b))return!1;switch(className){case"[object RegExp]":case"[object String]":return""+a==""+b;case"[object Number]":return+a!=+a?+b!=+b:0==+a?1/+a==1/b:+a==+b;case"[object Date]":case"[object Boolean]":return+a==+b;case"[object Symbol]":return SymbolProto.valueOf.call(a)===SymbolProto.valueOf.call(b)}var areArrays="[object Array]"===className;if(!areArrays){if("object"!=typeof a||"object"!=typeof b)return!1;var aCtor=a.constructor,bCtor=b.constructor;if(aCtor!==bCtor&&!(_.isFunction(aCtor)&&aCtor instanceof aCtor&&_.isFunction(bCtor)&&bCtor instanceof bCtor)&&"constructor"in a&&"constructor"in b)return!1}aStack=aStack||[],bStack=bStack||[];for(var length=aStack.length;length--;)if(aStack[length]===a)return bStack[length]===b;if(aStack.push(a),bStack.push(b),areArrays){if((length=a.length)!==b.length)return!1;for(;length--;)if(!eq(a[length],b[length],aStack,bStack))return!1}else{var key,keys=_.keys(a);if(length=keys.length,_.keys(b).length!==length)return!1;for(;length--;)if(key=keys[length],!_.has(b,key)||!eq(a[key],b[key],aStack,bStack))return!1}return aStack.pop(),bStack.pop(),!0},_.isEqual=function(a,b){return eq(a,b)},_.isEmpty=function(obj){return null==obj||(isArrayLike(obj)&&(_.isArray(obj)||_.isString(obj)||_.isArguments(obj))?0===obj.length:0===_.keys(obj).length)},_.isElement=function(obj){return!(!obj||1!==obj.nodeType)},_.isArray=nativeIsArray||function(obj){return"[object Array]"===toString.call(obj)},_.isObject=function(obj){var type=typeof obj;return"function"===type||"object"===type&&!!obj},_.each(["Arguments","Function","String","Number","Date","RegExp","Error","Symbol","Map","WeakMap","Set","WeakSet"],function(name){_["is"+name]=function(obj){return toString.call(obj)==="[object "+name+"]"}}),_.isArguments(arguments)||(_.isArguments=function(obj){return _.has(obj,"callee")});var nodelist=root.document&&root.document.childNodes;"function"!=typeof/./&&"object"!=typeof Int8Array&&"function"!=typeof nodelist&&(_.isFunction=function(obj){return"function"==typeof obj||!1}),_.isFinite=function(obj){return!_.isSymbol(obj)&&isFinite(obj)&&!isNaN(parseFloat(obj))},_.isNaN=function(obj){return isNaN(obj)&&_.isNumber(obj)},_.isBoolean=function(obj){return!0===obj||!1===obj||"[object Boolean]"===toString.call(obj)},_.isNull=function(obj){return null===obj},_.isUndefined=function(obj){return void 0===obj},_.has=function(obj,key){return null!=obj&&hasOwnProperty.call(obj,key)},_.noConflict=function(){return root._=previousUnderscore,this},_.identity=function(value){return value},_.constant=function(value){return function(){return value}},_.noop=function(){},_.property=property,_.propertyOf=function(obj){return null==obj?function(){}:function(key){return obj[key]}},_.matcher=_.matches=function(attrs){return attrs=_.extendOwn({},attrs),function(obj){return _.isMatch(obj,attrs)}},_.times=function(n,iteratee,context){var accum=Array(Math.max(0,n));iteratee=optimizeCb(iteratee,context,1);for(var i=0;i<n;i++)accum[i]=iteratee(i);return accum},_.random=function(min,max){return null==max&&(max=min,min=0),min+Math.floor(Math.random()*(max-min+1))},_.now=Date.now||function(){return(new Date).getTime()};var escapeMap={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},unescapeMap=_.invert(escapeMap),createEscaper=function(map){var escaper=function(match){return map[match]},source="(?:"+_.keys(map).join("|")+")",testRegexp=RegExp(source),replaceRegexp=RegExp(source,"g");return function(string){return string=null==string?"":""+string,testRegexp.test(string)?string.replace(replaceRegexp,escaper):string}};_.escape=createEscaper(escapeMap),_.unescape=createEscaper(unescapeMap),_.result=function(object,prop,fallback){var value=null==object?void 0:object[prop];return void 0===value&&(value=fallback),_.isFunction(value)?value.call(object):value};var idCounter=0;_.uniqueId=function(prefix){var id=++idCounter+"";return prefix?prefix+id:id},_.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var noMatch=/(.)^/,escapes={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},escapeRegExp=/\\|'|\r|\n|\u2028|\u2029/g,escapeChar=function(match){return"\\"+escapes[match]};_.template=function(text,settings,oldSettings){!settings&&oldSettings&&(settings=oldSettings),settings=_.defaults({},settings,_.templateSettings);var matcher=RegExp([(settings.escape||noMatch).source,(settings.interpolate||noMatch).source,(settings.evaluate||noMatch).source].join("|")+"|$","g"),index=0,source="__p+='";text.replace(matcher,function(match,escape,interpolate,evaluate,offset){return source+=text.slice(index,offset).replace(escapeRegExp,escapeChar),index=offset+match.length,escape?source+="'+\n((__t=("+escape+"))==null?'':_.escape(__t))+\n'":interpolate?source+="'+\n((__t=("+interpolate+"))==null?'':__t)+\n'":evaluate&&(source+="';\n"+evaluate+"\n__p+='"),match}),source+="';\n",settings.variable||(source="with(obj||{}){\n"+source+"}\n"),source="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+source+"return __p;\n";var render;try{render=new Function(settings.variable||"obj","_",source)}catch(e){throw e.source=source,e}var template=function(data){return render.call(this,data,_)};return template.source="function("+(settings.variable||"obj")+"){\n"+source+"}",template},_.chain=function(obj){var instance=_(obj);return instance._chain=!0,instance};var chainResult=function(instance,obj){return instance._chain?_(obj).chain():obj};_.mixin=function(obj){return _.each(_.functions(obj),function(name){var func=_[name]=obj[name];_.prototype[name]=function(){var args=[this._wrapped];return push.apply(args,arguments),chainResult(this,func.apply(_,args))}}),_},_.mixin(_),_.each(["pop","push","reverse","shift","sort","splice","unshift"],function(name){var method=ArrayProto[name];_.prototype[name]=function(){var obj=this._wrapped;return method.apply(obj,arguments),"shift"!==name&&"splice"!==name||0!==obj.length||delete obj[0],chainResult(this,obj)}}),_.each(["concat","join","slice"],function(name){var method=ArrayProto[name];_.prototype[name]=function(){return chainResult(this,method.apply(this._wrapped,arguments))}}),_.prototype.value=function(){return this._wrapped},_.prototype.valueOf=_.prototype.toJSON=_.prototype.value,_.prototype.toString=function(){return""+this._wrapped},"function"==typeof define&&define.amd&&define("underscore",[],function(){return _})}(),function(){function parse(s,buf,offset){var i=buf&&offset||0,ii=0;for(buf=buf||[],s.toLowerCase().replace(/[0-9a-f]{2}/g,function(oct){ii<16&&(buf[i+ii++]=_hexToByte[oct])});ii<16;)buf[i+ii++]=0;return buf}function unparse(buf,offset){var i=offset||0,bth=_byteToHex;return bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+"-"+bth[buf[i++]]+bth[buf[i++]]+"-"+bth[buf[i++]]+bth[buf[i++]]+"-"+bth[buf[i++]]+bth[buf[i++]]+"-"+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]}function v1(options,buf,offset){var i=buf&&offset||0,b=buf||[];options=options||{};var clockseq=null!=options.clockseq?options.clockseq:_clockseq,msecs=null!=options.msecs?options.msecs:(new Date).getTime(),nsecs=null!=options.nsecs?options.nsecs:_lastNSecs+1,dt=msecs-_lastMSecs+(nsecs-_lastNSecs)/1e4;if(dt<0&&null==options.clockseq&&(clockseq=clockseq+1&16383),(dt<0||msecs>_lastMSecs)&&null==options.nsecs&&(nsecs=0),nsecs>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");_lastMSecs=msecs,_lastNSecs=nsecs,_clockseq=clockseq,msecs+=122192928e5;var tl=(1e4*(268435455&msecs)+nsecs)%4294967296;b[i++]=tl>>>24&255,b[i++]=tl>>>16&255,b[i++]=tl>>>8&255,b[i++]=255&tl;var tmh=msecs/4294967296*1e4&268435455;b[i++]=tmh>>>8&255,b[i++]=255&tmh,b[i++]=tmh>>>24&15|16,b[i++]=tmh>>>16&255,b[i++]=clockseq>>>8|128,b[i++]=255&clockseq;for(var node=options.node||_nodeId,n=0;n<6;n++)b[i+n]=node[n];return buf||unparse(b)}function v4(options,buf,offset){var i=buf&&offset||0;"string"==typeof options&&(buf="binary"==options?new BufferClass(16):null,options=null),options=options||{};var rnds=options.random||(options.rng||_rng)();if(rnds[6]=15&rnds[6]|64,rnds[8]=63&rnds[8]|128,buf)for(var ii=0;ii<16;ii++)buf[i+ii]=rnds[ii];return buf||unparse(rnds)}var _rng,_global=this;if("function"==typeof require)try{var _rb=require("crypto").randomBytes;_rng=_rb&&function(){return _rb(16)}}catch(e){}if(!_rng&&_global.crypto&&crypto.getRandomValues){var _rnds8=new Uint8Array(16);_rng=function(){return crypto.getRandomValues(_rnds8),_rnds8}}if(!_rng){var _rnds=new Array(16);_rng=function(){for(var r,i=0;i<16;i++)0==(3&i)&&(r=4294967296*Math.random()),_rnds[i]=r>>>((3&i)<<3)&255;return _rnds}}for(var BufferClass="function"==typeof Buffer?Buffer:Array,_byteToHex=[],_hexToByte={},i=0;i<256;i++)_byteToHex[i]=(i+256).toString(16).substr(1),_hexToByte[_byteToHex[i]]=i;var _seedBytes=_rng(),_nodeId=[1|_seedBytes[0],_seedBytes[1],_seedBytes[2],_seedBytes[3],_seedBytes[4],_seedBytes[5]],_clockseq=16383&(_seedBytes[6]<<8|_seedBytes[7]),_lastMSecs=0,_lastNSecs=0,uuid=v4;uuid.v1=v1,uuid.v4=v4,uuid.parse=parse,uuid.unparse=unparse,uuid.BufferClass=BufferClass;var _previousRoot=_global.uuid;uuid.noConflict=function(){return _global.uuid=_previousRoot,uuid},_global.uuid=uuid}.call(this),function(n,h,p){"use strict";function E(a){var e=[];return r(e,h.noop).chars(a),e.join("")}function g(a){var e={};a=a.split(",");var d;for(d=0;d<a.length;d++)e[a[d]]=!0;return e}function F(a,e){function d(a,b,d,l){if(b=h.lowercase(b),s[b])for(;f.last()&&t[f.last()];)c("",f.last());u[b]&&f.last()==b&&c("",b),(l=v[b]||!!l)||f.push(b);var m={};d.replace(G,function(a,b,e,c,d){m[b]=q(e||c||d||"")}),e.start&&e.start(b,m,l)}function c(a,b){var d,c=0;if(b=h.lowercase(b))for(c=f.length-1;0<=c&&f[c]!=b;c--);if(0<=c){for(d=f.length-1;d>=c;d--)e.end&&e.end(f[d]);f.length=c}}"string"!=typeof a&&(a=null===a||void 0===a?"":""+a);var b,k,l,f=[],m=a;for(f.last=function(){return f[f.length-1]};a;){if(l="",k=!0,f.last()&&w[f.last()]?(a=a.replace(new RegExp("([\\W\\w]*)<\\s*\\/\\s*"+f.last()+"[^>]*>","i"),function(a,b){return b=b.replace(H,"$1").replace(I,"$1"),e.chars&&e.chars(q(b)),""}),c("",f.last())):(0===a.indexOf("\x3c!--")?0<=(b=a.indexOf("--",4))&&a.lastIndexOf("--\x3e",b)===b&&(e.comment&&e.comment(a.substring(4,b)),a=a.substring(b+3),k=!1):x.test(a)?(b=a.match(x))&&(a=a.replace(b[0],""),k=!1):J.test(a)?(b=a.match(y))&&(a=a.substring(b[0].length),b[0].replace(y,c),k=!1):K.test(a)&&((b=a.match(z))?(b[4]&&(a=a.substring(b[0].length),b[0].replace(z,d)),k=!1):(l+="<",a=a.substring(1))),k&&(b=a.indexOf("<"),l+=0>b?a:a.substring(0,b),a=0>b?"":a.substring(b),e.chars&&e.chars(q(l)))),a==m)throw L("badparse",a);m=a}c()}function q(a){return a?(A.innerHTML=a.replace(/</g,"&lt;"),A.textContent):""}function B(a){return a.replace(/&/g,"&amp;").replace(M,function(a){var d=a.charCodeAt(0);return a=a.charCodeAt(1),"&#"+(1024*(d-55296)+(a-56320)+65536)+";"}).replace(N,function(a){return"&#"+a.charCodeAt(0)+";"}).replace(/</g,"&lt;").replace(/>/g,"&gt;")}function r(a,e){var d=!1,c=h.bind(a,a.push);return{start:function(a,k,f){a=h.lowercase(a),!d&&w[a]&&(d=a),d||!0!==C[a]||(c("<"),c(a),h.forEach(k,function(d,f){var k=h.lowercase(f),g="img"===a&&"src"===k||"background"===k;!0!==O[k]||!0===D[k]&&!e(d,g)||(c(" "),c(f),c('="'),c(B(d)),c('"'))}),c(f?"/>":">"))},end:function(a){a=h.lowercase(a),d||!0!==C[a]||(c("</"),c(a),c(">")),a==d&&(d=!1)},chars:function(a){d||c(B(a))}}}var L=h.$$minErr("$sanitize"),z=/^<((?:[a-zA-Z])[\w:-]*)((?:\s+[\w:-]+(?:\s*=\s*(?:(?:"[^"]*")|(?:'[^']*')|[^>\s]+))?)*)\s*(\/?)\s*(>?)/,y=/^<\/\s*([\w:-]+)[^>]*>/,G=/([\w:-]+)(?:\s*=\s*(?:(?:"((?:[^"])*)")|(?:'((?:[^'])*)')|([^>\s]+)))?/g,K=/^</,J=/^<\//,H=/\x3c!--(.*?)--\x3e/g,x=/<!DOCTYPE([^>]*?)>/i,I=/<!\[CDATA\[(.*?)]]\x3e/g,M=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,N=/([^\#-~| |!])/g,v=g("area,br,col,hr,img,wbr");n=g("colgroup,dd,dt,li,p,tbody,td,tfoot,th,thead,tr"),p=g("rp,rt");var u=h.extend({},p,n),s=h.extend({},n,g("address,article,aside,blockquote,caption,center,del,dir,div,dl,figure,figcaption,footer,h1,h2,h3,h4,h5,h6,header,hgroup,hr,ins,map,menu,nav,ol,pre,script,section,table,ul")),t=h.extend({},p,g("a,abbr,acronym,b,bdi,bdo,big,br,cite,code,del,dfn,em,font,i,img,ins,kbd,label,map,mark,q,ruby,rp,rt,s,samp,small,span,strike,strong,sub,sup,time,tt,u,var"));n=g("animate,animateColor,animateMotion,animateTransform,circle,defs,desc,ellipse,font-face,font-face-name,font-face-src,g,glyph,hkern,image,linearGradient,line,marker,metadata,missing-glyph,mpath,path,polygon,polyline,radialGradient,rect,set,stop,svg,switch,text,title,tspan,use");var w=g("script,style"),C=h.extend({},v,s,t,u,n),D=g("background,cite,href,longdesc,src,usemap,xlink:href");n=g("abbr,align,alt,axis,bgcolor,border,cellpadding,cellspacing,class,clear,color,cols,colspan,compact,coords,dir,face,headers,height,hreflang,hspace,ismap,lang,language,nohref,nowrap,rel,rev,rows,rowspan,rules,scope,scrolling,shape,size,span,start,summary,target,title,type,valign,value,vspace,width"),p=g("accent-height,accumulate,additive,alphabetic,arabic-form,ascent,attributeName,attributeType,baseProfile,bbox,begin,by,calcMode,cap-height,class,color,color-rendering,content,cx,cy,d,dx,dy,descent,display,dur,end,fill,fill-rule,font-family,font-size,font-stretch,font-style,font-variant,font-weight,from,fx,fy,g1,g2,glyph-name,gradientUnits,hanging,height,horiz-adv-x,horiz-origin-x,ideographic,k,keyPoints,keySplines,keyTimes,lang,marker-end,marker-mid,marker-start,markerHeight,markerUnits,markerWidth,mathematical,max,min,offset,opacity,orient,origin,overline-position,overline-thickness,panose-1,path,pathLength,points,preserveAspectRatio,r,refX,refY,repeatCount,repeatDur,requiredExtensions,requiredFeatures,restart,rotate,rx,ry,slope,stemh,stemv,stop-color,stop-opacity,strikethrough-position,strikethrough-thickness,stroke,stroke-dasharray,stroke-dashoffset,stroke-linecap,stroke-linejoin,stroke-miterlimit,stroke-opacity,stroke-width,systemLanguage,target,text-anchor,to,transform,type,u1,u2,underline-position,underline-thickness,unicode,unicode-range,units-per-em,values,version,viewBox,visibility,width,widths,x,x-height,x1,x2,xlink:actuate,xlink:arcrole,xlink:role,xlink:show,xlink:title,xlink:type,xml:base,xml:lang,xml:space,xmlns,xmlns:xlink,y,y1,y2,zoomAndPan");var O=h.extend({},D,p,n),A=document.createElement("pre");h.module("ngSanitize",[]).provider("$sanitize",function(){this.$get=["$$sanitizeUri",function(a){return function(e){var d=[];return F(e,r(d,function(c,b){return!/^unsafe/.test(a(c,b))})),d.join("")}}]}),h.module("ngSanitize").filter("linky",["$sanitize",function(a){var e=/((ftp|https?):\/\/|(www\.)|(mailto:)?[A-Za-z0-9._%+-]+@)\S*[^\s.;,(){}<>"\u201d\u2019]/,d=/^mailto:/;return function(c,b){function k(a){a&&g.push(E(a))}if(!c)return c;for(var m,n,p,l=c,g=[];m=l.match(e);)n=m[0],m[2]||m[4]||(n=(m[3]?"http://":"mailto:")+n),p=m.index,k(l.substr(0,p)),function(a,c){g.push("<a "),h.isDefined(b)&&g.push('target="',b,'" '),g.push('href="',a.replace(/"/g,"&quot;"),'">'),k(c),g.push("</a>")}(n,m[0].replace(d,"")),l=l.substring(p+m[0].length);return k(l),a(g.join(""))}}])}(window,window.angular),function(window,angular,undefined){"use strict";angular.module("ngCookies",["ng"]).factory("$cookies",["$rootScope","$browser",function($rootScope,$browser){function push(){var name,value,browserCookies,updated;for(name in lastCookies)isUndefined(cookies[name])&&$browser.cookies(name,undefined);for(name in cookies)value=cookies[name],angular.isString(value)||(value=""+value,cookies[name]=value),value!==lastCookies[name]&&($browser.cookies(name,value),updated=!0);if(updated){updated=!1,browserCookies=$browser.cookies();for(name in cookies)cookies[name]!==browserCookies[name]&&(isUndefined(browserCookies[name])?delete cookies[name]:cookies[name]=browserCookies[name],updated=!0)}}var lastBrowserCookies,cookies={},lastCookies={},runEval=!1,copy=angular.copy,isUndefined=angular.isUndefined;return $browser.addPollFn(function(){var currentCookies=$browser.cookies();lastBrowserCookies!=currentCookies&&(lastBrowserCookies=currentCookies,copy(currentCookies,lastCookies),copy(currentCookies,cookies),runEval&&$rootScope.$apply())})(),runEval=!0,$rootScope.$watch(push),cookies}]).factory("$cookieStore",["$cookies",function($cookies){return{get:function(key){var value=$cookies[key];return value?angular.fromJson(value):value},put:function(key,value){$cookies[key]=angular.toJson(value)},remove:function(key){delete $cookies[key]}}}])}(window,window.angular),function(){var device,previousDevice,addClass,documentElement,find,handleOrientation,hasClass,orientationEvent,removeClass,userAgent;previousDevice=window.device,device={},window.device=device,documentElement=window.document.documentElement,userAgent=window.navigator.userAgent.toLowerCase(),device.ios=function(){return device.iphone()||device.ipod()||device.ipad()},device.iphone=function(){return find("iphone")},device.ipod=function(){return find("ipod")},device.ipad=function(){return find("ipad")},device.android=function(){return find("android")},device.androidPhone=function(){return device.android()&&find("mobile")||-1!==userAgent.search(/Nexus 7/i)||-1!==userAgent.search(/K012/i)},device.androidTablet=function(){return device.android()&&!find("mobile")&&-1==userAgent.search(/Nexus 7/i)&&-1==userAgent.search(/K012/i)},device.blackberry=function(){return find("blackberry")||find("bb10")||find("rim")},device.blackberryPhone=function(){return device.blackberry()&&!find("tablet")},device.blackberryTablet=function(){return device.blackberry()&&find("tablet")},device.windows=function(){return find("windows")},device.windowsPhone=function(){return device.windows()&&find("phone")},device.windowsTablet=function(){return device.windows()&&find("touch")&&!device.windowsPhone()},device.fxos=function(){return(find("(mobile;")||find("(tablet;"))&&find("; rv:")},device.fxosPhone=function(){return device.fxos()&&find("mobile")},device.fxosTablet=function(){return device.fxos()&&find("tablet")},device.meego=function(){return find("meego")},device.cordova=function(){return window.cordova&&"file:"===location.protocol},device.nodeWebkit=function(){return"object"==typeof window.process},device.mobile=function(){return device.androidPhone()||device.iphone()||device.ipod()||device.windowsPhone()||device.blackberryPhone()||device.fxosPhone()||device.meego()},device.tablet=function(){return device.ipad()||device.androidTablet()||device.blackberryTablet()||device.windowsTablet()||device.fxosTablet()},device.desktop=function(){return!device.tablet()&&!device.mobile()},device.television=function(){var i;for(television=["googletv","viera","smarttv","internet.tv","netcast","nettv","appletv","boxee","kylo","roku","dlnadoc","roku","pov_tv","hbbtv","ce-html"],i=0;i<television.length;){if(find(television[i]))return!0;i++}return!1},device.portrait=function(){return window.innerHeight/window.innerWidth>1},device.landscape=function(){return window.innerHeight/window.innerWidth<1},device.noConflict=function(){return window.device=previousDevice,this},find=function(needle){return-1!==userAgent.indexOf(needle)},hasClass=function(className){var regex;return regex=new RegExp(className,"i"),documentElement.className.match(regex)},addClass=function(className){hasClass(className)||(documentElement.className=documentElement.className.trim()+" "+className)},removeClass=function(className){hasClass(className)&&(documentElement.className=documentElement.className.replace(" "+className,""))},device.ios()?device.ipad()?addClass("ios ipad tablet"):device.iphone()?addClass("ios iphone mobile"):device.ipod()&&addClass("ios ipod mobile"):device.android()?addClass(device.androidTablet()?"android tablet":"android mobile"):device.blackberry()?addClass(device.blackberryTablet()?"blackberry tablet":"blackberry mobile"):device.windows()?addClass(device.windowsTablet()?"windows tablet":device.windowsPhone()?"windows mobile":"desktop"):device.fxos()?addClass(device.fxosTablet()?"fxos tablet":"fxos mobile"):device.meego()?addClass("meego mobile"):device.nodeWebkit()?addClass("node-webkit"):device.television()?addClass("television"):device.desktop()&&addClass("desktop"),device.cordova()&&addClass("cordova"),handleOrientation=function(){device.landscape()?(removeClass("portrait"),addClass("landscape")):(removeClass("landscape"),addClass("portrait"))},orientationEvent=window.hasOwnProperty("onorientationchange")?"orientationchange":"resize",window.addEventListener?window.addEventListener(orientationEvent,handleOrientation,!1):window.attachEvent?window.attachEvent(orientationEvent,handleOrientation):window[orientationEvent]=handleOrientation,handleOrientation(),"function"==typeof define&&"object"==typeof define.amd&&define.amd?define(function(){return device}):"undefined"!=typeof module&&module.exports?module.exports=device:window.device=device}.call(this),function($){function div(){return $("<div/>")}var abs=Math.abs,max=Math.max,min=Math.min,round=Math.round;$.imgAreaSelect=function(img,options){function viewX(x){return x+imgOfs.left-parOfs.left}function viewY(y){return y+imgOfs.top-parOfs.top}function selX(x){return x-imgOfs.left+parOfs.left}function selY(y){return y-imgOfs.top+parOfs.top}function evX(event){var x,coords=touchCoords(event)||event;if(x=parseInt(coords.pageX))return x-parOfs.left}function evY(event){var y,coords=touchCoords(event)||event;if(y=parseInt(coords.pageY))return y-parOfs.top}function touchCoords(event){var oev=event.originalEvent||{};return!(!oev.touches||!oev.touches.length)&&oev.touches[0]}function getSelection(noScale){var sx=noScale||scaleX,sy=noScale||scaleY;return{x1:round(selection.x1*sx),y1:round(selection.y1*sy),x2:round(selection.x2*sx)-1,y2:round(selection.y2*sy)-1,width:round(selection.x2*sx)-round(selection.x1*sx),height:round(selection.y2*sy)-round(selection.y1*sy)}}function setSelection(x1,y1,x2,y2,noScale){var sx=noScale||scaleX,sy=noScale||scaleY;selection={x1:round(x1/sx||0),y1:round(y1/sy||0),x2:round(++x2/sx||0),y2:round(++y2/sy||0)},selection.width=selection.x2-selection.x1,selection.height=selection.y2-selection.y1}function adjust(){imgLoaded&&$img.width()&&(imgOfs={left:round($img.offset().left),top:round($img.offset().top)},imgWidth=$img.innerWidth(),imgHeight=$img.innerHeight(),imgOfs.top+=$img.outerHeight()-imgHeight>>1,imgOfs.left+=$img.outerWidth()-imgWidth>>1,minWidth=round(options.minWidth/scaleX)||0,minHeight=round(options.minHeight/scaleY)||0,maxWidth=round(min(options.maxWidth/scaleX||1<<24,imgWidth)),maxHeight=round(min(options.maxHeight/scaleY||1<<24,imgHeight)),parOfs="fixed"==position?{left:$(document).scrollLeft(),top:$(document).scrollTop()}:/static|^$/.test($parent.css("position"))?{left:0,top:0}:{left:round($parent.offset().left)-$parent.scrollLeft(),top:round($parent.offset().top)-$parent.scrollTop()},left=viewX(0),top=viewY(0),(selection.x2>imgWidth||selection.y2>imgHeight)&&fixAreaCoords())}function update(resetKeyPress){if(shown){switch($box.css({left:viewX(selection.x1),top:viewY(selection.y1)}).add($area).width(w=selection.width).height(h=selection.height),$area.add($border).add($handles).css({left:0,top:0}),$border.add($outer).width(max(w-$border.outerWidth()+$border.innerWidth(),0)).height(max(h-$border.outerHeight()+$border.innerHeight(),0)),$outer.css({left:left,top:top,width:w,height:h,borderStyle:"solid",borderWidth:selection.y1+"px "+(imgWidth-selection.x2)+"px "+(imgHeight-selection.y2)+"px "+selection.x1+"px"}),w-=$handles.outerWidth(),h-=$handles.outerHeight(),$handles.length){case 8:$($handles[4]).css({left:w>>1}),$($handles[5]).css({left:w,top:h>>1}),$($handles[6]).css({left:w>>1,top:h}),$($handles[7]).css({top:h>>1});case 4:$handles.slice(1,3).css({left:w}),$handles.slice(2,4).css({top:h})}!1!==resetKeyPress&&($.imgAreaSelect.keyPress!=docKeyPress&&$(document).unbind($.imgAreaSelect.keyPress,$.imgAreaSelect.onKeyPress),options.keys&&$(document)[$.imgAreaSelect.keyPress]($.imgAreaSelect.onKeyPress=docKeyPress))}}function doUpdate(resetKeyPress){adjust(),update(resetKeyPress),x1=viewX(selection.x1),y1=viewY(selection.y1),x2=viewX(selection.x2),y2=viewY(selection.y2)}function hide($elem,fn){options.fadeDuration?$elem.fadeOut(options.fadeDuration,fn):$elem.hide()}function breakWhenNoTouch(event){return touch&&!/^touch/.test(event.type)}function checkResize(event){var x=selX(evX(event))-selection.x1,y=selY(evY(event))-selection.y1;resize="",options.resizable&&(y<=options.resizeMargin?resize="n":y>=selection.height-options.resizeMargin&&(resize="s"),x<=options.resizeMargin?resize+="w":x>=selection.width-options.resizeMargin&&(resize+="e")),$box.css("cursor",resize?resize+"-resize":options.movable?"move":"")}function areaMouseMove(event){breakWhenNoTouch(event)||(adjusted||(adjust(),adjusted=!0,$box.one("mouseout",function(){adjusted=!1})),checkResize(event))}function docMouseUp(event){touch=!1,$("body").css("cursor",""),(options.autoHide||selection.width*selection.height==0)&&hide($box.add($outer),function(){$(this).hide()}),$(document).off("mousemove touchmove",selectingMouseMove),$box.on("mousemove touchmove",areaMouseMove),event&&options.onSelectEnd(img,getSelection())}function areaMouseDown(event){return("mousedown"!=event.type||1==event.which)&&("touchstart"==event.type?(touch&&docMouseUp(),touch=!0,checkResize(event)):adjust(),resize?(x1=viewX(selection["x"+(1+/w/.test(resize))]),y1=viewY(selection["y"+(1+/n/.test(resize))]),x2=viewX(selection["x"+(1+!/w/.test(resize))]),y2=viewY(selection["y"+(1+!/n/.test(resize))]),edgeX=x2-evX(event),edgeY=y2-evY(event),
$(document).on("mousemove touchmove",selectingMouseMove).one("mouseup touchend",docMouseUp),$box.off("mousemove touchmove",areaMouseMove)):options.movable?(startX=left+selection.x1-evX(event),startY=top+selection.y1-evY(event),$box.off("mousemove touchmove",areaMouseMove),$(document).on("mousemove touchmove",movingMouseMove).one("mouseup touchend",function(){touch=!1,options.onSelectEnd(img,getSelection()),$(document).off("mousemove touchmove",movingMouseMove),$box.on("mousemove touchmove",areaMouseMove)})):$img.mousedown(event),!1)}function fixAspectRatio(xFirst){aspectRatio&&(xFirst?(x2=max(left,min(left+imgWidth,x1+abs(y2-y1)*aspectRatio*(x2>x1||-1))),y2=round(max(top,min(top+imgHeight,y1+abs(x2-x1)/aspectRatio*(y2>y1||-1)))),x2=round(x2)):(y2=max(top,min(top+imgHeight,y1+abs(x2-x1)/aspectRatio*(y2>y1||-1))),x2=round(max(left,min(left+imgWidth,x1+abs(y2-y1)*aspectRatio*(x2>x1||-1)))),y2=round(y2)))}function fixAreaCoords(){x1=min(x1,left+imgWidth),y1=min(y1,top+imgHeight),abs(x2-x1)<minWidth&&(x2=x1-minWidth*(x2<x1||-1),x2<left?x1=left+minWidth:x2>left+imgWidth&&(x1=left+imgWidth-minWidth)),abs(y2-y1)<minHeight&&(y2=y1-minHeight*(y2<y1||-1),y2<top?y1=top+minHeight:y2>top+imgHeight&&(y1=top+imgHeight-minHeight)),x2=max(left,min(x2,left+imgWidth)),y2=max(top,min(y2,top+imgHeight)),fixAspectRatio(abs(x2-x1)<abs(y2-y1)*aspectRatio),abs(x2-x1)>maxWidth&&(x2=x1-maxWidth*(x2<x1||-1),fixAspectRatio()),abs(y2-y1)>maxHeight&&(y2=y1-maxHeight*(y2<y1||-1),fixAspectRatio(!0)),selection={x1:selX(min(x1,x2)),x2:selX(max(x1,x2)),y1:selY(min(y1,y2)),y2:selY(max(y1,y2)),width:abs(x2-x1),height:abs(y2-y1)}}function doResize(){fixAreaCoords(),update(),options.onSelectChange(img,getSelection())}function selectingMouseMove(event){if(!breakWhenNoTouch(event))return fixAreaCoords(),x2=/w|e|^$/.test(resize)||aspectRatio?evX(event)+edgeX:viewX(selection.x2),y2=/n|s|^$/.test(resize)||aspectRatio?evY(event)+edgeY:viewY(selection.y2),doResize(),!1}function doMove(newX1,newY1){x2=(x1=newX1)+selection.width,y2=(y1=newY1)+selection.height,$.extend(selection,{x1:selX(x1),y1:selY(y1),x2:selX(x2),y2:selY(y2)}),update(),options.onSelectChange(img,getSelection())}function movingMouseMove(event){if(!breakWhenNoTouch(event))return x1=max(left,min(startX+evX(event),left+imgWidth-selection.width)),y1=max(top,min(startY+evY(event),top+imgHeight-selection.height)),doMove(x1,y1),event.preventDefault(),!1}function startSelection(){$(document).off("mousemove touchmove",startSelection),adjust(),x2=x1,y2=y1,doResize(),resize="",$outer.is(":visible")||$box.add($outer).hide().fadeIn(options.fadeDuration||0),shown=!0,$(document).off("mouseup touchend",cancelSelection).on("mousemove touchmove",selectingMouseMove).one("mouseup touchend",docMouseUp),$box.off("mousemove touchmove",areaMouseMove),options.onSelectStart(img,getSelection())}function cancelSelection(){$(document).off("mousemove touchmove",startSelection).off("mouseup touchend",cancelSelection),hide($box.add($outer)),setSelection(selX(x1),selY(y1),selX(x1),selY(y1)),this instanceof $.imgAreaSelect||(options.onSelectChange(img,getSelection()),options.onSelectEnd(img,getSelection()))}function imgMouseDown(event){return!("mousedown"==event.type&&1!=event.which||$outer.is(":animated"))&&(touch="touchstart"==event.type,adjust(),startX=x1=evX(event),startY=y1=evY(event),edgeX=edgeY=0,$(document).on({"mousemove touchmove":startSelection,"mouseup touchend":cancelSelection}),!1)}function windowResize(){doUpdate(!1)}function imgLoad(){imgLoaded=!0,setOptions(options=$.extend({classPrefix:"imgareaselect",movable:!0,parent:"body",resizable:!0,resizeMargin:10,onInit:function(){},onSelectStart:function(){},onSelectChange:function(){},onSelectEnd:function(){}},options)),options.show&&(shown=!0,adjust(),update(),$box.add($outer).hide().fadeIn(options.fadeDuration||0)),setTimeout(function(){options.onInit(img,getSelection())},0)}function setOptions(newOptions){if(newOptions.parent&&($parent=$(newOptions.parent)).append($box).append($outer),$.extend(options,newOptions),adjust(),null!=newOptions.handles){for($handles.remove(),$handles=$([]),i=newOptions.handles?"corners"==newOptions.handles?4:8:0;i--;)$handles=$handles.add(div());$handles.addClass(options.classPrefix+"-handle").css({position:"absolute",fontSize:0,zIndex:zIndex+1||1}),!parseInt($handles.css("width"))>=0&&$handles.width(5).height(5)}for(scaleX=options.imageWidth/imgWidth||1,scaleY=options.imageHeight/imgHeight||1,null!=newOptions.x1&&(setSelection(newOptions.x1,newOptions.y1,newOptions.x2,newOptions.y2),newOptions.show=!newOptions.hide),newOptions.keys&&(options.keys=$.extend({shift:1,ctrl:"resize"},newOptions.keys)),$outer.addClass(options.classPrefix+"-outer"),$area.addClass(options.classPrefix+"-selection"),i=0;i++<4;)$($border[i-1]).addClass(options.classPrefix+"-border"+i);$box.append($area.add($border)).append($handles),msie&&((o=($outer.css("filter")||"").match(/opacity=(\d+)/))&&$outer.css("opacity",o[1]/100),(o=($border.css("filter")||"").match(/opacity=(\d+)/))&&$border.css("opacity",o[1]/100)),newOptions.hide?hide($box.add($outer)):newOptions.show&&imgLoaded&&(shown=!0,$box.add($outer).fadeIn(options.fadeDuration||0),doUpdate()),aspectRatio=(d=(options.aspectRatio||"").split(/:/))[0]/d[1],$img.add($outer).off("mousedown touchstart",imgMouseDown),options.disable||!1===options.enable?($box.off({"mousemove touchmove":areaMouseMove,"mousedown touchstart":areaMouseDown}),$(window).off("resize",windowResize)):((options.enable||!1===options.disable)&&((options.resizable||options.movable)&&$box.on({"mousemove touchmove":areaMouseMove,"mousedown touchstart":areaMouseDown}),$(window).resize(windowResize)),options.persistent||$img.add($outer).on("mousedown touchstart",imgMouseDown)),options.enable=options.disable=void 0}var imgLoaded,left,top,imgWidth,imgHeight,$parent,startX,startY,edgeX,edgeY,scaleX,scaleY,resize,minWidth,minHeight,maxWidth,maxHeight,aspectRatio,shown,x1,y1,x2,y2,touch,$p,d,i,o,w,h,adjusted,$img=$(img),$box=div(),$area=div(),$border=div().add(div()).add(div()).add(div()),$outer=div(),$handles=$([]),imgOfs={left:0,top:0},parOfs={left:0,top:0},zIndex=0,position="absolute",selection={x1:0,y1:0,x2:0,y2:0,width:0,height:0},ua=navigator.userAgent,docKeyPress=function(event){var d,t,k=options.keys,key=event.keyCode;if(d=isNaN(k.alt)||!event.altKey&&!event.originalEvent.altKey?!isNaN(k.ctrl)&&event.ctrlKey?k.ctrl:!isNaN(k.shift)&&event.shiftKey?k.shift:isNaN(k.arrows)?10:k.arrows:k.alt,"resize"==k.arrows||"resize"==k.shift&&event.shiftKey||"resize"==k.ctrl&&event.ctrlKey||"resize"==k.alt&&(event.altKey||event.originalEvent.altKey)){switch(key){case 37:d=-d;case 39:t=max(x1,x2),x1=min(x1,x2),x2=max(t+d,x1),fixAspectRatio();break;case 38:d=-d;case 40:t=max(y1,y2),y1=min(y1,y2),y2=max(t+d,y1),fixAspectRatio(!0);break;default:return}doResize()}else switch(x1=min(x1,x2),y1=min(y1,y2),key){case 37:doMove(max(x1-d,left),y1);break;case 38:doMove(x1,max(y1-d,top));break;case 39:doMove(x1+min(d,imgWidth-selX(x2)),y1);break;case 40:doMove(x1,y1+min(d,imgHeight-selY(y2)));break;default:return}return!1};this.remove=function(){setOptions({disable:!0}),$box.add($outer).remove()},this.getOptions=function(){return options},this.setOptions=setOptions,this.getSelection=getSelection,this.setSelection=setSelection,this.cancelSelection=cancelSelection,this.update=doUpdate;var msie=(/msie ([\w.]+)/i.exec(ua)||[])[1],safari=/webkit/i.test(ua)&&!/chrome/i.test(ua);for($p=$img;$p.length;)zIndex=max(zIndex,isNaN($p.css("z-index"))?zIndex:$p.css("z-index")),options.parent||"fixed"!=$p.css("position")||(position="fixed"),$p=$p.parent(":not(body)");zIndex=options.zIndex||zIndex,$.imgAreaSelect.keyPress=msie||safari?"keydown":"keypress",$box.add($outer).hide().css({position:position,overflow:"hidden",zIndex:zIndex||"0"}),$box.css({zIndex:zIndex+2||2}),$area.add($border).css({position:"absolute",fontSize:0}),img.complete||"complete"==img.readyState||!$img.is("img")?imgLoad():$img.one("load",imgLoad),!imgLoaded&&msie&&msie>=7&&(img.src=img.src)},$.fn.imgAreaSelect=function(options){return options=options||{},this.each(function(){$(this).data("imgAreaSelect")?options.remove?($(this).data("imgAreaSelect").remove(),$(this).removeData("imgAreaSelect")):$(this).data("imgAreaSelect").setOptions(options):options.remove||(void 0===options.enable&&void 0===options.disable&&(options.enable=!0),$(this).data("imgAreaSelect",new $.imgAreaSelect(this,options)))}),options.instance?$(this).data("imgAreaSelect"):this}}(jQuery),"undefined"!=typeof module&&"undefined"!=typeof exports&&module.exports===exports&&(module.exports="monospaced.elastic"),angular.module("monospaced.elastic",[]).constant("msdElasticConfig",{append:""}).directive("msdElastic",["$timeout","$window","msdElasticConfig",function($timeout,$window,config){"use strict";return{require:"ngModel",restrict:"A, C",link:function(scope,element,attrs,ngModel){function initMirror(){var mirrorStyle=mirrorInitStyle;mirrored=ta,taStyle=getComputedStyle(ta),angular.forEach(copyStyle,function(val){mirrorStyle+=val+":"+taStyle.getPropertyValue(val)+";"}),mirror.setAttribute("style",mirrorStyle)}function adjust(){var taHeight,taComputedStyleWidth,mirrorHeight,width,overflow;mirrored!==ta&&initMirror(),active||(active=!0,mirror.value=ta.value+append,mirror.style.overflowY=ta.style.overflowY,taHeight=""===ta.style.height?"auto":parseInt(ta.style.height,10),taComputedStyleWidth=getComputedStyle(ta).getPropertyValue("width"),"px"===taComputedStyleWidth.substr(taComputedStyleWidth.length-2,2)&&(width=parseInt(taComputedStyleWidth,10)-boxOuter.width,mirror.style.width=width+"px"),mirrorHeight=mirror.scrollHeight,mirrorHeight>maxHeight?(mirrorHeight=maxHeight,overflow="scroll"):mirrorHeight<minHeight&&(mirrorHeight=minHeight),mirrorHeight+=boxOuter.height,ta.style.overflowY=overflow||"hidden",taHeight!==mirrorHeight&&(scope.$emit("elastic:resize",$ta,taHeight,mirrorHeight),ta.style.height=mirrorHeight+"px"),$timeout(function(){active=!1},1,!1))}function forceAdjust(){active=!1,adjust()}if("true"!=attrs.msdElasticDisable){var ta=element[0],$ta=element;if("TEXTAREA"===ta.nodeName&&$window.getComputedStyle){$ta.css({overflow:"hidden","overflow-y":"hidden","word-wrap":"break-word"});var text=ta.value;ta.value="",ta.value=text;var mirrored,active,append=attrs.msdElastic?attrs.msdElastic.replace(/\\n/g,"\n"):config.append,$win=angular.element($window),mirrorInitStyle="position: absolute; top: -999px; right: auto; bottom: auto;left: 0; overflow: hidden; -webkit-box-sizing: content-box;-moz-box-sizing: content-box; box-sizing: content-box;min-height: 0 !important; height: 0 !important; padding: 0;word-wrap: break-word; border: 0;",$mirror=angular.element('<textarea aria-hidden="true" tabindex="-1" style="'+mirrorInitStyle+'"/>').data("elastic",!0),mirror=$mirror[0],taStyle=getComputedStyle(ta),resize=taStyle.getPropertyValue("resize"),borderBox="border-box"===taStyle.getPropertyValue("box-sizing")||"border-box"===taStyle.getPropertyValue("-moz-box-sizing")||"border-box"===taStyle.getPropertyValue("-webkit-box-sizing"),boxOuter=borderBox?{width:parseInt(taStyle.getPropertyValue("border-right-width"),10)+parseInt(taStyle.getPropertyValue("padding-right"),10)+parseInt(taStyle.getPropertyValue("padding-left"),10)+parseInt(taStyle.getPropertyValue("border-left-width"),10),height:parseInt(taStyle.getPropertyValue("border-top-width"),10)+parseInt(taStyle.getPropertyValue("padding-top"),10)+parseInt(taStyle.getPropertyValue("padding-bottom"),10)+parseInt(taStyle.getPropertyValue("border-bottom-width"),10)}:{width:0,height:0},minHeightValue=parseInt(taStyle.getPropertyValue("min-height"),10),heightValue=parseInt(taStyle.getPropertyValue("height"),10),minHeight=Math.max(minHeightValue,heightValue)-boxOuter.height,maxHeight=parseInt(taStyle.getPropertyValue("max-height"),10),copyStyle=["font-family","font-size","font-weight","font-style","letter-spacing","line-height","text-transform","word-spacing","text-indent"];$ta.data("elastic")||(maxHeight=maxHeight&&maxHeight>0?maxHeight:9e4,mirror.parentNode!==document.body&&angular.element(document.body).append(mirror),$ta.css({resize:"none"===resize||"vertical"===resize?"none":"horizontal"}).data("elastic",!0),ta.oninput="onpropertychange"in ta&&"oninput"in ta?ta.onkeyup=adjust:adjust,$win.bind("resize",forceAdjust),scope.$watch(function(){return ngModel.$modelValue},function(newValue){forceAdjust()}),scope.$on("elastic:adjust",function(){initMirror(),forceAdjust()}),$timeout(adjust,0,!1),scope.$on("$destroy",function(){$mirror.remove(),$win.unbind("resize",forceAdjust)}))}}}}}]),function(){function imageHasData(img){return!!img.exifdata}function base64ToArrayBuffer(base64,contentType){contentType=contentType||base64.match(/^data\:([^\;]+)\;base64,/im)[1]||"",base64=base64.replace(/^data\:([^\;]+)\;base64,/gim,"");for(var binary=atob(base64),len=binary.length,buffer=new ArrayBuffer(len),view=new Uint8Array(buffer),i=0;i<len;i++)view[i]=binary.charCodeAt(i);return buffer}function objectURLToBlob(url,callback){var http=new XMLHttpRequest;http.open("GET",url,!0),http.responseType="blob",http.onload=function(e){200!=this.status&&0!==this.status||callback(this.response)},http.send()}function getImageData(img,callback){function handleBinaryFile(binFile){var data=findEXIFinJPEG(binFile);img.exifdata=data||{};var iptcdata=findIPTCinJPEG(binFile);if(img.iptcdata=iptcdata||{},EXIF.isXmpEnabled){var xmpdata=findXMPinJPEG(binFile);img.xmpdata=xmpdata||{}}callback&&callback.call(img)}if(img.src)if(/^data\:/i.test(img.src)){var arrayBuffer=base64ToArrayBuffer(img.src);handleBinaryFile(arrayBuffer)}else if(/^blob\:/i.test(img.src)){var fileReader=new FileReader;fileReader.onload=function(e){handleBinaryFile(e.target.result)},objectURLToBlob(img.src,function(blob){fileReader.readAsArrayBuffer(blob)})}else{var http=new XMLHttpRequest;http.onload=function(){if(200!=this.status&&0!==this.status)throw"Could not load image";handleBinaryFile(http.response),http=null},http.open("GET",img.src,!0),http.responseType="arraybuffer",http.send(null)}else if(self.FileReader&&(img instanceof self.Blob||img instanceof self.File)){var fileReader=new FileReader;fileReader.onload=function(e){handleBinaryFile(e.target.result)},fileReader.readAsArrayBuffer(img)}}function findEXIFinJPEG(file){var dataView=new DataView(file);if(255!=dataView.getUint8(0)||216!=dataView.getUint8(1))return!1;for(var offset=2,length=file.byteLength;offset<length;){if(255!=dataView.getUint8(offset))return!1;if(225==dataView.getUint8(offset+1))return readEXIFData(dataView,offset+4,dataView.getUint16(offset+2));offset+=2+dataView.getUint16(offset+2)}}function findIPTCinJPEG(file){var dataView=new DataView(file);if(255!=dataView.getUint8(0)||216!=dataView.getUint8(1))return!1;for(var offset=2,length=file.byteLength;offset<length;){if(function(dataView,offset){return 56===dataView.getUint8(offset)&&66===dataView.getUint8(offset+1)&&73===dataView.getUint8(offset+2)&&77===dataView.getUint8(offset+3)&&4===dataView.getUint8(offset+4)&&4===dataView.getUint8(offset+5)}(dataView,offset)){var nameHeaderLength=dataView.getUint8(offset+7);nameHeaderLength%2!=0&&(nameHeaderLength+=1),0===nameHeaderLength&&(nameHeaderLength=4);return readIPTCData(file,offset+8+nameHeaderLength,dataView.getUint16(offset+6+nameHeaderLength))}offset++}}function readIPTCData(file,startOffset,sectionLength){for(var fieldValue,fieldName,dataSize,segmentType,dataView=new DataView(file),data={},segmentStartPos=startOffset;segmentStartPos<startOffset+sectionLength;)28===dataView.getUint8(segmentStartPos)&&2===dataView.getUint8(segmentStartPos+1)&&(segmentType=dataView.getUint8(segmentStartPos+2))in IptcFieldMap&&(dataSize=dataView.getInt16(segmentStartPos+3),dataSize+5,fieldName=IptcFieldMap[segmentType],fieldValue=getStringFromDB(dataView,segmentStartPos+5,dataSize),data.hasOwnProperty(fieldName)?data[fieldName]instanceof Array?data[fieldName].push(fieldValue):data[fieldName]=[data[fieldName],fieldValue]:data[fieldName]=fieldValue),segmentStartPos++;return data}function readTags(file,tiffStart,dirStart,strings,bigEnd){var entryOffset,tag,i,entries=file.getUint16(dirStart,!bigEnd),tags={};for(i=0;i<entries;i++)entryOffset=dirStart+12*i+2,void 0!==(tag=strings[file.getUint16(entryOffset,!bigEnd)])&&(tags[tag]=readTagValue(file,entryOffset,tiffStart,dirStart,bigEnd));return tags}function readTagValue(file,entryOffset,tiffStart,dirStart,bigEnd){var offset,vals,val,n,numerator,denominator,type=file.getUint16(entryOffset+2,!bigEnd),numValues=file.getUint32(entryOffset+4,!bigEnd),valueOffset=file.getUint32(entryOffset+8,!bigEnd)+tiffStart;switch(type){case 1:case 7:if(1==numValues)return file.getUint8(entryOffset+8,!bigEnd);for(offset=numValues>4?valueOffset:entryOffset+8,vals=[],n=0;n<numValues;n++)vals[n]=file.getUint8(offset+n);return vals;case 2:return offset=numValues>4?valueOffset:entryOffset+8,getStringFromDB(file,offset,numValues-1);case 3:if(1==numValues)return file.getUint16(entryOffset+8,!bigEnd);for(offset=numValues>2?valueOffset:entryOffset+8,vals=[],n=0;n<numValues;n++)vals[n]=file.getUint16(offset+2*n,!bigEnd);return vals;case 4:if(1==numValues)return file.getUint32(entryOffset+8,!bigEnd);for(vals=[],n=0;n<numValues;n++)vals[n]=file.getUint32(valueOffset+4*n,!bigEnd);return vals;case 5:if(1==numValues)return numerator=file.getUint32(valueOffset,!bigEnd),denominator=file.getUint32(valueOffset+4,!bigEnd),val=new Number(numerator/denominator),val.numerator=numerator,val.denominator=denominator,val;for(vals=[],n=0;n<numValues;n++)numerator=file.getUint32(valueOffset+8*n,!bigEnd),denominator=file.getUint32(valueOffset+4+8*n,!bigEnd),vals[n]=new Number(numerator/denominator),vals[n].numerator=numerator,vals[n].denominator=denominator;return vals;case 9:if(1==numValues)return file.getInt32(entryOffset+8,!bigEnd);for(vals=[],n=0;n<numValues;n++)vals[n]=file.getInt32(valueOffset+4*n,!bigEnd);return vals;case 10:if(1==numValues)return file.getInt32(valueOffset,!bigEnd)/file.getInt32(valueOffset+4,!bigEnd);for(vals=[],n=0;n<numValues;n++)vals[n]=file.getInt32(valueOffset+8*n,!bigEnd)/file.getInt32(valueOffset+4+8*n,!bigEnd);return vals}}function getNextIFDOffset(dataView,dirStart,bigEnd){var entries=dataView.getUint16(dirStart,!bigEnd);return dataView.getUint32(dirStart+2+12*entries,!bigEnd)}function readThumbnailImage(dataView,tiffStart,firstIFDOffset,bigEnd){var IFD1OffsetPointer=getNextIFDOffset(dataView,tiffStart+firstIFDOffset,bigEnd);if(!IFD1OffsetPointer)return{};if(IFD1OffsetPointer>dataView.byteLength)return{};var thumbTags=readTags(dataView,tiffStart,tiffStart+IFD1OffsetPointer,IFD1Tags,bigEnd);if(thumbTags.Compression)switch(thumbTags.Compression){case 6:if(thumbTags.JpegIFOffset&&thumbTags.JpegIFByteCount){var tOffset=tiffStart+thumbTags.JpegIFOffset,tLength=thumbTags.JpegIFByteCount;thumbTags.blob=new Blob([new Uint8Array(dataView.buffer,tOffset,tLength)],{type:"image/jpeg"})}}else thumbTags.PhotometricInterpretation;return thumbTags}function getStringFromDB(buffer,start,length){for(var outstr="",n=start;n<start+length;n++)outstr+=String.fromCharCode(buffer.getUint8(n));return outstr}function readEXIFData(file,start){if("Exif"!=getStringFromDB(file,start,4))return!1;var bigEnd,tags,tag,exifData,gpsData,tiffOffset=start+6;if(18761==file.getUint16(tiffOffset))bigEnd=!1;else{if(19789!=file.getUint16(tiffOffset))return!1;bigEnd=!0}if(42!=file.getUint16(tiffOffset+2,!bigEnd))return!1;var firstIFDOffset=file.getUint32(tiffOffset+4,!bigEnd);if(firstIFDOffset<8)return!1;if(tags=readTags(file,tiffOffset,tiffOffset+firstIFDOffset,TiffTags,bigEnd),tags.ExifIFDPointer){exifData=readTags(file,tiffOffset,tiffOffset+tags.ExifIFDPointer,ExifTags,bigEnd);for(tag in exifData){switch(tag){case"LightSource":case"Flash":case"MeteringMode":case"ExposureProgram":case"SensingMethod":case"SceneCaptureType":case"SceneType":case"CustomRendered":case"WhiteBalance":case"GainControl":case"Contrast":case"Saturation":case"Sharpness":case"SubjectDistanceRange":case"FileSource":exifData[tag]=StringValues[tag][exifData[tag]];break;case"ExifVersion":case"FlashpixVersion":exifData[tag]=String.fromCharCode(exifData[tag][0],exifData[tag][1],exifData[tag][2],exifData[tag][3]);break;case"ComponentsConfiguration":exifData[tag]=StringValues.Components[exifData[tag][0]]+StringValues.Components[exifData[tag][1]]+StringValues.Components[exifData[tag][2]]+StringValues.Components[exifData[tag][3]]}tags[tag]=exifData[tag]}}if(tags.GPSInfoIFDPointer){gpsData=readTags(file,tiffOffset,tiffOffset+tags.GPSInfoIFDPointer,GPSTags,bigEnd);for(tag in gpsData){switch(tag){case"GPSVersionID":gpsData[tag]&&(gpsData[tag]=gpsData[tag][0]+"."+gpsData[tag][1]+"."+gpsData[tag][2]+"."+gpsData[tag][3])}tags[tag]=gpsData[tag]}}return tags.thumbnail=readThumbnailImage(file,tiffOffset,firstIFDOffset,bigEnd),tags}function findXMPinJPEG(file){if("DOMParser"in self){var dataView=new DataView(file);if(255!=dataView.getUint8(0)||216!=dataView.getUint8(1))return!1;for(var offset=2,length=file.byteLength,dom=new DOMParser;offset<length-4;){if("http"==getStringFromDB(dataView,offset,4)){var startOffset=offset-1,sectionLength=dataView.getUint16(offset-2)-1,xmpString=getStringFromDB(dataView,startOffset,sectionLength),xmpEndIndex=xmpString.indexOf("xmpmeta>")+8;xmpString=xmpString.substring(xmpString.indexOf("<x:xmpmeta"),xmpEndIndex);var indexOfXmp=xmpString.indexOf("x:xmpmeta")+10;xmpString=xmpString.slice(0,indexOfXmp)+'xmlns:Iptc4xmpCore="http://iptc.org/std/Iptc4xmpCore/1.0/xmlns/" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:tiff="http://ns.adobe.com/tiff/1.0/" xmlns:plus="http://schemas.android.com/apk/lib/com.google.android.gms.plus" xmlns:ext="http://www.gettyimages.com/xsltExtension/1.0" xmlns:exif="http://ns.adobe.com/exif/1.0/" xmlns:stEvt="http://ns.adobe.com/xap/1.0/sType/ResourceEvent#" xmlns:stRef="http://ns.adobe.com/xap/1.0/sType/ResourceRef#" xmlns:crs="http://ns.adobe.com/camera-raw-settings/1.0/" xmlns:xapGImg="http://ns.adobe.com/xap/1.0/g/img/" xmlns:Iptc4xmpExt="http://iptc.org/std/Iptc4xmpExt/2008-02-29/" '+xmpString.slice(indexOfXmp);return xml2Object(dom.parseFromString(xmpString,"text/xml"))}offset++}}}function xml2json(xml){var json={};if(1==xml.nodeType){if(xml.attributes.length>0){json["@attributes"]={};for(var j=0;j<xml.attributes.length;j++){var attribute=xml.attributes.item(j);json["@attributes"][attribute.nodeName]=attribute.nodeValue}}}else if(3==xml.nodeType)return xml.nodeValue;if(xml.hasChildNodes())for(var i=0;i<xml.childNodes.length;i++){var child=xml.childNodes.item(i),nodeName=child.nodeName;if(null==json[nodeName])json[nodeName]=xml2json(child);else{if(null==json[nodeName].push){var old=json[nodeName];json[nodeName]=[],json[nodeName].push(old)}json[nodeName].push(xml2json(child))}}return json}function xml2Object(xml){try{var obj={};if(xml.children.length>0)for(var i=0;i<xml.children.length;i++){var item=xml.children.item(i),attributes=item.attributes;for(var idx in attributes){var itemAtt=attributes[idx],dataKey=itemAtt.nodeName,dataValue=itemAtt.nodeValue;void 0!==dataKey&&(obj[dataKey]=dataValue)}var nodeName=item.nodeName;if(void 0===obj[nodeName])obj[nodeName]=xml2json(item);else{if(void 0===obj[nodeName].push){var old=obj[nodeName];obj[nodeName]=[],obj[nodeName].push(old)}obj[nodeName].push(xml2json(item))}}else obj=xml.textContent;return obj}catch(e){}}var root=this,EXIF=function(obj){return obj instanceof EXIF?obj:this instanceof EXIF?void(this.EXIFwrapped=obj):new EXIF(obj)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=EXIF),exports.EXIF=EXIF):root.EXIF=EXIF;var ExifTags=EXIF.Tags={36864:"ExifVersion",40960:"FlashpixVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37500:"MakerNote",37510:"UserComment",40964:"RelatedSoundFile",36867:"DateTimeOriginal",36868:"DateTimeDigitized",37520:"SubsecTime",37521:"SubsecTimeOriginal",37522:"SubsecTimeDigitized",33434:"ExposureTime",33437:"FNumber",34850:"ExposureProgram",34852:"SpectralSensitivity",34855:"ISOSpeedRatings",34856:"OECF",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureBias",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37396:"SubjectArea",37386:"FocalLength",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41492:"SubjectLocation",41493:"ExposureIndex",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRation",41989:"FocalLengthIn35mmFilm",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",40965:"InteroperabilityIFDPointer",42016:"ImageUniqueID"},TiffTags=EXIF.TiffTags={256:"ImageWidth",257:"ImageHeight",34665:"ExifIFDPointer",34853:"GPSInfoIFDPointer",40965:"InteroperabilityIFDPointer",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",274:"Orientation",277:"SamplesPerPixel",284:"PlanarConfiguration",530:"YCbCrSubSampling",531:"YCbCrPositioning",282:"XResolution",283:"YResolution",296:"ResolutionUnit",273:"StripOffsets",278:"RowsPerStrip",279:"StripByteCounts",513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength",301:"TransferFunction",318:"WhitePoint",319:"PrimaryChromaticities",529:"YCbCrCoefficients",532:"ReferenceBlackWhite",306:"DateTime",270:"ImageDescription",271:"Make",272:"Model",305:"Software",315:"Artist",33432:"Copyright"},GPSTags=EXIF.GPSTags={0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential"},IFD1Tags=EXIF.IFD1Tags={256:"ImageWidth",257:"ImageHeight",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",273:"StripOffsets",274:"Orientation",277:"SamplesPerPixel",278:"RowsPerStrip",279:"StripByteCounts",282:"XResolution",283:"YResolution",284:"PlanarConfiguration",296:"ResolutionUnit",513:"JpegIFOffset",514:"JpegIFByteCount",529:"YCbCrCoefficients",530:"YCbCrSubSampling",531:"YCbCrPositioning",532:"ReferenceBlackWhite"},StringValues=EXIF.StringValues={ExposureProgram:{0:"Not defined",1:"Manual",2:"Normal program",3:"Aperture priority",4:"Shutter priority",5:"Creative program",6:"Action program",7:"Portrait mode",8:"Landscape mode"},MeteringMode:{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{0:"Unknown",1:"Daylight",2:"Fluorescent",3:"Tungsten (incandescent light)",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 - 5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{0:"Flash did not fire",1:"Flash fired",5:"Strobe return light not detected",7:"Strobe return light detected",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},SensingMethod:{1:"Not defined",2:"One-chip color area sensor",3:"Two-chip color area sensor",4:"Three-chip color area sensor",5:"Color sequential area sensor",7:"Trilinear sensor",8:"Color sequential linear sensor"},SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},SceneType:{1:"Directly photographed"},CustomRendered:{0:"Normal process",1:"Custom process"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},GainControl:{0:"None",1:"Low gain up",2:"High gain up",3:"Low gain down",4:"High gain down"},Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{0:"Normal",1:"Soft",2:"Hard"},SubjectDistanceRange:{0:"Unknown",1:"Macro",2:"Close view",3:"Distant view"},FileSource:{3:"DSC"},Components:{0:"",1:"Y",2:"Cb",3:"Cr",4:"R",5:"G",6:"B"}},IptcFieldMap={120:"caption",110:"credit",25:"keywords",55:"dateCreated",80:"byline",85:"bylineTitle",122:"captionWriter",105:"headline",116:"copyright",15:"category"};EXIF.enableXmp=function(){EXIF.isXmpEnabled=!0},EXIF.disableXmp=function(){EXIF.isXmpEnabled=!1},EXIF.getData=function(img,callback){return!((self.Image&&img instanceof self.Image||self.HTMLImageElement&&img instanceof self.HTMLImageElement)&&!img.complete)&&(imageHasData(img)?callback&&callback.call(img):getImageData(img,callback),!0)},EXIF.getTag=function(img,tag){if(imageHasData(img))return img.exifdata[tag]},EXIF.getIptcTag=function(img,tag){if(imageHasData(img))return img.iptcdata[tag]},EXIF.getAllTags=function(img){if(!imageHasData(img))return{};var a,data=img.exifdata,tags={};for(a in data)data.hasOwnProperty(a)&&(tags[a]=data[a]);return tags},EXIF.getAllIptcTags=function(img){if(!imageHasData(img))return{};var a,data=img.iptcdata,tags={};for(a in data)data.hasOwnProperty(a)&&(tags[a]=data[a]);return tags},EXIF.pretty=function(img){if(!imageHasData(img))return"";var a,data=img.exifdata,strPretty="";for(a in data)data.hasOwnProperty(a)&&("object"==typeof data[a]?data[a]instanceof Number?strPretty+=a+" : "+data[a]+" ["+data[a].numerator+"/"+data[a].denominator+"]\r\n":strPretty+=a+" : ["+data[a].length+" values]\r\n":strPretty+=a+" : "+data[a]+"\r\n");return strPretty},EXIF.readFromBinaryFile=function(file){return findEXIFinJPEG(file)},"function"==typeof define&&define.amd&&define("exif-js",[],function(){return EXIF})}.call(this),function(a){var b,c,d="0.4.2",e="hasOwnProperty",f=/[\.\/]/,h=function(){},i=function(a,b){return a-b},j={n:{}},k=function(a,d){a=String(a);var e,f=c,g=Array.prototype.slice.call(arguments,2),h=k.listeners(a),j=0,l=[],m={},n=[],o=b;b=a,c=0;for(var p=0,q=h.length;q>p;p++)"zIndex"in h[p]&&(l.push(h[p].zIndex),h[p].zIndex<0&&(m[h[p].zIndex]=h[p]));for(l.sort(i);l[j]<0;)if(e=m[l[j++]],n.push(e.apply(d,g)),c)return c=f,n;for(p=0;q>p;p++)if("zIndex"in(e=h[p]))if(e.zIndex==l[j]){if(n.push(e.apply(d,g)),c)break;do{if(j++,e=m[l[j]],e&&n.push(e.apply(d,g)),c)break}while(e)}else m[e.zIndex]=e;else if(n.push(e.apply(d,g)),c)break;return c=f,b=o,n.length?n:null};k._events=j,k.listeners=function(a){var b,c,d,e,h,i,k,l,m=a.split(f),n=j,o=[n],p=[];for(e=0,h=m.length;h>e;e++){for(l=[],i=0,k=o.length;k>i;i++)for(n=o[i].n,c=[n[m[e]],n["*"]],d=2;d--;)(b=c[d])&&(l.push(b),p=p.concat(b.f||[]))
;o=l}return p},k.on=function(a,b){if(a=String(a),"function"!=typeof b)return function(){};for(var c=a.split(f),d=j,e=0,g=c.length;g>e;e++)d=d.n,d=d.hasOwnProperty(c[e])&&d[c[e]]||(d[c[e]]={n:{}});for(d.f=d.f||[],e=0,g=d.f.length;g>e;e++)if(d.f[e]==b)return h;return d.f.push(b),function(a){+a==+a&&(b.zIndex=+a)}},k.f=function(a){var b=[].slice.call(arguments,1);return function(){k.apply(null,[a,null].concat(b).concat([].slice.call(arguments,0)))}},k.stop=function(){c=1},k.nt=function(a){return a?new RegExp("(?:\\.|\\/|^)"+a+"(?:\\.|\\/|$)").test(b):b},k.nts=function(){return b.split(f)},k.off=k.unbind=function(a,b){if(!a)return void(k._events=j={n:{}});var c,d,h,i,l,m,n,o=a.split(f),p=[j];for(i=0,l=o.length;l>i;i++)for(m=0;m<p.length;m+=h.length-2){if(h=[m,1],c=p[m].n,"*"!=o[i])c[o[i]]&&h.push(c[o[i]]);else for(d in c)c[e](d)&&h.push(c[d]);p.splice.apply(p,h)}for(i=0,l=p.length;l>i;i++)for(c=p[i];c.n;){if(b){if(c.f){for(m=0,n=c.f.length;n>m;m++)if(c.f[m]==b){c.f.splice(m,1);break}!c.f.length&&delete c.f}for(d in c.n)if(c.n[e](d)&&c.n[d].f){var q=c.n[d].f;for(m=0,n=q.length;n>m;m++)if(q[m]==b){q.splice(m,1);break}!q.length&&delete c.n[d].f}}else{delete c.f;for(d in c.n)c.n[e](d)&&c.n[d].f&&delete c.n[d].f}c=c.n}},k.once=function(a,b){var c=function(){return k.unbind(a,c),b.apply(this,arguments)};return k.on(a,c)},k.version=d,k.toString=function(){return"You are running Eve "+d},"undefined"!=typeof module&&module.exports?module.exports=k:"undefined"!=typeof define?define("eve",[],function(){return k}):a.eve=k}(window||this),function(a,b){"function"==typeof define&&define.amd?define(["eve"],function(c){return b(a,c)}):b(a,a.eve)}(this,function(a,b){function c(a){if(c.is(a,"function"))return u?a():b.on("raphael.DOMload",a);if(c.is(a,V))return c._engine.create[D](c,a.splice(0,3+c.is(a[0],T))).add(a);var d=Array.prototype.slice.call(arguments,0);if(c.is(d[d.length-1],"function")){var e=d.pop();return u?e.call(c._engine.create[D](c,d)):b.on("raphael.DOMload",function(){e.call(c._engine.create[D](c,d))})}return c._engine.create[D](c,arguments)}function d(a){if("function"==typeof a||Object(a)!==a)return a;var b=new a.constructor;for(var c in a)a[z](c)&&(b[c]=d(a[c]));return b}function e(a,b){for(var c=0,d=a.length;d>c;c++)if(a[c]===b)return a.push(a.splice(c,1)[0])}function f(a,b,c){function d(){var f=Array.prototype.slice.call(arguments,0),g=f.join("␀"),h=d.cache=d.cache||{},i=d.count=d.count||[];return h[z](g)?(e(i,g),c?c(h[g]):h[g]):(i.length>=1e3&&delete h[i.shift()],i.push(g),h[g]=a[D](b,f),c?c(h[g]):h[g])}return d}function g(){return this.hex}function h(a,b){for(var c=[],d=0,e=a.length;e-2*!b>d;d+=2){var f=[{x:+a[d-2],y:+a[d-1]},{x:+a[d],y:+a[d+1]},{x:+a[d+2],y:+a[d+3]},{x:+a[d+4],y:+a[d+5]}];b?d?e-4==d?f[3]={x:+a[0],y:+a[1]}:e-2==d&&(f[2]={x:+a[0],y:+a[1]},f[3]={x:+a[2],y:+a[3]}):f[0]={x:+a[e-2],y:+a[e-1]}:e-4==d?f[3]=f[2]:d||(f[0]={x:+a[d],y:+a[d+1]}),c.push(["C",(-f[0].x+6*f[1].x+f[2].x)/6,(-f[0].y+6*f[1].y+f[2].y)/6,(f[1].x+6*f[2].x-f[3].x)/6,(f[1].y+6*f[2].y-f[3].y)/6,f[2].x,f[2].y])}return c}function i(a,b,c,d,e){return a*(a*(-3*b+9*c-9*d+3*e)+6*b-12*c+6*d)-3*b+3*c}function j(a,b,c,d,e,f,g,h,j){null==j&&(j=1),j=j>1?1:0>j?0:j;for(var k=j/2,m=[-.1252,.1252,-.3678,.3678,-.5873,.5873,-.7699,.7699,-.9041,.9041,-.9816,.9816],n=[.2491,.2491,.2335,.2335,.2032,.2032,.1601,.1601,.1069,.1069,.0472,.0472],o=0,p=0;12>p;p++){var q=k*m[p]+k,r=i(q,a,c,e,g),s=i(q,b,d,f,h),t=r*r+s*s;o+=n[p]*N.sqrt(t)}return k*o}function k(a,b,c,d,e,f,g,h,i){if(!(0>i||j(a,b,c,d,e,f,g,h)<i)){var k,m=.5,n=1-m;for(k=j(a,b,c,d,e,f,g,h,n);Q(k-i)>.01;)m/=2,n+=(i>k?1:-1)*m,k=j(a,b,c,d,e,f,g,h,n);return n}}function l(a,b,c,d,e,f,g,h){if(!(O(a,c)<P(e,g)||P(a,c)>O(e,g)||O(b,d)<P(f,h)||P(b,d)>O(f,h))){var i=(a*d-b*c)*(e-g)-(a-c)*(e*h-f*g),j=(a*d-b*c)*(f-h)-(b-d)*(e*h-f*g),k=(a-c)*(f-h)-(b-d)*(e-g);if(k){var l=i/k,m=j/k,n=+l.toFixed(2),o=+m.toFixed(2);if(!(n<+P(a,c).toFixed(2)||n>+O(a,c).toFixed(2)||n<+P(e,g).toFixed(2)||n>+O(e,g).toFixed(2)||o<+P(b,d).toFixed(2)||o>+O(b,d).toFixed(2)||o<+P(f,h).toFixed(2)||o>+O(f,h).toFixed(2)))return{x:l,y:m}}}}function m(a,b,d){var e=c.bezierBBox(a),f=c.bezierBBox(b);if(!c.isBBoxIntersect(e,f))return d?0:[];for(var g=j.apply(0,a),h=j.apply(0,b),i=O(~~(g/5),1),k=O(~~(h/5),1),m=[],n=[],o={},p=d?0:[],q=0;i+1>q;q++){var r=c.findDotsAtSegment.apply(c,a.concat(q/i));m.push({x:r.x,y:r.y,t:q/i})}for(q=0;k+1>q;q++)r=c.findDotsAtSegment.apply(c,b.concat(q/k)),n.push({x:r.x,y:r.y,t:q/k});for(q=0;i>q;q++)for(var s=0;k>s;s++){var t=m[q],u=m[q+1],v=n[s],w=n[s+1],x=Q(u.x-t.x)<.001?"y":"x",y=Q(w.x-v.x)<.001?"y":"x",z=l(t.x,t.y,u.x,u.y,v.x,v.y,w.x,w.y);if(z){if(o[z.x.toFixed(4)]==z.y.toFixed(4))continue;o[z.x.toFixed(4)]=z.y.toFixed(4);var A=t.t+Q((z[x]-t[x])/(u[x]-t[x]))*(u.t-t.t),B=v.t+Q((z[y]-v[y])/(w[y]-v[y]))*(w.t-v.t);A>=0&&1.001>=A&&B>=0&&1.001>=B&&(d?p++:p.push({x:z.x,y:z.y,t1:P(A,1),t2:P(B,1)}))}}return p}function n(a,b,d){a=c._path2curve(a),b=c._path2curve(b);for(var e,f,g,h,i,j,k,l,n,o,p=d?0:[],q=0,r=a.length;r>q;q++){var s=a[q];if("M"==s[0])e=i=s[1],f=j=s[2];else{"C"==s[0]?(n=[e,f].concat(s.slice(1)),e=n[6],f=n[7]):(n=[e,f,e,f,i,j,i,j],e=i,f=j);for(var t=0,u=b.length;u>t;t++){var v=b[t];if("M"==v[0])g=k=v[1],h=l=v[2];else{"C"==v[0]?(o=[g,h].concat(v.slice(1)),g=o[6],h=o[7]):(o=[g,h,g,h,k,l,k,l],g=k,h=l);var w=m(n,o,d);if(d)p+=w;else{for(var x=0,y=w.length;y>x;x++)w[x].segment1=q,w[x].segment2=t,w[x].bez1=n,w[x].bez2=o;p=p.concat(w)}}}}}return p}function o(a,b,c,d,e,f){null!=a?(this.a=+a,this.b=+b,this.c=+c,this.d=+d,this.e=+e,this.f=+f):(this.a=1,this.b=0,this.c=0,this.d=1,this.e=0,this.f=0)}function p(){return this.x+H+this.y+H+this.width+" × "+this.height}function q(a,b,c,d,e,f){function g(a){return((l*a+k)*a+j)*a}function i(a,b){var c,d,e,f,h,i;for(e=a,i=0;8>i;i++){if(f=g(e)-a,Q(f)<b)return e;if(h=(3*l*e+2*k)*e+j,Q(h)<1e-6)break;e-=f/h}if(c=0,d=1,e=a,c>e)return c;if(e>d)return d;for(;d>c;){if(f=g(e),Q(f-a)<b)return e;a>f?c=e:d=e,e=(d-c)/2+c}return e}var j=3*b,k=3*(d-b)-j,l=1-j-k,m=3*c,n=3*(e-c)-m,o=1-m-n;return function(a,b){var c=i(a,b);return((o*c+n)*c+m)*c}(a,1/(200*f))}function r(a,b){var c=[],d={};if(this.ms=b,this.times=1,a){for(var e in a)a[z](e)&&(d[_(e)]=a[e],c.push(_(e)));c.sort(lb)}this.anim=d,this.top=c[c.length-1],this.percents=c}function s(a,d,e,f,g,h){e=_(e);var i,j,k,l,m,n,p=a.ms,r={},s={},t={};if(f)for(v=0,x=ic.length;x>v;v++){var u=ic[v];if(u.el.id==d.id&&u.anim==a){u.percent!=e?(ic.splice(v,1),k=1):j=u,d.attr(u.totalOrigin);break}}else f=+s;for(var v=0,x=a.percents.length;x>v;v++){if(a.percents[v]==e||a.percents[v]>f*a.top){e=a.percents[v],m=a.percents[v-1]||0,p=p/a.top*(e-m),l=a.percents[v+1],i=a.anim[e];break}f&&d.attr(a.anim[a.percents[v]])}if(i){if(j)j.initstatus=f,j.start=new Date-j.ms*f;else{for(var y in i)if(i[z](y)&&(db[z](y)||d.paper.customAttributes[z](y)))switch(r[y]=d.attr(y),null==r[y]&&(r[y]=cb[y]),s[y]=i[y],db[y]){case T:t[y]=(s[y]-r[y])/p;break;case"colour":r[y]=c.getRGB(r[y]);var A=c.getRGB(s[y]);t[y]={r:(A.r-r[y].r)/p,g:(A.g-r[y].g)/p,b:(A.b-r[y].b)/p};break;case"path":var B=Kb(r[y],s[y]),C=B[1];for(r[y]=B[0],t[y]=[],v=0,x=r[y].length;x>v;v++){t[y][v]=[0];for(var D=1,F=r[y][v].length;F>D;D++)t[y][v][D]=(C[v][D]-r[y][v][D])/p}break;case"transform":var G=d._,H=Pb(G[y],s[y]);if(H)for(r[y]=H.from,s[y]=H.to,t[y]=[],t[y].real=!0,v=0,x=r[y].length;x>v;v++)for(t[y][v]=[r[y][v][0]],D=1,F=r[y][v].length;F>D;D++)t[y][v][D]=(s[y][v][D]-r[y][v][D])/p;else{var K=d.matrix||new o,L={_:{transform:G.transform},getBBox:function(){return d.getBBox(1)}};r[y]=[K.a,K.b,K.c,K.d,K.e,K.f],Nb(L,s[y]),s[y]=L._.transform,t[y]=[(L.matrix.a-K.a)/p,(L.matrix.b-K.b)/p,(L.matrix.c-K.c)/p,(L.matrix.d-K.d)/p,(L.matrix.e-K.e)/p,(L.matrix.f-K.f)/p]}break;case"csv":var M=I(i[y])[J](w),N=I(r[y])[J](w);if("clip-rect"==y)for(r[y]=N,t[y]=[],v=N.length;v--;)t[y][v]=(M[v]-r[y][v])/p;s[y]=M;break;default:for(M=[][E](i[y]),N=[][E](r[y]),t[y]=[],v=d.paper.customAttributes[y].length;v--;)t[y][v]=((M[v]||0)-(N[v]||0))/p}var O=i.easing,P=c.easing_formulas[O];if(!P)if((P=I(O).match(Z))&&5==P.length){var Q=P;P=function(a){return q(a,+Q[1],+Q[2],+Q[3],+Q[4],p)}}else P=nb;if(n=i.start||a.start||+new Date,u={anim:a,percent:e,timestamp:n,start:n+(a.del||0),status:0,initstatus:f||0,stop:!1,ms:p,easing:P,from:r,diff:t,to:s,el:d,callback:i.callback,prev:m,next:l,repeat:h||a.times,origin:d.attr(),totalOrigin:g},ic.push(u),f&&!j&&!k&&(u.stop=!0,u.start=new Date-p*f,1==ic.length))return kc();k&&(u.start=new Date-u.ms*f),1==ic.length&&jc(kc)}b("raphael.anim.start."+d.id,d,a)}}function t(a){for(var b=0;b<ic.length;b++)ic[b].el.paper==a&&ic.splice(b--,1)}c.version="2.1.2",c.eve=b;var u,v,w=/[, ]+/,x={circle:1,rect:1,path:1,ellipse:1,text:1,image:1},y=/\{(\d+)\}/g,z="hasOwnProperty",A={doc:document,win:a},B={was:Object.prototype[z].call(A.win,"Raphael"),is:A.win.Raphael},C=function(){this.ca=this.customAttributes={}},D="apply",E="concat",F="ontouchstart"in A.win||A.win.DocumentTouch&&A.doc instanceof DocumentTouch,G="",H=" ",I=String,J="split",K="click dblclick mousedown mousemove mouseout mouseover mouseup touchstart touchmove touchend touchcancel"[J](H),L={mousedown:"touchstart",mousemove:"touchmove",mouseup:"touchend"},M=I.prototype.toLowerCase,N=Math,O=N.max,P=N.min,Q=N.abs,R=N.pow,S=N.PI,T="number",U="string",V="array",W=Object.prototype.toString,X=(c._ISURL=/^url\(['"]?([^\)]+?)['"]?\)$/i,/^\s*((#[a-f\d]{6})|(#[a-f\d]{3})|rgba?\(\s*([\d\.]+%?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+%?(?:\s*,\s*[\d\.]+%?)?)\s*\)|hsba?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+(?:%?\s*,\s*[\d\.]+)?)%?\s*\)|hsla?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+(?:%?\s*,\s*[\d\.]+)?)%?\s*\))\s*$/i),Y={NaN:1,Infinity:1,"-Infinity":1},Z=/^(?:cubic-)?bezier\(([^,]+),([^,]+),([^,]+),([^\)]+)\)/,$=N.round,_=parseFloat,ab=parseInt,bb=I.prototype.toUpperCase,cb=c._availableAttrs={"arrow-end":"none","arrow-start":"none",blur:0,"clip-rect":"0 0 1e9 1e9",cursor:"default",cx:0,cy:0,fill:"#fff","fill-opacity":1,font:'10px "Arial"',"font-family":'"Arial"',"font-size":"10","font-style":"normal","font-weight":400,gradient:0,height:0,href:"http://raphaeljs.com/","letter-spacing":0,opacity:1,path:"M0,0",r:0,rx:0,ry:0,src:"",stroke:"#000","stroke-dasharray":"","stroke-linecap":"butt","stroke-linejoin":"butt","stroke-miterlimit":0,"stroke-opacity":1,"stroke-width":1,target:"_blank","text-anchor":"middle",title:"Raphael",transform:"",width:0,x:0,y:0},db=c._availableAnimAttrs={blur:T,"clip-rect":"csv",cx:T,cy:T,fill:"colour","fill-opacity":T,"font-size":T,height:T,opacity:T,path:"path",r:T,rx:T,ry:T,stroke:"colour","stroke-opacity":T,"stroke-width":T,transform:"transform",width:T,x:T,y:T},eb=/[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*/,fb={hs:1,rg:1},gb=/,?([achlmqrstvxz]),?/gi,hb=/([achlmrqstvz])[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029,]*((-?\d*\.?\d*(?:e[\-+]?\d+)?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*)+)/gi,ib=/([rstm])[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029,]*((-?\d*\.?\d*(?:e[\-+]?\d+)?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*)+)/gi,jb=/(-?\d*\.?\d*(?:e[\-+]?\d+)?)[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*/gi,kb=(c._radial_gradient=/^r(?:\(([^,]+?)[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*([^\)]+?)\))?/,{}),lb=function(a,b){return _(a)-_(b)},mb=function(){},nb=function(a){return a},ob=c._rectPath=function(a,b,c,d,e){return e?[["M",a+e,b],["l",c-2*e,0],["a",e,e,0,0,1,e,e],["l",0,d-2*e],["a",e,e,0,0,1,-e,e],["l",2*e-c,0],["a",e,e,0,0,1,-e,-e],["l",0,2*e-d],["a",e,e,0,0,1,e,-e],["z"]]:[["M",a,b],["l",c,0],["l",0,d],["l",-c,0],["z"]]},pb=function(a,b,c,d){return null==d&&(d=c),[["M",a,b],["m",0,-d],["a",c,d,0,1,1,0,2*d],["a",c,d,0,1,1,0,-2*d],["z"]]},qb=c._getPath={path:function(a){return a.attr("path")},circle:function(a){var b=a.attrs;return pb(b.cx,b.cy,b.r)},ellipse:function(a){var b=a.attrs;return pb(b.cx,b.cy,b.rx,b.ry)},rect:function(a){var b=a.attrs;return ob(b.x,b.y,b.width,b.height,b.r)},image:function(a){var b=a.attrs;return ob(b.x,b.y,b.width,b.height)},text:function(a){var b=a._getBBox();return ob(b.x,b.y,b.width,b.height)},set:function(a){var b=a._getBBox();return ob(b.x,b.y,b.width,b.height)}},rb=c.mapPath=function(a,b){if(!b)return a;var c,d,e,f,g,h,i;for(a=Kb(a),e=0,g=a.length;g>e;e++)for(i=a[e],f=1,h=i.length;h>f;f+=2)c=b.x(i[f],i[f+1]),d=b.y(i[f],i[f+1]),i[f]=c,i[f+1]=d;return a};if(c._g=A,c.type=A.win.SVGAngle||A.doc.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1")?"SVG":"VML","VML"==c.type){var sb,tb=A.doc.createElement("div");if(tb.innerHTML='<v:shape adj="1"/>',sb=tb.firstChild,sb.style.behavior="url(#default#VML)",!sb||"object"!=typeof sb.adj)return c.type=G;tb=null}c.svg=!(c.vml="VML"==c.type),c._Paper=C,c.fn=v=C.prototype=c.prototype,c._id=0,c._oid=0,c.is=function(a,b){return b=M.call(b),"finite"==b?!Y[z](+a):"array"==b?a instanceof Array:"null"==b&&null===a||b==typeof a&&null!==a||"object"==b&&a===Object(a)||"array"==b&&Array.isArray&&Array.isArray(a)||W.call(a).slice(8,-1).toLowerCase()==b},c.angle=function(a,b,d,e,f,g){if(null==f){var h=a-d,i=b-e;return h||i?(180+180*N.atan2(-i,-h)/S+360)%360:0}return c.angle(a,b,f,g)-c.angle(d,e,f,g)},c.rad=function(a){return a%360*S/180},c.deg=function(a){return 180*a/S%360},c.snapTo=function(a,b,d){if(d=c.is(d,"finite")?d:10,c.is(a,V)){for(var e=a.length;e--;)if(Q(a[e]-b)<=d)return a[e]}else{a=+a;var f=b%a;if(d>f)return b-f;if(f>a-d)return b-f+a}return b},c.createUUID=function(a,b){return function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(a,b).toUpperCase()}}(/[xy]/g,function(a){var b=16*N.random()|0;return("x"==a?b:3&b|8).toString(16)}),c.setWindow=function(a){b("raphael.setWindow",c,A.win,a),A.win=a,A.doc=A.win.document,c._engine.initWin&&c._engine.initWin(A.win)};var ub=function(a){if(c.vml){var b,d=/^\s+|\s+$/g;try{var e=new ActiveXObject("htmlfile");e.write("<body>"),e.close(),b=e.body}catch(g){b=createPopup().document.body}var h=b.createTextRange();ub=f(function(a){try{b.style.color=I(a).replace(d,G);var c=h.queryCommandValue("ForeColor");return c=(255&c)<<16|65280&c|(16711680&c)>>>16,"#"+("000000"+c.toString(16)).slice(-6)}catch(e){return"none"}})}else{var i=A.doc.createElement("i");i.title="Raphaël Colour Picker",i.style.display="none",A.doc.body.appendChild(i),ub=f(function(a){return i.style.color=a,A.doc.defaultView.getComputedStyle(i,G).getPropertyValue("color")})}return ub(a)},vb=function(){return"hsb("+[this.h,this.s,this.b]+")"},wb=function(){return"hsl("+[this.h,this.s,this.l]+")"},xb=function(){return this.hex},yb=function(a,b,d){if(null==b&&c.is(a,"object")&&"r"in a&&"g"in a&&"b"in a&&(d=a.b,b=a.g,a=a.r),null==b&&c.is(a,U)){var e=c.getRGB(a);a=e.r,b=e.g,d=e.b}return(a>1||b>1||d>1)&&(a/=255,b/=255,d/=255),[a,b,d]},zb=function(a,b,d,e){a*=255,b*=255,d*=255;var f={r:a,g:b,b:d,hex:c.rgb(a,b,d),toString:xb};return c.is(e,"finite")&&(f.opacity=e),f};c.color=function(a){var b;return c.is(a,"object")&&"h"in a&&"s"in a&&"b"in a?(b=c.hsb2rgb(a),a.r=b.r,a.g=b.g,a.b=b.b,a.hex=b.hex):c.is(a,"object")&&"h"in a&&"s"in a&&"l"in a?(b=c.hsl2rgb(a),a.r=b.r,a.g=b.g,a.b=b.b,a.hex=b.hex):(c.is(a,"string")&&(a=c.getRGB(a)),c.is(a,"object")&&"r"in a&&"g"in a&&"b"in a?(b=c.rgb2hsl(a),a.h=b.h,a.s=b.s,a.l=b.l,b=c.rgb2hsb(a),a.v=b.b):(a={hex:"none"},a.r=a.g=a.b=a.h=a.s=a.v=a.l=-1)),a.toString=xb,a},c.hsb2rgb=function(a,b,c,d){this.is(a,"object")&&"h"in a&&"s"in a&&"b"in a&&(c=a.b,b=a.s,a=a.h,d=a.o),a*=360;var e,f,g,h,i;return a=a%360/60,i=c*b,h=i*(1-Q(a%2-1)),e=f=g=c-i,a=~~a,e+=[i,h,0,0,h,i][a],f+=[h,i,i,h,0,0][a],g+=[0,0,h,i,i,h][a],zb(e,f,g,d)},c.hsl2rgb=function(a,b,c,d){this.is(a,"object")&&"h"in a&&"s"in a&&"l"in a&&(c=a.l,b=a.s,a=a.h),(a>1||b>1||c>1)&&(a/=360,b/=100,c/=100),a*=360;var e,f,g,h,i;return a=a%360/60,i=2*b*(.5>c?c:1-c),h=i*(1-Q(a%2-1)),e=f=g=c-i/2,a=~~a,e+=[i,h,0,0,h,i][a],f+=[h,i,i,h,0,0][a],g+=[0,0,h,i,i,h][a],zb(e,f,g,d)},c.rgb2hsb=function(a,b,c){c=yb(a,b,c),a=c[0],b=c[1],c=c[2];var d,e,f,g;return f=O(a,b,c),g=f-P(a,b,c),d=0==g?null:f==a?(b-c)/g:f==b?(c-a)/g+2:(a-b)/g+4,d=(d+360)%6*60/360,e=0==g?0:g/f,{h:d,s:e,b:f,toString:vb}},c.rgb2hsl=function(a,b,c){c=yb(a,b,c),a=c[0],b=c[1],c=c[2];var d,e,f,g,h,i;return g=O(a,b,c),h=P(a,b,c),i=g-h,d=0==i?null:g==a?(b-c)/i:g==b?(c-a)/i+2:(a-b)/i+4,d=(d+360)%6*60/360,f=(g+h)/2,e=0==i?0:.5>f?i/(2*f):i/(2-2*f),{h:d,s:e,l:f,toString:wb}},c._path2string=function(){return this.join(",").replace(gb,"$1")},c._preload=function(a,b){var c=A.doc.createElement("img");c.style.cssText="position:absolute;left:-9999em;top:-9999em",c.onload=function(){b.call(this),this.onload=null,A.doc.body.removeChild(this)},c.onerror=function(){A.doc.body.removeChild(this)},A.doc.body.appendChild(c),c.src=a},c.getRGB=f(function(a){if(!a||(a=I(a)).indexOf("-")+1)return{r:-1,g:-1,b:-1,hex:"none",error:1,toString:g};if("none"==a)return{r:-1,g:-1,b:-1,hex:"none",toString:g};!(fb[z](a.toLowerCase().substring(0,2))||"#"==a.charAt())&&(a=ub(a));var b,d,e,f,h,i,j=a.match(X);return j?(j[2]&&(e=ab(j[2].substring(5),16),d=ab(j[2].substring(3,5),16),b=ab(j[2].substring(1,3),16)),j[3]&&(e=ab((h=j[3].charAt(3))+h,16),d=ab((h=j[3].charAt(2))+h,16),b=ab((h=j[3].charAt(1))+h,16)),j[4]&&(i=j[4][J](eb),b=_(i[0]),"%"==i[0].slice(-1)&&(b*=2.55),d=_(i[1]),"%"==i[1].slice(-1)&&(d*=2.55),e=_(i[2]),"%"==i[2].slice(-1)&&(e*=2.55),"rgba"==j[1].toLowerCase().slice(0,4)&&(f=_(i[3])),i[3]&&"%"==i[3].slice(-1)&&(f/=100)),j[5]?(i=j[5][J](eb),b=_(i[0]),"%"==i[0].slice(-1)&&(b*=2.55),d=_(i[1]),"%"==i[1].slice(-1)&&(d*=2.55),e=_(i[2]),"%"==i[2].slice(-1)&&(e*=2.55),("deg"==i[0].slice(-3)||"°"==i[0].slice(-1))&&(b/=360),"hsba"==j[1].toLowerCase().slice(0,4)&&(f=_(i[3])),i[3]&&"%"==i[3].slice(-1)&&(f/=100),c.hsb2rgb(b,d,e,f)):j[6]?(i=j[6][J](eb),b=_(i[0]),"%"==i[0].slice(-1)&&(b*=2.55),d=_(i[1]),"%"==i[1].slice(-1)&&(d*=2.55),e=_(i[2]),"%"==i[2].slice(-1)&&(e*=2.55),("deg"==i[0].slice(-3)||"°"==i[0].slice(-1))&&(b/=360),"hsla"==j[1].toLowerCase().slice(0,4)&&(f=_(i[3])),i[3]&&"%"==i[3].slice(-1)&&(f/=100),c.hsl2rgb(b,d,e,f)):(j={r:b,g:d,b:e,toString:g},j.hex="#"+(16777216|e|d<<8|b<<16).toString(16).slice(1),c.is(f,"finite")&&(j.opacity=f),j)):{r:-1,g:-1,b:-1,hex:"none",error:1,toString:g}},c),c.hsb=f(function(a,b,d){return c.hsb2rgb(a,b,d).hex}),c.hsl=f(function(a,b,d){return c.hsl2rgb(a,b,d).hex}),c.rgb=f(function(a,b,c){return"#"+(16777216|c|b<<8|a<<16).toString(16).slice(1)}),c.getColor=function(a){var b=this.getColor.start=this.getColor.start||{h:0,s:1,b:a||.75},c=this.hsb2rgb(b.h,b.s,b.b);return b.h+=.075,b.h>1&&(b.h=0,b.s-=.2,b.s<=0&&(this.getColor.start={h:0,s:1,b:b.b})),c.hex},c.getColor.reset=function(){delete this.start},c.parsePathString=function(a){if(!a)return null;var b=Ab(a);if(b.arr)return Cb(b.arr);var d={a:7,c:6,h:1,l:2,m:2,r:4,q:4,s:4,t:2,v:1,z:0},e=[];return c.is(a,V)&&c.is(a[0],V)&&(e=Cb(a)),e.length||I(a).replace(hb,function(a,b,c){var f=[],g=b.toLowerCase();if(c.replace(jb,function(a,b){b&&f.push(+b)}),"m"==g&&f.length>2&&(e.push([b][E](f.splice(0,2))),g="l",b="m"==b?"l":"L"),"r"==g)e.push([b][E](f));else for(;f.length>=d[g]&&(e.push([b][E](f.splice(0,d[g]))),d[g]););}),e.toString=c._path2string,b.arr=Cb(e),e},c.parseTransformString=f(function(a){if(!a)return null;var b=[];return c.is(a,V)&&c.is(a[0],V)&&(b=Cb(a)),b.length||I(a).replace(ib,function(a,c,d){var e=[];M.call(c),d.replace(jb,function(a,b){b&&e.push(+b)}),b.push([c][E](e))}),b.toString=c._path2string,b});var Ab=function(a){var b=Ab.ps=Ab.ps||{};return b[a]?b[a].sleep=100:b[a]={sleep:100},setTimeout(function(){for(var c in b)b[z](c)&&c!=a&&!--b[c].sleep&&delete b[c]}),b[a]};c.findDotsAtSegment=function(a,b,c,d,e,f,g,h,i){var j=1-i,k=R(j,3),l=R(j,2),m=i*i,n=m*i,o=k*a+3*l*i*c+3*j*i*i*e+n*g,p=k*b+3*l*i*d+3*j*i*i*f+n*h,q=a+2*i*(c-a)+m*(e-2*c+a),r=b+2*i*(d-b)+m*(f-2*d+b),s=c+2*i*(e-c)+m*(g-2*e+c),t=d+2*i*(f-d)+m*(h-2*f+d),u=j*a+i*c,v=j*b+i*d,w=j*e+i*g,x=j*f+i*h,y=90-180*N.atan2(q-s,r-t)/S;return(q>s||t>r)&&(y+=180),{x:o,y:p,m:{x:q,y:r},n:{x:s,y:t},start:{x:u,y:v},end:{x:w,y:x},alpha:y}},c.bezierBBox=function(a,b,d,e,f,g,h,i){c.is(a,"array")||(a=[a,b,d,e,f,g,h,i]);var j=Jb.apply(null,a);return{x:j.min.x,y:j.min.y,x2:j.max.x,y2:j.max.y,width:j.max.x-j.min.x,height:j.max.y-j.min.y}},c.isPointInsideBBox=function(a,b,c){return b>=a.x&&b<=a.x2&&c>=a.y&&c<=a.y2},c.isBBoxIntersect=function(a,b){var d=c.isPointInsideBBox;return d(b,a.x,a.y)||d(b,a.x2,a.y)||d(b,a.x,a.y2)||d(b,a.x2,a.y2)||d(a,b.x,b.y)||d(a,b.x2,b.y)||d(a,b.x,b.y2)||d(a,b.x2,b.y2)||(a.x<b.x2&&a.x>b.x||b.x<a.x2&&b.x>a.x)&&(a.y<b.y2&&a.y>b.y||b.y<a.y2&&b.y>a.y)},c.pathIntersection=function(a,b){return n(a,b)},c.pathIntersectionNumber=function(a,b){return n(a,b,1)},c.isPointInsidePath=function(a,b,d){var e=c.pathBBox(a);return c.isPointInsideBBox(e,b,d)&&n(a,[["M",b,d],["H",e.x2+10]],1)%2==1},c._removedFactory=function(a){return function(){b("raphael.log",null,"Raphaël: you are calling to method “"+a+"” of removed object",a)}};var Bb=c.pathBBox=function(a){var b=Ab(a);if(b.bbox)return d(b.bbox);if(!a)return{x:0,y:0,width:0,height:0,x2:0,y2:0};a=Kb(a);for(var c,e=0,f=0,g=[],h=[],i=0,j=a.length;j>i;i++)if(c=a[i],"M"==c[0])e=c[1],f=c[2],g.push(e),h.push(f);else{var k=Jb(e,f,c[1],c[2],c[3],c[4],c[5],c[6]);g=g[E](k.min.x,k.max.x),h=h[E](k.min.y,k.max.y),e=c[5],f=c[6]}var l=P[D](0,g),m=P[D](0,h),n=O[D](0,g),o=O[D](0,h),p=n-l,q=o-m,r={x:l,y:m,x2:n,y2:o,width:p,height:q,cx:l+p/2,cy:m+q/2};return b.bbox=d(r),r},Cb=function(a){var b=d(a);return b.toString=c._path2string,b},Db=c._pathToRelative=function(a){var b=Ab(a);if(b.rel)return Cb(b.rel);c.is(a,V)&&c.is(a&&a[0],V)||(a=c.parsePathString(a));var d=[],e=0,f=0,g=0,h=0,i=0;"M"==a[0][0]&&(e=a[0][1],f=a[0][2],g=e,h=f,i++,d.push(["M",e,f]));for(var j=i,k=a.length;k>j;j++){var l=d[j]=[],m=a[j];if(m[0]!=M.call(m[0]))switch(l[0]=M.call(m[0]),l[0]){case"a":l[1]=m[1],l[2]=m[2],l[3]=m[3],l[4]=m[4],l[5]=m[5],l[6]=+(m[6]-e).toFixed(3),l[7]=+(m[7]-f).toFixed(3);break;case"v":l[1]=+(m[1]-f).toFixed(3);break;case"m":g=m[1],h=m[2];default:for(var n=1,o=m.length;o>n;n++)l[n]=+(m[n]-(n%2?e:f)).toFixed(3)}else{l=d[j]=[],"m"==m[0]&&(g=m[1]+e,h=m[2]+f);for(var p=0,q=m.length;q>p;p++)d[j][p]=m[p]}var r=d[j].length;switch(d[j][0]){case"z":e=g,f=h;break;case"h":e+=+d[j][r-1];break;case"v":f+=+d[j][r-1];break;default:e+=+d[j][r-2],f+=+d[j][r-1]}}return d.toString=c._path2string,b.rel=Cb(d),d},Eb=c._pathToAbsolute=function(a){var b=Ab(a);if(b.abs)return Cb(b.abs);if(c.is(a,V)&&c.is(a&&a[0],V)||(a=c.parsePathString(a)),!a||!a.length)return[["M",0,0]];var d=[],e=0,f=0,g=0,i=0,j=0;"M"==a[0][0]&&(e=+a[0][1],f=+a[0][2],g=e,i=f,j++,d[0]=["M",e,f]);for(var k,l,m=3==a.length&&"M"==a[0][0]&&"R"==a[1][0].toUpperCase()&&"Z"==a[2][0].toUpperCase(),n=j,o=a.length;o>n;n++){if(d.push(k=[]),l=a[n],l[0]!=bb.call(l[0]))switch(k[0]=bb.call(l[0]),k[0]){case"A":k[1]=l[1],k[2]=l[2],k[3]=l[3],k[4]=l[4],k[5]=l[5],k[6]=+(l[6]+e),k[7]=+(l[7]+f);break;case"V":k[1]=+l[1]+f;break;case"H":k[1]=+l[1]+e;break;case"R":for(var p=[e,f][E](l.slice(1)),q=2,r=p.length;r>q;q++)p[q]=+p[q]+e,p[++q]=+p[q]+f;d.pop(),d=d[E](h(p,m));break;case"M":g=+l[1]+e,i=+l[2]+f;default:for(q=1,r=l.length;r>q;q++)k[q]=+l[q]+(q%2?e:f)}else if("R"==l[0])p=[e,f][E](l.slice(1)),d.pop(),d=d[E](h(p,m)),k=["R"][E](l.slice(-2));else for(var s=0,t=l.length;t>s;s++)k[s]=l[s];switch(k[0]){case"Z":e=g,f=i;break;case"H":e=k[1];break;case"V":f=k[1];break;case"M":g=k[k.length-2],i=k[k.length-1];default:e=k[k.length-2],f=k[k.length-1]}}return d.toString=c._path2string,b.abs=Cb(d),d},Fb=function(a,b,c,d){return[a,b,c,d,c,d]},Gb=function(a,b,c,d,e,f){var g=1/3,h=2/3;return[g*a+h*c,g*b+h*d,g*e+h*c,g*f+h*d,e,f]},Hb=function(a,b,c,d,e,g,h,i,j,k){var l,m=120*S/180,n=S/180*(+e||0),o=[],p=f(function(a,b,c){return{x:a*N.cos(c)-b*N.sin(c),y:a*N.sin(c)+b*N.cos(c)}});if(k)y=k[0],z=k[1],w=k[2],x=k[3];else{l=p(a,b,-n),a=l.x,b=l.y,l=p(i,j,-n),i=l.x,j=l.y;var q=(N.cos(S/180*e),N.sin(S/180*e),(a-i)/2),r=(b-j)/2,s=q*q/(c*c)+r*r/(d*d);s>1&&(s=N.sqrt(s),c*=s,d*=s);var t=c*c,u=d*d,v=(g==h?-1:1)*N.sqrt(Q((t*u-t*r*r-u*q*q)/(t*r*r+u*q*q))),w=v*c*r/d+(a+i)/2,x=v*-d*q/c+(b+j)/2,y=N.asin(((b-x)/d).toFixed(9)),z=N.asin(((j-x)/d).toFixed(9));y=w>a?S-y:y,z=w>i?S-z:z,0>y&&(y=2*S+y),0>z&&(z=2*S+z),h&&y>z&&(y-=2*S),!h&&z>y&&(z-=2*S)}var A=z-y;if(Q(A)>m){var B=z,C=i,D=j;z=y+m*(h&&z>y?1:-1),i=w+c*N.cos(z),j=x+d*N.sin(z),o=Hb(i,j,c,d,e,0,h,C,D,[z,B,w,x])}A=z-y;var F=N.cos(y),G=N.sin(y),H=N.cos(z),I=N.sin(z),K=N.tan(A/4),L=4/3*c*K,M=4/3*d*K,O=[a,b],P=[a+L*G,b-M*F],R=[i+L*I,j-M*H],T=[i,j];if(P[0]=2*O[0]-P[0],P[1]=2*O[1]-P[1],k)return[P,R,T][E](o);o=[P,R,T][E](o).join()[J](",");for(var U=[],V=0,W=o.length;W>V;V++)U[V]=V%2?p(o[V-1],o[V],n).y:p(o[V],o[V+1],n).x;return U},Ib=function(a,b,c,d,e,f,g,h,i){var j=1-i;return{x:R(j,3)*a+3*R(j,2)*i*c+3*j*i*i*e+R(i,3)*g,y:R(j,3)*b+3*R(j,2)*i*d+3*j*i*i*f+R(i,3)*h}},Jb=f(function(a,b,c,d,e,f,g,h){var i,j=e-2*c+a-(g-2*e+c),k=2*(c-a)-2*(e-c),l=a-c,m=(-k+N.sqrt(k*k-4*j*l))/2/j,n=(-k-N.sqrt(k*k-4*j*l))/2/j,o=[b,h],p=[a,g];return Q(m)>"1e12"&&(m=.5),Q(n)>"1e12"&&(n=.5),m>0&&1>m&&(i=Ib(a,b,c,d,e,f,g,h,m),p.push(i.x),o.push(i.y)),n>0&&1>n&&(i=Ib(a,b,c,d,e,f,g,h,n),p.push(i.x),o.push(i.y)),j=f-2*d+b-(h-2*f+d),k=2*(d-b)-2*(f-d),l=b-d,m=(-k+N.sqrt(k*k-4*j*l))/2/j,n=(-k-N.sqrt(k*k-4*j*l))/2/j,Q(m)>"1e12"&&(m=.5),Q(n)>"1e12"&&(n=.5),m>0&&1>m&&(i=Ib(a,b,c,d,e,f,g,h,m),p.push(i.x),o.push(i.y)),n>0&&1>n&&(i=Ib(a,b,c,d,e,f,g,h,n),p.push(i.x),o.push(i.y)),{min:{x:P[D](0,p),y:P[D](0,o)},max:{x:O[D](0,p),y:O[D](0,o)}}}),Kb=c._path2curve=f(function(a,b){var c=!b&&Ab(a);if(!b&&c.curve)return Cb(c.curve);for(var d=Eb(a),e=b&&Eb(b),f={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},g={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},h=(function(a,b,c){var d,e,f={T:1,Q:1};if(!a)return["C",b.x,b.y,b.x,b.y,b.x,b.y];switch(!(a[0]in f)&&(b.qx=b.qy=null),a[0]){case"M":b.X=a[1],b.Y=a[2];break;case"A":a=["C"][E](Hb[D](0,[b.x,b.y][E](a.slice(1))));break;case"S":"C"==c||"S"==c?(d=2*b.x-b.bx,e=2*b.y-b.by):(d=b.x,e=b.y),a=["C",d,e][E](a.slice(1));break;case"T":"Q"==c||"T"==c?(b.qx=2*b.x-b.qx,b.qy=2*b.y-b.qy):(b.qx=b.x,b.qy=b.y),a=["C"][E](Gb(b.x,b.y,b.qx,b.qy,a[1],a[2]));break;case"Q":b.qx=a[1],b.qy=a[2],a=["C"][E](Gb(b.x,b.y,a[1],a[2],a[3],a[4]));break;case"L":a=["C"][E](Fb(b.x,b.y,a[1],a[2]));break;case"H":a=["C"][E](Fb(b.x,b.y,a[1],b.y));break;case"V":a=["C"][E](Fb(b.x,b.y,b.x,a[1]));break;case"Z":a=["C"][E](Fb(b.x,b.y,b.X,b.Y))}return a}),i=function(a,b){if(a[b].length>7){a[b].shift();for(var c=a[b];c.length;)a.splice(b++,0,["C"][E](c.splice(0,6)));a.splice(b,1),l=O(d.length,e&&e.length||0)}},j=function(a,b,c,f,g){a&&b&&"M"==a[g][0]&&"M"!=b[g][0]&&(b.splice(g,0,["M",f.x,f.y]),c.bx=0,c.by=0,c.x=a[g][1],c.y=a[g][2],l=O(d.length,e&&e.length||0))},k=0,l=O(d.length,e&&e.length||0);l>k;k++){d[k]=h(d[k],f),i(d,k),e&&(e[k]=h(e[k],g)),e&&i(e,k),j(d,e,f,g,k),j(e,d,g,f,k);var m=d[k],n=e&&e[k],o=m.length,p=e&&n.length;f.x=m[o-2],f.y=m[o-1],f.bx=_(m[o-4])||f.x,f.by=_(m[o-3])||f.y,g.bx=e&&(_(n[p-4])||g.x),g.by=e&&(_(n[p-3])||g.y),g.x=e&&n[p-2],g.y=e&&n[p-1]}return e||(c.curve=Cb(d)),e?[d,e]:d},null,Cb),Lb=(c._parseDots=f(function(a){for(var b=[],d=0,e=a.length;e>d;d++){var f={},g=a[d].match(/^([^:]*):?([\d\.]*)/);if(f.color=c.getRGB(g[1]),f.color.error)return null;f.color=f.color.hex,g[2]&&(f.offset=g[2]+"%"),b.push(f)}for(d=1,e=b.length-1;e>d;d++)if(!b[d].offset){for(var h=_(b[d-1].offset||0),i=0,j=d+1;e>j;j++)if(b[j].offset){i=b[j].offset;break}i||(i=100,j=e),i=_(i);for(var k=(i-h)/(j-d+1);j>d;d++)h+=k,b[d].offset=h+"%"}return b}),c._tear=function(a,b){a==b.top&&(b.top=a.prev),a==b.bottom&&(b.bottom=a.next),a.next&&(a.next.prev=a.prev),a.prev&&(a.prev.next=a.next)}),Mb=(c._tofront=function(a,b){b.top!==a&&(Lb(a,b),a.next=null,a.prev=b.top,b.top.next=a,b.top=a)},c._toback=function(a,b){b.bottom!==a&&(Lb(a,b),a.next=b.bottom,a.prev=null,b.bottom.prev=a,b.bottom=a)},c._insertafter=function(a,b,c){Lb(a,c),b==c.top&&(c.top=a),b.next&&(b.next.prev=a),a.next=b.next,a.prev=b,b.next=a},c._insertbefore=function(a,b,c){Lb(a,c),b==c.bottom&&(c.bottom=a),b.prev&&(b.prev.next=a),a.prev=b.prev,b.prev=a,a.next=b},c.toMatrix=function(a,b){var c=Bb(a),d={_:{transform:G},getBBox:function(){return c}};return Nb(d,b),d.matrix}),Nb=(c.transformPath=function(a,b){return rb(a,Mb(a,b))},c._extractTransform=function(a,b){if(null==b)return a._.transform;b=I(b).replace(/\.{3}|\u2026/g,a._.transform||G);var d=c.parseTransformString(b),e=0,f=0,g=0,h=1,i=1,j=a._,k=new o;if(j.transform=d||[],d)for(var l=0,m=d.length;m>l;l++){var n,p,q,r,s,t=d[l],u=t.length,v=I(t[0]).toLowerCase(),w=t[0]!=v,x=w?k.invert():0;"t"==v&&3==u?w?(n=x.x(0,0),p=x.y(0,0),q=x.x(t[1],t[2]),r=x.y(t[1],t[2]),k.translate(q-n,r-p)):k.translate(t[1],t[2]):"r"==v?2==u?(s=s||a.getBBox(1),k.rotate(t[1],s.x+s.width/2,s.y+s.height/2),e+=t[1]):4==u&&(w?(q=x.x(t[2],t[3]),r=x.y(t[2],t[3]),k.rotate(t[1],q,r)):k.rotate(t[1],t[2],t[3]),e+=t[1]):"s"==v?2==u||3==u?(s=s||a.getBBox(1),k.scale(t[1],t[u-1],s.x+s.width/2,s.y+s.height/2),h*=t[1],i*=t[u-1]):5==u&&(w?(q=x.x(t[3],t[4]),r=x.y(t[3],t[4]),k.scale(t[1],t[2],q,r)):k.scale(t[1],t[2],t[3],t[4]),h*=t[1],i*=t[2]):"m"==v&&7==u&&k.add(t[1],t[2],t[3],t[4],t[5],t[6]),j.dirtyT=1,a.matrix=k}a.matrix=k,j.sx=h,j.sy=i,j.deg=e,j.dx=f=k.e,j.dy=g=k.f,1==h&&1==i&&!e&&j.bbox?(j.bbox.x+=+f,j.bbox.y+=+g):j.dirtyT=1}),Ob=function(a){var b=a[0];switch(b.toLowerCase()){case"t":return[b,0,0];case"m":return[b,1,0,0,1,0,0];case"r":return 4==a.length?[b,0,a[2],a[3]]:[b,0];case"s":return 5==a.length?[b,1,1,a[3],a[4]]:3==a.length?[b,1,1]:[b,1]}},Pb=c._equaliseTransform=function(a,b){b=I(b).replace(/\.{3}|\u2026/g,a),a=c.parseTransformString(a)||[],b=c.parseTransformString(b)||[];for(var d,e,f,g,h=O(a.length,b.length),i=[],j=[],k=0;h>k;k++){if(f=a[k]||Ob(b[k]),g=b[k]||Ob(f),f[0]!=g[0]||"r"==f[0].toLowerCase()&&(f[2]!=g[2]||f[3]!=g[3])||"s"==f[0].toLowerCase()&&(f[3]!=g[3]||f[4]!=g[4]))return;for(i[k]=[],j[k]=[],d=0,e=O(f.length,g.length);e>d;d++)d in f&&(i[k][d]=f[d]),d in g&&(j[k][d]=g[d])}return{from:i,to:j}};c._getContainer=function(a,b,d,e){var f;return f=null!=e||c.is(a,"object")?a:A.doc.getElementById(a),null!=f?f.tagName?null==b?{container:f,width:f.style.pixelWidth||f.offsetWidth,height:f.style.pixelHeight||f.offsetHeight}:{container:f,width:b,height:d}:{container:1,x:a,y:b,width:d,height:e}:void 0},c.pathToRelative=Db,c._engine={},c.path2curve=Kb,c.matrix=function(a,b,c,d,e,f){return new o(a,b,c,d,e,f)},function(a){function b(a){return a[0]*a[0]+a[1]*a[1]}function d(a){var c=N.sqrt(b(a));a[0]&&(a[0]/=c),a[1]&&(a[1]/=c)}a.add=function(a,b,c,d,e,f){var g,h,i,j,k=[[],[],[]],l=[[this.a,this.c,this.e],[this.b,this.d,this.f],[0,0,1]],m=[[a,c,e],[b,d,f],[0,0,1]];for(a&&a instanceof o&&(m=[[a.a,a.c,a.e],[a.b,a.d,a.f],[0,0,1]]),g=0;3>g;g++)for(h=0;3>h;h++){for(j=0,i=0;3>i;i++)j+=l[g][i]*m[i][h];k[g][h]=j}this.a=k[0][0],
this.b=k[1][0],this.c=k[0][1],this.d=k[1][1],this.e=k[0][2],this.f=k[1][2]},a.invert=function(){var a=this,b=a.a*a.d-a.b*a.c;return new o(a.d/b,-a.b/b,-a.c/b,a.a/b,(a.c*a.f-a.d*a.e)/b,(a.b*a.e-a.a*a.f)/b)},a.clone=function(){return new o(this.a,this.b,this.c,this.d,this.e,this.f)},a.translate=function(a,b){this.add(1,0,0,1,a,b)},a.scale=function(a,b,c,d){null==b&&(b=a),(c||d)&&this.add(1,0,0,1,c,d),this.add(a,0,0,b,0,0),(c||d)&&this.add(1,0,0,1,-c,-d)},a.rotate=function(a,b,d){a=c.rad(a),b=b||0,d=d||0;var e=+N.cos(a).toFixed(9),f=+N.sin(a).toFixed(9);this.add(e,f,-f,e,b,d),this.add(1,0,0,1,-b,-d)},a.x=function(a,b){return a*this.a+b*this.c+this.e},a.y=function(a,b){return a*this.b+b*this.d+this.f},a.get=function(a){return+this[I.fromCharCode(97+a)].toFixed(4)},a.toString=function(){return c.svg?"matrix("+[this.get(0),this.get(1),this.get(2),this.get(3),this.get(4),this.get(5)].join()+")":[this.get(0),this.get(2),this.get(1),this.get(3),0,0].join()},a.toFilter=function(){return"progid:DXImageTransform.Microsoft.Matrix(M11="+this.get(0)+", M12="+this.get(2)+", M21="+this.get(1)+", M22="+this.get(3)+", Dx="+this.get(4)+", Dy="+this.get(5)+", sizingmethod='auto expand')"},a.offset=function(){return[this.e.toFixed(4),this.f.toFixed(4)]},a.split=function(){var a={};a.dx=this.e,a.dy=this.f;var e=[[this.a,this.c],[this.b,this.d]];a.scalex=N.sqrt(b(e[0])),d(e[0]),a.shear=e[0][0]*e[1][0]+e[0][1]*e[1][1],e[1]=[e[1][0]-e[0][0]*a.shear,e[1][1]-e[0][1]*a.shear],a.scaley=N.sqrt(b(e[1])),d(e[1]),a.shear/=a.scaley;var f=-e[0][1],g=e[1][1];return 0>g?(a.rotate=c.deg(N.acos(g)),0>f&&(a.rotate=360-a.rotate)):a.rotate=c.deg(N.asin(f)),a.isSimple=!(+a.shear.toFixed(9)||a.scalex.toFixed(9)!=a.scaley.toFixed(9)&&a.rotate),a.isSuperSimple=!+a.shear.toFixed(9)&&a.scalex.toFixed(9)==a.scaley.toFixed(9)&&!a.rotate,a.noRotation=!+a.shear.toFixed(9)&&!a.rotate,a},a.toTransformString=function(a){var b=a||this[J]();return b.isSimple?(b.scalex=+b.scalex.toFixed(4),b.scaley=+b.scaley.toFixed(4),b.rotate=+b.rotate.toFixed(4),(b.dx||b.dy?"t"+[b.dx,b.dy]:G)+(1!=b.scalex||1!=b.scaley?"s"+[b.scalex,b.scaley,0,0]:G)+(b.rotate?"r"+[b.rotate,0,0]:G)):"m"+[this.get(0),this.get(1),this.get(2),this.get(3),this.get(4),this.get(5)]}}(o.prototype);var Qb=navigator.userAgent.match(/Version\/(.*?)\s/)||navigator.userAgent.match(/Chrome\/(\d+)/);v.safari="Apple Computer, Inc."==navigator.vendor&&(Qb&&Qb[1]<4||"iP"==navigator.platform.slice(0,2))||"Google Inc."==navigator.vendor&&Qb&&Qb[1]<8?function(){var a=this.rect(-99,-99,this.width+99,this.height+99).attr({stroke:"none"});setTimeout(function(){a.remove()})}:mb;for(var Rb=function(){this.returnValue=!1},Sb=function(){return this.originalEvent.preventDefault()},Tb=function(){this.cancelBubble=!0},Ub=function(){return this.originalEvent.stopPropagation()},Vb=function(a){var b=A.doc.documentElement.scrollTop||A.doc.body.scrollTop,c=A.doc.documentElement.scrollLeft||A.doc.body.scrollLeft;return{x:a.clientX+c,y:a.clientY+b}},Wb=function(){return A.doc.addEventListener?function(a,b,c,d){var e=function(a){var b=Vb(a);return c.call(d,a,b.x,b.y)};if(a.addEventListener(b,e,!1),F&&L[b]){var f=function(b){for(var e=Vb(b),f=b,g=0,h=b.targetTouches&&b.targetTouches.length;h>g;g++)if(b.targetTouches[g].target==a){b=b.targetTouches[g],b.originalEvent=f,b.preventDefault=Sb,b.stopPropagation=Ub;break}return c.call(d,b,e.x,e.y)};a.addEventListener(L[b],f,!1)}return function(){return a.removeEventListener(b,e,!1),F&&L[b]&&a.removeEventListener(L[b],e,!1),!0}}:A.doc.attachEvent?function(a,b,c,d){var e=function(a){a=a||A.win.event;var b=A.doc.documentElement.scrollTop||A.doc.body.scrollTop,e=A.doc.documentElement.scrollLeft||A.doc.body.scrollLeft,f=a.clientX+e,g=a.clientY+b;return a.preventDefault=a.preventDefault||Rb,a.stopPropagation=a.stopPropagation||Tb,c.call(d,a,f,g)};return a.attachEvent("on"+b,e),function(){return a.detachEvent("on"+b,e),!0}}:void 0}(),Xb=[],Yb=function(a){for(var c,d=a.clientX,e=a.clientY,f=A.doc.documentElement.scrollTop||A.doc.body.scrollTop,g=A.doc.documentElement.scrollLeft||A.doc.body.scrollLeft,h=Xb.length;h--;){if(c=Xb[h],F&&a.touches){for(var i,j=a.touches.length;j--;)if(i=a.touches[j],i.identifier==c.el._drag.id){d=i.clientX,e=i.clientY,(a.originalEvent?a.originalEvent:a).preventDefault();break}}else a.preventDefault();var k,l=c.el.node,m=l.nextSibling,n=l.parentNode,o=l.style.display;A.win.opera&&n.removeChild(l),l.style.display="none",k=c.el.paper.getElementByPoint(d,e),l.style.display=o,A.win.opera&&(m?n.insertBefore(l,m):n.appendChild(l)),k&&b("raphael.drag.over."+c.el.id,c.el,k),d+=g,e+=f,b("raphael.drag.move."+c.el.id,c.move_scope||c.el,d-c.el._drag.x,e-c.el._drag.y,d,e,a)}},Zb=function(a){c.unmousemove(Yb).unmouseup(Zb);for(var d,e=Xb.length;e--;)d=Xb[e],d.el._drag={},b("raphael.drag.end."+d.el.id,d.end_scope||d.start_scope||d.move_scope||d.el,a);Xb=[]},$b=c.el={},_b=K.length;_b--;)!function(a){c[a]=$b[a]=function(b,d){return c.is(b,"function")&&(this.events=this.events||[],this.events.push({name:a,f:b,unbind:Wb(this.shape||this.node||A.doc,a,b,d||this)})),this},c["un"+a]=$b["un"+a]=function(b){for(var d=this.events||[],e=d.length;e--;)d[e].name!=a||!c.is(b,"undefined")&&d[e].f!=b||(d[e].unbind(),d.splice(e,1),!d.length&&delete this.events);return this}}(K[_b]);$b.data=function(a,d){var e=kb[this.id]=kb[this.id]||{};if(0==arguments.length)return e;if(1==arguments.length){if(c.is(a,"object")){for(var f in a)a[z](f)&&this.data(f,a[f]);return this}return b("raphael.data.get."+this.id,this,e[a],a),e[a]}return e[a]=d,b("raphael.data.set."+this.id,this,d,a),this},$b.removeData=function(a){return null==a?kb[this.id]={}:kb[this.id]&&delete kb[this.id][a],this},$b.getData=function(){return d(kb[this.id]||{})},$b.hover=function(a,b,c,d){return this.mouseover(a,c).mouseout(b,d||c)},$b.unhover=function(a,b){return this.unmouseover(a).unmouseout(b)};var ac=[];$b.drag=function(a,d,e,f,g,h){function i(i){(i.originalEvent||i).preventDefault();var j=i.clientX,k=i.clientY,l=A.doc.documentElement.scrollTop||A.doc.body.scrollTop,m=A.doc.documentElement.scrollLeft||A.doc.body.scrollLeft;if(this._drag.id=i.identifier,F&&i.touches)for(var n,o=i.touches.length;o--;)if(n=i.touches[o],this._drag.id=n.identifier,n.identifier==this._drag.id){j=n.clientX,k=n.clientY;break}this._drag.x=j+m,this._drag.y=k+l,!Xb.length&&c.mousemove(Yb).mouseup(Zb),Xb.push({el:this,move_scope:f,start_scope:g,end_scope:h}),d&&b.on("raphael.drag.start."+this.id,d),a&&b.on("raphael.drag.move."+this.id,a),e&&b.on("raphael.drag.end."+this.id,e),b("raphael.drag.start."+this.id,g||f||this,i.clientX+m,i.clientY+l,i)}return this._drag={},ac.push({el:this,start:i}),this.mousedown(i),this},$b.onDragOver=function(a){a?b.on("raphael.drag.over."+this.id,a):b.unbind("raphael.drag.over."+this.id)},$b.undrag=function(){for(var a=ac.length;a--;)ac[a].el==this&&(this.unmousedown(ac[a].start),ac.splice(a,1),b.unbind("raphael.drag.*."+this.id));!ac.length&&c.unmousemove(Yb).unmouseup(Zb),Xb=[]},v.circle=function(a,b,d){var e=c._engine.circle(this,a||0,b||0,d||0);return this.__set__&&this.__set__.push(e),e},v.rect=function(a,b,d,e,f){var g=c._engine.rect(this,a||0,b||0,d||0,e||0,f||0);return this.__set__&&this.__set__.push(g),g},v.ellipse=function(a,b,d,e){var f=c._engine.ellipse(this,a||0,b||0,d||0,e||0);return this.__set__&&this.__set__.push(f),f},v.path=function(a){a&&!c.is(a,U)&&!c.is(a[0],V)&&(a+=G);var b=c._engine.path(c.format[D](c,arguments),this);return this.__set__&&this.__set__.push(b),b},v.image=function(a,b,d,e,f){var g=c._engine.image(this,a||"about:blank",b||0,d||0,e||0,f||0);return this.__set__&&this.__set__.push(g),g},v.text=function(a,b,d){var e=c._engine.text(this,a||0,b||0,I(d));return this.__set__&&this.__set__.push(e),e},v.set=function(a){!c.is(a,"array")&&(a=Array.prototype.splice.call(arguments,0,arguments.length));var b=new mc(a);return this.__set__&&this.__set__.push(b),b.paper=this,b.type="set",b},v.setStart=function(a){this.__set__=a||this.set()},v.setFinish=function(){var a=this.__set__;return delete this.__set__,a},v.setSize=function(a,b){return c._engine.setSize.call(this,a,b)},v.setViewBox=function(a,b,d,e,f){return c._engine.setViewBox.call(this,a,b,d,e,f)},v.top=v.bottom=null,v.raphael=c;var bc=function(a){var b=a.getBoundingClientRect(),c=a.ownerDocument,d=c.body,e=c.documentElement,f=e.clientTop||d.clientTop||0,g=e.clientLeft||d.clientLeft||0;return{y:b.top+(A.win.pageYOffset||e.scrollTop||d.scrollTop)-f,x:b.left+(A.win.pageXOffset||e.scrollLeft||d.scrollLeft)-g}};v.getElementByPoint=function(a,b){var c=this,d=c.canvas,e=A.doc.elementFromPoint(a,b);if(A.win.opera&&"svg"==e.tagName){var f=bc(d),g=d.createSVGRect();g.x=a-f.x,g.y=b-f.y,g.width=g.height=1;var h=d.getIntersectionList(g,null);h.length&&(e=h[h.length-1])}if(!e)return null;for(;e.parentNode&&e!=d.parentNode&&!e.raphael;)e=e.parentNode;return e==c.canvas.parentNode&&(e=d),e=e&&e.raphael?c.getById(e.raphaelid):null},v.getElementsByBBox=function(a){var b=this.set();return this.forEach(function(d){c.isBBoxIntersect(d.getBBox(),a)&&b.push(d)}),b},v.getById=function(a){for(var b=this.bottom;b;){if(b.id==a)return b;b=b.next}return null},v.forEach=function(a,b){for(var c=this.bottom;c;){if(!1===a.call(b,c))return this;c=c.next}return this},v.getElementsByPoint=function(a,b){var c=this.set();return this.forEach(function(d){d.isPointInside(a,b)&&c.push(d)}),c},$b.isPointInside=function(a,b){var d=this.realPath=qb[this.type](this);return this.attr("transform")&&this.attr("transform").length&&(d=c.transformPath(d,this.attr("transform"))),c.isPointInsidePath(d,a,b)},$b.getBBox=function(a){if(this.removed)return{};var b=this._;return a?((b.dirty||!b.bboxwt)&&(this.realPath=qb[this.type](this),b.bboxwt=Bb(this.realPath),b.bboxwt.toString=p,b.dirty=0),b.bboxwt):((b.dirty||b.dirtyT||!b.bbox)&&((b.dirty||!this.realPath)&&(b.bboxwt=0,this.realPath=qb[this.type](this)),b.bbox=Bb(rb(this.realPath,this.matrix)),b.bbox.toString=p,b.dirty=b.dirtyT=0),b.bbox)},$b.clone=function(){if(this.removed)return null;var a=this.paper[this.type]().attr(this.attr());return this.__set__&&this.__set__.push(a),a},$b.glow=function(a){if("text"==this.type)return null;a=a||{};var b={width:(a.width||10)+(+this.attr("stroke-width")||1),fill:a.fill||!1,opacity:a.opacity||.5,offsetx:a.offsetx||0,offsety:a.offsety||0,color:a.color||"#000"},c=b.width/2,d=this.paper,e=d.set(),f=this.realPath||qb[this.type](this);f=this.matrix?rb(f,this.matrix):f;for(var g=1;c+1>g;g++)e.push(d.path(f).attr({stroke:b.color,fill:b.fill?b.color:"none","stroke-linejoin":"round","stroke-linecap":"round","stroke-width":+(b.width/c*g).toFixed(3),opacity:+(b.opacity/c).toFixed(3)}));return e.insertBefore(this).translate(b.offsetx,b.offsety)};var cc=function(a,b,d,e,f,g,h,i,l){return null==l?j(a,b,d,e,f,g,h,i):c.findDotsAtSegment(a,b,d,e,f,g,h,i,k(a,b,d,e,f,g,h,i,l))},dc=function(a,b){return function(d,e,f){d=Kb(d);for(var g,h,i,j,k,l="",m={},n=0,o=0,p=d.length;p>o;o++){if(i=d[o],"M"==i[0])g=+i[1],h=+i[2];else{if(j=cc(g,h,i[1],i[2],i[3],i[4],i[5],i[6]),n+j>e){if(b&&!m.start){if(k=cc(g,h,i[1],i[2],i[3],i[4],i[5],i[6],e-n),l+=["C"+k.start.x,k.start.y,k.m.x,k.m.y,k.x,k.y],f)return l;m.start=l,l=["M"+k.x,k.y+"C"+k.n.x,k.n.y,k.end.x,k.end.y,i[5],i[6]].join(),n+=j,g=+i[5],h=+i[6];continue}if(!a&&!b)return k=cc(g,h,i[1],i[2],i[3],i[4],i[5],i[6],e-n),{x:k.x,y:k.y,alpha:k.alpha}}n+=j,g=+i[5],h=+i[6]}l+=i.shift()+i}return m.end=l,k=a?n:b?m:c.findDotsAtSegment(g,h,i[0],i[1],i[2],i[3],i[4],i[5],1),k.alpha&&(k={x:k.x,y:k.y,alpha:k.alpha}),k}},ec=dc(1),fc=dc(),gc=dc(0,1);c.getTotalLength=ec,c.getPointAtLength=fc,c.getSubpath=function(a,b,c){if(this.getTotalLength(a)-c<1e-6)return gc(a,b).end;var d=gc(a,c,1);return b?gc(d,b).end:d},$b.getTotalLength=function(){var a=this.getPath();if(a)return this.node.getTotalLength?this.node.getTotalLength():ec(a)},$b.getPointAtLength=function(a){var b=this.getPath();if(b)return fc(b,a)},$b.getPath=function(){var a,b=c._getPath[this.type];if("text"!=this.type&&"set"!=this.type)return b&&(a=b(this)),a},$b.getSubpath=function(a,b){var d=this.getPath();if(d)return c.getSubpath(d,a,b)};var hc=c.easing_formulas={linear:function(a){return a},"<":function(a){return R(a,1.7)},">":function(a){return R(a,.48)},"<>":function(a){var b=.48-a/1.04,c=N.sqrt(.1734+b*b),d=c-b,e=R(Q(d),1/3)*(0>d?-1:1),f=-c-b,g=R(Q(f),1/3)*(0>f?-1:1),h=e+g+.5;return 3*(1-h)*h*h+h*h*h},backIn:function(a){var b=1.70158;return a*a*((b+1)*a-b)},backOut:function(a){a-=1;var b=1.70158;return a*a*((b+1)*a+b)+1},elastic:function(a){return a==!!a?a:R(2,-10*a)*N.sin(2*(a-.075)*S/.3)+1},bounce:function(a){var b,c=7.5625,d=2.75;return 1/d>a?b=c*a*a:2/d>a?(a-=1.5/d,b=c*a*a+.75):2.5/d>a?(a-=2.25/d,b=c*a*a+.9375):(a-=2.625/d,b=c*a*a+.984375),b}};hc.easeIn=hc["ease-in"]=hc["<"],hc.easeOut=hc["ease-out"]=hc[">"],hc.easeInOut=hc["ease-in-out"]=hc["<>"],hc["back-in"]=hc.backIn,hc["back-out"]=hc.backOut;var ic=[],jc=a.requestAnimationFrame||a.webkitRequestAnimationFrame||a.mozRequestAnimationFrame||a.oRequestAnimationFrame||a.msRequestAnimationFrame||function(a){setTimeout(a,16)},kc=function(){for(var a=+new Date,d=0;d<ic.length;d++){var e=ic[d];if(!e.el.removed&&!e.paused){var f,g,h=a-e.start,i=e.ms,j=e.easing,k=e.from,l=e.diff,m=e.to,n=(e.t,e.el),o={},p={};if(e.initstatus?(h=(e.initstatus*e.anim.top-e.prev)/(e.percent-e.prev)*i,e.status=e.initstatus,delete e.initstatus,e.stop&&ic.splice(d--,1)):e.status=(e.prev+(e.percent-e.prev)*(h/i))/e.anim.top,!(0>h))if(i>h){var q=j(h/i);for(var r in k)if(k[z](r)){switch(db[r]){case T:f=+k[r]+q*i*l[r];break;case"colour":f="rgb("+[lc($(k[r].r+q*i*l[r].r)),lc($(k[r].g+q*i*l[r].g)),lc($(k[r].b+q*i*l[r].b))].join(",")+")";break;case"path":f=[];for(var t=0,u=k[r].length;u>t;t++){f[t]=[k[r][t][0]];for(var v=1,w=k[r][t].length;w>v;v++)f[t][v]=+k[r][t][v]+q*i*l[r][t][v];f[t]=f[t].join(H)}f=f.join(H);break;case"transform":if(l[r].real)for(f=[],t=0,u=k[r].length;u>t;t++)for(f[t]=[k[r][t][0]],v=1,w=k[r][t].length;w>v;v++)f[t][v]=k[r][t][v]+q*i*l[r][t][v];else{var x=function(a){return+k[r][a]+q*i*l[r][a]};f=[["m",x(0),x(1),x(2),x(3),x(4),x(5)]]}break;case"csv":if("clip-rect"==r)for(f=[],t=4;t--;)f[t]=+k[r][t]+q*i*l[r][t];break;default:var y=[][E](k[r]);for(f=[],t=n.paper.customAttributes[r].length;t--;)f[t]=+y[t]+q*i*l[r][t]}o[r]=f}n.attr(o),function(a,c,d){setTimeout(function(){b("raphael.anim.frame."+a,c,d)})}(n.id,n,e.anim)}else{if(function(a,d,e){setTimeout(function(){b("raphael.anim.frame."+d.id,d,e),b("raphael.anim.finish."+d.id,d,e),c.is(a,"function")&&a.call(d)})}(e.callback,n,e.anim),n.attr(m),ic.splice(d--,1),e.repeat>1&&!e.next){for(g in m)m[z](g)&&(p[g]=e.totalOrigin[g]);e.el.attr(p),s(e.anim,e.el,e.anim.percents[0],null,e.totalOrigin,e.repeat-1)}e.next&&!e.stop&&s(e.anim,e.el,e.next,null,e.totalOrigin,e.repeat)}}}c.svg&&n&&n.paper&&n.paper.safari(),ic.length&&jc(kc)},lc=function(a){return a>255?255:0>a?0:a};$b.animateWith=function(a,b,d,e,f,g){var h=this;if(h.removed)return g&&g.call(h),h;var i=d instanceof r?d:c.animation(d,e,f,g);s(i,h,i.percents[0],null,h.attr());for(var j=0,k=ic.length;k>j;j++)if(ic[j].anim==b&&ic[j].el==a){ic[k-1].start=ic[j].start;break}return h},$b.onAnimation=function(a){return a?b.on("raphael.anim.frame."+this.id,a):b.unbind("raphael.anim.frame."+this.id),this},r.prototype.delay=function(a){var b=new r(this.anim,this.ms);return b.times=this.times,b.del=+a||0,b},r.prototype.repeat=function(a){var b=new r(this.anim,this.ms);return b.del=this.del,b.times=N.floor(O(a,0))||1,b},c.animation=function(a,b,d,e){if(a instanceof r)return a;(c.is(d,"function")||!d)&&(e=e||d||null,d=null),a=Object(a),b=+b||0;var f,g,h={};for(g in a)a[z](g)&&_(g)!=g&&_(g)+"%"!=g&&(f=!0,h[g]=a[g]);return f?(d&&(h.easing=d),e&&(h.callback=e),new r({100:h},b)):new r(a,b)},$b.animate=function(a,b,d,e){var f=this;if(f.removed)return e&&e.call(f),f;var g=a instanceof r?a:c.animation(a,b,d,e);return s(g,f,g.percents[0],null,f.attr()),f},$b.setTime=function(a,b){return a&&null!=b&&this.status(a,P(b,a.ms)/a.ms),this},$b.status=function(a,b){var c,d,e=[],f=0;if(null!=b)return s(a,this,-1,P(b,1)),this;for(c=ic.length;c>f;f++)if(d=ic[f],d.el.id==this.id&&(!a||d.anim==a)){if(a)return d.status;e.push({anim:d.anim,status:d.status})}return a?0:e},$b.pause=function(a){for(var c=0;c<ic.length;c++)ic[c].el.id!=this.id||a&&ic[c].anim!=a||!1!==b("raphael.anim.pause."+this.id,this,ic[c].anim)&&(ic[c].paused=!0);return this},$b.resume=function(a){for(var c=0;c<ic.length;c++)if(ic[c].el.id==this.id&&(!a||ic[c].anim==a)){var d=ic[c];!1!==b("raphael.anim.resume."+this.id,this,d.anim)&&(delete d.paused,this.status(d.anim,d.status))}return this},$b.stop=function(a){for(var c=0;c<ic.length;c++)ic[c].el.id!=this.id||a&&ic[c].anim!=a||!1!==b("raphael.anim.stop."+this.id,this,ic[c].anim)&&ic.splice(c--,1);return this},b.on("raphael.remove",t),b.on("raphael.clear",t),$b.toString=function(){return"Raphaël’s object"};var mc=function(a){if(this.items=[],this.length=0,this.type="set",a)for(var b=0,c=a.length;c>b;b++)!a[b]||a[b].constructor!=$b.constructor&&a[b].constructor!=mc||(this[this.items.length]=this.items[this.items.length]=a[b],this.length++)},nc=mc.prototype;nc.push=function(){for(var a,b,c=0,d=arguments.length;d>c;c++)!(a=arguments[c])||a.constructor!=$b.constructor&&a.constructor!=mc||(b=this.items.length,this[b]=this.items[b]=a,this.length++);return this},nc.pop=function(){return this.length&&delete this[this.length--],this.items.pop()},nc.forEach=function(a,b){for(var c=0,d=this.items.length;d>c;c++)if(!1===a.call(b,this.items[c],c))return this;return this};for(var oc in $b)$b[z](oc)&&(nc[oc]=function(a){return function(){var b=arguments;return this.forEach(function(c){c[a][D](c,b)})}}(oc));return nc.attr=function(a,b){if(a&&c.is(a,V)&&c.is(a[0],"object"))for(var d=0,e=a.length;e>d;d++)this.items[d].attr(a[d]);else for(var f=0,g=this.items.length;g>f;f++)this.items[f].attr(a,b);return this},nc.clear=function(){for(;this.length;)this.pop()},nc.splice=function(a,b){a=0>a?O(this.length+a,0):a,b=O(0,P(this.length-a,b));var c,d=[],e=[],f=[];for(c=2;c<arguments.length;c++)f.push(arguments[c]);for(c=0;b>c;c++)e.push(this[a+c]);for(;c<this.length-a;c++)d.push(this[a+c]);var g=f.length;for(c=0;c<g+d.length;c++)this.items[a+c]=this[a+c]=g>c?f[c]:d[c-g];for(c=this.items.length=this.length-=b-g;this[c];)delete this[c++];return new mc(e)},nc.exclude=function(a){for(var b=0,c=this.length;c>b;b++)if(this[b]==a)return this.splice(b,1),!0},nc.animate=function(a,b,d,e){(c.is(d,"function")||!d)&&(e=d||null);var f,g,h=this.items.length,i=h,j=this;if(!h)return this;e&&(g=function(){!--h&&e.call(j)}),d=c.is(d,U)?d:g;var k=c.animation(a,b,d,g);for(f=this.items[--i].animate(k);i--;)this.items[i]&&!this.items[i].removed&&this.items[i].animateWith(f,k,k),this.items[i]&&!this.items[i].removed||h--;return this},nc.insertAfter=function(a){for(var b=this.items.length;b--;)this.items[b].insertAfter(a);return this},nc.getBBox=function(){for(var a=[],b=[],c=[],d=[],e=this.items.length;e--;)if(!this.items[e].removed){var f=this.items[e].getBBox();a.push(f.x),b.push(f.y),c.push(f.x+f.width),d.push(f.y+f.height)}return a=P[D](0,a),b=P[D](0,b),c=O[D](0,c),d=O[D](0,d),{x:a,y:b,x2:c,y2:d,width:c-a,height:d-b}},nc.clone=function(a){a=this.paper.set();for(var b=0,c=this.items.length;c>b;b++)a.push(this.items[b].clone());return a},nc.toString=function(){return"Raphaël‘s set"},nc.glow=function(a){var b=this.paper.set();return this.forEach(function(c){var d=c.glow(a);null!=d&&d.forEach(function(a){b.push(a)})}),b},nc.isPointInside=function(a,b){var c=!1;return this.forEach(function(d){return d.isPointInside(a,b)?(c=!0,!1):void 0}),c},c.registerFont=function(a){if(!a.face)return a;this.fonts=this.fonts||{};var b={w:a.w,face:{},glyphs:{}},c=a.face["font-family"];for(var d in a.face)a.face[z](d)&&(b.face[d]=a.face[d]);if(this.fonts[c]?this.fonts[c].push(b):this.fonts[c]=[b],!a.svg){b.face["units-per-em"]=ab(a.face["units-per-em"],10);for(var e in a.glyphs)if(a.glyphs[z](e)){var f=a.glyphs[e];if(b.glyphs[e]={w:f.w,k:{},d:f.d&&"M"+f.d.replace(/[mlcxtrv]/g,function(a){return{l:"L",c:"C",x:"z",t:"m",r:"l",v:"c"}[a]||"M"})+"z"},f.k)for(var g in f.k)f[z](g)&&(b.glyphs[e].k[g]=f.k[g])}}return a},v.getFont=function(a,b,d,e){if(e=e||"normal",d=d||"normal",b=+b||{normal:400,bold:700,lighter:300,bolder:800}[b]||400,c.fonts){var f=c.fonts[a];if(!f){var g=new RegExp("(^|\\s)"+a.replace(/[^\w\d\s+!~.:_-]/g,G)+"(\\s|$)","i");for(var h in c.fonts)if(c.fonts[z](h)&&g.test(h)){f=c.fonts[h];break}}var i;if(f)for(var j=0,k=f.length;k>j&&(i=f[j],i.face["font-weight"]!=b||i.face["font-style"]!=d&&i.face["font-style"]||i.face["font-stretch"]!=e);j++);return i}},v.print=function(a,b,d,e,f,g,h,i){g=g||"middle",h=O(P(h||0,1),-1),i=O(P(i||1,3),1);var j,k=I(d)[J](G),l=0,m=0,n=G;if(c.is(e,"string")&&(e=this.getFont(e)),e){j=(f||16)/e.face["units-per-em"];for(var o=e.face.bbox[J](w),p=+o[0],q=o[3]-o[1],r=0,s=+o[1]+("baseline"==g?q+ +e.face.descent:q/2),t=0,u=k.length;u>t;t++){if("\n"==k[t])l=0,x=0,m=0,r+=q*i;else{var v=m&&e.glyphs[k[t-1]]||{},x=e.glyphs[k[t]];l+=m?(v.w||e.w)+(v.k&&v.k[k[t]]||0)+e.w*h:0,m=1}x&&x.d&&(n+=c.transformPath(x.d,["t",l*j,r*j,"s",j,j,p,s,"t",(a-p)/j,(b-s)/j]))}}return this.path(n).attr({fill:"#000",stroke:"none"})},v.add=function(a){if(c.is(a,"array"))for(var b,d=this.set(),e=0,f=a.length;f>e;e++)b=a[e]||{},x[z](b.type)&&d.push(this[b.type]().attr(b));return d},c.format=function(a,b){var d=c.is(b,V)?[0][E](b):arguments;return a&&c.is(a,U)&&d.length-1&&(a=a.replace(y,function(a,b){return null==d[++b]?G:d[b]})),a||G},c.fullfill=function(){var a=/\{([^\}]+)\}/g,b=/(?:(?:^|\.)(.+?)(?=\[|\.|$|\()|\[('|")(.+?)\2\])(\(\))?/g,c=function(a,c,d){var e=d;return c.replace(b,function(a,b,c,d,f){b=b||d,e&&(b in e&&(e=e[b]),"function"==typeof e&&f&&(e=e()))}),e=(null==e||e==d?a:e)+""};return function(b,d){return String(b).replace(a,function(a,b){return c(a,b,d)})}}(),c.ninja=function(){return B.was?A.win.Raphael=B.is:delete Raphael,c},c.st=nc,function(a,b,d){function e(){/in/.test(a.readyState)?setTimeout(e,9):c.eve("raphael.DOMload")}null==a.readyState&&a.addEventListener&&(a.addEventListener(b,d=function(){a.removeEventListener(b,d,!1),a.readyState="complete"},!1),a.readyState="loading"),e()}(document,"DOMContentLoaded"),b.on("raphael.DOMload",function(){u=!0}),function(){if(c.svg){var a="hasOwnProperty",b=String,d=parseFloat,e=parseInt,f=Math,g=f.max,h=f.abs,i=f.pow,j=/[, ]+/,k=c.eve,l="",m=" ",n="http://www.w3.org/1999/xlink",o={block:"M5,0 0,2.5 5,5z",classic:"M5,0 0,2.5 5,5 3.5,3 3.5,2z",diamond:"M2.5,0 5,2.5 2.5,5 0,2.5z",open:"M6,1 1,3.5 6,6",oval:"M2.5,0A2.5,2.5,0,0,1,2.5,5 2.5,2.5,0,0,1,2.5,0z"},p={};c.toString=function(){return"Your browser supports SVG.\nYou are running Raphaël "+this.version};var q=function(d,e){if(e){"string"==typeof d&&(d=q(d));for(var f in e)e[a](f)&&("xlink:"==f.substring(0,6)?d.setAttributeNS(n,f.substring(6),b(e[f])):d.setAttribute(f,b(e[f])))}else d=c._g.doc.createElementNS("http://www.w3.org/2000/svg",d),d.style&&(d.style.webkitTapHighlightColor="rgba(0,0,0,0)");return d},r=function(a,e){var j="linear",k=a.id+e,m=.5,n=.5,o=a.node,p=a.paper,r=o.style,s=c._g.doc.getElementById(k);if(!s){if(e=b(e).replace(c._radial_gradient,function(a,b,c){if(j="radial",b&&c){m=d(b),n=d(c);var e=2*(n>.5)-1;i(m-.5,2)+i(n-.5,2)>.25&&(n=f.sqrt(.25-i(m-.5,2))*e+.5)&&.5!=n&&(n=n.toFixed(5)-1e-5*e)}return l}),e=e.split(/\s*\-\s*/),"linear"==j){var t=e.shift();if(t=-d(t),isNaN(t))return null;var u=[0,0,f.cos(c.rad(t)),f.sin(c.rad(t))],v=1/(g(h(u[2]),h(u[3]))||1);u[2]*=v,u[3]*=v,u[2]<0&&(u[0]=-u[2],u[2]=0),u[3]<0&&(u[1]=-u[3],u[3]=0)}var w=c._parseDots(e);if(!w)return null;if(k=k.replace(/[\(\)\s,\xb0#]/g,"_"),a.gradient&&k!=a.gradient.id&&(p.defs.removeChild(a.gradient),delete a.gradient),!a.gradient){s=q(j+"Gradient",{id:k}),a.gradient=s,q(s,"radial"==j?{fx:m,fy:n}:{x1:u[0],y1:u[1],x2:u[2],y2:u[3],gradientTransform:a.matrix.invert()}),p.defs.appendChild(s);for(var x=0,y=w.length;y>x;x++)s.appendChild(q("stop",{offset:w[x].offset?w[x].offset:x?"100%":"0%","stop-color":w[x].color||"#fff"}))}}return q(o,{fill:"url(#"+k+")",opacity:1,"fill-opacity":1}),r.fill=l,r.opacity=1,r.fillOpacity=1,1},s=function(a){var b=a.getBBox(1);q(a.pattern,{patternTransform:a.matrix.invert()+" translate("+b.x+","+b.y+")"})},t=function(d,e,f){if("path"==d.type){for(var g,h,i,j,k,m=b(e).toLowerCase().split("-"),n=d.paper,r=f?"end":"start",s=d.node,t=d.attrs,u=t["stroke-width"],v=m.length,w="classic",x=3,y=3,z=5;v--;)switch(m[v]){case"block":case"classic":case"oval":case"diamond":case"open":case"none":w=m[v];break;case"wide":y=5;break;case"narrow":y=2;break;case"long":x=5;break;case"short":x=2}if("open"==w?(x+=2,y+=2,z+=2,i=1,j=f?4:1,k={fill:"none",stroke:t.stroke}):(j=i=x/2,k={fill:t.stroke,stroke:"none"}),d._.arrows?f?(d._.arrows.endPath&&p[d._.arrows.endPath]--,d._.arrows.endMarker&&p[d._.arrows.endMarker]--):(d._.arrows.startPath&&p[d._.arrows.startPath]--,d._.arrows.startMarker&&p[d._.arrows.startMarker]--):d._.arrows={},"none"!=w){var A="raphael-marker-"+w,B="raphael-marker-"+r+w+x+y;c._g.doc.getElementById(A)?p[A]++:(n.defs.appendChild(q(q("path"),{"stroke-linecap":"round",d:o[w],id:A})),p[A]=1);var C,D=c._g.doc.getElementById(B);D?(p[B]++,C=D.getElementsByTagName("use")[0]):(D=q(q("marker"),{id:B,markerHeight:y,markerWidth:x,orient:"auto",refX:j,refY:y/2}),C=q(q("use"),{"xlink:href":"#"+A,transform:(f?"rotate(180 "+x/2+" "+y/2+") ":l)+"scale("+x/z+","+y/z+")","stroke-width":(1/((x/z+y/z)/2)).toFixed(4)}),D.appendChild(C),n.defs.appendChild(D),p[B]=1),q(C,k);var E=i*("diamond"!=w&&"oval"!=w);f?(g=d._.arrows.startdx*u||0,h=c.getTotalLength(t.path)-E*u):(g=E*u,h=c.getTotalLength(t.path)-(d._.arrows.enddx*u||0)),k={},k["marker-"+r]="url(#"+B+")",(h||g)&&(k.d=c.getSubpath(t.path,g,h)),q(s,k),d._.arrows[r+"Path"]=A,d._.arrows[r+"Marker"]=B,d._.arrows[r+"dx"]=E,d._.arrows[r+"Type"]=w,d._.arrows[r+"String"]=e}else f?(g=d._.arrows.startdx*u||0,h=c.getTotalLength(t.path)-g):(g=0,h=c.getTotalLength(t.path)-(d._.arrows.enddx*u||0)),d._.arrows[r+"Path"]&&q(s,{d:c.getSubpath(t.path,g,h)}),delete d._.arrows[r+"Path"],delete d._.arrows[r+"Marker"],delete d._.arrows[r+"dx"],delete d._.arrows[r+"Type"],delete d._.arrows[r+"String"];for(k in p)if(p[a](k)&&!p[k]){var F=c._g.doc.getElementById(k);F&&F.parentNode.removeChild(F)}}},u={"":[0],none:[0],"-":[3,1],".":[1,1],"-.":[3,1,1,1],"-..":[3,1,1,1,1,1],". ":[1,3],"- ":[4,3],"--":[8,3],"- .":[4,3,1,3],"--.":[8,3,1,3],"--..":[8,3,1,3,1,3]},v=function(a,c,d){if(c=u[b(c).toLowerCase()]){for(var e=a.attrs["stroke-width"]||"1",f={round:e,square:e,butt:0}[a.attrs["stroke-linecap"]||d["stroke-linecap"]]||0,g=[],h=c.length;h--;)g[h]=c[h]*e+(h%2?1:-1)*f;q(a.node,{"stroke-dasharray":g.join(",")})}},w=function(d,f){var i=d.node,k=d.attrs,m=i.style.visibility;i.style.visibility="hidden";for(var o in f)if(f[a](o)){if(!c._availableAttrs[a](o))continue;var p=f[o];switch(k[o]=p,o){case"blur":d.blur(p);break;case"title":var u=i.getElementsByTagName("title");if(u.length&&(u=u[0]))u.firstChild.nodeValue=p;else{u=q("title");var w=c._g.doc.createTextNode(p);u.appendChild(w),i.appendChild(u)}break;case"href":case"target":var x=i.parentNode;if("a"!=x.tagName.toLowerCase()){var z=q("a");x.insertBefore(z,i),z.appendChild(i),x=z}"target"==o?x.setAttributeNS(n,"show","blank"==p?"new":p):x.setAttributeNS(n,o,p);break;case"cursor":i.style.cursor=p;break;case"transform":d.transform(p);break;case"arrow-start":t(d,p);break;case"arrow-end":t(d,p,1);break;case"clip-rect":var A=b(p).split(j);if(4==A.length){d.clip&&d.clip.parentNode.parentNode.removeChild(d.clip.parentNode);var B=q("clipPath"),C=q("rect");B.id=c.createUUID(),q(C,{x:A[0],y:A[1],width:A[2],height:A[3]}),B.appendChild(C),d.paper.defs.appendChild(B),q(i,{"clip-path":"url(#"+B.id+")"}),d.clip=C}if(!p){var D=i.getAttribute("clip-path");if(D){var E=c._g.doc.getElementById(D.replace(/(^url\(#|\)$)/g,l));E&&E.parentNode.removeChild(E),q(i,{"clip-path":l}),delete d.clip}}break;case"path":"path"==d.type&&(q(i,{d:p?k.path=c._pathToAbsolute(p):"M0,0"}),d._.dirty=1,d._.arrows&&("startString"in d._.arrows&&t(d,d._.arrows.startString),"endString"in d._.arrows&&t(d,d._.arrows.endString,1)));break;case"width":if(i.setAttribute(o,p),d._.dirty=1,!k.fx)break;o="x",p=k.x;case"x":k.fx&&(p=-k.x-(k.width||0));case"rx":if("rx"==o&&"rect"==d.type)break;case"cx":i.setAttribute(o,p),d.pattern&&s(d),d._.dirty=1;break;case"height":if(i.setAttribute(o,p),d._.dirty=1,!k.fy)break;o="y",p=k.y;case"y":k.fy&&(p=-k.y-(k.height||0));case"ry":if("ry"==o&&"rect"==d.type)break;case"cy":i.setAttribute(o,p),d.pattern&&s(d),d._.dirty=1;break;case"r":"rect"==d.type?q(i,{rx:p,ry:p}):i.setAttribute(o,p),d._.dirty=1;break;case"src":"image"==d.type&&i.setAttributeNS(n,"href",p);break;case"stroke-width":(1!=d._.sx||1!=d._.sy)&&(p/=g(h(d._.sx),h(d._.sy))||1),d.paper._vbSize&&(p*=d.paper._vbSize),i.setAttribute(o,p),k["stroke-dasharray"]&&v(d,k["stroke-dasharray"],f),d._.arrows&&("startString"in d._.arrows&&t(d,d._.arrows.startString),"endString"in d._.arrows&&t(d,d._.arrows.endString,1));break;case"stroke-dasharray":v(d,p,f);break;case"fill":var F=b(p).match(c._ISURL);if(F){B=q("pattern");var G=q("image");B.id=c.createUUID(),q(B,{x:0,y:0,patternUnits:"userSpaceOnUse",height:1,width:1}),q(G,{x:0,y:0,"xlink:href":F[1]}),B.appendChild(G),function(a){c._preload(F[1],function(){var b=this.offsetWidth,c=this.offsetHeight;q(a,{width:b,height:c}),q(G,{width:b,height:c}),d.paper.safari()})}(B),d.paper.defs.appendChild(B),q(i,{fill:"url(#"+B.id+")"}),d.pattern=B,d.pattern&&s(d);break}var H=c.getRGB(p);if(H.error){if(("circle"==d.type||"ellipse"==d.type||"r"!=b(p).charAt())&&r(d,p)){if("opacity"in k||"fill-opacity"in k){var I=c._g.doc.getElementById(i.getAttribute("fill").replace(/^url\(#|\)$/g,l));if(I){var J=I.getElementsByTagName("stop");q(J[J.length-1],{"stop-opacity":("opacity"in k?k.opacity:1)*("fill-opacity"in k?k["fill-opacity"]:1)})}}k.gradient=p,k.fill="none";break}}else delete f.gradient,delete k.gradient,!c.is(k.opacity,"undefined")&&c.is(f.opacity,"undefined")&&q(i,{opacity:k.opacity}),!c.is(k["fill-opacity"],"undefined")&&c.is(f["fill-opacity"],"undefined")&&q(i,{"fill-opacity":k["fill-opacity"]});H[a]("opacity")&&q(i,{"fill-opacity":H.opacity>1?H.opacity/100:H.opacity});case"stroke":H=c.getRGB(p),i.setAttribute(o,H.hex),"stroke"==o&&H[a]("opacity")&&q(i,{"stroke-opacity":H.opacity>1?H.opacity/100:H.opacity}),"stroke"==o&&d._.arrows&&("startString"in d._.arrows&&t(d,d._.arrows.startString),"endString"in d._.arrows&&t(d,d._.arrows.endString,1));break;case"gradient":("circle"==d.type||"ellipse"==d.type||"r"!=b(p).charAt())&&r(d,p);break;case"opacity":k.gradient&&!k[a]("stroke-opacity")&&q(i,{"stroke-opacity":p>1?p/100:p});case"fill-opacity":if(k.gradient){(I=c._g.doc.getElementById(i.getAttribute("fill").replace(/^url\(#|\)$/g,l)))&&(J=I.getElementsByTagName("stop"),q(J[J.length-1],{"stop-opacity":p}));break}default:"font-size"==o&&(p=e(p,10)+"px");var K=o.replace(/(\-.)/g,function(a){return a.substring(1).toUpperCase()});i.style[K]=p,d._.dirty=1,i.setAttribute(o,p)}}y(d,f),i.style.visibility=m},y=function(d,f){if("text"==d.type&&(f[a]("text")||f[a]("font")||f[a]("font-size")||f[a]("x")||f[a]("y"))){var g=d.attrs,h=d.node,i=h.firstChild?e(c._g.doc.defaultView.getComputedStyle(h.firstChild,l).getPropertyValue("font-size"),10):10;if(f[a]("text")){for(g.text=f.text;h.firstChild;)h.removeChild(h.firstChild);for(var j,k=b(f.text).split("\n"),m=[],n=0,o=k.length;o>n;n++)j=q("tspan"),n&&q(j,{dy:1.2*i,x:g.x}),j.appendChild(c._g.doc.createTextNode(k[n])),h.appendChild(j),m[n]=j}else for(m=h.getElementsByTagName("tspan"),n=0,o=m.length;o>n;n++)n?q(m[n],{dy:1.2*i,x:g.x}):q(m[0],{dy:0});q(h,{x:g.x,y:g.y}),d._.dirty=1;var p=d._getBBox(),r=g.y-(p.y+p.height/2);r&&c.is(r,"finite")&&q(m[0],{dy:r})}},z=function(a,b){this[0]=this.node=a,a.raphael=!0,this.id=c._oid++,a.raphaelid=this.id,this.matrix=c.matrix(),this.realPath=null,this.paper=b,this.attrs=this.attrs||{},this._={transform:[],sx:1,sy:1,deg:0,dx:0,
dy:0,dirty:1},!b.bottom&&(b.bottom=this),this.prev=b.top,b.top&&(b.top.next=this),b.top=this,this.next=null},A=c.el;z.prototype=A,A.constructor=z,c._engine.path=function(a,b){var c=q("path");b.canvas&&b.canvas.appendChild(c);var d=new z(c,b);return d.type="path",w(d,{fill:"none",stroke:"#000",path:a}),d},A.rotate=function(a,c,e){if(this.removed)return this;if(a=b(a).split(j),a.length-1&&(c=d(a[1]),e=d(a[2])),a=d(a[0]),null==e&&(c=e),null==c||null==e){var f=this.getBBox(1);c=f.x+f.width/2,e=f.y+f.height/2}return this.transform(this._.transform.concat([["r",a,c,e]])),this},A.scale=function(a,c,e,f){if(this.removed)return this;if(a=b(a).split(j),a.length-1&&(c=d(a[1]),e=d(a[2]),f=d(a[3])),a=d(a[0]),null==c&&(c=a),null==f&&(e=f),null==e||null==f)var g=this.getBBox(1);return e=null==e?g.x+g.width/2:e,f=null==f?g.y+g.height/2:f,this.transform(this._.transform.concat([["s",a,c,e,f]])),this},A.translate=function(a,c){return this.removed?this:(a=b(a).split(j),a.length-1&&(c=d(a[1])),a=d(a[0])||0,c=+c||0,this.transform(this._.transform.concat([["t",a,c]])),this)},A.transform=function(b){var d=this._;if(null==b)return d.transform;if(c._extractTransform(this,b),this.clip&&q(this.clip,{transform:this.matrix.invert()}),this.pattern&&s(this),this.node&&q(this.node,{transform:this.matrix}),1!=d.sx||1!=d.sy){var e=this.attrs[a]("stroke-width")?this.attrs["stroke-width"]:1;this.attr({"stroke-width":e})}return this},A.hide=function(){return!this.removed&&this.paper.safari(this.node.style.display="none"),this},A.show=function(){return!this.removed&&this.paper.safari(this.node.style.display=""),this},A.remove=function(){if(!this.removed&&this.node.parentNode){var a=this.paper;a.__set__&&a.__set__.exclude(this),k.unbind("raphael.*.*."+this.id),this.gradient&&a.defs.removeChild(this.gradient),c._tear(this,a),"a"==this.node.parentNode.tagName.toLowerCase()?this.node.parentNode.parentNode.removeChild(this.node.parentNode):this.node.parentNode.removeChild(this.node);for(var b in this)this[b]="function"==typeof this[b]?c._removedFactory(b):null;this.removed=!0}},A._getBBox=function(){if("none"==this.node.style.display){this.show();var a=!0}var b={};try{b=this.node.getBBox()}catch(c){}finally{b=b||{}}return a&&this.hide(),b},A.attr=function(b,d){if(this.removed)return this;if(null==b){var e={};for(var f in this.attrs)this.attrs[a](f)&&(e[f]=this.attrs[f]);return e.gradient&&"none"==e.fill&&(e.fill=e.gradient)&&delete e.gradient,e.transform=this._.transform,e}if(null==d&&c.is(b,"string")){if("fill"==b&&"none"==this.attrs.fill&&this.attrs.gradient)return this.attrs.gradient;if("transform"==b)return this._.transform;for(var g=b.split(j),h={},i=0,l=g.length;l>i;i++)b=g[i],h[b]=b in this.attrs?this.attrs[b]:c.is(this.paper.customAttributes[b],"function")?this.paper.customAttributes[b].def:c._availableAttrs[b];return l-1?h:h[g[0]]}if(null==d&&c.is(b,"array")){for(h={},i=0,l=b.length;l>i;i++)h[b[i]]=this.attr(b[i]);return h}if(null!=d){var m={};m[b]=d}else null!=b&&c.is(b,"object")&&(m=b);for(var n in m)k("raphael.attr."+n+"."+this.id,this,m[n]);for(n in this.paper.customAttributes)if(this.paper.customAttributes[a](n)&&m[a](n)&&c.is(this.paper.customAttributes[n],"function")){var o=this.paper.customAttributes[n].apply(this,[].concat(m[n]));this.attrs[n]=m[n];for(var p in o)o[a](p)&&(m[p]=o[p])}return w(this,m),this},A.toFront=function(){if(this.removed)return this;"a"==this.node.parentNode.tagName.toLowerCase()?this.node.parentNode.parentNode.appendChild(this.node.parentNode):this.node.parentNode.appendChild(this.node);var a=this.paper;return a.top!=this&&c._tofront(this,a),this},A.toBack=function(){if(this.removed)return this;var a=this.node.parentNode;return"a"==a.tagName.toLowerCase()?a.parentNode.insertBefore(this.node.parentNode,this.node.parentNode.parentNode.firstChild):a.firstChild!=this.node&&a.insertBefore(this.node,this.node.parentNode.firstChild),c._toback(this,this.paper),this.paper,this},A.insertAfter=function(a){if(this.removed)return this;var b=a.node||a[a.length-1].node;return b.nextSibling?b.parentNode.insertBefore(this.node,b.nextSibling):b.parentNode.appendChild(this.node),c._insertafter(this,a,this.paper),this},A.insertBefore=function(a){if(this.removed)return this;var b=a.node||a[0].node;return b.parentNode.insertBefore(this.node,b),c._insertbefore(this,a,this.paper),this},A.blur=function(a){var b=this;if(0!=+a){var d=q("filter"),e=q("feGaussianBlur");b.attrs.blur=a,d.id=c.createUUID(),q(e,{stdDeviation:+a||1.5}),d.appendChild(e),b.paper.defs.appendChild(d),b._blur=d,q(b.node,{filter:"url(#"+d.id+")"})}else b._blur&&(b._blur.parentNode.removeChild(b._blur),delete b._blur,delete b.attrs.blur),b.node.removeAttribute("filter");return b},c._engine.circle=function(a,b,c,d){var e=q("circle");a.canvas&&a.canvas.appendChild(e);var f=new z(e,a);return f.attrs={cx:b,cy:c,r:d,fill:"none",stroke:"#000"},f.type="circle",q(e,f.attrs),f},c._engine.rect=function(a,b,c,d,e,f){var g=q("rect");a.canvas&&a.canvas.appendChild(g);var h=new z(g,a);return h.attrs={x:b,y:c,width:d,height:e,r:f||0,rx:f||0,ry:f||0,fill:"none",stroke:"#000"},h.type="rect",q(g,h.attrs),h},c._engine.ellipse=function(a,b,c,d,e){var f=q("ellipse");a.canvas&&a.canvas.appendChild(f);var g=new z(f,a);return g.attrs={cx:b,cy:c,rx:d,ry:e,fill:"none",stroke:"#000"},g.type="ellipse",q(f,g.attrs),g},c._engine.image=function(a,b,c,d,e,f){var g=q("image");q(g,{x:c,y:d,width:e,height:f,preserveAspectRatio:"none"}),g.setAttributeNS(n,"href",b),a.canvas&&a.canvas.appendChild(g);var h=new z(g,a);return h.attrs={x:c,y:d,width:e,height:f,src:b},h.type="image",h},c._engine.text=function(a,b,d,e){var f=q("text");a.canvas&&a.canvas.appendChild(f);var g=new z(f,a);return g.attrs={x:b,y:d,"text-anchor":"middle",text:e,font:c._availableAttrs.font,stroke:"none",fill:"#000"},g.type="text",w(g,g.attrs),g},c._engine.setSize=function(a,b){return this.width=a||this.width,this.height=b||this.height,this.canvas.setAttribute("width",this.width),this.canvas.setAttribute("height",this.height),this._viewBox&&this.setViewBox.apply(this,this._viewBox),this},c._engine.create=function(){var a=c._getContainer.apply(0,arguments),b=a&&a.container,d=a.x,e=a.y,f=a.width,g=a.height;if(!b)throw new Error("SVG container not found.");var h,i=q("svg"),j="overflow:hidden;";return d=d||0,e=e||0,f=f||512,g=g||342,q(i,{height:g,version:1.1,width:f,xmlns:"http://www.w3.org/2000/svg"}),1==b?(i.style.cssText=j+"position:absolute;left:"+d+"px;top:"+e+"px",c._g.doc.body.appendChild(i),h=1):(i.style.cssText=j+"position:relative",b.firstChild?b.insertBefore(i,b.firstChild):b.appendChild(i)),b=new c._Paper,b.width=f,b.height=g,b.canvas=i,b.clear(),b._left=b._top=0,h&&(b.renderfix=function(){}),b.renderfix(),b},c._engine.setViewBox=function(a,b,c,d,e){k("raphael.setViewBox",this,this._viewBox,[a,b,c,d,e]);var f,h,i=g(c/this.width,d/this.height),j=this.top,l=e?"xMidYMid meet":"xMinYMin";for(null==a?(this._vbSize&&(i=1),delete this._vbSize,f="0 0 "+this.width+m+this.height):(this._vbSize=i,f=a+m+b+m+c+m+d),q(this.canvas,{viewBox:f,preserveAspectRatio:l});i&&j;)h="stroke-width"in j.attrs?j.attrs["stroke-width"]:1,j.attr({"stroke-width":h}),j._.dirty=1,j._.dirtyT=1,j=j.prev;return this._viewBox=[a,b,c,d,!!e],this},c.prototype.renderfix=function(){var a,b=this.canvas,c=b.style;try{a=b.getScreenCTM()||b.createSVGMatrix()}catch(d){a=b.createSVGMatrix()}var e=-a.e%1,f=-a.f%1;(e||f)&&(e&&(this._left=(this._left+e)%1,c.left=this._left+"px"),f&&(this._top=(this._top+f)%1,c.top=this._top+"px"))},c.prototype.clear=function(){c.eve("raphael.clear",this);for(var a=this.canvas;a.firstChild;)a.removeChild(a.firstChild);this.bottom=this.top=null,(this.desc=q("desc")).appendChild(c._g.doc.createTextNode("Created with Raphaël "+c.version)),a.appendChild(this.desc),a.appendChild(this.defs=q("defs"))},c.prototype.remove=function(){k("raphael.remove",this),this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas);for(var a in this)this[a]="function"==typeof this[a]?c._removedFactory(a):null};var B=c.st;for(var C in A)A[a](C)&&!B[a](C)&&(B[C]=function(a){return function(){var b=arguments;return this.forEach(function(c){c[a].apply(c,b)})}}(C))}}(),function(){if(c.vml){var a="hasOwnProperty",b=String,d=parseFloat,e=Math,f=e.round,g=e.max,h=e.min,i=e.abs,j="fill",k=/[, ]+/,l=c.eve,n=" ",o="",p={M:"m",L:"l",C:"c",Z:"x",m:"t",l:"r",c:"v",z:"x"},q=/([clmz]),?([^clmz]*)/gi,r=/ progid:\S+Blur\([^\)]+\)/g,s=/-?[^,\s-]+/g,t="position:absolute;left:0;top:0;width:1px;height:1px",u=21600,v={path:1,rect:1,image:1},w={circle:1,ellipse:1},x=function(a){var d=/[ahqstv]/gi,e=c._pathToAbsolute;if(b(a).match(d)&&(e=c._path2curve),d=/[clmz]/g,e==c._pathToAbsolute&&!b(a).match(d)){var g=b(a).replace(q,function(a,b,c){var d=[],e="m"==b.toLowerCase(),g=p[b];return c.replace(s,function(a){e&&2==d.length&&(g+=d+p["m"==b?"l":"L"],d=[]),d.push(f(a*u))}),g+d});return g}var h,i,j=e(a);g=[];for(var k=0,l=j.length;l>k;k++){h=j[k],"z"==(i=j[k][0].toLowerCase())&&(i="x");for(var m=1,r=h.length;r>m;m++)i+=f(h[m]*u)+(m!=r-1?",":o);g.push(i)}return g.join(n)},y=function(a,b,d){var e=c.matrix();return e.rotate(-a,.5,.5),{dx:e.x(b,d),dy:e.y(b,d)}},z=function(a,b,c,d,e,f){var g=a._,h=a.matrix,k=g.fillpos,l=a.node,m=l.style,o=1,p="",q=u/b,r=u/c;if(m.visibility="hidden",b&&c){if(l.coordsize=i(q)+n+i(r),m.rotation=f*(0>b*c?-1:1),f){var s=y(f,d,e);d=s.dx,e=s.dy}if(0>b&&(p+="x"),0>c&&(p+=" y")&&(o=-1),m.flip=p,l.coordorigin=d*-q+n+e*-r,k||g.fillsize){var t=l.getElementsByTagName(j);t=t&&t[0],l.removeChild(t),k&&(s=y(f,h.x(k[0],k[1]),h.y(k[0],k[1])),t.position=s.dx*o+n+s.dy*o),g.fillsize&&(t.size=g.fillsize[0]*i(b)+n+g.fillsize[1]*i(c)),l.appendChild(t)}m.visibility="visible"}};c.toString=function(){return"Your browser doesn’t support SVG. Falling down to VML.\nYou are running Raphaël "+this.version};var A=function(a,c,d){for(var e=b(c).toLowerCase().split("-"),f=d?"end":"start",g=e.length,h="classic",i="medium",j="medium";g--;)switch(e[g]){case"block":case"classic":case"oval":case"diamond":case"open":case"none":h=e[g];break;case"wide":case"narrow":j=e[g];break;case"long":case"short":i=e[g]}var k=a.node.getElementsByTagName("stroke")[0];k[f+"arrow"]=h,k[f+"arrowlength"]=i,k[f+"arrowwidth"]=j},B=function(e,i){e.attrs=e.attrs||{};var l=e.node,m=e.attrs,p=l.style,q=v[e.type]&&(i.x!=m.x||i.y!=m.y||i.width!=m.width||i.height!=m.height||i.cx!=m.cx||i.cy!=m.cy||i.rx!=m.rx||i.ry!=m.ry||i.r!=m.r),r=w[e.type]&&(m.cx!=i.cx||m.cy!=i.cy||m.r!=i.r||m.rx!=i.rx||m.ry!=i.ry),s=e;for(var t in i)i[a](t)&&(m[t]=i[t]);if(q&&(m.path=c._getPath[e.type](e),e._.dirty=1),i.href&&(l.href=i.href),i.title&&(l.title=i.title),i.target&&(l.target=i.target),i.cursor&&(p.cursor=i.cursor),"blur"in i&&e.blur(i.blur),(i.path&&"path"==e.type||q)&&(l.path=x(~b(m.path).toLowerCase().indexOf("r")?c._pathToAbsolute(m.path):m.path),"image"==e.type&&(e._.fillpos=[m.x,m.y],e._.fillsize=[m.width,m.height],z(e,1,1,0,0,0))),"transform"in i&&e.transform(i.transform),r){var y=+m.cx,B=+m.cy,D=+m.rx||+m.r||0,E=+m.ry||+m.r||0;l.path=c.format("ar{0},{1},{2},{3},{4},{1},{4},{1}x",f((y-D)*u),f((B-E)*u),f((y+D)*u),f((B+E)*u),f(y*u)),e._.dirty=1}if("clip-rect"in i){var G=b(i["clip-rect"]).split(k);if(4==G.length){G[2]=+G[2]+ +G[0],G[3]=+G[3]+ +G[1];var H=l.clipRect||c._g.doc.createElement("div"),I=H.style;I.clip=c.format("rect({1}px {2}px {3}px {0}px)",G),l.clipRect||(I.position="absolute",I.top=0,I.left=0,I.width=e.paper.width+"px",I.height=e.paper.height+"px",l.parentNode.insertBefore(H,l),H.appendChild(l),l.clipRect=H)}i["clip-rect"]||l.clipRect&&(l.clipRect.style.clip="auto")}if(e.textpath){var J=e.textpath.style;i.font&&(J.font=i.font),i["font-family"]&&(J.fontFamily='"'+i["font-family"].split(",")[0].replace(/^['"]+|['"]+$/g,o)+'"'),i["font-size"]&&(J.fontSize=i["font-size"]),i["font-weight"]&&(J.fontWeight=i["font-weight"]),i["font-style"]&&(J.fontStyle=i["font-style"])}if("arrow-start"in i&&A(s,i["arrow-start"]),"arrow-end"in i&&A(s,i["arrow-end"],1),null!=i.opacity||null!=i["stroke-width"]||null!=i.fill||null!=i.src||null!=i.stroke||null!=i["stroke-width"]||null!=i["stroke-opacity"]||null!=i["fill-opacity"]||null!=i["stroke-dasharray"]||null!=i["stroke-miterlimit"]||null!=i["stroke-linejoin"]||null!=i["stroke-linecap"]){var K=l.getElementsByTagName(j);if(K=K&&K[0],!K&&(K=F(j)),"image"==e.type&&i.src&&(K.src=i.src),i.fill&&(K.on=!0),(null==K.on||"none"==i.fill||null===i.fill)&&(K.on=!1),K.on&&i.fill){var M=b(i.fill).match(c._ISURL);if(M){K.parentNode==l&&l.removeChild(K),K.rotate=!0,K.src=M[1],K.type="tile";var N=e.getBBox(1);K.position=N.x+n+N.y,e._.fillpos=[N.x,N.y],c._preload(M[1],function(){e._.fillsize=[this.offsetWidth,this.offsetHeight]})}else K.color=c.getRGB(i.fill).hex,K.src=o,K.type="solid",c.getRGB(i.fill).error&&(s.type in{circle:1,ellipse:1}||"r"!=b(i.fill).charAt())&&C(s,i.fill,K)&&(m.fill="none",m.gradient=i.fill,K.rotate=!1)}if("fill-opacity"in i||"opacity"in i){var O=((+m["fill-opacity"]+1||2)-1)*((+m.opacity+1||2)-1)*((+c.getRGB(i.fill).o+1||2)-1);O=h(g(O,0),1),K.opacity=O,K.src&&(K.color="none")}l.appendChild(K);var P=l.getElementsByTagName("stroke")&&l.getElementsByTagName("stroke")[0],Q=!1;!P&&(Q=P=F("stroke")),(i.stroke&&"none"!=i.stroke||i["stroke-width"]||null!=i["stroke-opacity"]||i["stroke-dasharray"]||i["stroke-miterlimit"]||i["stroke-linejoin"]||i["stroke-linecap"])&&(P.on=!0),("none"==i.stroke||null===i.stroke||null==P.on||0==i.stroke||0==i["stroke-width"])&&(P.on=!1);var R=c.getRGB(i.stroke);P.on&&i.stroke&&(P.color=R.hex),O=((+m["stroke-opacity"]+1||2)-1)*((+m.opacity+1||2)-1)*((+R.o+1||2)-1);var S=.75*(d(i["stroke-width"])||1);if(O=h(g(O,0),1),null==i["stroke-width"]&&(S=m["stroke-width"]),i["stroke-width"]&&(P.weight=S),S&&1>S&&(O*=S)&&(P.weight=1),P.opacity=O,i["stroke-linejoin"]&&(P.joinstyle=i["stroke-linejoin"]||"miter"),P.miterlimit=i["stroke-miterlimit"]||8,i["stroke-linecap"]&&(P.endcap="butt"==i["stroke-linecap"]?"flat":"square"==i["stroke-linecap"]?"square":"round"),"stroke-dasharray"in i){var T={"-":"shortdash",".":"shortdot","-.":"shortdashdot","-..":"shortdashdotdot",". ":"dot","- ":"dash","--":"longdash","- .":"dashdot","--.":"longdashdot","--..":"longdashdotdot"};P.dashstyle=T[a](i["stroke-dasharray"])?T[i["stroke-dasharray"]]:o}Q&&l.appendChild(P)}if("text"==s.type){s.paper.canvas.style.display=o;var U=s.paper.span,W=m.font&&m.font.match(/\d+(?:\.\d*)?(?=px)/);p=U.style,m.font&&(p.font=m.font),m["font-family"]&&(p.fontFamily=m["font-family"]),m["font-weight"]&&(p.fontWeight=m["font-weight"]),m["font-style"]&&(p.fontStyle=m["font-style"]),W=d(m["font-size"]||W&&W[0])||10,p.fontSize=100*W+"px",s.textpath.string&&(U.innerHTML=b(s.textpath.string).replace(/</g,"&#60;").replace(/&/g,"&#38;").replace(/\n/g,"<br>"));var X=U.getBoundingClientRect();s.W=m.w=(X.right-X.left)/100,s.H=m.h=(X.bottom-X.top)/100,s.X=m.x,s.Y=m.y+s.H/2,("x"in i||"y"in i)&&(s.path.v=c.format("m{0},{1}l{2},{1}",f(m.x*u),f(m.y*u),f(m.x*u)+1));for(var Y=["x","y","text","font","font-family","font-weight","font-style","font-size"],Z=0,$=Y.length;$>Z;Z++)if(Y[Z]in i){s._.dirty=1;break}switch(m["text-anchor"]){case"start":s.textpath.style["v-text-align"]="left",s.bbx=s.W/2;break;case"end":s.textpath.style["v-text-align"]="right",s.bbx=-s.W/2;break;default:s.textpath.style["v-text-align"]="center",s.bbx=0}s.textpath.style["v-text-kern"]=!0}},C=function(a,f,g){a.attrs=a.attrs||{};var h=(a.attrs,Math.pow),i="linear",j=".5 .5";if(a.attrs.gradient=f,f=b(f).replace(c._radial_gradient,function(a,b,c){return i="radial",b&&c&&(b=d(b),c=d(c),h(b-.5,2)+h(c-.5,2)>.25&&(c=e.sqrt(.25-h(b-.5,2))*(2*(c>.5)-1)+.5),j=b+n+c),o}),f=f.split(/\s*\-\s*/),"linear"==i){var k=f.shift();if(k=-d(k),isNaN(k))return null}var l=c._parseDots(f);if(!l)return null;if(a=a.shape||a.node,l.length){a.removeChild(g),g.on=!0,g.method="none",g.color=l[0].color,g.color2=l[l.length-1].color;for(var m=[],p=0,q=l.length;q>p;p++)l[p].offset&&m.push(l[p].offset+n+l[p].color);g.colors=m.length?m.join():"0% "+g.color,"radial"==i?(g.type="gradientTitle",g.focus="100%",g.focussize="0 0",g.focusposition=j,g.angle=0):(g.type="gradient",g.angle=(270-k)%360),a.appendChild(g)}return 1},D=function(a,b){this[0]=this.node=a,a.raphael=!0,this.id=c._oid++,a.raphaelid=this.id,this.X=0,this.Y=0,this.attrs={},this.paper=b,this.matrix=c.matrix(),this._={transform:[],sx:1,sy:1,dx:0,dy:0,deg:0,dirty:1,dirtyT:1},!b.bottom&&(b.bottom=this),this.prev=b.top,b.top&&(b.top.next=this),b.top=this,this.next=null},E=c.el;D.prototype=E,E.constructor=D,E.transform=function(a){if(null==a)return this._.transform;var d,e=this.paper._viewBoxShift,f=e?"s"+[e.scale,e.scale]+"-1-1t"+[e.dx,e.dy]:o;e&&(d=a=b(a).replace(/\.{3}|\u2026/g,this._.transform||o)),c._extractTransform(this,f+a);var g,h=this.matrix.clone(),i=this.skew,j=this.node,k=~b(this.attrs.fill).indexOf("-"),l=!b(this.attrs.fill).indexOf("url(");if(h.translate(1,1),l||k||"image"==this.type)if(i.matrix="1 0 0 1",i.offset="0 0",g=h.split(),k&&g.noRotation||!g.isSimple){j.style.filter=h.toFilter();var m=this.getBBox(),p=this.getBBox(1),q=m.x-p.x,r=m.y-p.y;j.coordorigin=q*-u+n+r*-u,z(this,1,1,q,r,0)}else j.style.filter=o,z(this,g.scalex,g.scaley,g.dx,g.dy,g.rotate);else j.style.filter=o,i.matrix=b(h),i.offset=h.offset();return d&&(this._.transform=d),this},E.rotate=function(a,c,e){if(this.removed)return this;if(null!=a){if(a=b(a).split(k),a.length-1&&(c=d(a[1]),e=d(a[2])),a=d(a[0]),null==e&&(c=e),null==c||null==e){var f=this.getBBox(1);c=f.x+f.width/2,e=f.y+f.height/2}return this._.dirtyT=1,this.transform(this._.transform.concat([["r",a,c,e]])),this}},E.translate=function(a,c){return this.removed?this:(a=b(a).split(k),a.length-1&&(c=d(a[1])),a=d(a[0])||0,c=+c||0,this._.bbox&&(this._.bbox.x+=a,this._.bbox.y+=c),this.transform(this._.transform.concat([["t",a,c]])),this)},E.scale=function(a,c,e,f){if(this.removed)return this;if(a=b(a).split(k),a.length-1&&(c=d(a[1]),e=d(a[2]),f=d(a[3]),isNaN(e)&&(e=null),isNaN(f)&&(f=null)),a=d(a[0]),null==c&&(c=a),null==f&&(e=f),null==e||null==f)var g=this.getBBox(1);return e=null==e?g.x+g.width/2:e,f=null==f?g.y+g.height/2:f,this.transform(this._.transform.concat([["s",a,c,e,f]])),this._.dirtyT=1,this},E.hide=function(){return!this.removed&&(this.node.style.display="none"),this},E.show=function(){return!this.removed&&(this.node.style.display=o),this},E._getBBox=function(){return this.removed?{}:{x:this.X+(this.bbx||0)-this.W/2,y:this.Y-this.H,width:this.W,height:this.H}},E.remove=function(){if(!this.removed&&this.node.parentNode){this.paper.__set__&&this.paper.__set__.exclude(this),c.eve.unbind("raphael.*.*."+this.id),c._tear(this,this.paper),this.node.parentNode.removeChild(this.node),this.shape&&this.shape.parentNode.removeChild(this.shape);for(var a in this)this[a]="function"==typeof this[a]?c._removedFactory(a):null;this.removed=!0}},E.attr=function(b,d){if(this.removed)return this;if(null==b){var e={};for(var f in this.attrs)this.attrs[a](f)&&(e[f]=this.attrs[f]);return e.gradient&&"none"==e.fill&&(e.fill=e.gradient)&&delete e.gradient,e.transform=this._.transform,e}if(null==d&&c.is(b,"string")){if(b==j&&"none"==this.attrs.fill&&this.attrs.gradient)return this.attrs.gradient;for(var g=b.split(k),h={},i=0,m=g.length;m>i;i++)b=g[i],h[b]=b in this.attrs?this.attrs[b]:c.is(this.paper.customAttributes[b],"function")?this.paper.customAttributes[b].def:c._availableAttrs[b];return m-1?h:h[g[0]]}if(this.attrs&&null==d&&c.is(b,"array")){for(h={},i=0,m=b.length;m>i;i++)h[b[i]]=this.attr(b[i]);return h}var n;null!=d&&(n={},n[b]=d),null==d&&c.is(b,"object")&&(n=b);for(var o in n)l("raphael.attr."+o+"."+this.id,this,n[o]);if(n){for(o in this.paper.customAttributes)if(this.paper.customAttributes[a](o)&&n[a](o)&&c.is(this.paper.customAttributes[o],"function")){var p=this.paper.customAttributes[o].apply(this,[].concat(n[o]));this.attrs[o]=n[o];for(var q in p)p[a](q)&&(n[q]=p[q])}n.text&&"text"==this.type&&(this.textpath.string=n.text),B(this,n)}return this},E.toFront=function(){return!this.removed&&this.node.parentNode.appendChild(this.node),this.paper&&this.paper.top!=this&&c._tofront(this,this.paper),this},E.toBack=function(){return this.removed?this:(this.node.parentNode.firstChild!=this.node&&(this.node.parentNode.insertBefore(this.node,this.node.parentNode.firstChild),c._toback(this,this.paper)),this)},E.insertAfter=function(a){return this.removed?this:(a.constructor==c.st.constructor&&(a=a[a.length-1]),a.node.nextSibling?a.node.parentNode.insertBefore(this.node,a.node.nextSibling):a.node.parentNode.appendChild(this.node),c._insertafter(this,a,this.paper),this)},E.insertBefore=function(a){return this.removed?this:(a.constructor==c.st.constructor&&(a=a[0]),a.node.parentNode.insertBefore(this.node,a.node),c._insertbefore(this,a,this.paper),this)},E.blur=function(a){var b=this.node.runtimeStyle,d=b.filter;return d=d.replace(r,o),0!=+a?(this.attrs.blur=a,b.filter=d+n+" progid:DXImageTransform.Microsoft.Blur(pixelradius="+(+a||1.5)+")",b.margin=c.format("-{0}px 0 0 -{0}px",f(+a||1.5))):(b.filter=d,b.margin=0,delete this.attrs.blur),this},c._engine.path=function(a,b){var c=F("shape");c.style.cssText=t,c.coordsize=u+n+u,c.coordorigin=b.coordorigin;var d=new D(c,b),e={fill:"none",stroke:"#000"};a&&(e.path=a),d.type="path",d.path=[],d.Path=o,B(d,e),b.canvas.appendChild(c);var f=F("skew");return f.on=!0,c.appendChild(f),d.skew=f,d.transform(o),d},c._engine.rect=function(a,b,d,e,f,g){var h=c._rectPath(b,d,e,f,g),i=a.path(h),j=i.attrs;return i.X=j.x=b,i.Y=j.y=d,i.W=j.width=e,i.H=j.height=f,j.r=g,j.path=h,i.type="rect",i},c._engine.ellipse=function(a,b,c,d,e){var f=a.path();return f.attrs,f.X=b-d,f.Y=c-e,f.W=2*d,f.H=2*e,f.type="ellipse",B(f,{cx:b,cy:c,rx:d,ry:e}),f},c._engine.circle=function(a,b,c,d){var e=a.path();return e.attrs,e.X=b-d,e.Y=c-d,e.W=e.H=2*d,e.type="circle",B(e,{cx:b,cy:c,r:d}),e},c._engine.image=function(a,b,d,e,f,g){var h=c._rectPath(d,e,f,g),i=a.path(h).attr({stroke:"none"}),k=i.attrs,l=i.node,m=l.getElementsByTagName(j)[0];return k.src=b,i.X=k.x=d,i.Y=k.y=e,i.W=k.width=f,i.H=k.height=g,k.path=h,i.type="image",m.parentNode==l&&l.removeChild(m),m.rotate=!0,m.src=b,m.type="tile",i._.fillpos=[d,e],i._.fillsize=[f,g],l.appendChild(m),z(i,1,1,0,0,0),i},c._engine.text=function(a,d,e,g){var h=F("shape"),i=F("path"),j=F("textpath");d=d||0,e=e||0,g=g||"",i.v=c.format("m{0},{1}l{2},{1}",f(d*u),f(e*u),f(d*u)+1),i.textpathok=!0,j.string=b(g),j.on=!0,h.style.cssText=t,h.coordsize=u+n+u,h.coordorigin="0 0";var k=new D(h,a),l={fill:"#000",stroke:"none",font:c._availableAttrs.font,text:g};k.shape=h,k.path=i,k.textpath=j,k.type="text",k.attrs.text=b(g),k.attrs.x=d,k.attrs.y=e,k.attrs.w=1,k.attrs.h=1,B(k,l),h.appendChild(j),h.appendChild(i),a.canvas.appendChild(h);var m=F("skew");return m.on=!0,h.appendChild(m),k.skew=m,k.transform(o),k},c._engine.setSize=function(a,b){var d=this.canvas.style;return this.width=a,this.height=b,a==+a&&(a+="px"),b==+b&&(b+="px"),d.width=a,d.height=b,d.clip="rect(0 "+a+" "+b+" 0)",this._viewBox&&c._engine.setViewBox.apply(this,this._viewBox),this},c._engine.setViewBox=function(a,b,d,e,f){c.eve("raphael.setViewBox",this,this._viewBox,[a,b,d,e,f]);var h,i,j=this.width,k=this.height,l=1/g(d/j,e/k);return f&&(h=k/e,i=j/d,j>d*h&&(a-=(j-d*h)/2/h),k>e*i&&(b-=(k-e*i)/2/i)),this._viewBox=[a,b,d,e,!!f],this._viewBoxShift={dx:-a,dy:-b,scale:l},this.forEach(function(a){a.transform("...")}),this};var F;c._engine.initWin=function(a){var b=a.document;b.createStyleSheet().addRule(".rvml","behavior:url(#default#VML)");try{!b.namespaces.rvml&&b.namespaces.add("rvml","urn:schemas-microsoft-com:vml"),F=function(a){return b.createElement("<rvml:"+a+' class="rvml">')}}catch(c){F=function(a){return b.createElement("<"+a+' xmlns="urn:schemas-microsoft.com:vml" class="rvml">')}}},c._engine.initWin(c._g.win),c._engine.create=function(){var a=c._getContainer.apply(0,arguments),b=a.container,d=a.height,e=a.width,f=a.x,g=a.y;if(!b)throw new Error("VML container not found.");var h=new c._Paper,i=h.canvas=c._g.doc.createElement("div"),j=i.style;return f=f||0,g=g||0,e=e||512,d=d||342,h.width=e,h.height=d,e==+e&&(e+="px"),d==+d&&(d+="px"),h.coordsize=216e5+n+216e5,h.coordorigin="0 0",h.span=c._g.doc.createElement("span"),h.span.style.cssText="position:absolute;left:-9999em;top:-9999em;padding:0;margin:0;line-height:1;",i.appendChild(h.span),j.cssText=c.format("top:0;left:0;width:{0};height:{1};display:inline-block;position:relative;clip:rect(0 {0} {1} 0);overflow:hidden",e,d),1==b?(c._g.doc.body.appendChild(i),j.left=f+"px",j.top=g+"px",j.position="absolute"):b.firstChild?b.insertBefore(i,b.firstChild):b.appendChild(i),h.renderfix=function(){},h},c.prototype.clear=function(){c.eve("raphael.clear",this),this.canvas.innerHTML=o,this.span=c._g.doc.createElement("span"),this.span.style.cssText="position:absolute;left:-9999em;top:-9999em;padding:0;margin:0;line-height:1;display:inline;",this.canvas.appendChild(this.span),this.bottom=this.top=null},c.prototype.remove=function(){c.eve("raphael.remove",this),this.canvas.parentNode.removeChild(this.canvas);for(var a in this)this[a]="function"==typeof this[a]?c._removedFactory(a):null;return!0};var G=c.st;for(var H in E)E[a](H)&&!G[a](H)&&(G[H]=function(a){return function(){var b=arguments;return this.forEach(function(c){c[a].apply(c,b)})}}(H))}}(),B.was?A.win.Raphael=c:Raphael=c,c}),angular.module("serverForm",["serverForm.constants","serverForm.services","serverForm.directives","serverForm.filters","ngRoute","ngSanitize","serverFormWidgets","angular-momentjs","duScroll","monospaced.elastic","ngTouch"]).config(["$sceDelegateProvider","$httpProvider","$compileProvider",function($sceDelegateProvider,$httpProvider,$compileProvider){$sceDelegateProvider.resourceUrlWhitelist(["self","https://pgu-devsf.test.gosuslugi.ru/**","https://pgu-devfed.test.gosuslugi.ru/**","https://lk.gosuslugi.ru/**"]),$compileProvider.debugInfoEnabled(!1),$compileProvider.aHrefSanitizationWhitelist(/^\s*(https?|ftp|mailto|tel|file|blob):/),$httpProvider.useApplyAsync(!0)}]).run(["$moment","$rootScope",function($moment,$rootScope){if($moment.locale("ru"),window.devMode&&window.formConfig&&($rootScope.__cfg=window.formConfig,$rootScope.userSelectedRegion=$rootScope.__cfg.userSelectedRegion),!$rootScope.version){var SmartPhone={getUserAgent:function(){return navigator.userAgent},isAndroid:function(){return this.getUserAgent().match(/Android/i)},isInfomat:function(){return this.getUserAgent().match(/KraftwayBrowser/i)},isBlackBerry:function(){return this.getUserAgent().match(/BlackBerry/i)},isIOS:function(){return this.getUserAgent().match(/iPhone|iPad|iPod/i)},isIPhone:function(){return this.getUserAgent().match(/iPhone/i)},isOpera:function(){return this.getUserAgent().match(/Opera Mini/i)},isWindows:function(){return this.isWindowsDesktop()||this.isWindowsMobile()},isWindowsMobile:function(){return this.getUserAgent().match(/IEMobile/i)},isWindowsDesktop:function(){return this.getUserAgent().match(/WPDesktop/i)},isMeego:function(){return this.getUserAgent().match(/meego/i)},isNexus7:function(){return this.getUserAgent().match(/Nexus 7/i)},isHuaweiMediaPad:function(){return this.getUserAgent().match(/HUAWEI MediaPad T1 8.0/i)},isBigSmartPhone:function(){return this.getUserAgent().match(/(SM-A70)|(SM-G960F)|(SM-G965F)/i)},isAny:function(){return!!this.isAndroid()||(!!this.isBlackBerry()||(!!this.isIOS()||(!!this.isIPhone()||(!!this.isOpera()||(!!this.isWindows()||(!!this.isInfomat()||!!this.isMeego()))))))},isPortrait:function(){return screen.width<screen.height},isPhone:function(){return SmartPhone.isAny&&Math.max(screen.width,screen.height)<768||SmartPhone.isNexus7()||SmartPhone.isHuaweiMediaPad()||SmartPhone.isBigSmartPhone()}};$rootScope.version=SmartPhone.isAny()?SmartPhone.isPhone()?"mob":"pad":"dk"}}]),angular.module("serverForm.constants",[]),angular.module("serverForm.services",[]),angular.module("serverForm.directives",[]),angular.module("serverForm.filters",[]),angular.module("serverFormWidgets",["serverFormWidgets.general"]),angular.module("serverFormWidgets.general",[]),angular.module("serverForm.constants").constant("TEMPLATES_PLAYER",function(){return{EPGU_WIDGET:"js/player/tmpl/epgu-widget.html",MODAL_DRAFT:"js/player/tmpl/modal-draft.html",ESEP_RESULT:"js/player/tmpl/modal-esep.html",NEED_ESEP_PAGE:"js/player/tmpl/modal-need-esep.html",FINISH_PAGE:"js/player/tmpl/finish-page.html",FINISH_ELECTION_PAGE:"js/player/tmpl/finish-election-page.html",MODAL_IMAGE_EDITOR:"js/player/tmpl/modal-image-editor.html",MODAL_FIAS_DADATA:"js/player/tmpl/modal-fias-dadata.html",MODAL_EDITABLE_DATA_GRID:"js/player/tmpl/modal-editable-data-grid.html",MODAL_EDITABLE_DATA_GRID_CONFIRM_REMOVE:"js/player/tmpl/modal-editable-data-grid-confirm-remove.html",SMS_CONFIRM_DIALOG:"js/player/tmpl/modal-sms-confirm.html"}}()),angular.module("serverForm.services").factory("sharedExtServices",["$rootScope","$http","$q","CONFIG","LOC","PGU","HealthSrv",function($rootScope,$http,$q,CONFIG,LOC,PGU,HealthSrv){var Gateway,checkHealthWhenDone=HealthSrv.checkHealthWhenDone,checkHealthWhenError=HealthSrv.checkHealthWhenError,getSessionAttributes=function(){var attrs=[];Object.keys($rootScope.env).forEach(function(key){var value=$rootScope.env[key];null==value||void 0===value||"string"!=typeof value&&"boolean"!=typeof value&&"number"!=typeof value||attrs.push({name:key,value:value.toString()})});var otherAttrs=PGU.getOtherSessionAttrs();return otherAttrs.length?attrs.concat(otherAttrs):attrs};return Gateway=function(opt,p,f,e,async){function success(response){var data=response.data;return!data||(!data.error||0!==data.error.code&&200!=data.error&&4005!==data.error.code&&4007!==data.error.code&&(!$rootScope.settings._customPushUrl||2!==data.error.code&&3!==data.error.code&&4!==data.error.code)&&data.error.code)&&data.error?data?error(response):"function"==typeof f?f():response:(PGU.listRefItemsCache=PGU.listRefItemsCache||{},PGU.listRefItemsCache[JSON.stringify(p)]=data,"function"==typeof f?f(data):response)}function error(response){var data=response.data;return"function"==typeof e?e(data&&data.error,response):$q.reject(response)}$rootScope.settings.sessionToken||($rootScope.settings.sessionToken=p.sessionToken);var options={},hash=Math.random();return options.url=opt.url.indexOf("//")>=0?opt.url:LOC.WIDGET_URI+opt.url,options.method=opt.method||"GET",options.withCredentials=!0,$rootScope.isDesigner?options.data=p?angular.toJson(p):angular.toJson({}):(opt.headers?options.headers=opt.headers:options.headers={Accept:"application/json","Content-Type":"application/json;charset=utf-8"},opt.xHeader&&(options.headers["X-ORDER-ID"]=$rootScope.env.orderId,options.headers["X-FORM-ID"]=$rootScope.env.serviceFormInfo.PASS_CODE+"/"+$rootScope.env.serviceFormInfo.EPGU_CODE),opt.authHeader&&$rootScope.settings.sessionToken&&(options.headers.Authorization="Bearer "+$rootScope.settings.sessionToken),opt.noTestScope||(options.headers["test-scope"]="http://sf.gosuslugi.ru/api"),"GET"===options.method?opt.data||p.data?(options.params=opt.data||p.data,options.params._=hash):options.url.indexOf("&_=")<0&&options.url.indexOf("?_=")<0&&(options.params={_:hash}):(opt.data||p.data)&&(options.data=opt.data||p.data),opt.withSessionsAttributes&&(options.data=options.data||{},options.data.sessionAttributes=getSessionAttributes()),opt.responseType&&(options.responseType=opt.responseType)),"GET"===options.method?$http.get(options.url,options).then(success,error):"POST"===options.method?$http.post(options.url,options.data,options).then(success,error):$http(options).then(success,error)},{equeueService:{getAggSlots:function(p,f,e){var startTime=(new Date).getTime();Gateway({url:"api/lk/v1/equeue/agg/slots",method:"POST",data:p,noTestScope:!0,authHeader:$rootScope.inOpWidget,xHeader:!0},{},function(data){var organizationIdFromSlots="";if(data&&data.slots&&data.slots.length&&(organizationIdFromSlots=data.slots[0].organizationId),checkHealthWhenDone({type:"getSlots",startTime:startTime,organizationId:organizationIdFromSlots,serviceCode:p.serviceId},data),
"function"==typeof f)return f(data)},function(error,response){if(checkHealthWhenError({type:"getSlots",startTime:startTime,serviceCode:p.serviceId},response),"function"==typeof e)return e(error)})},aggBook:function(p,f,e){var aggBookUrl="api/lk/v1/equeue/agg/book/?srcSystem="+$rootScope.env.srcSystem,startTime=(new Date).getTime();Gateway({url:aggBookUrl,method:"POST",data:p,noTestScope:!0,authHeader:$rootScope.inOpWidget,xHeader:!0},{},function(data){if(checkHealthWhenDone({type:"aggBook",startTime:startTime},data),"function"==typeof f)return f(data)},function(error,response){if(checkHealthWhenError({type:"aggBook",startTime:startTime},response),"function"==typeof e)return e(error)})},cancelBooking:function(p,f,e){var startTime=(new Date).getTime();Gateway({url:"api/lk/v1/equeue/agg/cancel",method:"POST",data:p,noTestScope:!0,authHeader:$rootScope.inOpWidget},{},function(data){if(checkHealthWhenDone({type:"cancelBook",startTime:startTime},data),"function"==typeof f)return f(data)},function(error,response){if(checkHealthWhenError({type:"cancelBook",startTime:startTime},response),"function"==typeof e)return e(error)})},getAggRefItems:function(p,f,e){var startTime=(new Date).getTime();Gateway({url:"api/lk/v1/equeue/agg/ref/items",method:"POST",data:p,noTestScope:!0,authHeader:$rootScope.inOpWidget},{},function(data){if(checkHealthWhenDone({type:"getSlotsRefItems",startTime:startTime},data),"function"==typeof f)return f(data)},function(error,response){if(checkHealthWhenError({type:"getSlotsRefItems",startTime:startTime},response),"function"==typeof e)return e(error)})}},kladrService:function(remoteMethod,params,success,error){Gateway({url:"api/nsi/v1/kladr"+remoteMethod+(params?"?"+$.param(params):""),noTestScope:!0},{},success,error)},kladrFindFiasAddress:function(params,success,error){Gateway({url:"api/nsi/v1/fias"+(params?"?"+$.param(params):""),noTestScope:!0},{},success,error)},kladrGetFiasInfo:function(code,success,error){if(!code)return void("function"==typeof success&&success({emptyCode:!0}));Gateway({url:"api/nsi/v1/fias/"+code,noTestScope:!0},{},success,error)},rusStatSrv:function(remoteMethod,params,success,error){Gateway({url:"api/nsi/v1/rosstat"+remoteMethod,noTestScope:!0,data:params},{},success,error)},getDaDataSuggests:function(params,success,error){params.normBlock=!0,Gateway({url:"api/nsi/v1/dadata/suggestions"+(params?"?"+$.param(params):""),noTestScope:!0},{},success,error)},getDaDataDetailsByFiasCode:function(code,success,error){if(!code)return void("function"==typeof success&&success({emptyCode:!0}));Gateway({url:"api/nsi/v1/dadata/"+code,noTestScope:!0},{},success,error)},normalizeAddressInDaData:function(params,success,error){if(!params||!params.q)return void("function"==typeof success&&success({emptyCode:!0}));Gateway({url:"api/nsi/v1/dadata/normalize"+(params?"?"+$.param(params):""),noTestScope:!0},{},success,error)},listRefItems:{loadList:function(p,f,e,withoutCache){var res={};for(var item in p)p.hasOwnProperty(item)&&-1===["refName","type"].indexOf(item)&&(res[item]=p[item]);withoutCache||(PGU.listRefItemsCache=PGU.listRefItemsCache||{},PGU.listRefItemsCache[JSON.stringify(p)]&&("function"==typeof f&&f(PGU.listRefItemsCache[JSON.stringify(p)]),$rootScope.$applyAsync()));var startTime=(new Date).getTime();return Gateway({url:"api/nsi/v1/dictionary/"+p.refName,method:"POST",data:res,noTestScope:!0,xHeader:!0},p,function(data){if(checkHealthWhenDone({type:p.type||"dictionary",refName:p.refName,startTime:startTime},data),"function"==typeof f)return f(data)},function(error,response){if(checkHealthWhenError({type:p.type||"dictionary",refName:p.refName,startTime:startTime},response),"function"==typeof e)return e(error)})},loadHierarchyList:function(p,f,e){Gateway({url:"api/nsi/v1/dictionary/"+p.refName+"/hierarchyV2?q="+encodeURI(p.searchString),noTestScope:!0},{},f,e)}},formsService:{readForm:function(p,f,e){var url=CONFIG.CONTEXT_PLAY+"forms/"+p.mnemonic+(p.mode?"?mode="+p.mode:"");return Gateway({url:url,authHeader:$rootScope.inOpWidget},p,f,e)},launch:function(p,f,e){var url;url=p.customUrl?p.customUrl:CONFIG.CONTEXT_PLAY+"forms/"+$rootScope.settings.mnemonic+(p.isProcessor?"/process":"/submit"),p.data&&(p.data.sessionAttributes=getSessionAttributes());var opt={url:url,method:"POST",data:angular.toJson(p.data),authHeader:$rootScope.inOpWidget};return Gateway(opt,p,f,e,p.async)},init:function(p){var request,df=$q.defer(),orderId=p.orderId?"&orderId="+p.orderId:"",engineVersion=p.engineVersion?"engineVersion="+p.engineVersion:"",orderDescription=p.orderDescription||"",srcSystem=$rootScope.env.srcSystem,userSelectedRegion="";if($rootScope.hubForm&&(userSelectedRegion=orderId?$rootScope.druftUserSelectedRegion:$rootScope.settings.userSelectedRegion),orderDescription)userSelectedRegion&&(p.userSelectedRegion=userSelectedRegion),p.srcSystem=srcSystem,request={method:"post",data:p,url:CONFIG.CONTEXT_PLAY+"forms/"+p.mnemonic+"/init"+(engineVersion?"?"+engineVersion:""),withSessionsAttributes:!0,authHeader:$rootScope.inOpWidget};else{var userSelectedRegionGet="";userSelectedRegion&&(userSelectedRegionGet="&userSelectedRegion="+userSelectedRegion),request={url:CONFIG.CONTEXT_PLAY+"forms/"+p.mnemonic+"/init?targetId="+p.targetId+orderId+"&srcSystem="+srcSystem+userSelectedRegionGet+(engineVersion?"&"+engineVersion:""),withSessionsAttributes:!0,authHeader:$rootScope.inOpWidget}}return $rootScope.inOpWidgetIframe&&(request.headers={Accept:"application/json","Content-Type":"application/json;charset=utf-8",srcUrl:$rootScope.settings.srcUrl||""}),Gateway(request,p,function(data){if(data.content&&$rootScope.hubForm&&!engineVersion){var form=JSON.parse(data.content);$rootScope.checkNavPanelInit(form),$rootScope.navPanel&&form.items.push($rootScope.navPanel),$rootScope.scopeFormStructure.push(form)}df.resolve(data)},function(error){df.reject(error)}),df.promise},initIncomingWidget:function(p){var df=$q.defer(),request={url:CONFIG.CONTEXT_INCOMING_PLAY+"forms/"+p.mnemonic};return Gateway(request,p,function(data){if(data.content&&$rootScope.hubForm){var form=JSON.parse(data.content);$rootScope.checkNavPanelInit(form),$rootScope.navPanel&&form.items.push($rootScope.navPanel),$rootScope.scopeFormStructure.push(form)}df.resolve(data)},function(error){df.reject(error)}),df.promise},checkCustomOnline:function(url){var df=$q.defer(),params={sessionToken:$rootScope.settings.sessionToken,accessToken:$rootScope.settings.accessToken};return url?Gateway({url:url,noTestScope:!0,withCredentials:!0},params).then(function(response){204===response.status?df.resolve():df.reject({code:"qrError"})},function(error){df.reject(error)}):df.resolve(),df.promise},customOnlineInit:function(p){var df=$q.defer(),paramsWith="",srcSystem="&srcSystem="+$rootScope.env.srcSystem;!1===p.withStrategy&&(paramsWith+="&withStrategy=false"),!1===p.withOrder&&(paramsWith+="&withOrder=false");var request={url:CONFIG.CONTEXT_PLAY+"forms/online/"+p.mnemonic+"/init?targetId="+p.targetId+srcSystem+paramsWith,authHeader:$rootScope.inOpWidget};return this.checkCustomOnline($rootScope.settings._needCustomCheck).then(function(){Gateway(request,p,function(data){if(data.content&&$rootScope.hubForm){var form=JSON.parse(data.content);data.validators;$rootScope.checkNavPanelInit(form),$rootScope.navPanel&&form.items.push($rootScope.navPanel),$rootScope.scopeFormStructure.push(form)}df.resolve(data)},function(error){df.reject(error)})},function(error){df.reject(error)}),df.promise},checkUser:function(mnemonic,targetId,f){var e=function(){},url="api/catalog/v3/services/"+targetId+"_"+mnemonic+"/check",data={data:{oldStyleCode:!0}};return Gateway({url:url,noTestScope:!0,headers:{"Content-Type":"application/json;charset=utf-8"},authHeader:$rootScope.inOpWidget},data,f,e)},listDrafts:function(p,f,e){return Gateway({url:"api/lk/v1/orders/drafts",authHeader:$rootScope.inOpWidget},p,f,e)},getServiceFormInfo:function(mnemonic,targetId,region){var df=$q.defer();return Gateway({url:"api/catalog/v1/services/"+targetId+"_"+mnemonic+"/form",noTestScope:!0,headers:{"Content-Type":"application/json;charset=utf-8"}},{data:{region:region,portalEdition:"I"}},function(data){var dataObj={supportSignature:!1,fullName:"",autosaveDisabled:!1};if(data&&data.serviceFormInfo){if(dataObj.fullName=data.fullName,"EDS_MANDATORY"===data.serviceFormInfo.supportsDS&&(dataObj.supportSignature=data.serviceFormInfo.protocolDS),data.serviceFormInfo.attributeValues){void 0!==data.serviceFormInfo.attributeValues.autosaveEnabled?dataObj.autosaveDisabled=!data.serviceFormInfo.attributeValues.autosaveEnabled:!0===data.serviceFormInfo.attributeValues.autosaveDisabled&&(dataObj.autosaveDisabled=!0);for(var k in data.serviceFormInfo.attributeValues)data.serviceFormInfo.attributeValues.hasOwnProperty(k)&&($rootScope.env.serviceFormInfo[k]=data.serviceFormInfo.attributeValues[k])}data.icons&&data.icons.length&&($rootScope.env.serviceFormInfo.icons=data.icons)}df.resolve(dataObj)},function(error){df.resolve({supportSignature:!1,fullName:"",autosaveDisabled:!1})}),df.promise},getBookingFilters:function(config,f,e){var urlSearchParams="";config.parentOrderId&&(urlSearchParams+="?parentOrderId="+config.parentOrderId,config.bookId&&(urlSearchParams+="&bookId="+config.bookId));var url=$rootScope.settings.lkApiUrl+"invitations/checkOrder"+urlSearchParams;return Gateway({url:url,method:"GET",authHeader:$rootScope.inOpWidget},{},f,e)},saveSnapshotFormPdf:function(request,mnemonic){var df=$q.defer(),url=CONFIG.CONTEXT_PLAY+"forms/"+mnemonic+"/snapshot";return Gateway({url:url,method:"POST",withSessionsAttributes:!0,authHeader:$rootScope.inOpWidget},{data:request},function(data){df.resolve(data)},function(error){df.reject(error)}),df.promise},saveSnapshotFormPdfPush:function(request,mnemonic,targetId,customUrl){var df=$q.defer();return Gateway({url:customUrl||"api/sf/v1/hp/push/"+mnemonic+"/"+targetId,method:"POST",withSessionsAttributes:!0,authHeader:$rootScope.inOpWidget},{data:request},function(data){df.resolve(data)},function(error){df.reject(error)}),df.promise},prepareEsepPreview:function(request,mnemonic){var df=$q.defer(),url=CONFIG.CONTEXT_PLAY+"forms/"+mnemonic+"/esep/preview";return Gateway({url:url,method:"POST",withSessionsAttributes:!0,authHeader:$rootScope.inOpWidget},request,function(data){df.resolve(data)},function(error){df.reject(error)}),df.promise},serverValidate:function(p,f,e){var url=CONFIG.CONTEXT_PLAY+"forms/"+$rootScope.settings.mnemonic+"/validateForm";p.data&&(p.data.sessionAttributes=getSessionAttributes());var opt={url:url,method:"POST",data:angular.toJson(p.data),authHeader:$rootScope.inOpWidget};return Gateway(opt,p,f,e,p.async)},getNextSteps:function(request){var draftId="?draftId="+request.draftId,startStep="&start="+request.startStep,offset=request.offset?"&cnt="+request.offset:"",url=CONFIG.CONTEXT_PLAY+"forms/"+request.mnemonic+"/next"+draftId+startStep+offset;return Gateway({url:url,method:"GET",authHeader:$rootScope.inOpWidget},{})}},getCoordsByAddress:function(p,f,e){return Gateway({url:"api/nsi/v1/address/resolve",method:"POST",noTestScope:!0},{data:p},f,e)},hintsService:{getList:function(p,f){return Gateway({url:LOC.WIDGET_URI+"api/cms/v1/i18/groups/"+p.group+"/keys?codes="+p.code+"&lang="+p.language},p,f)}},saveDraft:function(p,f){return Gateway({url:CONFIG.CONTEXT_PLAY+"forms/"+p.form.mnemonic+"/saveDraft",method:"POST",data:p,withSessionsAttributes:!0,authHeader:$rootScope.inOpWidget},p,f)},saveDraftItem:function(p){return Gateway({url:"api/drafts/v1",method:"POST",data:p,authHeader:$rootScope.inOpWidget},p)},deleteOrder:function(p,f){$rootScope.env.srcSystem;return Gateway({url:"api/lk/v1/orders/"+p.orderId,method:"DELETE",authHeader:$rootScope.inOpWidget},p,f)},fetchInformer:function(p,f){var param=p.invalidate?"?refresh=true":"";param+=param?"&requestInstance=OPG_INF":"?requestInstance=OPG_INF";var url=LOC.WIDGET_URI+"api/lk/v2/informers/"+p.typeInformer+"/fetch"+param,headers={};$rootScope.inOpWidgetIframe&&(headers={srcUrl:$rootScope.settings.srcUrl||""}),handleAtmosphere("long-polling",url,$rootScope.settings.sessionToken,null,"GET",function(d){if("function"==typeof f)return f(d)},headers)},imageEditor:{uploadEdit:function(opts,orderId){var df=$q.defer();opts.url=CONFIG.CONTEXT_PLAY+"ie/"+orderId+"/edit",opts.noTestScope=!0,opts.authHeader=$rootScope.inOpWidget;var startTime=(new Date).getTime();return Gateway(opts,{},function(data){checkHealthWhenDone({type:"imageEditor",startTime:startTime},data),df.resolve(data)},function(error){checkHealthWhenError({type:"imageEditor",startTime:startTime},error),df.reject(error)}),df.promise},removeImage:function(orderId,mnemonic,f,e){return Gateway({url:"api/storage/v1/files/"+orderId+"/2?mnemonic="+mnemonic,noTestScope:!0,method:"DELETE",authHeader:$rootScope.inOpWidget},{},f,e)},replaceImageOfDraft:function(opts,orderId){var df=$q.defer();return opts.noTestScope=!0,opts.url=CONFIG.CONTEXT_PLAY+"ie/"+orderId+"/replaceImageOfDraft",opts.authHeader=$rootScope.inOpWidget,Gateway(opts,{},function(data){df.resolve(data)},function(error){df.reject(error)}),df.promise},getImageFromDraft:function(opts){var df=$q.defer();return opts.responseType="arraybuffer",opts.noTestScope=!0,opts.authHeader=$rootScope.inOpWidget,Gateway(opts,{},function(data){df.resolve(data)},function(error){df.reject(error)}),df.promise},checkForCrop:function(opts,orderId){var df=$q.defer();return opts.noTestScope=!0,opts.url=CONFIG.CONTEXT_PLAY+"ie/"+orderId+"/checkForCrop",opts.authHeader=$rootScope.inOpWidget,Gateway(opts,{},function(data){df.resolve(data)},function(error){df.reject(error)}),df.promise}},dataEsia:{save:function(methodName,data,f,e){var dataRes=angular.copy(data);if(data){var arr=Object.keys(data);arr&&arr.length&&arr.forEach(function(key){angular.isObject(dataRes[key])?Object.keys(dataRes[key]).forEach(function(keyObj){angular.isArray(dataRes[key][keyObj])?dataRes[key][keyObj].forEach(function(keyArr){Object.keys(keyArr).forEach(function(keyObj2){-1==keyObj2.toString().search("^.*Err$")&&-1==keyObj2.toString().search("^.*Disabled$")&&keyArr[keyObj2]||delete keyArr[keyObj2]})}):-1==keyObj.toString().search("^.*Err$")&&-1==keyObj.toString().search("^.*Disabled$")&&dataRes[key][keyObj]||delete dataRes[key][keyObj]}):-1==key.toString().search("^.*Err$")&&-1==key.toString().search("^.*Disabled$")&&dataRes[key]||delete dataRes[key]})}dataRes&&dataRes.id&&(methodName=methodName+"/"+dataRes.id),Gateway({url:"api/lk/v1/users/"+methodName,noTestScope:!0,method:"POST",data:dataRes,authHeader:$rootScope.inOpWidget},{},f,e)},get:function(){return Gateway({url:"api/lk/v1/users/data",noTestScope:!0,method:"GET",authHeader:$rootScope.inOpWidget},{},function(data){$rootScope.settings.esia=data,$rootScope.isDesigner||PGU.Events.publish("userReady")},function(){})},switchRole:function(roleOid){return Gateway({url:"api/lk/v1/users/switch?orgId="+roleOid,noTestScope:!0,method:"GET",authHeader:$rootScope.inOpWidget},{})}},autofillService:{getAutofillValues:function(p,f,e){var df=$q.defer();return Gateway({url:CONFIG.CONTEXT_PLAY+"forms/"+p.formId+"/suggest",noTestScope:!0,method:"GET",withSessionsAttributes:!0,authHeader:$rootScope.inOpWidget},{},function(data){df.resolve(data)},function(error){df.reject(error)}),df.promise},removeAutofillValue:function(p,f,e){Gateway({url:CONFIG.CONTEXT_PLAY+"forms/"+p.formId+"/suggest/",noTestScope:!0,authHeader:$rootScope.inOpWidget,method:"DELETE",headers:{"Content-Type":"application/json;charset=utf-8"},data:{valueGroupId:[p.suggestId]}},{},f,e)},getSuggests:function(p){return Gateway({url:"api/drafts/v1/suggests",noTestScope:!0,method:"GET",headers:{"Content-Type":"application/json;charset=utf-8"},data:{formId:p.formId},authHeader:$rootScope.inOpWidget},{})},saveSuggestsWithoutDraft:function(p){return Gateway({url:"api/drafts/v1/suggests?formId="+p.formId,noTestScope:!0,method:"POST",headers:{"Content-Type":"application/json;charset=utf-8"},authHeader:$rootScope.inOpWidget,data:p.data},{})}},health:function(data,f,e){Gateway({url:$rootScope.settings.timingApi+"?"+(data||""),noTestScope:!0,method:"GET",withSessionsAttributes:!0},{},f,e)},requestSrvByUrl:function(opts,f,e){var data=angular.extend({pageIndex:opts.pageNum,pageSize:opts.pageSize},opts.requestAttrs);opts.useAtmosphere?handleAtmosphere("long-polling",opts.urlSrv,$rootScope.settings.accessToken,data,"GET",function(d){if(d||(d={error:{code:"searchIsEmpty"}}),"function"==typeof f)return f(d)}):Gateway({url:opts.urlSrv,noTestScope:!0,method:"GET",withSessionsAttributes:!1,data:data},{},f,e)},payment:{getList:function(opt,success,error){var res={};for(var item in opt)opt.hasOwnProperty(item)&&"refName"!=item&&(res[item]=opt[item]);return Gateway({url:"api/nsi/v1/dictionary/"+opt.refName,method:"POST",data:res,noTestScope:!0},{},success,error)},getUin:function(paymentCode,queryUin,success,error){var postfix=$rootScope.settings.orderId?"?orderId="+$rootScope.settings.orderId:"",url=$rootScope.settings.lkApiUrl+"paygate/uin/"+paymentCode+postfix;return Gateway({url:url,method:"POST",data:queryUin,noTestScope:!0,authHeader:$rootScope.inOpWidget},{},success,error)},checkStatus:function(paymentCode,success){var url=$rootScope.settings.lkApiUrl+"paygate/uin/status/"+paymentCode+"?orderId="+$rootScope.settings.orderId;return Gateway({url:url,method:"GET",noTestScope:!0,authHeader:$rootScope.inOpWidget},{},success,function(){})},getBillDetails:function(billNumber){var url=$rootScope.settings.lkApiUrl+"paygate/beta/add-bill-v3",attr={attrs:[{name:"epgu_order_id",value:$rootScope.settings.orderId}]};return $http({method:"POST",url:url,data:attr,params:{billNumber:billNumber,ci:!1},withCredentials:!0,authHeader:$rootScope.inOpWidget})},getListPaymentsInfo:function(params){return Gateway({url:$rootScope.settings.lkApiUrl+"orders/listpaymentsinfo",method:"POST",data:params},{})}},signConfirm:function(f,e){var url=$rootScope.settings.lkApiUrl+"orders/"+$rootScope.settings.orderId+"/sign/confirm";Gateway({url:url,method:"GET",authHeader:$rootScope.inOpWidget},{},f,e)},getFeedGepsById:function(p,f,e){var url="api/lk/v1/feeds/GEPS/"+p.id;return Gateway({url:url},p,f,e)},invitationService:{sendInvitation:function(data,f,e,type){Gateway({url:"api/lk/v1/orders/"+$rootScope.settings.orderId+"/invitations/"+(type||"inviteToSign")+"/send",method:"POST",data:data,noTestScope:!0,authHeader:$rootScope.inOpWidget},{},function(response){f(response)},function(response,data){e(data)},!1)},signReset:function(){var df=$q.defer();return Gateway({url:$rootScope.settings.lkApiUrl+"orders/"+$rootScope.settings.orderId+"/sign/reset",method:"GET",authHeader:$rootScope.inOpWidget},{},function(data){df.resolve(data)},function(textError){df.reject(textError)}),df.promise},getStatus:function(type){var invitationType=type||"inviteToSign",url=$rootScope.settings.lkApiUrl+"orders/"+$rootScope.settings.orderId+"/invitations/"+invitationType+"/status";return Gateway({url:url,method:"GET",authHeader:$rootScope.inOpWidget},{})},getStatusHistory:function(){var url=$rootScope.settings.lkApiUrl+"orders/"+$rootScope.settings.orderId;return Gateway({url:url,method:"GET",authHeader:$rootScope.inOpWidget,data:{embed:"STATUS_HISTORY"}},{})},deleteAgreement:function(id){var url=$rootScope.settings.lkApiUrl+"orders/"+$rootScope.settings.orderId+"/invitation/"+id;return Gateway({url:url,method:"DELETE",authHeader:$rootScope.inOpWidget},{})},deleteAgreements:function(type){var url=$rootScope.settings.lkApiUrl+"orders/"+$rootScope.settings.orderId+"/invitations/"+type;return Gateway({url:url,method:"DELETE",authHeader:$rootScope.inOpWidget},{})},signConfirmThirdParties:function(f,e){var url=$rootScope.settings.lkApiUrl+"orders/"+$rootScope.settings.orderId+"/sign/confirm";return Gateway({url:url,method:"GET",authHeader:$rootScope.inOpWidget},{},f,e)}},checkNote:function(serviceId,orderId,callback){var url=$rootScope.settings.lkApiUrl+"invitations/check/"+serviceId+"/"+orderId;return Gateway({url:url,method:"GET",authHeader:$rootScope.inOpWidget},{},function(response){callback&&callback.done&&callback.done(response)},function(error){callback&&callback.error&&callback.error(error)})},selectRegion:function(data,f,e){Gateway({url:LOC.WIDGET_URI+"api/nsi/v1/epgu/region/",data:data,noTestScope:!0,method:"GET",withSessionsAttributes:!0},{},f,e)},selectRegionTitle:function(data,f,e){return Gateway({url:LOC.WIDGET_URI+"api/nsi/v1/epgu/region/"+data,noTestScope:!0,method:"GET",withSessionsAttributes:!0},{},f,e)},getSingleMandate:function(data,f,e){var url="api/nsi/v1/uik/coords/singleMandate?latitude="+data.latitude+"&longitude="+data.longitude;return Gateway({url:LOC.WIDGET_URI+url,noTestScope:!0,method:"GET",withSessionsAttributes:!0},{},f,e)},editableGridUpdateRequest:function(p){var url="api/storage/v1/de/"+p.orderId+"/"+p.mnemonic+"/"+p.action,request={},method="POST",q=p.q?"q="+p.q+"&":"";return"del"===p.action&&(url+="/"+p.id),p.gridItemData&&(request.data=p.gridItemData),"find"===p.action&&(method="GET",url+="?"+q+"pageNum="+p.pageNum+"&pageSize="+p.pageSize),Gateway({url:url,method:method,noTestScope:!0,authHeader:$rootScope.inOpWidget},request)},smsService:{checkCode:function(code){var url=$rootScope.settings.lkApiUrl+"orders/"+$rootScope.settings.orderId+"/sms/confirm/check"+(code?"?code="+code:"");return Gateway({url:url,noTestScope:!0,authHeader:$rootScope.inOpWidget},{})},getCode:function(){var url=$rootScope.settings.lkApiUrl+"orders/"+$rootScope.settings.orderId+"/sms/confirm/send";return Gateway({url:url,method:"POST",noTestScope:!0,authHeader:$rootScope.inOpWidget},{})}},CMSService:{getBanners:function(param,f,e){return Gateway({url:"api/quadrupel/v1/banners",noTestScope:!0,method:"GET",withSessionsAttributes:!0,data:param,authHeader:$rootScope.inOpWidget},{},f,e)}},ElectionService:{getElectionData:function(params,success,error){return Gateway({url:$rootScope.settings.electionApiUrl+"election/offer",data:params,noTestScope:!0,authHeader:$rootScope.inOpWidget},{},success,error)},getListByBounds:function(bounds,usercoords,codes,singleMandateCode,kladrCode){var request={bounds:bounds||[],usercoords:usercoords||[],oids:codes||[],kladrCode:kladrCode||""};return singleMandateCode&&(request.singleMandateCode=singleMandateCode),Gateway({url:"api/nsi/v1/uik/search",method:"POST",noTestScope:!0},{data:request})},getListByBoundsOkrugNum:function(bounds,usercoords,codes,singleMandateCode,subjCode,okrugNum,electionLevel,withDigital){return Gateway({url:"api/nsi/v1/election/uik/search",method:"POST",noTestScope:!0},{data:{bounds:bounds||[],usercoords:usercoords||[],oids:codes||[],subjCode:subjCode,withDigital:withDigital,electionLevel:electionLevel,okrugNum:okrugNum}})},getListItemByBounds:function(objectId){return Gateway({url:"api/nsi/v1/uik/"+objectId,method:"GET",noTestScope:!0},{})},getListItemByBoundsUikByNum:function(objectId,subjCode){return Gateway({url:"api/nsi/v1/election/uikByNum/"+objectId+(subjCode?"/"+subjCode:""),method:"GET",noTestScope:!0},{})},getElectionsByUikAndDate:function(obj){return Gateway({url:"api/elections/v1/election/electionsByUikAndDate",data:obj,method:"GET",noTestScope:!0},{})},getSingleMandateData:function(param){return Gateway({url:"api/nsi/v1/uik/coords/singleMandate",method:"GET",noTestScope:!0,data:param},{})}},markerDictionary:function(dictionary,param){var df=$q.defer();return Gateway({url:"api/nsi/v1/dictionary/marker/"+dictionary,method:"POST",noTestScope:!0,data:param},{},function(data){df.resolve(data)},function(error){df.reject(error)},!1),df.promise},ElectronMedicalDocsService:{getDocs:function(orderId,param,success,error){return Gateway({url:"api/storage/v1/xml/"+orderId+"/120/"+orderId+"_getDocumentList66172_webservice/search",method:"POST",noTestScope:!0,data:param,authHeader:$rootScope.inOpWidget},{},success,error,!1)},getFilters:function(orderId,param,success,error){return Gateway({url:"api/storage/v1/meddoc/"+orderId+"/"+orderId+"_getDocumentList66172_webservice/filters",method:"POST",noTestScope:!0,data:param,authHeader:$rootScope.inOpWidget},{},success,error,!1)}},setOrderNote:function(orderId,text){return Gateway({method:"POST",url:$rootScope.settings.lkApiUrl+"orders/"+orderId+"/note",withCredentials:!0,data:{text:text},authHeader:$rootScope.inOpWidget},{})},getOrders:function(param){var df=$q.defer();return Gateway({url:$rootScope.settings.lkApiUrl+"orders",method:"GET",noTestScope:!0,data:param,authHeader:$rootScope.inOpWidget},{},function(data){df.resolve(data)},function(error){df.reject(error)},!1),df.promise},DCService:{getKindergartenQueue:function(orderId){var df=$q.defer();return Gateway({url:$rootScope.settings.lkApiUrl+"hub/kindergarten/"+orderId,method:"GET",noTestScope:!0,authHeader:$rootScope.inOpWidget},{},function(data){df.resolve(data)},function(error){df.reject(error)},!1),df.promise},getDCDictionariesInfo:function(dictionary,param){var df=$q.defer();return Gateway({url:"api/nsi/v1/dictionary/"+dictionary,method:"POST",noTestScope:!0,data:param},{},function(data){df.resolve(data)},function(error){df.reject(error)},!1),df.promise}},getRestData:function(url,requestType,data,withAuthHeader){var df=$q.defer(),request={url:url,method:requestType,noTestScope:!0,authHeader:withAuthHeader};return data&&(request.data=data),Gateway(request,{},function(data){df.resolve(data)},function(error){df.reject(error)},!1),df.promise},getLangLabel:function(formId,key){var df=$q.defer();return Gateway({url:LOC.WIDGET_URI+"api/cms/v1/i18/groups/"+formId+"?lang="+key,method:"GET",noTestScope:!0,authHeader:$rootScope.inOpWidget},{},function(data){df.resolve(data)},function(error){df.reject(error)},!1),df.promise},getLangValidators:function(param,key){var df=$q.defer();return Gateway({url:LOC.WIDGET_URI+"api/cms/v1/i18/groups/pgu_validator/keys?lang="+key,method:"POST",data:param,noTestScope:!0,authHeader:$rootScope.inOpWidget},{},function(data){df.resolve(data)},function(error){df.reject(error)},!1),df.promise},getLangHints:function(param,key){var df=$q.defer();return Gateway({url:LOC.WIDGET_URI+"api/cms/v1/i18/groups/pgu_hint/keys?lang="+key,method:"POST",data:param,noTestScope:!0,authHeader:$rootScope.inOpWidget},{},function(data){df.resolve(data)},function(error){df.reject(error)},!1),df.promise},captcha:{validateToken:function(param){var df=$q.defer();return Gateway({url:"api/lk/v1/ecaptcha/validate?verifyToken="+param.verifyToken+"&orderId="+param.orderId,method:"GET",noTestScope:!0,authHeader:$rootScope.inOpWidget},{},function(data){df.resolve(data)},function(error){df.reject(error)},!1),df.promise}},checkSign:{getCheckStatus:function(orderId){return Gateway({url:"api/storage/v1/files/"+orderId,method:"GET",headers:{Accept:"application/json","Content-Type":"application/json;charset=utf-8",Schema:"http://ru.gosuslugi.storageservice.api/files/eds"},authHeader:$rootScope.inOpWidget},{})},getResult:function(orderId,signedMnemonic){return Gateway({url:$rootScope.settings.lkApiUrl+"orders/"+orderId+"/edsResult",method:"POST",data:{link:"terrabyte://00/"+orderId+"/"+signedMnemonic+"/107"},authHeader:$rootScope.inOpWidget},{})},updateSignedMnemonics:function(orderId,mainMnemonic,signedFilesMnemonics){return Gateway({url:"api/storage/v1/files/"+orderId+"/2/"+mainMnemonic+"/update",method:"POST",data:signedFilesMnemonics,authHeader:$rootScope.inOpWidget},{})}},mfcDelivery:{getData:function(orderId){var ot=$rootScope.env.systemData.orderType,isResend=["MFC","MFC_RESEND"].includes(ot);return Gateway({url:"api/lk/v1/mfc/"+(isResend?"getOrderByMfcId/":"getOrder/")+orderId,method:"GET",noTestScope:!0,authHeader:$rootScope.inOpWidget},{})},setData:function(params){return Gateway({url:"api/lk/v1/mfc/order",method:"POST",noTestScope:!0,data:params,authHeader:$rootScope.inOpWidget},{})}},sopService:{loadList:function(params,f,e,noCache){var key=JSON.stringify(params);if(!noCache&&(PGU.sopListCache=PGU.sopListCache||{},PGU.sopListCache[key]))return f(PGU.sopListCache[key]);var url;return url=$rootScope.env.formParam&&"true"===$rootScope.env.formParam.dictionarySopTest?$rootScope.settings.sopTestUrl:$rootScope.settings.sopUrl,Gateway({url:url+"cps-data-api/api/v1/data",method:"POST",noTestScope:!0,data:params,headers:$rootScope.settings.sopAuthData},{},function(data){if(PGU.sopListCache=PGU.sopListCache||{},PGU.sopListCache[key]=data,"function"==typeof f)return f(data)},function(error,response){if("function"==typeof e)return e(error)})}},digitalProfile:{getDocuments:function(){return Gateway({url:"api/lk/v1/users/digit/docs",noTestScope:!0,method:"GET",authHeader:$rootScope.inOpWidget},{})},attachDocumentsToOrder:function(docs,orderId){return Gateway({url:"api/storage/v1/orders/"+orderId+"/attach/digit/docs",noTestScope:!0,method:"POST",authHeader:$rootScope.inOpWidget,data:docs},{})}}}}]),angular.module("serverForm.services").factory("controlAttrs",function($rootScope){return{attrs:{name:{type:"string",default:"",checkInput:"onlyLatin","scope:noChanges":!0},fullPath:{type:"string",default:"","scope:editor":!1,"scope:noChanges":!0},id:{type:"string","scope:editor":!1,"scope:model":!1,"scope:noChanges":!0},visible:{type:"boolean",enum:[!0,!1],enumOptions:{true:"Да",false:"Нет"},default:!0,humanity:"видно","scope:ruleEditor":!0},handlers:{default:[],"scope:sync":!1,"scope:editor":$rootScope.isAdminUser,"scope:noChanges":!0},isValid:{type:"boolean",value:!0,default:!0,"scope:model":!1,"scope:editor":!1,"scope:sync":!1},isServiceField:{type:"boolean",default:!1,"scope:model":!1,"scope:editor":!1,"scope:sync":!1,"scope:noChanges":!0}}}}).factory("containerAttrs",["controlAttrs",function(controlAttrs){return{attrs:angular.extend({fixName:{type:"boolean",enum:[!0,!1],enumOptions:{true:"Да",false:"Нет"},default:!1,"scope:editor":!1,"scope:noChanges":!0},hasRules:{type:"boolean","scope:editor":!1,default:!0,"scope:noChanges":!0},originalFrom:{"scope:editor":!1,default:"container","scope:noChanges":!0}},controlAttrs.attrs)}}]).factory("basePanelAttrs",["containerAttrs","$rootScope",function(containerAttrs,$rootScope){return{attrs:angular.extend({},containerAttrs.attrs,{title:{default:"Название панели",humanity:"заголовок","scope:ruleEditor":!0},html:{"scope:ruleEditor":!0,"scope:editor":$rootScope.isAdminUser}})}}]).factory("fieldAttrs",["controlAttrs","Validators","$rootScope",function(controlAttrs,Validators,$rootScope){return{attrs:angular.extend({},controlAttrs.attrs,{value:{type:"string",default:"",humanity:"значение","scope:sync":!0,"scope:ruleEditor":!0},validators:{default:[],"scope:ruleEditor":!0,"scope:noChanges":!0},required:{type:"boolean",default:!1,humanity:"обязательное","scope:ruleEditor":!0},notRequiredText:{type:"string",default:"необязательно",humanity:"текст необязательное","scope:noChanges":!0},disabled:{type:"boolean",default:!1,humanity:"Недоступно","scope:ruleEditor":!0,"scope:editor":$rootScope.isAdminUser},readonly:{type:"boolean",default:!1,humanity:"только чтение","scope:ruleEditor":!0,"scope:editor":$rootScope.isAdminUser},immutable:{type:"boolean",default:!1,humanity:"неизменяемое","scope:ruleEditor":!0,"scope:editor":$rootScope.isAdminUser},label:{type:"string",default:"Подпись","scope:ruleEditor":!0},labelAlign:{type:"string",enum:["Left","Top"],enumOptions:{Left:"Слева",Top:"Сверху"},default:"Left","scope:editor":!1,"scope:noChanges":!0},labelWidth:{type:"string",enum:["20","40","60","80","100"],enumOptions:{20:"20%",40:"40%",60:"60%",80:"80%",100:"100%"},default:"20","scope:editor":!1,"scope:noChanges":!0},hint:{type:"string",default:"","scope:ruleEditor":!0,"scope:noChanges":!0},error:{value:"","scope:model":!1,"scope:editor":!1},inlineCSS:{type:"string",default:"","scope:editor":!1,"scope:noChanges":!0},originalFrom:{"scope:editor":!1,default:"field","scope:noChanges":!0},isAnswer:{type:"boolean",default:!1,"scope:editor":$rootScope.isAdminUser}})}}]),angular.module("serverForm.services").factory("commonPresets",["$rootScope","DEFAULT_NAVIGATION_HANDLERS",function($rootScope,DEFAULT_NAVIGATION_HANDLERS){var _activePreset;return{getList:function(){
var arrPresets=[{name:"Информер",type:"base",desc:"Информер для отображения статуса уже получаемых услуг",model:{engineVersion:"EnginePlayerBase",className:"Informer",rules:[],items:[]}},{name:"Информеры",type:"base",desc:"Задолженности перед государством (все доступные информеры)",model:{engineVersion:"EnginePlayerBase",className:"Informers",rules:[],items:[]}},{name:"Форма",type:"base",desc:"Форма",model:{engineVersion:"EnginePlayerBase",className:"Form",rules:[],items:[]}},{name:"Форма с навигацией",type:"baseWithNavigation",desc:"Форма с навигацией",model:{engineVersion:"EnginePlayerBaseWithNavigation",className:"Form",items:[{className:"NavPanel",visible:!1,items:[{className:"FormButton",name:"__prevStep",handlers:[{listen:[{component:"__prevStep",events:["click"]}],handler:DEFAULT_NAVIGATION_HANDLERS.EnginePlayerBase.prev.toString().replace(/\n/g,"")}],label:"Назад",action:"prev",floating:"PGU-BtnFloat"},{className:"FormButton",name:"__nextStep",handlers:[{listen:[{component:"__nextStep",events:["click"]}],handler:DEFAULT_NAVIGATION_HANDLERS.EnginePlayerBase.next.toString().replace(/\n/g,"")}],label:"Далее",action:"next",balign:"right",floating:"PGU-BtnFloat"}],rules:[]}],rules:[]}},{name:"Форма-Online ПГУ",type:"online",desc:"Форма-Online ПГУ",model:{engineVersion:"EnginePlayerPguOnline",hidePreview:"true",className:"Form",submitEvent:[{_id:0,eventType:"submit",serviceKey:"",soapAction:"",requestAppDataTransformer:"",requestTransformer:"",responseTransformer:"",submitType:"FINAL",xmlPayloadType:"PUBLIC_API_XML"},{_id:1,eventType:"submit",context:{},requestBinding:{push:{messageId:"__messageId"},order:{id:"__orderId"}},responseBinding:{},processor:"pushStatusProcessor"},{_id:2,eventType:"submit",context:{xml:{htmlTransformer:"",formTransformer:""}},requestBinding:{push:{messageId:"__messageId"},order:{id:"__orderId"}},responseBinding:{},processor:"getOnlineResultProcessor"}],items:[{className:"NavPanel",visible:!1,submitEvents:{},items:[{className:"FormButton",name:"__prevStep",handlers:[{listen:[{component:"__prevStep",events:["click"]}],handler:DEFAULT_NAVIGATION_HANDLERS.EnginePlayerPgu.prev.toString().replace(/\n/g,"")}],label:"Назад",action:"prev",floating:"PGU-BtnFloat",fullPath:"__prevStep"},{className:"FormButton",name:"FormButtonShowInfo",fullPath:"NavPanel.FormButtonShowInfo",handlers:[{listen:[{component:"NavPanel.FormButtonShowInfo",events:["click"]}],handler:DEFAULT_NAVIGATION_HANDLERS.EnginePlayerPgu.showInfo.toString().replace(/\n/g,"")}],label:"Описание услуги",action:"view-info",floating:"PGU-BtnFloat",submitEvents:{}},{className:"FormButton",name:"__nextStep",handlers:[{listen:[{component:"__nextStep",events:["click"]}],handler:DEFAULT_NAVIGATION_HANDLERS.EnginePlayerPguOnline.next.toString().replace(/\n/g,"")}],label:"Далее",action:"next",balign:"right",floating:"PGU-BtnFloat",submitEvents:{}}],rules:[]}],rules:[]}}];return arrPresets.push(this.getMainPreset()),arrPresets},set:function(preset){_activePreset=preset,$rootScope.$broadcast("activePresetUpdated")},get:function(){return _activePreset||this.getMainPreset()},getMainPreset:function(){return{name:"Форма ПГУ",type:"pgu",desc:"Форма ПГУ",model:{engineVersion:"EnginePlayerPgu",className:"Form",name:"form",fullPath:"form",maxSizeAllFile:1e6,showAllSteps:!0,stepsOnTop:!1,autoSetStepNumbers:!0,submitEvents:{submit:[{eventType:"submit",serviceKey:"",soapAction:"",requestAppDataTransformer:"",requestTransformer:"",responseTransformer:"",submitType:"FINAL",xmlPayloadType:"PUBLIC_API_XML",_id:0}]},items:[{className:"FormStep",name:"FormStepService",fullPath:"form.FormStepService",label:"",title:"Служебный шаг",visible:!1,submitEvents:{submit:[{eventType:"submit",_id:0,context:{},requestBinding:{order:{id:"__orderId"},draft:{id:"__draftId",version:"__draftVersion"}},responseBinding:{draft:{id:"__draftId",version:"__draftVersion"}},processor:"saveDraftProcessor"}]},items:[{className:"Panel",name:"PanelService",fullPath:"form.FormStepService.PanelService",title:"",items:[{className:"FieldTextDate",name:"currentDate",fullPath:"form.FormStepService.PanelService.currentDate",notRequiredText:"",label:"Текущая дата",strategy:"current_date",forceXml:!0,immutable:!0,isServiceField:!0},{className:"FieldText",name:"userType",fullPath:"form.FormStepService.PanelService.userType",notRequiredText:"",label:"Тип текущего пользователя",strategy:"user_type",forceXml:!0,immutable:!0,isServiceField:!0},{className:"FieldText",name:"orderId",fullPath:"form.FormStepService.PanelService.orderId",notRequiredText:"",label:"Номер заявления",strategy:"order_id",forceXml:!0,immutable:!0,isServiceField:!0},{className:"FieldText",name:"orderStatusCode",fullPath:"form.FormStepService.PanelService.orderStatusCode",notRequiredText:"",label:"Код режима внесения данных",strategy:"order_status_code",forceXml:!0,immutable:!0,isServiceField:!0},{className:"FieldText",name:"orgBrief",fullPath:"form.FormStepService.PanelService.orgBrief",notRequiredText:"",label:"ЮЛ и ИП: Является ли генеральным директором",strategy:"organizationbrief_and_businessmanbrief_isheadperson",forceXml:!0,immutable:!0,isServiceField:!0},{className:"FieldText",name:"formTargetId",fullPath:"form.FormStepService.PanelService.formTargetId",notRequiredText:"",label:"Код цели обращения",strategy:"form_target_id",forceXml:!0,immutable:!0,isServiceField:!0},{className:"FieldText",name:"formTargetName",fullPath:"form.FormStepService.PanelService.formTargetName",notRequiredText:"",label:"Наименование цели обращения",strategy:"form_target_name",forceXml:!0,immutable:!0,isServiceField:!0},{className:"FieldText",name:"formDepartmentId",fullPath:"form.FormStepService.PanelService.formDepartmentId",notRequiredText:"",label:"Код ведомства",strategy:"form_target_org_id",forceXml:!0,immutable:!0,isServiceField:!0},{className:"FieldText",name:"formDepartmentName",fullPath:"form.FormStepService.PanelService.formDepartmentName",notRequiredText:"",label:"Наименование ведомства",strategy:"form_target_org_name",forceXml:!0,immutable:!0,isServiceField:!0}],rules:[]}],rules:[]},{className:"NavPanel",name:"NavPanel",fullPath:"form.NavPanel",visible:!0,submitEvents:{},handlers:[{listen:[{component:"form.NavPanel",events:["click"]}],handler:DEFAULT_NAVIGATION_HANDLERS.EnginePlayerPgu.main.toString()}],items:[{className:"FormButton",name:"__prevStep",visible:!1,doNotShow:!0,fullPath:"form.NavPanel.__prevStep",handlers:[{listen:[{component:"form.NavPanel.__prevStep",events:["click"]}],handler:DEFAULT_NAVIGATION_HANDLERS.EnginePlayerPgu.prev.toString()}],label:"Назад",action:"prev",floating:"PGU-BtnFloat"},{className:"FormButton",name:"FormButtonShowInfo",fullPath:"form.NavPanel.FormButtonShowInfo",doNotShow:!0,visible:!1,handlers:[{listen:[{component:"form.NavPanel.FormButtonShowInfo",events:["click"]}],handler:DEFAULT_NAVIGATION_HANDLERS.EnginePlayerPgu.showInfo.toString()}],label:"Описание услуги",action:"view-info",floating:"PGU-BtnFloat",submitEvents:{}},{className:"FormButton",name:"__nextStep",fullPath:"form.NavPanel.__nextStep",visible:!1,doNotShow:!0,handlers:[{listen:[{component:"form.NavPanel.__nextStep",events:["click"]}],handler:DEFAULT_NAVIGATION_HANDLERS.EnginePlayerPgu.next.toString()}],label:"Далее",action:"next",balign:"right",floating:"PGU-BtnFloat",submitEvents:{}}],rules:[]}],rules:[]}}}}}]),angular.module("serverForm.filters",[]).filter("decapitalize",[function(){return function(text){return text.substring(0,1).toLowerCase()+text.substring(1)}}]).filter("convertDate",["$moment",function($moment){return function(date,src,dst){var d=$moment(date,src);return d.isValid()?d.format(dst):""}}]).filter("filterFileSize",[function(){return function(fileSize){return fileSize<=102400?Math.ceil(fileSize/1024)+" Кб":Math.round(fileSize/1024/1024*100)/100+" Мб"}}]).filter("orderObjectBy",function(){return function(items,field,reverse){function index(obj,i){return obj[i]}var filtered=[];return angular.forEach(items,function(item){filtered.push(item)}),filtered.sort(function(a,b){var reducedA=field.split(".").reduce(index,a),reducedB=field.split(".").reduce(index,b);return reducedA===reducedB?0:reducedA>reducedB?1:-1}),reverse&&filtered.reverse(),filtered}}).filter("range",function(){return function(input,total){total=parseInt(total);for(var i=0;i<total;i++)input.push(i);return input}}).filter("startFrom",function(){return function(input,page){return input&&input.length?input.slice(page,input.length):input}}).filter("to_trusted",["$sce",function($sce){return function(text){return angular.isString(text)?$sce.trustAsHtml(text):text}}]).filter("textResource",["textResources",function(textResources){return function(mnemonic){return textResources.getResourceByMnemonic(mnemonic)||""}}]).filter("translate",["translate",function(translate){var filter=function(input,text,index){input=input&&input.length?input.replace(/ *\[[^)]*\] */g,""):void 0,translate.setRuLang(input,text,index);var translateStr,translations=translate.getLangList()||[];if(translateStr=translations[input]?translations[input]:text,void 0!==index){var str=translations[input];if(str)try{translateStr=JSON.parse(str)[index].label}catch(err){}}return translateStr};return filter.$stateful=!0,filter}]).filter("filterListItems",[function(){return function(list,filter){function replaceSymbols(word){return word.toString().trim().toLowerCase().replace(/ё/g,"е")}if(!filter)return list;var updFilter=replaceSymbols(filter);return list.filter(function(item){return replaceSymbols(item.title).includes(updFilter)})}}]),angular.module("serverForm.constants").constant("CONFIG",function(){return{CONTEXT_DES:"api/sf/v1/designer/",CONTEXT_PLAY:"api/sf/v1/player/",ESIA_LK:device.mobile()?"https://esia.gosuslugi.ru/m/profile/user/personal":"https://esia.gosuslugi.ru/profile/user/person.xhtml",CONTEXT_INCOMING_PLAY:"api/sf-widget/v1/player/"}}()).constant("LOC",function(){var getCfg=function(key,defaultV){var cfg=window.serverData&&window.serverData.config;return cfg&&cfg[key]||defaultV},loc=getCfg("baseUrl","https://www.gosuslugi.ru/"),res_loc=getCfg("resourceUrl","https://www.gosuslugi.ru/widgets/"),epgu_loc=getCfg("baseUrl","https://www.gosuslugi.ru/"),esia_loc=getCfg("siaWebHost","https://esia.gosuslugi.ru/");return{URI:"",WIDGET_URI:loc,RESOURCE_URI:res_loc,EPGU_URI:epgu_loc,ESIA_URI:esia_loc+"registration/",ESIA_BASE:esia_loc,STATIC_DOMAIN:getCfg("staticDomain","//gu-st.ru/htdocs/")}}()).constant("RULE_SYNTAX_TOKEN",function(){return{tokenPlace:/\s*(\d+)\s*/.source}}()).constant("RULE_SYNTAX",function(){return{"==":{tmpl:"mixed==mixed",result:"boolean",humanity:"равно",editor:[0,"равно",1],isGlobalOperator:!1},"!=":{tmpl:"mixed!=mixed",result:"boolean",humanity:"не равно",editor:[0,"не равно",1],isGlobalOperator:!1},"<=":{tmpl:"number<=number",result:"boolean",humanity:"не больше",editor:[0,"не больше",1],isGlobalOperator:!1},"<":{tmpl:"number<number",result:"boolean",humanity:"меньше",editor:[0,"меньше",1],isGlobalOperator:!1},">=":{tmpl:"number>=number",result:"boolean",humanity:"не меньше",editor:[0,"не меньше",1],isGlobalOperator:!1},">":{tmpl:"number>number",result:"boolean",humanity:"больше",editor:[0,"больше",1],isGlobalOperator:!1},"&&":{tmpl:"boolean&&boolean",result:"boolean",humanity:"и",editor:[0,"и",1],isGlobalOperator:!0},"||":{tmpl:"boolean\\|\\|boolean",result:"boolean",humanity:"или",editor:[0,"или",1],isGlobalOperator:!0},"?:":{tmpl:"boolean\\?mixed:mixed",result:"mixed",resultType:function(parsed){return this.argType(1,parsed)&&this.argType(1,parsed)==this.argType(2,parsed)?this.argType(1,parsed):this.result},argType:function(i,parsed){return i>0&&parsed.args[i]?parsed.args[i].preciselyType||parsed.args[i].type:this.args[i]},humanity:"если",editor:[1,"если",0,"иначе",2],isGlobalOperator:!1},"#":{tmpl:"mixed#mixed",result:"boolean",humanity:"содержит",editor:[0,"содержит",1],isGlobalOperator:!1},"=":{tmpl:"var=mixed",result:"mixed",argType:function(i,parsed,container){return parsed&&parsed.args[i]&&parsed.args[i].resultType(container)||this.args[i]},expectedArgType:function(i,parsed,container){return 1==i&&parsed.args[0]?parsed.resultType(container):this.args[i]},humanity:"если",editor:[0,function(parsed,container){return"boolean"==parsed.operator.argType(0,parsed,container)?"если":"равно"},1]}}}()).constant("RULE_REPLACE_REGEXP",function(){var ATTRIBUTE=/\b[a-zA-Z]\w*(?:\.[a-zA-Z_]\w*)*(?:@(?:all|taxAreaCode|month|maxCloned|year|date|visible|disabled|readonly|required|immutable|checked|unchecked|value|validators|title|label|longLabel|text|shaded|apartmentLabel|hint|removeOpts|parentItem|dictionary\.\w+))?\b/.source,NUMBER=/0[xХ][\da-fA-F]+|(?:\d+\.\d*|\d+|\.\d+)(?:[eE][+-]?\d+)?/.source,STRING=/'[^'\\\n]*(?:\\[^\n][^'\\\n]*)*(?:\\\n(?:[^'\\\n]*(?:\\[^\n][^'\\\n]*)*)*)*'|"[^"\\\n]*(?:\\[^\n][^"\\\n]*)*(?:\\\n(?:[^"\\\n]*(?:\\[^\n][^"\\\n]*)*)*)*"/.source,BOOLEAN=/\b(?:false|true)\b/.source;return{anyScalarOrAttrRegexp:new RegExp("("+NUMBER+"|"+STRING+"|"+BOOLEAN+")|("+ATTRIBUTE+")","g")}}()).constant("FORM_STEPS_PAGE_SIZE",function(){return{VALUE:3}}()).constant("TEMPLATES",function(){return{INFORMER:"js/components/Informer/Informer.html",INFORMER_NOTIFY:"js/components/InformerNotify/InformerNotify.html",INFORMERS:"js/components/InformersAll/Informers.html",FORM:"js/components/Form/Form.html",FORM_STEP:"js/components/FormStep/FormStep.html",FORM_PREVIEW:"js/components/FormPreview/FormPreview.html",PANEL:"js/components/Panel/Panel.html",FIELD_TEXT:"js/components/FieldText/FieldText.html",FIELD_TEXT_DATE:"js/components/FieldTextDate/FieldTextDate.html",FIELD_TEXT_AREA:"js/components/FieldTextArea/FieldTextArea.html",FIELD_RADIO:"js/components/FieldRadio/FieldRadio.html",FIELD_CHECKBOX:"js/components/FieldCheckbox/FieldCheckbox.html",FIELD_UPLOAD:"js/components/FieldUpload/FieldUpload.html",NALOG_LIST:"js/components/NalogList/NalogList.html",WORK_FMS:"js/components/PanelWorkActivity/PanelWorkActivity.html",FIELD_MAP:"js/components/FieldMap/FieldMap.html",FIELD_MAP_WITH_LIST_MOBILE:"js/components/FieldMap/FieldMapWithList-Mobile.html",FIELD_MAP_WITH_LIST_DC_MOBILE:"js/components/FieldMap/FieldMapWithListDC-Mobile.html",LABEL:"js/components/Label/Label.html",BUTTON:"js/components/FormButton/FormButton.html",NAV_PANEL:"js/components/NavPanel/NavPanel.html",INNER_STEP:"js/components/InnerStep/InnerStep.html",STATE_STRUCTURE:"js/components/StateStructure/StateStructure.html",HELPER_BOX:"js/components/HelperBox/HelperBox.html",FIELD_DROPDOWN:"js/components/FieldDropdown/FieldDropdown.html",FIELD_DROPDOWN_HIERARCHIC_MULTIPLE:"js/components/FieldDropdownHierarchicMultiple/FieldDropdownHierarchicMultiple.html",DATAGRID:"js/components/DataGrid/DataGrid.html",SELECT:"js/components/FieldDropdown/select.html",TIME_SLOT_EXT:"js/components/TimeSlotExt/TimeSlotExt.html",MODAL_DIALOG:"js/shared/tmpl/modal-dialog.html",MODAL_DIALOG_ESIA:"js/shared/tmpl/modal-dialog-esia.html",REGION_SELECTED:"js/shared/tmpl/region-selected.html",SIMPLE_BUTTON:"js/shared/tmpl/simple-button.html",KLADR:"js/components/Kladr/Kladr.html",KLADRDROPDOWN:"js/components/KladrDropdown/KladrDropdown.html",IMAGE_EDITOR:"js/components/ImageEditor/ImageEditor.html",FIAS:"js/components/Fias/Fias.html",FIELD_INN:"js/components/FieldInn/FieldInn.html",FIELD_BP:"js/components/FieldBirthPlace/FieldBirthPlace.html",FIELD_ADDRESS:"js/components/FieldAddress/FieldAddress.html",FIELD_DL:"js/components/FieldDrivingLicense/FieldDrivingLicense.html",FIELD_TC:"js/components/FieldVehicle/FieldVehicle.html",AUTOMOTIVE_AXLES:"js/components/AutomotiveAxles/AutomotiveAxles.html",INITIAL_IMPACT:"js/components/InitialImpact/InitialImpact.html",ADVICE:"js/components/Advice/Advice.html",TABLEDICTIONARY:"js/components/TableDictionary/TableDictionary.html",PAYMENT:"js/components/Payment/Payment.html",TABLE:"js/components/Table/Table.html",INVITATION_PANEL:"js/components/InvitationPanel/InvitationPanel.html",INVITATION_PANEL_EUROPROTOCOL:"js/components/InvitationPanelEuroprotocol/InvitationPanelEuroprotocol.html",EDITABlEDATAGRID:"js/components/EditableDataGrid/EditableDataGrid.html",CONFIRM_PANEL:"js/components/ConfirmPanel/ConfirmPanel.html",SMS_CONFIRM_DIALOG:"js/components/SMSConfirmDialog/SMSConfirmDialog.html",CLINIC_EXAM:"js/components/ClinicExam/ClinicExam.html",ELECTRON_MEDICAL_DOCS:"js/components/ElectronMedicalDocs/ElectronMedicalDocs.html",ORDER_LIST_DC:"js/components/OrderListDC/OrderListDC.html",THROBBER:"js/shared/tmpl/throbber.html",BUNDLES:"js/components/Bundles/Bundles.html",CAPTCHA:"js/components/Captcha/Captcha.html",LANG:"js/shared/tmpl/lang.html",LIST_KIDS:"js/components/ListKids/ListKids.html",LIST_REFERRAL:"js/components/ListReferral/ListReferral.html",LIST_SPECIALISTS:"js/components/ListSpecialists/ListSpecialists.html",SVGCIRCLEPROGRESS:"js/shared/tmpl/svgCircleProgress.html",PREVIEW_GEPS_MAIL:"js/components/PreviewGEPSMail/PreviewGEPSMail.html"}}()).constant("RegExpCompiled",function(){return{rulesChangeOld:new RegExp(/(^|[^\"])\b([a-zA-Z]\w*(?:\.[a-zA-Z]\w*)*)(@[\w\.]+)?/g),testVCT:new RegExp(/^(value|checked|taxAreaCode)$/)}}()).constant("CLASSES",function(){return{Informer:"Информер",Informers:"Информеры",Form:"Форма",FormStep:"Шаг формы",Panel:"Панель",DataGrid:"Датагрид",DataGridExt:"Data Grid Ext",DataSource:"Источник данных",FieldCheckbox:"Чекбокс",FieldDropdown:"Выпадающий список",FieldDropdownHierarchicMultiple:"Выпадающий список мультииерархический",FieldDropdownExt:"Выпадающий список (ds)",FieldDropdownHierarchic:"Выпадающий список иерархический",FieldDropdownHierarchicExt:"Иерархический список (ds)",FieldDropdownMultiple:"Выпадающий список мультиселект",FieldDropdownMultipleExt:"Мультиселект (ds)",FieldDropdownMultipleExt2v:"Мультиселект (2)",DropdownSearchForChild:"ОКАТО",FieldList:"Список",FieldRadio:"Радио",FieldText:"Текстовое поле",FieldTextArea:"Многострочное поле",FieldTextDate:"Календарь",FieldUpload:"Поле для загрузки файла",FieldUploadCustom:"Поле для загрузки файла",FieldUploadPC:"Поле загрузки файла из ЛК",FieldUploadDictionary:"Загрузка справочника",Label:"Текстовая метка",Kladr:"Виджет КЛАДР",Fias:"Виджет ФИАС",FieldYear:"Год",FieldMonth:"Месяц",FieldMonthExt:"Месяц",TimeSlot:"Электронная Очередь",NavPanel:"Навигационная панель",Table:"Таблица",TableDictionary:"Таблица из справочника",TableRow:"Ряд",TableColumn:"Колонка",BasePanel:"Простая панель",DictionaryEditor:"Справочник с панелью",FormButton:"Кнопка",FieldEditJson:"Редактор JSON",KladrAddressRKN:"Виджет КЛАДР адреса РКН",KladrNaturalPersonRKN:"Виджет КЛАДР ФЛ РКН",KladrJuridicalPersonRKN:"Виджет КЛАДР ЮЛ/ИП РКН",KladrRusStat:"Виджет КЛАДР РОССТАТ",ImageEditor:"Фоторедактор",TableFms:"Виджет ФМС",FormTable:"Таблица формы",THead:"Заголовок таблицы",TBody:"Контент таблицы",TRow:"Cтрока контента",THRow:"Cтрока заголовка",TCell:"Ячейка таблицы",THCell:"Ячейка заголовка таблицы",ButtonSelectRow:"Выделить строку",FieldMap:"Карта",LocationBasedOnKladr:"Местоположение",FieldMapWithList:"Карта со списком",FieldMapWithListDC:"Карта со списком ДС",FieldCheckboxMultipleBenefits:"Льготы ДС",TimeSlotExt:"ЭО",InnerStep:"Шаг карточки услуги",StateStructure:"Герб с текстом",HelperBox:"Предупреждение",NalogList:"Информация по задолженностям",PanelWorkActivity:"Трудовая деятельность ФМС",KladrDropdown:"Выпадающий список (КЛАДР)",FieldInn:"ИНН (ЕСИА)",AutomotiveAxles:"Автомобильные оси",FieldAddressOfResidence:"ЕСИА - адрес места проживания",FieldRegistrationAddress:"ЕСИА - адрес регистрации",FieldBirthPlace:"Места рождения (ЕСИА)",FieldDrivingLicense:"ВУ (ЕСИА)",FieldVehicle:"ТС (ЕСИА)",InitialImpact:"Место первоначального удара",FieldBirthCountry:"Страна рождения",InvitationPanel:"Панель приглашения заявителей",InvitationPanelEuroprotocol:"Панель приглашения для европротокола",Advice:"Блок с информацией и иконкой результата",EditableDataGrid:"Датагрид с редактированием",OrderListDC:"Список заявок ДС",ElectronMedicalDocs:"Эл. мед. документы",ClinicExam:"ВС Диспансеризация",Payment:"Предначисления",ConfirmPanel:"Панель согласия 3-х лиц",PersonalData:"Персональные данные ФЛ, ИГ",PersonalDataManual:"Персональные данные ФЛ, ИГ (ввод вручную)",Contacts:"Контактная информация ФЛ, ИГ",ContactsManual:"Контактная информация ФЛ, ИГ (ввод вручную)",PassportData:"Данные ДУЛ ФЛ, ИГ",PassportDataManual:"Данные ДУЛ ФЛ, ИГ (ввод вручную)",LegalBusinessmanData:"Сведения о ЮЛ, ИП",AdditionalDocuments:"Дополнительные документы ФЛ, ИГ",AdditionalDocumentsManual:"Дополнительные документы ФЛ, ИГ (ввод вручную)",MedicalPolicy:"Данные полиса ОМС",KidData:"Данные о ребенке",VehicleData:"Данные о ТС",DelegateData:"Блок данных заявителя и представителя",DelegatePersonPanel:"Данные заявителя",DelegateDelegatePanel:"Данные представителя",PersonAddressesData:"Данные об адресах ФЛ, ИГ",FieldMapWithListFrgu:"Карта со списком из ФРГУ",ListKids:"Список детей МО",ListReferral:"Список направлений МО",ListSpecialists:"Список организаций и врачей МО",FieldUploadFileSign:"Проверка соответствия файла и подписи",UploadFileFromDigitalProfile:"Загрузка документов из ЦП",MfcDelivery:"Получение результата в МФЦ",PreviewGEPSMail:"Превью письма ГЭПС"}}()).constant("ERRORSMSG",function(){return{incorrectDate:"Введите корректную дату",incorrectDateInterval:"Введите корректный период",incorrectDateFormat:"Укажите дату в формате ДД.ММ.ГГГГ",incorrectYear:"Укажите год в формате ГГГГ",incorrectMonth:"Укажите месяц в формате ММ",incorrectDay:"Укажите день в формате ДД"}}()).constant("IMAGE_EDITOR_ERRORS_MSG",function(){return{0:"Ваша фотография успешно загружена!",2:"К сожалению, данный формат файлов не поддерживается. Пожалуйста, загрузите изображение в формате JPEG, PNG или BMP.",3:"К сожалению, произошла непредвиденная ошибка при загрузке фотографии. Пожалуйста, <a href='/feedback' target='_blank'>обратитесь в службу техподдержки</a>",4:"К сожалению, произошла ошибка при загрузке фотографии. Пожалуйста, повторите попытку позже. Если ошибка повторится, <a href='/feedback' target='_blank'>обратитесь в службу техподдержки</a>",10:"У фотографии неверное соотношение сторон. Выделите часть изображения с помощью курсора (выделенную область можно передвигать и растягивать). <br>Затем нажмите на иконку <img class='imageEditor-popup-crop_img' src='/widgets/img/elements/crop@1x.png'> «Обрезать фотографию».",11:"Фотография слишком маленькая. Загрузите фотографию размером от 200&nbsp;Kb до 5&nbsp;Mb.",12:"Фотография слишком большая. Загрузите фотографию размером от 200&nbsp;Kb до 5&nbsp;Mb. либо выделите часть изображения с помощью курсора (выделенную область можно передвигать и растягивать). <br>Затем нажмите на иконку <img class='imageEditor-popup-crop_img' src='/widgets/img/elements/crop@1x.png'> «Обрезать фотографию».",13:"Для продолжения загрузки фотографии вам необходимо повторно <a href='/auth/esia/?redirectPage="+window.location.href+"' target='_self'>авторизоваться</a>",14:"К&nbsp;сожалению, загружаемая вами фотография слишком маленькая.",15:"К&nbsp;сожалению, загружаемая вами фотография слишком большая.",17:"К&nbsp;сожалению, качество загружаемой вами фотографии не&nbsp;отвечает требованиям ведомства, и&nbsp;фотография не&nbsp;будет одобрена при рассмотрении заявления. Пожалуйста, загрузите фотографию разрешением не&nbsp;менее",18:"К&nbsp;сожалению, качество загружаемой вами фотографии не&nbsp;отвечает требованиям ведомства, и&nbsp;фотография не&nbsp;будет одобрена при рассмотрении заявления. Пожалуйста, загрузите фотографию разрешением не&nbsp;менее 450&nbsp;DPI (точек на&nbsp;дюйм).",19:"К&nbsp;сожалению, мы не смогли обработать вашу фотографию для передачи в ведомство.<br>Пожалуйста, загрузите другую фотографию с разрешением JPG и с размером от 200 Кб до 500 Кб.",404:"Произошла ошибка при обработке запроса проверки фото",default:"Извините, ваша фотография не подходит",draftLoadError:"Произошла ошибка при обработке запроса изменения черновика",notCropped:"Укажите область кадрирования",checkTotalAmount:"Фотография слишком большая. Загрузите фотографию размером от 200&nbsp;Kb до 5&nbsp;Mb.","-600_form":"Общий объем файлов превышает максимально допустимый размер"}}()).constant("EDITABLE_DATA_GRID_UPLOAD_ERRORS_MSG",function(){return{0:"Ваше приложение успешно загружена!",2:"К сожалению, данный формат файлов не поддерживается. Пожалуйста, загрузите файл в формате CSV.",3:"К сожалению, произошла непредвиденная ошибка при загрузке приложения. Пожалуйста, <a href='/feedback' target='_blank'>обратитесь в службу техподдержки</a>",4:"К сожалению, произошла ошибка при загрузке приложения. Пожалуйста, повторите попытку позже. Если ошибка повторится, <a href='/feedback' target='_blank'>обратитесь в службу техподдержки</a>",13:"Для продолжения загрузки приложения вам необходимо повторно <a href='/auth/esia/?redirectPage="+window.location.href+"' target='_self'>авторизоваться</a>",404:"Произошла ошибка при обработке запроса проверки приложения",default:"Извините, ваше приложение не подходит",draftLoadError:"Произошла ошибка при обработке запроса изменения черновика",attachmentError:"Файл содержит ошибки и не может быть загружен",checkTotalAmount:"Приложение слишком большое. Загрузите файл размером от 200&nbsp;Kb до 5&nbsp;Mb."}}()).constant("DATE_LIMITS_PARTS",function(){return["condition","minDate","maxDate","modifier","depends"]}()).constant("ENGINE_REPOSITORY",function(){return{1:"EnginePlayerVer1",2:"EnginePlayerPgu",EnginePlayerIpsh:"EnginePlayerIpsh",EnginePlayerPgu:"EnginePlayerPgu",EnginePlayerPguOnline:"EnginePlayerPguOnline",EnginePlayerBase:"EnginePlayerBase",EnginePlayerBaseWithNavigation:"EnginePlayerBase"}}()).constant("KLADR_STRUCTURE",function(){return[{name:"region",remoteMethod:"/regions",level:1,required:!0,depends:[],maxlength:50},{name:"district",remoteMethod:"/districts",level:2,depends:["region"],withCheckbox:!0,checkboxLabel:"Нет",maxlength:100,required:!1,requiredTextField:!0},{name:"city",remoteMethod:"/cities",level:3,depends:["district","region"],dependentFields:"town",withCheckbox:!0,checkboxLabel:"Нет",maxlength:150,required:!0,requiredTextField:!0},{name:"town",remoteMethod:"/towns",level:4,depends:["city","district","region"],maxlength:150},{name:"street",remoteMethod:"/streets",level:5,depends:["town","city","district","region"],withCheckbox:!0,checkboxLabel:"Нет",maxlength:100,required:!0,requiredTextField:!0},{name:"house",remoteMethod:"",level:6,depends:[],required:!0,dependentFields:"building1",withCheckbox:!0,checkboxLabel:"Нет",maxlength:5,mnemonic:"kladrHouse",shortTitle:"д.",requiredTextField:!0},{name:"building1",remoteMethod:"",level:7,depends:[],maxlength:5,mnemonic:"kladrInput",shortTitle:"корп."},{name:"building2",remoteMethod:"",level:8,depends:[],maxlength:5,mnemonic:"kladrInput",shortTitle:"стр."},{name:"apartment",remoteMethod:"",level:9,depends:[],withCheckbox:!0,required:!0,checkboxLabel:"Нет",maxlength:5,mnemonic:"kladrInput",shortTitle:"кв.",requiredTextField:!0}]}()).constant("KLADR_LABELS",function(){return{title:"Изменение адреса",postIndexTitle:"Проверьте ваш почтовый индекс",region:"Регион",district:"Район",city:"Город",town:"Населенный пункт",street:"Улица",house:"Дом",building1:"Корпус",building2:"Строение",apartment:"Квартира",post_index:"Почтовый индекс",other_info:"Иные реквизиты адреса Например, № абонементного ящика; до востребования"}}()).constant("ENGINE_VERSIONS",function(){return{EnginePlayerIpsh:"EnginePlayerIpsh",1:"EnginePlayerVer1",2:"EnginePlayerPgu",EnginePlayerPgu:"EnginePlayerPgu",EnginePlayerPguOnline:"EnginePlayerPguOnline",EnginePlayerBase:"EnginePlayerBase",EnginePlayerBaseWithNavigation:"EnginePlayerBase"}}()).constant("FORM_ERRORS",function(){return{3:"По техническим причинам услуга временно недоступна. Попробуйте повторить попытку позже",4:"По техническим причинам услуга временно недоступна. Не указана информация об услуге",6:"Сессия истекла. Пожалуйста выполните вход в Личный Кабинет",7:"По техническим причинам услуга временно недоступна. Не найдена информация об услуге",13:"Недостаточно прав для осуществления действия",50:"По техническим причинам услуга временно недоступна. Попробуйте повторить попытку позже",64:"Форма доступна только для медицинских работников. Уточните, пожалуйста, наличие сведений о Вас в федеральном регистре медицинских работников.",98:{title:"Ошибка сохранения данных заявления",message:"Возможно, вы одновременно открыли заявление в разных вкладках или на разных устройствах. Пожалуйста, закройте страницу и продолжите редактирование в ранее открытом заявлении."},102:"Получение данной услуги невозможно для текущей учетной записи",201:"Черновик заявления не найден. Обратитесь, пожалуйста, в службу поддержки.",211:"Вы уже подали заявление с этим номером. Создайте новый черновик заявления.",1400:"Файлы не подписаны. Для заказа услуги вам необходимо подписать их.",1401:"Данные сертификата электронной подписи не совпадают с данными в Личном кабинете, или используется электронная подпись, не соответствующая выбранной роли (например, электронная подпись выдана сотруднику юридического лица, а услугу получает физическое лицо).",1402:"Ошибка сервиса проверки ЭП (ЕСЭП)",1403:"Заявление было изменено после подписания электронной подписью. Вернитесь к редактированию или повторите подписание электронной подписью.",3003:"Цифры с картинки введены неверно. Попробуйте еще раз.",ESEPNotAvailable:"Произошла ошибка при подготовке файлов для подписания электронной подписью. Пожалуйста, повторите попытку позже. В случае повторения ошибки обратитесь в службу поддержки. Приносим извинения за доставленные неудобства.",4003:"Период подачи заявлений по услуге еще не наступил",4004:"Период подачи заявлений по услуге закончился",5001:{title:"Услуга недоступна",message:"<p>Вы не можете получить услугу, так как по данным Единого государственного реестра юридических лиц (ЕГРЮЛ) ваша организация ликвидирована.</p><p>Если у вас возникли вопросы в отношении информации о ликвидации организации в ЕГРЮЛ, то вы можете обратиться с ними в ФНС России.</p>"},5002:{title:"Количество созданных черновиков превысило лимит за интервал времени",message:"Пожалуйста, повторите попытку запроса через несколько минут"},5003:{title:"Услуга недоступна",message:"<p>Вы не можете получить услугу, так как по данным Единого государственного реестра индивидуальных предпринимателей (ЕГРИП) деятельность вашего ИП была прекращена.</p><p>Если у вас возникли вопросы в отношении информации о прекращении деятельности ИП в ЕГРИП, то вы можете обратиться с ними в ФНС России.</p>"},5004:{title:"Услугу нельзя получить, перейдя по ссылке",message:'Чтобы получить бумажную справку с печатью МФЦ, перейдите в личный кабинет, откройте страницу заявления в разделе <a href="https://lk.gosuslugi.ru/orders">«Мои заявления»</a> или выберите документ в разделе <a href="https://lk.gosuslugi.ru/profile/personal">«Документы и данные»</a> и закажите печать в МФЦ'},submitError:{title:"Во время отправки заявления произошла ошибка.",message:["Заявление сохранено в","черновиках","в вашем Личном кабинете. Попробуйте отправить его еще раз."]},draftListError:{title:"Невозможно загрузить черновик.",message:["Сервис недоступен. Попробуйте повторить через 30&nbsp;минут. Если ошибка повторяется&nbsp;&mdash; обратитесь в&nbsp;","Службу поддержки","."]},qrError:{title:"Подача услуги невозможна",message:"У вас уже есть действующий QR-код.<br/>Cледующий код можно будет получить после окончания действия ранее выданного"},default:"Произошла ошибка. Пожалуйста обратитесь в службу поддержки"}}()).constant("TIME_SLOT_ERRORS",function(){return{3001:{title:"Превышен лимит запросов",message:"Пожалуйста, повторите попытку запроса через несколько минут"}}}()).constant("MAIN_LOADER_TEXTS",function(){return{title:"Идет загрузка",msg:"Это может занять некоторое время"}}()).constant("ADDRESS_RKN_CONDITIONS",function(){return{house:{withCheckbox:!1,dependentFields:"other_info"},apartment:{withCheckbox:!1}}}()).constant("KLADR_CONDITIONS",function(){return{region:{required:!0,maxlength:50,mnemonic:"kladrInput"},
district:{maxlength:100,mnemonic:"kladrInput"},city:{required:!0,maxlength:150,mnemonic:"kladrInputRkn"},town:{maxlength:150,mnemonic:"kladrInput"},street:{required:!0,maxlength:100,mnemonic:"kladrInput"},house:{required:!0,maxlength:5,mnemonic:"kladrHouse"},building1:{maxlength:5,mnemonic:"kladrInput"},building2:{maxlength:5,mnemonic:"kladrInput"},apartment:{maxlength:5,required:!0,mnemonic:"kladrInput",mnemonicHint:"kladrFlat",mnemonicHintShow:!0}}}()).constant("RKN_CONDITIONS",function(){return{region:{maxlength:255,mnemonic:"kladrInputRkn"},district:{maxlength:255,mnemonic:"kladrInputRkn"},city:{maxlength:255,mnemonic:"kladrInputRkn"},town:{maxlength:255,mnemonic:"kladrInputRkn"},street:{maxlength:250,mnemonic:"kladrInputRkn"},house:{maxlength:10,mnemonic:"kladrInputRkn"},building1:{maxlength:10,mnemonic:"kladrInputRkn"},building2:{maxlength:10,mnemonic:"kladrInputRkn"},apartment:{maxlength:10,required:!1,mnemonic:"kladrInputRkn",hint:"В случае офиса, указывается № офиса, например: Оф. 1234"},other_info:{maxlength:200,mnemonic:"kladrInputRkn"}}}()).constant("RUSSTAT_CONDITIONS",function(){return{region:{maxlength:256,mnemonic:"kladrInputRusStat",remoteMethod:"/territory",requestParams:{}},district:{maxlength:256,mnemonic:"kladrInputRusStat",remoteMethod:"/territory",requestParams:{name:"type",value:"districts"},withCheckbox:!1},city:{maxlength:256,mnemonic:"kladrInputRusStat",remoteMethod:"/territory",requestParams:{name:"type",value:"cities"},withCheckbox:!1},town:{maxlength:256,mnemonic:"kladrInputRusStat",remoteMethod:"/territory",requestParams:{name:"type",value:"towns"}},street:{maxlength:256,mnemonic:"kladrInputRusStat",remoteMethod:"/street",requestParams:{name:"addressId",value:""},withCheckbox:!1},house:{maxlength:128,mnemonic:"kladrInputRusStat",isMixedWhenManual:!0,remoteMethod:"/house",requestParams:{name:"streetId",value:""},depends:["street","town","city","district","region"]},building1:{isExclude:!0},building2:{isExclude:!0},apartment:{maxlength:8,mnemonic:"kladrInputRusStat",hint:"",isMixedWhenManual:!0,remoteMethod:"/flat",requestParams:{name:"houseId",value:""},depends:["house","street","town","city","district","region"]}}}()).constant("KEYCODES",function(){return{backspace:8,tab:9,enter:13,esc:27,space:32,pageUp:33,pageDown:34,end:35,home:36,left:37,up:38,right:39,down:40,insert:45,del:46}}()).constant("FIASDADATACAPTIONS",function(){return{1:"Выберите или продолжите ввод региона",2:"Выберите или продолжите ввод города или населенного пункта",3:"Выберите или продолжите ввод улицы",4:"Выберите или продолжите ввод дома",5:"Продолжите ввод квартиры",6:"Выберите вариант или продолжите ввод",7:"Укажите адрес на территории РФ, использование иностранного адреса недопустимо",10:"Выберите или продолжите ввод дома"}}()).constant("FIASDADATAREACHGOALS",function(){return{suggest_addr_room:"suggest_addr_room",suggest_addr_not_room:"suggest_addr_not_room",type_addr_room:"type_addr_room",type_addr_error:"type_addr_error"}}()).constant("FIASDADATAEVENTCONFIG",function(){return{initialized:!1,qcComplete:-1,apartmentChecked:!1,selectSuggest:!1,searchStarted:!1,error:!1}}()).constant("FIASTOKLADRMAPATTRIBUTES",function(){return{area:"district",place:"town"}}()).constant("DICT_DATA",function(){return{all:[{name:"name",value:"Имя атрибута",mapped:"name"},{name:"label",value:"Лейбл",mapped:"label"},{name:"indexNumber",value:"Порядковый номер",mapped:"indexNumber"},{name:"isMain",value:"Основной",mapped:"attrs"},{name:"isDetails",value:"Детали",mapped:"details"},{name:"baloonContent",value:"На карту",mapped:"baloonContent"},{name:"coords",value:"Координаты",mapped:"coords"},{name:"underMap",value:"Под картой",mapped:"underMap"}],keys:{isMain:"attrs",isDetails:"details",baloonContent:"baloonContent",coords:"coords",underMap:"underMap"},defaultMap:{name:"",isMain:!1,isDetails:!1,inMap:!1,indexNumber:0,label:"",coords:!1,underMap:!1,baloonContent:!1},defaultConf:{attrs:[],baloonContent:[],btnName:"Выбрать время записи на прием",coords:[],details:[],underMap:[]}}}()).constant("EPGU_INFORMERS",function(){return[{title:"Автоштрафы",className:"Informer",typeInformer:"gibdd",disabledMessage:"Получить услугу",errorMessage:"Ошибка получения данных",discountMessage:"Оплатите со скидкой!",updateMessage:"Данные обновляются...",successMessage:"Не найдено",cacheTime:9e5,cacheAvailable:864e5},{className:"Informer",title:"Налоговая задолженность",typeInformer:"fns",disabledMessage:"Получить услугу",errorMessage:"Ошибка получения данных",discountMessage:"",updateMessage:"Данные обновляются...",successMessage:"Не найдено",cacheTime:108e5,cacheAvailable:864e5},{className:"Informer",title:"Судебная задолженность",typeInformer:"fssp",disabledMessage:"Получить услугу",errorMessage:"Ошибка получения данных",discountMessage:"",updateMessage:"Данные обновляются...",successMessage:"Не найдено",cacheTime:9e5,cacheAvailable:2592e5}]}()).constant("ESIA_SAVE",function(){return{startegy:["inn","birthplace","address_reg_kladr","address_reg_fias","address_live_kladr","address_live_fias"],suggest:["kid_data","vehicle","zg_passport","polis_oms"],groupStartegy:["foreignpassport","birthcert","militarydoc","medicalpolicy","vehicle","driverlicense"]}}()).constant("ESIA_VALIDATORS",function(){return{militarydoc:{series:[{required:"required",msg:"Серия обязательна и должна состоять из двух букв русского алфавита"},{regex:"^[А-ЯЁ]{2}$",msg:"Серия должна состоять из двух букв русского алфавита"}],number:[{required:"required",msg:"Номер обязателен и должен состоять не более чем из 7 цифр"},{regex:"^[0-9]{1,7}$",msg:"Номер должен состоять не более чем из 7 цифр"}],issueDate:[{required:"required",msg:"Дата обязательна и не может быть больше текущей даты"},{date:"<|current",msg:"Дата не может быть больше текущей даты"}],issuedBy:[{required:"required",msg:"Обязательно для заполнения, не более 30 символов"}]},medicalpolicy:{number:[{required:"required",msg:"Номер полиса обязателен для заполнения, допускается ввод цифр, букв, дефиса, точки и не более одного пробела."},{regex:"^[0-9a-zA-Zа-яА-ЯёЁ\\-\\.]*\\s?[0-9a-zA-Zа-яА-ЯёЁ\\-\\.]*$",msg:"Номер полиса обязателен для заполнения, допускается ввод цифр, букв, дефиса, точки и не более одного пробела."}],expiryDate:[{date:">=|current",msg:"Дата должна быть больше текущей даты"}]},birthcert:{series:[{required:"required",msg:"Серия свидетельства о рождении может содержать только дефис, заглавные буквы русского и латинского алфавита, не более 11 символов"},{regex:"^(I|V|X|L|C|D|M){1,5}-([А-ЯЁ]{1,5})$",msg:"Серия свидетельства о рождении может содержать только дефис, заглавные буквы русского и латинского алфавита, не более 11 символов."}],issueDate:[{required:"required",msg:"Дата обязательна и не может быть больше текущей даты"},{date:"<=|current",msg:"Дата обязательна и не может быть больше текущей даты"}],number:[{required:"required",msg:"Номер свидетельства о рождении должен состоять из 6 или 7 цифр"},{regex:"^[0-9]{6,7}$",msg:"Номер свидетельства о рождении должен состоять из 6 или 7 цифр"}],issuedBy:[{required:"required",msg:"Обязательно для заполнения, не более 30 символов"}]},foreignpassport:{lastName:[{required:"required",msg:"Фамилия на латинице обязательна для заполнения"},{regex:"^[\\s\\-`0-9A-Za-z]+$",msg:"Фамилия на латинице обязательна для заполнения"}],firstName:[{required:"required",msg:"Имя на латинице обязательно для заполнения"},{regex:"^[\\s\\-`0-9A-Za-z]+$",msg:"Имя на латинице обязательно для заполнения"}],series:[{required:"required",msg:"Серия загранпаспорта должна состоять из двух цифр и обязательна для заполнения"},{regex:"^[0-9]{2}$",msg:"Серия загранпаспорта должна состоять из двух цифр"}],number:[{required:"required",msg:"Номер загранпаспорта должен состоять из семи цифр и обязателен для заполнения"},{regex:"^[0-9]{7}$",msg:"Номер загранпаспорта должен состоять из семи цифр"}],issueDate:[{required:"required",msg:"Дата обязательна и не может быть больше текущей даты"},{date:"<=|current",msg:"Дата обязательна и не может быть больше текущей даты"}],expiryDate:[{required:"required",msg:"Дата обязательна и должна быть больше текущей даты"},{date:">|current",msg:"Дата обязательна и должна быть больше текущей даты"}],issuedBy:[{required:"required",msg:"Обязательно для заполнения, не более 30 символов"},{regex:"^.{1,30}$",msg:"Обязательно для заполнения, не более 30 символов"}]},car:{name:[{required:"required",msg:"Название обязательно для заполнения, не более 125 символов"}],numberPlate:[{required:"required",msg:"Вводите номер без пробелов, знаков препинания и аббревиатур. Используйте цифры от 0 до 9 и заглавные русские буквы (А, В, Е, К, М, Н, О, Р, С, Т, У, Х). Для некоторых типов номеров можно использовать заглавные латинские буквы (C, D, H, M)"},{regex:"^([АВЕКМНОРСТУХ0-9]{0,9}|[CDHMT0-9]{0,9})$",msg:"Вводите номер без пробелов, знаков препинания и аббревиатур. Используйте цифры от 0 до 9 и заглавные русские буквы (А, В, Е, К, М, Н, О, Р, С, Т, У, Х). Для некоторых типов номеров можно использовать заглавные латинские буквы (C, D, H, M)."}],regCertificate_series:[{required:"required",msg:"В серии свидетельства о регистрации должны использоваться только цифры и буквы русского алфавита, 4 символа"},{regex:"^[а-яА-ЯёЁ0-9]{4}$",msg:"В серии свидетельства о регистрации должны использоваться только цифры и буквы русского алфавита, 4 символа"}],regCertificate_number:[{required:"required",msg:"В номере свидетельства о регистрации должны использоваться только цифры, 6 символов"},{regex:"^[0-9]{6}$",msg:"В номере свидетельства о регистрации должны использоваться только цифры, 6 символов"}]},driverLicense:{series:[{required:"required",msg:"В серии должны использоваться только цифры и буквы русского алфавита, 4 символа"},{regex:"^[а-яёА-ЯЁ0-9]{4}$",msg:"В серии должны использоваться только цифры и буквы русского алфавита, 4 символа"}],number:[{required:"required",msg:"В номере должны использоваться только цифры, 6 символов"},{regex:"^[0-9]{6}$",msg:"В номере должны использоваться только цифры, 6 символов"}],issueDate:[{required:"required",msg:"Дата обязательна и не может быть больше текущей даты"},{date:"<=|current",msg:"Дата обязательна и не может быть больше текущей даты"}],expiryDate:[{required:"required",msg:"Дата обязательна и должна быть больше текущей даты"},{date:">|current",msg:"Дата обязательна и должна быть больше текущей даты"}]},kidData:{lastname:[{required:"required",msg:"Обязательно для заполнения. Поле может содержать только буквы русского или латинского алфавитов, цифры, дефис, пробел, апостроф, точку. В поле недопустимо одновременно использовать русские и латинские буквы."},{regex:"^[\\s\\-`0-9A-Za-z][^А-ЯЁа-яё]+$|^[\\s\\-`0-9А-ЯЁа-яё][^A-Za-z]+$",msg:"Обязательно для заполнения. Поле может содержать только буквы русского или латинского алфавитов, цифры, дефис, пробел, апостроф, точку. В поле недопустимо одновременно использовать русские и латинские буквы."}],firstname:[{required:"required",msg:"Обязательно для заполнения. Поле может содержать только буквы русского или латинского алфавитов, цифры, дефис, пробел, апостроф, точку. В поле недопустимо одновременно использовать русские и латинские буквы."},{regex:"^[\\s\\-`0-9A-Za-z][^А-ЯЁа-яё]+$|^[\\s\\-`0-9А-ЯЁа-яё][^A-Za-z]+$",msg:"Обязательно для заполнения. Поле может содержать только буквы русского или латинского алфавитов, цифры, дефис, пробел, апостроф, точку. В поле недопустимо одновременно использовать русские и латинские буквы."}],middlename:[{regex:"^[\\s\\-`0-9A-Za-z][^А-ЯЁа-яё]+$|^[\\s\\-`0-9А-ЯЁа-яё][^A-Za-z]+$",msg:"Поле может содержать только буквы русского или латинского алфавитов, цифры, дефис, пробел, апостроф, точку. В поле недопустимо одновременно использовать русские и латинские буквы."}],birthday:[{required:"required",msg:"Дата обязательна и должна быть меньше текущей"},{date:"<|current",msg:"Дата обязательна и должна быть меньше текущей"}],gender:[{required:"required",msg:"Пол обязателен для заполнения"}],snils:[{regex:"^(\\d{3})\\-(\\d{3})\\-(\\d{3})\\s(\\d{2})$",msg:"Введенный СНИЛС не существует"}],inn:[{regex:"^[0-9]{12}$",msg:"Введенный ИНН не существует"}],sr_serial:[{required:"required",msg:"Серия свидетельства о рождении может содержать только дефис, заглавные буквы русского и латинского алфавита, не более 11 символов."},{regex:"^(I|V|X|L|C|D|M){1,5}-([А-ЯЁ]{1,5})$",msg:"Серия свидетельства о рождении может содержать только дефис, заглавные буквы русского и латинского алфавита, не более 11 символов."}],sr_number:[{required:"required",msg:"Номер свидетельства о рождении обязателен и должен состоять из 6 или 7 цифр"},{regex:"^[0-9]{6,7}$",msg:"Номер свидетельства о рождении обязателен и должен состоять из 6 или 7 цифр"}],sr_iss_date:[{required:"required",msg:"Дата обязательна и не может быть больше текущей даты"},{date:"<=|current",msg:"Дата обязательна и не может быть больше текущей даты"}],sr_issued:[{required:"required",msg:"Обязательно для заполнения, не более 233 символов"}],polis_oms_number:[{regex:"^[0-9a-zA-Zа-яА-ЯёЁ\\-\\.]*\\s?[0-9a-zA-Zа-яА-ЯёЁ\\-\\.]*$",msg:"Номер полиса обязателен для заполнения, допускается ввод цифр, букв, дефиса, точки и не более одного пробела."}],polis_oms_exp_date:[{date:">|current",msg:"Дата должна быть больше текущей даты"}]}}}()).constant("TRANSLIT_MASK",function(){return{"А":"A","Б":"B","В":"V","Г":"G","Д":"D","Е":"E","Ё":"E","Ж":"Zh","З":"Z","И":"I","Й":"I","К":"K","Л":"L","М":"M","Н":"N","О":"O","П":"P","Р":"R","С":"S","Т":"T","У":"U","Ф":"F","Х":"Kh","Ц":"Ts","Ч":"Ch","Ш":"Sh","Щ":"Shch","Ы":"Y","Ъ":"Ie","Ь":"","Э":"E","Ю":"Iu","Я":"Ia","а":"a","б":"b","в":"v","г":"g","д":"d","е":"e","ё":"e","ж":"zh","з":"z","и":"i","й":"i","к":"k","л":"l","м":"m","н":"n","о":"o","п":"p","р":"r","с":"s","т":"t","у":"u","ф":"f","х":"kh","ц":"ts","ч":"ch","ш":"sh","щ":"shch","ы":"y","ъ":"ie","ь":"","э":"e","ю":"iu","я":"ia"}}()).constant("DEFAULT_NAVIGATION_HANDLERS",function(){return{EnginePlayerPgu_V2:{prev:function(evt){var steps=api.stepList(),cs=api.step(),ns=cs-1;steps[cs],steps[ns];ns>=0?api.step(ns):api.link(api.env("returnUrl")+"/service/"+api.env("targetId")+"_"+api.env("formMnemonic")+".html#_description")},next:function(evt){var steps=api.stepList(),stepsLen=steps.length,cs=api.step(),ns=cs+1,crSt=steps[cs],finalLink=api.env("url")+"/orders/details?elementId="+api.env("orderId")+"#_results";if(ns<=stepsLen){crSt.submit("submit");var prevVis="preview"===crSt.name(),prevNeeded="false"===api.hidePreview();ns<stepsLen?api.step(ns):ns===stepsLen&&(prevNeeded&&prevVis||!prevNeeded)&&(api.shade(!0),api.generateServerPdf().then(function(result){api.submit("submit"),api.submit("final"),api.link(finalLink)}))}},showInfo:function(evt){api.shade(!0),FormPlayer.showServiceInfo()}},EnginePlayerPgu:{prev:function(){var steps=api.getVisibleSteps(),currentStepIndex=api.step(),prevStepIndex=currentStepIndex-1;steps[currentStepIndex],steps[prevStepIndex];prevStepIndex>=0?api.step(prevStepIndex):api.link(api.env("returnUrl")+"/service/"+api.env("targetId")+"_"+api.env("formMnemonic")+".html#_description")},next:function(callback){var form=api.find(),steps=api.getVisibleSteps(),currentStepIndex=api.step(),currentStep=new apiElement(steps[currentStepIndex].step);currentStep.init();var stepsLength,nextStepIndex;form.attr("showAllSteps")?currentStep.submit("submit",0,{done:function(data){form.validate()&&api.finalSubmit()},error:function(error){api.handleError(error)}},!1,!0):(stepsLength=steps.length,nextStepIndex=currentStepIndex+1,nextStepIndex<=stepsLength&&currentStep.submit("submit",0,{done:function(data){nextStepIndex<stepsLength?(api.step(nextStepIndex),"function"==typeof callback&&callback()):nextStepIndex===stepsLength&&currentStep.validate()&&api.finalSubmit()},error:function(error){api.handleError(error)}},!1,!0))},showInfo:function(){},main:function(evt){if(api.validate()){var finSubmit={init:function(evt){api.stepList()[0].submit("submit",0,finSubmit.callBackDraft,void 0,!0)},callBackDraft:{done:function(data){data&&data.error&&"0"==data.error.code?finSubmit.submitFinal(evt):finSubmit.submitError()},error:function(e){finSubmit.submitError()},always:function(e){}},submitFinal:function(evt){var systemData=api.env("systemData");systemData&&systemData.signCnt&&+systemData.signCnt>1&&systemData.isOwner&&"true"!==systemData.isOwner?api.signConfirm().done(function(){var rUrl=api.env("rURL");rUrl?api.link(rUrl+"/details?elementId="+api.env("orderId")+"#_results"):api.link(api.env("lkUrl")+"notifications/details/ORDER/"+api.env("orderId"))}):FormPlayer.generateServerPdf().done(function(){api.submit("submit",0,finSubmit.callBackFinalSubmit)})},callBackFinalSubmit:{done:function(data){if(data&&data.error&&"0"==data.error.code){var finalLink,notifySMU=api.env("notifySMU");notifySMU?notifySMU({eventType:"submitForm",eventParams:[{key:"orderId",value:api.env("orderId")},{key:"formMnemonic",value:api.env("formMnemonic")},{key:"targetId",value:api.env("targetId")}]}):(finalLink=api.env("rURL")?api.env("rURL")+"/details?elementId="+api.env("orderId")+"#_results":api.env("lkUrl")+"notifications/details/ORDER/"+api.env("orderId"),api.link(finalLink))}else finSubmit.submitError({code:"submitError"})},error:function(e){finSubmit.submitError(e)},always:function(e){}},callBackDraftESEP:{done:function(data){data&&data.error&&"0"==data.error.code?(api.shade(!1),FormPlayer.generateHtml()):finSubmit.submitError()},error:function(e){finSubmit.submitError(e)},always:function(e){}},submitError:function(data){data=data||{},void 0===data.code||data.code&&(data.code<1400||data.code>1403)?(data.code="submitError",data.hideForm=!0):data.esepError=!0,FormPlayer.handleError(data),api.shade(!1)}};/result=(0)/.test(window.location.href)&&!api.env("editFormAfterEsep")?finSubmit.submitFinal(evt):FormPlayer.env.supportSignature?api.stepList()[0].submit("submit",0,finSubmit.callBackDraftESEP,!1):(api.shade(!0),finSubmit.init(evt))}}},EnginePlayerBase:{prev:function(evt){var steps=api.stepList(),cs=api.step(),ns=cs-1;steps[cs],steps[ns];if(!(ns>=0))return!1;api.step(ns)},next:function(evt){var steps=api.stepList(),stepsLen=steps.length,cs=api.step(),ns=cs+1,crSt=steps[cs];ns<=stepsLen&&(crSt.name(),api.hidePreview(),ns<stepsLen&&api.step(ns))}},EnginePlayerPguOnline:{next:function(){var steps=api.stepList(),stepsLen=steps.length,cs=api.step(),ns=cs+1,crSt=steps[cs],onSteps=(steps[ns],ns<=stepsLen);if(!crSt.validate())return!1;if(onSteps){crSt.submit("submit");var prevVis="preview"===crSt.name(),prevNeeded="false"===api.hidePreview();ns<stepsLen&&api.step(ns),ns===stepsLen&&(prevNeeded&&prevVis||!prevNeeded)&&function(){api.shade(!0),FormPlayer.generateServerPdf().done(function(){api.submit("submit","0",{done:function(response){var messageId=response.context.submit.messageId.toString();api.env("messageId",messageId);var checkResult=function(){api.submit("submit","1",{done:function(response){"DONE"!=response.context.push.statusCode?setTimeout(checkResult,1e3):(api.submit("submit","2"),api.shade())}})};checkResult()}})})}()}},showInfo:function(){}},EnginePlayerPguOnline_V2:{next:function(){var steps=api.stepList(),stepsLen=steps.length,cs=api.step(),ns=cs+1,crSt=steps[cs],onSteps=(steps[ns],ns<=stepsLen);if(!crSt.validate())return!1;if(onSteps){crSt.submit("submit");var prevVis="preview"===crSt.name(),prevNeeded="false"===api.hidePreview();ns<stepsLen&&api.step(ns),ns===stepsLen&&(prevNeeded&&prevVis||!prevNeeded)&&function(){api.shade(!0),FormPlayer.generateServerPdf().done(function(){api.submit("submit","0",{done:function(response){var messageId=response.context.submit.messageId.toString();api.env("messageId",messageId);var checkResult=function(){api.submit("submit","1",{done:function(response){"DONE"!=response.context.push.statusCode?setTimeout(checkResult,1e3):(api.submit("submit","2"),api.shade())}})};checkResult()}})})}()}}}}}()).constant("SAVE_DRAFT_ITEMS_WITH_CN",["FormStep","FieldText","FieldTextArea","FieldTextDate","FieldCheckbox","Fias","FieldRadio","FieldUpload","FieldDropdown","FieldDropdownHierarchic","FieldDropdownMultiple","FieldDropdownHierarchicMultiple","FieldYear","FieldMonthExt","LocationBasedOnKladr"]),angular.module("serverForm.directives").directive("resizable",["$window","$timeout","$rootScope",function($window,$timeout,$rootScope){return function($scope){$scope.initializePropList=function(){var toolbarHeight=document.querySelector(".epgu-toolbar").offsetHeight,formDescHeight=document.querySelector("#form-item-path").offsetHeight+55+40;return $rootScope.formId&&"create"!==$rootScope.formId&&(formDescHeight+=document.querySelector("#form-description").offsetHeight),$scope.heightPropList=Math.round(($window.innerHeight-toolbarHeight-formDescHeight)/2)+"px"};var listener=function(){return $scope.initializePropList(),$scope.$digest()};$timeout(function(){return $scope.initializePropList(),angular.element($window).bind("resize",listener)}),$scope.$on("$destroy",function(){angular.element($window).unbind("resize",listener)})}}]).directive("flexHeight",["$timeout","$window",function($timeout,$window){return{restrict:"A",scope:{paddings:"="},link:function(scope,element){function resize(){var pad=scope.paddings?scope.paddings:395,height=angular.element($window).height()-pad;element.css("height",height>100?height:100)}resize(),angular.element($window).bind("resize",function(){resize()})}}}]).directive("focus",["$timeout",function($timeout){return{scope:{trigger:"@focus"},link:function(scope,element){scope.$watch("trigger",function(value){"true"===value&&$timeout(function(){element[0].focus()})})}}}]).directive("formTree",["$compile","apiInner","$rootScope","$timeout","api","PGU",function($compile,apiInner,$rootScope,$timeout,api,PGU){return{restrict:"E",replace:!0,scope:{item:"=",stepIndex:"="},link:function(scope,element,attrs){function render(){if(scope.item&&scope.item.className){var el;window.domElTmpl[scope.item.className]||(el=document.createElement(apiInner.classNameToDirective(scope.item.className)),el.setAttribute("item","item"),el.setAttribute("step-index","stepIndex"),window.domElTmpl[scope.item.className]=$compile(el)),window.domElTmpl[scope.item.className](scope,compileCallback)}}$rootScope.isDesigner&&element.on("click",function(evt){evt.stopPropagation(),PGU.Events.publish(":formTreeItemClick",{item:scope.item})});var compileCallback=function(cloned){element.append(cloned),$rootScope.mainLoader.loadCounter--;var objKeys=Object.keys($rootScope.settings.stepLoader||{}),stepLoaderFullPath=objKeys.find(function(i){return scope.item.fullPath&&(scope.item.fullPath===i||0===scope.item.fullPath.indexOf(i+"."))});stepLoaderFullPath&&($rootScope.settings.stepLoader[stepLoaderFullPath]--,$rootScope.settings.stepLoader[stepLoaderFullPath.replace(".","")]--,api.find(stepLoaderFullPath).element.stepLoader--),$rootScope.mainLoader.loadCounter%10==0&&api.applyScope()};window.domElTmpl=window.domElTmpl||{},window.nodeNameTmpl=window.nodeNameTmpl||{},"Form"!==scope.item.className&&"FormStep"!==scope.item.className&&"Panel"!==scope.item.className||scope.item.syncRender?$rootScope.$applyAsync(render):$timeout(function(){render()},0,!1)}}}]).directive("numbersOnly",["$compile","apiInner",function($compile,apiInner){return{restrict:"A",require:"ngModel",scope:{model:"=ngModel"},link:function(scope,element,attrs){attrs.numbersOnly&&scope.$watch("model",function(val,oldVal){"string"==typeof val&&val!=oldVal&&(scope.model=1*scope.model.replace(/[^0-9]/g,""))})}}}]).directive("adviceLikeSf",function(){return{restrict:"E",template:'<div scroll-anchor class="PGU-Advice PGU-Advice-InForm PGU-Advice-type-like"><div class="PGU-limiter">\n            <h3  class="PGU-Title-H3">\n                <span class="PGU-Advice-icon"></span>\n                <span class="PGU-Advice-title">{{title}}</span>\n            </h3>\n            <div class="PGU-last-update PGU-clear" ng-if="lastUpdated">\n                   <span class="PGU-last-update-clock"></span>\n                   <span class="PGU-PlainText PGU-last-update-text PGU-last-update-text-with-clock">\n                   Информация актуальна <span class="PGU-nobr">на {{lastUpdated}}</span>\n                   </span>\n                   </div>            <social-links></social-links>\n        </div></div>',scope:{title:"@",lastUpdated:"@"},replace:!0}}).directive("question",["$rootScope","$timeout","$document","$q","sharedExtServices","api","PGU",function($rootScope,$timeout,$document,$q,sharedExtServices,api,PGU){return{restrict:"E",template:'<a class="PGU-Link PGU-Link-esia" ng-click="clickProfile($event);" ng-href="{{::item.hrefLk}}" data-ng-click="clickQ($event)" ng-if="item.hasEsiaHint" tabindex="{{item.disabled ? -1 : 1}}"ng-bind-html="(\'LinkEditProfile\' | translate:editProfileTitle) || editProfileTitle"></a><span class="PGU-PopupHint"><i class="questionIcon"></i></span><span class="PGU-PopupHintOuter" data-ng-class="{\'withoutEsiaLink\': (ui.isMobile && item.hasEsiaHint === false), \'PGU-showHint PGU-Control-Hidden\': ui.isTablet || ui.isMobile}"><span class="PGU-PopupHintContent"><span ng-if="item.hasEsiaHint && !item.hintHtml"><strong ng-bind-html="(\'EditProfileAttention\' | translate:attentionTitle) || attentionTitle"></strong><p class="PGU-Esia-Hint-text"ng-bind-html="(item.fullPath + \'.esiaHint\' | translate:item.esiaHint) || (item.esiaHint || item.attrs.esiaHint.default)"></p> </span><span ng-if="item.hintHtml" ng-bind-html="(((item.mnemonicHint || item.fullPath) + \'.hint\' | translate:item.hintHtml) | to_trusted) || (item.hintHtml | to_trusted)"></span></span></span>',scope:{item:"="},link:function(scope,element,attrs){scope.attentionTitle="Обратите внимание",scope.editProfileTitle="Изменить данные профиля",scope.ui={},scope.ui.isTablet=api.isTablet(),scope.ui.isMobile=api.isMobile(),scope.ui.isDesktop=device.desktop(),scope.ui.deviceShow=!1;var parentClassName=scope.$parent.item.className;if((scope.ui.isTablet||scope.ui.isMobile)&&PGU.Events.subscribe("","documentClick",function(e,evt){var boundingIcon,boundingContent,domHintOuter=element.find(".PGU-PopupHintOuter"),show=element!==evt.target&&!element[0].contains(evt.target);domHintOuter.toggleClass("PGU-Control-Hidden",show),show||(scope.ui.isTablet||scope.item.inPanelTitle)&&document.documentElement.clientWidth-element.find(".questionIcon").offset().left<domHintOuter.width()&&domHintOuter.addClass("down"),scope.ui.isMobile&&!scope.item.inPanelTitle||(boundingIcon=element.find(".questionIcon")[0].getBoundingClientRect(),boundingContent=element.find(".PGU-PopupHintOuter")[0].getBoundingClientRect(),scope.ui.endOfPage=!show&&window.innerHeight-(boundingIcon.top+boundingContent.height)<0,domHintOuter.toggleClass("PGU-PopupHintOuter_On-Top",scope.ui.endOfPage))}),(scope.ui.isTablet||scope.ui.isDesktop||scope.item.inPanelTitle)&&element.find(".PGU-PopupHint").append(element.find(".PGU-PopupHintOuter")),scope.item.mnemonicHint&&scope.item.mnemonicHint.length){var code=scope.item.mnemonicHint;api.getHintInitCacheData(code).then(function(data){var itemHint=data.find(function(item){return item.code===code});itemHint&&itemHint.message&&(scope.item.hintHtml=api.cleanMnemonicHintHtml(itemHint.message))})}else scope.item.hint&&scope.item.hint.length&&"FieldText"===scope.item.className&&(scope.item.hintHtml=scope.item.hint,scope.$watch("item.hint",function(val,oldVal){val!==oldVal&&(scope.item.hintHtml=scope.item.hint)}));if("FormStep"===parentClassName)element.wrap('<div class="PGU-FormStep-Hint-Wrap"></div>');else if("Panel"===parentClassName){var moreClasses=scope.item.hasEsiaHint&&$rootScope.device.mobile?"esia-link-mob":"";element.wrap('<div class="PGU-Panel-Hint-Wrap '+moreClasses+'"></div>')}scope.clickProfile=function(evt){evt.preventDefault(),evt.stopPropagation(),$rootScope.vaccineForm&&api.sendReachGoal("book_vaccine",{vaccine:{profile:["change_credentials"]}},24845174);var notifySMU=api.env("notifySMU");notifySMU?notifySMU({eventType:"open_browser",eventParams:[{key:"url",value:scope.item.hrefLk},{key:"withAuth",value:!0}]}):location.href=scope.item.hrefLk}}}}]).directive("whenScrolled",["$rootScope","$timeout","$compile",function($rootScope,$timeout,$compile){return{restrict:"A",link:function(scope,element,attrs){var raw=element[0];element.bind("scroll",function(){raw.scrollTop+raw.offsetHeight>=raw.scrollHeight&&scope.$apply(attrs.whenScrolled)})}}}]).directive("whenScrolledAllTime",["$rootScope","$timeout","$compile",function($rootScope,$timeout,$compile){return{restrict:"A",link:function(scope,element,attrs){var timeout=!1;element.bind("scroll",function(){timeout&&clearTimeout(timeout),timeout=setTimeout(function(){scope.$apply(attrs.whenScrolledAllTime)},25)})}}}]).directive("clickHint",["PGU",function(PGU){return{link:function(scope,element,attrs){PGU.Events.subscribe("","documentClick",function(e,evt){element===evt.target||element[0].contains(evt.target)?scope.item.deviceShow=!0:scope.item.deviceShow=!1})}}}]).directive("hover",["$parse",function($parse){return{link:function(scope,element,attrs){var parseHover=$parse(attrs.hover);element[0].addEventListener("mouseenter",function(){scope.$apply(function(){parseHover(scope)})})}}}]).directive("mask",["PGU","$timeout","api",function(PGU,$timeout,api){return{require:"ngModel",link:function(scope,element,attrs,model){PGU.mask=PGU.mask||{},PGU.mask.input=PGU.mask.input||document.createElement("input");var fakeInput=PGU.mask.input,$fakeInput=$(fakeInput);window.isMobileForMask=device.mobile(),attrs.mask&&element.mask(attrs.mask,{translation:{L:{pattern:/[a-zA-Z\u0400-\u04FF]/},"?":{pattern:/[a-zA-Z\u0400-\u04FF]/,optional:!0},">":{pattern:/[А-ЯЁA-Z0-9]/},"<":{pattern:/[а-яёa-z0-9]/},"*":{pattern:/./}}}),element.on("input",function(evt){!1==!!scope.model.saveWithMask&&($fakeInput.mask(attrs.mask,{translation:{L:{pattern:/[a-zA-Z\u0400-\u04FF]/},"?":{pattern:/[a-zA-Z\u0400-\u04FF]/,optional:!0},">":{pattern:/[А-ЯЁA-Z0-9]/},"<":{pattern:/[а-яёa-z0-9]/},"*":{pattern:/./}}}),$fakeInput.val(element.val()),scope.model.originalValue=$fakeInput.unmask().val()),scope.model._changedByUser=!0,scope.model.withoutApi||api.find(scope.model.fullPath).value(element.val())}),element.on("change",function(evt){scope.model.value=element.val()}),attrs.mask&&scope.$watch("model.value",function(newVal,oldVal){attrs.mask&&$timeout(function(){element.mask(attrs.mask,{translation:{L:{pattern:/[a-zA-Z\u0400-\u04FF]/},"?":{pattern:/[a-zA-Z\u0400-\u04FF]/,optional:!0},">":{pattern:/[А-ЯЁA-Z0-9]/},"<":{pattern:/[а-яёa-z0-9]/},"*":{pattern:/./}},byPassKeys:[8,46]}),element.trigger("keyup"),newVal!==element.val()&&(scope.model.value=element.val())})})}}}]).directive("epguSvgCircleProgress",["$timeout","TEMPLATES","CircleProgressProps",function($timeout,TEMPLATES,CircleProgressProps){return{restrict:"E",templateUrl:TEMPLATES.SVGCIRCLEPROGRESS,replace:!0,scope:{props:"="},link:function(scope,element,attrs){scope.isDesktop=device.desktop();var width=scope.props.width||200,strokeWidth=scope.props.strokeWidth||15,radius=scope.props.radius||(width-strokeWidth)/2,total=scope.props.questions||20,answers=scope.props.answers||0;scope.config={colors:["#F3F3F3","#1C881F"],cx:width/2,cy:width/2,radius:radius,strokeWidth:strokeWidth,strokeDashArray:CircleProgressProps.circumference(radius),total:total},scope.isDesktop?(scope.initialValues=CircleProgressProps.getItemsFromInitial([total,answers],total,scope.config.colors,scope.config.strokeDashArray),scope.percents=CircleProgressProps.getCeilPercents(CircleProgressProps.getDataPercentage(answers,total))+"%"||""):scope.percents=CircleProgressProps.getCeilPercents(CircleProgressProps.getDataPercentage(answers,total))+"%"||"",scope.inlineCss="width:"+scope.percents,scope.$watch("props.answers",function(val,oldVal){void 0!==val&&val!==oldVal&&(total===scope.props.questions?scope.isDesktop&&(scope.initialValues[1].offset=CircleProgressProps.calculateStrokeDashOffset(val,total,scope.config.strokeDashArray)):(total=scope.props.questions,
scope.isDesktop&&(scope.initialValues=CircleProgressProps.getItemsFromInitial([total,val],total,scope.config.colors,scope.config.strokeDashArray))),scope.percents=CircleProgressProps.getCeilPercents(CircleProgressProps.getDataPercentage(val,total))+"%"||"",scope.isDesktop||(scope.inlineCss="width:"+scope.percents))}),scope.$watch("props.questions",function(val,oldVal){if(void 0!==val&&val!==oldVal){var answers=scope.props.answers||0;total=scope.props.questions,scope.isDesktop&&(scope.initialValues=CircleProgressProps.getItemsFromInitial([total,answers],total,scope.config.colors,scope.config.strokeDashArray)),scope.percents=CircleProgressProps.getCeilPercents(CircleProgressProps.getDataPercentage(answers,total))+"%"||"",scope.isDesktop||(scope.inlineCss="width:"+scope.percents)}})}}}]).factory("CircleProgressProps",[function(){return{circumference:function(radius){return 2*Math.PI*radius},getCeilPercents:function(val){return Math.round(100*val)},getDataPercentage:function(dataVal,dataTotal){return dataVal/dataTotal},calculateStrokeDashOffset:function(dataVal,dataTotal,circumference){return circumference-this.getDataPercentage(dataVal,dataTotal)*circumference},getItemsFromInitial:function(values,total,colors,circumference,cx,cy){var self=this;values=values||[];var angleOffset=-90;return values.map(function(li,i){var degrees=angleOffset;return angleOffset=360*self.getDataPercentage(li,total)+degrees,{offset:self.calculateStrokeDashOffset(li,total,circumference),color:colors[i],value:li,degrees:degrees}})}}}]),angular.module("serverForm.directives").directive("pguInput",["$rootScope","$timeout","api","PGU",function($rootScope,$timeout,api,PGU){return{restrict:"E",replace:!0,template:'<input id="{{::idinp}}"type="text"mask="{{::model.theMaskValue}}"ng-model="inp"ng-trim="false"ng-model-options="{ updateOn: \'default blur\', debounce: { \'default\': debounceTime, \'blur\': 0 } }"tabindex="{{model.disabled ? -1 : 1}}"ng-readonly="model.readonly || $root.isDesigner"ng-blur="onBlurHandler(model.value, $event)"ng-focus="!$root.isDesigner && onFocusHandler($event)"ng-keydown="inputKeyup($event)"ng-change="localModelChange(inp)">',scope:{cl:"=",change:"&",blur:"&",focus:"&",model:"=",disabled:"=",idinp:"@"},link:function(scope,element,attrs){function sendHealth(path,result){$rootScope.env.formParam&&"true"===$rootScope.env.formParam.isLogElForm&&$rootScope.$emit("HEALTH_SEND",{event:"logElForm",timing:0,result:result,el:path,order_id:api.env("orderId")})}scope.inp=scope.model.value?scope.model.value:"";var watchers;scope.$on("suspend",function(){watchers=scope.$$watchers,scope.$$watchers=[]}),scope.$on("resume",function(){scope.$$watchers=watchers,watchers=null}),scope.model.maxlength=scope.model.theMaskValue&&scope.model.theMaskValue.length||scope.model.maxlength;var cache;scope.$watch("model.value",function(newV,oldV){newV!==oldV&&(scope.inp=newV,"FiedlTextDate"===scope.model.className&&$(".ui-datepicker").hide(),cache!==newV&&(cache=newV,$rootScope.$emit(scope.model.fullPath+":inputChange",{newV:newV,oldV:oldV})),newV||!scope.model.isSmall||scope.model.inFocus||(scope.model.isSmall=!1))});var oldV="";scope.localModelChange=function(newV){cache=newV,$rootScope.$emit(scope.model.fullPath+":inputChange",{newV:newV,oldV:oldV}),oldV=newV},scope.inputKeyup=function($event){scope.model.lastKeyCode=$event.which,scope.$emit(scope.model.fullPath+":keyup",$event)};var valueOnFocus="",isFocusOnFieldDate=!1;scope.onFocusHandler=function(evt){evt.stopPropagation();var suggest=scope.model.suggest;suggest&&suggest.values&&suggest.values.length&&element[0].setAttribute("autocomplete","none"),valueOnFocus=scope.model.value,scope.model.disabled&&scope.model.readonly||(scope.model.isSmall=!0,scope.model.inFocus=!0,PGU.fireEvents.formRendered&&("FieldTextDate"!==scope.model.className?sendHealth(scope.model.fullPath,3):isFocusOnFieldDate||(sendHealth(scope.model.fullPath,3),isFocusOnFieldDate=!0))),"FieldTextDate"!==scope.model.className?scope.$emit(scope.model.fullPath+":focus"):PGU.lastActiveDatepickerPath=scope.model.fullPath},scope.onBlurHandler=function(value,evt){evt.stopPropagation(),scope.model.value||(scope.model.isSmall=!1),isFocusOnFieldDate=!1,scope.model.inFocus=!1,PGU.fireEvents.formRendered&&(scope.model.value===valueOnFocus||api.env("autosaveDisabled")||api.uploadDraft(!1,null,null,!1,scope.model),$timeout(function(){sendHealth(scope.model.fullPath,4),scope.$emit(scope.model.fullPath+":blur")}))},scope.model.$setViewValue=function(value){scope.inp=value},scope.debounceTime=scope.model.theMaskValue?0:250,PGU.Events.subscribe(scope.idinp,"setFocus",function(evt,data){data.setFocus&&$timeout(function(){element[0].focus()},400)})}}}]),angular.module("serverForm.directives").directive("pguErrorHint",["$rootScope","$timeout","api",function($rootScope,$timeout,api){return{restrict:"E",replace:!0,template:'<div class="PGU-ErrorHint"><div class="error-bg"></div><div class="error-icon" ng-mouseover="hover(); checkWidth()"></div><div data-ng-class="{\'error-content\' : true,\'PGU-ErrorHint-Right\' : errorToRight,\'PGU-ErrorHint-Correct\' : needCorrectError,\'PGU-ErrorHint-Fixed-Width\': needFixWidth}" ng-show="know">{{(model.error.mnemonic + \'.validator\' | translate:model.error.text) ||  (model.error.text || model.error)}}</div></div>',scope:{cl:"=",change:"&",blur:"&",focus:"&",model:"=",disabled:"=",hover:"="},link:function(scope,element,attrs){scope.checkWidth=function(){$rootScope.$applyAsync(function(){var width=element.width(),rect=element[0].getBoundingClientRect();scope.needCorrectError=width<380&&width>280||rect.left+width<280,scope.needFixWidth=width<280,rect.right+width>document.body.clientWidth&&!scope.needCorrectError&&(scope.errorToRight=!0),scope.know=!0})}}}}]),angular.module("serverForm.directives").directive("pguSelect",["$rootScope","$timeout","$filter","api","apiInner","TEMPLATES","$document","pguSelectService","PGU","KEYCODES","$anchorScroll",function($rootScope,$timeout,$filter,api,apiInner,TEMPLATES,$document,pguSelectService,PGU,KEYCODES,$anchorScroll){return{restrict:"E",replace:!0,templateUrl:TEMPLATES.SELECT,scope:{model:"=",options:"=",change:"&"},link:function(scope,element,attrs){function addTextValue(val){var el={};if(val&&scope.model.list){var searchList;searchList=scope.model.isKladr?PGU.Kladr&&PGU.Kladr[scope.model.fullPath]&&PGU.Kladr[scope.model.fullPath].originList&&PGU.Kladr[scope.model.fullPath].originList.slice()||[]:scope.model.listOriginal&&scope.model.listOriginal.length?scope.model.listOriginal.slice():scope.model.list.slice(),el=getModelFromList(scope.model.value,searchList),scope.model.isRestore||setValueToModel(el)}else scope.model.list&&(scope.model.isFiasDaData?el.shortTitle&&(scope.model.shortTitle=""):(scope.model.text_value="",el.shortTitle&&(scope.model.shortTitle="")))}function changeActiveListItem(method){var listLength,list=scope.filteredList,currentItem=scope.ui.currentItem,noEmptyField=scope.options.noEmptyField;if(list&&list.length){if(listLength=list.length-1,list)switch(method){case"next":currentItem=-1==currentItem?0:currentItem==listLength?noEmptyField?0:-1:currentItem+1>listLength?0:currentItem+1;break;case"prev":currentItem=0==currentItem?noEmptyField?listLength:-1:currentItem-1<0?listLength:currentItem-1;break;case"select":-1==currentItem?scope.selectElement():scope.selectElement(list[currentItem].value,!0)}scope.ui.currentItem=currentItem;var $list=element.find("ul"),$currentItem=$list.find("li")[currentItem],optionsOuterHeight=$currentItem?$currentItem.offsetHeight:0;0==optionsOuterHeight&&(optionsOuterHeight=element.find("div").outerHeight(!0)),$list.scrollTop(currentItem*optionsOuterHeight),api.applyScope()}}function toggleDropdown(act,selectDropdownClose){if(scope.ui||(scope.ui={}),"FieldYear"==scope.model.className&&scope.model.filter&&!_.find(scope.model.list,function(x){return x.value==scope.model.filter})&&(scope.model.filter=""),act&&(scope.$emit("selectDropdownOpened",{fullPath:scope.model.fullPath}),scope.model.isBlur=!1,window.innerHeight-element[0].getBoundingClientRect().top<150&&!($rootScope.settings.mobOptimizeFiasDaData&&scope.model.isFiasDaData&&api.isMobile())?scope.model.endOfPage={top:"auto",bottom:"54px"}:scope.model.endOfPage={}),scope.ui.isOpen!=act)if(scope.ui.isOpen=!(!act||scope.model.disabled||scope.model.readonly||scope.model.immutable),scope.model.isOpen=scope.ui.isOpen,scope.toggleListContainer(scope.ui.isOpen),act||(scope.ui.isFocus=!1),act&&scope.options.openCallback){if(scope.ui.isLoad=!0,scope.ui.responseError=!1,scope.toggleList(!1),scope.model.haveData)return scope.model.isKladr&&(void 0===scope.model.filter&&(scope.model.filter=""),scope.changeHandler()),scope.toggleList(!0),void scope.scrollToSelected();scope.options.openCallback?scope.options.openCallback(function(options,withoutCache){scope.ui.responseError=void 0!==options.error&&("boolean"==typeof options.error?options.error:options.error.code?options.error.code:0),scope.ui.searchIsEmpty=options.searchIsEmpty;var list=scope.model.list&&scope.model.list.length?scope.model.list:scope.model.listOriginal,filter=scope.model.filter,isHallDropdown=scope.model.fullPath.indexOf("_hallDropDown")>-1;scope.ui.searchIsEmpty&&!isHallDropdown?scope.model.message="Запрос не дал результатов":filter&&filter.length>0&&filter.length<3?scope.model.message="Введите минимум три символа":!(filter&&filter.length>3&&list&&list.length)||scope.model.list&&scope.model.list.length?scope.model.message="":scope.model.message="Запрос не дал результатов",scope.model.isMultiple&&(scope.model.list&&!scope.model.list.length||!scope.model.list)&&options.allItemsSelected&&(scope.model.message="Нет доступных вариантов для выбора"),scope.model.haveData=list&&list.length&&scope.model.cached,scope.toggleList(!!(list&&list.length||!list)||scope.ui.searchIsEmpty),scope.ui.responseError&&(scope.toggleListContainer(!1),scope.ui.isOpen=!1),scope.scrollToSelected()}):(scope.toggleList(!0),scope.scrollToSelected())}else if(act&&scope.model.isFiasDaData&&scope.model.parentFiasFullCode){var isFilterChanged=scope.model.previousFilter!==scope.model.filter,inListFilter=_.find(scope.model.list,function(item){return item.value===scope.model.parentFiasFullCode});!inListFilter||isFilterChanged?(scope.ui.isLoad=!0,scope.toggleList(!1),scope.options.changeCallback(scope.model.filter,function(options){scope.model.handleChangeCallback(options),scope.model.previousFilter=scope.model.filter})):(scope.model.previousFilter=scope.model.filter,scope.ui.isLoad=!1,scope.toggleList(!0))}else act||"function"!=typeof scope.options.blurCallback||selectDropdownClose?(scope.ui.isLoad=!1,scope.toggleList(!0),!act||"FieldYear"!=scope.model.className&&"FieldMonthExt"!=scope.model.className||scope.scrollToSelected()):(scope.options.blurCallback(),scope.ui.isLoad=!1,scope.toggleList(!0),scope.model.isBlur=!0)}function getModelFromList(value,list){if(list&&list.length)for(var i=0;i<list.length;i++)if(list[i].value==value)return scope.ui.currentItem=i,list[i];return{}}function setValueToModel(el){scope.model.text_value=el.title||scope.model.text_value,el.shortTitle&&(scope.model.shortTitle=el.shortTitle),scope.ui.isMini=!(!(scope.ui.isFocus||scope.model.value||scope.model.text_value)||scope.model.isMultiple)}scope.filtered={list:[]};var isIOS=device.ios(),REPLACE_REGEXP=new RegExp(/[&\\#+$~%'":*?<>(){}\[\]\^]/g),$dropdownBody=element.find(".PGU-dropdown-body"),$list=element.find(".PGU-Dropdown-List"),$bottomListLoader=element.find(".PGU-Dropdown-List-Bottom-Loader");$dropdownBody.hide(),$list.hide(),$bottomListLoader.hide(),scope.toggleListContainer=function(val){var method=!scope.ui.responseError&&val?"show":"hide";$dropdownBody[method]()},scope.toggleList=function(val){$list=$list.length?$list:element.find(".PGU-Dropdown-List"),$bottomListLoader=$bottomListLoader.length?$bottomListLoader:element.find(".PGU-Dropdown-List-Bottom-Loader");var method=val?"show":"hide",loaderMethod=scope.options.isOnlySearch||val?"hide":"show";$list[method](),$bottomListLoader[loaderMethod](),val&&(scope.ui.isLoad=!1)},scope.updateList=function(filter){if("FieldYear"!==scope.model.className||!filter||!isNaN(filter)&&0!=filter){var tmpList=[];scope.oldList=scope.model.listOriginal||scope.oldList;var isSop=scope.model.dictionary&&scope.model.dictionary.isSop;if((scope.model.listOriginal&&scope.model.listOriginal.length||scope.oldList&&scope.oldList.length)&&!scope.model.isMultiple)tmpList=filter&&filter.length&&!isSop?scope.model.fullFilteredList=$filter("filterListItems")(scope.oldList,filter):scope.oldList,tmpList.length>100&&!isSop?scope.filteredList=scope.model.list=tmpList.slice(0,20):scope.filteredList=scope.model.list=tmpList,scope.ui.searchIsEmpty&&(scope.filteredList=[]);else if(scope.model.isMultiple&&!scope.ui.searchIsEmpty){tmpList.length=0,tmpList=scope.oldList.slice();var notSelectedItems=apiInner.removeFromArray(tmpList,scope.model.selectedMultiple);isSop?(scope.model.fullFilteredList=notSelectedItems,scope.filteredList=scope.model.list=scope.cachList=scope.model.fullFilteredList.slice()):(scope.model.fullFilteredList=$filter("filterListItems")(notSelectedItems,filter)||[],scope.model.fullFilteredList.length>100?scope.filteredList=scope.model.list=scope.cachList=scope.model.fullFilteredList.slice(0,20):scope.filteredList=scope.model.list=scope.cachList=scope.model.fullFilteredList.slice())}else scope.ui.searchIsEmpty?scope.filteredList=[]:scope.filteredList=$filter("filterListItems")(scope.cachList,filter);scope.model.filterString=filter,scope.model.filteredList=scope.filteredList,scope.$applyAsync()}},scope.maxLengthOfLabel=api.isMobile()?40:85,function(){if(scope.ui={},scope.ui.yearDropped=!1,scope.ui.isSelectionRangeSet=!1,"FieldYear"!=scope.model.className&&"FieldMonthExt"!=scope.model.className||(scope.cachList=scope.model.list,scope.filteredList=scope.cachList),scope.options=angular.extend({searchFromServer:!1,search:!1,isOnlySearch:!1,filterServerMinLength:!1,changeTimeout:200,noEmptyField:!1},scope.options),scope.ui.currentItem||(scope.ui.currentItem=-1,scope.model.value=scope.model.value||""),(scope.options.searchFromServer||scope.options.search||"FieldYear"===scope.model.className)&&(scope.ui.search=!0),scope.model.value&&!scope.model.text_value)if(scope.model.list)setValueToModel(getModelFromList(scope.model.value,scope.model.list));else var watchlist=scope.$watch("model.list",function(val,oldVal){val&&(setValueToModel(getModelFromList(scope.model.value,scope.model.list)),watchlist())});!scope.model.value&&scope.model.text_value&&(scope.ui.isMini=!(!(scope.ui.isFocus||scope.model.value||scope.model.text_value)||scope.model.isMultiple)),$rootScope.isDesigner||(scope.$watch("model.filter",function(newVal,oldVal){"FieldYear"==scope.model.className&&0==scope.model.filter&&(scope.model.filter=""),!scope.model.isKladr||scope.model.list&&scope.model.list.length||newVal==oldVal||void 0!==newVal||(scope.ui.isMini=!1)}),scope.$watchCollection("model.list",function(newList,oldList){scope.model.isFiasDaData||(scope.tmpList=newList,scope.ui.isOpen&&(scope.cachList=scope.tmpList,scope.filteredList=scope.cachList))}),scope.$watch("ui.isOpen",function(open,oldValue){if("undefined"!==open&&open!=oldValue&&(scope.model.filter&&PGU.Events.publish(scope.model.fullPath+":filter",{filter:scope.model.filter,old:""}),open)){if(scope.model.isFiasDaData&&scope.toggleFiasFields(null,!1,open),"FieldYear"==scope.model.className||"FieldMonthExt"==scope.model.className)return void scope.updateList(scope.model.filter);scope.cachList=[],scope.model.isFiasDaData?scope.cachList=scope.tmpList:$timeout(function(){scope.cachList=scope.model.list,scope.updateList(scope.model.filter)})}}),scope.$watch("model.value",function(val,oldVal){if(val||oldVal){var onValueChange=function(){"object"==typeof val&&JSON.stringify(val)===JSON.stringify({})&&(scope.model.value="",scope.model.text_value="",scope.model.shortTitle=""),addTextValue(val),scope.model.defer.promise.then(function(){addTextValue(val),api.find(scope.model.fullPath).validate(!0)}),(scope.options.isOnlySearch||scope.options.searchFromServer)&&(scope.model.filter=scope.model.text_value),scope.options.modelChange&&scope.options.modelChange(val,oldVal),scope.ui.isMini=!!(scope.ui.isFocus||scope.model.value||scope.model.text_value),scope.model.isRestore&&(scope.model.isRestore=!1),scope.model.cancelEdit&&(scope.model.cancelEdit=!1),void 0===val||val===oldVal||api.env("autosaveDisabled")||(scope.model.isHierarchic?api.uploadDraft(!1,null,null,!1,api.find(scope.model.originalFullPath).getElement()):api.uploadDraft(!1,null,null,!1,scope.model))};scope.model.isMultiple&&scope.model.value!==val?val.split(",").forEach(function(value){value&&onValueChange()}):onValueChange()}}),scope.$on("selectDropdownClose",function(evt,attrs){var needNormalize=scope.model.isFiasDaData&&scope.model.filter!==scope.model.text_value;(attrs.fullPath===scope.model.fullPath||needNormalize)&&(toggleDropdown(!1,!0),scope.options.blurCallback&&!scope.model.isOpenFromList&&(scope.ui.isMini=!(!(scope.ui.isFocus||scope.model.value||scope.model.text_value||scope.model.filter)||scope.model.isMultiple),scope.options.blurCallback(),scope.model.isBlur=!0),scope.model.isOpenFromList=!1,scope.$applyAsync())}),PGU.Events.subscribe(scope.model.fullPath,"removeCurrentItem",function(){scope.ui.currentItem=-1}))}();var keyUpTimeoutPromise;scope.model.handleChangeCallback=function(options){scope.ui.searchIsEmpty=options.searchIsEmpty,scope.ui.responseError=void 0!==options.error&&("boolean"==typeof options.error?options.error:options.error.code?options.error.code:0),scope.ui.isLoad=!1,scope.filteredList=options.list,scope.model.dadataQcComplete=options.dadataQcComplete||"",scope.model.caption=options.caption||"",options.notToggle?scope.model.fiasFieldsShow=!1:scope.toggleList(!0)},scope.selectElement=function(val){if(!scope.ui.isLoad){if(void 0===val&&(scope.ui.currentItem=-1,val=scope.model.filter=scope.model.message="",scope.model.isHierarchic&&scope.changeHandler()),scope.model.isKladr&&(scope.model.filter="",scope.cachList=scope.model.filterCache(scope.model.filter)),scope.model.isFiasDaData)var currentItemData=getModelFromList(val,scope.filteredList),title=val?currentItemData.title:scope.model.filter||"",trimTitle=title.trim(),lastIsComma=","===trimTitle[title.length-1],filter=lastIsComma?title:title+", ";if(scope.model.isValueSelectedByUser=!0,scope.model.currentItemKLADR=scope.ui.currentItem,scope.model.value=val,PGU.Events.publish(scope.model.kladrPath+":selectItem",{scope:scope}),PGU.Events.publish(scope.model.fullPath+":selectItem",{scope:scope}),scope.model.isFiasDaData){$rootScope.canShowSuggestions=!0,scope.ui.isLoad=!0,scope.toggleList(!1),scope.model.text_value=title;var qcComplete=scope.model.dadataQcComplete;($rootScope.settings.mobOptimizeFiasDaData?-1===["0","10","5"].indexOf(qcComplete):-1===["0","10"].indexOf(qcComplete))||scope.filteredList&&scope.filteredList.length>1?(scope.model.filter=filter,scope.options.changeCallback(filter,function(options){scope.model.handleChangeCallback(options),scope.ui.isSelectionRangeSet=!1,scope.putCursorAtEnd(element),scope.ui.currentItem=-1,api.applyScope()},{title:title})):toggleDropdown(!1)}else toggleDropdown(!1),scope.options.selectElementCallback&&scope.options.selectElementCallback(val),"function"==typeof scope.model.geoSearchCallback&&scope.model.geoSearchCallback(getModelFromList(val,scope.filteredList));"FieldDropdownMultiple"!=scope.model.className&&"FieldYear"!=scope.model.className||element.find("input").blur()}},scope.labelClickHandler=function(event){scope.ui.yearDropped=!0,event.stopPropagation(),$timeout(function(){scope.model.disabled||("FieldDropdownMultiple"!==scope.className||scope.model.list&&scope.model.list.length)&&(toggleDropdown(!0),(scope.options.search||scope.options.searchFromServer)&&scope.putCursorAtEnd(element))})},isIOS&&$rootScope.settings.mobOptimizeFiasDaData&&element.on("iosPutCursorAtEnd",".mySuperInput",function(evt,data){if(data&&data.putCursorAtEnd){var $inp=$(this),inp=this;if(inp.setSelectionRange){var len=2*inp.value.length;inp.focus(),inp.setSelectionRange(len,len),this.blur(),$timeout(function(){inp.focus()},10)}else $inp.val($inp.val())}}),scope.putCursorAtEnd=function(element){var len,$inp=element.find("input"),inp=$inp[0];$rootScope.settings.mobOptimizeFiasDaData?(isIOS?$inp.trigger("iosPutCursorAtEnd",{putCursorAtEnd:!0}):$inp.is(":focus")&&$inp.blur(),isIOS||(inp.setSelectionRange?(len=2*inp.value.length,$timeout(function(){inp.setSelectionRange(len,len),$inp.focus()},10)):$inp.val($inp.val()),scope.ui.isSelectionRangeSet=!0)):($inp.is(":focus")||$inp.focus(),scope.ui.isSelectionRangeSet||(inp.setSelectionRange?(len=2*inp.value.length,$timeout(function(){inp.setSelectionRange(len,len)},1)):$inp.val($inp.val()),scope.ui.isSelectionRangeSet=!0))},scope.toggleFiasFields=function(evt,val,newEvent,fromList){fromList?(scope.model.isOpenFromList=!0,scope.model.addressIsEmpty=!scope.model.dadataQcComplete||"1"===scope.model.dadataQcComplete):scope.model.isOpenFromList=!1,scope.options.toggleFiasFields(val,newEvent),val&&toggleDropdown(!1,fromList)},scope.focusLogEl=function(evt){scope.ui.search||scope.model.disabled||"true"===$rootScope.env.formParam.isLogElForm&&$rootScope.$emit("HEALTH_SEND",{event:"logElForm",timing:0,result:3,el:scope.model.fullPath,order_id:api.env("orderId")})},scope.blurLogEl=function(evt){scope.ui.search||scope.model.disabled||"true"===$rootScope.env.formParam.isLogElForm&&$rootScope.$emit("HEALTH_SEND",{event:"logElForm",timing:0,result:4,el:scope.model.fullPath,order_id:api.env("orderId")})};var isFocusedSearchInput=!1;scope.focusHandler=function(event){$timeout(function(){scope.model.disabled||($rootScope.settings.mobOptimizeFiasDaData&&scope.model.isFiasDaData?$document.scrollToElementAnimated(element,70).then(function(){toggleDropdown(!0)}):toggleDropdown(!0),scope.ui.isFocus=!0,scope.ui.isMini=!!scope.ui.isFocus,isFocusedSearchInput||"true"===$rootScope.env.formParam.isLogElForm&&($rootScope.$emit("HEALTH_SEND",{event:"logElForm",timing:0,result:3,el:scope.model.fullPath,order_id:api.env("orderId")}),isFocusedSearchInput=!0),scope.options.focusCallback&&scope.options.focusCallback())},100)},scope.blurHandler=function($event){$timeout(function(){!scope.model.hasContextSearch||scope.model.isFias||scope.model.isFiasDaData||(scope.model.filter="",scope.model.message="",scope.ui.searchIsEmpty=!1,(scope.options.isOnlySearch||scope.options.searchFromServer)&&scope.changeHandler()),scope.model.disabled||(isFocusedSearchInput&&("true"===$rootScope.env.formParam.isLogElForm&&$rootScope.$emit("HEALTH_SEND",{event:"logElForm",timing:0,result:4,el:scope.model.fullPath,order_id:api.env("orderId")}),isFocusedSearchInput=!1),scope.ui.isSelectionRangeSet=!1,scope.ui.isOpen||(scope.ui.isMini=!(!(scope.ui.isFocus||scope.model.value||scope.model.text_value||scope.model.filter)||scope.model.isMultiple)))},100)};var countH=0;scope.changeHandler=function(){if(countH++,scope.model.message="",scope.model.availableForHide=!scope.model.isHierarchic&&scope.model.availableForHide,!scope.options.searchFromServer&&!scope.options.isOnlySearch)return"KladrDropdown"==scope.model.className&&(scope.model.filter=scope.model.filter.replace(REPLACE_REGEXP,""),scope.cachList=scope.model.filterCache(scope.model.filter)),scope.updateList(scope.model.filter),scope.ui.currentItem=-1,void("FieldYear"!=scope.model.className?scope.filteredList&&!scope.filteredList.length||"KladrDropdown"==scope.model.className&&(!scope.cachList||!scope.cachList.length)?scope.model.message="Запрос не дал результатов":scope.model.message="":scope.options.changeCallback&&scope.model.filter&&4===scope.model.filter.length&&scope.options.changeCallback(scope.model.filter,function(options){options&&angular.isDefined(options.value)&&scope.selectElement(options.value)}));scope.model.query_prev=scope.model.filter;var timeout=scope.options.changeTimeout,queryString=scope.model.filter,minlength=scope.options.filterServerMinLength,change=scope.options.changeCallback,goCallBack=function(){scope.ui.isLoad=!0,scope.toggleList(!1),change?change(queryString,function(options){scope.model.handleChangeCallback(options),"DropdownSearchForChild"==scope.model.className&&(!scope.ui.searchIsEmpty&&scope.model.list&&scope.model.list.length?scope.model.message="":scope.model.message="Запрос не дал результатов"),scope.ui.responseError||(scope.model.filter&&(0==scope.model.filter.length||scope.model.filter.length>=3)&&scope.ui.searchIsEmpty?(scope.model.message="Запрос не дал результатов",scope.model.list=[]):scope.model.filter&&scope.model.filter.length>0&&scope.model.filter.length<3&&(scope.model.message="Введите минимум три символа",scope.model.list=[])),scope.model.isMultiple&&options.allItemsSelected&&(scope.model.message="Нет доступных вариантов для выбора"),scope.model.isFiasDaData||(scope.updateList(scope.model.filter),scope.toggleList(!0))}):scope.toggleList(!0)};scope.options.isOnlySearch||scope.options.searchFromServer?!angular.isDefined(minlength)||scope.model&&scope.model.filter.length>=minlength?timeout?($timeout.cancel(keyUpTimeoutPromise),keyUpTimeoutPromise=$timeout(function(){goCallBack()},timeout)):goCallBack():"DropdownSearchForChild"==scope.model.className&&(scope.model.list=[]):goCallBack()},void 0!==scope.options.globalSFDadataDebounce&&scope.options.globalSFDadataDebounce>=0?scope.changeHandlerWithDebounce=_.debounce(scope.changeHandler,scope.options.globalSFDadataDebounce):scope.changeHandlerWithDebounce=scope.changeHandler,scope.mousemoveElement=function(){scope.lastNavigateAction="mousemove"},scope.mouseenterElement=function(currentItem){"keydown"!=scope.lastNavigateAction&&(scope.ui.currentItem=currentItem),scope.lastNavigateAction="mouseenter"};var watchers;scope.$on("suspend",function(){watchers=scope.$$watchers,scope.$$watchers=[]}),scope.$on("resume",function(){scope.$$watchers=watchers,watchers=null}),scope.scrollToSelected=function(){$timeout(function(){if(scope.model.value){getModelFromList(scope.model.value,scope.model.list);var li,list,ul=element.find("ul");if(scope.model.isMultiple)ul.scrollTop(0);else{list=ul.find("li"),list.each(function(i,$el){~$el.className.indexOf("active")&&(li=$el)});var liHeight;if(!li&&list.length&&scope.model.list&&scope.model.list.length){var diff=list.length-scope.model.list.length;li=list[diff>0?scope.ui.currentItem+diff:scope.ui.currentItem]}li?(liHeight=li.offsetHeight,ul.scrollTop(li.offsetTop-(ul[0].clientHeight-liHeight)/2)):ul.scrollTop(0)}}})},scope.onCloseKLadrByEmptySearch=function(evt){evt&&(evt.preventDefault(),evt.stopPropagation()),toggleDropdown(!1,!0)},$rootScope.isDesigner||($(document).on("keydown",function(evt){if(scope.ui.isOpen){scope.lastNavigateAction="keydown";var keyCodes=KEYCODES,keyCode=evt.which;switch(scope.model.lastKeyCode=keyCode,keyCode){case keyCodes.esc:toggleDropdown(!1);break;case keyCodes.down:return changeActiveListItem("next"),!1;case keyCodes.up:return changeActiveListItem("prev"),!1;case keyCodes.enter:changeActiveListItem("select")}}}),element.on("click",".PGU-Wrap-Dropdown-relative",function(event){device.desktop()||element.find("input").focus();var isOpen=scope.ui.isOpen;$rootScope.$applyAsync(function(){scope.model.disabled||("FieldDropdownMultiple"!==scope.className||scope.model.list&&scope.model.list.length)&&(scope.ui.isOpen||toggleDropdown(!0),(scope.options.search||scope.options.searchFromServer)&&(isOpen||scope.putCursorAtEnd(element)))})}))}}}]),angular.module("serverForm.directives").directive("pguCheckbox",["$rootScope","$timeout","api",function($rootScope,$timeout,api){return{restrict:"E",replace:!0,template:"<div class=\"PGU-FieldCheckBox PGU-FieldCheckBox-MarginTop-{{el.marginTop}}\" ng-class=\"{'PGU-Disabled': el.disabled,'PGU-Readonly': el.readonly,'PGU-FieldCheckBox-active': el.checked,'PGU-Required': el.required,'PGU-FieldCheckBox-WithIcons': el.iconType,'PGU-FieldCheckBox-LabelLeft': el.labelToLeft}\">"+'<label data-ng-if="::(el.labelToLeft && !useTranslate)" for="" class="PGU-FieldLabel-List" ng-bind-html="(el.extTextResource | textResource ) || el.label"></label><label data-ng-if="::(el.labelToLeft && useTranslate)" for="" class="PGU-FieldLabel-List" ng-bind-html="(el.fullPath + \'.label\' | translate:el.label) || el.label"></label><span class="PGU-FieldCheckBoxWrap" tabindex="{{el.disabled || tabExclude ? -1 : 1}}"><input type="checkbox" id="{{::el.fullPath}}"/><i class="PGU-LabelIcon"><i></i></i><span class="PGU-Icon-List-Item PGU-Icon-{{::el.iconType}}" ng-if="::el.iconType"></span><label data-ng-if="::(!el.labelToLeft && !useTranslate)" for="" class="PGU-FieldLabel-List" ng-bind-html="(el.extTextResource | textResource ) || el.label"></label><label data-ng-if="::(!el.labelToLeft && useTranslate)" for="" class="PGU-FieldLabel-List" ng-bind-html="(el.fullPath + \'.label\' | translate:el.label) || el.label"></label></span></div>',scope:{el:"=",toggle:"=",item:"=",disabled:"=",pguDisabled:"=",setCheckbox:"=",hookCheckbox:"=",tabExclude:"=?"},link:function(scope,element,attrs){function toggleChecked(){if(scope.el.disabled||scope.el.readonly)return!1;var isChecked;scope.el.value=!scope.el.checked+"",isChecked="true"===scope.el.value,scope.el.checked=isChecked,scope.el.textValue=isChecked?"Да":"Нет",scope.toggle&&scope.toggle(scope.el.value,scope.item)}scope.useTranslate=!!$rootScope.env.formParam.translationForm;var isFieldCheckbox="FieldCheckbox"==scope.el.className||"isCheckboxDC"==scope.el.className;if(scope.el.value){var isChecked;isChecked="true"===scope.el.value,scope.el.checked=isChecked,scope.el.textValue=isChecked?"Да":"Нет"}(scope.disabled||scope.pguDisabled)&&(scope.el.disabled=!0),scope.setCheckbox&&toggleChecked(),scope.$watch("disabled",function(val){val&&(scope.el.disabled=!0)}),scope.$watch("pguDisabled",function(val){isFieldCheckbox?scope.el.disabled=!!val:scope.hookCheckbox?scope.el.disabled=!0:scope.el.disabled=!1}),scope.$watch("hookCheckbox",function(val){val?scope.el.disabled=!0:(scope.el.disabled=!1,isFieldCheckbox||(void 0!==scope.el.isCheckedFromField?scope.el.checked=scope.el.isCheckedFromField:scope.el.checked=!1))}),scope.$watch("el.checked",function(val,oldVal){if("undefined"!==val&&val!=oldVal);}),$rootScope.isDesigner||(element.on("mousedown",".PGU-FieldCheckBoxWrap",function(evt){toggleChecked()}),element.bind("keydown keypress",function(event){13!==event.which&&32!==event.which||(scope.$applyAsync(function(){toggleChecked()}),event.preventDefault())}));var watchers;scope.$on("suspend",function(){watchers=scope.$$watchers,scope.$$watchers=[]}),scope.$on("resume",function(){scope.$$watchers=watchers,watchers=null})}}}]),function(){"use strict";angular.module("serverForm.directives").directive("health",["$rootScope","sharedExtServices","apiInner",function($rootScope,sharedExtServices,apiInner){return{restrict:"A",link:function(scope,element,attrs){$rootScope.startTime=(new Date).getTime();var makeRequestHealth=function(data){var s=document.createElement("script");s.type="text/javascript",s.async=!0,s.src=$rootScope.settings.timingApi+"?"+(data||"");var x=document.getElementsByTagName("script")[0];x.parentNode.insertBefore(s,x)},onEvent=$rootScope.$on("HEALTH_SEND",function(event,args){if($rootScope.settings.statistic&&!1!==$rootScope.settings.statistic||$rootScope.settings.timingApi){var params=args;params&&params.event&&(params._=Math.random(),params.pageId=(window.location.pathname+window.location.hash).split(/[(#\/):\.&\?=]/g).slice(1,4).join("_").toLowerCase(),params.moreInfo&&(Object.keys(params.moreInfo).forEach(function(key){params[key]=params.moreInfo[key]}),delete params.moreInfo),makeRequestHealth(apiInner.serializeObj(params)))}});scope.$on("$destroy",onEvent)}}}])}(),angular.module("serverForm.directives").directive("popUp",["$rootScope","$compile","PGU","api",function($rootScope,$compile,PGU,api){return{
template:'<div class="PGU-Generation-popup-Container"><div data-ng-if="item.title" class="PGU-Service-h3 popup-titleContainer">{{item.title}}</div><div id="popupContent" class="PGU-Generation-popup-content-Container"></div><div class="x-clear"></div></div>',scope:{item:"="},restrict:"E",replace:!0,link:function(scope,el,attr){function createClassName(name){return"pop-up-"+name}function appendToDiv(div,item){var newScope=scope.$new();newScope.item=item;var compile=$compile("<"+createClassName(item.className)+' item="item" yidmap="\''+Math.random().toString(36).substr(2,9)+"'\"></"+createClassName(item.className)+">")(newScope);return div.append(compile),compile}function createPopup(content,divPanel){content.items.forEach(function(part){var item=angular.copy(part),div=divPanel||divPopup;item.items?createPopup(item,appendToDiv(div,item)):appendToDiv(div,item)})}var actionOnClose;scope.$watch("item",function(newVal,oldVal){var divPopup=el.find("#popupContent");newVal&&newVal.items&&newVal.items.length&&(actionOnClose=newVal.actionOnClose||null,createPopup(newVal,divPopup))},!0),PGU.Events.subscribe("form","hidePopup",function(){actionOnClose&&actionOnClose(),$("#popupContent").children().each(function(index,item){var scope=$(item).scope&&$(item).scope();scope&&scope.$destroy()}),$("#popupContent").html(""),api.find().element.popupContent={},api.find().element.popupIsOpen=!1,postMessage.send({fadeAll:!1})})}}}]).directive("popUpPanel",["api",function(api){return{template:'<div class="PGU-Panel-inner popup-PanelContainer PGU-Panel-Grid-Item PGU-Panel-GridWidth-{{item.gridType}} PGU-Panel-GridWidth_palm-one-whole PGU-Panel-GridWidth_lap-one-whole {{item.modificator}}"></div>',restrict:"E",replace:!0,scope:{item:"="},link:function(scope,element,attrs){var grids={"1/2":"one-half","1/3":"one-third","2/3":"two-third","1/4":"one-quarter","2/4":"two-quarters","3/4":"three-quarters","1/5":"one-fifth","2/5":"two-fifths","3/5":"three-fifths","4/5":"four-fifths","1/6":"one-sixth","2/6":"two-sixths","3/6":"three-sixths"};scope.item.gridType=grids[api.isTablet()&&scope.item.gridTablet?scope.item.gridTablet:scope.item.grid]}}}]).directive("popUpMap",["$rootScope","$timeout",function($compile,$rootScope,$timeout){return{template:'<div class="popup-MapContainer PGU-FieldBody"><div class="map-throbber-container" ng-if="!item.loaded"><div class="map-throbber"></div></div><yandex-map ng-show="item.loaded" yvalue="item.value" yid="{{yidmap}}" item="item" error="item.error" baloon="item.baloon"></yandex-map></div>',restrict:"E",replace:!0,scope:{item:"=",yidmap:"="},link:function(scope,element,attrs){scope.item.loaded=!1,scope.$on("mapIsLoaded",function(evt,data){scope.item.loaded=data})}}}]).directive("popUpLabel",["$rootScope","$timeout",function($compile,$rootScope,$timeout){return{template:'<div class="PGU-Label" ng-bind-html="item.value"></div>',restrict:"E",replace:!0,scope:{item:"="},link:function(scope,element,attrs){}}}]).directive("popUpButton",["$rootScope","$timeout",function($compile,$rootScope,$timeout){return{template:'<div ng-click="item.func($event)" class="PGU-Button PGU-Btn-Base PGU-Btn-Small {{item.colorClass}}">{{item.label}}</div>',restrict:"E",replace:!0,scope:{item:"="},link:function(scope,element,attrs){scope.item.colorClass="PGU-Btn-Blue","white"==scope.item.color&&(scope.item.colorClass="")}}}]).directive("popUpCustomHtml",["$rootScope","PGU",function($rootScope,PGU){return{template:'<div data-sf-compile-html="item.html"></div>',restrict:"E",replace:!0,scope:{item:"="},link:function(scope,element,attrs){$rootScope.apiPopupFunctionTrigger||($rootScope.apiPopupFunctionTrigger=function(publishData,funcArgs){PGU.Events.publish(":"+publishData,funcArgs)})}}}]),function(){"use strict";angular.module("serverForm.directives").directive("simpleTimer",["$timeout","$rootScope",function($timeout,$rootScope){return{restrict:"E",template:"<span>{{string1}}&nbsp;{{minutes}}:{{format_seconds}}&nbsp;{{string2}}</span>",link:function(scope,element,attrs){var timer;scope.minutes=~~(scope.time/60),scope.seconds=scope.time%60,scope.format_seconds=scope.seconds;var updateCounter=function(){if(0==scope.seconds){if(0==scope.minutes)return $timeout.cancel(timer),void($rootScope.showTimer=!1);scope.seconds=60,scope.minutes--}scope.seconds--,scope.format_seconds=scope.seconds<10?"0"+scope.seconds:scope.seconds,timer=$timeout(updateCounter,1e3)};updateCounter()},replace:!0,scope:{time:"=",string1:"@",string2:"@"}}}])}(),angular.module("serverForm.services").factory("pguFiasService",["apiInner","$rootScope","$compile","$routeParams","$http","CONFIG","$q","sharedExtServices","api","$timeout","Validators","KEYCODES","PGU",function(apiInner,$rootScope,$compile,$routeParams,$http,CONFIG,$q,sharedExtServices,api,$timeout,Validators,KEYCODES,PGU){return{setValueToString:function(scope,address,fiasCode,okatoCode){var self=this;address&&(fiasCode?fiasCode&&self.getFullFiasDataByCode(fiasCode,function(data){self.fetchFullFiasData(scope,data)}):self.loadFiasFromServer({q:address||""},function(response){if(response&&response.error&&0===response.error.code&&response.addresses&&response.addresses.length){var fiasCode=response.addresses[0].code;fiasCode&&self.getFullFiasDataByCode(fiasCode,function(data){self.fetchFullFiasData(scope,data)})}},function(error){}))},initFiasFields:function(scope){var defer=$q.defer(),self=this;scope.model.fias=api.find(scope.item.fullPath),scope.model.controlsPanel=scope.model.fias.find("PanelControls"),scope.model.canSaveForm=!1,scope.model.controlsObj={fullAddress:{level:-1,panel:scope.model.controlsPanel.find("PanelFullAddress"),el:scope.model.controlsPanel.find("PanelFullAddress.FullAddress")},region:{level:1,shortType:"обл",longAbbr:"область",panel:scope.model.controlsPanel.find("PanelRegion"),el:scope.model.controlsPanel.find("PanelRegion.Region")},area:{level:3,shortType:"р-н",longAbbr:"район",panel:scope.model.controlsPanel.find("PanelArea"),el:scope.model.controlsPanel.find("PanelArea.Area")},city:{level:4,abbr:"г",longAbbr:"город",panel:scope.model.controlsPanel.find("PanelCity"),el:scope.model.controlsPanel.find("PanelCity.City"),checkbox:scope.model.controlsPanel.find("PanelCity.CityNo")},cityArea:{level:5,abbr:"окр",longAbbr:"округ",panel:scope.model.controlsPanel.find("PanelCityArea"),el:scope.model.controlsPanel.find("PanelCityArea.CityArea")},place:{level:6,abbr:"п",longAbbr:"п.",panel:scope.model.controlsPanel.find("PanelPlace"),el:scope.model.controlsPanel.find("PanelPlace.Place")},street:{level:7,abbr:"ул",longAbbr:"улица",panel:scope.model.controlsPanel.find("PanelStreet"),el:scope.model.controlsPanel.find("PanelStreet.Street")},additionalArea:{level:90,abbr:"доп. р-н",panel:scope.model.controlsPanel.find("PanelAdditionalArea"),el:scope.model.controlsPanel.find("PanelAdditionalArea.AdditionalArea")},additionalStreet:{level:91,abbr:"доп. ул",panel:scope.model.controlsPanel.find("PanelAdditionalStreet"),el:scope.model.controlsPanel.find("PanelAdditionalStreet.AdditionalStreet")},house:{level:11,abbr:"д",panel:scope.model.controlsPanel.find("PanelHBBA.PanelHouse"),el:scope.model.controlsPanel.find("PanelHBBA.PanelHouse.House"),checkbox:scope.model.controlsPanel.find("PanelHBBA.PanelHouse.HouseNo")},building1:{level:12,abbr:"корп",panel:scope.model.controlsPanel.find("PanelHBBA.PanelBuilding1"),el:scope.model.controlsPanel.find("PanelHBBA.PanelBuilding1.Building1")},building2:{level:13,abbr:"стр",panel:scope.model.controlsPanel.find("PanelHBBA.PanelBuilding2"),el:scope.model.controlsPanel.find("PanelHBBA.PanelBuilding2.Building2")},apartment:{level:14,abbr:"кв",panel:scope.model.controlsPanel.find("PanelHBBA.PanelApartment"),el:scope.model.controlsPanel.find("PanelHBBA.PanelApartment.Apartment"),checkbox:scope.model.controlsPanel.find("PanelHBBA.PanelApartment.ApartmentNo")},post_index:{level:100,abbr:"",panel:scope.model.controlsPanel.find("PanelPostIndex"),el:scope.model.controlsPanel.find("PanelPostIndex.PostIndex")}},scope.item.controlsObj=scope.model.controlsObj;for(var c in scope.model.controlsObj)scope.model.controlsObj[c].data={};return scope.model.levelToElement={1:scope.model.controlsObj.region,3:scope.model.controlsObj.area,4:scope.model.controlsObj.city,5:scope.model.controlsObj.cityArea,6:scope.model.controlsObj.place,7:scope.model.controlsObj.street,11:scope.model.controlsObj.house,12:scope.model.controlsObj.building1,13:scope.model.controlsObj.building2,14:scope.model.controlsObj.apartment,9:scope.model.controlsObj.additionalArea,91:scope.model.controlsObj.additionalStreet,100:scope.model.controlsObj.post_index},this.clearForm(scope),scope.item.fias_full_code?(scope.model.isRestore=!0,self.getFullFiasDataByCode(scope.item.fias_full_code,function(data){self.fetchFullFiasData(scope,data,defer)})):defer.resolve(),defer.promise},setDraftFromEdit:function(scope,defer){var self=this;if(scope.model.isRestore=!0,scope.item.fias_full_code)self.getFullFiasDataByCode(scope.item.fias_full_code,function(data){self.fetchFullFiasData(scope,data,defer)});else{var el=api.find(scope.item.fullPath),dropdown=el.find("PanelControls.PanelDropdown.Dropdown");dropdown.element.isRestore=!0,dropdown.element.text_value=scope.item.value,dropdown.element.filter=scope.item.value,dropdown.element.list=[],dropdown.value(scope.item.fias_full_code),self.clearForm(scope),scope.model.isRestore=!1,defer.resolve()}},setWatchers:function(scope){var self=this,el=api.find(scope.item.fullPath),dropdownApi=el.find("PanelControls.PanelDropdown.Dropdown"),dropdownEl=dropdownApi.getElement();self.setWatcherOnBlur(scope,dropdownApi,el),scope.$on(dropdownEl.fullPath+":fiasDropdownSearch",function(evt,data){var value,filter=data.filter,keyCode=data.keyCode,postIndexRegexp=/^(\d{1,6}),/,postIndex="";value=$.trim(filter.replace(postIndexRegexp,function(match,p1){return postIndex=p1||"",""})),postIndex&&scope.model.controlsObj.post_index.el.value(postIndex),keyCode!==KEYCODES.backspace&&keyCode!==KEYCODES.del||value||(data.callback&&data.callback({searchIsEmpty:!1}),dropdownEl.list=[],dropdownEl.value="",dropdownEl.text_value="",scope.model.canSaveForm=!1,self.clearForm(scope),scope.model.canSaveForm=!0,self.saveFormData(scope)),value&&value.length>=3&&self.loadFiasFromServer({q:value||""},function(response){if(response&&response.error&&0===response.error.code&&data.queryString===data.filter)if(response.addresses&&response.addresses.length){for(var list=[],wordArr=value.split(" "),i=0;i<response.addresses.length;i++){var item=response.addresses[i],htmlAddress=item.address;wordArr.forEach(function(word){var regexp=new RegExp("("+word.replace(/([\/|()*+?$^{}\[\].])/g,"\\$1")+")","i");htmlAddress=htmlAddress.replace(regexp,"<b>$1</b>")}),list.push({title:item.address,htmlTitle:htmlAddress,value:item.code,level:0,shortTitle:""})}dropdownEl.list=list}else dropdownEl.list=[];data.callback&&data.callback({searchIsEmpty:response.addresses&&!response.addresses.length})},function(error){})}),scope.$watch(function(){return dropdownEl.value},function(val,oldVal){val==oldVal||scope.model.isRestore||self.getFullFiasDataByCode(val,function(data){self.fetchFullFiasData(scope,data)})});for(var c in scope.model.controlsObj){var control=scope.model.controlsObj[c];control&&control.el&&(control.level>0&&self.setWatcherOnValue(scope,control.el),control.level>0&&self.setWatcherOnBlur(scope,control.el))}scope.$watch(function(){return scope.model.controlsObj.city.checkbox.element.checked},function(val,oldVal){scope.model.canSaveForm&&val!=oldVal&&self.saveFormData(scope)}),scope.$watch(function(){return scope.model.controlsObj.house.checkbox.element.checked},function(val,oldVal){if(val!=oldVal||val){var house=scope.model.controlsObj.house.el,building1=scope.model.controlsObj.building1.el;val?(scope.tempHouse=house.value(),house.value("")):house.value(scope.tempHouse||""),scope.model.canSaveForm&&self.saveFormData(scope),house.setRequired(!val),building1.required(!!val&&!scope.item.allowOptionalBuilding1),house.validate()&&house.error(!1),building1.validate()&&building1.error(!1)}}),scope.$watch(function(){return scope.model.controlsObj.apartment.checkbox.element.checked},function(val,oldVal){if(val!=oldVal||val){var apartment=scope.model.controlsObj.apartment.el;val?(scope.tempApartment=apartment.value(),apartment.value("")):apartment.value(scope.tempApartment||""),scope.model.canSaveForm&&self.saveFormData(scope),apartment.setRequired(!val),apartment.validate()&&apartment.error(!1)}})},setWatcherOnValue:function(scope,element){var self=this;scope.$watch(function(){return element.element.value},function(value,oldValue){void 0!==value&&value!==oldValue&&api.find(element.element.fullPath).afterSetValue(value,oldValue),scope.model.canSaveForm&&self.saveFormData(scope)})},setWatcherOnBlur:function(scope,element,parent){scope.$on(element.element.fullPath+":blur",function(evt,data){if(parent)parent.validate();else{element.validate()}})},loadFiasFromServer:function(opts,success,error){sharedExtServices.kladrFindFiasAddress(opts,success,error)},saveFormData:function(scope,defer){var fullAddress="",elmCode="",oktmoCode="";scope.item.fias_full_code=scope.model.fiasCodeByLevel||"",scope.item.kladrCode=scope.model.kladrCode||"";for(var c in scope.model.controlsObj){var control=scope.model.controlsObj[c];if(control.level>0){control.checkbox&&control.checkbox.visible()&&(scope.item[c+"Disabled"]=control.checkbox.element.checked?"yes":"no",scope.item.disabled?control.checkbox.disabled(!0):control.el.disabled(control.checkbox.element.checked),4==control.level&&(scope.model.controlsObj.cityArea.el.element.disabled=control.checkbox.element.checked,scope.model.controlsObj.place.el.element.disabled=control.checkbox.element.checked));var dataValue=control.data.dataValue||control.el.element.value,shortType=control.data.shortType||control.abbr,itemValue=dataValue||"",itemShortType=shortType||"";if(control.checkbox&&control.checkbox.element.checked&&(itemValue="",dataValue=""),itemValue&&!control.data.notAddToFullAddress&&(100===control.level?fullAddress=itemValue+", "+fullAddress:fullAddress+=fullAddress?", "+itemValue+" "+itemShortType+".":itemValue+" "+itemShortType+"."),scope.item[c]=dataValue,control.data.elmCode&&(elmCode=control.data.elmCode),control.data.oktmoCode&&(oktmoCode=control.data.oktmoCode),control.level<12&&scope.item.fullCodes){var fiasCode=control.data.fiasCode||"",kladrCode=control.data.kladrCode||"";scope.item[c+"Fias"]=fiasCode||"",scope.item[c+"Kladr"]=kladrCode||""}}scope.item.attrs[c+"ShortType"]&&(scope.item[c+"ShortType"]=scope.item.controlsObj[c].data.shortType||""),scope.item.attrs[c+"Type"]&&(scope.item[c+"Type"]=scope.item.controlsObj[c].data.type||"")}scope.item.elmCode=elmCode,scope.item.oktmoCode=oktmoCode,scope.item.value=fullAddress,scope.model.isRestore&&(scope.model.strategyAddress&&(scope.model.strategyAddress.value=fullAddress),scope.model.isRestore=!1),fullAddress&&(scope.model.controlsObj.fullAddress.el.element.value=fullAddress,scope.model.controlsObj.fullAddress.panel.element.visible=!0),scope.item.fiasDone=scope.item.fias_full_code||"",defer&&defer.resolve()},getFullFiasDataByCode:function(fiasCode,callback){sharedExtServices.kladrGetFiasInfo(fiasCode,function(data){callback&&callback(data)},function(error){})},fetchFullFiasData:function(scope,data,defer){var self=this;if(data&&data.address&&data.address.elements&&data.address.elements.length){if(scope.model.isRestore){scope.item.initStrategy=!0;var el=api.find(scope.item.fullPath),dropdown=el.find("PanelControls.PanelDropdown.Dropdown");dropdown.element.isRestore=!0,dropdown.element.text_value=scope.item.value,dropdown.element.filter=scope.item.value,dropdown.value(scope.item.fias_full_code),dropdown.element.list=[]}var address=data.address;address=self.checkFederalObjects(address),this.setFormData(scope,address,defer)}else{if(data.emptyCode)return defer&&defer.resolve(),this;defer&&defer.resolve();api.find(scope.item.fullPath).attr("error","Невозможно получить данные. Повторите запрос позже.")}},checkFederalObjects:function(address){switch(address.fiasCode){case"0c5b2444-70a0-4932-980c-b4dc0d3f02b5":address.elements.push({data:"Москва",level:4,elmCode:"45000000000",fiasCode:"0c5b2444-70a0-4932-980c-b4dc0d3f02b5",kladrCode:"77000000000",nullshortType:"г",type:"Город",notAddToFullAddress:!0});break;case"c2deb16a-0330-4f05-821f-1d09c93331e6":address.elements.push({data:"Санкт-Петербург",level:4,elmCode:"40000000000",fiasCode:"c2deb16a-0330-4f05-821f-1d09c93331e6",kladrCode:"78000000000",nullshortType:"г",type:"Город",notAddToFullAddress:!0});break;case"63ed1a35-4be6-4564-a1ec-0c51f7383314":address.elements.push({data:"Байконур",level:4,elmCode:"55000000000",fiasCode:"63ed1a35-4be6-4564-a1ec-0c51f7383314",kladrCode:"99000000000",nullshortType:"г",type:"Город",notAddToFullAddress:!0});break;case"6fdecb78-893a-4e3f-a5ba-aa062459463b":address.elements.push({data:"Севастополь",level:4,elmCode:"",fiasCode:"6fdecb78-893a-4e3f-a5ba-aa062459463b",kladrCode:"92000000000",nullshortType:"г",type:"Город",notAddToFullAddress:!0})}return address},setFormData:function(scope,data,defer){var self=this;scope.model.canSaveForm=!1,scope.item.fias_full_code=data.fiasCode,scope.item.numericFiasCode=data.numericFiasCode,scope.model.isRestore&&(scope.model.strategyAddress=scope.model.strategyAddress||{},scope.model.strategyAddress.numericFiasCode=data.numericFiasCode);var elements=data.elements;if(!elements.length)return defer&&defer.resolve(),!1;var AddressSearch="";scope.model.kladrCode="",scope.model.fiasCodeByLevel="";var lastLevel=0,isHouseDefined=!1,house=scope.model.controlsObj.house,mainLevels=[1,3,4,5,6,7,9,91,11,12,13,14],houseLevels=[11,12,13,14,100];if(house&&(house.el.disabled(!1),house.panel.visible(!0)),this.clearForm(scope),elements.forEach(function(elem){var dataValue=elem.data||"",level=elem.level;65===level&&(level=9);var isDisabled,fiasCode=elem.fiasCode,retValue="";if(level){var inHouseLevelsIndex=houseLevels.indexOf(level),currEl=scope.model.levelToElement[level];lastLevel=lastLevel<level?level:lastLevel,scope.model.kladrCode=elem.kladrCode?elem.kladrCode:scope.model.kladrCode,inHouseLevelsIndex>-1&&houseLevels.splice(inHouseLevelsIndex,1),retValue=fiasCode?11===level||12===level||13===level?dataValue:dataValue+(elem.shortType?" "+elem.shortType+".":""):dataValue,14!=level&&(AddressSearch+=AddressSearch.length&&retValue?", "+retValue:retValue),11===level&&fiasCode&&(isHouseDefined=!0,house.el.required(!0),house.checkbox.disabled(!0),house.checkbox.visible(!1)),fiasCode&&currEl?(currEl.data.dataLevel=level,currEl.data.dataValue=dataValue,currEl.data.elmCode=elem.elmCode||"",currEl.data.oktmoCode=elem.oktmoCode||"",currEl.data.fiasCode=fiasCode||"",currEl.data.kladrCode=elem.kladrCode||"",currEl.data.type=elem.type,currEl.data.shortType=elem.shortType,currEl.data.notAddToFullAddress=elem.notAddToFullAddress,scope.model.fiasCodeByLevel=fiasCode,isDisabled=!0):isDisabled=!1,currEl&&(currEl.el.element.value=retValue,currEl.el.element.disabled=isDisabled,currEl.panel.element.visible=!0)}}),api.find(scope.item.fullPath).find("PanelControls.PanelDropdown.Dropdown").element.disabled=scope.item.disabled,lastLevel){scope.model.controlsObj.city.checkbox.visible(1===lastLevel||3===lastLevel);var lastLevelIndex=mainLevels.indexOf(lastLevel);mainLevels.splice(lastLevelIndex+1).forEach(function(level){var field=scope.model.levelToElement[level];field&&(field.el.element.value=data.allParts&&data.allParts[level]?data.allParts[level]:"",field.el.element.disabled=!1,field.panel.element.visible=!0,4!==lastLevel&&5!==lastLevel||7!==level||(field.el.element.required=!0))}),houseLevels.forEach(function(level){var field=scope.model.levelToElement[level];field&&(field.el.element.value=data.allParts&&data.allParts[level]?data.allParts[level]:"",field.el.element.disabled=isHouseDefined&&(12===level||13===level||14===level||100===level))})}var postIndex=data.allParts&&data.allParts[100]?data.allParts[100]:data.postIndex||"";if(scope.model.levelToElement[100]&&(scope.model.levelToElement[100].el.element.value=postIndex,scope.model.levelToElement[100].panel.element.visible=!0),data.checkedFields&&data.checkedFields.forEach(function(field){scope.model.levelToElement[field].checkbox.element.checked=!0}),scope.model.isRestore)for(var c in scope.model.controlsObj){var control=scope.model.controlsObj[c];scope.item[c]&&(control.el.element.value=scope.item[c]),scope.item[c+"Disabled"]&&"yes"===scope.item[c+"Disabled"]&&(control.checkbox.element.checked=!0)}$timeout(function(){scope.model.canSaveForm=!0,self.saveFormData(scope,defer)},0)},clearForm:function(scope){scope.model.kladrCode="",scope.model.fiasCodeByLevel="";for(var c in scope.model.controlsObj){var control=scope.model.controlsObj[c];control.panel&&control.panel.visible&&control.panel.visible(!1),control.el&&control.el.element&&(control.el.element.value=""),control.el&&control.el.error(!1),control.checkbox&&(control.checkbox.element.checked=!1),control.data={}}}}}]),angular.module("serverForm.services").factory("pguPaymentSrvc",["sharedExtServices","pguSelectService","$rootScope","api","HealthSrv",function(sharedExtServices,pguSelectService,$rootScope,api,HealthSrv){return{getList:function(opts,s,e){opts.dictionary.requestBinding=[],opts.filter=opts.filter||{};var keyVal={};opts.dictionary.requestBinding.forEach(function(item){keyVal[item.name]=item.value}),opts.filter&&Object.keys(opts.filter).forEach(function(key){keyVal[key]=opts.filter[key]}),opts.dictionary.requestBinding=[],Object.keys(keyVal).forEach(function(binding){opts.dictionary.requestBinding.push({name:binding,value:keyVal[binding]})});var options={refName:opts.dictionary.code,treeFiltering:opts.dictionary.treeFiltering||"ONELEVEL",pageNum:opts.pageNum||1,pageSize:opts.pageSize&&"0"!==opts.pageSize?opts.pageSize:"258",filter:pguSelectService.buildFilter({item:opts}),parentRefItemValue:opts.dictionary.parentRefItemValue||"",selectAttributes:opts.dictionary.selectAttributes||["*"],tx:$rootScope.env.systemData.transactionCode},decoratorSuccess=function(data){var items=data.items||[],res=[];items.forEach(function(item){res.push({value:item.value,title:item.title,attr:item.attributeValues})}),s(res)};return sharedExtServices.payment.getList(options,decoratorSuccess,e)},getUin:function(uin,params,paymentCode,success,error){params=params||{};var queryUin={},paramsForm={snils:params.snils?params.snils():"",docType:params.docType?params.docType():"",docSerial:params.docSerial?params.docSerial():"",docNumber:params.docNumber?params.docNumber():""};if(uin){queryUin=uin.attr,params.snils&&paramsForm.snils||(queryUin.documentCode=paramsForm.docType,queryUin.documentParams=[{SERIAL:paramsForm.docSerial,NUMBER:paramsForm.docNumber}]);var decoratorSuccess=function(data){data&&data.value&&success(data.value)};sharedExtServices.payment.getUin(paymentCode,queryUin,decoratorSuccess,error)}},checkStatus:function(paymentCode,success){var decoratorSuccess=function(data){success(data.paymentStatus||{})};sharedExtServices.payment.checkStatus(paymentCode,decoratorSuccess)},getBillDetails:function(billNumber){var requsites={},requestBegin=(new Date).getTime(),errorInfo={type:"searchPriorBillAuth",startTime:requestBegin,addParams:{utm_source:"searchPriorBillAuth_no",billNumber:billNumber.replace("PRIOR",""),epguId:api.env("orderId"),userId:api.env("user").userId,dateTime:requestBegin}};return sharedExtServices.payment.getBillDetails(billNumber).then(function(response){if(response&&response.data&&response.data.bill){var bill=response.data.bill;requsites.paymentPurpose=bill.billName,requsites.isPaid=bill.isPaid,requsites.sum=bill.amount,requsites.recipientPaymentAccount=bill.payRequsites&&bill.payRequsites.account,bill&&bill.addAttrs&&bill.addAttrs.attrs&&bill.addAttrs.attrs.forEach(function(attr){"ReceiverPdfName"===attr.name&&(requsites.recipientTitle=attr.value),"OriginalAmount"===attr.name&&(requsites.originalSum=Number(attr.value))})}else response&&response.data&&response.data.error&&6e3===response.data.error.code&&HealthSrv.checkHealthWhenError(errorInfo,response);return requsites},function(error){error&&500===error.status&&HealthSrv.checkHealthWhenError(errorInfo,error)})},showError:function(){},getFormParams:function(stringParams){var result={},arrayParams=stringParams.split(","),arrayParam=[];return arrayParams.forEach(function(param){arrayParam=param.split(":");var name=arrayParam[0],value=arrayParam[1];result[name]=function(){return"snils"===name?api.find(value).value().replace(/[- ]/g,""):api.find(value).value()}}),result}}}]),angular.module("serverForm.services").factory("pguFiasDaDataService",["apiInner","$rootScope","$compile","$routeParams","$http","CONFIG","$q","sharedExtServices","api","$timeout","Validators","KEYCODES","PGU","FIASDADATACAPTIONS","FIASDADATAREACHGOALS","FIASDADATAEVENTCONFIG","FIASTOKLADRMAPATTRIBUTES",function(apiInner,$rootScope,$compile,$routeParams,$http,CONFIG,$q,sharedExtServices,api,$timeout,Validators,KEYCODES,PGU,FIASDADATACAPTIONS,FIASDADATAREACHGOALS,FIASDADATAEVENTCONFIG,FIASTOKLADRMAPATTRIBUTES){return{setValueToString:function(item,model,address,fiasCode,okatoCode){var self=this;address&&self.getFullFiasDataByString(address,function(data){self.fetchFullFiasData(item,model,data)})},initFiasFields:function(fullPath,fieldsConfig){var model={levelToElement:{}};model.addressIsEmpty=!0;var customPrefix="";model.fias=api.find(fullPath);var dropdown=model.fias.find("PanelControls.PanelDropdown.Dropdown"),fiasLabel=model.fias.label();fiasLabel&&(dropdown.label(fiasLabel),model.fias.label(""));model.fias.required()||model.fias.notRequiredText()&&(dropdown.notRequiredText(model.fias.notRequiredText()),dropdown.notRequiredText(model.fias.notRequiredText())),model.controlsPanel=model.fias.find("PanelControls.PanelHandFields"),model.panelQCFields=model.fias.find("PanelControls.PanelQCFields");var panelQCFieldsControls=model.panelQCFields.find("PanelQCFieldsControls"),city=model.controlsPanel.find("PanelCity.City");model.cityRequired=!!city&&city.required(),model.tempValues={},model.qcControls={labelError:{el:panelQCFieldsControls.find("PanelLabel.LabelError"),panel:panelQCFieldsControls.find("PanelLabel")}},model.controlsObj={fullAddress:{level:-1,panel:model.controlsPanel.find("PanelFullAddress"),el:model.controlsPanel.find("PanelFullAddress.FullAddress")}},model.canSaveForm=!1;var dadataQcCompleteFromConfig;return _.each(fieldsConfig,function(item){"city"!==item.levelName&&item.checkboxLabel&&(model.qcControls[item.levelName]={checkbox:panelQCFieldsControls.find("PanelLabel."+item.checkboxPath),panel:panelQCFieldsControls.find("PanelLabel."+item.panelPath)}),"post_index"===item.levelName?model.qcControls[item.levelName]={panel:model.panelQCFields.find("PanelPostIndex"),el:model.panelQCFields.find("PanelPostIndex.PostIndex")}:dadataQcCompleteFromConfig=item.daDataQcComplete,customPrefix=item.level>10&&item.level<15?"PanelHBBA.PanelHBBAWrap.":"",model.controlsObj[item.levelName]={level:item.level,daDataQcComplete:item.daDataQcComplete,shortType:item.shortType,longAbbr:item.longAbbr,abbr:item.abbr,panel:model.controlsPanel.find(customPrefix+item.panelPath),el:model.controlsPanel.find(customPrefix+item.elPath),data:{}},item.checkboxLabel&&(model.controlsObj[item.levelName].checkbox=model.controlsPanel.find(customPrefix+item.checkboxPath)),model.levelToElement[item.level]=model.controlsObj[item.levelName]}),+dadataQcCompleteFromConfig<5&&(model.maxDadataQcCompleteFromConfig=dadataQcCompleteFromConfig),model},initDraftSet:function(item,model){var defer=$q.defer(),self=this,fiasFullCode=item.fias_full_code||item.region_code,fiasString=item.value;if(this.clearForm(model,item.fullPath),!fiasFullCode&&!fiasString||item.disabled&&(!item.disabled||fiasFullCode))defer.resolve();else{model.isRestore=!0;var draftData=self.mapElementsFromDraft(item,model);self.getFullFiasDataByString(fiasString,function(data){item.elmCode||(draftData.okato=data.okato||""),item.oktmoCode||(draftData.oktmoCode=data.oktmo||""),!data.address.postIndex&&draftData.address&&(data.address.postIndex=draftData.address.postIndex||""),item.__draftCachedNormalized=data,self.fetchFullFiasData(item,model,data,defer)},!1,function(){self.fetchFullFiasData(item,model,draftData,defer)})}return defer.promise},setDraftFromEdit:function(item,model,defer){var self=this,fiasFullCode=item.fias_full_code,fiasString=item.value;if(model.isRestore=!0,fiasFullCode)model.isSetFromHandler=!0,self.getFullFiasDataByString(fiasString,function(data){self.fetchFullFiasData(item,model,data,defer)});else{api.find(item.fullPath).find("PanelControls.PanelDropdown.Dropdown").element.isRestore=!0,self.clearForm(model,item.fullPath),model.isSetFromHandler=!0,self.saveFormData(item,model,defer)}},setWatchers:function(scope){var self=this,el=api.find(scope.item.fullPath),dropdownApi=el.find("PanelControls.PanelDropdown.Dropdown"),dropdownEl=dropdownApi.getElement();self.setWatcherOnBlur(scope,dropdownApi,el),scope.$on(dropdownEl.fullPath+":fiasDropdownSearch",function(evt,data){var filter=data.filter,value=filter?filter.trim():"",keyCode=data.keyCode,normalized=data.normalized;scope.item.isToggleAll=!1,scope.model.addressIsEmpty=!1,scope.item.fias_full_code="",scope.model.__tempCachedNormalized=null,((keyCode===KEYCODES.backspace||keyCode===KEYCODES.del)&&!value||value.length<3)&&(data.callback&&data.callback({searchIsEmpty:!1,caption:"",dadataQcComplete:"",list:[]}),value||(dropdownEl.value="",dropdownEl.text_value="",dropdownEl.dadataQcComplete="",dropdownEl.parentFiasFullCode="",dropdownEl.fiasFieldsShow=!1),dropdownEl.dadataQcComplete="",scope.item.okato="",scope.model.canSaveForm=!1,self.clearForm(scope.model,scope.item.fullPath),scope.model.canSaveForm=!0,self.saveFormData(scope.item,scope.model)),dropdownEl.caption="",value&&value.length>=3&&(normalized&&normalized.title?(self.updateEventConfig(scope.item,{initialized:!0,selectSuggest:!0}),self.getFullFiasDataByString(normalized.title,function(dataAddress){self.normalizeRequestPromise(scope.item,scope.model,dataAddress,dropdownEl.text_value).then(function(){self.loadFiasFromServer({q:value||""},function(response){self.handleSuggestResponse(scope.model,scope.item,value,data,response,dropdownEl)},function(error){})})})):(self.updateEventConfig(scope.item,{initialized:!0,searchStarted:!0}),self.loadFiasFromServer({q:value||""},function(response){self.clearForm(scope.model,scope.item.fullPath),scope.model.normalizedFiasCode="",self.handleSuggestResponse(scope.model,scope.item,value,data,response,dropdownEl,!0)},function(error){})))});for(var c in scope.model.controlsObj){var control=scope.model.controlsObj[c];control&&control.el&&control.level>0&&self.setWatcherOnValue(scope,control.el)}scope.model.qcControls.post_index&&scope.$watch(function(){return scope.model.qcControls.post_index.el.element.value},function(val,oldVal){scope.model.canSaveForm&&val!=oldVal&&(dropdownEl.fiasFieldsShow||(!1===scope.model.qcControls.post_index.canSave&&""===val?scope.model.qcControls.post_index.canSave=!0:(scope.model.qcControls.post_index.canSave=!0,scope.model.controlsObj.post_index.el.value(val),scope.model.qcControlsPostIndexChange=!0,self.saveFormData(scope.item,scope.model),scope.model.qcControlsPostIndexChange=!1,api.find(scope.item.fullPath).validate(!1,!0))))}),scope.model.controlsObj.post_index&&scope.$watch(function(){return scope.model.controlsObj.post_index.el.element.value},function(val,oldVal){scope.model.canSaveForm&&val!=oldVal&&dropdownEl.fiasFieldsShow&&scope.model.qcControls.post_index.el.value(val)}),scope.model.controlsObj.city&&scope.$watch(function(){return scope.model.controlsObj.city.checkbox.element.checked},function(val,oldVal){scope.model.canSaveForm&&val!=oldVal&&self.updateElementsFromCityChange(scope.item,scope.model,val)}),scope.model.controlsObj.house&&(scope.$watch(function(){return scope.model.controlsObj.house.checkbox.element.checked},function(val,oldVal){
val!=oldVal&&self.updateElementsFromHouseChange(scope.item,scope.model,dropdownEl,val)}),scope.$watch(function(){return scope.model.qcControls.house.checkbox.element.checked},function(val,oldVal){val!=oldVal&&(scope.model.controlsObj.house.checkbox.checked(val),dropdownEl.fiasFieldsShow||scope.item.__draftCachedNormalized||api.find(scope.item.fullPath).validate(!1,!0))})),scope.model.controlsObj.apartment&&(scope.$watch(function(){return scope.model.controlsObj.apartment.checkbox.element.checked},function(val,oldVal){val!=oldVal&&self.updateElementsFromApartmentChange(scope.item,scope.model,dropdownEl,val)}),scope.$watch(function(){return scope.model.qcControls.apartment.checkbox.element.checked},function(val,oldVal){val!=oldVal&&(self.updateEventConfig(scope.item,{apartmentChecked:val}),scope.model.controlsObj.apartment.checkbox.element.checked=val,dropdownEl.fiasFieldsShow||scope.item.__draftCachedNormalized||api.find(scope.item.fullPath).validate(!1,!0))})),scope.$on(dropdownEl.fullPath+":toggleFiasFields",function(evt,data){var PanelControls=scope.model.controlsPanel;scope.model.panelQCFields.visible(!1);var visible;if(void 0!==data.newEvent&&data.newEvent&&self.updateEventConfig(scope.item,{newEvent:!0}),visible=void 0!==data.fiasFieldsShow?data.fiasFieldsShow:!PanelControls.element.visible,PanelControls.element.visible=visible,visible&&!scope.item.fias_full_code&&(!dropdownEl.filter||dropdownEl.filter.length<3||scope.model.addressIsEmpty||dropdownEl.addressIsEmpty))return scope.item.isToggleAll=!0,self.toggleVisibleAllFields(scope.model),api.find(scope.item.fullPath).validate(!1,!0),void(dropdownEl.addressIsEmpty=!1);api.applyScope(),visible?scope.$emit(dropdownEl.fullPath+":blur",{fiasFieldsShow:visible}):(scope.model.normalizedFiasCode="",void 0===data.fiasFieldsShow?scope.$emit(dropdownEl.fullPath+":blur",{fiasFieldsShow:visible}):dropdownEl.filter&&api.find(scope.item.fullPath).validate(!1,!0))})},setWatcherOnValue:function(scope,element){var self=this;scope.$watch(function(){return element.element.value},function(value,oldValue){var dropdownEl=api.find(scope.item.fullPath+".PanelControls.PanelDropdown.Dropdown").getElement();void 0!==value&&value!==oldValue&&scope.model.canSaveForm&&dropdownEl.fiasFieldsShow&&(scope.item.isToggleAll=!1,self.saveFormData(scope.item,scope.model,void 0,void 0,void 0,{changedLevels:["11","14"]}),api.find(scope.item.fullPath).validate(!1,!0))})},handleSuggestResponse:function(model,scopeItem,filter,data,response,dropdownEl,fromSearch){var self=this,suggestions=response&&response.suggestions,normalized=response&&response.normalized,list=[],caption="",wordsArr=filter.split(" "),wordsArrMapReqExp={};if(wordsArr.forEach(function(word,i){wordsArrMapReqExp[i+1]="/"===word?new RegExp("([^<]"+word.replace(/([\/|()*+?$^{}\[\].\\])/g,"\\$1")+"[^>])","i"):new RegExp("("+word.replace(/([\/|()*+?$^{}\[\].\\])/g,"\\$1")+")","i")}),model.controlsObj.fullAddress.el.value(filter),response&&suggestions&&suggestions.error&&0===suggestions.error.code&&data.queryString===data.filter)if(suggestions.addresses&&suggestions.addresses.length){for(var i=0;i<suggestions.addresses.length;i++){var item=suggestions.addresses[i],htmlAddress=item.address;wordsArr.forEach(function(word,i){htmlAddress=htmlAddress.replace(wordsArrMapReqExp[i+1],"<b>$1</b>")}),list.push({title:item.address,htmlTitle:""+htmlAddress,value:item.code?item.code:item.address,level:item.level,shortTitle:""})}normalized&&normalized.dadataQcComplete?((fromSearch&&"4"===normalized.dadataQcComplete||"5"===normalized.dadataQcComplete||"10"===normalized.dadataQcComplete)&&self.updateEventConfig(scopeItem,{qcComplete:normalized.dadataQcComplete,error:!1}),caption=scopeItem.withoutFiasCode&&"7"===normalized.dadataQcComplete?"":FIASDADATACAPTIONS[normalized.dadataQcComplete]):caption=FIASDADATACAPTIONS[6]}else fromSearch&&"-1"===normalized.fiasLevel&&self.updateEventConfig(scopeItem,{error:!0});data&&"function"==typeof data.callback&&data.callback({searchIsEmpty:list.length,caption:caption,dadataQcComplete:normalized?normalized.dadataQcComplete:"6",list:list})},normalizeRequestPromise:function(item,model,data,value){var defer=$q.defer();return value?(model.__tempCachedNormalized={},model.__tempCachedNormalized[value]=data,defer.resolve()):this.fetchFullFiasData(item,model,data,defer),defer.promise},setWatcherOnBlur:function(scope,element,parent,isField){var self=this;scope.$on(element.element.fullPath+":blur",function(evt,data){if(isField);else{var dropdownEl=api.find(scope.item.fullPath+".PanelControls.PanelDropdown.Dropdown").getElement();scope.model.isBlur=!0,scope.model.canSaveForm&&scope.model.normalizedFiasCode&&self.saveFormData(scope.item,scope.model);var cachedData,fullAddress=scope.model.controlsObj.fullAddress.el.value(),tV=dropdownEl.text_value,__tempCachedNormalized=scope.model.__tempCachedNormalized;if(void 0!==scope.model.normalizedFiasCode&&scope.model.normalizedFiasCode===scope.item.fias_full_code&&scope.model.normalizedFiasCode&&scope.model.isFirstOpen)return void parent.validate(!1,!0);fullAddress&&scope.model.isFirstOpen||(fullAddress=dropdownEl.filter),__tempCachedNormalized&&__tempCachedNormalized[tV]&&(cachedData=scope.model.__tempCachedNormalized[tV]),scope.model.isFirstOpen=!0,scope.item.isFirstOpen=!0,fullAddress&&self.getFullFiasDataByString(fullAddress,function(data){self.normalizeRequestPromise(scope.item,scope.model,data).then(function(){data.dadataQcComplete?parent&&parent.validate(!1,!0):parent.validate(!1,!0)})},cachedData)}})},loadFiasFromServer:function(opts,success,error){sharedExtServices.getDaDataSuggests(opts,success,error)},saveFormData:function(item,model,defer,needStopValidate,lvlsWithVal){var control,fullAddress="",elmCode=item.okato,oktmoCode=item.oktmoCode,isSetFromHandler=model.isSetFromHandler,okato=item.okato,controlsObj=model.controlsObj,needChangeFiasCode=!1,fiasCodeFromElement="";item.fias_full_code=model.fiasCodeByLevel||"",model.normalizedFiasCode=model.fiasCodeByLevel||"",item.kladrCode=model.kladrCode||"";var dataValue,isCheckedCheckbox,mapAttrs,stateForCheckbox={changedLevels:[]},el=api.find(item.fullPath),dropdown=el.find("PanelControls.PanelDropdown.Dropdown");dropdown.element.parentFiasFullCode=model.fiasCodeByLevel||"";for(var c in controlsObj)if(controlsObj.hasOwnProperty(c)){if(mapAttrs=FIASTOKLADRMAPATTRIBUTES[c],control=controlsObj[c],item[c]||"",item[c+"Fias"]||"",control.level>0){control.checkbox&&control.checkbox.visible()&&(isCheckedCheckbox=control.checkbox.checked(),item[c+"Disabled"]=isCheckedCheckbox?"yes":"no",control.el.disabled(isCheckedCheckbox),4==control.level&&controlsObj.cityArea&&controlsObj.cityArea.el.disabled(isCheckedCheckbox));var isApartmentNotFlat=14===control.level&&"кв."!==control.el.label().toLowerCase(),shortType="кв"===control.abbr&&isApartmentNotFlat?control.el.label().toLowerCase():control.data.shortType||control.shortType||control.abbr,itemShortType=shortType||"";dropdown.element.fiasFieldsShow&&!model.popup.isEditOpen?control.el.element.disabled?(dataValue=control.data.dataValue||control.el.element.value,control.data.fiasCode&&(fiasCodeFromElement=control.data.fiasCode)):(dataValue=control.el.element.value&&control.el.element.value.replace(itemShortType+".","").trim()||"",control.data.fiasCode&&(!control.data.dataValue||dataValue!==control.data.dataValue&&control.el.element.value!==control.data.dataValue+" "+itemShortType&&control.el.element.value!==control.data.dataValue+" "+itemShortType+"."?needChangeFiasCode=!0:needChangeFiasCode||(fiasCodeFromElement=control.data.fiasCode))):void 0===lvlsWithVal||lvlsWithVal.indexOf(control.level)>-1?dataValue=control.data.dataValue||control.el.element.value:(dataValue=control.data.dataValue||"",control.el.value(dataValue));var itemValue=dataValue||"";if(control.checkbox&&control.checkbox.element.checked&&(itemValue="",dataValue=""),itemValue&&!control.data.notAddToFullAddress&&(100===control.level?fullAddress=itemValue+", "+fullAddress:fullAddress+=fullAddress?", "+(model.isBlur,isApartmentNotFlat?itemShortType+" "+itemValue:itemShortType+". "+itemValue):(model.isBlur,isApartmentNotFlat?itemShortType+" "+itemValue:itemShortType+". "+itemValue)),(item[c]!==dataValue||""===item[c]&&control.el.value())&&stateForCheckbox.changedLevels.push(control.level),item[c]=dataValue,control.data.elmCode&&(elmCode=control.data.elmCode),control.data.oktmoCode&&(oktmoCode=control.data.oktmoCode),void 0!==item[c+"_code"]?item[c+"_code"]=control.data.kladrCode||"":mapAttrs&&(item[mapAttrs]=dataValue,item[mapAttrs+"_code"]=control.data.kladrCode||""),control.level<12&&item.fullCodes){var fiasCode=control.data.fiasCode||"",kladrCode=control.data.kladrCode||"";item[c+"Fias"]=fiasCode||"",item[c+"Kladr"]=kladrCode||""}}item.attrs[c+"ShortType"]&&(item[c+"ShortType"]=controlsObj[c].data.shortType||""),item.attrs[c+"Type"]&&(item[c+"Type"]=controlsObj[c].data.type||"")}if(item.elmCode=elmCode||okato||"",item.oktmoCode=oktmoCode,item.value=fullAddress,fullAddress?(controlsObj.fullAddress.el.value(fullAddress),(dropdown.element.fiasFieldsShow||model.normalizedFiasCode&&(dropdown.element.isBlur||model.isBlur)||model.popup&&model.popup.normalizeAddress||model.qcControlsPostIndexChange||isSetFromHandler||model.isRestore)&&(dropdown.element.filter=fullAddress,dropdown.text_value(fullAddress),dropdown.value(item.fias_full_code))):(controlsObj.fullAddress.el.value(fullAddress),(dropdown.element.fiasFieldsShow||isSetFromHandler)&&(dropdown.text_value(fullAddress),dropdown.value(fullAddress),"function"==typeof dropdown.element.handleChangeCallback&&dropdown.element.handleChangeCallback({notToggle:!0,list:[],caption:""}))),model.isRestore&&(model.strategyAddress&&(model.strategyAddress.value=fullAddress),model.isRestore=!1,model.isSetFromHandler=!1),needChangeFiasCode&&(item.fias_full_code=fiasCodeFromElement,model.normalizedFiasCode=fiasCodeFromElement),item.fiasDone=item.fias_full_code||"",model.isBlur=!1,void 0!==stateForCheckbox){var extendedStateForCheckbox={value:fullAddress,fiasFieldsShow:dropdown.element.fiasFieldsShow};_.extend(extendedStateForCheckbox,stateForCheckbox);var state=this.checkCheckBoxState(extendedStateForCheckbox);this.setCheckBoxState(state,controlsObj,item)}model.popup&&(model.popup.isEditOpen=!1),defer&&defer.resolve();var region=model.controlsObj.region;if(PGU.Events.publish("saveFormData:"+item.fullPath,{region:item.region,regionType:item.regionType,regionFiasCode:region&&region.data&&region.data.fiasCode,regionKladrCode:region&&region.data&&region.data.kladrCode,city:item.city,cityType:item.cityType,area:item.area,areaType:item.areaType,fias_full_code:item.fias_full_code,visible:api.inheritedVisibility(item.fullPath),fullAddress:item.value,okato:item.okato,coords:item.coords}),api.uploadDraft(!1,null,null,!1,item),needStopValidate)return!1},getCachedDataPromise:function(){return $q.defer().promise},getFullFiasDataByCode:function(fiasCode,callback){sharedExtServices.getDaDataDetailsByFiasCode(fiasCode,function(data){callback&&callback(data)},function(error){})},getFullFiasDataByString:function(query,callback,fromCache,callbackError){var df,params={q:query||""},cacheKey=query?JSON.stringify(params):"";if(api.__dadataInitCache=api.__dadataInitCache||{},fromCache)return void(callback&&callback(fromCache));if(cacheKey&&!api.__formInitDone){if(api.__dadataInitCache[cacheKey])return void api.__dadataInitCache[cacheKey].then(function(data){callback&&callback(data)},function(error){callbackError&&callbackError()});df=$q.defer(),api.__dadataInitCache[cacheKey]=df.promise}sharedExtServices.normalizeAddressInDaData(params,function(data){df&&df.resolve(data),callback&&callback(data)},function(error){df&&df.reject(),callbackError&&callbackError()})},fetchFullFiasData:function(item,model,data,defer,fromValidate){var self=this,el=api.find(item.fullPath),dropdown=el.find("PanelControls.PanelDropdown.Dropdown"),itemValue="",fiasFullCode="";if(model.addressIsEmpty=!1,dropdown.element.dadataQcComplete="",data&&data.address&&data.address.elements){if(data.address.elements.length){model.isRestore&&(item.initStrategy=!0,dropdown.element.isRestore=!0,dropdown.element.dadataQcComplete=data.dadataQcComplete,model.isSetFromHandler||(itemValue=item.value,fiasFullCode=item.fias_full_code,dropdown.element.text_value=itemValue,dropdown.element.filter=itemValue,data.address.elements.length?dropdown.value(fiasFullCode):data.address.fullAddress&&"7"===data.dadataQcComplete&&dropdown.value(item.value)));var address=data.address;return address=self.checkFederalObjects(address),this.setFormData(item,model,data,defer,fromValidate)}if("function"==typeof dropdown.element.handleChangeCallback&&dropdown.element.handleChangeCallback({searchIsEmpty:!1,caption:"",dadataQcComplete:"",list:[]}),("1"===data.dadataQc||"2"===data.dadataQc)&&"-1"!==data.fiasLevel)return model.popup.userAddress=dropdown.element.filter,model.popup.normalizeAddress=data.address.fullAddress,model.popup.show=!0,model.popup.show||++$rootScope.env.dadataPopupCounter,model.addressIsEmpty=!0,this.clearForm(model,item.fullPath),model.canSaveForm=!0,this.saveFormData(item,model,!1,fromValidate);if("7"===data.dadataQcComplete||"-1"===data.fiasLevel)return model.addressIsEmpty=!0,item.isToggleAll||this.clearForm(model,item.fullPath),model.canSaveForm=!0,defer&&defer.resolve(),this.saveFormData(item,model,!1,fromValidate);defer&&defer.resolve()}else{if(data.emptyCode)return defer&&defer.resolve(),this;defer&&defer.resolve();api.find(item.fullPath).attr("error","Невозможно получить данные. Повторите запрос позже.")}},checkFederalObjects:function(address){switch(address.fiasCode){case"0c5b2444-70a0-4932-980c-b4dc0d3f02b5":address.elements.push({data:"Москва",level:4,elmCode:"45000000000",fiasCode:"0c5b2444-70a0-4932-980c-b4dc0d3f02b5",kladrCode:"77000000000",nullshortType:"г",type:"Город",notAddToFullAddress:!0});break;case"c2deb16a-0330-4f05-821f-1d09c93331e6":address.elements.push({data:"Санкт-Петербург",level:4,elmCode:"40000000000",fiasCode:"c2deb16a-0330-4f05-821f-1d09c93331e6",kladrCode:"78000000000",nullshortType:"г",type:"Город",notAddToFullAddress:!0});break;case"63ed1a35-4be6-4564-a1ec-0c51f7383314":address.elements.push({data:"Байконур",level:4,elmCode:"55000000000",fiasCode:"63ed1a35-4be6-4564-a1ec-0c51f7383314",kladrCode:"99000000000",nullshortType:"г",type:"Город",notAddToFullAddress:!0});break;case"6fdecb78-893a-4e3f-a5ba-aa062459463b":address.elements.push({data:"Севастополь",level:4,elmCode:"",fiasCode:"6fdecb78-893a-4e3f-a5ba-aa062459463b",kladrCode:"92000000000",nullshortType:"г",type:"Город",notAddToFullAddress:!0})}return address},mapElementsFromDraft:function(item,model){var result,postIndex,controlsObj=model.controlsObj,elements=[];for(var i in controlsObj)controlsObj.hasOwnProperty(i)&&controlsObj[i].level>0&&item[i]&&(100===controlsObj[i].level?postIndex=item[i]:elements.push({data:item[i],fiasCode:item[i+"Fias"]||item.fias_full_code,kladrCode:item[i+"Kladr"],elmCode:item.elmCode,level:controlsObj[i].level,shortType:item[i+"ShortType"]||controlsObj[i].shortType,numericFiasCode:item.numericFiasCode}));return elements.length?(result={address:{fiasCode:item.fias_full_code}},postIndex&&(result.address.postIndex=postIndex),result.address.elements=_.sortBy(elements,function(elem){return elem.level})):result={emptyCode:!0},result},setFormData:function(item,model,request,defer,fromValidate){var control,qcControl,self=this,data=request.address,hasSixthLevel=!1,sixthLevelData="",needStopValidate=!1;item.okato=request.okato,item.oktmoCode=request.oktmo,item.coords=[request.geo_lat,request.geo_lon],model.canSaveForm=!1,item.fias_full_code=data.fiasCode,item.numericFiasCode=data.numericFiasCode,item.taxAreaCode=request.tax_office||"",item.value=data.fullAddress;var dropdownEl=api.find(item.fullPath+".PanelControls.PanelDropdown.Dropdown").getElement();dropdownEl.parentFiasFullCode=data.fiasCode,model.isRestore?(model.strategyAddress=model.strategyAddress||{},model.strategyAddress.numericFiasCode=data.numericFiasCode):model.normalizedFiasCode=data.fiasCode;var elements=data.elements;if(!elements.length)return defer&&defer.resolve(),!1;if(!model.controlsObj){var fiasFields=self.initFiasFields(item.fullPath,item.fieldsConfig);model.controlsObj=fiasFields.controlsObj,model.qcControls=fiasFields.qcControls,model.panelQCFields=fiasFields.panelQCFields,model.levelToElement=fiasFields.levelToElement}model.controlsObj.post_index&&(model.controlsObj.post_index.canSave=!1,model.qcControls.post_index.canSave=!1);var AddressSearch="";model.kladrCode="",model.fiasCodeByLevel="";var lastLevel=-1,isHouseDefined=!1,house=model.controlsObj.house,mainLevels=[1,3,4,5,6,7,90,91,11,12,13,14],itemAttributeNameToLevel={1:"region",3:"area",4:"city",5:"cityArea",6:"place",7:"street",90:"additionalArea",91:"additionalStreet",11:"house",12:"building1",13:"building2",14:"apartment"},levelsWithoutShortType=["house","building1","building2","apartment"],currentIndexByLevel=0,houseLevels=[11,12,13,14,100],lvlsWithVal=[100],stateForCheckbox={changedLevels:[]};if(house&&(house.el.disabled(!1),house.panel.visible(!0)),this.clearForm(model,item.fullPath),dropdownEl.dadataQcComplete=request.dadataQcComplete,"4"!==request.dadataQcComplete&&"5"!==request.dadataQcComplete&&"10"!==request.dadataQcComplete||self.updateEventConfig(item,{qcComplete:request.dadataQcComplete}),"1"!==request.dadataQc&&"2"!==request.dadataQc||"-1"===request.fiasLevel||dropdownEl.isOpen||model.isRestore||(model.popup.userAddress=dropdownEl.filter,model.popup.normalizeAddress=data.fullAddress,model.popup.show||++$rootScope.env.dadataPopupCounter,model.popup.show=!0,fromValidate&&(needStopValidate=!0)),elements.forEach(function(elem){var isDisabled,dataValue=elem.data||"",level=8===elem.level?11:elem.level,fiasCode=elem.fiasCode,retValue="",sixtyFifthData="",itemAttribute=item[itemAttributeNameToLevel[level]],itemAttributeFias=item[itemAttributeNameToLevel[level]+"Fias"];if(6===elem.level?(hasSixthLevel=!0,sixthLevelData=(elem.shortType?elem.shortType+". ":"")+dataValue):8===elem.level?level=11:65===elem.level&&(level=6,hasSixthLevel&&(sixtyFifthData=dataValue+(elem.shortType?" "+elem.shortType+".":"")+" ("+sixthLevelData+")",dataValue=dataValue+" ("+sixthLevelData+")")),level){itemAttribute===elem.data&&itemAttributeFias===fiasCode||stateForCheckbox.changedLevels.push(level),lvlsWithVal.push(level);var inHouseLevelsIndex=houseLevels.indexOf(level),currEl=model.levelToElement[level];currentIndexByLevel=mainLevels.indexOf(level),lastLevel=lastLevel<currentIndexByLevel?currentIndexByLevel:lastLevel,model.kladrCode=elem.kladrCode?elem.kladrCode:model.kladrCode,inHouseLevelsIndex>-1&&houseLevels.splice(inHouseLevelsIndex,1),retValue=fiasCode?11===level||12===level||13===level||14===level?dataValue:65===elem.level&&hasSixthLevel?sixtyFifthData:dataValue+(elem.shortType?" "+elem.shortType+".":""):dataValue,14!=level&&(AddressSearch+=AddressSearch.length&&retValue?", "+retValue:retValue),isHouseDefined&&14===level&&(dropdownEl.caption=""),11===level&&house&&(isHouseDefined=!0,house.el.required(!0),fiasCode&&(house.checkbox.disabled(!0),house.checkbox.visible(!1))),currEl&&(fiasCode?(currEl.data.dataLevel=level,currEl.data.dataValue=dataValue,currEl.data.elmCode=elem.elmCode||"",currEl.data.oktmoCode=elem.oktmoCode||"",currEl.data.fiasCode=fiasCode||"",currEl.data.kladrCode=elem.kladrCode||"",currEl.data.type=elem.type,currEl.data.shortType=elem.shortType,currEl.data.notAddToFullAddress=elem.notAddToFullAddress,model.fiasCodeByLevel=fiasCode,isDisabled=!0):(currEl.data.dataLevel=level,isDisabled=!1,currEl.data.type=elem.type,currEl.data.shortType=elem.shortType,currEl.data.notAddToFullAddress=elem.notAddToFullAddress,model.isRestore&&(currEl.data.dataValue=dataValue)),currEl.el.value(retValue),currEl.el.disabled(isDisabled),currEl.panel.visible(!0))}}),item.disabled&&(dropdownEl.disabled=item.disabled),lastLevel>-1){var city=model.controlsObj.city;city&&city.checkbox&&(city.checkbox.checked()||0===lastLevel||1===lastLevel)&&city.checkbox.visible(!0);mainLevels.splice(lastLevel+1).forEach(function(level){var field=model.levelToElement[level];field&&(field.el.value(data.allParts&&data.allParts[level]?data.allParts[level]:""),field.el.disabled(!1),field.panel.visible(!0),4!==lastLevel&&5!==lastLevel||7!==level||field.el.required(!0))}),houseLevels.forEach(function(level){var field=model.levelToElement[level];field&&(field.el.value(data.allParts&&data.allParts[level]?data.allParts[level]:""),field.el.disabled(isHouseDefined&&(12===level||13===level)),isHouseDefined&&12===level&&field.el.required(!1))})}var postIndex=data.allParts&&data.allParts[100]?data.allParts[100]:data.postIndex||"";if(model.levelToElement[100]&&(item.showPostIndex=!postIndex,model.levelToElement[100].el.value(postIndex),model.controlsObj.post_index.el.value(postIndex),model.levelToElement[100].panel.visible(!0)),data.checkedFields&&data.checkedFields.forEach(function(field){model.levelToElement[field].checkbox.checked(!0)}),model.isRestore||!model.isFirstOpen||item.__draftCachedNormalized)for(var c in model.controlsObj)model.controlsObj.hasOwnProperty(c)&&(control=model.controlsObj[c],qcControl=model.qcControls[c],item[c]&&!model.isSetFromHandler&&(levelsWithoutShortType.indexOf(c)<0&&control.data&&control.data.shortType?control&&control.el.value(item[c]+" "+item[c+"ShortType"]+"."):control&&control.el.value(item[c])),item[c+"Disabled"]&&"yes"===item[c+"Disabled"]&&(qcControl&&qcControl.checkbox&&!qcControl.checkbox.checked()&&qcControl.checkbox.checked(!0),control&&control.checkbox&&!control.checkbox.checked()&&(control.checkbox.checked(!0),"house"===c?self.updateElementsFromHouseChange(item,model,dropdownEl,!0):"city"===c?self.updateElementsFromCityChange(item,model,!0):"apartment"===c&&self.updateElementsFromApartmentChange(item,model,dropdownEl,!0)),control.el.setRequired(!1)));if(model.canSaveForm=!0,fromValidate)return self.saveFormData(item,model,defer,needStopValidate);self.saveFormData(item,model,defer,void 0,lvlsWithVal,stateForCheckbox)},enableAllFields:function(model){var control;for(var c in model.controlsObj)model.controlsObj.hasOwnProperty(c)&&(control=model.controlsObj[c],control.el&&control.el.disabled(!1))},clearForm:function(model,fullPath){var control,isDisabledPart,self=this,el=api.find(fullPath),dropdownEl=el.find("PanelControls.PanelDropdown.Dropdown").getElement();self.clearFormQCFields(model,dropdownEl.fiasFieldsShow,el.element),model.kladrCode="",model.fiasCodeByLevel="",dropdownEl.error="";for(var k in model.tempValues)model.tempValues.hasOwnProperty(k)&&(model.tempValues[k]="");for(var c in model.controlsObj)model.controlsObj.hasOwnProperty(c)&&(control=model.controlsObj[c],control.panel&&control.panel.visible&&control.panel.visible(!1),control.el&&control.el.value&&control.el.value(""),"street"===c&&control.el&&control.el.required&&control.el.required(!1),dropdownEl.fiasFieldsShow||control.checkbox&&(isDisabledPart="yes"===el.element[c+"Disabled"],control.checkbox.checked(isDisabledPart),isDisabledPart&&control.el.required(!1)),control.checkbox&&control.checkbox.disabled(!1),control.checkbox&&(control.checkbox.element.visible=!0),control.data={})},clearFormQCFields:function(model,fiasFieldsShow,el){var qcControls=model.qcControls;model.panelQCFields.element.visible=!1;var control;for(var c in qcControls)qcControls.hasOwnProperty(c)&&(control=qcControls[c],control.panel&&control.panel.visible&&control.panel.visible(!1),control.el&&control.el.error(""),control.el&&control.el.value(""),fiasFieldsShow||control.checkbox&&"function"==typeof control.checkbox.checked&&control.checkbox.checked("yes"===el[c+"Disabled"]),control.data={})},toggleDisabled:function(model,disabled,fullPath){disabled&&(model.disabledHash={});var control,qcControl;api.find(fullPath+".PanelControls.PanelDropdown.Dropdown").disabled(disabled);for(var c in model.controlsObj)model.controlsObj.hasOwnProperty(c)&&"fullAddress"!==c&&(control=model.controlsObj[c],disabled?(control.el&&!control.el.disabled()&&(model.disabledHash[c]=disabled,control.el.disabled(disabled)),control.checkbox&&(qcControl=model.qcControls[c])&&qcControl.checkbox&&control.checkbox.disabled(disabled)):model.disabledHash&&model.disabledHash[c]&&(control.el.disabled(disabled),control.checkbox&&(qcControl=model.qcControls[c])&&qcControl.checkbox&&control.checkbox.disabled(disabled)));disabled||(model.disabledHash=null)},toggleVisibleAllFields:function(model){var control,qcControl;for(var c in model.controlsObj)model.controlsObj.hasOwnProperty(c)&&"fullAddress"!==c&&(control=model.controlsObj[c],control.panel&&control.panel.visible&&control.panel.visible(!0),"city"===c&&control.el.required(model.cityRequired),control.checkbox?(qcControl=model.qcControls[c],qcControl&&qcControl.checkbox&&(qcControl.checkbox.checked()||(control.checkbox.checked(!1),control.el&&control.el.disabled(!1))),control.checkbox.visible(!0),control.checkbox.disabled(!1)):"cityArea"===c||"place"===c||model.controlsObj.city.checkbox.checked()||control.el&&control.el.disabled(!1),control.data={})},setApartmentLabel:function(model,label){model.controlsObj.apartment.el.label(label)},addWidgetToReachGoalAnalyse:function(fullPath){api.__dadataWidgets.push({fullPath:fullPath,event:""})},updateEventConfig:function(item,config){var widget;config.newEvent?item.dadataEvent.config=angular.extend({},FIASDADATAEVENTCONFIG):item.dadataEvent&&(angular.extend(item.dadataEvent.config,config),item.dadataEvent.event=this.getReachGoalByConfig(item.dadataEvent.config)||item.dadataEvent.event,(widget=api.__dadataWidgets.find(function(widget){return widget.fullPath===item.fullPath}))&&(widget.event=item.dadataEvent.event))},updateElementsFromHouseChange:function(item,model,dropdownEl,val){var self=this,house=model.controlsObj.house.el,building1=model.controlsObj.building1.el,building2=model.controlsObj.building2.el;house&&(val?(model.tempValues.house=house.value(),house.value("")):house.value(model.tempValues.house||house.value()||""),model.qcControls.house&&model.qcControls.house.checkbox&&model.qcControls.house.checkbox.checked(val),house.setRequired(!val)),building1&&(item.fullPath,building1.required(!!val&&!item.allowOptionalBuilding1),building1.setRequired(!!val&&!item.allowOptionalBuilding1),dropdownEl.fiasFieldsShow&&(building1.disabled(!1),building2&&building2.disabled(!1)),house&&house.validate(),building1.validate()),model.canSaveForm&&(self.__changedHouse=!0,self.saveFormData(item,model)),dropdownEl.fiasFieldsShow&&api.find(item.fullPath).validate(!1,!0)},updateElementsFromCityChange:function(item,model,val){var city=model.controlsObj.city.el,cityArea=model.controlsObj.cityArea.el,place=model.controlsObj.place.el;city&&(city.disabled(val),city.required(!val&&model.cityRequired)),cityArea&&cityArea.disabled(val),val?(city&&(model.tempValues.city=city.value(),city.value("")),cityArea&&(model.tempValues.cityArea=cityArea.value(),cityArea.value(""))):(city&&city.value(model.tempValues.city||city.value()||""),cityArea&&cityArea.value(model.tempValues.cityArea||cityArea.value()||""),place&&place.required(!1)),this.__changedCity=!0,this.saveFormData(item,model)},updateElementsFromApartmentChange:function(item,model,dropdownEl,val){var self=this,apartment=model.controlsObj.apartment.el;apartment&&(val?(model.tempValues.apartment=apartment.value(),apartment.value("")):apartment.value(model.tempValues.apartment||apartment.value()||""),model.qcControls.apartment&&model.qcControls.apartment.checkbox&&model.qcControls.apartment.checkbox.checked(val),apartment.setRequired(!val),apartment.validate()),model.canSaveForm&&(self.__changedFlat=!0,self.saveFormData(item,model)),dropdownEl.fiasFieldsShow&&api.find(item.fullPath).validate(!1,!0)},getReachGoalByConfig:function(config){var event="";return config.initialized&&(config.error?event=FIASDADATAREACHGOALS.type_addr_error:config.selectSuggest?event=config.apartmentChecked?FIASDADATAREACHGOALS.suggest_addr_not_room:FIASDADATAREACHGOALS.suggest_addr_room:"-1"!==config.qcComplete&&(event=FIASDADATAREACHGOALS.type_addr_room)),event},setCheckBoxState:function(state,controlsObj,item){state=state||[];var control,isCheckedCheckbox,checkBoxState,self=this;for(var k in controlsObj)controlsObj.hasOwnProperty(k)&&(control=controlsObj[k],control.level>0&&control.checkbox&&(checkBoxState=state.find(function(i){return+i.level==+control.level}))&&(self.__changedCity&&4===control.level||self.__changedHouse&&11===control.level||self.__changedFlat&&(14===control.level||11===control.level)?control.checkbox.checked():(isCheckedCheckbox=!!checkBoxState.checked,control.checkbox.checked(isCheckedCheckbox),item[k+"Disabled"]=isCheckedCheckbox?"yes":"no")));self.__changedCity=!1,self.__changedHouse=!1,self.__changedFlat=!1},checkCheckBoxState:function(state){var changedFrom1To5,changed7or11or14,result,checkBoxLevels=["4","11","14"],changedLevels=state.changedLevels&&state.changedLevels.length?state.changedLevels:[];return""===state.value?result=checkBoxLevels.map(function(item){return{level:item,checked:!1}}):state.fiasFieldsShow?(checkBoxLevels.map(function(item){return{level:item,visible:!0}}),result):(changedLevels.length&&(changedFrom1To5=changedLevels.filter(function(i){var iToNumber=+i;return iToNumber>=1&&iToNumber<=5}),changedFrom1To5.length?result=checkBoxLevels.map(function(i){return{level:i,checked:!1}}):(changed7or11or14=changedLevels.filter(function(i){var iToNumber=+i;return 7===iToNumber||11===iToNumber||14===iToNumber}),changed7or11or14.length&&(result=[],checkBoxLevels.forEach(function(i){+i>=+changed7or11or14[0]&&result.push({level:i,checked:!1})})))),result)}}}]),angular.module("serverForm.services").factory("pguSelectService",["apiInner","$rootScope","$compile","$routeParams","$http","CONFIG","$q","sharedExtServices","api","HealthSrv",function(apiInner,$rootScope,$compile,$routeParams,$http,CONFIG,$q,sharedExtServices,api,HealthSrv){function successLDFS(data,success,withoutCache,options){data&&data.items&&data.items.length?(cache.opt=options,cache.data=data,success(data,withoutCache)):success({error:{code:"searchIsEmpty"},original:data},withoutCache)}function errorLDFS(error,success){var errorCode,status=error&&error.status,code=error&&error.code;errorCode=status||(code||"Request failed"),success({code:errorCode,error:!0})}function mapSopAnswer(resp,options){var items=[],error={code:0};if(resp&&resp.data&&resp.data.length){var firstItem=resp.data[0];firstItem&&firstItem.hasOwnProperty(options.valueKey)&&firstItem.hasOwnProperty(options.titleKey)?items=resp.data.map(function(item){var attrsValues={},attrs=[];return options.otherColumns&&options.otherColumns.forEach(function(column){attrsValues[column]=item[column],attrs.push({name:column,value:item[column]})}),{value:item[options.valueKey],parentValue:null,title:item[options.titleKey],isLeaf:!0,children:[],attributes:attrs,attributeValues:attrsValues}}):error.code=3}else resp.sourceUid||(error.code=3);var result={error:error,items:items||[],healthData:{errors:resp.errors,items:items}},limit=options.request.limit;return resp.lastPage?result.total=1===limit.pageNumber?items.length:limit.pageSize*limit.pageNumber:result.total=limit.pageSize*limit.pageNumber+1,result}var cache={};return{loadDataFromServer:function(opts,success,withoutCache,isFilterPrepared){if(opts.isSop){var startTime=(new Date).getTime();sharedExtServices.sopService.loadList(opts.request,function(data){var result=mapSopAnswer(data,opts);0===result.error.code?(successLDFS(result,success,withoutCache,{}),HealthSrv.checkHealthWhenDone({type:"dictionary_cps",refName:opts.request.sourceUid,startTime:startTime},result.healthData)):(errorLDFS(result,success),HealthSrv.checkHealthWhenDone({type:"dictionary_cps",refName:opts.request.sourceUid,startTime:startTime},result.healthData))},function(error){errorLDFS(error,success),HealthSrv.checkHealthWhenDone({type:"dictionary_cps",refName:opts.request.sourceUid,
startTime:startTime},error)},withoutCache)}else{var bookingFilters,options={refName:opts.refName,treeFiltering:opts.treeFiltering||"ONELEVEL",pageNum:opts.pageNum||1,pageSize:opts.pageSize&&"0"!==opts.pageSize?opts.pageSize:"258",filter:this.buildFilter(opts,!1,isFilterPrepared),parentRefItemValue:opts.parentRefItemValue||"",selectAttributes:opts.selectAttributes||["*"],tx:$rootScope.env.systemData.transactionCode};if(opts.item.withFilterCodes&&(bookingFilters=api.env("bookingFilters"))&&bookingFilters.filterCodes&&bookingFilters.filterCodes.length&&(options.filterCodes=bookingFilters.filterCodes),!withoutCache&&cache.opt&&cache.data&&angular.equals(cache.opt,options))return void success(cache.data);opts.orderBy&&(options.orderBy=opts.orderBy),opts.type&&(options.type=opts.type),sharedExtServices.listRefItems.loadList(options,function(data){successLDFS(data,success,withoutCache,options)},function(error){errorLDFS(error,success)},withoutCache)}},loadOkatoFromServer:function(opts,success,error){sharedExtServices.listRefItems.loadHierarchyList(opts,success,error)},getGeoCodeFromServer:function(opts,success,error){sharedExtServices.listRefItems.loadHierarchyList(opts,success,error)},makeBinding:function(responseBindings,list,value){for(var i=0;i<responseBindings.length;i++)for(var v=responseBindings[i],j=0;j<list.length;j++)if(list[j].value==value){var valueToBind=list[j].attributeValues[v.name||v.column];void 0===valueToBind&&(valueToBind=list[j][v.name]),null===valueToBind&&(valueToBind=""),api.find(v.value||v.field)&&!apiInner.isEmptyObject(api.find(v.value||v.field))&&api.find(v.value||v.field).attr(v.attr,valueToBind);break}},buildFilter:function(opts,skipBinding,isFilterPrepared){function getAsString(binding,previousSearchQuery){var el=api.find(binding.value);return el&&!apiInner.isEmptyObject(el)?el.getElement()[binding.attr]:"title"==binding.name&&previousSearchQuery?"":binding.value}function createSubSelectValue(binding){var ssd=binding.subSelectData||binding;if(ssd){var subs=ssd.requestAttrs.map(function(attr){var tmp={simple:{attributeName:attr.attrName,condition:attr.condition&&attr.condition.toUpperCase(),value:{}}},fakeObj={value:attr.attrValue,attr:attr.attrOfAttr};return tmp.simple.value[attr.attrType]=getAsString(fakeObj),tmp});return{refName:ssd.dictionaryMnemonic,selectAttributes:[ssd.selectedAttributes],filter:{union:{unionKind:"AND",subs:subs}}}}}var requestBinding=JSON.parse(JSON.stringify((opts.dictionary||opts.item.dictionary||{}).requestBinding||[]));if(skipBinding&&(requestBinding=[]),isFilterPrepared)return opts.filter;if(opts.filter){var filter_found=!1;angular.forEach(requestBinding,function(binding,i){"title"==binding.name&&(binding.value=opts.filter,filter_found=!0)}),!filter_found&&opts.item.searchBar&&requestBinding.push({name:"title",value:opts.filter})}if(requestBinding.length){var isComplexRequest=(opts.dictionary||opts.item.dictionary).__complexData,previousSearchQuery=!1,parts=$.map(requestBinding,function(binding){opts.filter||"title"!==binding.name||(binding.value!==opts.item.query_prev||opts.list.length)&&opts.item.query_prev||(previousSearchQuery=!0);var value=getAsString(binding,previousSearchQuery);if(binding.notInclude&&!value)return[];var obj={};return isComplexRequest?(obj={simple:{}},"in"===binding.condition||binding.isExists?("in"===binding.condition?(obj.simple.attributeName=binding.name,obj.simple.condition=binding.condition):obj.simple.condition="exists",binding.not&&(obj.simple.not=!0),obj.simple.subSelectValue=createSubSelectValue(binding)):(obj.simple.attributeName=binding.name,obj.simple.condition=binding.condition,obj.simple.value={},obj.simple.value[binding.attrType]=value),"address"===binding.condition&&(obj.simple.mandatory=binding.mandatory),obj.simple.condition=obj.simple.condition.toUpperCase()):obj={simple:{attributeName:binding.name,condition:"title"==binding.name?"CONTAINS":"EQUALS",value:{asString:value}}},obj});1==parts.length?opts.filter=parts[0]:parts.length>1&&(opts.filter={union:{unionKind:"AND",subs:parts}})}return opts.filter},removeOpts:function(items,optStr){if(!optStr)return items;var opts=optStr.toString().split(",");if(!opts.length)return items;for(var res=[],j=0;j<items.length;j++){for(var del=!1,i=0;i<opts.length;i++)if(items[j].value==opts[i]){del=!0;break}del||res.push(items[j])}return res},mappingHierarchy:function(data){for(var item,itemObj,str,concatedPath,self=this,result=[],i=0,il=data.length;i<il;i++)item=data[i],str="",itemObj={code:"",title:"",path:""},item.itemName&&item.code&&(itemObj.code=item.code,itemObj.title=item.itemName,itemObj.path=item.fullPath),itemObj.title&&(concatedPath=self.createTitleFromHierarchy(itemObj.path),str=itemObj.title+(concatedPath?" "+concatedPath:concatedPath)),result.push({title:str,value:itemObj.code,shortTitle:str,path:concatedPath});return result.sort(function(a,b){var aL=""!=a.path?a.path.split(" / ").length:0,bL=""!=b.path?b.path.split(" / ").length:0;return aL>bL?1:aL<bL?-1:aL==bL?0:void 0}),result},createTitleFromHierarchy:function(titles){var title="",result="";return title=titles.split("@").slice(1).reverse().join(" / "),title&&(result="("+title+")"),result},buildRequestOpts:function(item,model,isSearch){var options,dict=item.dictionary;if(dict.isSop){if(options={isSop:!0,titleKey:dict.titleDesc.key,valueKey:dict.valueDesc.key,request:{inversion:dict.inversion,levenshtein:2,limit:{pageNumber:model.pageNum,pageSize:+model.pageSize},projection:{columnUids:[dict.titleDesc.uid,dict.valueDesc.uid],mode:"INCLUDE"},sourceUid:dict.sourceUid}},item.filter&&(options.request.filter={query:{columnUids:[dict.titleDesc.uid],query:item.filter}}),dict.sort&&dict.sort.uid&&(options.request.sort={columnUid:dict.sort.uid,sortType:dict.sort.direction}),dict.responseBindings&&dict.responseBindings.length){options.otherColumns=[];var columnUids=options.request.projection.columnUids;dict.responseBindings.forEach(function(binding){columnUids.includes(binding.uuid)||columnUids.push(binding.uuid),options.otherColumns.includes(binding.column)||options.otherColumns.push(binding.column)})}this.buildSopFilter(dict,options.request,item.isHierarchic||item.isHierarchicMultiple,item.parentRefItemValue||item.parentItem)}else options={refName:dict.code,pageSize:model.pageSize,item:item,parentRefItemValue:item.parentRefItemValue||item.parentItem},isSearch?(options.list=item.list,options.filter=item.filter):(options.pageNum=model.pageNum,item.filter&&(options.filter=item.filter),item.orderBy&&(options.orderBy=[{attributeName:item.orderBy,sortDirection:item.sortDirection}]));return options},buildSopFilter:function(dict,request,isHierarchic,parentItemValue){var rb=dict.requestBinding;if(rb&&rb.length){var filters=[];rb.forEach(function(binding){var value=api.find(binding.value).attr(binding.attr);(!binding.notInclude||binding.notInclude&&value)&&(filters.push({columnUid:binding.uuid,value:value.toString()}),request.projection.columnUids.includes(binding.uuid)||request.projection.columnUids.push(binding.uuid))}),request.filter?filters.length&&(request.filter.filters=filters.concat()):filters.length&&(request.filter={},request.filter.filters=filters.concat())}isHierarchic&&(request.filter||(request.filter={}),request.filter.filters||(request.filter.filters=[]),request.filter.filters.push({columnUid:dict.sourceUidParent,value:(parentItemValue||"").toString()}))}}}]),angular.module("serverForm.services").factory("pguEqueueService",["apiInner","$rootScope","$compile","$routeParams","$http","CONFIG","$q","sharedExtServices","api",function(apiInner,$rootScope,$compile,$routeParams,$http,CONFIG,$q,sharedExtServices,api){return{getAggSlots:function(opts,success,error){"true"===$rootScope.env.formParam.mfcBook&&(opts.mfcBook=!0),sharedExtServices.equeueService.getAggSlots(opts,success,error)},aggBook:function(opts,success,error){"true"===$rootScope.env.formParam.mfcBook&&(opts.mfcBook=!0),sharedExtServices.equeueService.aggBook(opts,success,error)},cancelBooking:function(opts,success,error){sharedExtServices.equeueService.cancelBooking(opts,success,error)},buildParams:function(params,arrayParams){var obj={};return params.forEach(function(param){arrayParams.indexOf(param.name)>-1?(obj[param.name]||(obj[param.name]=[]),obj[param.name].push(api.find(param.field).attr(param.attr)||"")):obj[param.name]=api.find(param.field).attr(param.attr)||""}),obj},buildParamsAggSlot:function(params){var arrayParams=["serviceId","organizationId","areaId"];return this.buildParams(params,arrayParams)},buildParamsAggBook:function(params){var arrayParams=["serviceId","areaId"];return this.buildParams(params,arrayParams)},buildAttributes:function(attrs){return attrs.map(function(param){return{name:param.name,value:api.find(param.field).attr(param.attr)||""}})},getConditionForFilter:function(binding){var result="EQUALS";return"title"===binding.name?result="CONTAINS":"DATE"===binding.name&&(binding.startDate?result="GREATER_THAN_OR_EQUALS":binding.endDate&&(result="LESS_THAN_OR_EQUALS")),result},buildParamsWithFilters:function(bookingFilters,organizationId,requestBinding){var organization,result,self=this,requestBindingTemp=requestBinding.slice();return bookingFilters?(organizationId&&bookingFilters.organizations&&(organization=bookingFilters.organizations.find(function(item){return item.orgId===organizationId}))&&organization.areas&&organization.areas.length&&(result={},result.areaId=organization.areas),bookingFilters.startDate&&requestBindingTemp.push({name:"DATE",startDate:!0,value:moment(bookingFilters.startDate).format("YYYY-MM-DD")}),bookingFilters.endDate&&requestBindingTemp.push({name:"DATE",endDate:!0,value:moment(bookingFilters.endDate).format("YYYY-MM-DD")}),requestBindingTemp.length&&(result=result||{},result.filter=self.buildFilterWithDateAggSlot(requestBindingTemp))):requestBindingTemp.length&&(result=result||{},result.filter=self.buildFilterWithDateAggSlot(requestBindingTemp)),result},buildFilterWithDateAggSlot:function(requestBinding,skipBinding,isFilterPrepared){if(skipBinding&&(requestBinding=[]),isFilterPrepared)return opts.filter;var opts={},self=this;if(requestBinding.length){var previousSearchQuery=!1,parts=requestBinding.map(function(binding){opts.filter||"title"!==binding.name||(binding.value!==opts.item.query_prev||opts.list.length)&&opts.item.query_prev||(previousSearchQuery=!0);var value=self.getAsString(binding,previousSearchQuery);return binding.notInclude&&!value?[]:{simple:{attributeName:binding.name,condition:self.getConditionForFilter(binding),value:value,checkAllValues:!0}}});1==parts.length?opts.filter=parts[0]:parts.length>1&&(opts.filter={union:{unionKind:"AND",subs:parts}})}return opts.filter},getAsString:function(binding,previousSearchQuery){var value=binding.field?binding.field:binding.value;if("AppointmentDate"==binding.name)return value+"T00:00:00";if("AppointmentDateTo"==binding.name)return value+"T23:59:59";if("DATE"===binding.name)return value;var el=api.find(value);return el&&!apiInner.isEmptyObject(el)?el.getElement()[binding.attr]:"title"==binding.name&&previousSearchQuery?"":value},mapResponseBinding:function(binding,hashMap){var responseBindings=binding||[];responseBindings.length&&responseBindings.forEach(function(item,ind){var valueToBind=hashMap[item.name]||hashMap.attributes&&hashMap.attributes.length&&hashMap.attributes.find(function(attr){return attr.name===item.name}).value;null!==valueToBind&&void 0!==valueToBind||(valueToBind=""),api.find(item.field).attr(item.attr,valueToBind.toString())})},parseISODateFormat:function(str){return/^(\d{4}|[+\-]\d{6})(?:-(\d{2})(?:-(\d{2}))?)?(?:T(\d{2}):(\d{2})(?::(\d{2})(?:\.(\d{3}))?)?(?:(Z)|([+\-])(\d{2})(?::(\d{2}))?)?)?$/.exec(str)},createDataFromSlots:function(fullPath,arr,utcTime,todayMidnight,isEnabledDuration,isFilterByHall){for(var year,month,day,visitTimeStr,item,dateFromISO,self=this,fullName=fullPath,indexDay=[],indexMonth=[],listIndexDay=[],hashKeyMonth="",indexDayToString="",dataObj={months:[],listDay:[]},uniqueValues={},durationHours="",durationMinutes="",durationInMinutes="",hallsFromSlots={},i=0,il=arr.length;i<il;i++)item=arr[i],visitTimeStr=item.visitTimeStr,dateFromISO=this.parseISODateFormat(visitTimeStr),uniqueValues[visitTimeStr]||(isFilterByHall||(uniqueValues[visitTimeStr]=!0),hallsFromSlots[item.areaId]||(hallsFromSlots[item.areaId]={title:"",value:item.areaId}),visitTimeStr>=utcTime&&visitTimeStr<=todayMidnight&&(arr[i].slotOnToday=!0),dateFromISO&&dateFromISO.length&&!item.isToday?(year=item.year=dateFromISO[1],month=item.month=dateFromISO[2],day=item.day=dateFromISO[3],item.hours=+dateFromISO[4],item.minutes=+dateFromISO[5],isEnabledDuration&&item.duration?(durationInMinutes=60*item.hours+item.minutes+item.duration,durationMinutes=durationInMinutes%60,durationHours=(durationInMinutes-durationMinutes)/60,item.visitTimeFromIso="c "+dateFromISO[4]+":"+dateFromISO[5]+" по "+self.leadingZero(durationHours)+":"+self.leadingZero(durationMinutes),item.slotViewWithInterVal=!0):item.visitTimeFromIso=dateFromISO[4]+":"+dateFromISO[5]):(year=item.year,month=item.month,day=item.day),hashKeyMonth=year+month,indexDayToString=hashKeyMonth+day,indexMonth.indexOf(hashKeyMonth)<0&&(dataObj.months.push({month:month,year:year,days:[],hashKeyMonth:year+month,title:this.getMonthInText(year,month),needGenerateFullMonth:!0,needGeneratePreviousDays:!0,needGenerateWeekDays:!1}),indexMonth.push(hashKeyMonth),indexDay.splice(0,indexDay.length)),-1===indexDay.indexOf(indexDayToString)&&(indexDay.push(indexDayToString),""!==indexDayToString&&listIndexDay.push(indexDayToString),dataObj.months[indexMonth.indexOf(hashKeyMonth)].days[indexDay.indexOf(indexDayToString)]={date:new Date(year,month-1,day,0,0,0),year:year,month:month,day:+day,fullName:fullName,slots:[],isToday:""===indexDayToString,slotOnToday:item.slotOnToday},dataObj.listDay[listIndexDay.indexOf(indexDayToString)]={date:new Date(year,month-1,day,0,0,0),year:year,month:month,day:+day,slots:[],even:(listIndexDay.indexOf(indexDayToString)+1)%2==0,fullName:fullName,dayId:fullName+":"+new Date(year,month-1,day,0,0,0).getTime(),title:this.getDayOfWeek(new Date(year,month-1,day),year,month,+day)}),item.fullName=fullName,""!==indexDayToString&&(dataObj.months[indexMonth.indexOf(hashKeyMonth)].days[indexDay.indexOf(indexDayToString)].slots.push(item),dataObj.listDay[listIndexDay.indexOf(indexDayToString)].slots.push(item)));return dataObj.hallsFromSlots=hallsFromSlots,dataObj},generateMonthStructure:function(data){var date,month,firstDay,lastDay,self=this,result={weeks:[{days:[]}]},distance=0,weekIndex=0,lastIndex=data.days.length-1,days=data.days.concat();return data.days.forEach(function(item,ind){date=item.date,month=item.month-1,0===ind&&(firstDay=new Date(item.year,month,1,0,0,0),weekIndex=self.generateDays(result.weeks,weekIndex,item.year,month,0,self.getDay(firstDay),!0),weekIndex=self.generateDays(result.weeks,weekIndex,item.year,month,firstDay.getDate(),item.day)),result.weeks[weekIndex].days.push(item),ind<lastIndex?distance=(days[ind+1].date-item.date)/864e5:ind===lastIndex&&(lastDay=self.getLastDayOfMonth(item.year,month),distance=item.day!==lastDay&&data.needGenerateFullMonth?lastDay-item.day+1:0),distance>1?self.getDay(date)%7==6?(weekIndex++,result.weeks[weekIndex]={days:[]},self.generateDays(result.weeks,weekIndex,item.year,month,item.day+1,item.day+distance)):weekIndex=self.generateDays(result.weeks,weekIndex,item.year,month,item.day+1,item.day+distance):(self.getDay(date)%7==6&&(weekIndex++,result.weeks[weekIndex]={days:[]}),ind===lastIndex&&0!==self.getDay(date)&&(weekIndex=self.generateDays(result.weeks,weekIndex,item.year,month,self.getDay(new Date(item.year,month,item.day+1)),7,!0)))}),result.weeks.forEach(function(item,ind){for(var previousRowDays,days=item.days,i=1,il=days.length;i<il;i++){var previousItem=days[i-1];days[i].slots&&!days[i].slots.length&&previousItem.slots&&!previousItem.slots.length&&(previousItem.rightBorderWhite=!0)}if(ind>0){previousRowDays=result.weeks[ind-1].days;for(var iCell=0,iCellL=days.length;iCell<iCellL;iCell++)days[iCell].slots&&!days[iCell].slots.length&&previousRowDays[iCell]&&previousRowDays[iCell].slots&&!previousRowDays[iCell].slots.length&&(previousRowDays[iCell].bottomBorderWhite=!0)}}),result},generateDays:function(weeks,weekIndex,year,month,start,end,emptyDay){var date,self=this;if(emptyDay)for(;start<end;start++)weeks[weekIndex].days.push({day:""});else for(;start<end;start++)if(start<1)weeks[weekIndex].days.push({day:""});else if(date=new Date(year,month,start,0,0,0),weeks[weekIndex].days.push({date:date,year:year,month:month,day:start,slots:[]}),self.getDay(date)%7==6&&(weekIndex++,weeks[weekIndex]={days:[]}),date.getDate()===self.getLastDayOfMonth(year,month))for(var k=self.getDay(date)+1;k<7;k++)weeks[weekIndex].days.push({day:""});return weekIndex},getDay:function(date){var day=date.getDay();return 0===day&&(day=7),day-1},getLastDayOfMonth:function(year,month){return new Date(year,month+1,0).getDate()},getMonthInText:function(year,month){return["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"][month-1]+" "+year},getDayOfWeek:function(date,year,month,day){if(date){return day+"&nbsp;"+["января","февраля","марта","апреля","мая","июня","июля","августа","сентября","октября","ноября","декабря"][month-1]+"&nbsp;"+year+", "+["воскресенье","понедельник","вторник","среда","четверг","пятница","суббота"][date.getDay()]}},setIntervalsBindings:function(listDay,intervalBinding){for(var iFrom,iTo,visitTime,self=this,i=0;i<listDay.length;i++){var slotObj={};slotObj.slotId=[],listDay[i].intervalSlots=[];for(var bi=0,bil=listDay[i].slots.length;bi<bil;bi++){var slot=listDay[i].slots[bi];visitTime=60*slot.hours+slot.minutes,(iFrom||iTo)&&0!=bi||(visitTime=60*slot.hours+(slot.minutes-slot.minutes%intervalBinding),iFrom=visitTime,iTo=iFrom+parseInt(intervalBinding,10)),visitTime>=iTo&&(slotObj.slotId&&slotObj.slotId.length&&listDay[i].intervalSlots.push(slotObj),slotObj={},slotObj.slotId=[],iFrom=visitTime>iTo?60*slot.hours+(slot.minutes-slot.minutes%intervalBinding):iTo,iTo=iFrom+parseInt(intervalBinding,10)),iFrom<=visitTime&&visitTime<iTo&&(slotObj.slotId.push(slot.slotId),slotObj.hours=slot.hours,slotObj.minutes=slot.minutes,slotObj.fullName=slot.fullName,slotObj.year=slot.year,slotObj.month=slot.month,slotObj.day=slot.day,slotObj.visitTimeFromIso="c "+self.leadingZero(Math.floor(iFrom/60))+":"+self.leadingZero(iFrom%60)+" по "+self.leadingZero(Math.floor(iTo/60))+":"+self.leadingZero(iTo%60)),bi===bil-1&&listDay[i].intervalSlots[listDay[i].intervalSlots.length-1].slotId.indexOf(slot.slotId)<0&&slotObj.slotId&&slotObj.slotId.length&&listDay[i].intervalSlots.push(slotObj)}listDay[i].slots=listDay[i].intervalSlots}return listDay},leadingZero:function(num){return num<10?"0"+num:num},mapTimeToStr:function(time){if(!time)return"00:00";var hours=Math.floor(time/60),minutes=time%60;return(hours?hours+" ч.":"")+(minutes?" "+minutes+" мин.":"")},checkInvitation:function(fullPath){var df=$q.defer(),callback={done:function(data){data&&data.error&&0===data.error.code&&data.context&&data.context.invitation?df.resolve(data.context):df.resolve({error:!0})},error:function(err){df.resolve({error:!0})}};return api.find(fullPath).submit("submit",0,callback,{},!0),df.promise},findParamByName:function(params,paramName){return params.forEach(function(param){if(param.name==paramName)return api.find(param.field).attr(param.attr)}),""}}}]),angular.module("serverForm.services").factory("pguEsiaData",["$rootScope","$q","sharedExtServices","PGU","ESIA_SAVE",function($rootScope,$q,sharedExtServices,PGU,ESIA_SAVE){return{formatData:function(val){return val?val.length?val[0]:val.isArray?"":val:{}},formatAddress:function(address){return(address.zipCode?address.zipCode+", ":"")+address.addressStr},funnyObj:function(){var obj={};return Object.defineProperty(obj,"length",{get:function(){return Object.keys(this).length}}),obj},getEsiaData:function(){return $q.when($rootScope.settings.esia&&!_.isEmpty($rootScope.settings.esia)?$rootScope.settings.esia:sharedExtServices.dataEsia.get())},getFilteredData:function(){var self=this;return this.getEsiaData().then(function(data){var userDataEsia=$rootScope.settings.esia&&$rootScope.settings.esia.person;userDataEsia&&!userDataEsia.person&&(userDataEsia=$rootScope.settings.esia),_.isEmpty(self.filterData)&&(self.filterData={inn:userDataEsia.person&&userDataEsia.person.inn,birthplace:userDataEsia.person&&userDataEsia.person.birthPlace,address_reg_kladr:userDataEsia.addresses&&self.formatAddress(self.formatData(userDataEsia.addresses.find(function(val){return"PRG"==val.type}))),address_reg_fias:userDataEsia.addresses&&self.formatAddress(self.formatData(userDataEsia.addresses.find(function(val){return"PRG"==val.type}))),address_live_kladr:userDataEsia.addresses&&self.formatAddress(self.formatData(userDataEsia.addresses.find(function(val){return"PLV"==val.type}))),address_live_fias:userDataEsia.addresses&&self.formatAddress(self.formatData(userDataEsia.addresses.find(function(val){return"PLV"==val.type}))),foreignpassport:{foreignpassport_lastname:userDataEsia.docs&&self.formatData(userDataEsia.docs.find(function(val){return"FRGN_PASS"==val.type})).lastName,foreignpassport_firstname:userDataEsia.docs&&self.formatData(userDataEsia.docs.find(function(val){return"FRGN_PASS"==val.type})).firstName,foreignpassport_series:userDataEsia.docs&&self.formatData(userDataEsia.docs.find(function(val){return"FRGN_PASS"==val.type})).series,foreignpassport_number:userDataEsia.docs&&self.formatData(userDataEsia.docs.find(function(val){return"FRGN_PASS"==val.type})).number,foreignpassport_issuedate:userDataEsia.docs&&self.formatData(userDataEsia.docs.find(function(val){return"FRGN_PASS"==val.type})).issueDate,foreignpassport_validdate:userDataEsia.docs&&self.formatData(userDataEsia.docs.find(function(val){return"FRGN_PASS"==val.type})).expiryDate,foreignpassport_issueorg:userDataEsia.docs&&self.formatData(userDataEsia.docs.find(function(val){return"FRGN_PASS"==val.type})).issuedBy},birthcert:{birthcert_series:userDataEsia.docs&&self.formatData(userDataEsia.docs.find(function(val){return"BRTH_CERT"==val.type})).series,birthcert_issuedate:userDataEsia.docs&&self.formatData(userDataEsia.docs.find(function(val){return"BRTH_CERT"==val.type})).issueDate,birthcert_number:userDataEsia.docs&&self.formatData(userDataEsia.docs.find(function(val){return"BRTH_CERT"==val.type})).number,birthcert_issueorg:userDataEsia.docs&&self.formatData(userDataEsia.docs.find(function(val){return"BRTH_CERT"==val.type})).issuedBy},militarydoc:{militarydoc_series:userDataEsia.docs&&self.formatData(userDataEsia.docs.find(function(val){return"MLTR_ID"==val.type})).series,militarydoc_issuedate:userDataEsia.docs&&self.formatData(userDataEsia.docs.find(function(val){return"MLTR_ID"==val.type})).issueDate,militarydoc_number:userDataEsia.docs&&self.formatData(userDataEsia.docs.find(function(val){return"MLTR_ID"==val.type})).number,militarydoc_issueorg:userDataEsia.docs&&self.formatData(userDataEsia.docs.find(function(val){return"MLTR_ID"==val.type})).issuedBy},medicalpolicy:{medicalpolicy_number:userDataEsia.docs&&self.formatData(userDataEsia.docs.find(function(val){return"MDCL_PLCY"==val.type})).number,medicalpolicy_validdate:userDataEsia.docs&&self.formatData(userDataEsia.docs.find(function(val){return"MDCL_PLCY"==val.type})).expiryDate},vehicle:{vehicle_name:userDataEsia.vehicles&&userDataEsia.vehicles[0]&&userDataEsia.vehicles[0].name,vehicle_number:userDataEsia.vehicles&&userDataEsia.vehicles[0]&&userDataEsia.vehicles[0].numberPlate,vehicle_certificateseries:userDataEsia.vehicles&&userDataEsia.vehicles[0]&&userDataEsia.vehicles[0].regCertificate.series,vehicle_certificatenumber:userDataEsia.vehicles&&userDataEsia.vehicles[0]&&userDataEsia.vehicles[0].regCertificate.number},driverlicense:{driverlicense_series:userDataEsia.docs&&self.formatData(userDataEsia.docs.find(function(val){return"RF_DRIVING_LICENSE"==val.type})).series,driverlicense_issuedate:userDataEsia.docs&&self.formatData(userDataEsia.docs.find(function(val){return"RF_DRIVING_LICENSE"==val.type})).issueDate,driverlicense_number:userDataEsia.docs&&self.formatData(userDataEsia.docs.find(function(val){return"RF_DRIVING_LICENSE"==val.type})).number,driverlicense_validtill:userDataEsia.docs&&self.formatData(userDataEsia.docs.find(function(val){return"RF_DRIVING_LICENSE"==val.type})).expiryDate}})},function(error){self.filterData={}})},checkStrategyItem:function(item,cloneIndex){var filterData=this.filterData;PGU.EsiaStrategyField=PGU.EsiaStrategyField||this.funnyObj(),PGU.EsiaSuggestField=PGU.EsiaSuggestField||this.funnyObj(),PGU.EsiaGroupStartegyField=PGU.EsiaGroupStartegyField||this.funnyObj();var st=item.strategy||"",sg=item.mnemonicAutofill||"";if(~ESIA_SAVE.startegy.indexOf(st)&&(PGU.EsiaStrategyField[st]=PGU.EsiaStrategyField[st]||this.funnyObj(),PGU.EsiaStrategyField[st][item.fullPath]={item:item,initState:filterData[st]||""}),~ESIA_SAVE.suggest.indexOf(sg.split(".")[0])){var sgg=sg.split(".")[0];cloneIndex&&+cloneIndex&&(sgg+="["+cloneIndex+"]"),PGU.EsiaSuggestField[sgg]=PGU.EsiaSuggestField[sgg]||this.funnyObj(),PGU.EsiaSuggestField[sgg][sg]=PGU.EsiaSuggestField[sgg][sg]||this.funnyObj(),PGU.EsiaSuggestField[sgg][sg][item.fullPath]=PGU.EsiaSuggestField[sgg][sg][item.fullPath]||{item:item,initState:""}}if(st.indexOf("driverlicense")||(st="driverlicense_"+st.split("driverlicense")[1]),st.indexOf("vehicle")||(st="vehicle_"+st.split("vehicle")[1]),~ESIA_SAVE.groupStartegy.indexOf(st.split("_")[0])){var gst=st.split("_")[0];PGU.EsiaGroupStartegyField[gst]=PGU.EsiaGroupStartegyField[gst]||this.funnyObj(),PGU.EsiaGroupStartegyField[gst][st]=PGU.EsiaGroupStartegyField[gst][st]||this.funnyObj(),PGU.EsiaGroupStartegyField[gst][st][item.fullPath]={item:item,initState:filterData[gst][st]||""}}}}}]),angular.module("serverForm.services").factory("checkValidator",function(){return{valid:function(regexp,check){return new RegExp(regexp,"g").test(check)}}}).factory("geoCoder",function(){return{set:function(addr,val){this.model=this.model||{},this.model[addr]=val},get:function(addr){return addr&&this.model?this.model[addr]:this.model}}}).factory("declineOfUnit",function(){return{get:function(number,titles){return titles[number%10==1&&number%100!=11?0:number%10>=2&&number%10<=4&&(number%100<10||number%100>=20)?1:2]}}}).factory("RecursionHelper",["$compile",function($compile){return{compile:function(element,link){angular.isFunction(link)&&(link={post:link});var compiledContents,contents=element.contents().remove();return{pre:link&&link.pre?link.pre:null,post:function(scope,element){compiledContents||(compiledContents=$compile(contents)),compiledContents(scope,function(clone){element.append(clone)}),link&&link.post&&link.post.apply(null,arguments)}}}}}]),angular.module("serverForm.services").factory("ELEMS_EXTENTIONS",["$rootScope","CLASSES","FormExt","PanelExt","NalogListExt","DataGridExt","FieldDropdownHierarchicMultipleExt","FieldTextExt","FieldTextDateExt","FieldTextAreaExt","FieldRadioExt","FieldCheckboxExt","FieldDropdownExt","FieldDropdownHierarchicExt","FieldDropdownMultipleExt","FieldYearExt","FieldMonthExtExt","DropdownSearchForChildExt","LabelExt","FormButtonExt","FieldMapExt","FieldMapWithListExt","FieldMapWithListDCExt","PanelWorkActivityExt","FieldUploadExt","FiasExt","ImageEditorExt","KladrExt","TableExt","HelperBoxExt","TimeSlotExtExt","FormStepExt","FieldInnExt","AutomotiveAxlesExt","FieldDrivingLicenseExt","FieldAddressOfResidenceExt","FieldRegistrationAddressExt","FieldVehicleExt","InitialImpactExt","FieldBirthCountryExt","NavPanelExt","KladrDropdownExt","FiasDaDataExt","InformerNotifyExt","InformersExt","TableDictionaryExt","PaymentExt","AdviceExt","InvitationPanelExt","InvitationPanelEuroprotocolExt","EditableDataGridExt","ConfirmPanelExt","SMSConfirmDialogExt","ClinicExamExt","ElectronMedicalDocsExt","OrderListDCExt","PersonalDataExt","PersonalDataAutoExt","ContactsExt","ContactsAutoExt","PassportDataExt","PassportDataAutoExt","LegalBusinessmanDataExt","AdditionalDocumentsExt","AdditionalDocumentsAutoExt","MedicalPolicyExt","KidDataExt","VehicleDataExt","DelegateDataExt","PersonAddressesDataExt","FieldMapWithListFrguExt","CaptchaExt","DelegateDataSubItemExt","UploadFileFromDigitalProfileExt","ListKidsExt","ListReferralExt","ListSpecialistsExt","FieldUploadFileSignExt","MfcDeliveryExt","PreviewGEPSMailExt",function($rootScope,CLASSES,FormExt,PanelExt,NalogListExt,DataGridExt,FieldDropdownHierarchicMultipleExt,FieldTextExt,FieldTextDateExt,FieldTextAreaExt,FieldRadioExt,FieldCheckboxExt,FieldDropdownExt,FieldDropdownHierarchicExt,FieldDropdownMultipleExt,FieldYearExt,FieldMonthExtExt,DropdownSearchForChildExt,LabelExt,FormButtonExt,FieldMapExt,FieldMapWithListExt,FieldMapWithListDCExt,PanelWorkActivityExt,FieldUploadExt,FiasExt,ImageEditorExt,KladrExt,TableExt,HelperBoxExt,TimeSlotExtExt,FormStepExt,FieldInnExt,AutomotiveAxlesExt,FieldDrivingLicenseExt,FieldAddressOfResidenceExt,FieldRegistrationAddressExt,FieldVehicleExt,InitialImpactExt,FieldBirthCountryExt,NavPanelExt,KladrDropdownExt,FiasDaDataExt,InformerNotifyExt,InformersExt,TableDictionaryExt,PaymentExt,AdviceExt,InvitationPanelExt,InvitationPanelEuroprotocolExt,EditableDataGridExt,ConfirmPanelExt,SMSConfirmDialogExt,ClinicExamExt,ElectronMedicalDocsExt,OrderListDCExt,PersonalDataExt,PersonalDataAutoExt,ContactsExt,ContactsAutoExt,PassportDataExt,PassportDataAutoExt,LegalBusinessmanDataExt,AdditionalDocumentsExt,AdditionalDocumentsAutoExt,MedicalPolicyExt,KidDataExt,VehicleDataExt,DelegateDataExt,PersonAddressesDataExt,FieldMapWithListFrguExt,CaptchaExt,DelegateDataSubItemExt,UploadFileFromDigitalProfileExt,ListKidsExt,ListReferralExt,ListSpecialistsExt,FieldUploadFileSignExt,MfcDeliveryExt,PreviewGEPSMailExt){return{initAttrs:function(elem){var item=elem.element,className=item.className;if(this[item.className]){switch(className){case"Kladr":case"Fias":className="FiasDaData"}for(var i in this[className])this[className].hasOwnProperty(i)&&("function"==typeof this[className][i]&&(elem[i]=this[className][i]),"Fias"===item.className&&"attrs"===i&&this[className][i].allowOptionalBuilding1&&(this[className][i].allowOptionalBuilding1.default=!0),elem.element[i]=this[className][i]);$rootScope.isDesigner||elem.fillItems&&(elem.element.items&&elem.element.items.length&&"PanelWorkActivity"!=className||(elem.element.items=[elem.fillItems(elem.element)])),this.attachPropertiesToModel(elem)}},attachPropertiesToModel:function(elem){var model=elem.element;if(model.classNameRu=CLASSES[model.className],model.originalName=model.name,model.originalFullPath=model.fullPath,model.attrs)for(var item in model.attrs)model.attrs.hasOwnProperty(item)&&void 0===model[item]&&void 0!==model.attrs[item].default&&(model[item]=JSON.parse(JSON.stringify(model.attrs[item].default)));return model},Form:FormExt,Panel:PanelExt,NalogList:NalogListExt,DataGrid:DataGridExt,FieldDropdownHierarchicMultiple:FieldDropdownHierarchicMultipleExt,FieldText:FieldTextExt,FieldTextDate:FieldTextDateExt,FieldTextArea:FieldTextAreaExt,FieldRadio:FieldRadioExt,FieldCheckbox:FieldCheckboxExt,FieldDropdown:FieldDropdownExt,FieldDropdownHierarchic:FieldDropdownHierarchicExt,FieldDropdownMultiple:FieldDropdownMultipleExt,FieldDropdownMultipleExt2v:FieldDropdownMultipleExt,FieldYear:FieldYearExt,FieldMonthExt:FieldMonthExtExt,DropdownSearchForChild:DropdownSearchForChildExt,Label:LabelExt,FormButton:FormButtonExt,FieldMap:FieldMapExt,FieldMapWithList:FieldMapWithListExt,FieldMapWithListDC:FieldMapWithListDCExt,PanelWorkActivity:PanelWorkActivityExt,FieldUpload:FieldUploadExt,Fias:FiasExt,FiasDaData:FiasDaDataExt,ImageEditor:ImageEditorExt,Kladr:KladrExt,KladrAddressRKN:KladrExt,KladrJuridicalPersonRKN:KladrExt,KladrNaturalPersonRKN:KladrExt,LocationBasedOnKladr:KladrExt,KladrRusStat:KladrExt,Table:TableExt,HelperBox:HelperBoxExt,FormStep:FormStepExt,
TimeSlotExt:TimeSlotExtExt,FieldInn:FieldInnExt,AutomotiveAxles:AutomotiveAxlesExt,FieldDrivingLicense:FieldDrivingLicenseExt,FieldAddressOfResidence:FieldAddressOfResidenceExt,FieldRegistrationAddress:FieldRegistrationAddressExt,FieldVehicle:FieldVehicleExt,InitialImpact:InitialImpactExt,NavPanel:NavPanelExt,FieldBirthCountry:FieldBirthCountryExt,KladrDropdown:KladrDropdownExt,InformerNotify:InformerNotifyExt,Informers:InformersExt,TableDictionary:TableDictionaryExt,Payment:PaymentExt,Advice:AdviceExt,InvitationPanel:InvitationPanelExt,InvitationPanelEuroprotocol:InvitationPanelEuroprotocolExt,EditableDataGrid:EditableDataGridExt,ConfirmPanel:ConfirmPanelExt,SMSConfirmDialog:SMSConfirmDialogExt,ClinicExam:ClinicExamExt,ElectronMedicalDocs:ElectronMedicalDocsExt,OrderListDC:OrderListDCExt,PersonalData:PersonalDataAutoExt,PersonalDataManual:PersonalDataExt,Contacts:ContactsAutoExt,ContactsManual:ContactsExt,PassportData:PassportDataAutoExt,PassportDataManual:PassportDataExt,LegalBusinessmanData:LegalBusinessmanDataExt,AdditionalDocuments:AdditionalDocumentsAutoExt,AdditionalDocumentsManual:AdditionalDocumentsExt,MedicalPolicy:MedicalPolicyExt,KidData:KidDataExt,VehicleData:VehicleDataExt,DelegateData:DelegateDataExt,DelegatePersonPanel:DelegateDataSubItemExt,DelegateDelegatePanel:DelegateDataSubItemExt,PersonAddressesData:PersonAddressesDataExt,FieldMapWithListFrgu:FieldMapWithListFrguExt,Captcha:CaptchaExt,ListKids:ListKidsExt,ListReferral:ListReferralExt,ListSpecialists:ListSpecialistsExt,FieldUploadFileSign:FieldUploadFileSignExt,UploadFileFromDigitalProfile:UploadFileFromDigitalProfileExt,MfcDelivery:MfcDeliveryExt,PreviewGEPSMail:PreviewGEPSMailExt}}]),angular.module("serverForm.services").factory("api",["apiInner","ELEMS_EXTENTIONS","$rootScope","$compile","$routeParams","$http","CONFIG","$q","PGU","LOC","$timeout","Validators","sharedExtServices","$location","$window","$document","MAIN_LOADER_TEXTS","DEFAULT_NAVIGATION_HANDLERS","FORM_ERRORS","rule","ERRORSMSG","suggests","pguEsiaData","$moment","translate","HealthSrv","postMessage",function(apiInner,ELEMS_EXTENTIONS,$rootScope,$compile,$routeParams,$http,CONFIG,$q,PGU,LOC,$timeout,Validators,sharedExtServices,$location,$window,$document,MAIN_LOADER_TEXTS,DEFAULT_NAVIGATION_HANDLERS,FORM_ERRORS,rule,ERRORSMSG,suggests,pguEsiaData,$moment,translate,HealthSrv,postMessage){function dataGenerate(that,isProcessor,processorContext,element,number,event){var data={submitComponent:element.fullPath||"__form",submitEventNumber:number.toString(),submitEvent:event.eventType,userSelectedRegion:$rootScope.env.userSelectedRegion?$rootScope.env.userSelectedRegion.code:"00000000000"};if(isProcessor){angular.extend(data,{form:{mnemonic:that.env("formMnemonic"),content:apiInner.getFormDraft(api.getForm(),markDeletedDraft,toMarkDeletedRuntime,toMarkDeleted)}});var globalConfigContext={};if(!apiInner.isEmptyObject(event.context)){var contextData={};angular.forEach(event.context,function(obj,domain){contextData.hasOwnProperty(domain)||(contextData[domain]={}),angular.forEach(obj,function(value,key){contextData[domain][key]=value})}),angular.extend(globalConfigContext,contextData)}if(!apiInner.isEmptyObject(event.requestBinding)){var moreData={};angular.forEach(event.requestBinding,function(obj,domain){moreData.hasOwnProperty(domain)||(moreData[domain]={}),angular.forEach(obj,function(value,key){var find=api.find(value);if(value&&find&&!apiInner.isEmptyObject(find))moreData[domain][key]=find.value().toString();else if(value&&0==value.indexOf("__")){var str=$rootScope.env[value.substring(2)],tmpVal=str.toString()||getQueryVariable(value.substring(2));moreData[domain][key]=tmpVal.toString()}else value&&(moreData[domain][key]=value.toString())})}),angular.extend(globalConfigContext,moreData)}processorContext&&!apiInner.isEmptyObject(processorContext)&&angular.extend(globalConfigContext,processorContext),angular.extend(data,{context:{context:globalConfigContext}})}else angular.extend(data,{orderId:that.env("orderId").toString(),targetId:that.env("targetId").toString(),draftId:that.env("draftId").toString(),draftVersion:that.env("draftVersion").toString()});return data}function checkValidationErrors(that,eventType,data){function getFirstElement(items,elements){for(var i=0;i<items.length;i++){var item=items[i];if(elements.includes(item.fullPath)||item.fullPathForXml&&elements.includes(item.fullPathForXml))return item.fullPath;if(item.items&&item.items.length){var result=getFirstElement(item.items,elements);if(result)return result}}}var validationErrors=data.validationErrors,isBlocked=data.error&&4007===data.error.code;if("Form"===that.element.className&&"submit"===eventType&&validationErrors&&!_.isEmpty(validationErrors)){var formElement,errorMsg=isBlocked?"Необходимо скорректировать значение":"Ошибка ввода данных",counter=0,firstElement="",formElements=[],content=validationErrors&&validationErrors.content,uploaders=validationErrors&&validationErrors.appliedDocuments&&validationErrors.appliedDocuments.appliedDocument;if(uploaders&&uploaders.length){var regexpClone=new RegExp(/\[\d]/gi),getOriginalPath=function(fileId){return fileId.replace(regexpClone,"")},multiUploaderErrors={};uploaders.forEach(function(file){var k=getOriginalPath(file.id);formElement=api.find(k),0===counter&&(firstElement=k),counter++,k!==file.id?(multiUploaderErrors[k]=multiUploaderErrors[k]||[],multiUploaderErrors[k].push(file.name)):(api.inheritedVisibility(k)||formElement.visible(!0),formElement.error("Файл «"+file.name+"» не загрузился. Попробуйте еще раз."))}),Object.keys(multiUploaderErrors).forEach(function(path){var names=multiUploaderErrors[path].join("», «"),moreOneFile=multiUploaderErrors[path].length>1,message=moreOneFile?"Файлы «"+names+"» не загрузились":"Файл «"+names+"» не загрузилcя";api.find(path).error(message+". Попробуйте еще раз.")})}if(content&&(firstElement=getFirstElement(api.find().element.items,Object.keys(content)),Object.keys(content).forEach(function(key){var k=key;formElement=api.find(k),counter++,api.inheritedVisibility(k)||formElement.visible(!0),formElement.element.isFiasDaData?(formElement.element.qcControls.labelError.panel.visible(!0),formElement.element.qcControls.labelError.el.text('<span style="color: #D0021B">'+(content[k].messageError||errorMsg)+"</span>"),formElement.find("PanelControls.PanelDropdown.Dropdown").error(content[k].messageError||errorMsg),formElement.find("PanelControls.PanelQCFields").visible(!0)):formElement.error(content[k].messageError||errorMsg),formElements.push(formElement)})),isBlocked){var navPanel=api.findNavPanel(),btn=navPanel&&navPanel.items.find(function(item){return"next"===item.action}),lkUrl=$rootScope.settings.lkUrl+"notifications/details/ORDER/"+data.duplicateOrderId,titleWithOrder='Текущее значение уже используется в заявлении <a href="'+lkUrl+'" target="_blank">№'+data.duplicateOrderId+"</a>";navPanel.helper={html:"Для получения услуги введите другое значение",fullPath:navPanel.fullPath+".__helperBox",type:"important",visible:!0},btn.visible=!1,data.duplicateOrderId&&(navPanel.helper.title=titleWithOrder);var defer=$q.defer(),watchers=[];formElements.forEach(function(element){var duplicateValue=element.value(),deregister=$rootScope.$watch(function(){return element.value()},function(newV,oldV){duplicateValue&&newV&&duplicateValue!==newV&&defer.resolve()});watchers.push(deregister)}),defer.promise.then(function(){navPanel.helper.visible=!1,btn.visible=!0,watchers.forEach(function(deregister){deregister&&deregister()})})}return api.shade(!1),counter>=1&&api.scrollTo(firstElement,"",-90),api.env("supportSignature")&&api.env("EsepResult")&&api.env("editFormAfterEsep",!0),api.env("smsCorrect")&&(api.find("form.NavPanel.Panel1.Panel1.Label71").visible(!1),api.find("form.NavPanel.Panel1.Panel2.FormButton72").label("Подать заявление"),api.find().esiaDataForSave([])),void api.clearStackOfFormSubmit()}}function setInvalidData(element,message,lazy){element.error=message,element.isValid=!1,api.__setFirstFieldError||lazy||(api.__setFirstFieldError=element.fullPath)}function apiElement(element){var that=this;this.element=element,this.getElement=function(){return this.element},this.init=function(){if(this.element&&this.element.attrs)for(var it in this.element.attrs)this[it]||(this[it]=function(it){return function(data){return void 0===data?this.attr(it):(this.attr(it,data),this)}}(it));var deregistration=$rootScope.$on(this.element.fullPath+":ScopeApplied",function(evt,attrs){that._dom=attrs.element,"FormButton"==that.element.className&&(that.$link=that._dom.find(".PGU-Button")),deregistration()})},this.attr=function(name,data){return void 0===data?this.element[name]:("boolean"===apiInner.getAttrType(this,name)&&(data=apiInner.toBoolean(data)),this.element[name]=data,api.applyScope(),this)},this.clones=function(clones){var item,clonesCopy,allItems=[],panelParent=this.element.parent.apiElem.element,parentFullPath=function(elem){return elem.isClone?elem.cloneParent:elem.fullPath}(this.element);allItems.push(api.find(parentFullPath));for(var i=0,l=panelParent.items.length;i<l;i++)item=panelParent.items[i],item.cloneParent==parentFullPath&&allItems.push(api.find(item.fullPath));if(!arguments.length)return allItems;if("[object Array]"===Object.prototype.toString.call(clones)){clonesCopy=clones.concat();for(var j=0,jl=allItems.length;j<jl;j++)item=allItems[j],clonesCopy[j]?(item.element.cloneIndex!==clonesCopy[j].element.cloneIndex&&function(from,to){var replacedStr,fromDraft=apiInner.getFormDraft(from),fromFP=from.fullPath(),toFP=to.fullPath(),result={};for(var i in fromDraft)fromDraft.hasOwnProperty(i)&&(replacedStr=i.replace(fromFP,toFP),result[replacedStr]=fromDraft[i]);api.setDraft(result)}(clonesCopy[j],item),0!==j||item.element.visible||(item.element.visible=!0,api.applyScope())):clones.length||0!==j?(item.element.destroy(),FormHash[item.fullPath]=null):(item.element.visible=!1,api.applyScope())}},this._getCurrentNumOfClones=function(){var clones=this.clones();return clones&&clones.length?clones.length-1:0},this.afterSetMaxCloned=function(newValue){var clones;if(this.clonable()){if(newValue<this.clones().length)for(;newValue<this.clones().length;)this.clones()[this.clones().length-1].element.destroy();clones=this.clones(),newValue>clones.length&&(clones[clones.length-1].element.isLastClone=!0),newValue===clones.length&&(clones[clones.length-1].element.isLastClone=!1),api.applyScope()}}}var FormHash,FormHashLazyLoad,FormStepRendered,toMarkDeleted,markDeletedDraft,toMarkDeletedRuntime,StrategiesCache={},cloneIndexArr=[],setStepsNumberTO,_parentControlAttrRules={},_isFirstTimeFiredRulesMap=[],initValidate,api={applyScope:function(){$timeout.cancel(api.rootScopeApplying),api.rootScopeApplying=$timeout(function(){$rootScope.$applyAsync()},200,!1)},checkInvitation:function(){var elem=this.getElement();if("function"==typeof elem.checkInvitation)return elem.checkInvitation()},getElement:function(){return this.element?this.element:this.getForm()},setElem:function(data){this.element=data},init:function(f,scope,validators){window.FormHash=api._FormHash=FormHash={},window.FormHashLazyLoad=api._FormHashLazyLoad=FormHashLazyLoad={},window.FormStepRendered=api._FormStepRendered=FormStepRendered={},api.__dadataWidgets=[],toMarkDeleted={},toMarkDeletedRuntime=toMarkDeletedRuntime||{},markDeletedDraft=markDeletedDraft||{},this.form=f,this.replacePersonalData(this.form),this.scope=scope,api.initAttrs(void 0,validators),$rootScope.isDesigner||suggests.init(api),$rootScope.mainLoader.startRenderForm=!0;var prevFullPath,openFullPath;return $rootScope.$on("selectDropdownOpened",function(evt,attrs){openFullPath=attrs.fullPath,attrs.fullPath!=prevFullPath&&(prevFullPath&&$rootScope.$broadcast("selectDropdownClose",{fullPath:prevFullPath}),prevFullPath=attrs.fullPath)}),$(document).on("click",function(event){void 0!==window.getSelection&&window.getSelection().toString()||($(event.target).closest('[full-path="'+openFullPath+'"]').length&&!$(event.target).closest(".PGU-dropdown-tags").length||($rootScope.$broadcast("selectDropdownClose",{fullPath:openFullPath}),openFullPath=void 0),PGU.Events.publish(":documentClick",event))}),this},initAttrs:function(model,validators,cloneParent,countLoadsOn){var that=this,countLoads=!1,itemsInRules={},alwaysFalseValidator={message:"Всегда ложь, кроме пустой строки",mnemonic:"alwaysFalse",regexp:"(^$)"},itemValidators=validators||[];itemValidators.filter(function(item){return"alwaysFalse"===item.mnemonic}).length||itemValidators.push(alwaysFalseValidator),this.formValidators||(this.formValidators=itemValidators.concat()),void 0==$rootScope.mainLoader.loadCounter&&($rootScope.mainLoader.loadCounter=0,countLoads=!0),countLoadsOn&&void 0==$rootScope.settings.stepLoader[model[0].fullPath]&&(model[0].stepLoader=0,$rootScope.settings.stepLoader[model[0].fullPath]=0,$rootScope.settings.stepLoader[model[0].fullPath.replace(".","")]=0);var regexpClearSrc=new RegExp(/\[0\]/g),notFoundElems=$rootScope.settings.notFoundElems;apiInner.loopThroughTheTree(model||that.form,function(items,item,parent){$rootScope.isDesigner||("Panel"!==item.className&&"DataGrid"!==item.className||(item._model=angular.toJson(item)),"FieldDropdownHierarchic"===item.className&&(item.parent&&(item.parent.apiElem={}),item._model=angular.toJson(item)),item.name||(item.UUIDFullPath=uuid.v4(),api._FormHash[item.UUIDFullPath]=item),item.notRequiredText||(item.emptyRequiredText=!0),"EditableDataGrid"===item.className&&apiInner.loopThroughTheTree(item.items,function(items,item){item.syncRender=!0}));var el=new apiElement(item);if(ELEMS_EXTENTIONS.initAttrs(el),el.init(),"Form"!=item.className&&(parent||cloneParent)&&(item.parent={fullPath:parent?parent.fullPath:cloneParent.fullPath,className:parent?parent.className:cloneParent.className,name:parent?parent.name:cloneParent.name,apiElem:parent?parent.name?api.find(parent.fullPath):parent.apiElem:cloneParent.name?api.find(cloneParent.fullPath):cloneParent.apiElem}),$rootScope.isDesigner||(apiInner.initRules.call(el,item,itemsInRules,_parentControlAttrRules),item.mnemonicAutofill&&suggests.addMnemonic(item.mnemonicAutofill,item.fullPath)),"Form"==item.className||item.name){var src=item.fullPath||"",clearSrc=src.replace(regexpClearSrc,"");FormHash[src]=el,src!==clearSrc&&(FormHash[clearSrc]=el),countLoads&&$rootScope.mainLoader.loadCounter++,countLoadsOn&&(model[0].stepLoader++,$rootScope.settings.stepLoader[model[0].fullPath]++,$rootScope.settings.stepLoader[model[0].fullPath.replace(".","")]++)}else item.apiElem=el}),$rootScope.isDesigner?($rootScope.designerValidators=$rootScope.designerValidators||[],apiInner.loopThroughTheTree(model||that.form,function(items,item){item.validators&&item.validators.length&&item.validators.forEach(function(validator){$rootScope.designerValidators.includes(validator.mnemonic)||$rootScope.designerValidators.push(validator.mnemonic)})})):apiInner.loopThroughTheTree(model||that.form,function(items,item){if("Form"==item.className||item.name){var inNotFoundElems;notFoundElems&&notFoundElems.length&&(inNotFoundElems=notFoundElems.find(function(i){return i.listenComponent===item.fullPath}))&&(item.isMultiple&&"0"!==item.cloneIndex.toString()||apiInner.attachHandlers.call(api,api.find(inNotFoundElems.fullPath).element,{})),item.isMultiple&&"0"!==item.cloneIndex.toString()||apiInner.attachHandlers.call(api,item,itemsInRules)}if(that.formValidators.length&&item.validators&&item.validators.length)for(var i=0;i<item.validators.length;i++)for(var j=0;j<that.formValidators.length;j++)item.validators[i].mnemonic==that.formValidators[j].mnemonic&&(item.validators[i]=that.formValidators[j])})},triggerHandler:function(fullPath,listen,handler,eventAttrs){this.__cacheHandlers=this.__cacheHandlers||[];var FormPlayer=api,errorMessage="element fullPath: "+fullPath+"\nlisten: "+handler.listen.map(function(element){return element.component+":"+element.events.map(function(event){return event||""}).join(", ")||""}).join(", ")+"\n";FormPlayer.env.supportSignature=api.env("supportSignature");try{var func=eval("(function() {return "+handler.handler+";})()")}catch(e){}var findElement,listens=handler.listen,formRenderedEvt;listens&&listens.length&&(formRenderedEvt=listens.find(function(i){return i.events&&i.events.length&&~i.events.indexOf("formRendered")}));var mainLoader="mainLoader",mainLoaderCounterPart="loadCounter",rootMainLoader=$rootScope[mainLoader][mainLoaderCounterPart],mainLoaderCounter=mainLoader+"."+mainLoaderCounterPart,stepLoader="settings",stepLoaderCounter="stepLoader",isStepLoaderCounter=eventAttrs.inFormStepRendered&&eventAttrs.inFormStepRendered.fullPath?eventAttrs.inFormStepRendered.fullPath:"",isLoadCounter=void 0!==rootMainLoader&&rootMainLoader>0;if(!isLoadCounter&&isStepLoaderCounter){var rootStepLoader=$rootScope[stepLoader][stepLoaderCounter][isStepLoaderCounter];isLoadCounter=void 0!==rootStepLoader&&rootStepLoader>0,isLoadCounter&&(mainLoaderCounter=stepLoader+"."+stepLoaderCounter+"."+isStepLoaderCounter.replace(".",""))}if(isLoadCounter)var waitUntilFormIsRendered=$rootScope.$watch(mainLoaderCounter,function(newV,oldV){if(newV<=0){if(func){try{func.call(api.find(fullPath),eventAttrs),api.__cacheHandlers.push({fullPath:fullPath,listen:listen,handler:handler,eventAttrs:eventAttrs})}catch(e){}api.applyScope()}waitUntilFormIsRendered()}});else if(func){try{findElement=api.find(fullPath),api.__cacheHandlers.push({fullPath:fullPath,listen:listen,handler:handler,eventAttrs:eventAttrs}),func.call(findElement,eventAttrs)}catch(e){}api.applyScope()}},getForm:function(){return this.form},step_v_2:function(step){if(void 0===step){var steps=this.getForm()[0].items;if(!steps||!steps.length)return{};for(var i=0;i<steps.length;i++)if(!1!==steps[i].visible)return api.find(steps[i].fullPath);return{}}var steps=this.getForm()[0].items;if(!steps||!steps.length||!step)return this;for(var i=0;i<steps.length;i++)steps[i].visible=!1,i+1==step&&(steps[i].visible=!0);return api.applyScope(),this},nextStep:function(){var steps=this.form[0].items;if(!steps||!steps.length)for(var i=0;i<steps.length;i++)steps[i].visible&&i<steps.length-2&&(steps[i+1].visible=!0,steps[i].visible=!1);return api.applyScope(),this},prevStep:function(){var steps=this.form[0].items;if(!steps||!steps.length)for(var i=0;i<steps.length;i++)steps[i].visible&&i>0&&(steps[i-1].visible=!0,steps[i].visible=!1);return api.applyScope(),this},find:function(name,isSearchFromStart){var cloneItem=function(name){var clonedItem,nameArray=name.split("."),parentName=nameArray.slice(0,nameArray.length-1).join("."),param=apiInner.getNameAndIndex(nameArray[nameArray.length-1]);if(param.name&&param.index&&api.find(parentName)){var items=api.find(parentName).element.items;apiInner.loopThroughTheTree(items,function(items,item){param.name===apiInner.getNameAndIndex(item.name).name&&(clonedItem=item)}),clonedItem&&"DataGrid"===clonedItem.className&&!cloneIndexArr.find(function(item){return item===param.index})&&(cloneIndexArr.length||clonedItem.addClone(clonedItem,api,apiInner,PGU),cloneIndexArr.push(param.index),clonedItem.addClone(clonedItem,api,apiInner,PGU)),clonedItem&&"Panel"==clonedItem.className&&clonedItem.addClone(!0,param.index,api),!clonedItem||"FieldDropdownHierarchic"!=clonedItem.className&&"FieldDropdownMultiple"!=clonedItem.className&&"FieldDropdownHierarchicMultiple"!=clonedItem.className&&"FieldDropdownMultipleExt2v"!==clonedItem.className||clonedItem.addClone(clonedItem,param.index,api)}api.applyScope()};return function(context,name,ifsfs){function search(name,el){if(el){if("]"!==name[name.length-1]||api._FormHash[fullPath+"."+name]||function(name){cloneItem(name)}(fullPath+"."+name),el.name===name)return fullPath=fullPath?fullPath+"."+name:name,el.fullPath=el.fullPath||fullPath,void(searchIn=searchEl=el);if("DataGrid"!=el.className&&el.items&&el.items.length)for(var i=0;i<el.items.length;i++)search(name,el.items[i])}}if("string"==typeof(name=name||"")){if(!(name=name.replace(/\[0\]/g,"")))return function(){return api._FormHash[""]?api._FormHash[""]:(context.form[0].fullPath=context.form[0].fullPath||context.form[0].name||"",apiEl=new apiElement(context.form[0]),apiEl.init(),api._FormHash[""]=apiEl,apiEl)}();if(api._FormHash[name])return api._FormHashLazyLoad[name]&&(api._FormHashLazyLoad[name]=null),api._FormHash[name];if(context&&context.element&&context.element.fullPath&&api._FormHash[context.element.fullPath+"."+name])return api._FormHash[context.element.fullPath+"."+name];var arrayPath=name.split("."),fullPath="",searchIn={},searchEl=void 0,lastPathChild="";if(context.form&&context.form.length)searchIn=context.form[0],!0;else{if(!(context.element&&context.element.items&&context.element.items.length))return;searchIn=context.element}if(arrayPath.forEach(function(item){search(item,searchIn)}),lastPathChild=arrayPath[arrayPath.length-1],api._FormHash[name])return api._FormHashLazyLoad[name]&&(api._FormHashLazyLoad[name]=null),api._FormHash[name];if(api._FormHashLazyLoad[name])return api._FormHashLazyLoad[name];if(searchEl){(searchEl.name!==lastPathChild||searchEl.name===lastPathChild&&arrayPath.length>1&&searchEl.parent&&searchEl.parent.fullPath&&searchEl.parent.fullPath+"."+lastPathChild!==name)&&(searchEl={},searchEl.attrs={title:{default:""},checked:{default:!1},label:{default:""},stepNumber:{default:""},parentItem:{default:""}},searchEl.value="",searchEl.fullPath=name,searchEl.__notLoad=!0);var apiEl=new apiElement(searchEl);return apiEl.init(),searchEl.__notLoad?api._FormHashLazyLoad[name]=apiEl:api._FormHash[searchEl.fullPath]=apiEl,"function"!=typeof apiEl.fullPath||apiEl.fullPath(),apiEl}}}(this,name)},each:function(fn){var element=this.element||api.find().element;return element&&element.items&&element.items.length&&element.items.forEach(function(item,i){fn(i,api.find(item.fullPath))}),this.element?this:api.find()},createPopup:function(obj){$rootScope.$applyAsync(function(){obj.backBtnName=api.isMobile()?obj.backBtnName||"Вернуться":"",api.find().element.popupContent=obj,api.find().element.popupIsOpen=!0,postMessage.send({fadeAll:!0})})},closeApiPopup:function(){PGU.Events.publish("form:hidePopup")},getInfoByAddress:function(address,callback,host){if(address){var params={q:address||""};("fias"==host?sharedExtServices.kladrGetFiasInfo:sharedExtServices.normalizeAddressInDaData)("fias"==host?address:params,function(data){callback&&callback(data)},function(error){})}},setValues:function(obj){if("FieldDropdownMultiple"==this.element.className||"FieldDropdownMultipleExt2v"==this.element.className){var copyObj=_.extend({},obj),origin=api.find(this.element.originalFullPath.replace(/\[\d+\]$/gi,"")).element;origin&&(origin.__draftData=origin.__draftData||[],origin.__draftData.push(copyObj)),origin.__draftDataLength=origin.__draftData.length}if(("FieldDropdownMultiple"==this.element.className||"FieldDropdownMultipleExt2v"==this.element.className)&&"0"!==this.element.cloneIndex.toString()){var values=(origin.value||"").split(",");return obj.value&&values.push(obj.value),void(origin.value=values.join(","))}for(var item in obj)obj.hasOwnProperty(item)&&(this.element[item]=obj[item]||"")},visible:function(data){return void 0===data?!!this.attr("visible"):(this.attr("visible",apiInner.toBoolean(data)),this)},attr:function(name,data){return void 0===data?this.getElement()[name]:("boolean"===apiInner.getAttrType(this,name)&&(data=apiInner.toBoolean(data)),this.getElement()[name]=data,api.applyScope(),this)},value:function(data){return void 0===data?this.attr("value"):(this.attr("value")!==data&&(this.__isSettedCall=!0,this.attr("value",data),this.element&&this.element.$setViewValue&&this.element.$setViewValue(data)),this)},isValid:function(data){return void 0===data?this.attr("isValid"):(this.attr("isValid",data),api.applyScope(),this)},setCustomTimeout:function(name,callback){var self=this.element?this:api.find();self.element.promises=self.element.promises||{},self.element.promises[name]&&$timeout.cancel(self.element.promises[name]),self.element.promises[name]=$timeout(callback,0,!1)},error:function(data){var self=this;return void 0===data?this.attr("error"):(this.setCustomTimeout("error",function(){self.attr("error",data)}),this)},disabled:function(data){return void 0===data?this.attr("disabled"):(this.attr("disabled",$rootScope.integrationModule||apiInner.toBoolean(data)),api.applyScope(),this)},readonly:function(data){return void 0===data?this.attr("readonly"):(this.attr("readonly",apiInner.toBoolean(data)),api.applyScope(),this)},text:function(data){return void 0===data?this.attr("text"):(this.attr("text",data),api.applyScope(),this)},data:function(name,value){return name?angular.isString(name)&&this.attr("_data")&&void 0!==this.attr("_data")[name]&&void 0==value?this.attr("_data")[name]:angular.isString(name)&&(value||!1===value)?this.attr("_data")[name]=value:void 0:this.attr("_data")},setValid:function(el){el.error=!1,el.isValid=!0,el.errorMessage=""},validateFilesByValidators:function(el){var files=el.files,validators=el.validators,errorMsg="";return validators&&validators.length&&files&&files.length&&files.forEach(function(file){validators.forEach(function(validator){file.name.match(validator.regexp)||(errorMsg=validator.message)})}),errorMsg},validate:function(lazy,isFirstLevel){function clearError(type){for(var validatorsTemp=[],i=0;i<validators[type].length;i++)"empty_for_error"!=validators[type][i].mnemonic&&validatorsTemp.push(validators[type][i]);panels[type].element.validators=validatorsTemp,panels[type].element.isValid=!0,panels[type].element.error=!1}function reqValid(items){for(var valid=!0,i=0;i<items.length;i++)items[i].name||"Form"==items[i].className?valid=api.find(items[i].fullPath,!0).validate(lazy,isFirstLevel,!0)&&valid:items[i].items&&items[i].items.length&&(valid=reqValid(items[i].items)&&valid),validateAccordion(lazy,valid,items[i]);return valid}function validateAccordion(lazy,valid,item){lazy||valid||!item.isAccordionMode||PGU.Events.publish(item.fullPath+":accordionError")}if(isFirstLevel=void 0===isFirstLevel,this.element){if("NavPanel"===this.element.className||this.element.isFiasDaData)return!0;if(this.element.disabled&&"FieldCheckbox"===this.element.className||!1===this.element.visible||!1===this.element.visibleStep||!this.inheritedVisibility())return api.setValid(this.element),!0;if("HelperBox"===this.element.className&&this.element.isErrorHelperBox)return api.__setFirstFieldError||lazy||valid||(api.__setFirstFieldError=this.element.fullPath),!1;if(!this.hasOwnProperty("validate")&&this.originalFrom)switch(this.originalFrom()){case"container":if(this.element.isWorkActivity){var that=this,panels={month:this.find("CELL_END_MONTH.END_MONTH"),year:this.find("CELL_END_YEAR.END_YEAR"),startMonth:this.find("CELL_START_MONTH.START_MONTH"),startYear:this.find("CELL_START_YEAR.START_YEAR")},endMonthVal=parseInt(panels.month.value()),endYearVal=parseInt(panels.year.value()),startMonthVal=parseInt(panels.startMonth.value()),startYearVal=parseInt(panels.startYear.value()),currentDate={year:$moment().year(),month:$moment().month()+1};panels.year.attr("validators")||panels.year.attr("validators",[]),panels.month.attr("validators")||panels.month.attr("validators",[]),panels.startMonth.attr("validators")||panels.startMonth.attr("validators",[]);var validators={month:panels.month.validators(),year:panels.year.validators(),startMonth:panels.startMonth.validators()};if(startMonthVal&&startYearVal&&endMonthVal&&endYearVal){if(startYearVal>endYearVal){!validators.year.find(function(item){return"empty_for_error"===item.mnemonic})&&validators.year.push({mnemonic:"empty_for_error",message:"Год не может быть меньше года начала интервала",regexp:"(^$)"}),clearError("month")}else{clearError("year");var incorrectInterval=startYearVal===endYearVal&&startMonthVal>endMonthVal,endDateInFuture=endYearVal===currentDate.year&&endMonthVal>currentDate.month;incorrectInterval||endDateInFuture?validators.month.push({mnemonic:"empty_for_error",message:incorrectInterval?"Месяц не может быть меньше месяца начала интервала":"Месяц не может быть больше текущего",regexp:"(^$)"}):clearError("month")}startYearVal===currentDate.year&&startMonthVal>currentDate.month?validators.startMonth.push({mnemonic:"empty_for_error",message:"Месяц не может быть больше текущего",regexp:"(^$)"}):clearError("startMonth")}}var valid=!0;if("PanelWorkActivity"===this.element.className){var chartIntervals=this.attr("chartIntervals");valid=!(chartIntervals&&chartIntervals.invalid&&chartIntervals.invalid.length),!chartIntervals||chartIntervals.status||valid||lazy||(chartIntervals.error=!0),api.__setFirstFieldError||lazy||valid||(api.__setFirstFieldError=this.element.fullPath)}if("InvitationPanel"===this.element.className){var userSNILS=api.find(this.element.pathToFieldSNILS).value(),fieldSNILS=this.element.model&&this.element.model.snils;if(fieldSNILS&&!fieldSNILS.disabled()&&fieldSNILS.visible()&&fieldSNILS.value()){var validatorsCount=fieldSNILS.validators().length;userSNILS&&fieldSNILS.value()===userSNILS?validatorsCount<3&&(fieldSNILS.validators().push({mnemonic:"equalSNILS",message:"Указанный СНИЛС совпадает с вашим! Пожалуйста, введите СНИЛС заново",regexp:"(^$)"}),this.element.isValid=!1):validatorsCount>2&&(fieldSNILS.validators().pop(),this.element.isValid=!0)}var fieldBirthDate=this.element.model&&this.element.model.birthDate;if(fieldBirthDate&&!fieldBirthDate.disabled()&&fieldBirthDate.visible()&&fieldBirthDate.value()&&10==fieldBirthDate.value().length){var bDate=fieldBirthDate.value().split("."),validatorsCount=fieldBirthDate.validators().length;18>function(date){return((new Date).getTime()-new Date(date))/315576e5|0}(bDate[2]+"-"+bDate[1]+"-"+bDate[0])?validatorsCount<3&&(fieldBirthDate.validators().push({mnemonic:"wrongAge",message:"Второй заявитель должен быть старше 18 лет на момент подачи заявления",regexp:"(^$)"}),this.element.isValid=!1):validatorsCount>2&&(fieldBirthDate.validators().pop(),this.element.isValid=!0)}var emailValidator,fieldEmail=this.element.model&&this.element.model.email;fieldEmail&&!fieldEmail.disabled()&&fieldEmail.visible()&&(fieldEmail.validators().forEach(function(validator){"email"==validator.mnemonic&&(emailValidator=validator)}),this.element.isValid=!!(emailValidator&&fieldEmail.value().length&&fieldEmail.value().search(emailValidator.regexp)+1))}if(("Form"!=this.element.className&&"FormStep"!=this.element.className||api._startFromBeginning||lazy)&&!isFirstLevel||(api.__setFirstFieldError=!1),!this.element.items||!this.element.items.length)return!0;var isValidFields;if("DataGrid"===this.element.className&&this.element.fakeClones&&this.element.fakeClones.length){var validArr=[];this.element.fakeClones.forEach(function(clone){validArr.push(reqValid(clone.items))}),isValidFields=validArr.every(function(boo){return!0===boo})}else"PanelWorkActivity"===this.element.className&&device.mobile()&&$rootScope.settings.mobOptimizeWorkActivity?(isValidFields=valid,reqValid(this.element.items),api.__setFirstFieldError||lazy||valid||(api.__setFirstFieldError=this.element.fullPath)):(isValidFields=reqValid(this.element.items),validateAccordion(lazy,isValidFields,this.element));return isFirstLevel&&api.__setFirstFieldError&&"Panel"!==this.element.className&&this.scrollToError(api.find(api.__setFirstFieldError)),isValidFields&&valid;case"field":var el=this.element;if(el.disabled&&"FieldCheckbox"===el.className||!el.visible||!this.inheritedVisibility())return api.setValid(el),!0;if(!el.required&&el.validators&&el.validators.length&&(el.validators=api.removeItemByMnemonic("required",el.validators)),"EditableDataGrid"===el.className&&el.popup.show)return reqValid(el.items);if("FieldDropdownHierarchic"!==el.className&&!(el.required||el.validators&&el.validators.length||void 0!==el.preValidate||el.minlength||el.maxlength))return api.setValid(el),!0;if(!el.required||el.validators&&el.validators.length||(el.validators=[],el.validators.push({id:55550,
message:"Поле обязательно для заполнения",mnemonic:"required",name:"Обязательное поле",regexp:"\\s*\\S.*",shortDescription:"поле обязательно для заполнения, не пустое"})),el._changedByUser||!lazy){var minlength=el.minlength;if(minlength&&(!el.value&&el.required||el.value&&el.value.length<minlength))return setInvalidData(el,"Пожалуйста, введите не меньше "+minlength+" символов.",lazy),!1}if(lazy&&"EditableDataGrid"===el.className)return reqValid(el.items);var isInvalid,checkValue=el.gridValue||el.value;if("FieldDropdown"===el.className&&(checkValue=el.text_value?el.value:""),isInvalid=Validators.isInvalid(this.validators(),checkValue,api.formValidators),"FieldUpload"!==el.className&&"FieldCheckbox"!==el.className&&"FieldTextDate"!==el.className){if(isInvalid)return lazy&&!el._changedByUser||setInvalidData(el,isInvalid,lazy),!1;var maxLength=el.maxlength;if(maxLength&&(!el.disabled||!el.strategy)&&el.value&&el.value.length>maxLength)return!el._changedByUser&&lazy||setInvalidData(el,"Пожалуйста, введите не более "+maxLength+" символов.",lazy),!1;api.setValid(el)}if("FieldTextDate"===el.className){var that=this,errorMsg=that.preValidate?that.preValidate():that.element.preValidate.call(that);if(errorMsg)return lazy&&!el._changedByUser||setInvalidData(el,errorMsg,lazy),!1;api.setValid(el)}if("FieldCheckbox"==el.className)return el.required&&!el.checked?(lazy||setInvalidData(el,{text:"Поле обязательно для заполнения",mnemonic:"required"},lazy),!1):(api.setValid(el),!0);el.files=el.files||[];var responseError=!1;if(el.files.forEach(function(file){file.error&&(responseError=!0)}),"FieldUpload"===el.className){var errorMsg;if(!el.required||el.files.length&&!responseError?el.minCountFiles>el.files.length&&(errorMsg="Необходимо загрузить не менее "+el.minCountFiles+" файлов"):lazy&&!el._changedByUser||(errorMsg=responseError?"Что-то пошло не так":el.multipleUpload?"Необходимо загрузить файлы":"Необходимо загрузить файл"),el.validators&&el.validators.length&&!errorMsg&&(errorMsg=api.validateFilesByValidators(el)),errorMsg)return setInvalidData(el,errorMsg,lazy),!1}if("FieldDropdownHierarchic"===el.className&&!lazy){if(+el.validLevel>0){var FDH,e=!0,errMsg="";if(el.clones&&el.clones.length)for(var i=0,il=el.validLevel;i<il;i++){if(!(FDH=el.clones[i])){setInvalidData(el,"Необходимо заполнить все обязательные уровни поля",lazy),e=!1;break}if((errMsg=Validators.isInvalid(FDH.validators,FDH.value,api.formValidators))&&el.clones[i].required){FDH.list&&FDH.list.length?setInvalidData(FDH,errMsg,lazy):setInvalidData(el,"Необходимо заполнить все обязательные уровни поля",lazy),e=!1;break}}return el.isLoadingData&&(e=!1),$rootScope.$applyAsync(),e}if(el.required&&el.clones&&el.clones.length){var hasError;return el.clones.forEach(function(clone){var errMsg=Validators.isInvalid(clone.validators,clone.value,api.formValidators);errMsg&&(setInvalidData(clone,errMsg,lazy),hasError=!0)}),hasError}}}return api.setValid(this.element),!0}api._startFromBeginning=!0,api.__setFirstFieldError=!1,$rootScope.$broadcast("suspend");var valid1=api.find(this.form[0].fullPath).validate(void 0,isFirstLevel);return $rootScope.$broadcast("resume"),api.applyScope(),isFirstLevel&&api.__setFirstFieldError&&this.scrollToError(api.find(api.__setFirstFieldError)),api.__setFirstFieldError=!1,api._startFromBeginning=!1,valid1},valid:function(isValid,errMsg){return this.element&&"FieldTextDate"===this.element.className?this.isValid():void 0===isValid?this.isValid():(!0===isValid?(this.error(!1),this.isValid(!0)):!1===isValid&&(angular.isString(errMsg)&&""!=errMsg&&this.error(errMsg),this.isValid(!1)),void api.lastScrollToFirstError())},checkTypeOf:function(type,obj){var jsClass=Object.prototype.toString.call(obj).slice(8,-1);return void 0!==obj&&null!==obj&&jsClass===type},validators:function(value){if(void 0===value)return this.attr("validators")||[];if(Array.isArray(value)){if(angular.equals(this.element.validators,value))return;this.element.validators=[],this.element.validators=value.concat()}else if(api.checkTypeOf("Object",value)){var filterByMnemonic=this.element.validators.filter(function(item){return item.mnemonic===value.mnemonic});filterByMnemonic.length||this.element.validators.push(value)}},required:function(data){return void 0===data?this.attr("required"):(this.attr("required",apiInner.toBoolean(data)),api.applyScope(),this)},imageEditorError:function(){},throbber:function(data){return void 0===data?this.attr("throbber"):(this.attr("throbber",data),api.applyScope(),this)},submit:function(eventType,eventNumber,context,callbackConfig,notShade,needPopup){if(!$rootScope.isPreview){var el=this.element||this.find().element;void 0!==eventNumber&&!PGU.startEsiaSave&&el&&("Form"===el.className&&"FINAL"===el.submitEvents.submit[eventNumber].submitType||needPopup)&&(api.sendDadataReachGoals(),PGU.startEsiaSave=!0,api.env("supportSignature")||(api.checkSmsConfirmValid(),api.__checkHasPaymentToReUse&&api.__checkHasPaymentToReUse()),api.env("isNeedCaptcha")&&api.checkCaptchaValid(),api.__checkSignBeforeSubmit&&api.__checkSignBeforeSubmit(),api.addRequestToQueue(function(defer){api.saveDataInEsia(function(){defer.resolve()},!0)}),!$rootScope.settings.autosaveDisabled&&$rootScope.haveUploaders&&(api.addRequestToQueue(api.removeHiddenUploaders),api.uploadDraft())),api.env("imageEditorInitWithValue")&&api.checkImageEditorInitWithValue(),api.submitOrigin.bind(this)(eventType,eventNumber,context,callbackConfig,notShade)}},submitOrigin:function(eventType,eventNumber,context,callbackConfig,notShade){function goSubmit(){if(el.customSubmitConfig={},el.customSubmitConfig.customContext=context||{},el.customSubmitConfig.customCallbackConfig=angular.extend({async:!1},callbackConfig||{}),el.triggerEvent(eventType,eventNumber,el.customSubmitConfig.customCallbackConfig.async,notShade),angular.isDefined(error))throw error}var error;PGU.Events.subscribe("","errorHttpSyncPguSubmit",function(evt,err){error=err||{message:"Submit failed"}});var el,isChief=api.env("isChief"),doneCallback=context&&"function"==typeof context.done?context.done:null,errorCallback=context&&"function"==typeof context.error?context.error:null;if(el=this.element?this:api.find(this.form[0].fullPath),"FormPreview"===el.attr("className"))return!0;if(void 0===eventNumber){var thisSubmitEvents=el.attr("submitEvents"),that=el;thisSubmitEvents&&("Form"!==el.element.className||"submit"!==eventType||void 0===isChief||isChief?angular.forEach(thisSubmitEvents[eventType],function(o,i){that.submit(eventType,i,context,callbackConfig,notShade)}):(api.shade(!0),api.uploadDraft(0,doneCallback,errorCallback,!0)))}else el&&el.element&&["FormStep","Form"].indexOf(el.element.className)>-1?"Form"!==el.element.className||"submit"!==eventType||void 0===isChief||isChief?el.element.submitEvents&&!apiInner.isEmptyObject(el.element.submitEvents)?goSubmit():api.getVisibleSteps()[api.step()].step.submitEvents.processor||"final"===arguments[3]||(context&&context.done&&"function"==typeof context.done?api.uploadDraft(0,context.done,context.error):api.uploadDraft(0)):(api.shade(!0),api.uploadDraft(0,doneCallback,errorCallback,!0)):goSubmit()},triggerEvent:function(eventType,eventNumber,async,notShade){var event,df=$q.defer(),pr=df.promise,that=this;if(!$rootScope.env.resultSignature||"-1"==$rootScope.env.resultSignature||"Form"==this.className&&("Form"!=this.className||"init"!=eventType)){var eventsToResolve,url,submitEvent,context={},obj={};if(void 0===eventNumber)eventsToResolve=apiInner.getSubmitEvent(this.attr("submitEvents"),eventType);else{submitEvent=apiInner.getSubmitEvent(this.attr("submitEvents"),eventType)[eventNumber],eventsToResolve=[],eventsToResolve.push(submitEvent),apiInner.isEmptyObject(that.customSubmitConfig.customContext)||(that.customSubmitConfig.customContext.hasOwnProperty("done")||that.customSubmitConfig.customContext.hasOwnProperty("error")||that.customSubmitConfig.customContext.hasOwnProperty("always")?(obj=that.customSubmitConfig.customContext,url=obj.url||""):(obj=that.customSubmitConfig.customCallbackConfig,context=that.customSubmitConfig.customContext));var defaultActions={render:function(data){data.validationErrors&&data.validationErrors.content;data.hasOwnProperty("form")||(data.form={}),data.messageId?data.context={submit:{messageId:data.messageId}}:data.context?data.context=data.context.context||{}:data.context={},apiInner.isEmptyObject(submitEvent.responseBinding)||angular.forEach(submitEvent.responseBinding,function(obj,domain){angular.forEach(obj,function(value,key){if(data.context[domain]&&void 0!==data.context[domain][key]){var contextValue=data.context[domain][key],find=api.find(value);find&&!apiInner.isEmptyObject(find)?find.value(contextValue):0==value.indexOf("__")&&($rootScope.env[value.substring(2)]=contextValue,$rootScope.settings[value.substring(2)]=contextValue)}})}),data.form&&data.form.content&&api.setDraft(data.form.content),$rootScope.inOpWidget&&"submit"===eventType&&submitEvent&&submitEvent.submitType&&"FINAL"===submitEvent.submitType&&($rootScope.opStatisticData.type="successSubmitForm",window.postMessage(JSON.stringify({id:"widget.display",pguData:$rootScope.opStatisticData}),"*")),obj.done&&obj.done(data)},error:function(data,number,submitType,startLaunch){if(data&&data.code&&(data.originalCode=data.code),data&&data.error&&[4005,4007].includes(data.error.code))return void checkValidationErrors(that,eventType,data);var err=data?data.error?data.error.message:data:"Submit failed";throw obj.error?obj.error(data):("Form"===that.element.className&&"submit"===eventType&&(0===number&&"FINAL"===submitType&&($rootScope.$emit("HEALTH_SEND",{event:"submitOrder",timing:(new Date).getTime()-startLaunch,result:1,ServiceError:data.code||"",rndFormId:$rootScope.currentFormRandomId,orderId:$rootScope.settings.orderId}),$rootScope.currentFormRandomId=null),data=data||{},void 0===data.code||data.code&&(data.code<1400||data.code>1403)?(data.code="submitError",data.hideForm=!0):data.esepError=!0),api.handleError(data)),"Form"===that.element.className&&"submit"===eventType&&0===number&&"FINAL"===submitType&&($rootScope.settings.submitError=!0),err},always:function(data){obj.always&&obj.always(data)}};pr.finally(function(res){defaultActions.always(res)}).then(function(res){defaultActions.render(res)},function(err){defaultActions.error(err)})}eventsToResolve.length&&(event=eventsToResolve.reverse().pop(),that.launch(event,this.getElement(),eventsToResolve,eventNumber||0,context,async,url,defaultActions))}},launch:function(event,element,eventsToResolve,number,processorContext,async,customUrl,callBack){function applyServiceLaunch(defer){var startLaunch=(new Date).getTime();sharedExtServices.formsService.launch({customUrl:customUrl,isProcessor:isProcessor,data:dataGenerate(that,isProcessor,processorContext,element,number,event),async:async},function(data){success(data,startLaunch),markDeletedDraft={},defer.resolve()},function(data){"Form"===element.className&&event&&"submit"===event.eventType&&"FINAL"===event.submitType&&0===number?$rootScope.$emit("HEALTH_SEND",{event:"submitOrder",timing:(new Date).getTime()-startLaunch,result:1,ServiceError:data?data.code:""}):isProcessor||$rootScope.$emit("HEALTH_SEND",{event:"submitForm",timing:(new Date).getTime()-startSubmit,result:1,ServiceError:data?data.code:""}),api.env("stackOfFormSubmit",[]),callBack.always(),callBack.error(data,number,event?event.submitType:"",startLaunch)})}var df=$q.defer(),isProcessor=(df.promise,!!event.processor),that=this,startSubmit=(new Date).getTime(),success=function(response,startLaunch){callBack.always&&callBack.always();var nextEvent;response.error&&0!=response.error.code?("Form"===element.className&&event&&"submit"===event.eventType&&"FINAL"===event.submitType&&0===number?($rootScope.$emit("HEALTH_SEND",{event:"submitOrder",timing:(new Date).getTime()-startLaunch,result:1,ServiceError:response.error.code||"",rndFormId:$rootScope.currentFormRandomId,orderId:$rootScope.settings.orderId}),$rootScope.currentFormRandomId=null):isProcessor||$rootScope.$emit("HEALTH_SEND",{event:"submitForm",timing:(new Date).getTime()-startSubmit,result:1,ServiceError:response.error.code}),callBack.error(response)):(callBack.render(response),"Form"===element.className&&event&&"submit"===event.eventType&&"FINAL"===event.submitType&&0===number?($rootScope.$emit("HEALTH_SEND",{event:"submitOrder",timing:(new Date).getTime()-startLaunch,result:0,rndFormId:$rootScope.currentFormRandomId,orderId:$rootScope.settings.orderId}),$rootScope.currentFormRandomId=null):isProcessor||$rootScope.$emit("HEALTH_SEND",{event:"submitForm",timing:(new Date).getTime()-startSubmit,result:0}),isProcessor||response.form&&response.form.content&&api.setDraft(response.form.content),eventsToResolve&&eventsToResolve.length>1&&number<eventsToResolve.length-1&&(nextEvent=eventsToResolve.pop(),that.launch(nextEvent,that.getElement(),eventsToResolve,number+1)))};api.addRequestToQueue(applyServiceLaunch)},fixedShade:function(isShade,textObj){api.shade(isShade,textObj,!0)},shade:function(isShade,textObj,hideFormDOM){var formStructure=this.getForm(),mainLoader=$rootScope.mainLoader;formStructure&&formStructure.length&&api.find(this.form[0].fullPath),isShade?(mainLoader.title=textObj&&textObj.title?textObj.title:MAIN_LOADER_TEXTS.title,mainLoader.msg=textObj&&textObj.msg?textObj.msg:MAIN_LOADER_TEXTS.msg,1==++mainLoader.__shadeCounter&&(mainLoader.show=isShade,$("body").toggleClass("PGU-SF-Dialog-Show",!0))):(mainLoader.__shadeCounter&&--mainLoader.__shadeCounter,0===mainLoader.__shadeCounter&&(mainLoader.show=isShade,PGU.state.modalDialogShow||$("body").toggleClass("PGU-SF-Dialog-Show",!1))),api.applyScope()},showPopupAndAdvice:function(msg,esepPreviewError){$rootScope.esep.errorMsg=msg,$rootScope.esep.show=!0,$rootScope.esep.esepPreviewError=!!esepPreviewError,api.applyScope()},showAdvice:function(msg){var title="",message="",iconType="Not";api.checkTypeOf("Object",msg)&&(title=msg.title,message=msg.message,msg.iconType&&(iconType=msg.iconType),msg.ruleMessage&&($rootScope.mainLoader.ruleMessage=msg.ruleMessage)),title&&($rootScope.mainLoader.errorTitle=title),$rootScope.mainLoader.iconType=iconType,$rootScope.mainLoader.errorMsg=message||msg},inheritedVisibility:function(fullName){var fullPaths,field,isVisible=!0,fName=void 0!==fullName?fullName:this.attr("fullPath");fullPaths=apiInner.getListFullNames(fName).reverse();for(var fi=0,fil=fullPaths.length;fi<fil&&isVisible;fi++)field=api.find(fullPaths[fi],!1),isVisible=field&&(field.attr("validateAlways")||field.attr("visible"));return isVisible},checkParentIsEditableMode:function(fullName){var fullPaths,isEditable=!1,fName=void 0!==fullName?fullName:this.attr("fullPath");fullPaths=apiInner.getListFullNames(fName).reverse();for(var fi=0,fil=fullPaths.length;fi<fil&&!isEditable;fi++)isEditable=api.find(fullPaths[fi],!1).element.editableMode;return isEditable},parent:function(){if(this.element&&this.element.parent){return this.element.parent.name?FormHash[this.element.parent.fullPath]:"Form"===this.element.parent.className?api.find():this.element.parent.apiElem}},scrollToError:function(field,mod,widgetPopup,popupElementScroll,firstFieldError){if(!this.element||!this.element.popUpOpened){var fullPath=field?field.element.fullPath:this.element?this.element.fullPath:api.form[0].fullPath;if(api.applyScope(),"popup"!==mod&&$timeout(function(){var el=$("[full-path='"+fullPath+"']");api.checkOpIframeScroll(el,function(){$document.scrollToElement(el,50,400)})},0),"popup"===mod){var popupEl=document.querySelector('[full-path="'+widgetPopup.fullPath+'"] .PGU-Popup'+(popupElementScroll?" "+popupElementScroll:"")),fieldError={},seched=!1,km=$rootScope.device.desktop?50:-10;$timeout(function(){firstFieldError?fieldError=document.querySelector("[full-path='"+firstFieldError+"']"):field.element&&field.element.items&&field.element.items.forEach(function(item){if(item.error&&!seched)return fieldError=document.querySelector("[full-path='"+item.fullPath+"']"),void(seched=!0)}),$(popupEl).animate({scrollTop:fieldError.offsetTop+km+"px"},300)})}}},lastScrollToFirstError:function(){api.__lastScrollToFirstError&&$timeout.cancel(api.__lastScrollToFirstError),api.__lastScrollToFirstError=$timeout(function(){for(var p in FormHash)if(FormHash.hasOwnProperty(p)){var item=FormHash[p];if(!item.isValid()&&item.visible()&&item.inheritedVisibility())return void api.scrollToError(FormHash[p])}},100)},scrollTo:function(){if(!$rootScope.isDesigner){var fullpath=arguments[0]&&"string"==typeof arguments[0]?arguments[0]:arguments[1]&&"string"==typeof arguments[1]?arguments[1]:this.attr("fullPath")?this.attr("fullPath"):"",top=(arguments[0]&&"number"==typeof arguments[0]?arguments[0]:arguments[1]&&"number"==typeof arguments[1]&&arguments[1],arguments[2]&&"number"==typeof arguments[2]?arguments[2]:0),el=$("[full-path='"+fullpath+"']");api.applyScope();var $body=$("body"),callback=null;arguments&&arguments.length>=2&&"function"==typeof arguments[1]&&(callback=arguments[1]),$timeout(function(){api.checkOpIframeScroll(el,function(){$body.toggleClass("PGU-ScrollActionOn",!0),$document.scrollToElementAnimated(el,-top,400)}),callback&&callback.call(),PGU.Events.publish(":showSubmitButton")},0)}},checkOpIframeScroll:function(el,otherCase){if($rootScope.inOpWidget)if($rootScope.inOpWidgetIframe){var offset=el.offset().top,offsetElementInFrame=offset>150?offset-100:offset;top.postMessage(JSON.stringify({scroll:{inFrameOffset:offsetElementInFrame}}),"*")}else otherCase();else otherCase()},setDraft:function(content,afterEditAction){var defer=$q.defer();$rootScope.setDraft=!0;var stackAsyncElems=[];return PGU.allPromises=[],Object.keys(content||{}).sort(function(a,b){return a>b?1:a<b?-1:0}).forEach(function(item){function findCloneParent(element){if(element.parent){var parent=api.find(element.parent.fullPath).element;return!!parent.isClone||findCloneParent(parent)}}var el=api.find(item);if(el)if("save"!==afterEditAction){if("FieldDropdownHierarchic"==el.element.className){var fullPath=item.split("."),param=apiInner.getNameAndIndex(fullPath[fullPath.length-1]);if("cancel"===afterEditAction&&(el.element.cancelEdit=!0),param.index>0){fullPath.splice(fullPath.length-1);var newItem=fullPath.join(".");if(newItem=newItem+"."+param.name+"["+(param.index-1)+"]",1==param.index){var newItem2=fullPath.join(".");newItem2=newItem2+"."+param.name}content[item].parentRefItemValue=content[newItem]?content[newItem].value:content[newItem2]?content[newItem2].value:api.find(newItem).element.value}else if(!el.element.parentDropdown&&"cancel"===afterEditAction){for(var j=0,jl=el.element.clones?el.element.clones.length:0;j<jl;j++)$rootScope.$emit(el.element.clones[j].fullPath+":StopHandle"),api._FormHash[el.element.clones[j].fullPath]&&(api._FormHash[el.element.clones[j].fullPath]=null);el.element.clones=[]}}"FieldUpload"===el.element.className&&"cancel"===afterEditAction?(el.element.onClonePanel=findCloneParent(el.element),el.element.onClonePanel?(el.element.makePromiseForReadyUploader().promise.then(function(callback){api.find(callback.fullPath).element.setDraftFromEdit(content[callback.fullPathForXml],afterEditAction)}),PGU.allPromises.push(el.element.readyUploader.promise)):el.element.setDraftFromEdit(content[item],afterEditAction)):el.setValues(content[item]),"cancel"===afterEditAction&&"Fias"===el.element.className&&stackAsyncElems.push(el.element.setDraftFromEdit())}else"FieldUpload"===el.element.className&&stackAsyncElems.push(el.element.setDraftFromEdit(content[item],"save"))}),stackAsyncElems.length?$q.all(stackAsyncElems.slice()).then(function(data){defer.resolve(),api.applyScope(),$rootScope.setDraft=!1}):(defer.resolve(),$rootScope.setDraft=!1),defer.promise},setDraftOld:function(content){var control;content.forEach(function(path,attrs){(control=api.find(path))&&(attrs=control.getElement().attrs,attrs.forEach(function(name,value){control.attr(name,"string"===attrs[name].type?value:JSON.parse(value))}))})},env:function(name,val){return $rootScope.settings||($rootScope.settings={}),arguments.length?name&&void 0===val?$rootScope.settings[name]:void($rootScope.settings[name]=val):$rootScope.settings},getFakeSteps:function(form){var result;return void 0!==form.hidePreview&&"false"!==form.hidePreview||form.showAllSteps||(result={fullPath:form.name+".FormPreview",className:"FormPreview",name:"FormPreview",submitEvents:{submit:[]}}),result},stepList:function(){for(var steps=[],form=this.getForm()[0],i=0,il=form.items.length;i<il;i++)form.items[i].visible&&("NavPanel"===form.items[i].className||form.items[i].excludeFromStepList||steps.push(api.find(form.items[i].fullPath)));return this.env("supportSignature")&&steps.push({name:"signature"}),steps},getVisibleSteps:function(){for(var steps=[],form=this.getForm()[0],i=0,il=form.items.length;i<il;i++)form.items[i].visible&&("NavPanel"===form.items[i].className||form.items[i].excludeFromStepList||steps.push({step:form.items[i],index:i}));return this.env("supportSignature")&&steps.push({index:i++,step:{name:"signature"}}),steps},setNumbersForSteps:function(steps){steps.forEach(function(item,index){item.step.stepNumber=index+1})},setStepsLabels:function(){setStepsNumberTO&&$timeout.cancel(setStepsNumberTO),setStepsNumberTO=$timeout(function(){var count=1;api._items.forEach(function(step){step.visible()&&(step.label(count.toString()),count++)})},200,!1)},getPreviewContent:function(){var self=this,form=this.getForm()[0],result=[];return angular.forEach(form.items,function(item,ind){"NavPanel"!==item.className&&"FormPreview"!==item.className&&result.push(self.createPreviewJson(item))}),result},generateFullJson:function(){function findElementByName(context,res){if("KladrRusStat"===context.className?res.className="Kladr":res.className=context.className,context.hidePreview&&(res.hidePreview=context.hidePreview),context.title&&(res.title=context.title),context.label&&(res.label=context.label),context.labelBeforeOptimized&&!context.label&&(res.label=context.labelBeforeOptimized),context.longLabel&&(res.longLabel=context.longLabel),context.name&&(res.name=context.name),context.clonable&&(res.clonable=context.clonable),context.isClone&&context.name.indexOf("workActivityPanel")>-1&&(res.name=context.name.replace(/workActivityPanel\[[0-9]*\]/,"workActivityPanel["+context.cloneIndex+"]")),context.label&&(res.label=context.label),context.strategy&&(res.strategy=context.strategy),void 0!=context.visible?res.visible=api.inheritedVisibility(context.fullPath):res.visible=!1,void 0!=context.disabled&&(res.disabled=context.disabled),void 0!=context.readonly&&(res.readonly=context.readonly),void 0!=context.required&&(res.required=context.required),context.value&&(res.value=context.value),"FieldRadio"==context.className&&context.textValue&&(res.text_value=context.textValue,res.textValue=context.textValue,res.sex=context.sex),"FieldCheckbox"==context.className&&(res.text_value=context.checked?"да":"нет"),"FieldMapWithList"!=context.className&&"FieldMapWithListDC"!=context.className&&"Label"!==context.className||(res.context=context),context.textValue&&(res.textValue=context.textValue||""),context.doNotShowInPdf&&(res.visible=!1),context.wasOptimizedandHide&&!context.doNotShowInPdf&&(res.visible=!0),"FieldDropdownHierarchicMultiple"==context.className){var resItem="";if(context.clones&&context.clones.length)for(var i=0;i<context.clones.length;i++){context.clones[i].parentPath||(resItem+="&#10;"+context.clones[i].title+": ");for(var j=0;j<context.clones.length;j++)context.clones[i].value==context.clones[j].parentPath&&(resItem+="&#10;  "+context.clones[j].title+";")}res.textValue=resItem}else"FieldDropdown"===context.className&&(res.text_value=context.text_value,res.textValue=context.text_value);if(["FieldDropdownHierarchic","FieldDropdownMultiple","FieldDropdownMultipleExt2v"].includes(context.className)){if(context.clones&&context.clones.length){if("FieldDropdownHierarchic"==context.className){for(var resItem,i=context.clones.length-1;i>-1;i--)if(context.clones[i]&&context.clones[i].text_value){resItem=context.clones[i];break}}else{var resItem={};resItem.text_value="";for(var i=0;i<context.clones.length;i++){var text=context.clones[i].text_value.trim();i!=context.clones.length-1?resItem.text_value+=text+", ":resItem.text_value+=text+"."}}resItem?(res.textValue=resItem.text_value,res.text_value=resItem.text_value):(res.textValue=context.text_value,res.text_value=context.text_value)}else res.textValue=context.text_value,res.text_value=context.text_value;res.visibleLevel=context.visibleLevel}context.files&&context.files.length&&!context.value&&context.visible&&(res.value=context.files.map(function(file){return file.name||""}).filter(function(name){return!!name}).join(", "));var contextItems=context._newListItems||context.items;contextItems&&(res.items=[],angular.forEach(contextItems,function(el,i){function getHumanAxleType(type){var str="";switch(type){case"1":str="Односкатные оси с пневмоподвеской";break;case"2":str="Двухскатные колеса";break;case"8":str="Восемь и более колес на оси"}return str}if(res.items[i]={},"PanelWorkActivity"==el.className)if(el.list&&el.list.length){var defaultItemModel,newListItems=[],defaultItem=el.items[0].items;defaultItem[0]&&defaultItem[0]._model&&(defaultItemModel=defaultItem[0]._model),el.list.forEach(function(listItem,i){var clone=JSON.parse(defaultItemModel);if(0!==i?(clone.clonable=!1,clone.cloneIndex=i,clone.name=clone.name+"["+i+"]"):clone.cloneId=defaultItem[0].cloneId,clone.visible=defaultItem[0].visible,clone.items&&clone.items.length){if(listItem.activity&&listItem.activity.value){var secondPart,radioPath="Panel10."+listItem.activity.fieldName,path=radioPath.split("."),firstPart=clone.items.find(function(clItem){return clItem.name===path[0]});firstPart&&firstPart.items&&firstPart.items.length&&(firstPart.visible=!0,(secondPart=firstPart.items.find(function(clItem){return clItem.name===path[1]}))&&(secondPart.visible=!0,_.extend(secondPart,listItem.activity)))}el.fieldNames.forEach(function(field){var secondPart,path=field.field.split("."),firstPart=clone.items.find(function(clItem){return clItem.name===path[0]});firstPart&&firstPart.items&&firstPart.items.length&&(firstPart.visible=!0,(secondPart=firstPart.items.find(function(clItem){return clItem.name===path[1]}))&&(secondPart.visible=!0,_.isObject(listItem[field.name])?_.extend(secondPart,listItem[field.name]):secondPart.value=listItem[field.name]))})}newListItems.push(clone)}),el.items[0]._newListItems=_.chain(newListItems).sortBy(function(item){return item.items[2].items[0].value+item.items[1].items[0].value}).value()}else el.items[0].items=_.chain(el.items[0].items).sortBy(function(item){return item.items[2].items[0].value+item.items[1].items[0].value}).value();if("DataGrid"===el.className&&el.fakeClones&&el.fakeClones.length?el.fakeClones.forEach(function(clone,index){var tmpLength=i;index>0&&(tmpLength=res.items.length),res.items[tmpLength]={},findElementByName(clone,res.items[tmpLength])}):findElementByName(el,res.items[i]),"AutomotiveAxles"===el.className){var indexTrailer=0;el.axlesList.forEach(function(axle,i){var item={className:"FieldText",visible:!0,disabled:!0,readonly:!0,required:!0};if(axle.mass&&axle.isCab){var massTruck=_.extend({},item);massTruck.label="Масса тягача(тонн)",massTruck.value=axle.mass,res.items[0].items.push(massTruck)}if(item.label=axle.humanityNumber,axle.isTruckAxle||axle.isCab)item.value="Нагрузка(тонн): "+axle.load,item.value+=axle.wheelType?"; "+getHumanAxleType(axle.wheelType):"";else{if(axle.mass){indexTrailer++;var trailerMass=_.extend({},item);trailerMass.label="Масса "+indexTrailer+" прицепа/полуприцепа(тонн)",trailerMass.value=axle.mass,res.items[0].items.push(trailerMass)}item.value="Нагрузка(тонн): "+axle.load,item.value+=axle.wheelType?"; "+getHumanAxleType(axle.wheelType):""}axle.distance&&(item.value+="; Расстояние(метров): "+axle.distance),res.items[0].items.push(item)})}}),angular.forEach(context.items,function(i,el){if("Panel"===el.className&&el.data("clones")){var tmpLength=res.items.length;angular.forEach(el.data("clones"),function(index,clone){res.items[tmpLength+index]={},findElementByName(clone,res.items[tmpLength+index])})}})),"ElectronMedicalDocs"===context.className&&(res.items=[],context.documents.forEach(function(doc){doc.checkbox.checked&&res.items.push({className:"FieldText",name:"FamilyName"+Math.random().toString(36).substr(2,9),visible:!0,disabled:!0,readonly:!0,required:!0,value:doc.DocumentType+", от "+moment(doc.DocumentDate,"YYYY-MM-DD").format("DD.MM.YYYY")})})),"FormStepMaps"===context.name&&res.items.push({className:"Panel",name:"Panel_Slot",visible:!0,items:[{className:"FieldText",label:"Подразделение",name:"OrgName",visible:!0,disabled:!0,readonly:!0,required:!0,value:PGU.timeSlotData.orgName},{className:"FieldText",label:"Адрес подразделения",name:"OrgAddress",visible:!0,disabled:!0,readonly:!0,required:!0,value:PGU.timeSlotData.orgAddress},{className:"FieldText",label:"Помещение",name:"HallTitle",visible:!0,disabled:!0,readonly:!0,required:!0,value:PGU.timeSlotData.selectedHallTitle&&""!==PGU.timeSlotData.selectedHallTitle?PGU.timeSlotData.selectedHallTitle:" - "}]}),"TimeSlotExt"===context.className&&res.items.push({className:"Panel",name:"Panel_Slot",visible:!0,items:[{className:"FieldText",label:"Подразделение",name:"OrgName",visible:!0,disabled:!0,readonly:!0,required:!0,value:PGU.timeSlotData.orgName},{className:"FieldText",label:"Адрес подразделения",name:"OrgAddress",visible:!0,disabled:!0,readonly:!0,required:!0,value:PGU.timeSlotData.orgAddress},{className:"FieldText",label:"Выбранное время",name:"VisitTime",visible:!0,disabled:!0,readonly:!0,required:!0,value:PGU.timeSlotData.visitTime},{className:"FieldText",label:"Комментарий",name:"Comment",visible:!0,disabled:!0,readonly:!0,required:!0,value:PGU.timeSlotData.comment},{className:"FieldText",label:"Помещение",name:"HallTitle",visible:!0,disabled:!0,readonly:!0,required:!0,value:PGU.timeSlotData.selectedHallTitle&&""!==PGU.timeSlotData.selectedHallTitle?PGU.timeSlotData.selectedHallTitle:" - "}]}),"Payment"===context.className&&(res.items||(res.items=[]),res.items.push({className:"Panel",name:"Panel_Payment",visible:!0,items:[{className:"FieldText",label:"Номер начисления",name:"Uin",visible:!0,disabled:!0,readonly:!0,required:!0,value:PGU.payData.uin},{className:"FieldText",label:"Назначение платежа",name:"PaymentPurpose",visible:!0,disabled:!0,readonly:!0,required:!0,value:PGU.payData.paymentPurpose},{className:"FieldText",label:"Получатель",name:"Recipient",visible:!0,disabled:!0,readonly:!0,required:!0,value:PGU.payData.recipientTitle},{className:"FieldText",label:"Сумма",name:"Sum",visible:!0,disabled:!0,readonly:!0,required:!0,value:PGU.payData.sum},{className:"FieldText",label:"Сумма со скидкой",name:"SumWithDiscount",visible:!0,disabled:!0,readonly:!0,required:!1,value:PGU.payData.sumWithDiscount}]})),context.generatePlayerJson&&context.generatePlayerJson(res)}var form=api.getForm()[0],result={};findElementByName(form,result);var modifierByClassName={FieldRadio:function(){this.value&&this.textValue||(this.visible=!1),this.sex&&(this.label=this.label||"Пол")},Fias:function(){this.label&&this.label.length&&160===this.label.charCodeAt(0)&&(this.label="")},FieldMapWithList:function(){var root=api;this.lable="";var path=root.find(this.context.fullPath).pdf;this.value=path&&path.selectedElement.title?path.selectedElement.title:"",this.context="",api.env("serviceFormInfo").election&&path&&(this.items=[],this.items.push({title:"Адрес помещения для голосования",value:path.tempItemData.addressP,className:"FieldText"}))},FieldMapWithListDC:function(){this.label="",this.title="",this.className="Panel";var newView=this.context.isNewView,priorityKey=newView?"priorityNumber":"priority";this.items=this.context.selectedItems.map(function(item){var oldTitle=1===item.priority?"Приоритетный детский сад":"Альтернативный детский сад",res={
title:newView?"Детский сад":oldTitle,value:item.title,className:"FieldText"};return res[priorityKey]=item[priorityKey],res}).sort(function(a,b){return a[priorityKey]-b[priorityKey]}),this.context=""},Label:function(){if(this.context.showInPdf){this.className="FieldText";var div=document.createElement("div");div.innerHTML=this.context.text,this.value=div.innerText}this.context=""}},recTree=function(item){modifierByClassName[item.className]&&modifierByClassName[item.className].call(item),item.items&&item.items.length&&item.items.forEach(function(el){recTree(el)})};return recTree(result),result},generateServerPdf:function(){var self=this,df=$q.defer(),env=self.env(),isChief=api.env("isChief");if(this.env("ipshService")&&df.resolve("ipsh"),this.env("EsepResult")&&"-1"!==this.env("EsepResult")||void 0!==isChief&&!isChief)df.resolve();else{var form=self.getForm(),request={orderId:env.orderId,draftVersion:this.env("draftVersion"),snapshot:angular.toJson(this.generateFullJson())};!1===form[0].needLoadDraft?request.form={mnemonic:env.formMnemonic,version:"12345",content:apiInner.getFormDraft(form)}:request.draftId=this.env("draftId"),$rootScope.settings.isIncomingWidget?self.__getSuggestsForDraft($rootScope.settings._needCustomDraftRequest).then(function(){var customRequest,customUrl="";$rootScope.settings._needCustomDraftRequest&&(customRequest=self.getCustomDraftRequest(apiInner.getFormDraft(form),$rootScope.settings._needCustomDraftRequest)),$rootScope.settings._customPushUrl&&(customUrl=$rootScope.settings._customPushUrl),sharedExtServices.formsService.saveSnapshotFormPdfPush(customRequest||request,self.env("formMnemonic"),self.env("targetId"),customUrl).then(function(data){if(data)if(data.error&&4005===data.error.code)checkValidationErrors(api.find(),"submit",data.validationErrors);else if(customUrl&&data.error&&data.error.code)switch(data.error.code){case 2:var error=self.getPathForErrors(data.errorField,$rootScope.settings._needCustomDraftRequest);checkValidationErrors(api.find(),"submit",{validationErrors:{content:error}});break;case 4:self.handleError({code:"qrError"});break;default:self.handleError()}else markDeletedDraft={},df.resolve({id:data.orderId})},function(error){df.reject(error),api.env("stackOfFormSubmit",[]),api.handleError(error)})}):sharedExtServices.formsService.saveSnapshotFormPdf(request,self.env("formMnemonic")).then(function(data){df.resolve(data)},function(error){df.reject(error),api.env("stackOfFormSubmit",[]),api.handleError(error)})}return df.promise.done=df.promise.then,df.promise},checkPathOnAttr:function(path,data){var value="",splitPath=path.split("|"),elemInDraft=data[splitPath[0]];return elemInDraft?value=splitPath.length>1?"form.FormStep_TimeToLeaveHome.Panel_TimeToLeaveHome.Panel_Time.FieldDropdown_Time"===splitPath[0]&&"9"===elemInDraft.value?"12:00":elemInDraft[splitPath[1]]:elemInDraft.value:value},getCustomDraftRequest:function(draft,map){var result={},self=this;for(var k in map)if(map.hasOwnProperty(k))if("string"!=typeof map[k]){result[k]={};for(var j in map[k])map[k].hasOwnProperty(j)&&(result[k][j]=self.checkPathOnAttr(map[k][j],draft))}else result[k]=self.checkPathOnAttr(map[k],draft);return result},getPathForErrors:function(error,map){var result={},path="";return error&&(path="series"===error?map.document[error]&&map.document[error].split("|")[0]:"reason"===error?map[error].code&&map[error].code.split("|")[0]:map[error]&&map[error].split("|")[0]),path&&(result[path]={}),result},handleError:function(error,adviceInPopup,attr){if(!$rootScope.siaWebHost){var rs=$rootScope.settings;$rootScope.siaWebHost=rs&&rs.siaWebHostEdit?rs.siaWebHostEdit:CONFIG.ESIA_LK}var errorCode,formattedError,code="",permissionIconCode=["al10_not_supported_al20","al15_not_supported_al20","user_mobile_phone_required"],iconType="";code=error?error.code?error.code:error.status?error.status:error.errorCode?error.errorCode:"default":"default",errorCode=code.toString(),~permissionIconCode.indexOf(errorCode)&&(iconType="Perms"),attr&&(FORM_ERRORS[errorCode]={title:error.message,message:error.hint,iconType:iconType,ruleMessage:error.ruleMessage||""});var msg=FORM_ERRORS[errorCode]?FORM_ERRORS[errorCode]:FORM_ERRORS.default;"4003"!=errorCode&&"4004"!=errorCode||(formattedError={title:msg,message:" "}),"1401"==errorCode&&(error.esepError=!0),"submitError"===errorCode?formattedError={title:msg.title,message:msg.message[0]+' <a href="'+api.env("lkUrl")+'notifications?type=DRAFT">'+msg.message[1]+"</a> "+msg.message[2]}:"draftListError"===errorCode?formattedError={title:msg.title,message:msg.message[0]+' <a href="'+(api.env("context_uri")||"/")+'feedback">'+msg.message[1]+"</a>"+msg.message[2]}:msg.title&&msg.message&&(formattedError={title:msg.title,message:msg.message}),api.env("isNeedCaptcha")&&3003===error.originalCode?($rootScope.captchaPlugin.setError(),PGU.Events.publish(":wrongCaptchaAnswer")):adviceInPopup||error&&error.esepError?(api.showPopupAndAdvice(formattedError||msg,error&&error.esepPreviewError),api.shade(!1)):("attributeRuleForTest"!==errorCode&&api.showAdvice(formattedError||msg),api.shade(!1),$timeout(function(){api.shade(!1)}))},finalSubmit:function(){var self=this,isChief=api.env("isChief"),systemData=$rootScope.env.systemData;self.shade(!0),systemData&&systemData.signCnt&&+systemData.signCnt>1&&systemData.isOwner&&"true"!==systemData.isOwner?!self.env("supportSignature")||self.env("supportSignature")&&self.env("EsepResult")&&"-1"!==self.env("EsepResult")&&!self.env("editFormAfterEsep")?sharedExtServices.signConfirm(function(){var rUrl=api.env("rURL");rUrl?api.link(rUrl+"/details?elementId="+api.env("orderId")+"#_results"):api.link(api.env("lkUrl")+"notifications/details/ORDER/"+api.env("orderId"))},function(data,response){data=data||{},void 0===data.code||data.code&&(data.code<1400||data.code>1403)?(data.code=data.status&&409===data.status||409===response.status?"1401":"submitError",data.hideForm=!0):data.esepError=!0,self.env("supportSignature")&&self.env("EsepResult","-1"),self.handleError(data)}):self.generateHtml():self.env("supportSignature")&&(void 0===isChief||isChief)?self.env("EsepResult")&&"-1"!==self.env("EsepResult")&&!self.env("editFormAfterEsep")?self.submitForm():self.generateHtml():self.submitForm()},submitForm:function(){if(!$rootScope.esep.btnSubmitForm.isLoad){!0===$rootScope.esep.show&&($rootScope.esep.show=!1);var self=this,form=this.find(),callback={done:function(data){var finalLink,notifySMU=api.env("notifySMU");"function"==typeof notifySMU?notifySMU({eventType:"submitForm",eventParams:[{key:"orderId",value:api.env("orderId")},{key:"formMnemonic",value:api.env("formMnemonic")},{key:"targetId",value:api.env("targetId")}]}):(finalLink=self.env("rURL")?self.env("rURL")+"/details?elementId="+self.env("orderId")+"#_results":self.env("lkUrl")+"notifications/details/ORDER/"+self.env("orderId"),self.link(finalLink))},error:function(data){data=data||{},void 0===data.code||data.code&&(data.code<1400||data.code>1403)?(data.code="submitError",data.hideForm=!0):data.esepError=!0,self.env("supportSignature")&&self.env("EsepResult","-1"),self.handleError(data)}};if(PGU.Events.publish(":submitForm"),self.env("stackPopup")&&self.env("stackPopup").length){var tmpSP=[];self.env("stackPopup").forEach(function(val){val.ui.showESIAPopup&&tmpSP.push(val)}),tmpSP.length&&(self.env("stackPopup",tmpSP),self.env("stackPopup")[0].ui.popupShowDefer=self.env("stackPopup")[0].ui.showESIAPopup,$rootScope.$applyAsync())}var deferSubmit=self.env("deferSubmit")||$q.defer(),withOutDef=!1;self.env("stackDefer")&&self.env("stackDefer").length||(withOutDef=!0),deferSubmit.promise.then(function(){if("0"!==self.env("EsepResult"))self.generateServerPdf().then(function(data){self.saveDataInEsia(function(){form.submit("submit",0,callback,"final")})},function(error){self.handleError(error,!0)});else{var pathToFinalHandler=form.pathToFinalHandler(),btn=api.find(pathToFinalHandler);if(pathToFinalHandler&&pathToFinalHandler.length&&btn.element.handlers.length){var eventAttrs={component:btn,oldValue:{},newValue:{}};$rootScope.mainLoader.__shadeCounter=1,api.shade(!1),api.triggerHandler(pathToFinalHandler,pathToFinalHandler,btn.element.handlers[0],eventAttrs)}else self.saveDataInEsia(function(){form.submit("submit",0,callback,"final")})}}),withOutDef&&deferSubmit.resolve("notPopup"),$q.all(self.env("stackDefer")).then(function(){deferSubmit.resolve("allPopup")})}},beforeSubmit:function(defer,showPopup){function showNext(){stackPopup[l]&&(stackPopup[l-1].ui.popupShowDefer=!1,stackPopup[l].ui.popupShowDefer=stackPopup[l].ui.showESIAPopup)}var self=this,stack=self.env("stackDefer")||[],stackPopup=self.env("stackPopup")||[];stack.push(defer.promise),stackPopup.push(showPopup),self.env("stackDefer",stack),self.env("stackPopup",stackPopup);var l=stackPopup.length;defer.promise.then(showNext)},getFinalEvent:function(events){var items,item,result={};for(var k in events)if(events.hasOwnProperty(k)){items=events[k];for(var i=0,il=items.length;i<il;i++)item=items[i],void 0!==item.submitType&&"FINAL"===item.submitType&&(result.event=item,result.number=i,result.eventType=item.eventType)}return result},generateHtml:function(){var self=this,form=this.getForm(),env=self.env();!$rootScope.settings.autosaveDisabled&&$rootScope.haveUploaders&&(api.addRequestToQueue(self.removeHiddenUploaders),self.uploadDraft());var isChief=self.env("isChief");if(void 0!==isChief&&!isChief)return void self.submitForm();api.checkSmsConfirmValid(),api.checkCaptchaValid(),api.checkSmsConfirmValid(),api.__checkSignBeforeSubmit&&api.__checkSignBeforeSubmit();var selectedRegionData=env.userSelectedRegionData,finalEvent=self.getFinalEvent(form[0].submitEvents),request={data:{form:{mnemonic:env.formMnemonic,version:"12345",content:apiInner.getFormDraft(self.getForm(),markDeletedDraft,toMarkDeletedRuntime,toMarkDeleted)},orderId:env.orderId,draftId:+env.draftId,targetId:$rootScope.settings.serviceTargetExtId||$rootScope.settings.targetId,submitComponent:form[0].name||"__form",submitEventNumber:finalEvent.number,submitEvent:finalEvent.eventType,userSelectedRegion:selectedRegionData&&selectedRegionData.code?selectedRegionData.code:"00000000000",pdfInfo:angular.toJson(self.generateFullJson())}};api.addRequestToQueue(function(defer){sharedExtServices.formsService.prepareEsepPreview(request,env.formMnemonic).then(function(data){defer.resolve(),markDeletedDraft={},$window.location=data.url},function(error){defer.resolve(),(error||{}).esepPreviewError=!0,self.handleError(error,!0)})})},removeHiddenUploaders:function(defer){var self=api,form=self.getForm(),removeDefArray=[];apiInner.loopThroughTheTree(form,function(items,item){"FieldUpload"==item.className&&item.files&&item.files.length&&!self.find(item.fullPath).inheritedVisibility()&&item.files.forEach(function(file){file.removeDef=$q.defer(),removeDefArray.push(file.removeDef.promise),sharedExtServices.imageEditor.removeImage($rootScope.env.orderId,file.mnemonic,function(data){file.removeDef.resolve()},function(error){file.removeDef.resolve()}),delete self._FormHash[file.mnemonic]})}),$q.all(removeDefArray).then(function(){defer.resolve()})},createPreviewJson:function(item){var self=this,tmp={};return!!item.visible&&(item.toJSON?item.toJSON():(item.title&&(tmp.title=item.title),item.label&&(tmp.label=item.label),item.value?tmp.value=item.value:tmp.value="Не заполнено","FieldDropdown"===item.className&&(item.text_value?tmp.value=item.text_value:tmp.value="Не выбрано"),"FieldRadio"===item.className&&item.text&&(tmp.value=item.text),"FieldCheckbox"===item.className&&(tmp.value="true"===item.value?"да":"нет"),"FieldText"===item.className&&item.saveWithMask&&""!==item.theMaskValue&&(tmp.value=item.value),"Label"!==item.className&&"FormButton"!==item.className||(tmp.value="",tmp.label=""),"FormStep"!==item.className&&"Panel"!==item.className&&"DataGrid"!==item.className||(tmp.elements||(tmp.elements=[]),"FormTable"===item.className?tmp.elements.push(item.previewTable()):item.items&&item.items.length&&angular.forEach(item.items,function(item,ind){tmp.elements.push(self.createPreviewJson(item)),"Panel"===item.className||item.className})),"DataGrid"===item.className&&(tmp.elements||(tmp.elements=[]),tmp.value="",tmp.label=""),"TimeSlot"===item.className&&(item.value?tmp.value=item.value+". Уникальный идентификатор брони: "+item.reservUuid:tmp.value="Не выбрано",tmp.label="Время брони"),"ImageEditor"===item.className&&(item.mnemonic&&!item.imageEditorError&&(tmp.imgUrl=ENV.context_uri+"fupload/doFileDownload?mnemonic="+item.mnemonic+"&orderId="+(self.env("orderId")?self.env("orderId"):null)),item.immutable&&(tmp.value="Не заполнено")),"FieldMap"===item.className&&item.value&&(PGU.Events.publish("needShowMap",item),tmp.hasMap=item.fullName+"preview"),tmp))},step:function(step,editableMode,disabledScroll){var steps,cStep,self=this,stepValid=!0,currentStepInd=this._currentStep||0,stepIsBoolean=api.checkTypeOf("Boolean",step),isEdit=stepIsBoolean&&step||editableMode;return void 0===step?(steps=this.getVisibleSteps(),steps&&steps.length&&(cStep=api.find(steps[currentStepInd].step.fullPath),currentStepInd+1===steps.length&&!isEdit&&void 0===disabledScroll)?(stepValid="FormStep"!==cStep.element.className||cStep.validate(),stepValid?currentStepInd:currentStepInd+1):currentStepInd):stepIsBoolean&&step?currentStepInd:$timeout(function(){return function(cntx,editableMode,disabledScroll){var form=cntx.getForm()[0],navPanel=cntx.findNavPanel(),btn=navPanel&&navPanel.items.find(function(item){return"next"===item.action}),btnLabel="Далее",isChief=api.env("isChief"),fullPathToStep="",steps=cntx.getVisibleSteps();if(steps&&steps.length&&(!steps[0].step||!steps[0].step.name||"signature"!==steps[0].step.name)){var stepsLength=steps.length,currentStepIndex=editableMode?cntx.step(editableMode):disabledScroll?cntx.step(void 0,!1,disabledScroll):cntx.step(),currentStep=steps[currentStepIndex].step;void 0!==cntx._previousStep&&cntx._previousStep>-1&&!editableMode&&cntx._previousStep>step&&(step=cntx._previousStep);var nextStep=steps[step].step,supportSignature=api.env("supportSignature");form.visibleStep=step;var el=currentStep.apiElem||api.find(currentStep.fullPath);if(step>currentStepIndex&&!el.validate())return!1;if("signature"===nextStep.name)return void cntx.finalSubmit();angular.equals(currentStep,nextStep)||cntx.toggleDisabledStep(nextStep,!1),steps.splice(step,steps.length);for(var i=0,il=steps.length;i<il;i++)cntx.toggleDisabledStep(steps[i].step,!0),steps[i].step.disabled=!0,steps[i].step.visibleStep=!0;cntx.setNumbersForSteps(steps),currentStep.disabled=!0,nextStep.visibleStep=!0,nextStep.disabled=!1,nextStep.stepNumber=step+1,cntx._currentStep=step,step+1===stepsLength&&(btnLabel=void 0===isChief||isChief?"Подать заявление":"Сохранить"),step+2===stepsLength&&supportSignature&&(btnLabel=void 0===isChief||isChief?"Перейти к подписанию формы":"Сохранить"),fullPathToStep=nextStep.UUIDFullPath?nextStep.UUIDFullPath:nextStep.fullPath,fullPathToStep&&!disabledScroll&&api.scrollTo(fullPathToStep,function(){btn&&(""===btn.label||btn.label)&&$timeout(function(){btn.label=btnLabel},0)})}}(self,editableMode,disabledScroll)},0,!1)},link:function(url){var notifySMU,isPaymentUrl,reOldUrl=/\/orders\/details\?elementId=\d+#_results/gi,reqexPayment=/^\/payment\//,self=this,link="",isIframe=this.isIframe();if(url){if(isPaymentUrl=url.match(reqexPayment),!0===api.env("serviceFormInfo").election)return this.showFinishElectionPage();if($rootScope.inOpWidget&&!isPaymentUrl&&this.showFinishPage())return;notifySMU=api.env("notifySMU"),link=reOldUrl.test(url)?self.env("rURL")?self.env("rURL")+"/details?elementId="+self.env("orderId")+"#_results":self.env("lkUrl")+"notifications/details/ORDER/"+self.env("orderId"):url;var smuEvent={eventType:"open_browser",eventParams:[{key:"url",value:link},{key:"withAuth",value:!0}]};if(isPaymentUrl){var uin=url.replace("/payment/","");smuEvent={eventType:"payment",eventParams:[{key:"uin",value:uin}]}}api.env("stackOfFormSubmit")&&api.env("stackOfFormSubmit").length?$q.all(api.env("stackOfFormSubmit").slice()).then(function(){"function"==typeof notifySMU?notifySMU(smuEvent):$rootScope.inOpWidget?isPaymentUrl?(link.replace(/^\//,""),$window.location.href=LOC.EPGU_URI+link):$window.location.href=link:isIframe?postMessage.send({redirectUrl:link}):$window.location.href=link}):notifySMU?notifySMU(smuEvent):$rootScope.inOpWidget?isPaymentUrl?(link.replace(/^\//,""),$window.location.href=LOC.EPGU_URI+link):$window.location.href=link:isIframe?postMessage.send({redirectUrl:link}):$window.location.href=link}},removeItemByMnemonic:function(mnemonic,arr){return arr.filter(function(item){return item.mnemonic!==mnemonic})},setRequired:function(required){if(!$rootScope.isDesigner){var newValidators,validators=this.validators().concat(),requiredMsg=this.attr("withCheckbox")?'Это поле необходимо заполнить или выбрать вариант "Нет"':"Поле обязательно для заполнения",validator={id:55550,message:requiredMsg,mnemonic:"required",name:"Обязательное поле",regexp:"\\s*\\S.*",shortDescription:"поле обязательно для заполнения, не пустое"};this.attr("validators",api.removeItemByMnemonic("required",validators)),this.required(required),this.isValid(!0),required&&(newValidators=this.validators().concat(validator),this.attr("validators",newValidators)),this.validate(!0)}},updateDependentFields:function(value,dependentFields,fullPath,bindAttrsOnValue,skipSome){var isValue=!!value;fullPath&&bindAttrsOnValue.length&&this.updateDependentField(fullPath,bindAttrsOnValue,isValue);for(var i=0,il=dependentFields.length;i<il;i++)this.updateDependentField(dependentFields[i].fullPath,dependentFields[i].attrs,isValue,skipSome)},updateDependentField:function(fullPath,attrs,isValue,skipSome){for(var attr,dependentValue,field=this.find(fullPath),defaultAttrs=field.attr("attrs"),i=0,il=attrs.length;i<il;i++)attr=attrs[i].attrName,dependentValue=attrs[i].dependentValue,(!skipSome||"value"!=attr&&"disabled"!=attr)&&defaultAttrs[attr]&&("boolean"===defaultAttrs[attr].type?field.attr(attr,isValue?dependentValue:!dependentValue):("string"===defaultAttrs[attr].type||"KladrDropdown"===field.element.className&&"value"===attr)&&isValue&&field.attr(attr,""));field.validate()},checkTotalAmount:function(toUpl){var deferred=$.Deferred();if($rootScope.env.totalOrderFileSize&&-1!=$rootScope.env.totalOrderFileSize){var that=this,allUploads=this.findFormItemByPropAndValues(that.getForm(),"className",["FieldUpload","ImageEditor"]),amount=0;angular.forEach(allUploads,function(o,i){that.find(o.fullPath).inheritedVisibility()&&(amount+=o.uploadedFileSize||o.uploadedAllFilesSize||+o.size)}),amount+=toUpl;var max=1024*$rootScope.env.totalOrderFileSize,result=amount<max;deferred.resolve({permission:result,max:max/1024})}else deferred.resolve({permission:!0,max:-1});return deferred.promise()},findFormItemByPropAndValues:function(formArr,propertyKey,propertyValues,fn){function filter(form,prop,val){angular.forEach(form.items,function(item){($.isFunction(item[prop])?item[prop]():item[prop])===val&&resultArr.push(item),item.items&&filter(item,prop,val)})}var resultArr=[],form=formArr[0];return propertyValues.forEach(function(value){filter(form,propertyKey,value)}),fn?fn(resultArr):resultArr},parseMinSize:function(size){var mul;if("string"==typeof size){if(size=/^([0-9]+)([mgk]?)$/.exec(size.toLowerCase().replace(/[^0-9mkg]/g,"")),mul=size[2],size=+size[1],"m"==mul)return size+" МБ";if("k"==mul)return size+" КБ"}return size+" Б"},isMobile:function(){var device=window.device;return device.mobile()||function(){var userAgent=navigator.userAgent;return!!userAgent.match(/Nexus 7/i)||!!userAgent.match(/HUAWEI MediaPad T1 8.0/i)}()||"mob"===$rootScope.version&&device.tablet()},isTablet:function(){return window.device.tablet()&&"mob"!==$rootScope.version&&function(){var userAgent=navigator.userAgent;return!userAgent.match(/Nexus 7/i)&&!userAgent.match(/HUAWEI MediaPad T1 8.0/i)}()},humanSize:function(size){var sizeInt=parseInt(size);if(0===sizeInt)return" ";switch(!0){case sizeInt<100:return sizeInt+"Б";case sizeInt>=100&&sizeInt<102400:return(sizeInt/1024).toFixed(2)+"КБ";case sizeInt>=102400:return(sizeInt/1048576).toFixed(2)+"МБ"}},fetch:function(pageNumber,callback){var elem=this.getElement();"function"==typeof elem.getList?callback?elem.getList(callback):elem.getList():"function"==typeof elem.fetchDictionaries&&(callback?elem.fetchDictionaries(pageNumber,callback):elem.fetchDictionaries())},setValueToString:function(addressString,fiasCode,okatoCode){var elem=this.getElement();"function"==typeof elem.setValueToString&&elem.setValueToString(addressString,fiasCode,okatoCode)},leadingZero:function(num){return num<10?"0"+num:num},updateDraftMsg:function(){var form=this.getForm(),date=new Date;form[0].draftUpdatedMsg=this.leadingZero(date.getDate())+"."+this.leadingZero(date.getMonth()+1)+"."+date.getFullYear()+" "+this.leadingZero(date.getHours())+":"+this.leadingZero(date.getMinutes())},getDraftTimeout:function(){return 6e4},setDraftTimeout:function(){var self=this;if($rootScope.settings.submitError)return void $timeout.cancel($rootScope.env.timeout);$rootScope.env.timeout=$timeout(function(){if($rootScope.env.timeout){if($rootScope.settings.submitError)return void $timeout.cancel($rootScope.env.timeout);self.uploadDraft()}},this.getDraftTimeout(),!1)},createItemDraftRequest:function(item,markDeletedDraft){var itemDraft,draftId=this.env("draftId"),draftVersion=this.env("draftVersion"),result={type:"ONLINE",deleteAction:[],draft:{id:draftId,version:draftVersion,fields:[]}};if(markDeletedDraft)for(var m in markDeletedDraft)markDeletedDraft.hasOwnProperty(m)&&markDeletedDraft[m].deleted&&result.deleteAction.push(m);if(item)for(var k in item)if(item.hasOwnProperty(k)){var keys=Object.keys(item[k]);item[k].hasOwnProperty("deleted")&&item[k].deleted?result.deleteAction.push(k):keys.length&&(itemDraft={},itemDraft.code=k,itemDraft.contents=keys.map(function(li,i){return{orderNumber:i,value:li+":"+item[k][li]}}),result.draft.fields.push(itemDraft))}return result},uploadDraft:function(by_timer,callback,callbackError,withShade,item,fromClonePanel){function applyServiceSaveDraft(defer){PGU.Events.publish(":saveDraft");var newDraft,equalDraftResponseCB={error:{code:0}};if(withShade&&api.shade(!0),item&&("true"!==self.env("formParam").isSaveElDraft||item.isEDGParent))return callback&&callback(),defer.resolve(),!1;item?fromClonePanel?newDraft=apiInner.getFormDraft([item],markDeletedDraft,toMarkDeletedRuntime,toMarkDeleted):"EditableDataGrid"===item.className?(newDraft={},newDraft[item.fullPath]={},angular.forEach(item.attrs,function(attr,attrName){attr["scope:sync"]&&(newDraft[item.fullPath][attrName]=item[attrName]?item[attrName].toString():item[attrName])})):newDraft=apiInner.getFormDraft([item]):newDraft=apiInner.getFormDraft(self.getForm());var systemData=$rootScope.env.systemData,isMultiple=systemData&&systemData.signCnt&&+systemData.signCnt>1,isEditAnotherUser=systemData&&systemData.editAnotherUser&&"true"===systemData.editAnotherUser;if($rootScope.disableInvitationSaveDraft)return callback&&callback(),void defer.resolve();var equalsData=angular.equals($rootScope.oldDraft,newDraft)||JSON.stringify(newDraft)===JSON.stringify($rootScope.oldDraft);if(!item&&equalsData&&!withShade&&(!isMultiple||isMultiple&&isEditAnotherUser))return self.setDraftTimeout(),callback&&callback(equalDraftResponseCB),defer.resolve(),!1;var startTime=(new Date).getTime();item?sharedExtServices.saveDraftItem(api.createItemDraftRequest(newDraft,item.markDeletedDraft||null)).then(function(dataFull){var data=dataFull?dataFull.data||{}:{};data&&!data.error||data.error&&0==data.error.code?(self.env("draftId",data.id),$rootScope.env.draftId=data.id,self.env("draftVersion",data.version),$rootScope.env.draftVersion=data.version,$rootScope.oldDraft=$rootScope.oldDraft||{},$rootScope.oldDraft.item=$rootScope.oldDraft.item||{},$rootScope.oldDraft.item.fullPath=newDraft,markDeletedDraft={},callback&&callback(data),HealthSrv.checkHealthWhenDone({type:"errorUpdateDraft",startTime:startTime,orderId:self.env("orderId"),draftId:self.env("draftId")},data)):(HealthSrv.checkHealthWhenError({type:"errorUpdateDraft",startTime:startTime,orderId:self.env("orderId"),draftId:self.env("draftId")},data),callbackError&&callbackError(data))},function(error){HealthSrv.checkHealthWhenError({type:"errorUpdateDraft",startTime:startTime,orderId:self.env("orderId"),draftId:self.env("draftId")},error),callbackError&&callbackError(error)}).finally(function(){defer.resolve()}):"true"!==self.env("formParam").isSaveElDraft?apiInner.saveDraft({orderId:self.env("orderId"),draftId:self.env("draftId"),draftVersion:self.env("draftVersion"),draft:newDraft},api).then(function(dataFull){var data=dataFull?dataFull.data||{}:{};data&&data.error&&0==data.error.code?(self.env("draftId",data.draftId),$rootScope.env.draftId=data.draftId,self.env("draftVersion",data.draftVersion),$rootScope.env.draftVersion=data.draftVersion,$rootScope.oldDraft=newDraft,self.setDraftTimeout(),self.updateDraftMsg(),markDeletedDraft={},callback&&callback(data),HealthSrv.checkHealthWhenDone({type:"errorUpdateDraft",startTime:startTime,orderId:self.env("orderId"),draftId:self.env("draftId")},data)):(HealthSrv.checkHealthWhenError({type:"errorUpdateDraft",startTime:startTime,orderId:self.env("orderId"),draftId:self.env("draftId")},data),callbackError&&callbackError(data))},function(error){HealthSrv.checkHealthWhenError({type:"errorUpdateDraft",startTime:startTime,orderId:self.env("orderId"),draftId:self.env("draftId")},error),callbackError&&callbackError(error)}).finally(function(){defer.resolve()}):defer.resolve()}var self=api;$rootScope.integrationModule||self.addRequestToQueue(applyServiceSaveDraft)},saveStepDraft:function(step){return apiInner.getFormDraft(step)},playForm:function(step,callback,needRedirect){var disabledScroll=void 0===step||0===step,self=this,watch=$rootScope.$watch("mainLoader.loadCounter",function(newV,oldV){newV<=0&&(watch(),$timeout(function(){var form=self.find(self.form[0].fullPath),docTitle=self.form[0].title;document.title=docTitle?docTitle+". "+document.title:document.title,form.submit("init"),form.attr("showAllSteps")||api.step(step||0,void 0,disabledScroll),PGU.Events.publish("FinishedLoading"),PGU.Events.publish(":formRendered"),api.find().attr("autoSetStepNumbers")&&api.setStepsLabels(),PGU.fireEvents.formRendered=!0,api.__formInitDone=!0,$rootScope.integrationModule&&$rootScope.$emit("integrationModuleDraft"),"function"==typeof callback&&callback(),needRedirect?api.finalSubmit():api.shade(!1)},100,!1))});PGU.Events.subscribe("","formRendered",function(){$rootScope.esep.btnSubmitForm.isLoad=!1})},checkEsepResult:function(){var error="";return"-1"===this.env("EsepResult")&&(error="Для заказа услуги вам необходимо подписать все документы."),error},editPreviousStep:function(step){var item,isNextStep=(this.getForm()[0],!0),steps=this.getVisibleSteps(),currentStep=step||this.step(),navPanel=this.findNavPanel(),needChangePreviousStep=!0;navPanel&&(navPanel.visible=!1);for(var i=steps.length;i--;){if(item=steps[i].step,item.editableMode){if(i!==currentStep){isNextStep=!1,api.step(i,!0),api._previousStep=needChangePreviousStep?currentStep:api._previousStep;break}steps[currentStep].step.cancelEdit(!0),needChangePreviousStep=!1}isNextStep&&(item.visibleStep=!1)}},triggerNextStep:function(cancelHandler){var engineVersion=api.env("engineVersion"),navPanel=this.findNavPanel(),navButton=navPanel.items||[],withCallBack=!1,FormPlayer=api,func="";navButton.forEach(function(button){"next"==button.action&&(func=eval("(function() {return "+button.handlers[0].handler.toString()+";})()"))}),func||!DEFAULT_NAVIGATION_HANDLERS[engineVersion]&&!DEFAULT_NAVIGATION_HANDLERS.EnginePlayerPgu||(withCallBack=!0,func=eval("(function() {return "+DEFAULT_NAVIGATION_HANDLERS[engineVersion].next.toString()+";})()")),func&&!cancelHandler?withCallBack?func.call(api,function(){navPanel.visible=!0}):(func.call(api),navPanel.visible=!0):navPanel.visible=!0},findNavPanel:function(){return this.getForm()[0].items.find(function(item,ind){return"NavPanel"===item.className})},toggleDisabledStep:function(step,disabled){disabled&&!1===step.disabled?(step.__disabled={},apiInner.loopThroughTheTree(step.items,function(items,item){!0!==item.disabled&&(step.__disabled[item.fullPath]=!0,item.disabled=disabled)})):apiInner.loopThroughTheTree(step.items,function(items,item){step.__disabled&&step.__disabled[item.fullPath]&&(item.disabled=disabled)})},addAxles:function(){var elem=this.getElement();"AutomotiveAxles"===elem.className&&elem.addAxles()},removeAxles:function(){var elem=this.getElement();"AutomotiveAxles"===elem.className&&elem.removeAxles()},crateApiElement:function(el){return new apiElement(el)},saveDataESIA:function(){var elem=this.getElement();"FieldInn"===elem.className&&elem.saveDataESIA()},afterSetValue:function(value,oldValue){void 0!==oldValue&&!!value!=!!oldValue&&"function"==typeof this.isAnswer&&this.isAnswer()&&PGU.Events.publish(":updateProgressBar",{value:!!value}),oldValue!=value&&this.parent()&&api.afterMemberChanged(this.parent().element,this.element.fullPath,"value",value,oldValue,this.element)},afterMemberChanged:function(controlParent,controlPath,attrName,newAttrValue,oldAttrValue,control,isAddClone){if(!$rootScope.isDesigner){var applyRulesFunc=function(rules){if("Form"===controlParent.className)apiInner.applyRules(controlParent,controlPath,attrName,rules);else{var formName=self.form[0].name;apiInner.applyRules(controlParent,controlPath.replace(formName?formName+".":"",""),attrName,rules)}};api._afterMemberChangedLazy=api._afterMemberChangedLazy||{};var apiControl,self=this;apiControl=controlParent.name?self.find(controlParent.fullPath):"Form"===controlParent.className?api.find():controlParent.apiElem;var rules,apiControlParent=apiControl.parent(),needApply=!0;if(_isFirstTimeFiredRulesMap.includes(controlParent.fullPath)){_parentControlAttrRules[controlParent.fullPath]&&_parentControlAttrRules[controlParent.fullPath][controlPath]&&_parentControlAttrRules[controlParent.fullPath][controlPath][attrName]?rules=_parentControlAttrRules[controlParent.fullPath][controlPath][attrName]:needApply=!1}else _isFirstTimeFiredRulesMap.push(controlParent.fullPath),rules=controlParent.rules,needApply=controlParent.rules&&controlParent.rules.length;if(needApply&&(api._afterMemberChangedLazy[controlPath]=api._afterMemberChangedLazy[controlPath]||{},api._afterMemberChangedLazy[controlPath][attrName]=newAttrValue,PGU.fireEvents.formRendered?applyRulesFunc(rules):$rootScope.$on(":formRendered",function(){applyRulesFunc(rules)})),"Form"===apiControl.element.className&&$rootScope.mainLoader.loadCounter<=0&&($timeout.cancel(initValidate),initValidate=$timeout(function(){$rootScope.$applyAsync(function(){apiControl.validate(!0)})},200,!1)),"name"===attrName&&void 0!==oldAttrValue&&(control.hasRules||""!==oldAttrValue)){var newControlPath=(controlPath.substr(0,controlPath.length-oldAttrValue.length)+newAttrValue).replace(/\.$/,"");controlParent.rules.forEach(function(rule,i){var newRule=rule.toString().replace(RegExpCompiled.rulesChangeOld,function(full,symbol,path,attr){var subPath=path.substr(controlPath.length+(oldAttrValue&&1)).replace(/^(.+)$/,".$1"),replacePath=(newControlPath+subPath).replace(/^\./,"");if(apiControl.find(path))return full;if(control.hasRules){if(!oldAttrValue){if(self.find(control.fullPath).find(subPath.slice(1))&&!apiControl.find(path))return symbol+replacePath+attr}if(!newAttrValue&&0==path.indexOf(controlPath))return symbol+replacePath+attr}return 0==path.indexOf(controlPath)?symbol+replacePath+attr:full});controlParent.rules[i].toString()!=newRule&&(controlParent.rules[i]=rule._make(newRule))})}
apiControlParent&&!apiInner.isEmptyObject(apiControlParent)?self.afterMemberChanged(apiControlParent.element,controlPath,attrName,newAttrValue,oldAttrValue,control,isAddClone):"Form"===controlParent.className&&controlParent.name&&-1==controlPath.indexOf(controlParent.name)&&self.afterMemberChanged(controlParent,controlParent.name+"."+controlPath,attrName,newAttrValue,oldAttrValue,control,isAddClone)}},saveDataInEsia:function(callback,need){var esiaDefer=$q.defer();esiaDefer.promise.then(callback),pguEsiaData.getFilteredData().then(function(){if(apiInner.loopThroughTheTree(api.getForm(),function(items,item){pguEsiaData.checkStrategyItem(item,0)}),!need)return void PGU.Events.publish(":saveEsiaData",esiaDefer);api.handlerSaveDataInEsia(),PGU.Events.publish(":saveEsiaData",esiaDefer)})},handlerSaveDataInEsia:function(){if(api.find().esiaDataForSave([]),PGU.EsiaStrategyField&&PGU.EsiaStrategyField.length){Object.keys(PGU.EsiaStrategyField).forEach(function(key){PGU.EsiaStrategyField[key]&&PGU.EsiaStrategyField[key].length&&Object.keys(PGU.EsiaStrategyField[key]).forEach(function(itemKey){var item=PGU.EsiaStrategyField[key][itemKey];if(item.item.value&&item.item.value!==item.initState&&api.find(item.item.fullPath).inheritedVisibility()&&api.esia[key])switch(key){case"address_reg_fias":case"address_reg_kladr":api.esia[key](api.find(item.item.fullPath),"PRG");break;case"address_live_kladr":case"address_live_fias":api.esia[key](api.find(item.item.fullPath),"PLV");break;default:api.esia[key](item.item.value)}})})}if(PGU.EsiaSuggestField&&PGU.EsiaSuggestField.length){var keySuggest=Object.keys(PGU.EsiaSuggestField);keySuggest.forEach(function(key){var realKey=key;if(key=key.replace(/\[\d*\]/g,""),PGU.EsiaSuggestField[key]&&PGU.EsiaSuggestField[key].length)switch(key){case"kid_data":var resObj={},nameSG="",need=!1;Object.keys(PGU.EsiaSuggestField[realKey]).forEach(function(item){Object.keys(PGU.EsiaSuggestField[realKey][item]).forEach(function(field){if(nameSG=item.split("."),api.find(field).inheritedVisibility()){var value=api.find(field).value();resObj[nameSG[nameSG.length-2]]=value,value&&PGU.EsiaSuggestField[realKey][item][field].initState!==value&&(need=!0)}})}),need&&api.esia.kid_data(resObj);break;case"vehicle":var resObj={},nameSG="",need=!1,can=!1;Object.keys(PGU.EsiaSuggestField[realKey]).forEach(function(item){var nameSGtmp=item.split("."),nameSGStrtmp=nameSGtmp[nameSGtmp.length-2]||"";"regdoc_serial"!==nameSGStrtmp&&"regdoc_number"!==nameSGStrtmp&&"regmark"!==nameSGStrtmp||(can=!0)}),Object.keys(PGU.EsiaSuggestField[realKey]).forEach(function(item){nameSG=item.split(".");var nameSGStr=nameSG[nameSG.length-2]||"";Object.keys(PGU.EsiaSuggestField[realKey][item]).forEach(function(field){resObj[nameSGStr]=api.find(field).value(),api.find(field).inheritedVisibility()&&(resObj[nameSGStr]=api.find(field).value(),api.find(field).value()&&PGU.EsiaSuggestField[realKey][item][field].initState!=api.find(field).value()&&can&&(need=!0))})}),need&&api.esia.car(resObj.regmark,resObj.name,resObj.regdoc_serial,resObj.regdoc_number);break;case"zg_passport":var resObj={},nameSG="",need=!1;Object.keys(PGU.EsiaSuggestField[key]).forEach(function(item){Object.keys(PGU.EsiaSuggestField[key][item]).forEach(function(field){nameSG=item.split("."),api.find(field).inheritedVisibility()&&(resObj[nameSG[nameSG.length-2]]=api.find(field).value(),api.find(field).value()&&PGU.EsiaSuggestField[key][item][field].initState!=api.find(field).value()&&(need=!0))})}),need&&api.esia.foreignpassport({lastname:resObj.lastName||"",firstname:resObj.firstName||"",series:resObj.serial||"",number:resObj.number||"",issuedate:resObj.iss_date||"",validdate:resObj.exp_date||"",issueorg:resObj.issued||""});break;case"polis_oms":var resObj={},nameSG="",need=!1;Object.keys(PGU.EsiaSuggestField[key]).forEach(function(item){Object.keys(PGU.EsiaSuggestField[key][item]).forEach(function(field){nameSG=item.split("."),api.find(field).inheritedVisibility()&&(resObj[nameSG[nameSG.length-2]]=api.find(field).value(),api.find(field).value()&&PGU.EsiaSuggestField[key][item][field].initState!=api.find(field).value()&&(need=!0))})}),need&&api.esia.medicalpolicy({number:resObj.serial?resObj.serial+" "+resObj.number:resObj.number,expiryDate:resObj.validdate||""})}})}if(PGU.EsiaGroupStartegyField&&PGU.EsiaGroupStartegyField.length){var keySuggest=Object.keys(PGU.EsiaGroupStartegyField);keySuggest.forEach(function(key){if(PGU.EsiaGroupStartegyField[key]&&PGU.EsiaGroupStartegyField[key].length)switch(key){case"foreignpassport":var resObj={},nameGST="",need=!1;Object.keys(PGU.EsiaGroupStartegyField[key]).forEach(function(item){Object.keys(PGU.EsiaGroupStartegyField[key][item]).forEach(function(field){nameGST=item.split("_")[1],api.find(field).value()&&PGU.EsiaGroupStartegyField[key][item][field].initState!=api.find(field).value()&&api.find(field).inheritedVisibility()&&(need=!0),resObj[nameGST]=api.find(field).value()})}),need&&api.esia.foreignpassport(resObj);break;case"birthcert":var resObj={},nameGST="",need=!1;Object.keys(PGU.EsiaGroupStartegyField[key]).forEach(function(item){Object.keys(PGU.EsiaGroupStartegyField[key][item]).forEach(function(field){nameGST=item.split("_")[1],api.find(field).value()&&PGU.EsiaGroupStartegyField[key][item][field].initState!=api.find(field).value()&&api.find(field).inheritedVisibility()&&(need=!0),resObj[nameGST]=api.find(field).value()})}),need&&api.esia.birthcert(resObj);break;case"militarydoc":var resObj={},nameGST="";Object.keys(PGU.EsiaGroupStartegyField[key]).forEach(function(item){Object.keys(PGU.EsiaGroupStartegyField[key][item]).forEach(function(field){nameGST=item.split("_")[1],api.find(field).value()&&PGU.EsiaGroupStartegyField[key][item][field].initState!=api.find(field).value()&&api.find(field).inheritedVisibility()&&(need=!0),resObj[nameGST]=api.find(field).value()})}),need&&api.esia.militarydoc(resObj);break;case"medicalpolicy":var resObj={},nameGST="",need=!1;Object.keys(PGU.EsiaGroupStartegyField[key]).forEach(function(item){Object.keys(PGU.EsiaGroupStartegyField[key][item]).forEach(function(field){nameGST=item.split("_")[1],api.find(field).value()&&PGU.EsiaGroupStartegyField[key][item][field].initState!=api.find(field).value()&&api.find(field).inheritedVisibility()&&(need=!0),resObj[nameGST]=api.find(field).value()})}),need&&api.esia.medicalpolicy(resObj);break;case"driverlicense":var resObj={},nameGST="",need=!1;Object.keys(PGU.EsiaGroupStartegyField[key]).forEach(function(item){Object.keys(PGU.EsiaGroupStartegyField[key][item]).forEach(function(field){nameGST=item.split("_")[1],api.find(field).value()&&PGU.EsiaGroupStartegyField[key][item][field].initState!=api.find(field).value()&&api.find(field).inheritedVisibility()&&(need=!0),resObj[nameGST]=api.find(field).value()})}),need&&api.esia.driverLicense(resObj.series,resObj.number,resObj.issuedate,resObj.validtill);break;case"vehicle":var resObj={},nameGST="",need=!1;Object.keys(PGU.EsiaGroupStartegyField[key]).forEach(function(item){Object.keys(PGU.EsiaGroupStartegyField[key][item]).forEach(function(field){nameGST=item.split("_")[1],api.find(field).value()&&PGU.EsiaGroupStartegyField[key][item][field].initState!=api.find(field).value()&&api.find(field).inheritedVisibility()&&(need=!0),resObj[nameGST]=api.find(field).value()})}),need&&api.esia.car(resObj.number,resObj.name,resObj.certificateseries,resObj.certificatenumber)}})}},hidePreview:function(value){return api.find().hidePreview(value)},addRequestToQueue:function(applySevice){var lastSubmitPromise,defer=$q.defer(),stack=api.env("stackOfFormSubmit")||[];stack.length&&(lastSubmitPromise=stack[stack.length-1]),stack.push(defer.promise),api.env("stackOfFormSubmit",stack);var callback=applySevice.bind(null,defer);lastSubmitPromise?lastSubmitPromise.finally(callback):callback()},cleanMnemonicHintHtml:function(msg){var re=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,cleanedStr=msg.replace(re,""),$div=$("<div/>");return $div.html(cleanedStr),$div.find("[data-dynamic-href]").each(function(ind,item){var dynamicHrefParts,$this=$(item),dynamicHref=$this.data("dynamicHref");if(dynamicHref&&($this.prop("onclick",null),dynamicHrefParts=dynamicHref.split(":"),dynamicHrefParts.length&&$this.attr("href",api.env(dynamicHrefParts[0])+(dynamicHrefParts.length>1?dynamicHrefParts[1]:"")),"lkUrl:notification-setup"==dynamicHref)){var notifySMU=api.env("notifySMU");"function"==typeof notifySMU&&$(document).one("click","[data-dynamic-href]",function(evt){evt.preventDefault(),notifySMU({eventType:"smuOpenScreen",eventParams:[{key:"screen",value:"PushOptions"}]})})}}),$div.html()},addToXml:function(value){this.element.addToXml=value},getFieldByAttrValue:function(item,attrs,values,getParent){function checkField(item){for(var count=0,i=0;i<attrs.length;i++)values[i].forEach(function(value){item[attrs[i]]===value&&count++});return count==attrs.length}var eachAttr;if(attrs=Array.isArray(attrs)?attrs:[attrs],values=Array.isArray(values)?values:[values],values=values.map(function(value,index){return Array.isArray(value)?(eachAttr=eachAttr||attrs[0],value):(eachAttr=eachAttr||attrs[index],[value])}),attrs.length===values.length){var result={};!function eachFields(element,parent){checkField(element)?getParent?(result[element[eachAttr]]=result[element[eachAttr]]||{},result[element[eachAttr]].parent=result[element[eachAttr]].parent||[],result[element[eachAttr]].element=result[element[eachAttr]].element||[],result[element[eachAttr]].parent.push(parent),result[element[eachAttr]].element.push(element)):(result[element[eachAttr]]=result[element[eachAttr]]||[],result[element[eachAttr]].push(element)):element.items&&element.items.forEach(function(item){eachFields(item,element)})}(item);for(var key in result)getParent?(result[key].parent.length<2&&(result[key].parent=result[key].parent[0]),result[key].element.length<2&&(result[key].element=result[key].element[0])):result[key].length<2&&(result[key]=result[key][0]);return result}},replacePersonalData:function(form,fullPath){function checkArray(oldItem,newItem,callback){var parent,oldEl,newEl,isArray=Array.isArray(oldItem.element);if(isArray)for(var index=0;index<oldItem.element.length;index++)parent=oldItem.parent&&oldItem.parent[index]||void 0,oldEl=oldItem.element&&oldItem.element[index]||void 0,newEl=newItem&&newItem[index]||void 0,callback(parent,oldEl,newEl,isArray,index);else parent=oldItem.parent,oldEl=oldItem.element,newEl=newItem,callback(parent,oldEl,newEl)}$rootScope.env=$rootScope.env||{},$rootScope.env.formParam=$rootScope.env.formParam||{};var disableMobOptimize=!(!$rootScope.env.formParam.Disable_mob_optim||"true"!==$rootScope.env.formParam.Disable_mob_optim);if(disableMobOptimize||($rootScope.env.formParam.mobOptimizeAll="true"),device.mobile()&&!disableMobOptimize){var changed={params:{fio:{attrs:["visible"],values:[void 0],source:form[0],getWithParent:!0,changedAttrs:[{name:"label",value:""}]},disabledFields:{getWithParent:!0,source:form[0]},passport:{attrs:["disabled"],values:[!0],getWithParent:!0,clone:!0,connect:{map:["docseries","docnumber"],label:"Паспорт РФ"},source:form[0]},issue:{attrs:["disabled"],values:[!0],getWithParent:!0,clone:!0,connect:{map:["issuedate","issueorg","issueid"],label:"Выдан"},source:form[0]},contacts:{getWithParent:!0,source:form[0],changedAttrs:[{name:"label",value:""}]},radio:{attrs:["className","sex"],values:["FieldRadio",!0],getWithParent:!0,source:form[0]}}};(function(params,options){var isNeedOptimizationByOptions=!1,newOpts={},optionsInParams={},optimizeAll="true"==options.mobOptimizeAll,categories={issue:["issuedate","issueid","issueorg"],passport:["docseries","docnumber"],disabledFields:["birthplace","inn","snils"],fio:["firstname","middlename","lastname","birthdate","fio"],contacts:["person_email","person_mobile"]};if(optimizeAll){isNeedOptimizationByOptions=!0;for(var key in categories)categories[key].forEach(function(key){newOpts[key]=!0})}else for(var key in options)if(~key.indexOf("mobOptimize")){isNeedOptimizationByOptions=!0;var newKey=key.replace("mobOptimize","").toLowerCase();newOpts[newKey]="true"==options[key]}if(!isNeedOptimizationByOptions)return isNeedOptimizationByOptions;for(var k in categories)if(categories.hasOwnProperty(k))for(var j in newOpts)newOpts.hasOwnProperty(j)&&~categories[k].indexOf(j)&&newOpts[j]&&(optionsInParams[k]=!0);for(var key in params)if(optionsInParams[key]||"radio"===key)for(var opt in newOpts)newOpts[opt]&&categories[key]&&categories[key].indexOf(opt)+1&&(params[key].attrs=params[key]&&params[key].attrs||[],params[key].values=params[key]&&params[key].values||[],params[key].attrs.indexOf("strategy")+1?params[key].values[0].unshift(opt):(params[key].attrs.unshift("strategy"),params[key].values.unshift([opt])));else params[key].attrs=[],params[key].values=[];return isNeedOptimizationByOptions})(changed.params,$rootScope.env.formParam)&&(changed.old=function(obj){var params=obj.params,old={},systemData=$rootScope.env.systemData;if(systemData&&systemData.signCnt&&+systemData.signCnt>1){var steps={firstUser:{searchingVal:$rootScope.env.user.userId},secondUser:{searchingVal:void 0}};steps.firstUser.founded=api.getFieldByAttrValue(form[0],["userId","className"],[steps.firstUser.searchingVal,"FormStep"],!0),steps.secondUser.founded=api.getFieldByAttrValue(form[0],["userId","className"],[steps.secondUser.searchingVal,"FormStep"],!0);for(var key in params)if(params[key].connect)for(var step in steps){var obj=steps[step].founded[steps[step].searchingVal]||{};obj.element&&"object"!=typeof obj.element&&obj.element.forEach(function(formStep){var element=api.getFieldByAttrValue(formStep,params[key].attrs,params[key].values,!0);apiInner.isEmptyObject(element)||(old[step+"-"+key]=element,params[step+"-"+key]=params[key],params[key].source="")})}}for(var key in params)if(params[key]&&params[key].source&&!old[key]&&params[key].attrs&&params[key].attrs.length){var source=params[key].source,attrs=params[key].attrs,values=params[key].values,getWithParent=params[key].getWithParent;old[key]=api.getFieldByAttrValue(source,attrs,values,getWithParent)}return old}(changed),changed.new=function(obj){var newElements={};for(var sub in obj.old){var connect=obj.params[sub].connect;if(obj.params[sub].clone){var subject=obj.old[sub],newSubject={},name="",lastKey=Object.keys(subject)[Object.keys(subject).length-1];for(var key in subject)checkArray(subject[key],void 0,function(parent,oldEl,newEl,isArray){name=connect&&name?name+"-"+oldEl.name:oldEl.name+"[new]";var fullPath=parent.fullPath+"."+name,newItem={name:name,fullPath:fullPath,className:oldEl.className,addToXml:!1,doNotShowInPdf:!0};isArray?(newSubject[key]=newSubject[key]||[],newSubject[key].push(newItem)):newSubject[key]=newItem,connect?key==lastKey&&parent.items&&parent.items.push(newItem):parent.items&&parent.items.push(newItem)});if(connect){var connectedSubj=newSubject[lastKey];newSubject={},newSubject[name]=connectedSubj}newElements[sub]=newSubject}}return newElements}(changed),function(obj,fullPath){var publisherPath=fullPath||"",event=fullPath?"stepRendered":"formRendered";PGU.Events.subscribe(publisherPath,event,function(){$timeout(function(){for(var sub in obj.old){var oldSubject=obj.old[sub],newSubject=obj.new[sub],params=obj.params[sub],connect=params.connect,lastKey=Object.keys(oldSubject)[Object.keys(oldSubject).length-1],newObjKey=connect&&newSubject?Object.keys(newSubject)[0]:"",map={};for(var key in oldSubject)checkArray(oldSubject[key],newSubject&&newSubject[key]||void 0,function(parent,oldEl,newEl,isArray,indexEl){newObjKey=newObjKey&&isArray?newSubject[Object.keys(newSubject)[0]][indexEl].name:newObjKey;var connectedElement,connectedElementValueMap,isAllConnectedEmpty=!0;if(connect){if(map[newObjKey]=map[newObjKey]||{},Validators.isInvalid(oldEl.validators,oldEl.value,api.formValidators)&&(oldEl.invalidPersonalData=!0),map[newObjKey][oldEl.strategy]={el:oldEl,parent:parent},key==lastKey&&(connectedElement=isArray?newSubject[Object.keys(newSubject)[0]][indexEl]:newSubject[newObjKey])){var visibilities=[];connectedElementValueMap=connect.map.filter(function(item){var element=map[newObjKey][item]&&map[newObjKey][item].el;return element&&!element.invalidPersonalData}).map(function(item){var element=map[newObjKey][item].el,connectedElementValue=element.value||"";return connectedElementValue&&(isAllConnectedEmpty=!1),visibilities.push(element.visible),"issue"===sub?'<span class="PGU-FieldText-optimized-data">'+connectedElementValue+"</span>":connectedElementValue});var someVisible=visibilities.includes(!0);!isAllConnectedEmpty&&someVisible?(connectedElement.value=connectedElementValueMap.join(" "),connectedElement.label=connect.label,parent.isText=connectedElement.isText=!0,oldEl.value&&oldEl.value.length&&oldEl.disabled&&!oldEl.invalidPersonalData&&(oldEl.visible=!1),connect.map.forEach(function(item){var element=map[newObjKey][item]&&map[newObjKey][item].el;if(element){var parentLocal=map[newObjKey][item].parent;element.forceXml||(element.forceXml=!0),element.wasOptimizedandHide=!0,parentLocal.visible&&(parentLocal.wasOptimizedandHide=!0),element.value&&element.value.length&&element.disabled&&!element.invalidPersonalData&&(parentLocal.visible=!1)}}),parent.visible||(parent.visible=!0),oldEl.visible&&(oldEl.forceXml||(oldEl.forceXml=!0),oldEl.wasOptimizedandHide=!0)):(connectedElement.visible=!1,connectedElement.label=oldEl.label)}}else params&&params.changedAttrs&&params.changedAttrs.forEach(function(changedAttr){newEl?newEl[changedAttr.name]=changedAttr.value:oldEl.value&&oldEl.value.length&&oldEl.disabled&&!oldEl.invalidPersonalData&&(oldEl[changedAttr.name+"BeforeOptimized"]=oldEl[changedAttr.name],oldEl[changedAttr.name]=changedAttr.value)}),parent.isText=oldEl.isText=!!(oldEl.value&&oldEl.value.length&&oldEl.disabled),oldEl.isText&&(oldEl.isTextSingle=!0),newEl&&(oldEl.visible&&(oldEl.forceXml||(oldEl.forceXml=!0),oldEl.wasOptimizedandHide=!0),oldEl.visible=!1)})}},200)})}(changed,fullPath))}},setSubmitBtnName:function(){var steps=api.getVisibleSteps(),navPanel=api.findNavPanel(),visibleSteps=steps.filter(function(i){if(i.step.visibleStep)return i}),stepsLength=steps.length-visibleSteps.length,supportSignature=api.env("supportSignature"),btnLabel="Далее",customLabel="Подать заявление",isChief=api.env("isChief"),btn=navPanel&&navPanel.items.find(function(item){return"next"===item.action});btn&&(btn.finalButton=btn.finalButton||!0);var hasOtherName=navPanel&&navPanel.nameButton!==navPanel.attrs.nameButton.default;btn&&btn.label&&api.env("formParam")&&"true"===api.env("formParam").activateProgressBar?customLabel=btn.label:hasOtherName&&(customLabel=navPanel.nameButton),api.env("showAllSteps")?btnLabel=void 0===isChief||isChief?supportSignature?"Перейти к подписанию формы":customLabel:"Сохранить":0===stepsLength?btnLabel=void 0===isChief||isChief?customLabel:"Сохранить":1===stepsLength&&supportSignature&&(btnLabel=void 0===isChief||isChief?"Перейти к подписанию формы":"Сохранить"),btn&&(""===btn.label||btn.label)&&(btn.label=btnLabel)},showFinishElectionPage:function(){return api.addRequestToQueue(this.addRequestToQueueCallback)},addRequestToQueueCallback:function(defer){var form;form=api.getForm()[0],form.finishPage=!0,api.applyScope(),defer.resolve(),$rootScope.mainLoader.__shadeCounter=1,api.shade(!1)},showFinishPage:function(){var result=!1;return $rootScope.inOpWidget&&($rootScope.finishPageType&&"zags_firstTime"===$rootScope.finishPageType&&($rootScope.finishPageData={title:"Приглашение отправлено второму заявителю",subTitle:"После заполнения данных второго заявителя вам понадобится оплатить пошлину и отправить черновик заявления в ведомство. Изменить приглашение и данные черновика заявления вы можете в Едином личном кабинете на портале Госуслуг. Когда второй заявитель отправит данные из своего личного кабинета, вы получите уведомление по электронной почте.",showPhone:!1,orderLkLink:$rootScope.settings.lkUrl+"notifications?type=DRAFT"}),api.addRequestToQueue(this.addRequestToQueueCallback),result=!0),result},sendReachGoal:function(event,params,metricId){var id=metricId||"",reachGoalParams=_.extend({},{platform:api.env("srcSystem")},params||{});if(window.isEmbedded&&!window["yaCounter"+id])try{window["yaCounter"+id]=new Ya.Metrika({id:id,enableAll:!0,trackHash:!0})}catch(e){}window["yaCounter"+id]&&window["yaCounter"+id].reachGoal(event,reachGoalParams)},isElectionService:function(){var result=null,envServiceFormInfo=api.env("serviceFormInfo")||$rootScope.env.serviceFormInfo||{},passCode=envServiceFormInfo.PASS_CODE,epguCode=envServiceFormInfo.EPGU_CODE;return envServiceFormInfo.election&&("169201"===passCode&&"1"===epguCode||"327605"===passCode&&"1"===epguCode)&&(result={passCode:passCode,epguCode:epguCode}),result},sendDadataReachGoals:function(){api.__dadataWidgets.forEach(function(item){item.event&&window.yaCounter&&window.yaCounter.reachGoal(item.event)})},checkLkNote:function(serviceId,orderId,callback){sharedExtServices.checkNote(serviceId,orderId,callback).finally(function(){callback&&callback.always&&callback.always()})},allFieldsDisabled:function(fullPath){var unpreferedClasses=["Form","FormStep","Panel"];Object.keys(api._FormHash).forEach(function(key){api._FormHash[key].disabled&&!(unpreferedClasses.indexOf(api._FormHash[key].element.className)+1)&&key.indexOf(fullPath)<0&&(api._FormHash[key].disabled()||(api._FormHash[key].disabled(!0),api.temporaryDisabled.push(api._FormHash[key].element.fullPath)))})},allFieldsUnDisabled:function(){(api.temporaryDisabled||[]).forEach(function(item){api.find(item)&&"function"==typeof api.find(item).disabled&&api.find(item).disabled(!1)})},openSMSConfirmDialog:function(){var df=$q.defer(),SMSConfirmDialog=api.env("SMSConfirmDialog");return SMSConfirmDialog?api.env("smsCorrect")?df.resolve():api.find(SMSConfirmDialog).element.openSMSConfirmDialog(df):df.resolve(),df.promise},clearStackOfFormSubmit:function(){api.env("stackOfFormSubmit",[]),PGU.startEsiaSave=!1,PGU.Events.publish(":showSubmitButton"),api.shade(!1)},setBookingFilters:function(response){var data=response.data,result={filterCodes:[],endDate:data.endDate||"",startDate:data.startDate||"",organizations:data.organizations};data.organizations&&data.organizations.forEach(function(item){result.filterCodes.push(item.orgId)}),$rootScope.settings.bookingFilters=result},checkCaptchaValid:function(){api.addRequestToQueue(function(defer){var isCorrectEsep=!api.env("supportSignature")||!(api.env("EsepResult")&&"-1"!==api.env("EsepResult")&&!api.env("editFormAfterEsep"));api.env("isNeedCaptcha")&&!$rootScope.env.verify_token&&isCorrectEsep?$rootScope.captchaPlugin.check(function(token){if(token){var params={verifyToken:token,orderId:api.env("orderId")};sharedExtServices.captcha.validateToken(params).then(function(response){response.result?($rootScope.env.verify_token=token,defer.resolve()):($rootScope.captchaPlugin.setError(),api.clearStackOfFormSubmit(),api.scrollTo($rootScope.pathToCaptcha.step))})}else $rootScope.captchaPlugin.setError(),api.clearStackOfFormSubmit(),api.scrollTo($rootScope.pathToCaptcha.step)}):defer.resolve()})},checkSmsConfirmValid:function(){api.addRequestToQueue(function(defer){api.openSMSConfirmDialog().then(function(){defer.resolve()},function(){api.clearStackOfFormSubmit()})})},addImageEditorToStack:function(){var imageEditor,df=$q.defer(),imageEditorInitWithValue=api.env("imageEditorInitWithValue");return imageEditorInitWithValue?(imageEditor=api.find(imageEditorInitWithValue),void 0===imageEditor.element.getImEdPromise&&(imageEditor.element.getImEdPromise=function(df){imageEditor.element.stackDefer=df}),imageEditor.element.getImEdPromise(df)):df.resolve(),df.promise},checkImageEditorInitWithValue:function(){api.addRequestToQueue(function(defer){api.addImageEditorToStack().then(function(){defer.resolve(),api.env("imageEditorInitWithValue",!1)},function(){defer.resolve(),api.env("imageEditorInitWithValue",!1)})})},getHintInitCacheData:function(mnemonicHint){if($rootScope.isDesigner)return $q.when([]);var df,codesRequest="";return api.__hintInitCacheData=api.__hintInitCacheData||[],api.__hintInitCacheCodes=api.__hintInitCacheCodes||[],api.__hintInitCacheCodes.forEach(function(item,i){item.loaded||(codesRequest+=codesRequest?"|"+item.code:item.code,item.loaded=!0)}),codesRequest&&(df=$q.defer(),api.__isHintInitCache=df.promise,sharedExtServices.hintsService.getList({code:codesRequest,group:"pgu_hint",language:"ru"}).then(function(response){var data=response.data,localizedStrings=data.localizedStrings&&data.localizedStrings.length?data.localizedStrings:[];api.__hintInitCacheData=api.__hintInitCacheData.concat(localizedStrings),df.resolve(api.__hintInitCacheData)},function(){df.resolve([])})),api.__isHintInitCache},setHintInitCacheCodes:function(code){if(code){"pgu_hint"+code+"ru",api.__hintInitCacheCodes=api.__hintInitCacheCodes||[];api.__hintInitCacheCodes.find(function(li,i){return li.code===code})||api.__hintInitCacheCodes.push({code:code})}},getSingleMandateData:function(param,callback){var df=$q.defer();ymaps&&ymaps.geocode?ymaps.geocode(param.query,{results:1}).then(function(data){if(data.geoObjects.getLength()){var coords=data.geoObjects.get(0).geometry.getCoordinates();param.latitude=coords[0],param.longitude=coords[1]}df.resolve()},function(){df.resolve()}):df.resolve(),df.promise.then(function(){sharedExtServices.ElectionService.getSingleMandateData(param).then(function(response){callback&&callback(response&&response.data)},function(){callback&&callback()})})},setOrderNote:function(orderId,text,callback){orderId&&sharedExtServices.setOrderNote(orderId,text).finally(function(){callback&&callback()})},serverValidate:function(callback){var event={eventType:"submit"},form=api.find(),doCallback=function(data,isError){callback&&(isError?callback.error&&callback.error(data):callback.done&&callback.done(data),callback.always&&callback.always())},err=function(error){doCallback(error,!0)};api.uploadDraft(!1,function(){sharedExtServices.formsService.serverValidate({isProcessor:!1,data:dataGenerate(api,!1,{},form.element,0,event),async:!0},function(data){data.error&&[4005,4007].includes(data.error.code)&&checkValidationErrors(form,event.eventType,data),markDeletedDraft={},doCallback(data)},function(error){api.env("stackOfFormSubmit",[]),doCallback(error,!0)})},err,!1)},checkInFormStepRendered:function(stepRendered,fullPath){var result;if(stepRendered)for(var i in stepRendered)stepRendered.hasOwnProperty(i)&&!stepRendered[i]&&0===fullPath.indexOf(i)&&(result={},result.fullPath=i);return result},getRestData:function(url,requestType,data,callback,withAuthHeader){url&&(requestType=requestType||"GET",callback=callback||{},sharedExtServices.getRestData(url,requestType,data,withAuthHeader).then(function(data){callback.done&&callback.done(data),callback.always&&callback.always()},function(error){callback.error&&callback.error(error),callback.always&&callback.always()}))},setStrategyForIncomingWidget:function(element){var strategy=element.strategy,data=this.getStrategyValue(element.strategy);if(("address_reg_fias"===strategy||"address_live_fias"===strategy)&&data.address)for(var l in data.address)data.address.hasOwnProperty(l)&&element.hasOwnProperty(l)&&(element[l]=data.address[l]);data.value&&(element.value=data.value)},getStrategyValue:function(strategy){if($rootScope.isDesigner)return{};if(StrategiesCache[strategy])return StrategiesCache[strategy];var fullUserData=$rootScope.originalEsiaData||{},userData=fullUserData.person||{};userData.docs=userData.docs||[];var tmp,person,address,doc,toLowKey,docType,value="",toLowStrategy=strategy.toLowerCase();if(!StrategiesCache.user_type){var userTypesMap={P:"PERSON_RF",AL10:"PERSON_LIGHT",AL15:"PERSON_CONFIRMED",F:"PERSON_FOREIGN",B:"BUSINESSMAN",L:"EMPLOYEE"};if(tmp=userTypesMap.hasOwnProperty(fullUserData.assuranceLevel)?fullUserData.assuranceLevel:fullUserData.orgType||("P"===fullUserData.userType&&"F"===fullUserData.personType?"F":fullUserData.userType),StrategiesCache.user_type={value:userTypesMap[tmp]},"user_type"===strategy)return StrategiesCache.user_type}var userType=StrategiesCache.user_type.value,docDataNames=["issuedate","issueid","issueorg","docseries","docnumber"],frgnDocMapNames={foreignpassport_issuedate:"issuedate",foreignpassport_issueorg:"issueorg",foreignpassport_series:"docseries",foreignpassport_number:"docnumber"};if(-1===Object.keys(frgnDocMapNames).indexOf(toLowStrategy)){var personFrgnDocMapNames={foreign_documentissuedate:"issuedate",foreign_documentseries:"docseries",foreign_documentnumber:"docnumber"};docType="PERSON_FOREIGN"!==userType?"RF_PASSPORT":"FID_DOC",toLowStrategy=personFrgnDocMapNames[strategy]||toLowStrategy}else docType="FRGN_PASS",toLowStrategy=frgnDocMapNames[strategy];var medicalPolicyStrategy={medicalpolicy_number:"number",medicalpolicy_validdate:"expiryDate"};if(userData){if(person=userData.person||{},"person_mobile"===strategy||"person_email"===strategy)userData.contacts&&userData.contacts.forEach(function(li){li.vrfStu&&"verified"===li.vrfStu.toLowerCase()&&("person_mobile"===strategy&&"MBT"===li.type?value=li.value:"person_email"===strategy&&"EML"===li.type&&(value=li.value))});else if("documenttype"===strategy){if($rootScope.settings.user&&$rootScope.settings.user.al>=15){var hasRfPassport,hasFrgnPassport;userData.docs.forEach(function(li){"RF_PASSPORT"===li.type?hasRfPassport=!0:"FRGN_PASS"===li.type&&(hasFrgnPassport=!0)}),value=hasRfPassport?"1":hasFrgnPassport?"null":""}}else if("documenttypename"===strategy)"PERSON_FOREIGN"!==userType?(tmp=api.getStrategyValue("documenttype"),value="1"===tmp.value?"Паспорт гражданина Российской Федерации":"null"===tmp.value?"Заграничный паспорт гражданина Российской Федерации":"Документ удостоверяющий личность"):value="Паспорт иностранного гражданина";else if("order_id"===strategy)value=""+$rootScope.settings.orderId;else if("region_code"===strategy)value=""+$rootScope.env.userSelectedRegion;else if("address_reg_fias"===strategy)userData.addresses&&(address=userData.addresses.find(function(li){return"PRG"===li.type}))&&(value=pguEsiaData.formatAddress(pguEsiaData.formatData(address)));else if("address_live_fias"===strategy)userData.addresses&&(address=userData.addresses.find(function(li){return"PLV"===li.type}))&&(value=pguEsiaData.formatAddress(pguEsiaData.formatData(address)));else if(~docDataNames.indexOf(toLowStrategy)){if(userData.docs&&(doc=userData.docs.find(function(li){return li.type===docType})))for(var j in doc)doc.hasOwnProperty(j)&&((toLowKey=j.toLowerCase())===toLowStrategy||"doc"+toLowKey===toLowStrategy||"issuedby"===toLowKey&&"issueorg"===toLowStrategy)&&(value=doc[j])}else if(~Object.keys(medicalPolicyStrategy).indexOf(toLowStrategy))userData.docs&&(doc=userData.docs.find(function(li){return"MDCL_PLCY"===li.type}))&&(value=doc[medicalPolicyStrategy[toLowStrategy]]||"");else if("sex"===strategy&&person.gender)value="M"===person.gender?"1":"2";else if("fio"===strategy)value=person.lastName+" "+person.firstName+(person.middleName?" "+person.middleName:"");else if("foreign_personcitizenship"===strategy)value=fullUserData.personCitizenship;else if("organizationbrief_orgfullname"===strategy)value=fullUserData.orgName;else if("organizationbrief_ogrn"===strategy||"businessmanbrief_ogrn"===strategy)value=fullUserData.orgOGRN;else if("organizationbrief_inn"===strategy)value=fullUserData.orgInn;else if("organizationbrief_kpp"===strategy)value=fullUserData.orgKpp;else if("organizationbrief_legalform_code"===strategy)value=userData.org&&userData.org.legCode;else if("user_id"===strategy)value=userData.id;else if("address_legal_fias"===strategy)userData.addresses&&(address=userData.addresses.find(function(li){return"OLG"===li.type}))&&(value=pguEsiaData.formatAddress(pguEsiaData.formatData(address)));else for(var k in person)person.hasOwnProperty(k)&&(toLowKey=k.toLowerCase())===toLowStrategy&&(value=person[k]);var data={value:value};return address&&(data.address=address),
StrategiesCache[strategy]=data,data}},__addToMarkDeleted:function(fullPath){toMarkDeleted[fullPath]=!0},__addToMarkDeletedRuntime:function(fullPath,data){toMarkDeletedRuntime=toMarkDeletedRuntime||{};var draft;if(data){draft=apiInner.getFormDraft([data]);for(var k in draft)draft.hasOwnProperty(k)&&(toMarkDeletedRuntime[k]=!0)}else toMarkDeletedRuntime[fullPath]=!0},__getToMarkDeletedRuntime:function(){return toMarkDeletedRuntime=toMarkDeletedRuntime||{}},__checkMarkDeleted:function(fullPath){return toMarkDeleted[fullPath]},__checkMarkDeletedRuntime:function(fullPath){return toMarkDeletedRuntime=toMarkDeletedRuntime||{},toMarkDeletedRuntime[fullPath]},__getMarkDeleted:function(){return markDeletedDraft=markDeletedDraft||{}},__setMarkDeleted:function(fullPath,data){var draft=apiInner.getFormDraft([data]);for(var k in draft)draft.hasOwnProperty(k)&&(markDeletedDraft[k]={deleted:!0})},__getSuggestsForDraft:function(notLoad){var df=$q.defer();return notLoad?df.resolve():sharedExtServices.autofillService.saveSuggestsWithoutDraft({data:suggests.getAllValues(),formId:$rootScope.settings.formId}).then(function(){df.resolve()},function(){df.resolve()}),df.promise},getSelectedLang:function(){return translate.get()},setLang:function(key){translate.use(key)},healthSend:function(params){$rootScope.$emit("HEALTH_SEND",params)},getGepsId:function(pathToGEPSId){var elemIdField=api.find(pathToGEPSId),urlParams=api.env("urlParams"),elemId="",urlParamsGepsId=urlParams&&urlParams.geps_id?urlParams.geps_id:"";return urlParamsGepsId?elemId=urlParamsGepsId:elemIdField&&elemIdField.value()&&(elemId=elemIdField.value()),elemId},getMnemonicFromLocalFeedGeps:function(id,localFeed){var localFeedGeps=localFeed;return localFeedGeps&&localFeedGeps.attachments&&localFeedGeps.attachments.length?id+"_attachments.zip":id+"_preview.pdf"},getLocalFeedGepsById:function(id){this.localFeedGeps||(this.localFeedGeps=$q.defer(),sharedExtServices.getFeedGepsById({id:id}).then(function(response){if(response&&response.data&&response.data.detail&&response.data.detail.messages&&response.data.detail.messages.length){var firstMessage=response.data.detail.messages[0];api.localFeedGeps.resolve({localFeedGeps:firstMessage})}else api.localFeedGeps.reject()},function(error){api.localFeedGeps.reject(error)}))},isIframe:function(){var roox=window.com&&window.com.rooxteam;try{return!roox&&window.self!==window.top}catch(e){return!roox}}};api.convertDateByMoment=window.moment||$moment,api._FormHash=FormHash,api.temporaryDisabled=[],apiElement.prototype.find=api.find,apiElement.prototype.isValid=api.isValid,apiElement.prototype.error=api.error,apiElement.prototype.submit=api.submit,apiElement.prototype.triggerEvent=api.triggerEvent,apiElement.prototype.launch=api.launch,apiElement.prototype.fetch=api.fetch,apiElement.prototype.inheritedVisibility=api.inheritedVisibility,apiElement.prototype.parent=api.parent,apiElement.prototype.scrollTo=api.scrollTo,apiElement.prototype.setRequired=api.setRequired,apiElement.prototype.setValues=api.setValues,apiElement.prototype.validators=api.validators,apiElement.prototype.visible=api.visible,apiElement.prototype.data=api.data,apiElement.prototype.value=api.value,apiElement.prototype.validate=api.validate,apiElement.prototype.valid=api.valid,apiElement.prototype.required=api.required,apiElement.prototype.disabled=api.disabled,apiElement.prototype.readonly=api.readonly,apiElement.prototype.env=api.env,apiElement.prototype.throbber=api.throbber,apiElement.prototype.scrollToError=api.scrollToError,apiElement.prototype.afterSetValue=api.afterSetValue,apiElement.prototype.afterSetMaxCloned=api.afterSetMaxCloned,apiElement.prototype._getCurrentNumOfClones=api._getCurrentNumOfClones,apiElement.prototype.setCustomTimeout=api.setCustomTimeout,apiElement.prototype.addToXml=api.addToXml,apiElement.prototype.each=api.each,apiElement.prototype.createPopup=api.createPopup,apiElement.prototype.setValueToString=api.setValueToString,apiElement.prototype.closeApiPopup=api.closeApiPopup,apiElement.prototype.getInfoByAddress=api.getInfoByAddress,apiElement.prototype.checkInvitation=api.checkInvitation,apiElement.prototype.checkLkNote=api.checkLkNote,apiElement.prototype.openSMSConfirmDialog=api.openSMSConfirmDialog,apiElement.prototype._items=[],Object.defineProperty(apiElement.prototype,"each",{get:function(){if(-1!==["Form","FormStep","Panel"].indexOf(this.element.className))return api.each.bind(this)}}),Object.defineProperty(apiElement.prototype,"_items",{get:function(){var arr=[];return this.element&&this.element.items&&this.element.items.forEach(function(item){arr.push(api.find(item.fullPath))}),arr}}),Object.defineProperty(api,"_items",{get:function(){var arr=[];return api.form&&api.form.length&&api.form[0].items.forEach(function(item){arr.push(api.find(item.fullPath))}),arr}}),apiElement.prototype.clones=function(){};var esiaAPI={kid_data:function(data){var esiaData=api.find().esiaDataForSave();esiaData.push({data:data,type:"kid_data"}),api.find().esiaDataForSave(esiaData)},foreignpassport:function(data){var esiaData=api.find().esiaDataForSave();esiaData.push({data:data,type:"foreignpassport"}),api.find().esiaDataForSave(esiaData)},birthcert:function(data){var esiaData=api.find().esiaDataForSave();esiaData.push({data:data,type:"birthcert"}),api.find().esiaDataForSave(esiaData)},militarydoc:function(data){var esiaData=api.find().esiaDataForSave();esiaData.push({data:data,type:"militarydoc"}),api.find().esiaDataForSave(esiaData)},medicalpolicy:function(data){var esiaData=api.find().esiaDataForSave();esiaData.push({data:data,type:"medicalpolicy"}),api.find().esiaDataForSave(esiaData)},inn:function(data){if(data&&"string"==typeof data&&$rootScope.settings.user&&$rootScope.settings.user.al>=20){var esiaData=api.find().esiaDataForSave();esiaData.push({data:data,type:"inn"}),api.find().esiaDataForSave(esiaData)}},birthplace:function(data){if(data&&"string"==typeof data){var esiaData=api.find().esiaDataForSave();esiaData.push({data:data,type:"birthPlace"}),api.find().esiaDataForSave(esiaData)}},driverLicense:function(series,number,issueDate,expiryDate){if(series&&number){var esiaData=api.find().esiaDataForSave();esiaData.push({type:"driverLicense",data:{series:series,number:number,issueDate:issueDate,expiryDate:expiryDate,type:"RF_DRIVING_LICENSE"}}),api.find().esiaDataForSave(esiaData)}},car:function(car,name,series,number){if(car){var esiaData=api.find().esiaDataForSave();esiaData.push({type:"car",data:{name:name,numberPlate:car,regCertificate:{series:series,number:number}}}),api.find().esiaDataForSave(esiaData)}},address:function(address,type){if(address){var esiaData=api.find().esiaDataForSave(),data={};if(address instanceof apiElement&&type){if(data.type=type,data.countryId="RUS","Fias"==address.element.className&&(data.addressStr=function(fias){var fullAddress="";for(var c in fias.controlsObj){var control=fias.controlsObj[c];if(control.level>0&&control.level<10||90===control.level||91===control.level){var dataValue=control.data.dataValue||control.el.value(),shortgAbbr=control.data.shortType||control.abbr||"";shortgAbbr=shortgAbbr.toLowerCase();var itemValue=dataValue||"";control.checkbox&&control.checkbox.attr("checked")&&(itemValue=""),itemValue&&(fullAddress+=fullAddress?", "+shortgAbbr+" "+itemValue:shortgAbbr+" "+itemValue)}}return fullAddress||""}(address.element),address.numericFiasCode()&&(data.fiasCode=address.numericFiasCode()),address.city()&&(data.city=address.city()),address.area()&&(data.area=address.area()),address.place()&&(data.settlement=address.place()),address.region()&&(data.region=address.region()),address.cityArea()&&(data.district=address.cityArea()),address.post_index()&&(data.zipCode=address.post_index()),address.additionalArea()&&(data.additionArea=address.additionalArea()),address.street()&&(data.street=address.street()),address.additionalStreet()&&(data.additionAreaStreet=address.additionalStreet()),address.house()&&(data.house=address.house()),address.apartment()&&(data.flat=address.apartment()),address.building1()&&(data.frame=address.building1()),address.building2()&&(data.building=address.building2())),~address.element.className.indexOf("Kladr")){data.addressStr="";address.region()&&(data.region=address.region(),data.addressStr+=address.region()),address.district()&&(data.area=address.district(),data.addressStr+=data.addressStr?", "+address.district():address.district()),address.city()&&(data.city=address.city(),data.addressStr+=data.addressStr?", "+address.city():address.city()),address.town()&&(data.settlement=address.town(),data.addressStr+=data.addressStr?", "+address.town():address.town()),address.street()&&(data.street=address.street(),data.addressStr+=data.addressStr?", "+address.street():address.street()),address.house()&&(data.house=address.house()),address.apartment()&&(data.flat=address.apartment()),address.building1()&&(data.frame=address.building1()),address.building2()&&(data.building=address.building2()),address.post_index()&&(data.zipCode=address.post_index())}}else data=address;data.type&&(esiaData.push({type:"address",data:data}),api.find().esiaDataForSave(esiaData))}}};esiaAPI.address_reg_fias=esiaAPI.address,esiaAPI.address_reg_kladr=esiaAPI.address,esiaAPI.address_live_kladr=esiaAPI.address,esiaAPI.address_live_fias=esiaAPI.address,api.esia=esiaAPI,PGU.api=api,window.debug_api={},window.debug_apiInner={};var handleDebugData=function(original,debugName,event){Object.keys(original).forEach(function(key){Object.defineProperty(debugName,key,{get:function(){return function(){for(var argsStr="",i=0;i<arguments.length;i++)argsStr+=arguments[i]+(i<arguments.length-1?", ":"");return $rootScope.$emit("HEALTH_SEND",{event:event,key:key,args:argsStr,orderId:$rootScope.env.orderId,userId:$rootScope.env.user.userId}),original[key].apply(null,arguments)}}})})};return handleDebugData(api,debug_api,"debug_api"),handleDebugData(apiInner,debug_apiInner,"debug_apiInner"),api}]),angular.module("serverForm.services").factory("apiInner",["$compile","$timeout","$rootScope","$q","sharedExtServices","$document","$window","DEFAULT_NAVIGATION_HANDLERS","ENGINE_REPOSITORY","ELEMS_EXTENTIONS","rule","PGU","$location","SAVE_DRAFT_ITEMS_WITH_CN",function($compile,$timeout,$rootScope,$q,sharedExtServices,$document,$window,DEFAULT_NAVIGATION_HANDLERS,ENGINE_REPOSITORY,ELEMS_EXTENTIONS,rule,PGU,$location,SAVE_DRAFT_ITEMS_WITH_CN){var getDataToCompare=function(item){return"object"==typeof item?JSON.stringify(item):item},lastCompareData={},apiInner={classNameToDirective:function(className){if(className){for(var directiveName="epgu-",i=0;i<className.length;i++)0!==i&&className[i]===className[i].toUpperCase()&&(directiveName+="-"),directiveName+=className[i].toLowerCase();switch(directiveName){case"epgu-field-dropdown-hierarchic":case"epgu-field-dropdown-multiple":case"epgu-field-month-ext":case"epgu-field-year":case"epgu-dropdown-search-for-child":case"epgu-field-birth-country":case"epgu-kladr-dropdown":case"epgu-field-dropdown-multiple-ext-2v":directiveName="epgu-field-dropdown";break;case"epgu-kladr":case"epgu-fias":directiveName="epgu-fias-da-data";break;case"epgu-kladr-address-r-k-n":case"epgu-kladr-juridical-person-r-k-n":case"epgu-kladr-natural-person-r-k-n":case"epgu-location-based-on-kladr":case"epgu-kladr-rus-stat":directiveName="epgu-kladr";break;case"epgu-field-map":case"epgu-field-map-with-list":case"epgu-field-map-with-list-d-c":directiveName="epgu-field-map";break;case"epgu-field-upload-dictionary":directiveName="epgu-field-upload";break;case"epgu-field-registration-address":case"epgu-field-address-of-residence":directiveName="epgu-field-address"}return directiveName}},addDataToStructure:function(list){},funnyObj:function(){var obj={};return Object.defineProperty(obj,"length",{get:function(){return Object.keys(this).length}}),obj},loopThroughTheTree:function(items,callback,key,parent){var key=key||"items";angular.forEach(items,function(item){callback(items,item,parent),item[key]&&item[key].length>0&&apiInner.loopThroughTheTree(item[key],callback,key,item)})},loopThroughTheTreeWithLevel:function(items,callback,level){var l=level||1;angular.forEach(items,function(item){callback(items,item,l),item.items&&item.items.length>0&&(l=item.name?l+1:l,apiInner.loopThroughTheTreeWithLevel(item.items,callback,l))})},getElementsTree:function(form){var res=[];return apiInner.loopThroughTheTreeWithLevel(form,function(items,item,level){item.name&&res.push({item:item,level:level})},1),res},createDataToSave:function(form){if(!form||!form.length)return[];var temp;temp=[];for(var j=0;j<form.length;j++){var item=form[j],obj={};if(!item.doNotSave){for(var i in item){var save=!0;item.attrs&&item.attrs[i]&&angular.equals(item[i],item.attrs[i].default)&&"strategy"!==i&&(save=!1),item.attrs&&!item.attrs[i]&&"submitEvents"!=i&&"items"!=i&&"className"!=i&&"rules"!=i&&(save=!1),"function"==typeof item[i]&&(save=!1),"items"==i&&item[i].length&&(obj[i]=this.createDataToSave(item[i]),save=!1),save&&(item[i].value&&"string"!=typeof item[i].value&&(item[i].value+=""),$rootScope.isDesigner||"rules"!==i?obj[i]=item[i]:obj[i]=item[i].map(function(rule){return rule.sourceCode||rule}))}temp.push(obj)}}return temp},getFormData:function(form){var res={};return apiInner.loopThroughTheTree(form,function(items,item){void 0!==item.value&&item.hasOwnProperty("fullPath")&&!item.immutable&&(res[item.fullPath]=item.value)}),res},getFormDataWithValue:function(form){var res={};return apiInner.loopThroughTheTree(form,function(items,item){void 0!==item.value&&item.hasOwnProperty("fullPath")&&!item.immutable&&(res[item.fullPath]={value:item.value})}),res},getFormDraft:function(form,markDeleted,markDeletedRuntime,toMarkDeleted){function makeDropdown(obj,item){return angular.forEach(item.attrs,function(attr,attrName){attr["scope:sync"]&&(obj[attrName]=item[attrName])}),item.dictionary&&item.dictionary.responseBindings&&(obj.responseBindings=angular.toJson(item.dictionary.responseBindings)),void 0!==item.value&&(obj.value=item.value),"FieldDropdownMultiple"!=item.className&&"FieldDropdownMultipleExt2v"!=item.className||(obj.text=obj.text_value||"",obj.cloneIndex&&(obj.cloneIndex=(Number(obj.cloneIndex)-1).toString())),obj}function getSyncAttributes(obj,item){if("Form"!==item.className&&"FormButton"!==item.className&&"NavPanel"!==item.className){var noEmptyDataForDraft=$rootScope.env.formParam&&"true"===$rootScope.env.formParam.noEmptyDataForDraft;((noEmptyDataForDraft?PGU.api.inheritedVisibility(item.fullPath):item.visible)||item.forceXml||item.saveBookIdToDraft||isMultiple&&"FormStep"===item.className)&&angular.forEach(item.attrs,function(attr,attrName){attr["scope:sync"]&&checkRemovedItems(item,attrName)&&(item.forceXml||!noEmptyDataForDraft||noEmptyDataForDraft&&item[attrName]!==attr.default)&&(obj[attrName]=item[attrName]?item[attrName].toString():item[attrName])})}return obj}function checkRemovedItems(item,attrName){return!item.removedItems||!item.removedItems.length||-1===item.removedItems.indexOf(attrName)}var res={},systemData=$rootScope.env.systemData,isMultiple=systemData&&systemData.signCnt&&+systemData.signCnt>1;if(apiInner.loopThroughTheTree(form,function(items,item){var obj={},fullPath=item.fullPathForXml||item.fullPath;if(markDeletedRuntime&&markDeletedRuntime[fullPath]&&(markDeletedRuntime[fullPath]=!1),(!item.immutable||isMultiple)&&!item.doNotSaveDraft&&(apiInner.toBoolean(item.addToXml)||void 0==item.addToXml)){if(obj="FieldDropdown"!=item.className&&"FieldDropdownHierarchic"!=item.className&&"FieldDropdownHierarchicMultiple"!=item.className||!item.visible?getSyncAttributes(obj,item):makeDropdown(obj,item),"FieldUpload"==item.className&&item.multipleUpload){var regex=/\[(.+?)\]/;item.countFiles<=1&&(obj.mnemonic=fullPath,delete obj.value,delete obj.text_value),regex.exec(fullPath.substring(fullPath.lastIndexOf(".")))||(obj.value="")}if("Panel"==item.className&&item.saveDraft&&item.saveDraft.length)for(var i=0;i<item.saveDraft.length;i++)obj[item.saveDraft[i]]=item[item.saveDraft[i]]?item[item.saveDraft[i]].toString():item[item.saveDraft[i]];if("FieldDropdownMultiple"!=item.className&&"FieldDropdownMultipleExt2v"!=item.className&&"FieldDropdownHierarchicMultiple"!=item.className&&"DataGrid"!==item.className||(obj={}),obj&&!apiInner.isEmptyObject(obj)&&(res[fullPath]=obj),0==!!item.saveWithMask&&item.originalValue&&res[fullPath]&&(res[fullPath].value=item.originalValue,res[fullPath].masketValue=!1),item.clones&&item.clones.length&&"FieldDropdownHierarchicMultiple"==item.className&&0!=item.clones[0].cloneIndex){var o={};o=makeDropdown(o,item),o&&!apiInner.isEmptyObject(o)&&(res[item.fullPath+"[0]"]=o)}if(item.clones&&item.clones.length&&("FieldDropdownHierarchic"==item.className||"FieldDropdownMultiple"==item.className||"FieldDropdownMultipleExt2v"==item.className||"FieldDropdownHierarchicMultiple"==item.className))if("FieldDropdownMultiple"==item.className&&item.__draftDataLength)for(var draftI=0,draftL=item.__draftData.length;draftI<draftL;draftI++){var o={};item.__draftData[draftI].attrs=item.attrs,o=makeDropdown(o,item.__draftData[draftI]),o&&!apiInner.isEmptyObject(o)&&(res[item.__draftData[draftI].fullPathForXml||item.__draftData[draftI].fullPath]=o),markDeletedRuntime&&markDeletedRuntime[item.__draftData[draftI].fullPathForXml||item.__draftData[draftI].fullPath]&&(markDeletedRuntime[item.__draftData[draftI].fullPathForXml||item.__draftData[draftI].fullPath]=!1)}else{for(var lastSavedClonePath,lastSavedCloneIndex=0,i=0;i<item.clones.length;i++){var o={};o=makeDropdown(o,item.clones[i]),markDeletedRuntime&&markDeletedRuntime[item.clones[i].fullPath]&&(markDeletedRuntime[item.clones[i].fullPath]=!1),o&&!apiInner.isEmptyObject(o)&&("FieldDropdownHierarchic"!=item.className||"FieldDropdownHierarchic"==item.className&&(o.value||o.visibleLevel)&&(item.clones[i].list&&item.clones[i].list.length||item.clones[i].text_value))&&(lastSavedClonePath=item.clones[i].fullPathForXml||item.clones[i].fullPath,res[lastSavedClonePath]=o,lastSavedCloneIndex=i)}var clonesCount=item.clones.length,lastSavedCloneIndexToCompare=lastSavedCloneIndex+1;if("FieldDropdownHierarchic"===item.className&&clonesCount&&!item.clones[clonesCount-1].fullFilled&&(!lastSavedClonePath||res[lastSavedClonePath].value)){res[lastSavedClonePath]&&res[lastSavedClonePath].value&&res[lastSavedClonePath].cloneIndex==lastSavedCloneIndexToCompare&&(lastSavedCloneIndex+=1);var emptyClone={cloneIndex:++lastSavedCloneIndex,lastLevelValue:"0",pageNum:"1",text_value:"",value:"",visibleLevel:!0};res[item.fullPath+"["+lastSavedCloneIndex+"]"]=emptyClone}}if("EditableDataGrid"===item.className&&item.customFields&&item.customFields.length){var customFields=apiInner.getFormDraft(item.customFields);Object.keys(customFields).forEach(function(key){res[key]=customFields[key]})}"DataGrid"===item.className&&item.fakeClones&&item.fakeClones.length&&item.fakeClones.forEach(function(clone){if(clone.items&&clone.items.length){var gridDraft=apiInner.getFormDraft(clone.items);Object.keys(gridDraft).forEach(function(key){res[key]=gridDraft[key]})}})}if(item.immutable&&("FieldDropdown"!=item.className&&"FieldDropdownHierarchic"!=item.className||!item.visible||(obj=makeDropdown(obj,item),res[fullPath]=obj)),"PanelWorkActivity"===item.className&&(res[item.fullPath]={multiValue:JSON.stringify(item.list)},item.list&&item.list.length&&item.list.forEach(function(listItem){listItem.activity&&listItem.activity.value&&(res[listItem.fullPathForXml+".Panel10."+listItem.activity.fieldName]={value:listItem.activity.value},listItem.activity.textValue&&(res[listItem.fullPathForXml+".Panel10."+listItem.activity.fieldName].textValue=listItem.activity.textValue)),item.fieldNames.forEach(function(field){_.isObject(listItem[field.name])?res[listItem.fullPathForXml+"."+field.field]=listItem[field.name]:(res[listItem.fullPathForXml+"."+field.field]={},res[listItem.fullPathForXml+"."+field.field].value=listItem[field.name])})})),"FieldUpload"==item.className&&res[fullPath]){var files=angular.copy(item.files);res[fullPath].setDraftFromEdit&&delete res[fullPath].setDraftFromEdit,item.multipleUpload&&item.countFiles>1?files=item.files&&item.files.filter(function(file){if(!file.removeDef&&!file.error){res[fullPath].value=res[fullPath].value||"";var draftFile={isFile:!0,businessName:item.businessName,docTypeString:item.docTypeString,value:file.name,mnemonic:file.mnemonic,size:file.size,mimeType:file.type||"application/octet-stream",cloneIndex:file.cloneIndex};return res[file.mnemonic]=draftFile,file}}):files&&files[0]&&(files[0].removeDef||files[0].error?delete res[fullPath]:(res[fullPath].value=files[0].name,res[fullPath].size=files[0].size.toString(),res[fullPath].mimeType=files[0].type||"application/octet-stream",res[fullPath].mnemonic=fullPath)),files&&files.length?obj.multiValue=JSON.stringify(files):obj.multiValue=""}if("FieldMapWithListDC"===item.className&&item.selectedItems&&item.selectedItems.length){var newFullPath,priorityKey=item.isNewView?"priorityNumber":"priority";item.selectedItems.forEach(function(item,index){newFullPath=fullPath+(index>0?"["+index+"]":""),res[newFullPath]={},res[newFullPath].title=item.title,res[newFullPath].code=item.value,res[newFullPath][priorityKey]=item[priorityKey],res[newFullPath].cloneIndex=index})}if("ElectronMedicalDocs"===item.className&&item.documents&&item.documents.length){var inc=0;item.documents.forEach(function(doc){doc.checkbox.checked&&(res[fullPath+"["+inc+"]"]={DocumentDate:doc.DocumentDate,DocumentType:doc.DocumentType,DocumentUid:doc.DocumentUid,MedicalOrganization:doc.MedicalOrganization,DiseaseDiagnosis:doc.DiseaseDiagnosis,Description:doc.Description},inc++)})}if("AutomotiveAxles"===item.className&&item.axlesList&&item.axlesList.length){var indexTrailer=0,saveObj={};item.axlesList.forEach(function(axle,i){var path;if(saveObj.draftData=JSON.stringify(item.axlesList),0===i&&(saveObj.truck_mass=axle.mass),axle.isTruckAxle||axle.isCab)saveObj["truck_axle_"+(i+1)+"_load"]=axle.load,saveObj["truck_axle_"+(i+1)+"_wheelType"]=axle.wheelType;else{axle.mass&&(indexTrailer++,saveObj["trailer_"+indexTrailer+"_mass"]=axle.mass);path="trailer_"+indexTrailer+"_axle"+"_"+(i+1),saveObj[path+"_load"]=axle.load,saveObj[path+"_wheelType"]=axle.wheelType}if(axle.distance){saveObj["distance_"+i]=axle.distance}}),res[item.fullPath]=saveObj}"InitialImpact"===item.className&&item.typeTS&&(res[item.fullPath]={value:item.value,typeTS:item.typeTS,sector:item.sector,version:item.version}),SAVE_DRAFT_ITEMS_WITH_CN.includes(item.className)&&res[item.fullPath]&&(res[item.fullPath].className=item.className)}),markDeletedRuntime)for(var k in markDeletedRuntime)markDeletedRuntime.hasOwnProperty(k)&&(!1===markDeletedRuntime[k]&&toMarkDeleted?markDeletedRuntime[k]=!0:markDeleted[k]={deleted:!0});return markDeleted&&_.extend(res,markDeleted),res},__setMarkDeleted:function(fullPath,data,markDeletedDraft){var draft=this.getFormDraft([data]);for(var k in draft)draft.hasOwnProperty(k)&&(markDeletedDraft[k]={deleted:!0})},getSubmitEvent:function(submitEvents,type){var res;return angular.forEach(submitEvents,function(event,key){key==type&&(res=event)}),res||(res=[]),res},isEmptyObject:function(obj){if(!obj)return!0;for(var item in obj)if(obj.hasOwnProperty(item))return!1;return!0},getListFullNames:function(fullName){for(var arr=fullName.split("."),result=[],i=0,il=arr.length;i<il;i++){var arrSlice=arr.slice(0,i+1),str=arrSlice.join(".");result.push(str)}return result},setDraftTimeout:function(){$rootScope.env.timeout=$timeout(function(){apiInner.uploadDraft()},apiInner.getDraftTimeout(),!1)},saveDraft:function(options,api){var draft=_.extend({},options.draft);draft["form.selectedLanguage"]={value:$rootScope.settings.selectedLanguage||""};var request={orderId:options.orderId,draftId:options.draftId,draftVersion:options.draftVersion,userSelectedRegion:$rootScope.settings.regionId,form:{mnemonic:$rootScope.settings.mnemonic,version:"12345",content:draft}};return sharedExtServices.saveDraft(request).catch(function(response){var data=response.data;return data&&data.error&&98===data.error.code&&api.handleError(data.error),$q.reject(response)})},findInArray:function(arr,callback){for(var result,i=0,il=arr.length;i<il;i++)if(callback(arr[i],i)){result=arr[i];break}return result},checkNavPanel:function(form){var result,navPanelFullPath=form.name?form.name+".NavPanel":"NavPanel",hasNavPanel=apiInner.findInArray(form.items,function(item,ind){return"NavPanel"===item.className});return"1"!==form.engineVersion||hasNavPanel?hasNavPanel&&(form.showAllSteps?(hasNavPanel.visible||hasNavPanel.defaultVisible)&&this.replaceNavHandlers(form.engineVersion,hasNavPanel):(hasNavPanel.visible=!0,form.engineVersion&&"EnginePlayerPguOnline"!==form.engineVersion&&this.replaceNavHandlers(form.engineVersion,hasNavPanel))):result={className:"NavPanel",visible:!0,fullPath:navPanelFullPath,submitEvents:{},name:"NavPanel",items:[{className:"FormButton",name:"__prevStep",fullPath:navPanelFullPath+".__prevStep",handlers:[{listen:[{component:navPanelFullPath+".__prevStep",events:["click"]}],handler:DEFAULT_NAVIGATION_HANDLERS.EnginePlayerPgu.prev.toString()}],label:"Назад",action:"prev",visible:!1,floating:"PGU-BtnFloat"},{className:"FormButton",name:"FormButtonShowInfo",fullPath:navPanelFullPath+".FormButtonShowInfo",visible:!1,handlers:[{listen:[{component:navPanelFullPath+"FormButtonShowInfo",events:["click"]}],handler:DEFAULT_NAVIGATION_HANDLERS.EnginePlayerPgu.showInfo.toString()}],label:"Описание услуги",action:"view-info",floating:"PGU-BtnFloat",submitEvents:{}},{className:"FormButton",name:"__nextStep",fullPath:navPanelFullPath+".__nextStep",handlers:[{listen:[{component:navPanelFullPath+".__nextStep",events:["click"]}],handler:DEFAULT_NAVIGATION_HANDLERS.EnginePlayerPgu.next.toString()}],label:"Далее",action:"next",balign:"right",buttonSize:"",floating:"PGU-BtnFloat",submitEvents:{}}],rules:[]},result},replaceNavHandlers:function(engineVersion,navPanel){var item,itemAction,navPanelHandlers;if("1"!==engineVersion&&navPanel&&navPanel.items&&navPanel.items.length){navPanel.handlers&&navPanel.handlers.length&&(navPanelHandlers=navPanel.handlers.concat());for(var i=0,il=navPanel.items.length;i<il;i++)item=navPanel.items[i],itemAction="view-info"===item.action?"showInfo":item.action,item.visible=!1,"next"===item.action&&(item.visible=!0,item.buttonSize="",navPanel.nameButton&&(item.label=navPanel.nameButton),navPanelHandlers&&navPanelHandlers.length&&(item.handlers.length||(item.handlers[0]={listen:[]}),item.handlers[0].handler=navPanelHandlers[0].handler.toString(),item.handlers[0].listen[0]={component:item.fullPath,events:["click"]}),navPanel.handlers=[]),item.handlers[0].handler||(item.handlers[0].handler=DEFAULT_NAVIGATION_HANDLERS[ENGINE_REPOSITORY[engineVersion]][itemAction].toString(),item.handlers[0].listen[0]={component:item.fullPath,events:["click"]})}},isUniqueName:function(itemParent,name){if(!itemParent)return!0;var el=itemParent.getElement();if(!el||!el.items||!el.items.length)return!1;for(var count=0,i=0;i<el.items.length;i++)el.items[i].name===name&&count++;return count<=1},isInPatternName:function(value){var notName="NAME"!==value.toUpperCase(),isLatin=/^[a-zA-Z]+[a-zA-Z._\[\]\d]*$/.test(value);return notName&&isLatin},updateFullPath:function(item,oldName){function changeChildren(items,fullPath){for(var i=0;i<items.length;i++)items[i].fullPath=fullPath+(items[i].name?"."+items[i].name:""),items[i].items&&items[i].items.length&&changeChildren(items[i].items,items[i].fullPath)}var name=item.name,path=item.fullPath.split("."),items=item.items;""!==oldName&&""!==name?path[path.length-1]=name:name&&path.push(name),path=path.join("."),item.fullPath=path,items&&items.length&&changeChildren(items,item.fullPath)},getFormattedDateObj:function(date){var dayName=["воскресенье","понедельник","вторник","среда","четверг","пятница","суббота"],shortDayName=["Вс","Пн","Вт","Ср","Чт","Пт","Сб"],monthName=["января","февраля","марта","апреля","мая","июня","июля","августа","сентября","октября","ноября","декабря"];return{date:date.getDate(),month:monthName[date.getMonth()],year:date.getFullYear(),day:dayName[date.getDay()],shortDayName:shortDayName[date.getDay()],yearTitle:"года",yearShortTitle:"г."}},getNameAndIndex:function(name){if(-1==name.indexOf("["))return{name:name,index:0};var match,result={name:"",index:""};return(match=name.match(/^([a-zA-Z0-9_]+)\[(\d+)\]$/))&&(result.name=match[1],result.index=parseInt(match[2],10)),result},getFullPathArray:function(fullPath){for(var nameArr=fullPath.split("."),res=[],i=0;i<nameArr.length;i++)i>0?res.push(res[i-1]+"."+nameArr[i]):res.push(nameArr[i]);return res},recursiveFind:function(items,name){for(var nameFullPaths=(name.split("."),this.getFullPathArray(name)),isClones=!1,i=0;i<items.length;i++){if(items[i].fullPath==name)return items[i];for(var j=0;j<nameFullPaths.length;j++)if(!items[i].fullPath||items[i].fullPath==nameFullPaths[j])return this.recursiveFind(items[i].items,name);items[i].clones&&items[i].clones.length&&(isClones=!0)}if(isClones)for(var i=0;i<items.length;i++)if(items[i].clones)return this.recursiveFind(items[i].clones,name);return{notfound:!0,parents:items}},findClone:function(item){return item.clone?this.findClone(item.clone):item},getListElemFromValue:function(list,value){if(list&&list.length)for(var i=0;i<list.length;i++)if(list[i].value==value)return PGU.copy(list[i])},removeFromArray:function(list,listR){if(list){if(!listR||!listR.length)return list;if(JSON.stringify(list)==JSON.stringify(listR))return[];for(var i=list.length-1;i>=0;i--){for(var found=void 0,j=0;j<listR.length;j++)if(list[i].value==listR[j].value){found=i;break}void 0!==found&&list.splice(i,1)}return list}},leadingZero:function(num){return num<10?"0"+num:num},getRightName:function(year){var years=["год","года","лет"];return 1===year?years[0]:year>1&&year<5?years[1]:years[2]},attachHandlers:function(item,itemsInRules){var parent,needWatcherForRules,that=this;item.handlers&&item.handlers.length?(angular.forEach(item.handlers,function(handler){angular.forEach(handler.listen,function(listen){if(!listen.__inited){var needWatcherForRules="",h=[],el=that.find(listen.component);if(listen.component&&el&&!el.fullPath)return;var listenComponentPath=el&&el.fullPath()||"";angular.forEach(listen.events,function(event){var inFormStepRendered=that.checkInFormStepRendered(that._FormStepRendered,listenComponentPath||item.fullPath);h.push({name:event,inFormStepRendered:inFormStepRendered,callback:function(newVal,oldVal){var notCompareEvent=["formRendered","hide","show"].includes(event),newAsStr=getDataToCompare(newVal),oldAsStr=getDataToCompare(oldVal);lastCompareData[item.fullPath]=lastCompareData[item.fullPath]||{},lastCompareData[item.fullPath][listenComponentPath]=lastCompareData[item.fullPath][listenComponentPath]||{},lastCompareData[item.fullPath][listenComponentPath][event]=lastCompareData[item.fullPath][listenComponentPath][event]||{};var lastData=lastCompareData[item.fullPath][listenComponentPath][event]||{},isRepeated=lastData.oldVal===oldAsStr&&lastData.newVal===newAsStr;if(notCompareEvent||newAsStr!==oldAsStr&&!isRepeated){lastData.oldVal=oldAsStr,lastData.newVal=newAsStr;if(!PGU.checkElementOnRemovedClone(item.fullPath)){var eventAttrs={component:that.find(listenComponentPath),oldValue:oldVal,newValue:newVal,inFormStepRendered:inFormStepRendered};that.triggerHandler(item.fullPath,listenComponentPath,handler,eventAttrs)}}}}),"click"===event&&$rootScope.$on(listenComponentPath+":"+event,function(evt,data){if(!PGU.checkElementOnRemovedClone(item.fullPath)){var eventAttrs={component:that.find(listenComponentPath)};that.triggerHandler(item.fullPath,listenComponentPath,handler,eventAttrs)}})});var notFoundElem=!1;el&&el.element.__notLoad&&el.element.fullPath&&el.element.fullPath===listenComponentPath&&(notFoundElem=!0,$rootScope.settings.notFoundElems=$rootScope.settings.notFoundElems||[],
$rootScope.settings.notFoundElems.push({fullPath:item.fullPath,listenComponent:listenComponentPath})),!el||apiInner.isEmptyObject(el)||notFoundElem||(listen.__inited=!0,itemsInRules.hasOwnProperty(el.element.fullPath)&&(needWatcherForRules=itemsInRules[el.element.fullPath],parent=el.parent()),apiInner.initElementHandlers(el.element,h,needWatcherForRules,parent,that,item.cloneIndex))}})}),itemsInRules.hasOwnProperty(item.fullPath)&&(parent=that.find(item.fullPath).parent(),needWatcherForRules=itemsInRules[item.fullPath],apiInner.initElementRule(parent.element,item,needWatcherForRules,that))):itemsInRules.hasOwnProperty(item.fullPath)&&(parent=that.find(item.fullPath).parent(),needWatcherForRules=itemsInRules[item.fullPath],apiInner.initElementRule(parent.element,item,needWatcherForRules,that))},setClick:function(fullPath,className,href,callback){$("body")[0]},initElementHandlers:function(elem,handlers,needWatcherForRules,parent,api,cloneIndex){if(elem&&handlers&&handlers.length)for(var watchHandler,that=this,i=0;i<handlers.length;i++){var item=handlers[i];switch(item.name){case"click":!function(obj){$rootScope.$on(elem.fullPath+":ScopeApplied",function(evt,attrs){that.setClick(elem.fullPath,elem.className,elem.href,obj.callback)})}(item);break;case"changedata":var collection=[],collectionWatch=[];for(var i in elem.attrs)elem.attrs.hasOwnProperty(i)&&elem.attrs[i]["scope:sync"]&&!elem.attrs[i]["scope:noChanges"]&&(collection.push(i),collectionWatch.push("item."+i));needWatcherForRules&&apiInner.checkAttributeInWatchCollection(collection,collectionWatch,needWatcherForRules),elem.hasScopeChangeEvent=!0,elem.isScopeAppliedDone&&!elem.scopeAppliedDone&&(elem.scopeAppliedDone=elem.isScopeAppliedDone),!elem.scopeAppliedDone||cloneIndex&&0!=cloneIndex?$rootScope.$on(elem.fullPath+":ScopeApplied",function(evt,attrs){if(item.inFormStepRendered?$rootScope.$on(item.inFormStepRendered&&item.inFormStepRendered.fullPath+":stepRendered",function(evt,data){if(elem.scopeAppliedDone=attrs,!1===$rootScope.setDraft)for(var i in elem.attrs)elem.attrs[i]["scope:sync"]&&(elem.attrs[i].default,elem[i]),needWatcherForRules&&needWatcherForRules.indexOf(i)>-1&&api.afterMemberChanged(parent.element,elem.fullPath,i,elem[i],elem.attrs[i].default,elem);watchHandler=attrs.scope.$watchGroup(collectionWatch,function(newV,oldV){if(!angular.equals(newV,oldV)){var oldHash,newHash;newHash=that.getObjsFromItemVals(collection,newV),oldHash=that.getObjsFromItemVals(collection,oldV);var diffAttrsValue=that.getDiffValues(newHash,oldHash);if(item.callback(diffAttrsValue[0],diffAttrsValue[1]),attrs.scope.item.initStrategy)return void(attrs.scope.item.initStrategy=!1);for(var i=0;i<newV.length;i++)newV[i]!=oldV[i]&&needWatcherForRules&&needWatcherForRules.indexOf(collection[i])&&parent&&parent.element&&api.afterMemberChanged(parent.element,elem.fullPath,collection[i],newHash[collection[i]],oldHash[collection[i]],elem)}}),$rootScope.$on(elem.fullPath+":StopHandle",function(evt){watchHandler()})}):$rootScope.$on(":formRendered",function(evt,data){PGU.fireEvents.formRendered=!0,elem.scopeAppliedDone=attrs;var onInitValue=attrs.scope.item.value,checkedInitValue=!(1===collectionWatch.length&&"item.value"===collectionWatch[0]);watchHandler=attrs.scope.$watchGroup(collectionWatch,function(newV,oldValue){var oldV;if(checkedInitValue){if(angular.equals(newV,oldValue))return;oldV=oldValue}else if(checkedInitValue=!0,oldV=[onInitValue],newV[0]===onInitValue)return;var oldHash,newHash;newHash=that.getObjsFromItemVals(collection,newV),oldHash=that.getObjsFromItemVals(collection,oldV);var diffAttrsValue=that.getDiffValues(newHash,oldHash);if(item.callback(diffAttrsValue[0],diffAttrsValue[1]),attrs.scope.item.initStrategy)return void(attrs.scope.item.initStrategy=!1);for(var i=0;i<newV.length;i++)newV[i]!=oldV[i]&&needWatcherForRules&&needWatcherForRules.indexOf(collection[i])&&parent&&parent.element&&api.afterMemberChanged(parent.element,elem.fullPath,collection[i],newHash[collection[i]],oldHash[collection[i]],elem)}),$rootScope.$on(elem.fullPath+":StopHandle",function(evt){watchHandler()})}),PGU.fireEvents.formRendered){if(!1===$rootScope.setDraft)for(var i in elem.attrs)elem.attrs[i]["scope:sync"]&&(elem.attrs[i].default,elem[i]),needWatcherForRules&&needWatcherForRules.indexOf(i)>-1&&api.afterMemberChanged(parent.element,elem.fullPath,i,elem[i],elem.attrs[i].default,elem);watchHandler=attrs.scope.$watchGroup(collectionWatch,function(newV,oldV){if(!angular.equals(newV,oldV)){var oldHash,newHash;newHash=that.getObjsFromItemVals(collection,newV),oldHash=that.getObjsFromItemVals(collection,oldV);var diffAttrsValue=that.getDiffValues(newHash,oldHash);if(item.callback(diffAttrsValue[0],diffAttrsValue[1]),attrs.scope.item.initStrategy)return void(attrs.scope.item.initStrategy=!1);for(var i=0;i<newV.length;i++)newV[i]!=oldV[i]&&needWatcherForRules&&needWatcherForRules.indexOf(collection[i])&&parent&&parent.element&&api.afterMemberChanged(parent.element,elem.fullPath,collection[i],newHash[collection[i]],oldHash[collection[i]],elem)}}),$rootScope.$on(elem.fullPath+":StopHandle",function(evt){watchHandler()})}}):(watchHandler=elem.scopeAppliedDone.scope.$watchGroup(collectionWatch,function(newV,oldV){if(!angular.equals(newV,oldV)){var oldHash,newHash;newHash=that.getObjsFromItemVals(collection,newV),oldHash=that.getObjsFromItemVals(collection,oldV);var diffAttrsValue=that.getDiffValues(newHash,oldHash);if(item.callback(diffAttrsValue[0],diffAttrsValue[1]),elem.scopeAppliedDone.scope.item.initStrategy)return void(elem.scopeAppliedDone.scope.item.initStrategy=!1);for(var i=0;i<newV.length;i++)newV[i]!=oldV[i]&&needWatcherForRules&&needWatcherForRules.indexOf(collection[i])&&parent&&parent.element&&api.afterMemberChanged(parent.element,elem.fullPath,collection[i],newHash[collection[i]],oldHash[collection[i]],elem)}}),$rootScope.$on(elem.fullPath+":StopHandle",function(evt){watchHandler()}));break;case"change":var collectionChange=[],collectionChangeWatch=[];if(Object.keys(elem.attrs).forEach(function(i){elem.attrs[i]["scope:noChanges"]||(collectionChange.push(i),collectionChangeWatch.push("item."+i),needWatcherForRules&&apiInner.checkAttributeInWatchCollection(collectionChange,collectionChangeWatch,needWatcherForRules))}),elem.hasScopeChangeEvent=!0,elem.isScopeAppliedDone&&!elem.scopeAppliedDone&&(elem.scopeAppliedDone=elem.isScopeAppliedDone),!elem.scopeAppliedDone||cloneIndex&&0!=cloneIndex)$rootScope.$on(elem.fullPath+":ScopeApplied",function(evt,attrs){var defaultHash;!1===$rootScope.setDraft&&(defaultHash=that.getObjsFromItemVals(collectionChange,elem,"elem"),item.callback(defaultHash,that.getObjsFromItemVals(collectionChange,elem,"default"))),elem.scopeAppliedDone=attrs;var defaultHashStatus=!1;attrs.scope.$watchGroup(collectionChangeWatch,function(newV,oldV){var oldHash,newHash;newHash=that.getObjsFromItemVals(collectionChange,newV),oldHash=that.getObjsFromItemVals(collectionChange,oldV);var diffAttrsValue=that.getDiffValues(newHash,oldHash);!defaultHashStatus&&_.isEqual(diffAttrsValue[0],diffAttrsValue[1])&&(defaultHash=defaultHash||that.getObjsFromItemVals(collectionChange,elem,"elem"),defaultHashStatus=!0,diffAttrsValue=that.getDiffValues(newHash,defaultHash)),item.callback(diffAttrsValue[0],diffAttrsValue[1]);for(var i=0;i<newV.length;i++)newV[i]!=oldV[i]&&needWatcherForRules&&needWatcherForRules.indexOf(collectionChange[i])&&parent&&parent.element&&api.afterMemberChanged(parent.element,elem.fullPath,collectionChange[i],newHash[collectionChange[i]],oldHash[collectionChange[i]],elem)})});else{!1===$rootScope.setDraft&&(item.callback(that.getObjsFromItemVals(collectionChange,elem,"elem"),that.getObjsFromItemVals(collectionChange,elem,"default")),Object.keys(elem.attrs||{}).forEach(function(i){}));var defaultHashStatusApplied=!1;elem.scopeAppliedDone.scope.$watchGroup(collectionChangeWatch,function(newV,oldV){var oldHash,newHash;newHash=that.getObjsFromItemVals(collectionChange,newV),oldHash=that.getObjsFromItemVals(collectionChange,oldV);var defaultHash,diffAttrsValue=that.getDiffValues(newHash,oldHash);!defaultHashStatusApplied&&_.isEqual(diffAttrsValue[0],diffAttrsValue[1])&&(defaultHash=that.getObjsFromItemVals(collectionChange,elem,"default"),defaultHashStatusApplied=!0,diffAttrsValue=that.getDiffValues(newHash,defaultHash)),item.callback(diffAttrsValue[0],diffAttrsValue[1]);for(var i=0;i<newV.length;i++)newV[i]!=oldV[i]&&needWatcherForRules&&needWatcherForRules.indexOf(collectionChange[i])&&parent&&parent.element&&api.afterMemberChanged(parent.element,elem.fullPath,collectionChange[i],newHash[collectionChange[i]],oldHash[collectionChange[i]],elem)})}break;case"hide":elem.hasScopeChangeEvent=!0;var collection2=[];for(var i in elem.attrs)elem.attrs[i]["scope:sync"]&&collection2.push(i);var attrsHide={};$rootScope.$on(elem.fullPath+":ScopeApplied",function(evt,attrs){attrsHide=attrs,$rootScope.$on(":formRendered",function(evt,data){PGU.fireEvents.formRendered=!0,watchHandler=attrsHide.scope.$watch("item.visible",function(newV,oldV){newV===oldV&&(oldV=!newV),!1===newV&&oldV&&item.callback&&item.callback({visible:newV},{visible:oldV})})}),PGU.fireEvents.formRendered&&(watchHandler=attrs.scope.$watch("item.visible",function(newV,oldV){newV===oldV&&(oldV=!newV),!1===newV&&oldV&&item.callback&&item.callback({visible:newV},{visible:oldV})}))});break;case"show":elem.hasScopeChangeEvent=!0;var collection3=[];for(var i in elem.attrs)elem.attrs[i]["scope:sync"]&&collection3.push(i);var attrsShow={};$rootScope.$on(elem.fullPath+":ScopeApplied",function(evt,attrs){attrsShow=attrs,$rootScope.$on(":formRendered",function(evt,data){PGU.fireEvents.formRendered=!0,watchHandler=attrsShow.scope.$watch("item.visible",function(newV,oldV){newV===oldV&&(oldV=!newV),!0!==newV||oldV||item.callback&&item.callback({visible:newV},{visible:oldV})})}),PGU.fireEvents.formRendered&&(watchHandler=attrs.scope.$watch("item.visible",function(newV,oldV){newV===oldV&&(oldV=!newV),!0!==newV||oldV||item.callback&&item.callback({visible:newV},{visible:oldV})}))});break;case"formRendered":item.inFormStepRendered?$rootScope.$on(item.inFormStepRendered&&item.inFormStepRendered.fullPath+":stepRendered",function(evt,data){$rootScope.mainLoader.stackControlsWithAsyncData.length?(++$rootScope.mainLoader.stackControlsWithAsyncDataCounter,$q.all($rootScope.mainLoader.stackControlsWithAsyncData).then(function(data){--$rootScope.mainLoader.stackControlsWithAsyncDataCounter,item.callback&&item.callback(),0===$rootScope.mainLoader.stackControlsWithAsyncDataCounter&&($rootScope.mainLoader.stackControlsWithAsyncData=[])})):item.callback&&item.callback()}):$rootScope.$on(":formRendered",function(evt,data){$rootScope.mainLoader.stackControlsWithAsyncData.length?(++$rootScope.mainLoader.stackControlsWithAsyncDataCounter,$q.all($rootScope.mainLoader.stackControlsWithAsyncData).then(function(data){--$rootScope.mainLoader.stackControlsWithAsyncDataCounter,item.callback&&(PGU.fireEvents.formRendered=!0,item.callback()),0===$rootScope.mainLoader.stackControlsWithAsyncDataCounter&&($rootScope.mainLoader.stackControlsWithAsyncData=[])})):(PGU.fireEvents.formRendered=!0,item.callback&&item.callback())});break;case"postSubmit":$rootScope.$on(":postSubmit",function(evt,data){})}}},checkInFormStepRendered:function(stepRendered,fullPath){var result;if(stepRendered)for(var i in stepRendered)stepRendered.hasOwnProperty(i)&&!stepRendered[i]&&0===fullPath.indexOf(i)&&(result={},result.fullPath=i);return result},getDiffValues:function(value,oldValue){var result=[],newValues={},oldValues={};for(var k in value)value.hasOwnProperty(k)&&oldValue.hasOwnProperty(k)&&(Array.isArray(value)||function(type,obj){var jsClass=Object.prototype.toString.call(obj).slice(8,-1);return void 0!==obj&&null!==obj&&jsClass===type}("Object",value[k])?angular.equals(value[k],oldValue[k])||(newValues[k]=value[k],oldValues[k]=oldValue[k]):value[k]!==oldValue[k]&&(newValues[k]=value[k],oldValues[k]=oldValue[k]));return result.push(newValues,oldValues),result},getObjsFromItemVals:function(hash,value,param){for(var obj={},i=0;i<hash.length;i++)switch(param){case"elem":obj[hash[i]]=value[hash[i]];break;case"default":obj[hash[i]]=value.attrs[hash[i]].default;break;case"object"==typeof param:void 0!=param[hash[i]]?obj[hash[i]]=param[i]:obj[hash[i]]=value.hash[i];break;default:obj[hash[i]]=value[i]}return obj},initRules:function(elem,itemsInRules,map){var parsedRule;if(elem.hasRules&&elem.rules&&elem.rules.length){elem.rules=rule._make(elem.rules);for(var i=0,il=elem.rules.length;i<il;i++)parsedRule=elem.rules[i],parsedRule.parsed&&parsedRule.itemsInRule&&apiInner.getHashFromRule(elem.fullPath,parsedRule.itemsInRule,itemsInRules,"Form"==elem.className);map[elem.fullPath]=rule.getRulesMapping(elem)}},getHashFromRule:function(fullPath,itemsInRule,itemsInRules,isForm){for(var item,result,checkEmptyFullPath,i=0,il=itemsInRule.length;i<il;i++)item=itemsInRule[i],0!==i&&"var"===item.type&&(result=this.getDataFromRule(item.source),checkEmptyFullPath=fullPath&&!isForm?fullPath+"."+result.path:result.path,itemsInRules.hasOwnProperty(checkEmptyFullPath)||(itemsInRules[checkEmptyFullPath]=[]),itemsInRules[checkEmptyFullPath].indexOf(result.attr)<0&&itemsInRules[checkEmptyFullPath].push(result.attr))},getDataFromRule:function(rulePart){var arr=rulePart.split("@");return{path:arr[0],attr:arr[1]}},checkAttributeInWatchCollection:function(attrs,attrsToWatch,ruleAttrs){for(var item,i=0,il=ruleAttrs.length;i<il;i++)item=ruleAttrs[i],attrs.indexOf(item)<0&&(attrs.push(item),attrsToWatch.push("item."+ruleAttrs[i]))},initElementRule:function(parent,elem,ruleAttrs,api){for(var that=this,collectionWatch=[],i=0,il=ruleAttrs.length;i<il;i++)collectionWatch.push("item."+ruleAttrs[i]);$rootScope.$on(elem.fullPath+":ScopeApplied",function(evt,attrs){!1===$rootScope.setDraft&&Object.keys(elem.attrs||{}).forEach(function(i){elem.attrs.hasOwnProperty(i)&&ruleAttrs.indexOf(i)>-1&&api.afterMemberChanged(parent,elem.fullPath,i,elem[i],elem.attrs[i].default,elem)}),attrs.scope.$watchGroup(collectionWatch,function(newV,oldV){for(var oldHash,newHash,i=0;i<newV.length;i++)getDataToCompare(newV[i])!==getDataToCompare(oldV[i])&&(newHash=that.getObjsFromItemVals(ruleAttrs,newV),oldHash=that.getObjsFromItemVals(ruleAttrs,oldV),api.afterMemberChanged(parent,elem.fullPath,ruleAttrs[i],newHash[ruleAttrs[i]],oldHash[ruleAttrs[i]],elem))})})},controlSnapshot:function(parent_,filter_,context_){var parent=parent_,filter=filter_,context=context_,self=this;if(context=context||{},!parent.name)return context;switch(context["@"]={},typeof filter){case"string":case"undefined":return self.controlSnapshot(parent,function(){return!filter||parent.name==filter},context);case"function":var contextDog=context["@"],arrAttr=Object.keys(parent.attrs||{}),arrLength=arrAttr.length,keyAttr="";if(arrLength)for(var i=arrLength-1;i>=0;i--)keyAttr=arrAttr[i],parent.attrs[keyAttr]&&filter.call(keyAttr)&&(contextDog[keyAttr]=parent[keyAttr]);return context;case"object":throw"Todo: apply regExp this";default:throw"What the type?"}},snapshot:function(parent,filter,context){var self=this;if(context=self.controlSnapshot(parent,filter,context),(parent.items||[]).forEach(function(item,i){if(item){var name=item.name;item.hasRules?self.snapshot(item,filter,name?context[name]={}:context):name&&(context[name]=self.controlSnapshot(item,filter)),$.isEmptyObject(context[name])&&(context[name]=null)}}),"Form"===parent.className){var obj={};obj[parent.name]=context,context=obj}return context},rebound:function(snapshot,parent){var self=this,snapshotRoot=snapshot;"Form"==parent.className&&parent.name&&snapshot[parent.name]&&(snapshotRoot=snapshot[parent.name]),parent.name&&snapshotRoot["@"]&&(Object.keys(snapshotRoot["@"])||{}).forEach(function(i){parent[i]=snapshotRoot["@"][i]}),(parent.items||[]).forEach(function(item,i){var itemName=item.name;(!itemName||snapshotRoot&&snapshotRoot.hasOwnProperty(itemName)||"Form"===item.className&&snapshotRoot&&snapshotRoot[item.name]&&snapshotRoot[item.name].hasOwnProperty(itemName))&&("Form"===item.className?self.rebound(itemName?snapshotRoot[item.name][itemName]:snapshotRoot[item.name],item):item.hasRules?self.rebound(itemName?snapshotRoot[itemName]:snapshotRoot,item):self.rebound(snapshotRoot[itemName],item))})},applyWith:function(stuff,rule){try{rule.compiled.call(stuff)}catch(e){}},applyRules:function(controlParent,controlPath,attrName,rules){function wave(){return self._wave=self._wave||[]}var self=this;if(wave().push({context:controlParent,controlPath:controlPath,attrName:attrName,rules:rules}),!self._waveStarted){self._waveStarted=!0;try{for(;wave().length;)!function(){var w=wave().slice(0);wave().splice(0,wave().length),w.forEach(function(unit,i){var ss=self.snapshot(unit.context);unit.rules.forEach(function(itemRule){self.applyWith(ss,itemRule)}),self.rebound(ss,unit.context)})}()}finally{self._waveStarted=null}}},generateRequestUrl:function(path,search,orderId,searchParams){var locationOrigin,newPath,requestUrl,locationSearchStr="";locationOrigin=$window.location.origin?$window.location.origin:$location.protocol()+"//"+$location.host()+($location.port()?":"+$location.port():""),-1===path.indexOf("/form")&&-1===path.indexOf("/order/")&&(path+="/form"),newPath=path.replace(/\/(\d+)\/(-*\d+)\/(form|order\/)\S*$/,"/$1/$2/order/"),newPath+=orderId,$window.location.hash&&(locationOrigin+=$window.location.pathname+"#"),requestUrl=searchParams?newPath:locationOrigin+newPath;for(var k in search)search.hasOwnProperty(k)&&"result"!==k&&"step"!==k&&(locationSearchStr+=k+"="+search[k]);return searchParams?{path:requestUrl,search:locationSearchStr+searchParams}:requestUrl+=locationSearchStr?"?"+locationSearchStr:""},toBoolean:function(string){if("string"!=typeof string)return!!string;switch(string.toLowerCase().trim()){case"true":case"yes":case"1":return!0;case"false":case"no":case"0":return!1;default:return Boolean(string)}},getAttrType:function(element,attrName){var el=element.element||element;return el&&el.attrs&&el.attrs[attrName]&&el.attrs[attrName].type||"undefined"},serializeObj:function(obj){var result=[];for(var property in obj)result.push(encodeURIComponent(property)+"="+encodeURIComponent(obj[property]));return result.join("&")},getCookie:function(name){var matches=document.cookie.match(new RegExp("(?:^|; )"+name.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,"\\$1")+"=([^;]*)"));return matches?decodeURIComponent(matches[1]):void 0},setCookie:function(name,value,options){options=options||{};var expires=options.expires;if("number"==typeof expires&&expires){var d=new Date;d.setTime(d.getTime()+1e3*expires),expires=options.expires=d}expires&&expires.toUTCString&&(options.expires=expires.toUTCString()),value=encodeURIComponent(value);var updatedCookie=name+"="+value;for(var propName in options){updatedCookie+="; "+propName;var propValue=options[propName];!0!==propValue&&(updatedCookie+="="+propValue)}document.cookie=updatedCookie}};return apiInner}]),angular.module("serverForm.services").provider("$httpPguSyncSubmit",function(){function isSuccess(status){return 200<=status&&status<300}this.$get=["$httpBackendPguSyncSubmit",function($httpBackendPguSyncSubmit){return function(requestConfig,done,error,async){function doneWithSyncReq(status,response){status=Math.max(status,0),isSuccess(status)?done&&done(angular.fromJson(response)):error&&error(angular.fromJson(response))}if(angular.isDefined(async))return $httpBackendPguSyncSubmit(requestConfig.method,requestConfig.url,requestConfig.data,doneWithSyncReq,requestConfig.headers,void 0,requestConfig.withCredentials,void 0,async)}}]}).provider("$httpBackendPguSyncSubmit",function(){function createXhr(){return new window.XMLHttpRequest}function noop(){}function isPromiseLike(obj){return obj&&angular.isFunction(obj.then)}function urlResolve(url){var href=url;return msie&&(urlParsingNode.setAttribute("href",href),href=urlParsingNode.href),urlParsingNode.setAttribute("href",href),{href:urlParsingNode.href,protocol:urlParsingNode.protocol?urlParsingNode.protocol.replace(/:$/,""):"",host:urlParsingNode.host,search:urlParsingNode.search?urlParsingNode.search.replace(/^\?/,""):"",hash:urlParsingNode.hash?urlParsingNode.hash.replace(/^#/,""):"",hostname:urlParsingNode.hostname,port:urlParsingNode.port,pathname:"/"===urlParsingNode.pathname.charAt(0)?urlParsingNode.pathname:"/"+urlParsingNode.pathname}}function createHttpBackend($browser,createXhr,$browserDefer,callbacks,rawDocument,PGU){function jsonpReq(url,callbackId,done){var script=rawDocument.createElement("script"),callback=null;return script.type="text/javascript",script.src=url,script.async=!0,callback=function(event){removeEventListenerFn(script,"load",callback),removeEventListenerFn(script,"error",callback),rawDocument.body.removeChild(script),script=null;var status=-1,text="unknown";event&&("load"!==event.type||callbacks[callbackId].called||(event={type:"error"}),text=event.type,status="error"===event.type?404:200),done&&done(status,text)},addEventListenerFn(script,"load",callback),addEventListenerFn(script,"error",callback),rawDocument.body.appendChild(script),callback}return function(method,url,post,callback,headers,timeout,withCredentials,responseType,async){function timeoutRequest(){jsonpDone&&jsonpDone(),xhr&&xhr.abort()}function completeRequest(callback,status,response,headersString,statusText){void 0!==timeoutId&&$browserDefer.cancel(timeoutId),jsonpDone=xhr=null;try{callback(status,response,headersString,statusText)}catch(e){throw e}$browser.$$completeOutstandingRequest(noop)}if(async=angular.isUndefined(async)?!async:async,$browser.$$incOutstandingRequestCount(),url=url||$browser.url(),"jsonp"==angular.lowercase(method)){var callbackId="_"+(callbacks.counter++).toString(36);callbacks[callbackId]=function(data){callbacks[callbackId].data=data,callbacks[callbackId].called=!0};var jsonpDone=jsonpReq(url.replace("JSON_CALLBACK","angular.callbacks."+callbackId),callbackId,function(status,text){try{completeRequest(callback,status,callbacks[callbackId].data,"",text)}catch(e){PGU.Events.publish(":errorHttpSyncPguSubmit",e)}callbacks[callbackId]=noop})}else{var xhr=createXhr();xhr.open(method,url,async),angular.forEach(headers,function(value,key){angular.isDefined(value)&&xhr.setRequestHeader(key,value)}),xhr.onload=function(){var statusText=xhr.statusText||"",response="response"in xhr?xhr.response:xhr.responseText,status=1223===xhr.status?204:xhr.status;0===status&&(status=response?200:"file"==urlResolve(url).protocol?404:0);try{completeRequest(callback,status,response,xhr.getAllResponseHeaders(),statusText)}catch(e){PGU.Events.publish(":errorHttpSyncPguSubmit",e)}};var requestError=function(){try{completeRequest(callback,-1,null,null,"")}catch(e){PGU.Events.publish(":errorHttpSyncPguSubmit",e)}};if(xhr.onerror=requestError,xhr.onabort=requestError,withCredentials&&(xhr.withCredentials=!0),responseType)try{xhr.responseType=responseType}catch(e){if("json"!==responseType)throw e}xhr.send(post)}if(timeout>0)var timeoutId=$browserDefer(timeoutRequest,timeout);else isPromiseLike(timeout)&&timeout.then(timeoutRequest)}}noop.$inject=[];var removeEventListenerFn=function(element,type,fn){element.removeEventListener(type,fn,!1)},addEventListenerFn=function(element,type,fn){element.addEventListener(type,fn,!1)},urlParsingNode=document.createElement("a"),msie=document.documentMode;this.$get=["$browser","$window","$document","PGU",function($browser,$window,$document,PGU){return createHttpBackend($browser,createXhr,$browser.defer,$window.angular.callbacks,$document[0],PGU)}]}),angular.module("serverForm.services").factory("suggests",["$rootScope","$q","sharedExtServices","PGU","pguEsiaData",function($rootScope,$q,sharedExtServices,PGU,pguEsiaData){var api={},AutoFillHash={},suggests={init:function(apiLink){$rootScope.allSuggestDone=$q.defer(),api=apiLink;var that=this,dfFormRenderer=$q.defer(),dfService=sharedExtServices.autofillService.getSuggests({formId:$rootScope.settings.formId?$rootScope.settings.formId:$rootScope.formId}),allSuggestPromises=$q.all({formRendered:dfFormRenderer,service:dfService});PGU.fireEvents.formRendered?dfFormRenderer.resolve():PGU.Events.subscribe("","formRendered",function(){dfFormRenderer.resolve()}),allSuggestPromises.then(function(data){var groups=data.service.data?data.service.data:data.service.groups;data.service.error&&0!=data.service.error.code||!groups||($rootScope.settings.autofillValues=groups,that.setAllValues(),$rootScope.allSuggestDone.resolve())},function(err){})},setAllValues:function(){var that=this;for(var c in AutoFillHash)AutoFillHash[c].elements.forEach(function(item){item.values=that.getValuesByMnemonic(item.mnemonic.split(".")),api.find(item.fullPath).element.setAutofillValues&&api.find(item.fullPath).element.setAutofillValues(item.values)})},getGroupFromRequest:function(mnemonic){if($rootScope.settings.autofillValues){var group=$rootScope.settings.autofillValues.find(function(group){return group.mnemonic==mnemonic});return group=group?{mnemonic:group.mnemonic,multiple:group.multiple,text:group.text,values:[]}:{mnemonic:mnemonic,multiple:!0,text:"",values:[]}}},getAllValues:function(){var result,group,self=this,requestData=[];for(var c in AutoFillHash)AutoFillHash.hasOwnProperty(c)&&(result=[],AutoFillHash[c].elements.forEach(function(item){var listItem=api.find(item.fullPath),suggestValues=listItem.element.suggest&&listItem.element.suggest.values&&listItem.element.suggest.values.length?listItem.element.suggest.values:[],listItemValue=listItem.value(),mnemonic=item.mnemonic.split("."),mnemonicSimple=1===mnemonic.length?mnemonic[0]:mnemonic[1],isOtherDataMultiple=mnemonic.length>1&&"other_data"===mnemonic[0];listItem.inheritedVisibility()&&listItemValue&&(suggestValues.length?result.push({keyField:!isOtherDataMultiple||("lastname"===mnemonicSimple||"firstname"===mnemonicSimple),mnemonic:mnemonicSimple,text:"",value:listItemValue}):listItemValue&&result.push({keyField:!isOtherDataMultiple||("lastname"===mnemonicSimple||"firstname"===mnemonicSimple),mnemonic:mnemonicSimple,text:"",value:listItemValue}))}),result.length&&(group=self.getGroupFromRequest(c),group.values.push({fields:result}),requestData.push(group)));return requestData},remove:function(id,mnemonic){var that=this;sharedExtServices.autofillService.removeAutofillValue({suggestId:id,formId:$rootScope.settings.formId});var mnemonicArr=mnemonic.split(".");that.removeGroupValue(id,mnemonicArr[0]),that.setAllValues()},removeGroupValue:function(valueId,groupMnemonic){$rootScope.settings.autofillValues.forEach(function(group){group.mnemonic==groupMnemonic&&group.values.forEach(function(value,index,values){value.id==valueId&&(values=values.splice(index,1))})})},addMnemonic:function(mnemonic,fullPath){if(mnemonic&&fullPath){var mnemonicArr=mnemonic.split("."),groupId=mnemonicArr[0];AutoFillHash[groupId]?AutoFillHash[groupId].elements.push({fullPath:fullPath,mnemonic:mnemonic,values:this.getValuesByMnemonic(mnemonicArr)}):AutoFillHash[mnemonicArr[0]]={multiple:mnemonicArr.length>1,elements:[{fullPath:fullPath,mnemonic:mnemonic,values:this.getValuesByMnemonic(mnemonicArr)}],pathToNumber:{}},AutoFillHash[mnemonicArr[0]].pathToNumber[fullPath]=AutoFillHash[mnemonicArr[0]].elements.length-1}},set:function(mnemonic,valueId,fullPath,isSelectSuggest){function findFirstClone(fullPathStr){if(fullPathStr){var arr=fullPathStr.split(".");return(api.find(fullPathStr).clonable||api.find(fullPathStr).isClone)&&(api.find(fullPathStr).clonable()||api.find(fullPathStr).isClone())?fullPathStr:(arr.pop(),findFirstClone(arr.join(".")))}}var clonePanel={};findFirstClone(fullPath)&&(clonePanel={index:findFirstClone(fullPath).split(".").length-1,name:findFirstClone(fullPath).split(".").pop()});var mnemonicArr=mnemonic.split("."),hashGroup=AutoFillHash[mnemonicArr[0]];hashGroup&&hashGroup.elements.forEach(function(item){var element=api.find(item.fullPath),fieldValue="";if(clonePanel.name){if(item.fullPath.split(".")[clonePanel.index]===clonePanel.name){item.values[valueId]&&item.values[valueId].field&&item.values[valueId].field.value&&(fieldValue=item.values[valueId].field.value,element.element._changedByUser=!0),element.value&&!isSelectSuggest||element.value(fieldValue);var cloneIndex=clonePanel.name.replace(/^.*\[/,"").replace("]","");cloneIndex=cloneIndex!==clonePanel.name&&cloneIndex;var mnemonicCurrent=cloneIndex?mnemonicArr[0]+"["+cloneIndex+"]":mnemonicArr[0];suggests.createSuggestField(mnemonicCurrent,item.mnemonic,element.fullPath(),element,fieldValue)}}else item.values[valueId]&&item.values[valueId].field&&item.values[valueId].field.value&&(fieldValue=item.values[valueId].field.value,element.element._changedByUser=!0),element.value(fieldValue),suggests.createSuggestField(mnemonicArr[0],item.mnemonic,item.fullPath,element,fieldValue)})},createSuggestField:function(suggest,suggestField,fullPath,element,suggestValue){PGU.EsiaSuggestField=PGU.EsiaSuggestField||pguEsiaData.funnyObj(),PGU.EsiaSuggestField[suggest]=PGU.EsiaSuggestField[suggest]||pguEsiaData.funnyObj(),PGU.EsiaSuggestField[suggest][suggestField]=PGU.EsiaSuggestField[suggest][suggestField]||pguEsiaData.funnyObj(),PGU.EsiaSuggestField[suggest][suggestField][fullPath]=PGU.EsiaSuggestField[suggest][suggestField][fullPath]||{item:element,initState:suggestValue}},getValuesByMnemonic:function(mnemonicArr){var values=[];return $rootScope.settings.autofillValues&&$rootScope.settings.autofillValues.length&&$rootScope.settings.autofillValues.forEach(function(group){group.mnemonic==mnemonicArr[0]&&group.values.forEach(function(valuesItem){if("polis_oms"===group.mnemonic){var oms={};valuesItem.fields.forEach(function(item){oms[item.mnemonic]=item}),2!==oms.number.value.split(" ").length||oms.series||(valuesItem.fields.push({keyField:oms.number.keyField,mnemonic:"serial",text:oms.number.text,value:oms.number.value.split(" ")[0]}),oms.number.value=oms.number.value.split(" ")[1])}values.push({field:{},keyFields:[],id:valuesItem.id}),valuesItem.fields.forEach(function(fieldItem){(fieldItem.mnemonic==mnemonicArr[1]||fieldItem.mnemonic==mnemonicArr[0]&&1==mnemonicArr.length)&&(values[values.length-1].field=fieldItem),fieldItem.keyField&&values[values.length-1].keyFields.push(fieldItem)})})}),values},getHash:function(){return AutoFillHash},setHash:function(newHash){return AutoFillHash=JSON.parse(JSON.stringify(newHash))},getAutofillValuesOriginal:function(){return $rootScope.settings.autofillValues},controlItemWithSuggest:function(item,ui){$rootScope.allSuggestDone&&$rootScope.allSuggestDone.promise.then(function(){if($rootScope.initApplySuggests=$rootScope.initApplySuggests||[],item.mnemonicAutofill){ui&&(ui.suggest.hasValues=item.suggest&&item.suggest.values&&item.suggest.values.some(function(i){return i.field&&i.field.value})),"FieldTextDate"!==item.className&&"FieldRadio"!==item.className||(item.suggest=!0);if(item.mnemonicAutofill.split(".").length>1){if(!item.value){var sgArray=item.mnemonicAutofill.split("."),groupSg=sgArray[0];sgArray[1];if(suggests.getHash()[groupSg]){var sgElArray=suggests.getHash()[groupSg].elements||[];if(~$rootScope.initApplySuggests.indexOf(groupSg))return;sgElArray.forEach(function(sge){1===sge.values.length&&suggests.set(item.mnemonicAutofill,0,sge.fullPath)}),$rootScope.initApplySuggests.push(groupSg)}}}else!suggests.getHash()[item.mnemonicAutofill]||suggests.getHash()[item.mnemonicAutofill].multiple||1!==suggests.getHash()[item.mnemonicAutofill].elements.length||item.value||suggests.set(item.mnemonicAutofill,0,item.fullPath)}})}};return suggests}]),angular.module("serverForm.services").factory("PGU",["$rootScope","$compile","$routeParams","$http","CONFIG","$q",function($rootScope,$compile,$routeParams,$http,CONFIG,$q){var PGU={Events:{publish:function(event,data){$rootScope.$broadcast(event,data)},subscribe:function(component,event,callback){$rootScope.$on(component+":"+event,function(evt,data){callback.call(this,evt,data)})},
unsubscribe:function(component,event){$rootScope.$off(component+":"+event)}},fireEvents:{formRendered:!1},copy:function(data){if(!data)return data;if(Array.isArray(data))return data.map(function(item){if(angular.isObject(item)){var obj={};return Object.keys(item).forEach(function(key){obj[key]=item[key]}),obj}});if(angular.isObject(data)){var obj={};return Object.keys(data).forEach(function(keyObj){obj[keyObj]=data[keyObj]}),obj}return data},medExamData:{medObject:{},needMedParams:!1},timeSlotData:{visitTime:"",orgName:"",orgAddress:"",selectedHallTitle:"",comment:""},payData:{uin:"",paymentPurpose:"",recipientTitle:"",sum:"",sumWithDiscount:""},toggleRemovedClone:function(clone,isNewClone){var index=removedClones.indexOf(clone);-1!==index||isNewClone?index>-1&&isNewClone&&removedClones.splice(index,1):removedClones.push(clone)},getRemovedClones:function(){return removedClones},checkElementOnRemovedClone:function(fullPath){return this.getRemovedClones().some(function(clone){return fullPath.indexOf(clone)>-1})},state:{modalDialogShow:!1},addToSessionAttrs:function(name,value){var isCorrectValue=null!==value&&void 0!==value&&("string"==typeof value||"boolean"==typeof value||"number"==typeof value);if(name&&isCorrectValue)if(otherSessionAttributesKeys.includes(name)){for(var i=0;i<otherSessionAttributes.length;i++)if(otherSessionAttributes[i].name===name){otherSessionAttributes[i].value=value.toString();break}}else otherSessionAttributesKeys.push(name),otherSessionAttributes.push({name:name,value:value.toString()})},getOtherSessionAttrs:function(){return PGU.otherSessionAttrsSets.length&&PGU.otherSessionAttrsSets.forEach(function(item){PGU.addToSessionAttrs(item.name,item.field.attr(item.key))}),otherSessionAttributes},otherSessionAttrsSets:[]},removedClones=[],otherSessionAttributes=[],otherSessionAttributesKeys=[];return $rootScope.$off=function(eventName){var listeners=this.$$listeners[eventName];if(listeners)for(var i=0,il=listeners.length;i<il;i++)listeners.splice(i,1)},PGU}]),angular.module("serverForm.services").factory("ruleHelpers",["$rootScope","$compile","RULE_REPLACE_REGEXP","RULE_SYNTAX_TOKEN","RULE_SYNTAX",function($rootScope,$compile,RULE_REPLACE_REGEXP,RULE_SYNTAX_TOKEN,RULE_SYNTAX){function Operator(opts){$.extend(this,opts),this.order=Operator.count++}var _parsed=[],parser={create:function(opts){var rule={};switch($.extend(rule,opts),rule.type){case"scalar":rule.value=new Function("","return "+rule.source)}return rule},parse:function(rule){for(var code=this._prepare(rule),_parsedCopy=_parsed.concat();!/^\d+$/.test(code);){var prev=code;if(syntax.operators().each(function(){var prev=code;return(code=code.replace(this.find,this.replace))==prev}),code==prev)throw"Error on parse statement: "+code}return{_parsed:_parsed[code],_items:_parsedCopy}},_prepare:function(rule){var parsed=_parsed=[],self=this;return rule.replace(RULE_REPLACE_REGEXP.anyScalarOrAttrRegexp,function(any,scalar,variable){if(!variable)try{var testAny=JSON.parse(any),check=JSON.parse(testAny);check&&"object"==typeof check&&(any=testAny)}catch(e){}return parsed.push(self.create({type:variable?"var":"scalar",source:any})),parsed.length-1})},struct:function(){var h={};return"operator"==this.type?(h[this.operator.name]=$.map(this.args,function(p){return p.struct()}),h):this.type+": "+this.source},compile:function(rule,negative){return new Function("","with(this){"+this.getHelpersFunctions()+"\n"+this.toString(rule,!0,negative)+"}")},toString:function(rule,needCompile,negative){var self=this;switch(rule.type){case"var":return needCompile?rule.source.split("@").concat(["value"]).slice(0,2).join('["@"].'):rule.source;case"operator":if("?:"===rule.operator.name)return"("+self.toString(rule.args[0]||"~",needCompile)+"?"+self.toString(rule.args[1]||"~",needCompile)+":"+self.toString(rule.args[2]||"~",needCompile)+")";if(["<=",">=","<",">"].indexOf(rule.operator.name)>-1)return"(toDateOrDecimal("+self.toString(rule.args[0]||"~",needCompile)+")"+rule.operator.name+"toDateOrDecimal("+self.toString(rule.args[1]||"~",needCompile)+"))";if("#"===rule.operator.name){var firstArg=self.toString(rule.args[0]||"~",needCompile),secondArg=self.toString(rule.args[1]||"~",needCompile);return"((("+firstArg.split('["@"]')[0]+'["@"].isMultiple ? '+firstArg+'.split(",") : '+firstArg+') || "").indexOf('+secondArg+") > -1)"}var glue=$.map(rule.args,function(arg,index){return"="===rule.operator.name&&1===index&&negative?"(("+(arg?self.toString(arg,needCompile):"~~~")+") === false)":arg?self.toString(arg,needCompile):"~~~"});return glue="="!==rule.operator.name?glue.join(rule.operator.name):"var elementsIncludeClones = getAllItems('"+glue[0]+'\', this); \nelementsIncludeClones.forEach(function(item) {item.element["@"][item.property] = '+glue[1]+"});","="==rule.operator.name?glue:"("+glue+")";case"scalar":return rule.source;default:throw"Unknown type of parsed: "+rule.type}},resultType:function(rule,container){var self=this;switch(rule.type){case"operator":return self.resultType(rule.operator,this);case"var":var fieldAttr=rule.source.split("@");return"all"==fieldAttr[1]?"array":container.find(fieldAttr[0]).attrs[fieldAttr[1]||"value"].type;case"scalar":return"string";default:return rule.preciselyType||rule.type}},getHelpersFunctions:function(){function toDateOrDecimal(str){try{return moment&&moment(str,"DD.MM.YYYY",!0).isValid()?moment(str,"DD.MM.YYYY"):parseFloat(str.replace(/,/g,"."))}catch(e){try{return parseFloat(str.replace(/,/g,"."))}catch(e){return str}}}function getAllItems(expression,context){function getArrClones(current){current["@"].hasOwnProperty("isCloneContainer")&&current["@"].isCloneContainer&&fullPathArr[index+2]?(index+=2,Object.keys(current).forEach(function(key){"@"!==key&&(current[key]["@"].isClone||current[key]["@"].clonable)&&current[key]["@"].name===fullPathArr[index-1]&&getArrClones(current[key][fullPathArr[index]])})):index<fullPathArr.length-1?(index++,getArrClones(current[fullPathArr[index]])):result.push({element:current,property:property})}var startElement,items=expression.split('["@"].'),fullPathArr=items[0].split("."),property=items[1],result=[],index=0;return context[fullPathArr[index]]["@"].hasOwnProperty("presetType")?(index=1,startElement=context[fullPathArr[0]][fullPathArr[1]]):startElement=context[fullPathArr[0]],getArrClones(startElement),result}return[toDateOrDecimal,getAllItems].map(function(f){return f.toString()}).join("\n")}};Operator.count=0,$.extend(Operator.prototype,{firstArgType:function(){if(this.args){var up=this.order,first=this.args[this.editor[0]],ops=syntax.byResult(first).map(function(){return this.order<up?this.firstArgType():null}).get();return ops.length?$.unique(ops):[first]}},resultType:function(parsed){return this.result},argType:function(i,parsed){return this.args[i]},expectedArgType:function(i,parsed){return this.args[i]}});var syntax={init:function(){this._operators=$.extend.apply($,$.map(RULE_SYNTAX,function(op,name){var argTypes=[],operator=new Operator($.extend({},op,{name:name,find:new RegExp(op.tmpl.replace(/\w+/g,function(type){return argTypes.push(type),RULE_SYNTAX_TOKEN.tokenPlace}),"g"),replace:function(found){var args=[],parsed=_parsed;return found.replace(/\d+/g,function(index){args.push(parsed[index])}),parsed.push(parser.create({type:"operator",operator:operator,args:args,source:found.replace(/\d+/g,function(index){return parsed[index].source})})),parsed.length-1},args:argTypes,length:argTypes.length})),s={};return s[name]=operator,s}))},operators:function(){return $($.map(this._operators,function(op){return op}))},byResult:function(result){if(!result||"mixed"==result)return this.operators();var resultRegExp=result instanceof RegExp?result:new RegExp("^"+result+"$");return this.operators().map(function(){return resultRegExp.test(this.result)?this:null})},byName:function(name){var op=this._operators[name];return $(op?[op]:[])},byFirstArgType:function(expectedFirst){return this.operators().filter(function(){if(!this.args)return!1;if("mixed"==expectedFirst)return!0;var firstArgType=this.args[this.editor[0]];return"mixed"==firstArgType||firstArgType==expectedFirst})}};syntax.init();var replace=syntax._operators["="].replace;return syntax._operators["="].replace=function(){for(var index=replace.apply(this,arguments),parsed=_parsed,args=parsed&&parsed.length&&parsed[index]&&parsed[index].args?parsed[index].args:[],i=args.length-2;i>=0;i--)if("var"!=args[i].type)throw"Invalid left-hand side in assignment";return index},syntax._operators["()"]=new Operator({find:/\((\d+)\)/g,replace:function(any,expr){return expr}}),{parser:parser,syntax:syntax}}]).factory("rule",["$rootScope","$compile","ruleHelpers",function($rootScope,$compile,ruleHelpers){return{init:function(code,uuid,negative,originalCode){var parsed,compiled,itemsInRule,parsedObj,sourceCode;code="string"==typeof code?code:"",originalCode="string"==typeof originalCode?originalCode:"",sourceCode=originalCode||code;var errors=[];try{parsedObj=code?ruleHelpers.parser.parse(code):null,parsedObj?(parsed=parsedObj._parsed,itemsInRule=parsedObj._items):parsed=null}catch(e){parsed=null,errors.push("Rule parse: "+e)}try{compiled=ruleHelpers.parser.compile(parsed,negative)}catch(e){compiled=null,errors.push("Rule compile: "+e)}var result={itemsInRule:itemsInRule,parsed:parsed,sourceCode:sourceCode,compiled:compiled,negative:negative,originalRule:""};return uuid&&(result.uuid=uuid),result},_make:function(data){for(var rule,rules=[],self=this,i=0,il=data.length;i<il;i++)if("("===data[i][0]){var left=data[i].split(/[()]+/)[1],right=data[i].replace("("+left+")",""),id=uuid&&uuid.v4()||Math.random().toString(36).substr(2,9);left.split(";").forEach(function(str){if(str){var negative;str.indexOf("!")>-1&&(negative=!0,str=str.replace("!","")),rule=self.init(str+right,id,negative,data[i]),rule.parsed&&rules.push(rule)}})}else rule=self.init(data[i]),rule.parsed&&rules.push(rule);return rules},toModel:function(rule){return rule.parsed?ruleHelpers.parser.toString(rule.parsed):""},toString:function(){return this.toModel()},editor:function(){var rule=this,$ed=PGU.create({className:"FieldText",value:this.sourceCode}).render();$ed.find("label").remove(),$ed.find(".PGU-FieldTextInput").css("marginLeft",0);var $inp=$ed.find("input:first").bind("keyup change",function(){Rule.call(rule,$(this).val()),rule.errors.length?$inp.css("color","red"):$inp.removeAttr("style")});return rule.errors.length?$inp.css("color","red"):$inp.removeAttr("style"),$ed},getItemsInRules:function(item,isParsedRules){var result=[];if(item.rules&&item.rules.length){(isParsedRules?item.rules:this._make(item.rules)).forEach(function(rule){rule.itemsInRule.forEach(function(it){if("var"===it.type){var pathInsideRule=it.source.split("@")[0],pathToPush=("Form"!==item.className?item.fullPath+".":"")+pathInsideRule;result.includes(pathToPush)||(isParsedRules?result.push(pathToPush):result.push({fullPath:pathToPush,pathInside:pathInsideRule}))}})})}return result},getRulesMapping:function(item){var mapping={};return item.rules&&item.rules.length&&item.rules.forEach(function(rule){for(var rulePushedTo=[],i=0;i<rule.itemsInRule.length;i++){var it=rule.itemsInRule[i],pathNProp=it.source.split("@"),pathInsideRule=pathNProp[0],attribute=pathNProp[1],pathToPush=("Form"!==item.className?item.fullPath+".":"")+pathInsideRule;"var"!==it.type||rulePushedTo.includes(pathToPush+"@"+attribute)||(mapping[pathToPush]=mapping[pathToPush]||{},mapping[pathToPush][attribute]=mapping[pathToPush][attribute]||[],mapping[pathToPush][attribute].push(rule),rulePushedTo.push(pathToPush+"@"+attribute))}}),mapping}}}]),angular.module("serverForm.services").factory("Validators",["$rootScope",function($rootScope){return{isInvalid:function(list,value,validators){var validator;if($rootScope.isDesigner)return!1;for(var i=0;i<list.length;i++){var v=list[i];switch(validators&&validators.length&&(validator=validators.filter(function(item){return item.mnemonic===v.mnemonic})),validator&&validator.length&&(v=validator[0]),v.type){case"native":return!new Function("value","if("+v.regexp+") {return true;} else {return false;}")(value);case"regexp":default:var expr=new RegExp(v.regexp,v.params||"g");if(void 0!==value&&null!==value&&-1==value.toString().search(expr)){var message={};return"alwaysFalse"===v.mnemonic&&list[i].message?(message.text=list[i].message,message.mnemonic=list[i].mnemonic):(message.text=v.message,message.mnemonic=v.mnemonic),message}}}return!1}}}]),angular.module("serverForm.services").factory("postMessage",["$rootScope",function($rootScope){return{send:function(data){window.top.postMessage(JSON.stringify(data),"*")}}}]),angular.module("serverForm.services").factory("textResources",["$rootScope","sharedExtServices",function($rootScope,sharedExtServices){function findTextResourceMnemonic(item){if(item&&item.extTextResource&&resourceMnemonics.push(item.extTextResource),item&&item.items&&item.items.length)for(var i=0;i<item.items.length;i++)findTextResourceMnemonic(item.items[i])}function getResourcesFromServer(){var params={group:"pgu_hint",code:resourceMnemonics.join("|"),language:"ru"};sharedExtServices.hintsService.getList(params).then(function(res){res&&res.data&&res.data.localizedStrings&&res.data.localizedStrings.forEach(function(item){resources[item.code]=item.message})})}var resources={},resourceMnemonics=[];return{getResourceByMnemonic:function(mnemonic){return resources[mnemonic]},loadResources:function(data){findTextResourceMnemonic(JSON.parse(data.content)),resourceMnemonics.length&&getResourcesFromServer()}}}]),angular.module("serverForm.services").factory("translate",["$rootScope","$q","cookie","sharedExtServices",function($rootScope,$q,cookie,sharedExtServices){function findMnemonicHint(item){if(item&&item.mnemonicHint&&codes.hints.push(item.mnemonicHint),item&&item.items&&item.items.length)for(var i=0;i<item.items.length;i++)findMnemonicHint(item.items[i])}function setTranslate(key){cookie.setCookie("pgu_translate",key),selectedLang=$rootScope.settings.selectedLanguage=key,$rootScope.$broadcast("changeLang",{key:key})}function loadTranslate(key){var queries={labels:loadLabels(key),validators:loadValidators(codes.validators,key),hints:loadHints(codes.hints,key)};$rootScope.settings&&$rootScope.settings.formId&&$q.all(queries).then(function(result){setTranslate(key),translates[key]||(translates[key]=[]),angular.forEach(result.labels.localizedStrings,function(item){translates[key][item.code]=item.message}),angular.forEach(result.validators.localizedStrings,function(item){translates[key][item.code+".validator"]=item.message}),angular.forEach(result.hints.localizedStrings,function(item){translates[key][item.code+".hint"]=item.message})})}function loadLabels(key){return sharedExtServices.getLangLabel($rootScope.settings.formId,key)}function loadValidators(codesList,key){return sharedExtServices.getLangValidators(codesList,key)}function loadHints(codesList,key){return sharedExtServices.getLangHints(codesList,key)}var translates=[],codes={validators:[],hints:[]},selectedLang=cookie.getCookie("pgu_translate")||"ru";return{use:function(key){key===selectedLang&&translates[key]||(key||(key=selectedLang),translates[key]||"ru"===key?setTranslate(key):loadTranslate(key))},get:function(){return selectedLang},getLangList:function(){return translates[selectedLang]},setRuLang:function(key,text,index){translates.ru||(translates.ru=[]),translates.ru[void 0!==index?key+"["+index+"]":key]=text},parseFormByTranslate:function(data){var lang=data.form.content["form.selectedLanguage"];codes.validators=data.validators.map(function(item){return item.mnemonic}),-1===codes.validators.indexOf("required")&&codes.validators.push("required"),findMnemonicHint(JSON.parse(data.content)),this.use(lang&&lang.value?lang.value:selectedLang)}}}]),angular.module("serverForm.services").factory("cookie",[function(){return{getCookie:function(name){var matches=document.cookie.match(new RegExp("(?:^|; )"+name.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,"\\$1")+"=([^;]*)"));return matches?decodeURIComponent(matches[1]):void 0},setCookie:function(name,value,options){options=options||{};var expires=options.expires;if("number"==typeof expires&&expires){var d=new Date;d.setTime(d.getTime()+1e3*expires),expires=options.expires=d}expires&&expires.toUTCString&&(options.expires=expires.toUTCString()),value=encodeURIComponent(value);var updatedCookie=name+"="+value;for(var propName in options){updatedCookie+="; "+propName;var propValue=options[propName];!0!==propValue&&(updatedCookie+="="+propValue)}document.cookie=updatedCookie}}}]),angular.module("serverForm.services").factory("reusePayment",["$rootScope","$q","sharedExtServices","api","PGU","HealthSrv",function($rootScope,$q,sharedExtServices,api,PGU,HealthSrv){function getOptionsWithValues(){function getValue(path){return api.find(path).value()}var result={orderId:$rootScope.env.orderId};return OPTIONS.reusePaymentDepartment&&(result.orgCode=getValue(OPTIONS.reusePaymentDepartment)),result.options={},OPTIONS.optionsKeys&&(result.options={},OPTIONS.optionsKeys.forEach(function(opt){result.options[opt]=getValue(OPTIONS[opt])})),result}var OPTIONS={};return{setPreSubmitChecking:function(){if(!api.__checkHasPaymentToReUse){var self=this;api.__checkHasPaymentToReUse=function(){api.addRequestToQueue(function(mainDefer){var params=getOptionsWithValues();sharedExtServices.payment.getListPaymentsInfo(params).then(function(response){var data=response.data;data&&data.payment&&data.payment.length?self.showPopup(data.payment).then(function(uin){api.shade(!0),PGU.addToSessionAttrs("reusePaymentUin",uin),mainDefer.resolve()},mainDefer.resolve):mainDefer.resolve()},mainDefer.resolve)})}}},showPopup:function(payments){var self=this,df=$q.defer(),start=[{className:"Panel",label:"",items:[{className:"label",value:'<span class="plain-text">Ранее вы уже оплачивали пошлину по этой услуге, но не воспользовались ей.</span>'}]}],paymentBlocks=payments.map(function(payment){return{className:"Panel",label:"",modificator:"payment-block",items:[{className:"Panel",label:"",items:[{className:"label",value:'<span class="plain-text">Сумма: </span><span class="PGU-Title-H3">'+payment.amount+" руб.</span>"}]},{className:"Panel",label:"",modificator:"md-offset-top-12",items:[{className:"label",value:'<span class="plain-text">УИН: </span><span class="PGU-Title-H3">'+payment.uin+"</span>"}]},{className:"Panel",label:"",modificator:"payment-block-buttons",items:[{className:"button",label:"Использовать пошлину",func:function(){df.resolve(payment.uin),self.sendHealth(payment.uin),api.closeApiPopup()}},{className:"label",value:'<a href="'+payment.link+'" target="_blank">Посмотреть платеж</a>'}]}]}}),end=[{className:"Panel",label:"",items:[{className:"label",value:'<span class="plain-text"> Или вы можете дождаться выставления новой пошлины ведомством и оплатить ее.</span>'}]},{className:"Panel",label:"",grid:"1/4",gridTablet:"1/3",items:[{className:"button",color:"white",label:"Оплатить позже",func:function(){df.reject(),self.sendHealth(),api.closeApiPopup()}}]}],popup={title:"Хотите ли вы использовать ранее оплаченную пошлину?",actionOnClose:function(){df.reject()}};return popup.items=[].concat(start).concat(paymentBlocks).concat(end),api.createPopup(popup),$rootScope.mainLoader.__shadeCounter=0,api.shade(!1),df.promise},initialize:function(params){if(this.setPreSubmitChecking(),params.reusePaymentDepartment&&(OPTIONS.reusePaymentDepartment=params.reusePaymentDepartment),params.reusePaymentOptions){var optionsKeys=params.reusePaymentOptions.split(",");optionsKeys&&optionsKeys.length&&(optionsKeys.forEach(function(option){params.hasOwnProperty(option)&&(OPTIONS[option]=params[option])}),OPTIONS.optionsKeys=optionsKeys)}},sendHealth:function(uin){var health={type:"reuseDuty",orderId:$rootScope.env.orderId};uin&&(health.addParams={billNumber:uin}),HealthSrv.checkHealthWhenDone(health,{})}}}]),angular.module("serverForm.services").factory("commonServices",["sharedExtServices","$timeout","$rootScope","apiInner",function(sharedExtServices,$timeout,$rootScope,apiInner,api){return{leadingZero:function(num){return num<10?"0"+num:num},getDraftTimeout:function(){return 6e4},saveDraft:function(options,callback){var request={orderId:options.orderId,draftId:options.draftId,draftVersion:options.draftVersion,userSelectedRegion:$rootScope.settings.regionId,form:{mnemonic:$rootScope.settings.mnemonic,version:"12345",content:options.draft}};sharedExtServices.saveDraft(request,function(data){data&&data.error&&0==data.error.code&&callback(data)})}}}]),angular.module("serverForm.services").factory("stepByStepInit",["$rootScope","$timeout","$q","$document","$window","api","sharedExtServices","FORM_STEPS_PAGE_SIZE","PGU","CUSTOM_STEPS","suggests",function($rootScope,$timeout,$q,$document,$window,api,sharedExtServices,FORM_STEPS_PAGE_SIZE,PGU,CUSTOM_STEPS,suggests){return{getFirstSteps:function(data){api._afterMemberChangedLazy={};var formItems,form=JSON.parse(data.form||{}),startStep=data.startStep||1,systemData=data.systemData,endStep=startStep+FORM_STEPS_PAGE_SIZE.VALUE,result={};return data.form&&form.items&&form.items.length&&(formItems=form.items.slice(startStep-1,endStep),result.remainingSteps=systemData&&"undefined"!==systemData.allStepsCount?Number(systemData.allStepsCount):form.items.length,form.items=formItems,result.form=form,result.startStep=endStep,result.isVisibleFirstSteps=!0,formItems.forEach(function(i){!1===i.visible&&(result.isVisibleFirstSteps=!1)})),result},getRemainingStepsByAction:function(data){var loadTimeout,self=this,startStep=data.startStep,resolved=!0;$document.off("scroll.loadSteps").on("scroll.loadSteps",_.throttle(function(){$timeout.cancel(loadTimeout);var $epguWidgetBottom,$epguWidget=$window.document.querySelector(".PGU-widgets-container");if(!$epguWidget)return $document.off("scroll.loadSteps"),void PGU.Events.publish(":stopListenOutsideScroll");$epguWidgetBottom=$epguWidget.getBoundingClientRect().bottom;var clientHeight=$window.document.documentElement.clientHeight;resolved&&clientHeight+16>=$epguWidgetBottom&&($rootScope.lazyloader.show=!0,data.startStep=startStep,data.action="scroll",resolved=!1,self.getRemainingSteps(data).then(function(result){result?(startStep=result.startStep,$rootScope.lazyloader.show=!1,resolved=!0):($rootScope.lazyloader.show=!1,$document.off("scroll.loadSteps"),PGU.Events.publish(":stopListenOutsideScroll"))},function(error){$rootScope.lazyloader.show=!1}))},150)),loadTimeout=$timeout(function(){$document.off("scroll.loadSteps"),self.getRemainingSteps(data)},15e3),!1===data.isVisibleFirstSteps&&$document.trigger("scroll.loadSteps")},afterMemberChangedLazySet:function(){var apiElement,item;if(api._afterMemberChangedLazy)for(var k in api._afterMemberChangedLazy)if(api._afterMemberChangedLazy.hasOwnProperty(k)){item=api._afterMemberChangedLazy[k],apiElement=api.find(k);for(var j in item)item.hasOwnProperty(j)&&api.afterMemberChanged(apiElement.parent().element,apiElement.element.fullPath,j,item[j],item[j],apiElement.element)}},getElementsStateFromLazyLoad:function(fullPath){var result=[],FHLL=api._FormHashLazyLoad,attributesLazy=["visible","value","label","title","text_value","required","checked","stepNumber","disabled"];for(var i in FHLL)if(FHLL.hasOwnProperty(i)&&0===i.indexOf(fullPath)){var element=FHLL[i]?FHLL[i].element:null,obj={fullPath:i,attributes:[]};for(var j in element)element.hasOwnProperty(j)&&~attributesLazy.indexOf(j)&&obj.attributes.push({value:element[j],name:j});obj.attributes.length&&result.push(obj)}return result},getRemainingSteps:function(data){var self=this,$defer=data.$defer||$q.defer(),offset=data.offset||FORM_STEPS_PAGE_SIZE.VALUE,endStep=data.startStep+offset;return data.startStep>data.remainingSteps?($defer.resolve(),PGU.Events.publish(":stopListenOutsideScroll"),self.addedCustomSteps||($rootScope.navPanel=$rootScope.checkNavPanelInit(api.getForm()[0]),$rootScope.navPanel&&api.getForm()[0].items.push($rootScope.navPanel),self.addCustomSteps(),api.setSubmitBtnName()),$rootScope.lazyloader.show=!1):sharedExtServices.formsService.getNextSteps({draftId:data.draftId,startStep:data.startStep,mnemonic:data.mnemonic,offset:offset}).then(function(response){var form=api.getForm()[0],content=response.data&&response.data.content||"[]",draft=response.data&&response.data.form&&response.data.form.content||{},steps=JSON.parse(content),stepsElementsStateFromLazyLoad=[];steps.forEach(function(i){var stepElementsStateFromLazyLoad=self.getElementsStateFromLazyLoad(i.fullPath);stepsElementsStateFromLazyLoad=stepsElementsStateFromLazyLoad.concat(stepElementsStateFromLazyLoad),i.visibleStep=!0,"NavPanel"===i.className&&(i.defaultVisible=i.visible),api._FormStepRendered[i.fullPath]=!1,i.shaded=!0,data.form.items.push(i),api.replacePersonalData([i],i.fullPath),"NavPanel"===i.className&&($rootScope.navPanel=$rootScope.checkNavPanelInit(api.getForm()[0])),api.initAttrs([i],null,form,!0),$rootScope.rTreeRunner(i)}),suggests.setAllValues(),self.afterMemberChangedLazySet(),draft&&api.setDraft(draft).then(function(){var isNotVisibleSteps=!1;stepsElementsStateFromLazyLoad.length&&stepsElementsStateFromLazyLoad.forEach(function(element){var formElement=api.find(element.fullPath),strategy=formElement.element.strategy;"ImageEditor"!==formElement.element.className&&element.attributes.forEach(function(attribute){(!strategy&&("value"===attribute.name&&formElement.element.__isSettedCall||"value"!==attribute.name)||strategy&&"value"!==attribute.name)&&formElement[attribute.name](attribute.value)})}),steps.forEach(function(i){!1!==i.visible&&(isNotVisibleSteps=!0)}),endStep<=data.remainingSteps&&(!data.action||data.action&&!isNotVisibleSteps)?self.getRemainingSteps({form:data.form,remainingSteps:data.remainingSteps,startStep:endStep,draftId:data.draftId,mnemonic:data.mnemonic,offset:offset,$defer:$defer,action:data.action}):endStep>data.remainingSteps?(self.addedCustomSteps||($rootScope.navPanel&&api.getForm()[0].items.push($rootScope.navPanel),self.addCustomSteps(),api.setSubmitBtnName()),$defer.resolve()):$defer.resolve({startStep:endStep})})},function(){$defer.reject()}),$defer.promise},addCustomSteps:function(){this.addedCustomSteps=!0;var smsStep,captchaStep,form=api.getForm()[0];$rootScope.env.systemData=$rootScope.env.systemData||{},$rootScope.env.serviceFormInfo.SMS_CONFIRM&&(smsStep=CUSTOM_STEPS.addSmsConfirmStep({formStructure:form,api:api,systemData:$rootScope.env.systemData}))&&(smsStep.visibleStep=!0,api.initAttrs([smsStep],null,form)),$rootScope.env.systemData.isNeedCaptcha&&(captchaStep=CUSTOM_STEPS.addCaptchaStep({formStructure:form,api:api}))&&(captchaStep.visibleStep=!0,api.initAttrs([captchaStep],null,form))},readCookie:function(name){for(var nameEQ=name+"=",ca=document.cookie.split(";"),i=0;i<ca.length;i++){for(var c=ca[i];" "===c.charAt(0);)c=c.substring(1,c.length);if(0==c.indexOf(nameEQ))return c.substring(nameEQ.length,c.length)}return null}}}]),angular.module("serverForm.services").factory("pguSaveDataEsiaSrvc",["apiInner","$rootScope","$compile","$routeParams","$http","CONFIG","$q","sharedExtServices","api","Validators",function(apiInner,$rootScope,$compile,$routeParams,$http,CONFIG,$q,sharedExtServices,api,Validators){return{save:function(nameMethod,data,fullPath,validators,esiaValue,defer){$rootScope.editor||esiaValue||(angular.forEach(data,function(value){Validators.isInvalid(validators,value,api.formValidators)}),sharedExtServices.dataEsia.save(nameMethod,data,function(){defer&&defer.resolve("200_save")},function(){defer&&defer.resolve("not200_save")}))}}}]),angular.module("serverForm.services").factory("pguDrivingLicenseSrvc",["apiInner","$rootScope","$compile","$routeParams","$http","CONFIG","$q","sharedExtServices","api","Validators","PGU",function(apiInner,$rootScope,$compile,$routeParams,$http,CONFIG,$q,sharedExtServices,api,Validators,PGU){return{srvcDefer:{},initPopup:function(scope){var that=this;scope.ui.needChange=!1,this.srvcDefer=$q.defer(),api.beforeSubmit(this.srvcDefer,scope),PGU.Events.subscribe(scope.item.fullPath,"hidePopup",function(){scope.ui.popupShowDefer=!1,that.srvcDefer.resolve("DL_hide")}),PGU.Events.subscribe("","submitForm",function(){scope.item.driver_license_series==scope.dataStrategy.driver_license_series&&scope.item.driver_license_number==scope.dataStrategy.driver_license_number&&scope.item.driver_license_issue_date==scope.dataStrategy.driver_license_issue_date&&scope.item.driver_license_valid_till==scope.dataStrategy.driver_license_valid_till||(scope.ui.needChange=!0),scope.item.driver_license_issue_date&&scope.item.driver_license_valid_till||(scope.ui.needAdd=!0),scope.ui.needAdd&&scope.ui.needChange&&(scope.ui.needAdd=!1),$rootScope.$apply(),scope.ui.needAdd||scope.ui.needChange?(scope.ui.showESIAPopup=!0,$rootScope.$apply()):that.srvcDefer.resolve("DLS_withoutPopup")})},setFullData:function(scope){var wg=api.find(scope.item.fullPath+".PanelControls"),series=wg.find("PanelSeries.Series"),number=wg.find("PanelNumber.Number"),date=wg.find("PanelDate.Date"),validTo=wg.find("PanelValidTo.ValidTo");series&&series.attr("value",scope.item.driver_license_series),number&&number.attr("value",scope.item.driver_license_number),date&&date.attr("value",scope.item.driver_license_issue_date),validTo&&validTo.attr("value",scope.item.driver_license_valid_till)}}}]),angular.module("serverForm.services").factory("pguVehicleSrvc",["apiInner","$rootScope","$compile","$routeParams","$http","CONFIG","$q","sharedExtServices","api","Validators","PGU",function(apiInner,$rootScope,$compile,$routeParams,$http,CONFIG,$q,sharedExtServices,api,Validators,PGU){return{srvcDefer:{},initPopup:function(scope){var that=this;scope.ui.needChange=!1,this.srvcDefer=$q.defer(),api.beforeSubmit(this.srvcDefer,scope),PGU.Events.subscribe(scope.item.fullPath,"hidePopup",function(){scope.ui.popupShowDefer=!1,that.srvcDefer.resolve("V_hide")}),PGU.Events.subscribe("","submitForm",function(){scope.ui.needAdd=!0,scope.item.nameVisible&&(scope.item.seriesVisible&&scope.item.numberVisible||scope.item.numberAndSeriesVisible)&&(scope.ui.needAdd=!1),scope.ui.needAdd||($rootScope.settings.user.vehicles&&$rootScope.settings.user.vehicles.length?$rootScope.settings.user.vehicles.forEach(function(val){if(val.name!=scope.item.nameVehicle||val.numberPlate!=scope.item.vehicleId||val.regCertificate.series!=scope.item.series||val.regCertificate.number!=scope.item.number)return void scope.setData()}):scope.setData()),$rootScope.$apply(),scope.ui.needAdd?(scope.ui.showESIAPopup=!0,$rootScope.$apply()):that.srvcDefer.resolve("V_withoutPopup")})},setFullData:function(scope){var wg=api.find(scope.item.fullPath+".PanelControls"),series=wg.find("PanelSeries.Series"),number=wg.find("PanelNumber.Number"),date=wg.find("PanelDate.Date"),validTo=wg.find("PanelValidTo.ValidTo");series&&series.attr("value",scope.item.driver_license_series),number&&number.attr("value",scope.item.driver_license_number),date&&date.attr("value",scope.item.driver_license_issue_date),validTo&&validTo.attr("value",scope.item.driver_license_valid_till)}}}]),function(){function pguBundlesSrv($rootScope,api,sharedExtServices,$q,Validators,PGU,designerExtServices){var allWidgetsDescription,widgetDescriptionDf,isAl10=!$rootScope.isDesigner&&10===$rootScope.settings.user.al,isAl15=!$rootScope.isDesigner&&15===$rootScope.settings.user.al,userType=!$rootScope.isDesigner&&api.getStrategyValue("user_type").value,maskDescription={translation:{L:{pattern:/[a-zA-Z\u0400-\u04FF]/},"?":{pattern:/[a-zA-Z\u0400-\u04FF]/,optional:!0},">":{pattern:/[А-ЯЁA-Z0-9]/},"<":{pattern:/[а-яёa-z0-9]/},"*":{pattern:/./}}},$maskElement=$(document.createElement("div")),_maskValue=function(text,mask){return $maskElement.html(text).mask(mask,maskDescription).html()},selectRequestStructure={treeFiltering:"ONELEVEL",parentRefItemValue:"",selectAttributes:["*"],tx:"EPGU"
},noReplaceItems=["Fias","FieldDropdownHierarchicMultiple"],replaceStrategiesAl10=["fio","lastname","firstname"],replaceStrategiesAl15=replaceStrategiesAl10.concat(["sex","birthdate","birthplace","snils","issuedate","issueid","issueorg","docseries","docnumber","foreignpassport_issuedate","foreignpassport_issueorg","foreignpassport_series","foreignpassport_number","foreign_documentissuedate","foreign_documentseries","foreign_documentnumber"]),setFullPathsRecursion=function(items,fullPath){return items.map(function(el){return el.fullPath||(el.fullPath=fullPath+"."+el.name),el.items&&el.items.length&&setFullPathsRecursion(el.items,el.fullPath),el})},checkIsSelectAndLoadData=function(item){if("FieldDropdown"===item.className&&item.visible){var request=angular.extend({},selectRequestStructure,{refName:item.dictionary.code,pageNum:item.pageNum||"0",pageSize:item.pageSize||"256"});sharedExtServices.listRefItems.loadList(request,function(data){if(data.items&&data.items.length){var listItem=data.items.find(function(li){return li.value===item.value});listItem&&(item.text_value=listItem.title)}})}},mapItemsForEditor=function(item,df,content){item.items=setFullPathsRecursion(JSON.parse(content),item.fullPath),api.initAttrs(item.items,null,item),df.resolve()},getLastVersionOfWidget=function(widgets,className){var version=1;return widgets.forEach(function(widget){widget.mnemonic===className&&widget.version>version&&(version=widget.version)}),version},widgetsCache={},_checkValid=function(item){return item.validators&&item.value?!Validators.isInvalid(item.validators,item.value,item.validators):item.value};return $rootScope.isDesigner&&(widgetDescriptionDf=$q.defer(),designerExtServices.coreWidgetsService.getList(function(data){allWidgetsDescription=data,widgetDescriptionDf.resolve()})),{isAl10:isAl10,userType:userType,showWidget:function(item,availableTypes){var canShow=item.visibilityByParent||availableTypes.indexOf(userType)>-1||$rootScope.isDesigner||"all"===availableTypes;return item.visible=!!canShow&&item.visible,canShow},isDelegateDataItem:function(item){var parent=item.parent&&item.parent.apiElem&&item.parent.apiElem.element;if(parent){if("DelegateDelegatePanel"===parent.className)return"delegate";if("DelegatePersonPanel"===parent.className)return"person"}return!1},setFlagsToItems:function(items){var self=this;items.forEach(function(item){var checkStrategyByAl10=!isAl10||replaceStrategiesAl10.includes(item.strategy),checkStrategyByAl15=!isAl15||(replaceStrategiesAl15.includes(item.strategy)||item.isGlueField);if(-1===noReplaceItems.indexOf(item.className)&&_checkValid(item)&&checkStrategyByAl10&&checkStrategyByAl15){item.theMaskValue?item.value=_maskValue(item.value,item.theMaskValue):checkIsSelectAndLoadData(item),item.isComplete=!0;var parent=item.parent&&item.parent.apiElem&&item.parent.apiElem.element;parent&&"Panel"===parent.className&&(parent.gridWidth="one-whole")}item.items&&self.setFlagsToItems(item.items)})},getWidget:function(item){var df=$q.defer();if($rootScope.isDesigner){var versionDf=$q.defer();item.version?versionDf.resolve():widgetDescriptionDf.promise.then(function(){item.version=getLastVersionOfWidget(allWidgetsDescription,item.className),versionDf.resolve()}),versionDf.promise.then(function(){var currentWidget,widget=widgetsCache[item.className];widget&&widget[item.version]?(currentWidget=widget[item.version],currentWidget.df.promise.then(function(){mapItemsForEditor(item,df,currentWidget.content)})):(widget=widget||{},widgetsCache[item.className]=widget,widget[item.version]={},currentWidget=widget[item.version],currentWidget.df=$q.defer(),designerExtServices.coreWidgetsService.getWidget({mnemonic:item.className,version:item.version},function(data){data.content&&(currentWidget.content=data.content,currentWidget.df.resolve(),mapItemsForEditor(item,df,data.content))}))})}else df.resolve();return df.promise},getFindMethods:function(fullPath){var context=api.find(fullPath);return{element:function(path){return context.find(path).getElement()},apiElement:function(path){return context.find(path)}}},onChangeDelegateRadio:function(mustWatch,item,callback){mustWatch&&PGU.Events.subscribe("","changeDelegateRadio",function(evt,data){Object.keys(data.map[item.className]).forEach(function(key){item[key]=data.map[item.className][key]}),callback&&callback()})}}}angular.module("serverForm.services").factory("pguBundlesSrv",pguBundlesSrv),window.isDesigner?pguBundlesSrv.$inject=["$rootScope","api","sharedExtServices","$q","Validators","PGU","designerExtServices"]:pguBundlesSrv.$inject=["$rootScope","api","sharedExtServices","$q","Validators","PGU"]}(),angular.module("serverForm.services").factory("HealthSrv",["$rootScope",function($rootScope){function _healthEnabled(type){return enableList.includes(type)||$rootScope.env.formParam&&"true"===$rootScope.env.formParam.health}function _setRequestParams(params,isSuccess,data){var health={event:params.type,result:isSuccess?0:1};return params.refName&&(health.moreInfo={dict:params.refName,region:$rootScope.userSelectedRegion,isEmpty:!data||!data.items||!data.items.length}),"map"===params.type?(health.moreInfo=health.moreInfo||{},health.moreInfo.orderId=$rootScope.settings.orderId,health.moreInfo.okato=$rootScope.settings.userSelectedRegion):"getSlots"===params.type&&(health.moreInfo=health.moreInfo||{},health.moreInfo.orderId=$rootScope.settings.orderId,health.moreInfo.organizationId=params.organizationId,health.moreInfo.serviceCode=params.serviceCode,health.moreInfo.slotsCount=data.slots&&data.slots.length||0),params.startTime&&(health.timing=(new Date).getTime()-params.startTime),params.addParams&&angular.extend(health,params.addParams),void 0!==params.draftId&&(health.draftId=params.draftId),void 0!==params.orderId&&(health.orderId=params.orderId),health}function _isEqueue(params){return["getSlots","aggBook","cancelBook"].includes(params.type)}function _withoutItemsEvent(event){return["imageEditor","errorUpdateDraft","reuseDuty"].includes(event)}function checkHealthWhenDone(params,data){if(_healthEnabled(params.type)){var health=_setRequestParams(params,!0,data);if(_isEqueue(params)){var error=data.error&&data.error.errorDetail&&data.error.errorDetail.errorCode;"getSlots"===params.type?data.slots&&data.slots.length||(health.result=1,error&&0!==error&&(health.ServerError=error)):0!==error&&null!==error&&(health.result=1,error&&0!==error&&(health.ServerError=error))}else if("dictionary_cps"===params.type){var hasErrors=data.errors&&data.errors.length;if(!data.items||!data.items.length||hasErrors){health.result=1;var errorCodes=3;hasErrors&&(errorCodes=data.errors.map(function(err){return err.code})),health.ServerError=errorCodes.toString()}}else{var errorCodeNot0=data.error&&data.error.code&&0!==data.error.code;_withoutItemsEvent(health.event)||data.items&&data.items.length&&!errorCodeNot0||(health.result=1,errorCodeNot0&&(health.ServerError=data.error.code))}$rootScope.$emit("HEALTH_SEND",health)}}function checkHealthWhenError(params,response){if(_healthEnabled(params.type)){var errorBlock,errorCode,health=_setRequestParams(params);_isEqueue(params)?(errorBlock=response.data&&response.data.error&&response.data.error.errorDetail||null,errorCode=errorBlock&&errorBlock.errorCode):(errorBlock=response&&response.data&&response.data.error||null,errorCode=errorBlock&&errorBlock.code),0===errorCode||isNaN(errorCode)||null===errorCode?response&&response.status&&(health.BrowserError=-1===response.status?504:response.status):health.ServerError=errorCode,$rootScope.$emit("HEALTH_SEND",health)}}var enableList=["errorUpdateDraft","reuseDuty"];return{checkHealthWhenDone:checkHealthWhenDone,checkHealthWhenError:checkHealthWhenError}}]),function(){"use strict";angular.module("serverForm.directives").directive("adviceSimpleSf",function(){return{restrict:"E",template:'<div ng-class="type" class="PGU-Advice">\n                <div class="PGU-Limiter"><h3 class="PGU-Service-h3 PGU-Service-h3-advice">\n                    <span class="PGU-Icon PGU-Icon-Advice_Icon"></span>\n                    <span class="PGU-AdviceTitleText" data-ng-bind-html="title | to_trusted"></span>\n                </h3>\n\n                <div ng-transclude></div>\n\n            </div></div>\n',replace:!0,transclude:!0,scope:{type:"@",title:"@"}}}).directive("adviceSimpleBindSf",function(){return{restrict:"E",template:'<div ng-class="type" class="PGU-Advice">\n                <div class="limiter"><h3 class="PGU-Service-h3 PGU-Service-h3-advice">\n                    <span class="PGU-Icon PGU-Icon-Advice_Icon"></span>\n                    <span class="PGU-AdviceTitleText" data-ng-bind-html="title | to_trusted"></span>\n                </h3>\n\n                <div data-compile-html-sf="text"></div>\n                <div data-ng-if="ruleMessage" data-compile-html-sf="ruleMessage"></div>\n\n            </div></div>\n',replace:!0,scope:{type:"@",title:"@",text:"@",ruleMessage:"@"}}}).directive("advice2",function(){return{restrict:"E",template:'<div ng-class="PGU-AdviceType" class="PGU-Advice_v2">\n               <h3 data-ng-if="title" data-ng-bind-html="title | to_trusted"></h3>\n               <div ng-transclude></div>\n           </div>\n',replace:!0,transclude:!0,scope:{type:"@",title:"@"}}}).directive("compileHtmlSf",["$compile",function($compile){return function(scope,element,attrs){scope.$watch(function(scope){return scope.$eval(attrs.compileHtmlSf)},function(value){element.html(value),$compile(element.contents())(scope)})}}])}(),function(){"use strict";angular.module("serverForm.directives").directive("epguThrobber",["$rootScope","TEMPLATES","MAIN_LOADER_TEXTS",function($rootScope,TEMPLATES,MAIN_LOADER_TEXTS){return{restrict:"E",templateUrl:TEMPLATES.THROBBER,scope:{title:"@",throbberType:"@",msg:"@",showHeading:"=",smallWithMessage:"=?"},link:function(scope,element,attrs){scope.msieversion=function(){return!!(window.navigator.userAgent.indexOf("MSIE ")>0||navigator.userAgent.match(/Trident.*rv\:11\./))}(),scope.defaultTitle=MAIN_LOADER_TEXTS.title,scope.defaultMsg=MAIN_LOADER_TEXTS.msg}}}])}(),angular.module("serverForm.directives").directive("epguWidget",["$rootScope","$location","$q","$window","apiInner","api","TEMPLATES_PLAYER","commonServices","$timeout","PGU","ENGINE_VERSIONS","sharedExtServices","ESIA_SAVE","LOC","CUSTOM_STEPS","$http","stepByStepInit","textResources","translate","reusePayment","postMessage","cookie",function($rootScope,$location,$q,$window,apiInner,api,TEMPLATES_PLAYER,commonServices,$timeout,PGU,ENGINE_VERSIONS,sharedExtServices,ESIA_SAVE,LOC,CUSTOM_STEPS,$http,stepByStepInit,textResources,translate,reusePayment,postMessage,cookie){return{restrict:"E",replace:!0,templateUrl:TEMPLATES_PLAYER.EPGU_WIDGET,scope:{epguSettings:"="},controller:["$scope",function($scope){function initWidget(config){function playFormFromEsepPopup(form,esepErrorMsg){api.shade(!0),$rootScope.esep.show=!0,$rootScope.rTreeRunner(form),api.env("isNeedCaptcha")&&api.find($rootScope.pathToCaptcha.step).visible(!1),$rootScope.esep.errorMsg=esepErrorMsg,api.playForm()}function checkSelectedRegionValue(region){return region&&"00000000000"!==region}function showRegionDialog(){$rootScope.$broadcast("region-select")}function checkUserSelectedRegion(region){return!!checkSelectedRegionValue(region)||(showRegionDialog(),$rootScope.$on("ngDialog.closed",function(){checkSelectedRegionValue($rootScope.settings.userSelectedRegion)||showRegionDialog()}),!1)}function fixCloneIndexOrder(formContent){try{var regexpCloneIndex=new RegExp(/\[(\d+)\]/),draft=$.extend(!0,{},formContent),keys=_.filter(Object.keys(draft),function(x){return-1!==x.indexOf("workActivityPanel")}).sort();if(keys&&keys.length>0){if(_.uniq(_.map(keys,function(x){return 1*x.split("[")[1].split("]")[0]}),function(x){return x}).filter(function(x,i){return x!==i}).length>0){var part={},prevIndex=0,newIndex=0;for(var i in keys){var key=keys[i],index=1*regexpCloneIndex.exec(key)[1];index!==prevIndex&&(newIndex++,prevIndex=index);var newKey=key.replace(regexpCloneIndex,"["+newIndex+"]");newKey!==key&&api.__addToMarkDeletedRuntime(key),part[newKey]=$.extend(!0,{},draft[key]),delete draft[key],void 0!==part[newKey].cloneIndex&&(part[newKey].cloneIndex=newIndex+"")}return $.extend(!0,draft,part),draft}}}catch(ex){}return formContent}function fixDraftAtPresentMonth(draft){try{var keys=_.filter(Object.keys(draft),function(x){return-1!==x.indexOf("workActivityPanel")});if(keys&&keys.length>0)for(var i in keys){var key=keys[i];if(-1!==key.indexOf("ATPRESENT")&&"true"===draft[key].value){var month=(new Date).getMonth(),monthName=moment().locale("ru").month(month).format("MMMM");draft[key.split("]")[0]+"].CELL_END_MONTH.END_MONTH"]={value:pad(month+1,2),text_value:monthName.charAt(0).toUpperCase()+monthName.slice(1)},draft[key.split("]")[0]+"].CELL_END_YEAR.END_YEAR"]={value:moment().format("YYYY"),text_value:moment().format("YYYY")}}}}catch(ex){}}function pad(n,width,z){return z=z||"0",n+="",n.length>=width?n:new Array(width-n.length+1).join(z)+n}function readFormPrepare(data,startReadForm){$rootScope.$emit("HEALTH_SEND",{event:"readForm",timing:(new Date).getTime()-startReadForm,result:0});var form,engineVersion,contentForm,navPanel;if($rootScope.settings.isIncomingWidget?(data.form||(data.form=data),contentForm=data.form.content,$rootScope.env.scopeTokens={},$rootScope.env.scopeTokens.system=data.systemToken||"",$rootScope.env.scopeTokens.user=data.userToken||"",translate.use()):contentForm=data.content,contentForm){if($scope.env=$scope.env||{},$rootScope.settings.formId=data.form?data.form.id||data.form.formId:data.id,form=JSON.parse(contentForm),void 0===form.engineVersion&&(form.engineVersion="1",$scope.engineVersion=form.engineVersion),"evOpt"===data.engineVersion&&($scope.engineVersionEvOpt=!0),stepByStepInit.readCookie("sf_opt")&&($scope.engineVersionEvOpt=!0),$rootScope.settings.isIncomingWidget&&(form.needLoadDraft=!1),$rootScope.checkNavPanelInit=apiInner.checkNavPanel.bind(apiInner),form.items&&form.items.length){navPanel=apiInner.checkNavPanel(form);navPanel&&($rootScope.navPanel=navPanel)}$rootScope.scopeFormStructure=$scope.formStructure=[],$rootScope.hubForm=!!data.hubForm,engineVersion=form.engineVersion||data.engineVersion,$rootScope.settings.showAllSteps=form.showAllSteps,$rootScope.settings.formTitleNew=form.titleNew,formPrepare(ENGINE_VERSIONS[engineVersion],form,data.form)}else $rootScope.$emit("HEALTH_SEND",{event:"readForm",timing:(new Date).getTime()-startReadForm,result:1,ServiceError:data.error.code}),api.handleError(data)}function formPrepare(engineVersion,form,data){var orderId=$rootScope.settings.orderId||"",orgType=$rootScope.settings&&$rootScope.settings.orgType?$rootScope.settings.orgType:null;switch(orgType&&($rootScope.env.isChief=$rootScope.settings.user&&"string"==typeof $rootScope.settings.user.systemAuthority&&$rootScope.settings.user.systemAuthority.indexOf("SIA=ORG_CHIEF")>-1),$rootScope.env.engineVersion=engineVersion,engineVersion){case"EnginePlayerPgu":case"EnginePlayerVer1":case"evOptDict":case"evOpt":case"EnginePlayerPguOnline":$scope.initForm=engines.EnginePlayerPgu.initForm,orderId||!1===form.needLoadDraft?($scope.hasDrafts=!0,$scope.initForm(data)):getListDrafts($rootScope.settings.mnemonic,$rootScope.settings.targetId?$rootScope.settings.targetId:$rootScope.settings.serviceTargetExtId,orgType);break;case"EnginePlayerBase":case"EnginePlayerBaseWithNavigation":$scope.initForm=engines.EnginePlayerBase.initForm,$scope.initForm()}}function getListDrafts(mnemonic,targetId,listMode){sharedExtServices.formsService.listDrafts({data:{pageIndex:1,pageSize:"L"===listMode?1e5:1,eServiceId:mnemonic,serviceTargetId:targetId,sourceSystems:"*",embed:"LAST_INVITATION"}},function(data){if($scope.hubDate={},$scope.$on("draftRegionSelected",function(evt,data){$scope.hubDate.regionSelected=data.code,$rootScope.userSelectedRegion=data.code,$rootScope.userSelectedRegionValue=$scope.currentRegion=data.path,$scope.hubDate.regionSelectedHand=!0}),!$rootScope.inOpWidget&&sharedExtServices.selectRegionTitle($rootScope.userSelectedRegion,function(data){$rootScope.userSelectedRegionValue=$scope.currentRegion=data.path}),data.order&&data.order.length){if($scope.hasDrafts=!0,"L"===listMode){$scope.serviceName=data.order[0].serviceName,$scope.listMode=listMode,$scope.radioItem={visible:!0,className:"FieldRadio",withoutApi:!0,value:"",fullPath:"draftRadio",list:[{label:"Оформить новое заявление",value:data.order.length}]},$scope.textItem={visible:!0,withoutApi:!0,className:"FieldText",label:"Примечание",fullPath:"draftDescr"};var setRegionName=function(region){var globalOkatoMask=new RegExp(/[\d]{2}[^0]+/);if(-1!=region.search(globalOkatoMask)){var startNumbers=region.substring(0,4);if("7111"==startNumbers||"7112"==startNumbers||"7113"==startNumbers||"7118"==startNumbers)return $scope.regionsList[711e8];if("7114"==startNumbers||"7115"==startNumbers||"7116"==startNumbers||"7117"==startNumbers)return $scope.regionsList[7114e7];if("111"===region.substring(0,3))return $scope.regionsList[111e8];var firstSymbols=region.substring(0,2);return $scope.regionsList[firstSymbols+"000000000"]}return $scope.regionsList[region]},prepareDrafts=function(){$scope.drafts=data.order.map(function(item,i){var updated=moment(item.updated||""),date=commonServices.leadingZero(updated.get("date"))+"."+commonServices.leadingZero(updated.get("month")+1)+"."+updated.get("year")+" "+commonServices.leadingZero(updated.get("hours"))+":"+commonServices.leadingZero(updated.get("minutes"));return{id:item.id,description:item.description||"",date:date,druftUserSelectedRegion:item.userSelectedRegion,draftRegionName:$rootScope.hubForm?setRegionName(item.userSelectedRegion):null}})},prepareRegionsList=function(regions){$scope.regionsList={},Object.keys(regions).forEach(function(regionBlock){$scope.regionsList[regions[regionBlock].okato]=regions[regionBlock].cases[0]}),prepareDrafts()};if($rootScope.hubForm){var newRegion=window.location.protocol+$rootScope.nsiApi+"epgu/region/manual/all";$http({method:"GET",url:newRegion,withCredentials:!0,cache:!1}).then(function(resp){if(resp&&resp.data&&200==resp.status){var regionsList=resp.data;prepareRegionsList(regionsList)}else $scope.regionsList=null},function(err){$scope.regionsList=null})}else prepareDrafts();$scope.selectDraft=function(evt,ind){var selected=$scope.drafts.find(function(item,i){return i===ind});$rootScope.settings.orderId=$scope.currentOrderId=selected.id,$scope.draftCurrentItem=ind,$scope.radioItem.value=ind,$rootScope.settings.description=""},$scope.$watch("radioItem.value",function(val,oldVal){val!==oldVal&&void 0!==val&&val&&($scope.draftCurrentItem=val,$rootScope.druftUserSelectedRegion=val.druftUserSelectedRegion,$rootScope.env=$rootScope.env||{},$rootScope.env.dfartOkato=val.druftUserSelectedRegion,data.order.length===val&&($rootScope.settings.orderId=$scope.currentOrderId=""))})}else{var order=data.order[0],dateStr=order.updated||"";$rootScope.settings.orderId=order.id,$rootScope.druftUserSelectedRegion=order.userSelectedRegion||"",$rootScope.env=$rootScope.env||{},$rootScope.env.dfartOkato=order.userSelectedRegion;var updatedDate=moment(dateStr);$scope.date=commonServices.leadingZero(updatedDate.get("date"))+"."+commonServices.leadingZero(updatedDate.get("month")+1)+"."+updatedDate.get("year")+" "+commonServices.leadingZero(updatedDate.get("hours"))+":"+commonServices.leadingZero(updatedDate.get("minutes"))}$scope.hideOutsideClick=!1,order=order||{},$scope.hubMode=$rootScope.hubForm,$scope.hubDate={number:order.id,region:"",time:moment(order.updated).format("DD.MM.YYYY HH:mm:ss")},!$rootScope.inOpWidget&&$scope.hubMode&&order.userSelectedRegion&&sharedExtServices.selectRegionTitle(order.userSelectedRegion,function(data){$scope.hubDate.region=data.name}),$scope.hubDate.regionSelected="",$scope.continueDraft=function(){$scope.modalShow=!1,$scope.textItem&&$scope.textItem.value&&!$rootScope.settings.orderId&&($rootScope.settings.description=$scope.textItem.value),$rootScope.mainLoader.show=!0,$timeout(function(){$scope.initForm()})},$scope.modalTmpl=TEMPLATES_PLAYER.MODAL_DRAFT,order&&(order.paymentCount&&"L"!==listMode||order.lastInvitation&&!listMode)?$scope.continueDraft():($scope.modalShow=!0,$rootScope.mainLoader.show=!1),$scope.newDraft=function(reg){$rootScope.env=$rootScope.env||{},reg&&($rootScope.druftUserSelectedRegion=reg,$rootScope.settings.userSelectedRegion=reg,$rootScope.userSelectedRegion=reg),$rootScope.env.dfartOkato=reg||$rootScope.userSelectedRegion,$scope.modalShow=!1,$rootScope.mainLoader.show=!0,"L"!==listMode?sharedExtServices.deleteOrder({orderId:$rootScope.settings.orderId},function(){$rootScope.settings.orderId="",$scope.initForm()}):($rootScope.settings.orderId="",$scope.initForm())},$scope.hideModal=function(){$scope.newDraft()}}else $scope.hasDrafts=!1,$scope.backToCard=function(){$("body").removeClass("PGU-SF-Dialog-Show"),$location.path($rootScope.env.serviceFormInfo.PASS_CODE+"/"+$rootScope.env.serviceFormInfo.EPGU_CODE)},$scope.confirmEsepInfo=function(){$scope.needEsep=!1,$rootScope.mainLoader.show=!0,$scope.initForm(void 0,!0)},PGU.Events.subscribe("","hidePopup",function(){$scope.needEsep&&$scope.confirmEsepInfo()}),$scope.hideEsepInfoOutsideClick=function(){$scope.confirmEsepInfo()},$scope.initForm()},function(error){api.handleError({code:"draftListError"})})}function formatPasteData(event){var clipboard=event.clipboardData||window.clipboardData,text=clipboard.getData("Text"),cleanText=text.replace(/(\t|\n|\u00ad|₽|\u20BD)/g,"");if(text!==cleanText){event.preventDefault(),event.stopPropagation();var target=event.target,modifyArr=target.value.split("");modifyArr.splice(target.selectionStart,target.selectionEnd-target.selectionStart,cleanText),target.value=modifyArr.join("");var newEvt;"function"==typeof Event?newEvt=new Event("input"):(newEvt=document.createEvent("HTMLEvents"),newEvt.initEvent("input",!0,!0)),target.dispatchEvent(newEvt)}}Object.keys($rootScope.$$listeners).forEach(function(key){[":quizEnabled"].indexOf(key)>-1||~key.indexOf(":")&&delete $rootScope.$$listeners[key]});var tabletLikePhone,getUserAgent=function(){return navigator.userAgent},otherTypeDevice=function(userAgent){var res="";switch(!0){case!!userAgent.match(/Nexus 7/i):res="nexus7 device-mobile";break;case!!userAgent.match(/HUAWEI MediaPad T1 8.0/i):res="huawei-mediapad device-mobile"}return res};$scope.specifiedDevice=function(){var userAgent=getUserAgent(),classes=otherTypeDevice(userAgent);return tabletLikePhone=!!classes,classes||(device.desktop()?classes="desktop-default":device.mobile()?(classes+=device.androidPhone()?"androidPhone":device.iphone()||device.ipod()?"iphone":device.windowsPhone()?"windowsPhone":"",classes+=" device-mobile"):device.tablet()&&(classes+=device.androidTablet()?"androidTablet":device.ipad()?"ipad":device.windowsTablet()?"windowsTablet":"",classes+=" device-tablet")),classes+=$scope.isIframe?" is-iframe":""}(),PGU.Events.subscribe("","formRendered",function(){$scope.__platform=api.env("getPlatform")&&api.env("getPlatform")(),$scope.isSMU=!!$scope.__platform}),$scope.submitForm=function(){api.finalSubmit(),!0===$rootScope.esep.show&&($rootScope.esep.show=!1)},$scope.hideEsepPopupByCloseIcon=function(){$scope.formEdit()},$scope.formEdit=function(){var esepResult=(apiInner.generateRequestUrl($location.path(),$location.search(),api.env("orderId"),"step=last"),api.env("EsepResult"));"-1"===esepResult||"0"===esepResult?(api.env("editFormAfterEsep",!0),api.env("isNeedCaptcha")&&api.find($rootScope.pathToCaptcha.step).visible(!0),$rootScope.esep.show=!1,api.shade(!1)):(api.env("isNeedCaptcha")&&api.find($rootScope.pathToCaptcha.step).visible(!0),PGU.Events.publish(":showSubmitButton"),$rootScope.esep.esepPreviewError=!1,$rootScope.esep.show=!1,api.shade(!1))},$timeout(function(){var platform="";$rootScope.settings=$.extend($rootScope.settings,$scope.isIframe?config:$scope.epguSettings),$rootScope.settings.tabletLikePhone=tabletLikePhone;var urlParams=$rootScope.settings.urlParams;urlParams&&Object.keys(urlParams).forEach(function(key){$rootScope.settings.urlParams[key]=decodeURIComponent(urlParams[key])});var roox=window.com&&window.com.rooxteam;if($rootScope.settings.selfFormPlayerUrlStatic=LOC.RESOURCE_URI.replace("/designer/","/widgets/"),$rootScope.inOpWidget=!(!roox||!roox.pubsub),$rootScope.inOpWidget&&roox.container&&"IFRAME"===roox.container.renderType&&($rootScope.inOpWidgetIframe=!0,device.mobile())){var func=function(e){try{var data=JSON.parse(e.data);data.deviceHeight&&($rootScope.iframeDeviceHeight=data.deviceHeight,window.removeEventListener("message",func,!1))}catch(error){window.removeEventListener("message",func,!1)}};top.postMessage(JSON.stringify({getMobileHeight:!0}),"*"),window.addEventListener("message",func,!1)}$rootScope.mainLoader={title:"",msg:"",errorMsg:"",errorTitle:"Что-то пошло не так",show:!1,__shadeCounter:0,stackControlsWithAsyncData:[],stackControlsWithAsyncDataCounter:0},$rootScope.lazyloader={show:!1},api.shade(!0),checkUserSelectedRegion($rootScope.settings.userSelectedRegion)&&($scope.$root=$rootScope,$rootScope.settings.mnemonic="/"==$rootScope.settings.mnemonic[0]?$rootScope.settings.mnemonic.substring(1):$rootScope.settings.mnemonic,$rootScope.settings.regionId=$rootScope.settings.regionId?$rootScope.settings.regionId:"00000000000",$rootScope.env={},$rootScope.env.logined=$rootScope.settings.logined,$rootScope.env.orgTypeParam=$rootScope.settings.orgType,$rootScope.env.scopeFNS=$rootScope.settings.scopeFNS,$rootScope.env.user=$rootScope.settings.user||{},$rootScope.originalEsiaData=$rootScope.settings.esia,$rootScope.env.esia=$rootScope.settings.esia&&$rootScope.settings.esia.person||{},$rootScope.env.serviceFormInfo={},$rootScope.env.formMnemonic=$rootScope.settings.mnemonic,$rootScope.env.userSelectedRegion=$rootScope.settings.userSelectedRegion,$rootScope.env.passportIcons=$rootScope.settings.passportIcons,$rootScope.env.esepPopupFormUrl=$rootScope.settings.esepPopupFormUrl,$rootScope.env.dadataPopupCounter=0,$rootScope.env.targetId=$rootScope.settings.serviceTargetExtId||$rootScope.settings.targetId,("10000024730"===$rootScope.env.formMnemonic&&"10002827429"===$rootScope.env.targetId||"10000010475"===$rootScope.env.formMnemonic&&"10000002037"===$rootScope.env.targetId||"123"===$rootScope.env.formMnemonic&&"-10005557777"===$rootScope.env.targetId||"10970"===$rootScope.env.formMnemonic&&"10002639784"===$rootScope.env.targetId||"18825"===$rootScope.env.formMnemonic&&"-10005557777"===$rootScope.env.targetId)&&($rootScope.daDataFormTest=!0),"function"==typeof $rootScope.settings.getPlatform?(platform=$rootScope.settings.getPlatform(),$rootScope.env.srcSystem=platform?"FG-MOB-"+platform.toUpperCase():""):$rootScope.inOpWidget?$rootScope.env.srcSystem="OP-WIDGET":$rootScope.env.srcSystem="BETA",$rootScope.esep={show:!1,btnFormEdit:{btnColor:"white",label:"Вернуться к редактированию",fullPath:"_btnFormEdit",floating:"PGU-BtnFloat",buttonSize:"small",visible:!0},btnSubmitForm:{balign:"right",btnColor:"blue",label:"Отправить заявление",fullPath:"_btnSubmitForm",floating:"PGU-BtnFloat",buttonSize:"small",visible:!0,isLoad:!0},btnSubmitFormSign:{balign:"right",btnColor:"blue",label:"Перейти к подписанию",fullPath:"_btnSubmitFormSign",floating:"PGU-BtnFloat",buttonSize:"small",visible:!0}},$rootScope.device={mobile:device.mobile(),tablet:device.tablet(),desktop:device.desktop(),device:!device.desktop(),class:device.mobile()?"mobile":device.tablet()?"tablet":"desktop"},$scope.initOrderId=$rootScope.settings.orderId,sharedExtServices.formsService.checkUser($rootScope.env.formMnemonic,$rootScope.env.targetId).then(function(checkUserResponse){var checkUserData=checkUserResponse?checkUserResponse.data:null,withOrder=!0,withStrategy=!0,isOnlineCustom=!1,isEnrollmentSchool=!("10000090633"!==$rootScope.settings.mnemonic&&"10000062392"!==$rootScope.settings.mnemonic&&"10000095672"!==$rootScope.settings.mnemonic&&"10000098172"!==$rootScope.settings.mnemonic||"6600000010000672716"!==$rootScope.settings.serviceTargetExtId&&"6600000010000672716"!==$rootScope.env.targetId&&"6600000000170216947"!==$rootScope.settings.serviceTargetExtId&&"6600000000170216947"!==$rootScope.env.targetId);"10000026221"!==$rootScope.settings.mnemonic||"-10002744313"!==$rootScope.settings.serviceTargetExtId&&"-10002744313"!==$rootScope.env.targetId||(isEnrollmentSchool=!0,$rootScope.settings._customPushUrl="api/sp/v1/leaving/home/push",$rootScope.settings._needCustomCheck="api/isolation/v1/qr/1",$rootScope.settings._needCustomDraftRequest={surName:"form.FormStep_InfoFL.Panel_InfoFL.Panel_Surname.Surname",firstName:"form.FormStep_InfoFL.Panel_InfoFL.Panel_FirstName.FirstName",middleName:"form.FormStep_InfoFL.Panel_InfoFL.Panel_Patronymic.Patronymic",birthDate:"form.FormStep_InfoFL.Panel_InfoFL.Panel_BirthDay.BirthDay",document:{type:"form.FormStep_Passport.Panel_Passport.Panel_DocType.DocTypeValue",number:"form.FormStep_Passport.Panel_Passport.Panel_Number.Number",series:"form.FormStep_Passport.Panel_Passport.Panel_Series.Series",issuedDate:"form.FormStep_Passport.Panel_Passport.Panel_DateOfIssue.DateOfIssue",issuedBy:"form.FormStep_Passport.Panel_Passport.Panel_IssuedBy.IssuedBy",code:"form.FormStep_Passport.Panel_Passport.Panel_Code.Code"},placementAddress:"form.FormStep_Address.Panel_Address.Panel_FactAddress.FactAddress",placementAddressFias:"form.FormStep_Address.Panel_Address.Panel_FactAddress.FactAddress|fias_full_code",reason:{code:"form.FormStep_ReasonToLeaveHome.Pane_ReasonToLeaveHome.Panel_Reason.Reason|value",text:"form.FormStep_ReasonToLeaveHome.Pane_ReasonToLeaveHome.Panel_Reason.Reason|text_value"},otherReasonText:"form.FormStep_ReasonToLeaveHome.Pane_ReasonToLeaveHome.Panel_OtherReason.OtherReason",tsNumber:"form.FormStep_InfoFL.Panel_InfoFL.Panel_numberPlate.NumberPlate",regionCode:"form.FormStep_Region.Panel_Region.Region",regionName:"form.FormStep_Region.Panel_Region.Region|text_value",time:"form.FormStep_TimeToLeaveHome.Panel_TimeToLeaveHome.Panel_Time.FieldDropdown_Time|text_value"});var isEnrollmentCamp=!("10000066092"!==$rootScope.settings.mnemonic&&"10000062392"!==$rootScope.settings.mnemonic||"6600000010000594362"!==$rootScope.settings.serviceTargetExtId&&"6600000010000594362"!==$rootScope.env.targetId);if(checkUserData&&checkUserData.length)sharedExtServices.formsService.getServiceFormInfo($rootScope.settings.mnemonic,$rootScope.env.targetId,$rootScope.env.userSelectedRegion).then(function(){api.isElectionService()&&api.sendReachGoal("CheckForm",{mnemonic:checkUserData[0].code||"CheckFormError"},24845174),api.handleError(checkUserData[0],void 0,!0)});else{var startReadForm=(new Date).getTime();if("10000104378"===$rootScope.settings.mnemonic&&($rootScope.vaccineForm=!0),$rootScope.settings.isIncomingWidget){var docFormMnemonic=["10000025167","10000104378","33090"],docFormServiceTargets=["-10000000603","10001000603","-10000006633"];docFormMnemonic.includes($rootScope.settings.mnemonic)&&(docFormServiceTargets.includes($rootScope.settings.serviceTargetExtId)||docFormServiceTargets.includes($rootScope.env.targetId)||isEnrollmentSchool||isEnrollmentCamp)&&(isOnlineCustom=!0,$rootScope.settings.isOnlineCustom=!0),(isEnrollmentSchool||isEnrollmentCamp)&&(withOrder=!1,withStrategy=!1),isOnlineCustom?sharedExtServices.formsService.customOnlineInit({mnemonic:$rootScope.settings.mnemonic,targetId:$rootScope.settings.serviceTargetExtId||$rootScope.env.targetId,withOrder:withOrder,withStrategy:withStrategy}).then(function(data){readFormPrepare(data,startReadForm)},function(error){$rootScope.$emit("HEALTH_SEND",{event:"readForm",timing:(new Date).getTime()-startReadForm,result:1,BrowserError:error&&error.status?error.status:""}),api.handleError(error)}):sharedExtServices.formsService.initIncomingWidget({mnemonic:$rootScope.settings.mnemonic}).then(function(data){readFormPrepare(data,startReadForm)},function(error){$rootScope.$emit("HEALTH_SEND",{event:"readForm",
timing:(new Date).getTime()-startReadForm,result:1,BrowserError:error&&error.status?error.status:""}),api.handleError(error)})}else sharedExtServices.formsService.readForm({sessionToken:$rootScope.settings.sessionToken,accessToken:$rootScope.settings.accessToken,mnemonic:$rootScope.settings.mnemonic,mode:"short"},function(data){readFormPrepare(data,startReadForm)},function(error){$rootScope.$emit("HEALTH_SEND",{event:"readForm",timing:(new Date).getTime()-startReadForm,result:1,BrowserError:error&&error.status?error.status:""}),api.handleError(error)})}},function(error){api.handleError()}))},0,!1);var engines={EnginePlayerBase:{initForm:function(){sharedExtServices.formsService.readForm({sessionToken:$rootScope.settings.sessionToken,accessToken:$rootScope.settings.accessToken,mnemonic:$rootScope.settings.mnemonic},function(data){var form,contentForm;contentForm=data.content,contentForm?(form=JSON.parse(contentForm),$rootScope.scopeFormStructure=$scope.formStructure=[],$rootScope.hubForm=!!data.hubForm,$rootScope.hubForm||$scope.formStructure.push(form)):api.handleError(data),$rootScope.env.logined=$rootScope.settings.logined,$rootScope.env.orgType=$rootScope.settings.orgType,$rootScope.env.user=$rootScope.settings.user||{},angular.extend($rootScope.settings,$rootScope.env),api.init($scope.formStructure),api.playForm()},function(error){api.handleError(error)})}},EnginePlayerPgu:{initForm:function(formData,esepInfoConfirmed){var allPromises,requestData={mnemonic:$rootScope.settings.mnemonic,sessionToken:$rootScope.settings.sessionToken,accessToken:$rootScope.settings.accessToken,targetId:$rootScope.env.targetId,orderId:$rootScope.settings.orderId||""},startTime=(new Date).getTime(),promisesConfig={},bookingConfig={};$rootScope.settings.description&&(requestData.orderDescription=$rootScope.settings.description),$scope.engineVersionEvOpt&&(requestData.engineVersion="evOpt"),$scope.promiseData?allPromises=$q.all($scope.promiseData):$rootScope.settings.isIncomingWidget?allPromises=$q.all({info:sharedExtServices.formsService.getServiceFormInfo($rootScope.settings.mnemonic,$rootScope.env.targetId,$rootScope.env.userSelectedRegion)}):(promisesConfig={info:sharedExtServices.formsService.getServiceFormInfo($rootScope.settings.mnemonic,$rootScope.env.targetId,$rootScope.env.userSelectedRegion),init:sharedExtServices.formsService.init(requestData)},$rootScope.settings.parentOrderId&&(bookingConfig.parentOrderId=$rootScope.settings.parentOrderId,$rootScope.settings.editLink&&(bookingConfig.bookId=$rootScope.settings.bookId),promisesConfig.bookingFilters=sharedExtServices.formsService.getBookingFilters(bookingConfig)),allPromises=$q.all(promisesConfig)),$rootScope.rTreeRunner=function(item,cloneIndex,callback){var cloneI=cloneIndex||0;"function"==typeof callback&&callback(item,cloneI),item.mnemonicHint&&api.setHintInitCacheCodes(item.mnemonicHint),$rootScope.settings.isIncomingWidget&&item.strategy&&api.setStrategyForIncomingWidget(item),"ImageEditor"===item.className&&api.env("imageEditorInitWithValue",item.fullPath),item&&item.items&&item.items.forEach(function(itemItems){$rootScope.rTreeRunner(itemItems,cloneI,callback)})},allPromises.then(function(promiseData){function routeChangeStart(){$rootScope.env.timeout&&$timeout.cancel($rootScope.env.timeout),onRouteChange()}function addOnBeforeUnload(evt){document.removeEventListener("click",addOnBeforeUnload),location.pathname===pathname&&(window.onbeforeunload=function(e){if($rootScope.env.serviceFormInfo.election){var dialogText="Возможно, внесенные изменения не сохранятся.";return e.returnValue=dialogText,dialogText}})}var data,info,systemData,getFirstSteps,isInvalidEsepResult="",step=0,icons=[],isEvOpt=!1;if($rootScope.env.serviceFormInfo.icons&&$rootScope.env.serviceFormInfo.icons.length?icons=$rootScope.env.serviceFormInfo.icons.slice(0):$rootScope.env.passportIcons&&$rootScope.env.passportIcons.length&&(icons=$rootScope.env.passportIcons.slice(0)),$rootScope.env.returnUrl&&$rootScope.env.returnUrl.length||($rootScope.env.returnUrl="/"+$rootScope.env.serviceFormInfo.PASS_CODE+"/"+$rootScope.env.serviceFormInfo.EPGU_CODE),data=$rootScope.settings.isIncomingWidget&&formData.content?formData:formData?formData.form?formData.form:{}:promiseData.init,info=promiseData.info,!$scope.hasDrafts&&!esepInfoConfirmed&&!$rootScope.mainLoader.errorMsg&&info.supportSignature)return $rootScope.env.esepPopupFormUrl&&$location.path().indexOf($rootScope.env.esepPopupFormUrl)>-1?$scope.showedTitle="Обратите внимание, каждому из супругов необходимо заполнить свою часть заявления и подписать заявление":$scope.showedTitle="Обратите внимание, что для подачи заявления необходимо подписать его",$scope.promiseData=promiseData,$scope.faqUrl=LOC.EPGU_URI+"help/faq/c-1/2062",$scope.modalEsepTmpl=TEMPLATES_PLAYER.NEED_ESEP_PAGE,$scope.needEsep=!0,void($rootScope.mainLoader.show=!1);if(promiseData.bookingFilters&&api.setBookingFilters(promiseData.bookingFilters),$rootScope.env.remainingStepsDefer=$q.defer(),$rootScope.env.remainingStepsRendered=$rootScope.env.remainingStepsDefer.promise,data.content){$rootScope.settings.stepLoader={};var formFromJson=JSON.parse(data.content);if(formFromJson.engineVersion||(formFromJson.engineVersion=$scope.engineVersion),isEvOpt=!($rootScope.integrationModule||"evOpt"!==formFromJson.engineVersion&&!$scope.engineVersionEvOpt),formFromJson&&isEvOpt){if($rootScope.inOpWidgetIframe){var listenScroll=function(evt){try{var data=JSON.parse(evt.data);if(data&&data.fireScrollEvent){var event=new Event("scroll");document.dispatchEvent(event)}}catch(error){}};top.postMessage(JSON.stringify({needListenOutsideScroll:!0}),"*"),window.addEventListener("message",listenScroll,!1),PGU.Events.subscribe("","stopListenOutsideScroll",function(){top.postMessage(JSON.stringify({needListenOutsideScroll:!1}),"*"),window.removeEventListener("message",listenScroll,!1)})}getFirstSteps=stepByStepInit.getFirstSteps({form:data.content,systemData:data.form&&data.form.content&&data.form.content.system||{}}),formFromJson=getFirstSteps.form,formFromJson.items&&formFromJson.items.length!==getFirstSteps.remainingSteps?($rootScope.settings.remainingStepsLength=getFirstSteps.remainingSteps-getFirstSteps.startStep,stepByStepInit.getRemainingStepsByAction({remainingSteps:getFirstSteps.remainingSteps,form:formFromJson,startStep:getFirstSteps.startStep,draftId:data.draftId,mnemonic:$rootScope.settings.mnemonic,isVisibleFirstSteps:getFirstSteps.isVisibleFirstSteps})):($rootScope.navPanel=$rootScope.checkNavPanelInit(formFromJson),$rootScope.navPanel&&formFromJson.items.push($rootScope.navPanel))}else $rootScope.navPanel=$rootScope.checkNavPanelInit(formFromJson),$rootScope.navPanel&&formFromJson.items.push($rootScope.navPanel)}$rootScope.settings.remainingStepsLength||$rootScope.env.remainingStepsDefer.resolve(),(!$rootScope.hubForm||$rootScope.hubForm&&isEvOpt)&&$scope.formStructure.push(formFromJson),$scope.formName=data.name,$rootScope.env.orderId=data.orderId,$rootScope.env.draftId=data.draftId,$rootScope.env.draftVersion=data.draftVersion,$rootScope.env.context_uri="/",$rootScope.settings.autosaveDisabled=$rootScope.settings.integrationModuleMode||info.autosaveDisabled,$rootScope.env.supportSignature=info.supportSignature,$rootScope.settings.EsepResult=$location.search().result,$rootScope.settings.userSelectedRegionData={name:$rootScope.settings.userSelectedRegionName,code:$rootScope.settings.userSelectedRegion},$rootScope.settings.lkUrl=$rootScope.settings.lkUrl||"https://lk.gosuslugi.ru/",$rootScope.env.requestUrl=apiInner.generateRequestUrl($location.path(),$location.search(),data.orderId),formData?$rootScope.settings.isOnlineCustom&&($rootScope.env.formParam=data.formParam||$rootScope.env.formParam||{}):(data.form.content=fixCloneIndexOrder(data.form.content),fixDraftAtPresentMonth(data.form.content),$rootScope.oldDraft=data.form.content,data.form&&data.form.content&&($rootScope.env.systemData=data.form.content.system?data.form.content.system:{},$rootScope.env.formParam=data.form.content.formParam?data.form.content.formParam:{}),systemData=$rootScope.env.systemData,data.form&&data.form.content&&data.form.content.orderPayments&&($rootScope.env.formOrderPayments=data.form.content.orderPayments)),$rootScope.env.systemData=$rootScope.env.systemData||{},$rootScope.env.formParam=$rootScope.env.formParam||{};var disableMobOptimize=!(!$rootScope.env.formParam.Disable_mob_optim||"true"!==$rootScope.env.formParam.Disable_mob_optim);$rootScope.settings.mobOptimizeImageEditor=!disableMobOptimize,$rootScope.settings.mobOptimizeFiasDaData=!disableMobOptimize,$rootScope.settings.mobOptimizeEqueue=!disableMobOptimize,$rootScope.settings.mobOptimizeWorkActivity=!disableMobOptimize;var onRouteChange=$rootScope.$on("$routeChangeStart",routeChangeStart),pathname=location.pathname,beforeUnloaded=!1;window.isEmbedded||($rootScope.env.serviceFormInfo.election?document.addEventListener("click",addOnBeforeUnload):location.pathname===pathname&&(window.onbeforeunload=function(e){"true"!==$rootScope.env.formParam.isLogElForm||beforeUnloaded||(beforeUnloaded=!0,$rootScope.$emit("HEALTH_SEND",{event:"logElForm",timing:0,result:2,order_id:$rootScope.settings.orderId})),$rootScope.currentFormRandomId&&($rootScope.$emit("HEALTH_SEND",{event:"leaveFromForm",timing:0,result:0,orderId:$rootScope.settings.orderId,rndFormId:$rootScope.currentFormRandomId}),$rootScope.currentFormRandomId=null)})),!isEvOpt&&$rootScope.env.serviceFormInfo.SMS_CONFIRM&&CUSTOM_STEPS.addSmsConfirmStep({formStructure:$scope.formStructure[0],api:api,systemData:systemData});var sendOpStatistic=function(){window.com&&window.com.rooxteam&&window.com.rooxteam.statistic?window.postMessage(JSON.stringify({id:"widget.display",pguData:$rootScope.opStatisticData}),"*"):$timeout(function(){sendOpStatistic()},100,!1)};if(($rootScope.inOpWidget||$rootScope.settings.isIncomingWidget)&&($rootScope.opStatisticData={userId:$rootScope.env.user.userId,srcUrl:$rootScope.inOpWidgetIframe?$rootScope.settings.srcUrl:location.href},$rootScope.env.orderId&&($rootScope.opStatisticData.orderId=$rootScope.env.orderId),$rootScope.settings.isIncomingWidget||($rootScope.opStatisticData.view=$rootScope.inOpWidgetIframe?"IFRAME":"INLINE")),($rootScope.settings&&$rootScope.settings.orgType?$rootScope.settings.orgType:null)&&!$rootScope.env.isChief){var sd=$rootScope.env.systemData;$rootScope.env.isChief=!!sd.authorityId||!!sd.hasEmpowerment2021}var errorWhenFormLoad;if(data.error&&(5001===data.error.code||5003===data.error.code))return api.handleError(data.error),void $rootScope.$emit("HEALTH_SEND",{event:"initForm",timing:(new Date).getTime()-startTime,result:1,ServiceError:data.error.code});if(data.content||formData){isEvOpt||CUSTOM_STEPS.addCaptchaStep({formStructure:$scope.formStructure[0],api:api}),api.init($scope.formStructure,void 0,data.validators);var form=api.getForm()[0];if(info&&info.fullName&&(form.title=info.fullName),icons.length&&(form.icons=icons),formData||data.form&&data.form.content&&api.setDraft(data.form.content),formData&&$rootScope.settings.isIncomingWidget&&formData.data&&api.setDraft(formData.data),$rootScope.settings.autosaveDisabled||$rootScope.settings.isIncomingWidget||"true"===$rootScope.env.formParam.isSaveElDraft||api.setDraftTimeout(),$rootScope.settings.orderTypeHidden=!!form.orderTypeHidden&&form.orderTypeHidden,angular.extend($rootScope.settings,$rootScope.env),$scope.esepResultTmpl=TEMPLATES_PLAYER.ESEP_RESULT,!formData&&info.supportSignature&&$rootScope.settings.EsepResult)return form.showAllSteps||(step=api.getVisibleSteps().length-2),isInvalidEsepResult=api.checkEsepResult(),$rootScope.esep.formIsRendered=!1,isInvalidEsepResult?void playFormFromEsepPopup(form,isInvalidEsepResult):systemData&&systemData.signCnt&&+systemData.signCnt>1&&systemData.isOwner&&"true"!==systemData.isOwner?($rootScope.rTreeRunner(form),void api.playForm(0,null,!0)):void playFormFromEsepPopup(form);$location.search().step&&(step=api.getVisibleSteps().length-2);var startRender;startRender=isEvOpt?startTime:(new Date).getTime(),api.playForm(step,function(){$rootScope.$emit("HEALTH_SEND",{event:"renderForm",timing:(new Date).getTime()-startRender,result:0}),$rootScope.settings._openFormTime=!0,($rootScope.inOpWidget||$rootScope.settings.isIncomingWidget)&&($rootScope.opStatisticData.type=$rootScope.settings.isIncomingWidget?"initIncomingWidgetSuccess":"initOutgoingWidgetSuccess",sendOpStatistic())})}else errorWhenFormLoad=!0,$rootScope.$emit("HEALTH_SEND",{event:"initForm",timing:(new Date).getTime()-startTime,result:1,ServiceError:data.error.code}),api.handleError(data),($rootScope.inOpWidget||$rootScope.settings.isIncomingWidget)&&($rootScope.opStatisticData.type=$rootScope.settings.isIncomingWidget?"initIncomingWidgetError":"initOutgoingWidgetError",sendOpStatistic());if($rootScope.rTreeRunner(form),textResources.loadResources(data),$rootScope.env.formParam&&($rootScope.env.formParam.translationForm&&translate.parseFormByTranslate(data),$rootScope.env.formParam.reusePayment&&reusePayment.initialize($rootScope.env.formParam),$rootScope.env.formParam.correctionDocEsiaOrg&&PGU.otherSessionAttrsSets.push({name:"correctionDocEsiaOrg",field:api.find($rootScope.env.formParam.correctionDocEsiaOrg),key:"value"})),!errorWhenFormLoad){$rootScope.currentFormRandomId=uuid.v4();var params={event:"initForm",timing:(new Date).getTime()-startTime,result:0,rndFormId:$rootScope.currentFormRandomId};data.draftVersion&&(params.draftVersion=data.draftVersion),data.orderId&&(params.orderId=data.orderId),$rootScope.$emit("HEALTH_SEND",params)}},function(error){if($rootScope.$emit("HEALTH_SEND",{event:"initForm",timing:(new Date).getTime()-startTime,result:1,ServiceError:error&&error.code}),error&&error.code&&102===error.code){var f=function(data){data.length?api.handleError(data[0],void 0,!0):api.handleError(error)};sharedExtServices.formsService.checkUser($rootScope.settings.mnemonic,$rootScope.env.targetId,f)}else api.handleError(error)}).catch(function(err){$rootScope.$emit("HEALTH_SEND",{event:"initForm",timing:(new Date).getTime()-startTime,result:1,BrowserError:err.status})})}}},ua=window.navigator.userAgent;$scope.msieversion=ua.indexOf("MSIE ")>0||!!ua.match(/Trident.*rv\:11\./),document.addEventListener("paste",formatPasteData,!1),$scope.$on("$destroy",function(){document.removeEventListener("paste",formatPasteData)})}var prevHeight,locationHash=window.location.hash.substring(1),searchIndex=locationHash.indexOf("?"),hash="";hash=searchIndex>-1?locationHash.substring(0,searchIndex):locationHash;var re=/\/(-\d+|\d+)/gi,hashArr=hash.match(re),mnemonic=hashArr&&hashArr[0]?hashArr[0].replace("/",""):"",targetId=hashArr&&hashArr[1]?hashArr[1].replace("/",""):"",orderId=hashArr&&hashArr[2]?hashArr[2].replace("/",""):"",settings={mnemonic:mnemonic,sessionToken:cookie.getCookie("sessionToken"),accessToken:cookie.getCookie("accessToken"),regionId:"00000000000",targetId:targetId,orderId:orderId,siaWebHostEdit:"https://esia.gosuslugi.ru/profile/user/",lkUrl:"http://lk-dev.test.gosuslugi.ru/",nsiApiUrl:"//pgu-devfed.test.gosuslugi.ru/api/nsi/v1/",lkApiUrl:"//pgu-devfed.test.gosuslugi.ru/api/lk/v1/"};$scope.isIframe=api.isIframe(),$scope.isIframe?(setInterval(function(){var widgets=document.getElementById("PGU-widgets"),popup=document.getElementById("PGU-Popup");if(widgets||popup){var height=Math.max(widgets.offsetHeight,popup?popup.offsetHeight:0);if(prevHeight!==height||0===prevHeight){var config={docHeight:height};popup&&popup.offsetHeight&&(config.isOpenPopup=!0),postMessage.send(config),prevHeight=height}}},500),window.addEventListener?window.addEventListener("message",function(ev){try{JSON.parse(ev.data)}catch(e){return!1}var data=_.isObject(ev.data)?ev.data:JSON.parse(ev.data);data.formConfig&&initWidget(data.formConfig)},!1):window.attachEvent("onmessage",function(ev){try{JSON.parse(ev.data)}catch(e){return!1}var data=_.isObject(ev.data)?ev.data:JSON.parse(ev.data);data.formConfig&&initWidget(data.formConfig)})):($rootScope.settings=settings,initWidget(settings))}],link:function(scope,element,attrs){}}}]),angular.module("serverForm.directives").directive("modalDialog",["$rootScope","TEMPLATES","PGU","$timeout","postMessage",function($rootScope,TEMPLATES,PGU,$timeout,postMessage){return{restrict:"E",scope:{show:"=",hideModal:"&",hideOutsideClick:"=",optimizationForMobile:"=",backBtnName:"=",hideClosePopupBtn:"=?"},replace:!0,transclude:!0,link:function(scope,element,attrs){var stopHideModal=!1;scope.dialogStyle={},scope.device=device.mobile(),scope.forceHide=scope.hideModal,attrs.width&&(scope.dialogStyle.width=attrs.width),attrs.height&&(scope.dialogStyle.height=attrs.height),scope.hideModal=function(event){if("function"==typeof scope.forceHide&&(stopHideModal=scope.forceHide()),!stopHideModal){scope.show=!1;var component="";scope.$parent&&scope.$parent.item&&scope.$parent.item.fullPath&&(component=scope.$parent.item.fullPath),event.stopPropagation(),PGU.Events.publish(component+":hidePopup")}},$(".PGU-Popup_fade").click(function(event){scope.hideOutsideClick&&($(event.target).closest(".PGU-Popup").length||(scope.hideModal(event),scope.$applyAsync()))}),scope.$watch("show",function(val,oldVal){if(val!==oldVal&&void 0!==val){if($rootScope.env.dadataPopupCounter&&!val)return;if(postMessage.send({fadeAll:val}),$rootScope.inOpWidget&&$rootScope.inOpWidgetIframe)if(!$rootScope.iframeDeviceHeight||$rootScope.env.timeslotPopupOpened){var callback=function(e){try{var data=JSON.parse(e.data);if(data.offset){var $popup=$(".PGU-Popup_fade .PGU-Popup:visible"),offset=data&&data.offset,result=offset<50||offset+$popup.height()>document.body.offsetHeight?50:offset;$popup.css("top",result+"px"),$rootScope.env.timeslotPopupOpened&&$rootScope.iframeDeviceHeight&&$popup.css("cssText","top: "+result+"px!important; position: relative; overflow-x: hidden;"),window.removeEventListener("message",callback,!1)}}catch(error){window.removeEventListener("message",callback,!1)}};!0===val&&(top.postMessage(JSON.stringify({showPopup:!0}),"*"),window.addEventListener("message",callback,!1))}else{var container=document.getElementsByClassName("PGU-widgets-container")[0];container.style.maxHeight=val?$rootScope.iframeDeviceHeight+"px":"100%"}$timeout(function(){$("body").toggleClass("PGU-SF-Dialog-Show",val)},0,!1),PGU.state.modalDialogShow=val}})},templateUrl:TEMPLATES.MODAL_DIALOG}}]),angular.module("serverForm.directives").directive("modalDialogEsia",["TEMPLATES","PGU","api","pguSaveDataEsiaSrvc","$q","ESIA_VALIDATORS","$rootScope","TRANSLIT_MASK","postMessage",function(TEMPLATES,PGU,api,pguSaveDataEsiaSrvc,$q,ESIA_VALIDATORS,$rootScope,TRANSLIT_MASK,postMessage){return{restrict:"E",scope:{item:"=?",hideFromOutside:"&"},replace:!0,transclude:!0,link:function(scope,element,attrs){function pushInStoredData(type,data){var defer=$q.defer();scope.storedDataDefer.push({defer:defer,save:pguSaveDataEsiaSrvc.save.bind(pguSaveDataEsiaSrvc,type,data,"",[],!1,defer)})}function compareAddress(val,oldVal){var isEqual,newAddress={},oldAddress={},parts=["region","city","area","settlement","additionArea","street","additionAreaStreet","house","flat","frame","building","zipCode","type","countryId"];return val&&oldVal&&parts.forEach(function(part){newAddress[part]=val[part]||null,oldAddress[part]=oldVal[part]||null}),isEqual=_.isEqual(newAddress,oldAddress),isEqual&&void 0!==val.district&&void 0!==oldVal.district&&val.district!==oldVal.district&&(isEqual=!1),isEqual}function disabledEsia(obj){Object.keys(obj).forEach(function(key){obj[key]&&(obj[key+"Disabled"]=!0)})}function validateFieldPopup(curentData){function validate(value,validator,target,obj){var targetErr=target+"Err",targetDisabled=target+"Disabled";if(validator.required)return value?(obj.data[targetErr]="",!0):(obj.data[targetErr]=validator.msg,obj.data[targetDisabled]=!1,!1);if(!value)return obj.data[targetErr]="",!0;if(validator.regex){var expr=new RegExp(validator.regex,"g");if(void 0!==value&&null!==value&&-1==value.toString().search(expr))return obj.data[targetErr]=validator.msg,obj.data[targetDisabled]=!1,!1}if(validator.date){var limits=validator.date.split("|"),oringeDate=new Date,dateValueArray=value.split("."),year=parseInt(dateValueArray[2]),month=parseInt(dateValueArray[1])-1,day=parseInt(dateValueArray[0]),daysInMonth=new Date(year,month+1,0).getDate();if(month>11||day>daysInMonth||0==day||-1==month)return obj.data[targetErr]=validator.msg,!1;var valDate=new Date(year,month,day);if(!dateValueArray[0]||2!==(dateValueArray[0]+"").length||!dateValueArray[1]||2!==(dateValueArray[1]+"").length||!dateValueArray[2]||4!==(dateValueArray[2]+"").length)return obj.data[targetErr]=validator.msg,obj.data[targetDisabled]=!1,!1;if("current"===limits[1]){if("<"==limits[0])return valDate<oringeDate?(obj.data[targetErr]="",!0):(obj.data[targetErr]=validator.msg,obj.data[targetDisabled]=!1,!1);if(">"==limits[0])return valDate>oringeDate?(obj.data[targetErr]="",!0):(obj.data[targetErr]=validator.msg,obj.data[targetDisabled]=!1,!1);if("<="==limits[0])return valDate<=oringeDate?(obj.data[targetErr]="",!0):(obj.data[targetErr]=validator.msg,obj.data[targetDisabled]=!1,!1);if(">="==limits[0])return valDate>=oringeDate?(obj.data[targetErr]="",!0):(obj.data[targetErr]=validator.msg,obj.data[targetDisabled]=!1,!1)}}return obj.data[targetErr]="",!0}var valid=!0,validaters=ESIA_VALIDATORS[curentData.type],curentDataForValid={},d=curentData.data||curentData;Object.keys(d).forEach(function(ik){"string"==typeof d[ik]&&(curentDataForValid[ik]=d[ik]),"object"==typeof d[ik]&&Object.keys(d[ik]).forEach(function(iksub){curentDataForValid[ik+"_"+iksub]=d[ik][iksub]})});var o={data:scope[curentData.type]||{}};return validaters&&Object.keys(curentDataForValid).forEach(function(itemKey){var v=validaters[itemKey]||[],fieldValid=!0;v.forEach(function(item){item&&fieldValid&&(fieldValid=validate(o.data[itemKey],item,itemKey,o))}),valid=!!valid&&fieldValid}),valid}function showPopup(type){if(!type)return scope.hideFromOutside(!1),resolveDefer();var dataCache;$rootScope.mainLoader.__shadeCounter=1,api.shade(!1),PGU.nowShowPopup&&PGU.nowShowPopup.length&&(dataCache=PGU.nowShowPopup.shift()),"addressPLV"!==type.type&&"addressPRG"!==type.type||(scope.address[type.data.type]=dataCache[type.data.type]),"car"===type.type&&(scope.car=dataCache,disabledEsia(scope.car),validateFieldPopup({data:scope.car,type:"car"})),"kidData"===type.type&&(scope.kidData=dataCache,disabledEsia(scope.kidData),validateFieldPopup({type:"kidData",data:scope.kidData})),scope.typeOfEsiaModal=type;var watchForShade=scope.$watch("item.showEsiaModal",function(val,oldVal){val||($rootScope.mainLoader.__shadeCounter=0,api.shade(!0),watchForShade()),postMessage.send({fadeAll:val})})}function resolveDefer(){function saveData(obj){if(!obj)return scope.deferSvc.resolve();obj.defer.promise.then(function(){saveData(scope.storedDataDefer.shift())}),obj.save()}if(!scope.storedDataDefer.length)return scope.deferSvc.resolve();saveData(scope.storedDataDefer.shift())}function initModal(){userData||(userData=api.env("esia"));var esiaDataForSave=scope.item.esiaDataForSave;return esiaDataForSave.length&&userData?(esiaDataForSave.forEach(function(item){initWorkers[item.type](item.data)}),scope.needShowModal.length?(scope.item.showEsiaModal=!0,void scope.$applyAsync(function(){showPopup(scope.needShowModal.shift())})):resolveDefer()):scope.deferSvc.resolve()}var userData=api.env("esia");scope.item.esiaDataForSave;scope.device=device.mobile(),scope.isTablet=$rootScope.device.tablet,scope.scrollPopupEsia=function(){$rootScope.$emit("scrollPopupEsia",element)},scope.needShowModal=[],scope.typeOfEsiaModal="",scope.storedDataDefer=[],scope.address={},scope.kidData={},scope.driverLicense={},scope.driverLicense.number="",scope.driverLicense.series="",scope.driverLicense.issueDate="",scope.driverLicense.expiryDate="",scope.car={},scope.car.name="",scope.car.numberPlate="",scope.car.number="",scope.car.series="",scope.car.numberAndSeries="",scope.$watch("car.numberAndSeries",function(val){val&&(scope.car.series=val.split(" ")[0]||"",scope.car.number=val.split(" ")[1]||"")});var saveWorkers={driverLicense:function(data){data.issueDate&&data.expiryDate||(data.issueDate=scope.driverLicense.issueDate?scope.driverLicense.issueDate:void 0,data.expiryDate=scope.driverLicense.expiryDate?scope.driverLicense.expiryDate:void 0),pushInStoredData("docs",data)},car:function(data){data.name||(data.name=void 0),data.regCertificate.series&&data.regCertificate.number||(data.regCertificate.series=scope.car.series?scope.car.series:void 0,data.regCertificate.number=scope.car.number?scope.car.number:void 0,scope.car.name&&(data.name=scope.car.name)),data.regCertificate.series||data.regCertificate.number||(data.regCertificate=void 0),data.regCertificate={series:scope.car.regCertificate_series?scope.car.regCertificate_series:void 0,number:scope.car.regCertificate_number?scope.car.regCertificate_number:void 0},pushInStoredData("cars",data)},addressPLV:function(data){pushInStoredData("address",data)},addressPRG:function(data){pushInStoredData("address",data)},foreignpassport:function(data){pushInStoredData("docs",data)},birthcert:function(data){pushInStoredData("docs",data)},militarydoc:function(data){pushInStoredData("docs",data)},medicalpolicy:function(data){pushInStoredData("docs",data)},kidData:function(data){pushInStoredData("kids",data)}},initWorkers={inn:function(data){userData&&userData.person&&userData.person.inn||pushInStoredData("inn",{inn:data})},birthPlace:function(data){userData&&userData.person&&userData.person.birthPlace||pushInStoredData("bp",{birthPlace:data})},driverLicense:function(driverLicense){if(userData.docs&&userData.docs.length){var esiaDL=userData.docs.filter(function(doc){return"RF_DRIVING_LICENSE"==doc.type});esiaDL.length&&(esiaDL=esiaDL[0],esiaDL.series==driverLicense.series&&esiaDL.number==driverLicense.number&&(driverLicense.id=esiaDL.id))}scope.driverLicense.number=driverLicense.number,scope.driverLicense.series=driverLicense.series,scope.driverLicense.issueDate=driverLicense.issueDate?driverLicense.issueDate:"",scope.driverLicense.expiryDate=driverLicense.expiryDate?driverLicense.expiryDate:"",scope.driverLicense.type="RF_DRIVING_LICENSE",scope.$watch("driverLicense",function(){validateFieldPopup({data:scope.driverLicense,type:"driverLicense"})},!0),scope.$watch("driverLicense.issueDate",function(val){if(!scope.driverLicense.expiryDate&&!scope.driverLicense.issueDateErr){var ed=val.split(".");ed[2]=+ed[2]+10,scope.driverLicense.expiryDate=ed.join(".")}}),disabledEsia(scope.driverLicense),validateFieldPopup({data:scope.driverLicense,type:"driverLicense"}),scope.needShowModal.push({type:"driverLicense",data:scope.driverLicense})},car:function(car){if(scope.car={},userData.vehicles&&userData.vehicles.length)var esiaVehicles=userData.vehicles.filter(function(item){return item.numberPlate.toUpperCase()==car.numberPlate.toUpperCase()});esiaVehicles&&esiaVehicles.length&&(car.id=esiaVehicles[0].id),scope.car={name:car.name?car.name:"",numberPlate:car.numberPlate,regCertificate_series:car.regCertificate.series,regCertificate_number:car.regCertificate.number},scope.$watch("car",function(){validateFieldPopup({data:scope.car,type:"car"})},!0),disabledEsia(scope.car),validateFieldPopup({data:scope.car,type:"car"}),scope.$watch("car",function(carScope){carScope&&(car.name=carScope.name,car.numberPlate=carScope.numberPlate,(carScope.regCertificate_series||carScope.regCertificate_number)&&(car.regCertificate=car.regCertificate||{},car.regCertificate.series=carScope.regCertificate_series,car.regCertificate.number=carScope.regCertificate_number))},!0),PGU.nowShowPopup=PGU.nowShowPopup||[],car.id&&(scope.car.id=car.id),PGU.nowShowPopup[scope.needShowModal.push({type:"car",data:car})-1]=angular.copy(scope.car)},address:function(newAddress){var addresses=userData.addresses?userData.addresses:userData.person&&userData.person.addresses?userData.person.addresses:[],strategyAddress=addresses.filter(function(item){return item.type==newAddress.type}),isEqualAddresses=compareAddress(newAddress,strategyAddress[0]?strategyAddress[0]:{});scope.address.type=newAddress.type,scope.address[scope.address.type]={},scope.address[scope.address.type].strategyAddress=strategyAddress[0]?function(address){return(address.zipCode?address.zipCode+", ":"")+address.addressStr}(strategyAddress[0]):"",scope.address[scope.address.type].newAddress=function(address){var addressStr=(address.city?"г. "+address.city:address.region?"г. "+address.region:"")+(address.street?", ул. "+address.street:"");return(address.zipCode?address.zipCode+", ":"")+(address.addressStr?address.addressStr:addressStr||"")+(address.house?", д. "+address.house:"")+(address.building?", стр. "+address.building:"")+(address.frame?", корп. "+address.frame:"")+(address.flat?", кв. "+address.flat:"")}(newAddress),isEqualAddresses||(strategyAddress&&strategyAddress[0]&&strategyAddress[0].id&&(newAddress.id=strategyAddress[0].id),PGU.nowShowPopup=PGU.nowShowPopup||[],PGU.nowShowPopup[scope.needShowModal.push({type:"address"+scope.address.type,data:newAddress})-1]=angular.copy(scope.address))},foreignpassport:function(foreignpassport){scope.foreignpassport={};var doc=[{}];userData.docs&&userData.docs.length&&(doc=userData.docs.filter(function(item){return"FRGN_PASS"===item.type&&(item.series+"").toUpperCase()+" "+(item.number+"").toUpperCase()==(scope.foreignpassport.series+"").toUpperCase()+" "+(scope.foreignpassport.number+"").toUpperCase()}),doc=doc[0]||{}),scope.foreignpassport={series:foreignpassport.series||doc.series||"",issueDate:foreignpassport.issuedate||doc.issueDate||"",number:foreignpassport.number||doc.number||"",type:"FRGN_PASS",expiryDate:foreignpassport.validdate||doc.expiryDate||"",issuedBy:foreignpassport.issueorg||doc.issuedBy||"",lastName:foreignpassport.lastname||doc.lastName||"",firstName:foreignpassport.firstname||doc.firstName||""},doc&&doc.id&&(scope.foreignpassport.id=doc.id||"");var need=!1;if(Object.keys(scope.foreignpassport).forEach(function(key){scope.foreignpassport[key]&&scope.foreignpassport[key]==doc[key]||"id"===key||(need=!0)}),scope.$watch("foreignpassport",function(){validateFieldPopup({type:"foreignpassport",data:scope.foreignpassport})},!0),disabledEsia(scope.foreignpassport),validateFieldPopup({type:"foreignpassport",data:scope.foreignpassport}),need){var i=0,lastNameTranslit="",firstNameTranslit="";if(!scope.foreignpassport.firstName&&userData&&userData.person&&userData.person.firstName){for(i=0;i<userData.person.firstName.length;i++)void 0!==TRANSLIT_MASK[userData.person.firstName[i]]?firstNameTranslit+=TRANSLIT_MASK[userData.person.firstName[i]]:firstNameTranslit+=userData.person.firstName[i];scope.foreignpassport.firstName=firstNameTranslit||""}if(!scope.foreignpassport.lastName&&userData&&userData.person&&userData.person.lastName){for(i=0;i<userData.person.lastName.length;i++)void 0!==TRANSLIT_MASK[userData.person.lastName[i]]?lastNameTranslit+=TRANSLIT_MASK[userData.person.lastName[i]]:lastNameTranslit+=userData.person.lastName[i];scope.foreignpassport.lastName=lastNameTranslit||""}scope.needShowModal.push({type:"foreignpassport",data:scope.foreignpassport})}},birthcert:function(birthcert){var doc=[{}];scope.birthcert={},userData.docs&&userData.docs.length&&(doc=userData.docs.filter(function(item){return"BRTH_CERT"===item.type&&(item.series+"").toUpperCase()+" "+(item.number+"").toUpperCase()==(birthcert.series+"").toUpperCase()+" "+(birthcert.number+"").toUpperCase()}),doc=doc[0]||{}),scope.birthcert={series:birthcert.series||doc.series||"",issueDate:birthcert.issuedate||doc.issueDate||"",number:birthcert.number||doc.number||"",type:"BRTH_CERT",issuedBy:birthcert.issueorg||doc.issuedBy||""},doc&&doc.id&&(scope.birthcert.id=doc.id||""),scope.$watch("birthcert",function(){validateFieldPopup({type:"birthcert",data:scope.birthcert})},!0),disabledEsia(scope.birthcert),
validateFieldPopup({type:"birthcert",data:scope.birthcert});var need=!1;Object.keys(scope.birthcert).forEach(function(key){scope.birthcert[key]&&scope.birthcert[key]==doc[key]||(need=!0)}),need&&scope.needShowModal.push({type:"birthcert",data:scope.birthcert})},militarydoc:function(militarydoc){var doc=[{}];scope.militarydoc={},userData.docs&&userData.docs.length&&(doc=userData.docs.filter(function(item){return"MLTR_ID"===item.type&&(item.series+"").toUpperCase()+" "+(item.number+"").toUpperCase()==(militarydoc.series+"").toUpperCase()+" "+(militarydoc.number+"").toUpperCase()})),doc=doc[0]||{},scope.militarydoc={series:militarydoc.series||doc.series||"",issueDate:militarydoc.issuedate||doc.issueDate||"",number:militarydoc.number||doc.number||"",type:"MLTR_ID",issuedBy:militarydoc.issueorg||doc.issuedBy||""},doc&&doc.id&&(scope.militarydoc.id=doc.id||""),disabledEsia(scope.militarydoc),scope.$watch("militarydoc",function(){validateFieldPopup({type:"militarydoc",data:scope.militarydoc})},!0),validateFieldPopup({type:"militarydoc",data:scope.militarydoc});var need=!1;Object.keys(scope.militarydoc).forEach(function(key){scope.militarydoc[key]&&scope.militarydoc[key]==doc[key]||(need=!0)}),need&&scope.needShowModal.push({type:"militarydoc",data:scope.militarydoc})},medicalpolicy:function(medicalpolicy){var doc=[{}];scope.medicalpolicy={},userData.docs&&userData.docs.length&&(doc=userData.docs.filter(function(item){return"MDCL_PLCY"===item.type&&(item.number+"").toUpperCase()===(medicalpolicy.number+"").toUpperCase()})),doc=doc[0]||{},scope.medicalpolicy={number:medicalpolicy.number||doc.number||"",expiryDate:medicalpolicy.validdate||doc.expiryDate||"",type:"MDCL_PLCY"},doc&&doc.id&&(scope.medicalpolicy.id=doc.id||""),disabledEsia(scope.medicalpolicy),scope.$watch("medicalpolicy",function(){validateFieldPopup({type:"medicalpolicy",data:scope.medicalpolicy})},!0),validateFieldPopup({type:"medicalpolicy",data:scope.medicalpolicy}),scope.medicalpolicy.number&&scope.medicalpolicy.expiryDate&&scope.medicalpolicy.number==doc.number&&scope.medicalpolicy.expiryDate==doc.expiryDate||scope.needShowModal.push({type:"medicalpolicy",data:scope.medicalpolicy})},kid_data:function(kidData){scope.kidData={lastname:kidData.lastname||"",firstname:kidData.firstname||"",middlename:kidData.middlename||"",birthday:kidData.birthday||"",gender:kidData.gender||"",inn:kidData.inn||"",snils:kidData.snils||"",sr_serial:kidData.sr_serial||"",sr_iss_date:kidData.sr_iss_date||"",sr_act_number:kidData.sr_act_number||"",sr_number:kidData.sr_number||"",sr_issued:kidData.sr_issued||"",polis_oms_number:kidData.polis_oms_number||"",polis_oms_exp_date:kidData.polis_oms_exp_date||""};var arrayLastChar={f:["НА"],m:["ИЧ"]},strLastChar=scope.kidData.middlename.substr(scope.kidData.middlename.length-2,2).toUpperCase(),check="";!scope.kidData.gender&&strLastChar&&(~arrayLastChar.f.indexOf(strLastChar)&&(check="F"),~arrayLastChar.m.indexOf(strLastChar)&&(check=check?"":"M"),scope.kidData.gender=check);var kidDataInit=angular.copy(scope.kidData);disabledEsia(scope.kidData),validateFieldPopup({type:"kidData",data:scope.kidData});var needDataRes={lastName:scope.kidData.lastname,firstName:scope.kidData.firstname,middleName:scope.kidData.middlename,inn:scope.kidData.inn,snils:scope.kidData.snils,birthDate:scope.kidData.birthday,gender:scope.kidData.gender,documents:{docs:[{series:scope.kidData.sr_serial,issueDate:scope.kidData.sr_iss_date,actNo:scope.kidData.sr_act_number,number:scope.kidData.sr_number,type:"BRTH_CERT",issuedBy:scope.kidData.sr_issued}]}};(scope.kidData.polis_oms_number||scope.kidData.polis_oms_exp_date)&&needDataRes.documents.docs.push({number:scope.kidData.polis_oms_number||"",expiryDate:scope.kidData.polis_oms_exp_date||"",type:"MDCL_PLCY"}),scope.$watch("kidData",function(val){needDataRes={lastName:val.lastname,firstName:val.firstname,middleName:val.middlename,birthDate:val.birthday,gender:val.gender,inn:val.inn,snils:val.snils,documents:{docs:[{series:val.sr_serial,issueDate:val.sr_iss_date,actNo:scope.kidData.sr_act_number,number:val.sr_number,type:"BRTH_CERT",issuedBy:val.sr_issued}]}},(val.number||val.expiryDate)&&needDataRes.documents.docs.push({number:val.polis_oms_number||"",expiryDate:val.polis_oms_exp_date||"",type:"MDCL_PLCY"}),validateFieldPopup({type:"kidData",data:scope.kidData})},!0),PGU.nowShowPopup=PGU.nowShowPopup||[],PGU.nowShowPopup[scope.needShowModal.push({type:"kidData",data:scope.kidData})-1]=angular.copy(kidDataInit)}};scope.noChangeEsiaData=function(next){scope.$applyAsync(function(){showPopup(next)})},scope.$watch("item.clickClosePopup",function(value,oldValue){"undefined"!==value&&value!==oldValue&&value&&scope.$applyAsync(function(){showPopup(scope.needShowModal.shift())})}),scope.setData=function(curentData,next){validateFieldPopup(curentData)&&("kidData"===curentData.type&&(curentData.data={lastName:scope.kidData.lastname,firstName:scope.kidData.firstname,middleName:scope.kidData.middlename,birthDate:scope.kidData.birthday,gender:scope.kidData.gender,inn:scope.kidData.inn,snils:scope.kidData.snils,documents:{docs:[{series:scope.kidData.sr_serial,issueDate:scope.kidData.sr_iss_date,actNo:scope.kidData.sr_act_number,number:scope.kidData.sr_number,type:"BRTH_CERT",issuedBy:scope.kidData.sr_issued}]}},(scope.kidData.polis_oms_number||scope.kidData.polis_oms_exp_date)&&curentData.data.documents.docs.push({number:scope.kidData.polis_oms_number||"",expiryDate:scope.kidData.polis_oms_exp_date||"",type:"MDCL_PLCY"})),"car"===curentData.type&&(curentData.data={name:scope.car.name,numberPlate:scope.car.numberPlate,regCertificate:{series:scope.car.regCertificate_series,number:scope.car.regCertificate_number}},scope.car.id&&(curentData.data.id=scope.car.id)),saveWorkers[curentData.type](curentData.data),scope.$applyAsync(function(){showPopup(next)}))},PGU.Events.subscribe("","saveEsiaData",function(evt,defer){scope.deferSvc=defer,initModal()})},templateUrl:TEMPLATES.MODAL_DIALOG_ESIA}}]).directive("modalDialogEsiaInput",["$rootScope",function($rootScope){return{template:'<div data-ng-class="{\'span_{{::columns}}\': true, \'PGU-Col-{{::ipadcolumns}}\': isTablet}">   <div class="b-input-esia__root b-input-esia__root-mobile-width-{{::mobilewidth}}">       <label data-ng-if="::isMobile" class="PGU-FieldLabel PGU-FieldLabel-Input">{{title}}</label>       <div class="b-input__esia-dl {{space}} row-width-{{width}} row-mobile-width-{{mobilewidth}} PGU-FieldTextInput PGU-FieldBody {{disabledinp ? \'esia-disabled\' : \'\'}} {{error ? \'err\' : \'\'}} {{(value || $parent.item.isSmall)  ? \'PGU-FieldText-Small-Placeholder\' : \'\'}}">            <label data-ng-if="::!isMobile" class="PGU-FieldLabel PGU-FieldLabel-Input">{{title}}</label>           <span class="error-bg"></span>           <input ng-focus="$parent.onFocusHandler()" type="text" mask="{{maskstr}}" ng-disabled="disabledinp" class="PGU-FieldTextInputBasic" ng-model="value">       </div>           <div class="PGU-FieldNotRequired"><span>{{hint}}</span></div>       <div data-ng-show="error">'+"           <div data-ng-class=\"{'b-error__text' : true, 'error-content' : true, 'PGU-ErrorHint-Right' : errorToRight,'PGU-ErrorHint-Correct' : needCorrectError,'PGU-ErrorHint-Fixed-Width': needFixWidth}\" ng-style=\"style\">{{error}}</div>       </div>       <div class=\"x-clear\"></div>   </div></div>",scope:{zready:"=?",title:"=?",value:"=?",disabledinp:"=?",error:"=?",maskstr:"=?",width:"=?",style:"=?",space:"=?",maxlengthstring:"=?",mobilewidth:"=?",columns:"=?",ipadcolumns:"=?",hint:"=?"},restrict:"E",replace:!0,link:function(scope,el,attr){scope.style={},scope.model={},scope.isMobile=$rootScope.device.mobile,scope.isTablet=$rootScope.device.tablet,scope.maxlengthstring=scope.maskstr&&scope.maskstr.length?scope.maskstr.length:scope.maxlengthstring,scope.$watch("value",function(newVal,oldVal){scope.maxlengthstring&&newVal!==oldVal&&scope.maxlengthstring<newVal.length&&(scope.value=oldVal)}),scope.isMobile||(scope.$applyAsync(function(){var errorWidth=el.find(".error-content").width(),newWidth=errorWidth,width=el.width(),rowWidth=el.closest(".row").width(),rightOffset=rowWidth-el.position().left,inputWidth=el.find(".b-input-esia__root").width();scope.style={left:el.position().left+(scope.isTablet?7:20),top:el.position().top+65},inputWidth<380&&inputWidth>=280&&(scope.style.width=newWidth=width),inputWidth<280&&(scope.style.width=newWidth=280),scope.errorToRight=!1,rightOffset<280&&(scope.style.right=rightOffset-el.width()-5-20,scope.errorToRight=!0,scope.style.left="auto"),newWidth<width&&(scope.errorToRight=!0,scope.style.left=el.position().left+(scope.isTablet?7:20)+width-380),$rootScope.esiaPopupInputPosition&&($rootScope.esiaPopupInputPosition.lastTop===scope.style.top?(scope.style.left=$rootScope.esiaPopupInputPosition.left,$rootScope.esiaPopupInputPosition.left+=width):$rootScope.esiaPopupInputPosition.left=0),$rootScope.esiaPopupInputPosition={lastTop:scope.style.top,lastWidth:width}}),$rootScope.$on("scrollPopupEsia",function(event,element){scope.style.top=el.position().top+65}))}}}]),angular.module("serverForm.directives").directive("pguRegionSelected",["TEMPLATES","sharedExtServices","$timeout",function(TEMPLATES,sharedExtServices,$timeout){return{restrict:"E",templateUrl:TEMPLATES.REGION_SELECTED,scope:{list:"=?",label:"=?",search:"=?",load:"=?",position:"=?"},link:function(scope,element,attrs){scope.label="Выберите регион",scope.selectRegion=function(item){scope.list=[],scope.search="",scope.label=item.path,scope.$emit("draftRegionSelected",item)};var selectInput=element.find(".b-region-selected__wrap");document.addEventListener("click",function(evt){selectInput===evt.target||selectInput[0].contains(evt.target)||(scope.list=[],scope.search="")});var t=void 0;scope.$watch("search",function(newVal,oldVal){newVal&&newVal.length>=3&&(t&&$timeout.cancel(t),t=$timeout(function(){scope.load=!0,sharedExtServices.selectRegion({q:newVal},function(data){scope.list=data.map(function(item){return{code:item.code,name:item.name,path:item.path}}),scope.load=!1},function(){scope.load=!1}),t=void 0},400))})}}}]),angular.module("serverForm.directives").directive("pguSimpleButton",["TEMPLATES","$rootScope",function(TEMPLATES,$rootScope){return{templateUrl:TEMPLATES.SIMPLE_BUTTON,scope:{attrLabel:"=",attrVisible:"=",attrDisabled:"=",attrActionClick:"&"},restrict:"E",link:function(scope,element,attrs){scope.eventClick=function(){scope.attrDisabled||scope.attrActionClick()}}}}]),angular.module("serverForm.directives").directive("previewContainer",["$http","$templateCache","$compile","TEMPLATES_PLAYER","apiInner",function($http,$templateCache,$compile,TEMPLATES_PLAYER,apiInner){return{restrict:"E",replace:!0,scope:{elements:"="},link:function(scope,elem,attrs){scope.$watch("elements",function(val){})},template:'<dl class="previewContainer" ng-class="{\'item.isRow\': previewContainerNoMargin}"><preview-element ng-repeat="item in elements" element="item"></preview-element></dl>'}}]),angular.module("serverForm.directives").directive("previewElement",["$http","$templateCache","$compile","TEMPLATES_PLAYER","apiInner",function($http,$templateCache,$compile,TEMPLATES_PLAYER,apiInner){return{restrict:"E",replace:!0,scope:{element:"="},link:function(scope,elem,attrs){angular.isArray(scope.element.elements)&&(elem.append('<preview-container elements="element.elements"></preview-container>'),$compile(elem.contents())(scope))},template:'<dd><div class="previewElement"><span ng-if="element.label" class="previewElementLabel">{{element.label}}:</span><span ng-if="element.title && !element.label" class="previewContainerTitle">{{element.title}}</span><span ng-if="element.value && !element.title" class="previewElementValue"> {{element.value}}</span><div ng-if="element.imgUrl" class="imgContainer"><img ng-src="{{element.imgUrl}}" alt="Предпросмотр фотографии" class="previewElementImg"></div><div ng-if="element.hasMap" id="{{hasMap}}" class="previewMapContainer"></div></div></dd>'}}]),angular.module("serverForm.directives").directive("finishPage",["TEMPLATES_PLAYER","$rootScope","LOC",function(TEMPLATES_PLAYER,$rootScope,LOC){return{restrict:"E",scope:{show:"=",finishPageData:"=?"},replace:!0,link:function(scope,element,attrs){scope.serviceCardUrl=LOC.EPGU_URI.replace(/http:|https:/,"")+$rootScope.env.serviceFormInfo.PASS_CODE+"/"+$rootScope.env.serviceFormInfo.EPGU_CODE,scope.esiaUrlProfile=LOC.ESIA_BASE.replace(/http:|https:/,"")+"profile/user/",scope.formTitleNew=$rootScope.settings.formTitleNew,scope.content={title:"Ваше заявление &#8470;"+$rootScope.env.orderId+" принято для передачи в&nbsp;ведомство",subTitle:"Следите за&nbsp;его статусом в&nbsp;Едином личном кабинете на&nbsp;портале Госуслуг, мобильном приложении или электронной почте.",showPhone:!0,showEmail:!0,lkLink:$rootScope.settings.lkUrl+"notification-setup",orderLkLink:$rootScope.settings.lkUrl+"notifications/details/ORDER/"+$rootScope.env.orderId,showNotificationsChange:!0},scope.finishPageData=scope.finishPageData||{},angular.extend(scope.content,scope.finishPageData);var userContacts=$rootScope.settings.user&&$rootScope.settings.user.contacts?$rootScope.settings.user.contacts:$rootScope.settings.esia&&$rootScope.settings.esia.contacts?$rootScope.settings.esia.contacts:null,showNotificationsChange=!1,contacts=[{linkLabel:"Укажите мобильный телефон",label:"Мобильный телефон",value:"",type:"MBT",show:!1},{linkLabel:"Укажите электронную почту",label:"Электронная почта",value:"",type:"EML",show:scope.content.showEmail}];userContacts&&userContacts.length?scope.contacts=contacts.map(function(item){var value="",findByType=userContacts.find(function(contact){return contact.type===item.type});return findByType&&findByType.vrfStu&&"verified"===findByType.vrfStu.toLowerCase()&&findByType.value&&(value=findByType.value,showNotificationsChange=!0),{linkLabel:item.linkLabel,label:item.label,value:value,type:item.type,show:item.show}}):scope.contacts=contacts.concat(),scope.showNotificationsChange=!1!==scope.content.showNotificationsChange&&showNotificationsChange,$rootScope.opStatisticData.type="showFinishPage",window.postMessage(JSON.stringify({id:"widget.display",pguData:$rootScope.opStatisticData}),"*")},templateUrl:TEMPLATES_PLAYER.FINISH_PAGE}}]),angular.module("serverForm.directives").directive("finishElectionPage",["TEMPLATES_PLAYER","$rootScope","sharedExtServices","$timeout","$window","api","$moment",function(TEMPLATES_PLAYER,$rootScope,sharedExtServices,$timeout,$window,api,$moment){return{restrict:"E",scope:{show:"="},replace:!0,link:function(scope){var electionDate=$rootScope.env.formParam&&$rootScope.env.formParam.humanReadableElectionDate||"",lkLink='<a href="'+$rootScope.settings.lkUrl+'" target="_self">',serviceFormInfo=api.env("serviceFormInfo");scope.content={title:"Ваше заявление &#8470;"+$rootScope.env.orderId+" сформировано",subTitle:"Заявление будет направлено в ЦИК России. <br />Следите за&nbsp;его статусом в&nbsp;"+lkLink+"личном кабинете</a> на&nbsp;портале Госуслуг, по электронной почте и в мобильном приложении",showPhone:!1,showEmail:!1,lkLink:$rootScope.settings.lkUrl+"notification-setup",orderLkLink:$rootScope.settings.lkUrl+"notifications/details/ORDER/"+$rootScope.env.orderId,showNotificationsChange:!1},scope.electionData={loading:!0},window.onbeforeunload&&(window.onbeforeunload=null),$timeout(function(){var subjCode=api.find("form.FormStep4.Panel_Region.regionCode"),level=api.find("form.FormStep0.Panel0.voteLevel"),uikNum=api.find("form.FormStep5.Panel_UIK.NumUIK"),subjCodeSelected=api.find("form.FormStep5.Panel_UIK.UIK"),subjCodeFromElement="",voteDate=$moment($rootScope.settings.electionsSettings.voteDate||$moment(),"YYYY-MM-DD").format("DD.MM.YYYY"),params={orderId:$rootScope.env.orderId};subjCode&&subjCode.value()&&uikNum&&uikNum.value()&&level&&level.value()&&(subjCodeSelected&&subjCodeSelected.pdf&&subjCodeSelected.pdf.tempItemData&&subjCodeSelected.pdf.tempItemData.subjCod&&(subjCodeFromElement=subjCodeSelected.pdf.tempItemData.subjCod),params.subjCode=subjCodeFromElement||subjCode.value(),params.level=level.value(),params.uikNum=uikNum.value(),params.voteDate=voteDate),sharedExtServices.ElectionService.getElectionData(params,function(data){if(data){var title,sign;2==data.level?(title="На выбранном вами избирательном участке в Единый день голосования "+electionDate+" также проводятся региональные выборы:",sign="Вы можете также подать заявление о включении в список избирателей по месту нахождения на региональных выборах, если адрес вашей регистрации по месту жительства находится в пределах соответствующего избирательного округа."):(title="На выбранном вами избирательном участке в Единый день голосования "+electionDate+" также проводятся выборы:",sign="Вы можете также подать заявление о включении в список избирателей по месту нахождения, если адрес вашей регистрации по месту жительства или пребывания находится в пределах соответствующего одномандатного избирательного округа."),Object.assign(scope.electionData,{level:data.level,title:title,subTitle:data.name,showPhone:!1,showEmail:!1,sign:sign,orderLink:function(){if(!0===serviceFormInfo.election&&("312414"===serviceFormInfo.PASS_CODE||"340139"===serviceFormInfo.PASS_CODE)){var params={kladrCode:$rootScope.geoCoderInitAddress.kladrCode,numberUik:$rootScope.geoCoderInitAddress.numberUik};api.sendReachGoal("312414"===serviceFormInfo.PASS_CODE?"voteregTYPClick":"votedumTYPClick",params,24845174)}$window.open(data.url,"_blank")},showNotificationsChange:!1,loading:!1})}else scope.electionData.loading=!1,scope.electionData.error=!0},function(error){scope.electionData.error=!0,scope.electionData.loading=!1})},$rootScope.settings.thankYouPageDelay)},templateUrl:TEMPLATES_PLAYER.FINISH_ELECTION_PAGE}}]),angular.module("serverForm.directives").directive("bannerPlace",["$rootScope","sharedExtServices","LOC",function($rootScope,sharedExtServices,LOC){return{restrict:"E",template:'<div class="PGU-Banner-Place">               <div data-sf-compile-html="banner.content"></div>          </div>',replace:!0,scope:{banners:"@"},link:function(scope,element,attrs){if(scope.banners){scope.staticDomainUrl=LOC.STATIC_DOMAIN,scope.betaUrl=LOC.EPGU_URI;var request={groups:scope.banners.toString(),platform:"EPGUV3_"+("dk"===$rootScope.version?"DESK":"mob"===$rootScope.version?"MOB":"TAB"),region:$rootScope.userSelectedRegion};sharedExtServices.CMSService.getBanners(request,function(response){response&&response.length&&response[0].banners&&response[0].banners.length&&(scope.banner=response[0].banners[0])})}}}}]),function(){"use strict";angular.module("serverForm.directives").directive("sfCompileHtml",["$compile",function($compile){return function(scope,element,attrs){scope.$watch(function(scope){return scope.$eval(attrs.sfCompileHtml)},function(value){element.html(value),$compile(element.contents())(scope)})}}])}(),angular.module("serverForm.directives").directive("checkSignStatus",["$rootScope","LOC","checkSignStatusSrv","PGU",function($rootScope,LOC,checkSignStatusSrv,PGU){return{restrict:"E",replace:!0,scope:{file:"=",buttonPath:"=?",mainFileTitle:"="},template:'<div class="sign-status {{status}}">   <div class="message">{{message}} <a href="#" data-ng-click="showMoreInfo($event)" data-ng-show="showMoreInfoBtn" class="show-more-info">Подробнее</a></div></div>',link:function(scope,elem,attrs){function setStatusAndMessage(status){status!==scope.status&&(scope.status=status,scope.showMoreInfoBtn=!["wait","nodata"].includes(status),scope.message=checkSignStatusSrv.getStatusData(status))}var postfix=scope.file.isUploader&&scope.file.hasSign?".sig":"",mnemonic=scope.file.mnemonic+postfix;setStatusAndMessage("wait"),scope.showMoreInfo=function(evt){evt.preventDefault(),checkSignStatusSrv.getCheckSingResultAndShowPopup(mnemonic,scope.mainFileTitle)},PGU.Events.subscribe(mnemonic,"hasResult",function(evt,data){if(!~data.fileName.indexOf(".eds.result")){var status="accept";"RUNNING"===data.edsStatus?status="wait":"OK"!==data.edsStatus&&(status=data.hasEdsResult?"error":"nodata"),setStatusAndMessage(status)}}),scope.$on("$destroy",function(evt){PGU.Events.unsubscribe(mnemonic,"hasResult")})}}}]).directive("updateCheckSignStatus",["$rootScope","LOC","checkSignStatusSrv","PGU","$timeout",function($rootScope,LOC,checkSignStatusSrv,PGU,$timeout){return{restrict:"E",replace:!0,scope:{uploader:"=?",isDigitalProfileUploader:"=?"},template:'<div>   <epgu-form-button item="updateStatusButton" click-handler-btn="updateStatus"></epgu-form-button></div>',link:function(scope,elem,attrs){function checkStatusAndShowBtn(){scope.updateStatusButton.isLoad=!0,scope.updateStatusButton.visible=!0,$timeout(scope.updateStatus,3e3,!1)}if(scope.updateStatusButton={btnColor:"white",label:"Обновить статусы",fullPath:scope.uploader.fullPath+".__updateStatusButton",floating:"PGU-BtnFloat",buttonSize:"small",visible:!1,throbberMsg:"Идет проверка подлинности, пожалуйста, подождите",btnMargin:"bot-10"},scope.updateStatus=function(){scope.updateStatusButton.isLoad=!0,$timeout(function(){checkSignStatusSrv.getCheckSingStatus(scope.uploader.fullPath).finally(function(){scope.updateStatusButton.isLoad=!1})},2e3,!1)},PGU.Events.subscribe(scope.uploader.fullPath,"toggleUpdateButton",function(evt,data){var allFilesLoaded=(scope.uploader.files||[]).length===scope.uploader.minCountFiles;scope.updateStatusButton.visible=!(!scope.isDigitalProfileUploader&&!allFilesLoaded)&&data.visible}),checkSignStatusSrv.setPreSubmitChecking(),scope.uploader.minCountFiles){var hasFilesAtStart=(scope.uploader.files||[]).length===scope.uploader.minCountFiles;scope.$watch(function(){return scope.uploader.files.length},function(){var files=scope.uploader.files,hasCorrectCountFiles=files&&files.length===scope.uploader.minCountFiles;hasFilesAtStart?(hasFilesAtStart=!1,hasCorrectCountFiles&&checkStatusAndShowBtn()):hasCorrectCountFiles?checkStatusAndShowBtn():scope.updateStatusButton.visible=!1})}else scope.isDigitalProfileUploader&&checkStatusAndShowBtn();scope.$on("$destroy",function(evt){PGU.Events.unsubscribe(scope.uploader.fullPath,"toggleUpdateButton")})}}}]).factory("checkSignStatusSrv",["$rootScope","api","sharedExtServices","PGU","$q",function($rootScope,api,sharedExtServices,PGU,$q){var mapStatusToMessage={wait:"Идет проверка подлинности",accept:"Подлинность документа подтверждена",error:"Подлинность документа не подтверждена",nodata:"Проверка подлинности недоступна. Документ будет проверен при обработке заявления"},getPopupString=function(text,isPanel){return isPanel?{className:"Panel",label:"",grid:"1/3",items:[{className:"Label",value:'<span class="plain-text-bold">'+text+"</span>"}]}:{className:"Panel",label:"",grid:"2/3",items:[{className:"Label",value:'<span class="plain-text">'+text+"</span>"}]}},setPopupString=function(title,value){this.items.push(getPopupString(title,!0),getPopupString(value.replace(/\\/g,"")))},getAdviceHtmlByStatus=function(isOK){return{className:"Custom-Html",html:'<div class="grid-wrap PGU-CheckSignStatus-Popup">\n    <div class="grid-wrap__row">\n        <div class="grid-wrap__col-lg-16 grid-wrap__col-md-12 grid-wrap__col-sm-6 lg-offset-bottom-24 md-offset-bottom-16 sm-offset-bottom-16">\n            <div class="separator"></div>\n        </div>\n        <div class="grid-wrap__col-lg-16 grid-wrap__col-md-12 grid-wrap__col-sm-6 lg-offset-bottom-24 md-offset-bottom-16 sm-offset-bottom-16">\n'+(isOK?'            <h3 class="PGU-Service-h3 PGU-Advice-Type_Like">\n                <span class="PGU-Icon PGU-Icon-Advice_Icon"></span>\n                <div class="center-title">Подлинность документа подтверждена на момент проверки</div>\n            </h3>\n':'            <h3 class="PGU-Service-h3 PGU-Advice-Type_Warn">\n                <span class="PGU-Icon PGU-Icon-Advice_Icon"></span>\n                <span>Подлинность документа не подтверждена на момент проверки</span>\n            </h3>\n            <div class="lg-offset-top-10">Обратитесь в подразделение ведомства, от которого получили документ</div>\n')+'        </div>\n        <div class="grid-wrap__col-lg-16 grid-wrap__col-md-12 grid-wrap__col-sm-6 lg-offset-bottom-32 md-offset-bottom-32 sm-offset-bottom-24">\n            <div class="separator"></div>\n        </div>\n    </div>\n</div>'}},hideThrobber=function(){$rootScope.mainLoader.__shadeCounter=0,api.shade(!1)};return{getStatusData:function(status){return mapStatusToMessage[status]},showPopup:function(data,mainFileTitle){var obj={title:"Электронная подпись документа «"+mainFileTitle+"»",items:[getAdviceHtmlByStatus("OK"===data.status)]};setPopupString.call(obj,"Дата проверки",data.reportDate),setPopupString.call(obj,"Статус подписи",data.resultText),setPopupString.call(obj,"Владелец сертификата",data.data.subject),setPopupString.call(obj,"Издатель сертификата",data.data.issuer),setPopupString.call(obj,"Серийный номер",data.data.serial),setPopupString.call(obj,"Действителен","с "+data.data.notBefore+" по "+data.data.notAfter),api.createPopup(obj)},getCheckSingStatus:function(uploaderPath){var df=$q.defer();return sharedExtServices.checkSign.getCheckStatus($rootScope.env.orderId).then(function(resp){if(resp&&resp.data&&resp.data.length){var count=0,lastMnemonic="";resp.data.forEach(function(item){PGU.Events.publish(item.mnemonic+":hasResult",item),lastMnemonic=item.mnemonic,"RUNNING"!==item.edsStatus&&count++}),resp.data.length===count?(uploaderPath&&PGU.Events.publish(uploaderPath+":toggleUpdateButton",{visible:!1}),df.resolve(resp.data)):(uploaderPath&&PGU.Events.publish(uploaderPath+":toggleUpdateButton",{visible:!0}),df.reject(resp.data))}else df.reject([])},function(error){df.reject({error:!0})}),df.promise},getCheckSingResultAndShowPopup:function(fileMnemonic,mainFileTitle){var self=this;sharedExtServices.checkSign.getResult($rootScope.env.orderId,fileMnemonic).then(function(response){self.showPopup(response.data,mainFileTitle)},function(error){})},updateSignedMnemonics:function(mainMnemonic,signedFilesMnemonics,uploaderPath){var self=this;sharedExtServices.checkSign.updateSignedMnemonics($rootScope.env.orderId,mainMnemonic,signedFilesMnemonics).then(function(){self.getCheckSingStatus(uploaderPath)})},setPreSubmitChecking:function(){if(!api.__checkSignBeforeSubmit){var self=this;api.__checkSignBeforeSubmit=function(){api.addRequestToQueue(function(df){self.getCheckSingStatus().then(function(data){var incorrectMnemonic;data.every(function(item){return"OK"===item.edsStatus||(incorrectMnemonic=item.mnemonic,!1)})?df.resolve():(hideThrobber(),api.clearStackOfFormSubmit(),api.scrollTo(incorrectMnemonic.replace(/\[\d\]/g,"")))},function(data){var incorrectMnemonic;data.some(function(item){return"OK"!==item.edsStatus&&"RUNNING"!==item.edsStatus&&(incorrectMnemonic=item.mnemonic,!0)}),incorrectMnemonic?(api.clearStackOfFormSubmit(),api.scrollTo(incorrectMnemonic.replace(/\[\d\]/g,""))):self.showCheckingPopup(df),hideThrobber()})})}}},showCheckingPopup:function(df){var obj={title:"Идёт проверка документа и электронной подписи в удостоверяющем центре",items:[{className:"Panel",label:"",items:[{className:"label",value:'<span class="plain-text">Обновить статус проверки можно на форме заявления. Подождите и повторите подачу заявления в течение этого дня, когда подлинность данных подтвердят.</span>'}]},{className:"Panel",label:"",items:[{className:"label",value:'<span class="plain-text">Или отправьте заявление сейчас. Если данные не пройдут проверку, ведомство вернет заявление. Вы сможет отправить новое заявление с акутальной электронной подписью и документом.</span>'}]},{className:"Panel",label:"",grid:"1/5",items:[{className:"button",color:"white",label:"Подождать",func:function(){api.clearStackOfFormSubmit(),api.closeApiPopup()}}]},{className:"Panel",label:"",grid:"1/5",items:[{className:"button",label:"Отправить",func:function(){df.resolve(),api.closeApiPopup()}}]}],actionOnClose:function(){api.clearStackOfFormSubmit()}};api.createPopup(obj)}}}]),angular.module("serverForm.directives").directive("yandexMap",["$rootScope","$timeout","api","yandexMapProps","PGU",function($rootScope,$timeout,api,yandexMapProps,PGU){return{restrict:"E",replace:!0,scope:{item:"=",value:"=yvalue",list:"=",baloon:"=",id:"@yid",error:"=",options:"=",opened:"=",mobilestate:"=",filterchange:"=",fieldmodel:"=",homeFiasPath:"=?"},template:'<div class="container-map" id="{{id}}" style="width:100%;height:100%;"></div>',link:function(scope,element,attrs){var isDestroyed={value:!1};scope.$on("$destroy",function(evt){isDestroyed.value=!0}),$rootScope.isDesigner||function(){function ifError(){scope.error=map.error,scope.item.coordsError=map.coordsError,map.coordsError&&("EurporotocolMap"===scope.item.name?scope.item.errorCoordinatesText="К сожалению, не удалось определить местоположение по координатам адреса места ДТП":scope.item.errorCoordinatesText="К сожалению, не удалось определить местоположение"),$rootScope.$$phase||scope.$apply()}var map=new yandexMapProps(scope.id,isDestroyed);if(map.init(scope.options,scope.item.withGeoCoderSearch,scope.item.withSingleMandate,scope.item.subjCode,scope.item.okrugNum),!scope.item.withGeoCoderSearch)var timeout=setInterval(function(){map.loaded?(clearInterval(timeout),scope.value&&(map.showAddress(scope.value,scope.list,scope.baloon,ifError),$rootScope.$broadcast("mapIsLoaded",!0))):!1===map.loaded&&clearInterval(timeout)},50);var mapIsLoadedOnInit=scope.$on("mapIsLoadedOnInit:"+scope.id,function(evt){scope.value&&(map.showAddress(scope.value,scope.list,scope.baloon,ifError,scope.item.withGeoCoderSearch),scope.showConfirmAfterRemove=!0),mapIsLoadedOnInit()});scope.$watch("value",function(val,oldVal){void 0!==val&&val!=oldVal&&(scope.options&&(map.opts.subjCode=scope.options.subjCode,map.opts.okrugNum=scope.options.okrugNum,map.opts.voteLevel=scope.options.voteLevel,map.opts.isOnlyBounds=scope.options.isOnlyBounds,map.opts.withDigitalPath=scope.options.withDigitalPath),map.loaded?(map.showAddress(scope.value,scope.list,scope.baloon,ifError,scope.item.withGeoCoderSearch),scope.showConfirmAfterRemove=!0):(map.removeAllPlacemarks(scope.value,scope.list,scope.baloon),scope.showConfirmAfterRemove=!1))}),scope.$watch("baloon",function(val){map.loaded&&map.showAddress(scope.value,scope.list,scope.baloon,ifError)}),scope.$watch("opened",function(val,oldVal){(void 0!==val&&!oldVal||void 0!==val&&void 0!==oldVal&&val.elementId!==oldVal.elementId)&&map.openAddress(val)}),scope.$watch("mobilestate.currentStateObserve",function(val,oldVal){void 0===val||val==oldVal||"map"!==val||"form"!==oldVal&&"details"!==oldVal?"form"!==val||"map"!==oldVal&&"list"!==oldVal||(map.activePlacemark&&void 0!==map.activePlacemark.id&&map.objectManager.objects.setObjectOptions(map.activePlacemark.id,{iconImageHref:map.icons.blue.iconImageHref}),map.__mapOpenedBalloonId=null,map.activePlacemark={},map.closeBalloon()):$timeout(function(){"details"===oldVal&&scope.item.selectPlacemarkData?map.setBoundsAndZoom(scope.fieldmodel,null,scope.item):map.setBoundsAndZoom(scope.fieldmodel)},400)}),PGU.Events.subscribe("",scope.id+"_centered",function(evt,attr){map.centeredPlaceMark(attr.coords,attr.id)}),PGU.Events.subscribe("",scope.id+"_closeBaloon",function(scope){map.closeBalloon()}),PGU.Events.subscribe(scope.id,"changePinBG",function(evt,data){map.setPinBackground(data.objectId)}),PGU.Events.subscribe(scope.id,"changeFilter",function(evt,data){map.loaded&&map.setListByBounds(data.value,!0)}),PGU.Events.subscribe("fiasChanged",scope.id,function(evt,data){map.loaded&&(map.opts.subjCode=scope.options.subjCode,map.opts.okrugNum=scope.options.okrugNum,map.opts.voteLevel=scope.options.voteLevel,map.opts.isOnlyBounds=scope.options.isOnlyBounds,map.opts.withDigitalPath=scope.options.withDigitalPath,map.getUserCoordsFromFias(data.fiasAddress))}),api.env("isLoadedYaMaps").done(function(){scope.homeFiasPath&&(map.createHomeIconePlaceMark(),map.homeCoords=api.find(scope.homeFiasPath).attr("coords"),
PGU.Events.subscribe("saveFormData",scope.homeFiasPath,function(evt,data){(map.homeCoords||"").toString()!==data.coords.toString()&&(map.homeCoords=data.coords,ymaps.Map?map.setHomePlaceMark():ymaps.ready(function(){map.setHomePlaceMark()}))}))})}()}}}]).factory("yandexMapProps",["api","$rootScope","sharedExtServices","geoCoder","LOC","$timeout","$q","PGU","DICT_DATA","$location","$moment",function(api,$rootScope,sharedExtServices,geoCoder,LOC,$timeout,$q,PGU,DICT_DATA,$location,$moment){return function(id,isDestroyed){return{homeCoords:[],allGeoObjectsReady:$q.defer(),init:function(options,withGeoCoderSearch,withSingleMandate,subjCode,okrugNum){var that=this,resUri=LOC.RESOURCE_URI.split(":"),resourceUrl=$rootScope.inOpWidget?resUri[1].replace("/designer/","/widgets/"):resUri[1];this.icons={},this.icons.red={iconLayout:"default#image",iconImageHref:resourceUrl+"img/elements/"+($rootScope.settings.mobOptimizeEqueue?"pin_red.svg":"ya-map-m-pin-red.png"),iconImageSize:$rootScope.settings.mobOptimizeEqueue?[24,40]:[35,50],iconImageOffset:$rootScope.settings.mobOptimizeEqueue?[-12,-20]:[-17,-25],iconContentOffset:[11,15],iconShape:{type:"Circle",coordinates:[0,0],radius:23},hideIconOnBalloonOpen:!1,openEmptyBalloon:!0},this.icons.blue={iconLayout:"default#image",iconImageHref:resourceUrl+"img/elements/"+($rootScope.settings.mobOptimizeEqueue?"pin_regular.svg":"ya-map-m-pin-blue.png"),iconImageSize:$rootScope.settings.mobOptimizeEqueue?[24,40]:[38,54],iconImageOffset:$rootScope.settings.mobOptimizeEqueue?[-12,-20]:[-19,-22],iconContentOffset:[11,15],iconShape:{type:"Circle",coordinates:[0,0],radius:23},hideIconOnBalloonOpen:!1,openEmptyBalloon:!0},this.icons.lightBlue={iconLayout:"default#image",iconImageHref:resourceUrl+"img/elements/"+($rootScope.settings.mobOptimizeEqueue?"pin_light_blue.svg":"ya-map-m-pin-light-blue.png"),iconImageSize:$rootScope.settings.mobOptimizeEqueue?[24,40]:[38,54],iconImageOffset:$rootScope.settings.mobOptimizeEqueue?[-12,-20]:[-19,-22],iconShape:{type:"Circle",coordinates:[0,0],radius:23},hideIconOnBalloonOpen:!1,openEmptyBalloon:!0},this.isPhone=api.isMobile();var startLaunch;if(!api.env("isLoadedYaMaps")){startLaunch=(new Date).getTime();var loadUrl;loadUrl=$rootScope.settings.enterpriseYandexMapsEnabled&&$rootScope.settings.yandexMapsApiKey?"//enterprise.api-maps.yandex.ru/2.1/?lang=ru-RU&apikey="+$rootScope.settings.yandexMapsApiKey:"https://api-maps.yandex.ru/2.1/?lang=ru-RU",api.env("isLoadedYaMaps",$.ajax(loadUrl,{async:!1,cache:!1}))}api.env("isLoadedYaMaps").done(function(script,textStatus){$rootScope.$emit("HEALTH_SEND",{event:"apimap",timing:(new Date).getTime()-startLaunch,result:0});var def=$q.defer();def.promise.then(function(){ymaps.Map?that.loadMap(ymaps):ymaps.ready(function(){that.loadMap(ymaps)},function(e){})}),def.resolve()}),api.env("isLoadedYaMaps").fail(function(error){$rootScope.$emit("HEALTH_SEND",{event:"apimap",timing:(new Date).getTime()-startLaunch,result:1,BrowserError:error&&error.status||""})}),options&&(that.opts={},that.opts.placemarkClick=options.placemarkClick,that.type=options.isWithList?"list":"general",that.opts.ballonButtonClick=options.ballonButtonClick,that.opts.afterBaloonOpen=options.afterBaloonOpen,that.opts.afterUserClose=options.afterUserClose,that.opts.selectedIds=options.selectedIds||[],that.opts.cachedIds=options.cacheIds||[],that.opts.bounds=options.bounds||[],that.opts.mappingAttributes=options.mappingAttributes||[],that.opts.withGeoCoderSearch=withGeoCoderSearch,that.opts.subjCode=subjCode,that.opts.isOnlyBounds=options.isOnlyBounds,that.opts.withDigitalPath=options.withDigitalPath,that.opts.voteDate=options.voteDate,that.opts.voteLevel=options.voteLevel,that.opts.withSingleMandate=withSingleMandate,that.opts.setGeoSearchDropdownVal=options.setGeoSearchDropdownVal,that.opts.clusterBalloon=options.clusterBalloon,that.opts.geoCoderInitAddress=options.geoCoderInitAddress)},loadMap:function(ymaps){var that=this;isDestroyed.value||(this.ymaps=ymaps,this.map=new this.ymaps.Map(id,{center:[55.76,37.64],zoom:10,controls:[]},{suppressMapOpenBlock:!0}),this.isPhone||this.map.controls.add("zoomControl",{float:"none",position:{top:5,right:5}}),this.mapPlaceMark=new this.ymaps.Placemark(that.map.getCenter(),{balloonContent:""},that.icons.blue),"list"==this.type&&(this.mapPlaceMark.events.add("balloonopen",function(evt){that.mapPlaceMark.options.set("iconImageHref",that.icons.red.iconImageHref)}),this.mapPlaceMark.events.add("balloonclose",function(evt){that.mapPlaceMark.options.set("iconImageHref",that.icons.blue.iconImageHref)}),!this.isPhone&&this.map.controls.get("zoomControl").events.add("click",function(evt){that.afterClickOnZoomControl=!0}),this.map.events.add("boundschange",function(evt){that.opts.withGeoCoderSearch?that.preventBoundsChange||!that.userCoords||that.preventBoundsChangeBalloon?that.afterClickOnZoomControl=!1:that.setListByBounds(void 0,!0,!0):that.afterClickOnZoomControl&&that.activePlacemark&&(that.centeredPlaceMark(that.activePlacemark.coords,that.activePlacemark.id,evt.get("newZoom")),that.afterClickOnZoomControl=!1)}),this.map.events.add("mousedown",function(){PGU.Events.publish(":__changeMap")}),that.opts.withGeoCoderSearch?($rootScope.version,this.map.options.set("minZoom",7)):this.map.options.set("minZoom",2),this.map.behaviors.disable("scrollZoom")),this.map.container.fitToViewport(),this.loaded=!0,$rootScope.$broadcast("mapIsLoadedOnInit:"+id,!0))},showSingleAddress:function(value,baloon,callback){function setProps(center){that.map.container.fitToViewport(),that.map.setCenter(center||geoCoder.get(value).coords),that.map.setZoom(zoom),that.mapPlaceMark.geometry.setCoordinates(center||geoCoder.get(value).coords),that.mapPlaceMark.properties.set("balloonContent",baloon),that.mapPlaceMark.events.add("click",function(e){baloon||e.preventDefault()}),that.isPlaceMarkAdded||(that.isPlaceMarkAdded=!0,that.map.geoObjects.add(that.mapPlaceMark)),$timeout(function(){that.map.container.fitToViewport()},200)}var zoom=14,that=this;if(_.isArray(value))return setProps(value),callback(that),void function(coords){return coords[0]||coords[1]?ymaps.geocode([+coords[0],+coords[1]]).then(function(res){return(res&&res.metaData&&res.metaData.geocoder&&res.metaData.geocoder.found)>0}):$q.when(!1)}(value).then(function(data){data||(that.coordsError=!0,callback(that))},function(error){that.coordsError=!0,callback(that)});geoCoder.get(value)?(setProps(),callback(that)):sharedExtServices.getCoordsByAddress({address:[value]},function(res){if(res.coords&&res.coords.length&&res.coords[0].latitude&&res.coords[0].longitude){var firstResult=res.coords[0],coords=[firstResult.latitude,firstResult.longitude],name=firstResult.address;geoCoder.set(value,{coords:coords,name:name}),setProps(),that.error=""}else that.error="Не удалось загрузить адрес";callback(that)},function(){that.error="Не удалось загрузить адрес",callback(that)})},showAddress:function(value,list,baloon,callback,withGeoCoderSearch,userSelectedRegionName){var that=this;angular.isString(value)?that.showSingleAddress(value,baloon,callback):_.isArray(value)?that.showSingleAddress(value,baloon,callback):that.showListAddress(value,list,baloon,callback,withGeoCoderSearch,userSelectedRegionName)},removeAllPlacemarks:function(value,list,baloon){this.objectManager&&this.objectManager.removeAll(),value&&list?(this.value=value,this.list=list,this.setCollection(this.value,baloon,list,!0),this.error=""):value||(this.error="Не удалось загрузить адрес",this.coords=void 0,this.list=void 0)},showListAddress:function(coords,list,baloon,callback,withGeoCoderSearch){if(withGeoCoderSearch)return void this.setCollectionGeoSearch();if(this.objectManager&&this.objectManager.removeAll(),this.activePlacemark){var that=this;list&&list.some(function(es){return that.activePlacemark.coords===es.center})||(this.activePlacemark=void 0)}coords&&list?(this.coords=coords,this.list=list,this.setCollection(this.coords,baloon,this.list),this.error=""):(this.error="Не удалось загрузить адрес",this.coords=void 0,this.list=void 0),callback&&callback()},getCustomBalloonContentLayout:function(){if(void 0!==ymaps.templateLayoutFactory){var that=this,btnTemplateMob="mob"===$rootScope.version?"{% if properties.res.btnName %}<div class='PGU-FieldMapWithList-buttonwrap PGU-BtnContainer-column'><div class='PGU-Btn-margin'>{% if !properties.res.btnFromCluster %}<a tabindex='1' href='#' class='PGU-Button PGU-Button-Choose PGU-Btn-Base PGU-Btn-Small PGU-Btn-Blue'>{{properties.res.btnName}}</a>{% endif %}{% if properties.res.btnFromCluster &&  properties.res.itemData && properties.res.itemData.code %}<a tabindex='1' href='#' data-objectid='{{properties.res.itemData.code}}' class='PGU-Button PGU-Button-Choose PGU-Btn-Base PGU-Btn-Small PGU-Btn-Blue'>{{properties.res.btnName}}</a>{% endif %}{% if properties.res.btnFromCluster &&  properties.res.itemData && properties.res.itemData.numIk %}<a tabindex='1' href='#' data-objectid='{{properties.res.itemData.id}}' class='PGU-Button PGU-Button-Choose PGU-Btn-Base PGU-Btn-Small PGU-Btn-Blue'>{{properties.res.btnName}}</a>{% endif %}{%  if properties.res.btnFromCluster && !properties.res.itemData && properties.res.id >= 0 %}<a tabindex='1' href='#' data-objectid='{{properties.res.id}}' class='PGU-Button PGU-Button-Choose PGU-Btn-Base PGU-Btn-Small PGU-Btn-Blue'>{{properties.res.btnName}}</a>{% endif %}</div></div>{% endif %}":"",btnTemplateDesk="mob"!==$rootScope.version?"{% if properties.res.btnName %}<div class='PGU-FieldMapWithList-buttonwrap PGU-BtnContainer-column'><div class='PGU-Btn-margin'>{% if !properties.res.btnFromCluster %}<a tabindex='1' href='#' class='PGU-Button PGU-Button-Choose PGU-Btn-Base PGU-Btn-Small PGU-Btn-Blue'>{{properties.res.btnName}}</a>{% endif %}{% if properties.res.btnFromCluster &&  properties.res.itemData && properties.res.itemData.code %}<a tabindex='1' href='#' data-objectid='{{properties.res.itemData.code}}' class='PGU-Button PGU-Button-Choose PGU-Btn-Base PGU-Btn-Small PGU-Btn-Blue'>{{properties.res.btnName}}</a>{% endif %}{% if properties.res.btnFromCluster &&  properties.res.itemData && properties.res.itemData.numIk %}<a tabindex='1' href='#' data-objectid='{{properties.res.itemData.id}}' class='PGU-Button PGU-Button-Choose PGU-Btn-Base PGU-Btn-Small PGU-Btn-Blue'>{{properties.res.btnName}}</a>{% endif %}{%  if properties.res.btnFromCluster && !properties.res.itemData && properties.res.id >= 0 %}<a tabindex='1' href='#' data-objectid='{{properties.res.id}}' class='PGU-Button PGU-Button-Choose PGU-Btn-Base PGU-Btn-Small PGU-Btn-Blue'>{{properties.res.btnName}}</a>{% endif %}</div></div>{% endif %}":"",customBalloonContentLayout=ymaps.templateLayoutFactory.createClass("<div class='PGU-FieldMapWithList-Baloon'>"+btnTemplateMob+"<div class='PGU-FieldMapWithList-Baloon-content'><h3 class='PGU-FieldMapWithList-Baloon-content-Header'>{{properties.res.title}}</h3>{% if properties.res.baloonContent && properties.res.baloonContent.length %}{% for cont in properties.res.baloonContent %}{% if cont.value %}<div class='PGU-FieldMapWithList-Item-Attrs'>{% if cont.label %}<label>{{cont.label}}: </label>{% endif %}<span class='PGU-AttrsValue'>{{cont.value|raw}}</span></div>{% endif %}{% endfor  %}{% endif %}</div>"+btnTemplateDesk+"</div>",{build:function(){this._data&&this._data.geoObject&&this._data.geoObject.id>=0&&this._data.geoObject.properties&&this._data.geoObject.properties.res&&(that.activePlacemark={coords:this._data.geoObject.properties.res.center,id:this._data.geoObject.id}),customBalloonContentLayout.superclass.build.call(this);var parentElement=angular.element(this.getParentElement());parentElement.find(".PGU-Button").bind("click",this.onClick),PGU.Events.publish(":__mapIsOpened"),$timeout(function(){parentElement.find(".PGU-Button").length&&parentElement.scrollTo(parentElement.find(".PGU-Button"))})},clear:function(){$(".PGU-Button",this.getParentElement()).unbind("click",this.onClick),customBalloonContentLayout.superclass.clear.call(this)},onClick:function(e){e.preventDefault();var addr,elementId,itemData,item,$objectId=e.target.getAttribute("data-objectid"),checkedId=$objectId||that.activePlacemark.id.toString();if(that.list?(item=that.objectManager.objects.getById(checkedId).properties.res,addr=item.address,elementId=item.elementId,itemData=item):checkedId&&(item=that.objectManager.objects.getById(checkedId).properties.res,addr=item.itemData.address,itemData=item.itemData,itemData.btnFromCluster=item.btnFromCluster),that.opts.subjCode){var voteDate=$moment($rootScope.settings.electionsSettings.voteDate||$moment(),"YYYY-MM-DD").format("DD.MM.YYYY");itemData.votingList=[],that.opts.isOnlyBounds?that.opts.ballonButtonClick(addr,elementId,!1,itemData):sharedExtServices.ElectionService.getElectionsByUikAndDate({uikNum:itemData.numIk,uikSubjCode:itemData.subjCod,voteDate:voteDate,electionLevel:that.opts.voteLevel,electionSubjCode:that.opts.subjCode}).then(function(response){itemData.votingList=response&&response.data||[],that.opts.ballonButtonClick(addr,elementId,!1,itemData)},function(){})}else that.opts.ballonButtonClick(addr,elementId,!1,itemData)}});return customBalloonContentLayout}},initObjectManager:function(){if(!this.objectManager){var result={type:"FeatureCollection",features:[]},that=this,OMSettings={clusterize:!0,minClusterSize:2,gridSize:128,geoObjectBalloonMaxWidth:this.isPhone||device.desktop()?275:300,geoObjectBalloonOffset:[0,-12],geoObjectHideIconOnBalloonOpen:!1,geoObjectIconColor:"#0D69AF",clusterBalloonItemContentLayout:this.getCustomBalloonContentLayout()};this.isPhone&&(OMSettings.clusterBalloonContentLayout="cluster#balloonCarousel",OMSettings.clusterBalloonPagerSize=3),this.objectManager=new ymaps.ObjectManager(OMSettings),this.objectManager.objects.options.set(that.icons.blue),this.objectManager.objects.options.set("balloonContentLayout",this.getCustomBalloonContentLayout()),this.isPhone&&(this.objectManager.objects.options.set("balloonPanelMaxMapArea","Infinity"),this.objectManager.clusters.options.set("balloonPanelMaxMapArea","Infinity"));var resUri=LOC.RESOURCE_URI.split(":"),resourceUrl=$rootScope.inOpWidget?resUri[1].replace("/designer/","/widgets/"):resUri[1];this.objectManager.clusters.options.set({clusterIcons:[{href:resourceUrl+"img/elements/"+($rootScope.settings.mobOptimizeEqueue?"pin_cluster.svg":"pin_blue_nb@1x.png"),size:$rootScope.settings.mobOptimizeEqueue?[40,40]:[38,54],offset:$rootScope.settings.mobOptimizeEqueue?[-20,-20]:[-19,-22],shape:{type:"Circle",coordinates:[0,0],radius:30}}],clusterIconContentLayout:ymaps.templateLayoutFactory.createClass('<span class="PGU-Cluster-Pin-Number">{{ properties.geoObjects.length }}</span>')}),this.objectManager.objects.events.add("mouseenter",function(evt){var objectId=evt.get("objectId");!that.objectManager.objects.balloon.isOpen(objectId)&&that.opts.selectedIds.indexOf(objectId)<0&&that.objectManager.objects.setObjectOptions(objectId,{iconImageHref:that.icons.lightBlue.iconImageHref})}),this.objectManager.objects.events.add("mouseleave",function(evt){var objectId=evt.get("objectId");!that.clicked&&!that.objectManager.objects.balloon.isOpen(objectId)&&that.opts.selectedIds.indexOf(objectId)<0&&that.objectManager.objects.setObjectOptions(objectId,{iconImageHref:that.icons.blue.iconImageHref}),that.clicked=!1}),this.objectManager.objects.events.add("click",function(evt){var coords,objectId=evt.get("objectId"),obj=that.objectManager.objects.getById(objectId);that.preventBoundsChangeBalloon=!0,that.hasBalloonData(objectId)?(coords=obj.geometry.coordinates,that.clicked=!0,that.opts.afterBaloonOpen&&that.opts.afterBaloonOpen(that.list[objectId].address,that.list[objectId].elementId),that.centeredPlaceMark(coords,objectId),that.opts.placemarkClick(objectId)):that.loadBalloonData(objectId,obj).then(function(response){var balloonData=that.getMappedAttrsForBaloon(that.mapContent.baloonContent,response.data),uikNumber=response.data&&(response.data.numIk||response.data.numberuik);obj.properties.res={title:uikNumber?"Участок №"+uikNumber:response.data.title,btnName:that.mapContent.btnName,itemData:response.data},obj.properties.res.baloonContent=balloonData,that.objectManager.objects.balloon.setData(obj),coords=obj.geometry.coordinates,that.clicked=!0,that.centeredPlaceMark(coords,objectId),that.opts.placemarkClick(objectId)},function(error){return objectId})}),this.objectManager.clusters.events.add("click",function(evt){that.preventBoundsChange=!0}),this.objectManager.clusters.events.add("balloonopen",function(e){that.opts.clusterBalloon.show=!0;var clusterId=e.get("objectId"),cluster=that.objectManager.clusters.getById(clusterId),geoObjects=cluster.properties.geoObjects||[],geoObjectId=geoObjects&&geoObjects.length&&geoObjects[0].id,promiseStack=[];geoObjects.forEach(function(item){that.hasBalloonData(item.id)||promiseStack.push(that.loadBalloonData(item.id,item))});var coords=cluster.geometry.coordinates;$q.all(promiseStack).then(function(response){response&&response.length&&geoObjects.forEach(function(obj){var dataById=response.find(function(item){return item.data.code==obj.id||item.data.numIk&&item.data.numIk==obj.uiknum}),data=dataById?dataById.data:null;if(data){var balloonData=that.getMappedAttrsForBaloon(that.mapContent.baloonContent,data),uikNumber=data.numIk||data.numberuik;obj.properties.res={title:uikNumber?"Участок №"+uikNumber:data.title,btnName:that.mapContent.btnName,itemData:data,btnFromCluster:!0},obj.properties.clusterCaption="Участок №"+uikNumber,obj.properties.res.baloonContent=balloonData,that.clicked=!0}}),$timeout(function(){that.map.container.fitToViewport()},0),that.objectManager.clusters.balloon.setData(that.objectManager.clusters.balloon.getData()),that.centeredPlaceMark(coords,geoObjectId,void 0,!0),that.opts.placemarkClick(clusterId)})}),this.objectManager.objects.balloon.events.add("userclose",function(evt){if(that.activePlacemark){var objectId=that.activePlacemark.id;that.opts.selectedIds.indexOf(objectId)<0&&that.objectManager.objects.setObjectOptions(objectId,{iconImageHref:that.icons.blue.iconImageHref}),that.activePlacemark=void 0}"function"==typeof that.opts.afterUserClose&&that.opts.afterUserClose()}),this.objectManager.clusters.events.add("balloonclose",function(e){that.opts.clusterBalloon.show=!1,$timeout(function(){that.map.container.fitToViewport()},0)}),this.map.geoObjects.add(this.objectManager),this.objectManager.add(result)}},setModelCachedIds:function(data){var self=this;data&&data.length&&this.opts.cachedIds&&data.forEach(function(item){self.opts.cachedIds.push(item.id)})},addCollection:function(list,bounds,notZoom){var that=this;if(!that.opts.subjCode)for(var i=0;i<list.length;i++)that.opts.cachedIds.push(list[i].id);this.objectManager&&this.objectManager.add(list),notZoom?that.preventBoundsChange=!1:this.setBoundsAndZoom(null,bounds)},getUserCoords:function(str){var df=$q.defer();return ymaps&&ymaps.geocode(str,{results:1}).then(function(response){var geoObjects=response.geoObjects,moscowCenter=[37.655023,55.88823],geoObjectsLength=geoObjects.getLength(),userCoords=geoObjectsLength?geoObjects.get(0).geometry.getCoordinates():moscowCenter,bounds=geoObjectsLength?geoObjects.get(0).properties.get("boundedBy"):[];df.resolve({userCoords:userCoords,bounds:bounds})},function(){df.resolve([])}),df.promise},initGeoSearchByOpts:function(data,userSelectedRegion,realCoords){var self=this;if(this.objectManager&&this.objectManager.removeAll(),this.opts.cachedIds=[],self.opts.withSingleMandate){var coords=realCoords||data;sharedExtServices.getSingleMandate({longitude:coords.userCoords[1],latitude:coords.userCoords[0]}).then(function(singleMandateResponse){self.initGeoSearch(data,userSelectedRegion,singleMandateResponse.data)},function(error){})}else self.initGeoSearch(data,userSelectedRegion)},initGeoSearch:function(data,userSelectedRegion,singleMandateResponse){var self=this;singleMandateResponse&&(self.singleMandateCode=singleMandateResponse),self.opts.setGeoSearchDropdownVal(data.bounds,userSelectedRegion),self.userCoords=data.userCoords,self.firstUserCoords=data.userCoords,self.preventBoundsChange=!0,self.setListByBounds(data.bounds,!0)},setCollectionGeoSearch:function(){var self=this;this.initObjectManager(),this.mapConfigContent(this.opts.mappingAttributes),$rootScope.geoCoderInitAddress?this.getUserCoordsFromFias($rootScope.geoCoderInitAddress.geoSearchDropdownVal):PGU.Events.subscribe("geoCoderInitAddress",id,function(evt,data){self.getUserCoordsFromFias(data.geoSearchDropdownVal),PGU.Events.unsubscribe("geoCoderInitAddress",id)})},setCollection:function(coords,baloon,list,mapNotLoad){if(ymaps&&void 0!==ymaps.templateLayoutFactory){var res={type:"FeatureCollection",features:[]},that=this;if(this.coords=coords,mapNotLoad)return that;var customBalloonContentLayout=ymaps.templateLayoutFactory.createClass("<div class='PGU-FieldMapWithList-Baloon'>"+($rootScope.settings.mobOptimizeEqueue?"<div class='PGU-FieldMapWithList-Baloon-content'>":"")+"{% if properties.res.slots.value !== '' %}<div class='slot-block'><span class='slot-box {{properties.res.slots.className}}'></span><span class='slot-message'>{{properties.res.slots.message}}</span></div>{% endif %}<h3>{{properties.res.title}}</h3>{% if properties.res.baloonContent && properties.res.baloonContent.length %}{% for cont in properties.res.baloonContent %}{% if cont.value %}<div class='PGU-FieldMapWithList-Item-Attrs'><label>{{cont.label}}: </label><span class='PGU-AttrsValue'>{{cont.value|raw}}</span></div>{% endif %}{% endfor  %}{% endif %}"+($rootScope.settings.mobOptimizeEqueue?"</div>":"")+"{% if properties.res.btnName %}<div class='PGU-FieldMapWithList-buttonwrap PGU-BtnContainer-column'><div class=\"max-error ng-hide\">Вы выбрали максимальное количество организаций.</div><div class='PGU-Btn-margin'><a tabindex='1' href='#' ng-class='' class='PGU-Button PGU-Button-Choose PGU-Btn-Base PGU-Btn-Small PGU-Btn-Blue' action=''>{{properties.res.btnName}}</a>{% endif %}</div>",{build:function(){customBalloonContentLayout.superclass.build.call(this);var parentElement=angular.element(this.getParentElement());parentElement.find(".PGU-Button").bind("click",this.onClick),PGU.Events.publish(":__mapIsOpened"),$timeout(function(){parentElement.find(".PGU-Button").length&&parentElement.scrollTo(parentElement.find(".PGU-Button"))})},clear:function(){$(".PGU-Button",this.getParentElement()).unbind("click",this.onClick),customBalloonContentLayout.superclass.clear.call(this)},onClick:function(e){e.preventDefault();var addr=that.list[that.activePlacemark.id].address,elementId=that.list[that.activePlacemark.id].elementId;that.opts.ballonButtonClick(addr,elementId)}}),OMSettings={clusterize:!0,minClusterSize:2,gridSize:128,geoObjectBalloonMaxWidth:this.isPhone||device.desktop()?275:265,geoObjectBalloonOffset:[0,-12],geoObjectHideIconOnBalloonOpen:!1,geoObjectIconColor:"#0D69AF",viewportMargin:300,zoomMargin:64,clusterBalloonItemContentLayout:this.getCustomBalloonContentLayout()};this.isPhone||(OMSettings.useMapMargin=!0);for(var i=0;i<list.length;i++)list[i].center&&list[i].center[0]&&list[i].center[1]&&res.features.push({type:"Feature",id:i,geometry:{type:"Point",coordinates:list[i].center},properties:{res:list[i]}});if(this.isPhone&&(OMSettings.clusterBalloonContentLayout="cluster#balloonCarousel",OMSettings.clusterBalloonPagerSize=3),!this.objectManager){this.objectManager=new ymaps.ObjectManager(OMSettings),this.objectManager.objects.options.set(that.icons.blue),this.objectManager.objects.options.set("balloonContentLayout",customBalloonContentLayout),this.isPhone&&(this.objectManager.objects.options.set("balloonPanelMaxMapArea","Infinity"),this.objectManager.clusters.options.set("balloonPanelMaxMapArea","Infinity"));var resUri=LOC.RESOURCE_URI.split(":"),resourceUrl=$rootScope.inOpWidget?resUri[1].replace("/designer/","/widgets/"):resUri[1];this.objectManager.clusters.options.set({clusterIcons:[{href:resourceUrl+"img/elements/"+($rootScope.settings.mobOptimizeEqueue?"pin_cluster.svg":"pin_blue_nb@1x.png"),size:$rootScope.settings.mobOptimizeEqueue?[40,40]:[38,54],offset:$rootScope.settings.mobOptimizeEqueue?[-20,-20]:[-19,-22],shape:{type:"Circle",coordinates:[0,0],radius:30}}],clusterIconContentLayout:ymaps.templateLayoutFactory.createClass('<span class="PGU-Cluster-Pin-Number">{{ properties.geoObjects.length }}</span>')}),this.objectManager.objects.events.add("mouseenter",function(evt){var objectId=evt.get("objectId");!that.objectManager.objects.balloon.isOpen(objectId)&&that.opts.selectedIds.indexOf(objectId)<0&&that.objectManager.objects.setObjectOptions(objectId,{iconImageHref:that.icons.lightBlue.iconImageHref})}),this.objectManager.objects.events.add("mouseleave",function(evt){var objectId=evt.get("objectId");!that.clicked&&!that.objectManager.objects.balloon.isOpen(objectId)&&that.opts.selectedIds.indexOf(objectId)<0&&that.objectManager.objects.setObjectOptions(objectId,{iconImageHref:that.icons.blue.iconImageHref}),that.clicked=!1}),this.objectManager.objects.events.add("click",function(evt){var objectId=evt.get("objectId"),obj=that.objectManager.objects.getById(objectId),coords=obj.geometry.coordinates;that.clicked=!0,that.opts.afterBaloonOpen&&that.opts.afterBaloonOpen(that.list[objectId].address,that.list[objectId].elementId),that.centeredPlaceMark(coords,objectId),that.opts.placemarkClick(objectId)}),this.objectManager.clusters.events.add("balloonopen",function(e){that.opts.clusterBalloon.show=!0;var clusterId=e.get("objectId"),cluster=that.objectManager.clusters.getById(clusterId),geoObjects=cluster.properties.geoObjects||[],geoObjectId=geoObjects&&geoObjects.length&&geoObjects[0].id,promiseStack=[];geoObjects.forEach(function(item){that.hasBalloonData(item.id,item)?item.properties&&item.properties.res&&(item.properties.res.btnFromCluster=!0,item.properties.clusterCaption=item.properties.res.title):promiseStack.push(that.loadBalloonData(item.id,item))});var coords=cluster.geometry.coordinates;$q.all(promiseStack).then(function(response){response&&response.length&&geoObjects.forEach(function(obj){var dataById=response.find(function(item){return item.data.code==obj.id}),data=dataById?dataById.data:null;if(data){var balloonData=that.getMappedAttrsForBaloon(that.mapContent.baloonContent,data);obj.properties.res={title:data.numberuik?"Участок №"+data.numberuik:data.title,btnName:that.mapContent.btnName,itemData:data,btnFromCluster:!0},obj.properties.clusterCaption="Участок №"+data.numberuik,obj.properties.res.baloonContent=balloonData,that.clicked=!0}}),$timeout(function(){that.map.container.fitToViewport()},0),that.objectManager.clusters.balloon.setData(that.objectManager.clusters.balloon.getData()),that.centeredPlaceMark(coords,geoObjectId,void 0,!0),that.opts.placemarkClick(clusterId)})}),this.objectManager.objects.balloon.events.add("userclose",function(evt){if(that.activePlacemark){var objectId=that.activePlacemark.id;that.opts.selectedIds.indexOf(objectId)<0&&that.objectManager.objects.setObjectOptions(objectId,{iconImageHref:that.icons.blue.iconImageHref}),that.activePlacemark=void 0,that.__mapOpenedBalloonId=null}"function"==typeof that.opts.afterUserClose&&that.opts.afterUserClose()})}this.objectManager.add(res),this.map.geoObjects.add(this.objectManager),this.collection={},this.collection.list=res,this.setBoundsAndZoom(),this.setHomePlaceMark()}},setPinBackground:function(objectId){var that=this;!that.clicked&&!that.objectManager.objects.balloon.isOpen(objectId)&&that.opts.selectedIds.indexOf(objectId)<0&&that.objectManager.objects.setObjectOptions(objectId,{iconImageHref:that.icons.blue.iconImageHref})},closeBalloon:function(){var that=this;that.map&&that.map.balloon.close()},getMappedAttrsForBaloon:function(attrs,item){var itemValue,nameToLowerCase,withoutUnderScore,res=[];if(item){var itemKeys=Object.keys(item),lowerItemKeysMap={};itemKeys.forEach(function(li){var liToLower=li.toLowerCase();lowerItemKeysMap[liToLower]=li})}for(var i=0;i<attrs.length;i++){if(nameToLowerCase=attrs[i].name?attrs[i].name.toLowerCase():"",withoutUnderScore=nameToLowerCase.replace("_",""),itemValue=nameToLowerCase&&"title"!==nameToLowerCase?item.attributeValues?item.attributeValues[nameToLowerCase]||"":item[lowerItemKeysMap[nameToLowerCase]]||item[lowerItemKeysMap[withoutUnderScore]]:"",nameToLowerCase)switch(nameToLowerCase){case"address_out":itemValue=itemValue.replace(/\s{0,}(,{1,}\s{0,}){1,}/g,", ").replace(/(^,\s)|(,\s)$/g,"");break;case"phone_out":itemValue=itemValue.replace(/;|,|\./g,", ")}res.push({value:itemValue,label:attrs[i].label})}return res},mapConfigContent:function(mappingAttributes){var mappedConfig=DICT_DATA.defaultConf,btnName=mappedConfig.btnName,keys=DICT_DATA.keys;if(mappingAttributes){mappedConfig.btnName=mappingAttributes.mappedConfig&&mappingAttributes.mappedConfig.btnName||"",api.isTablet()&&mappedConfig.btnName===btnName&&(mappedConfig.btnName="Выбрать время");for(var i=0,il=mappingAttributes.list.length;i<il;i++)for(var key in keys)keys.hasOwnProperty(key)&&mappingAttributes.list[i][key]&&(mappedConfig[keys[key]]=[]);for(i=0,il=mappingAttributes.list.length;i<il;i++)for(key in keys)keys.hasOwnProperty(key)&&mappingAttributes.list[i][key]&&mappedConfig[keys[key]].push(mappingAttributes.list[i])}this.mapContent=mappedConfig},loadBalloonData:function(objectId,obj){return this.opts.subjCode?sharedExtServices.ElectionService.getListItemByBoundsUikByNum(obj.uiknum,obj.subjCode):sharedExtServices.ElectionService.getListItemByBounds(objectId)},hasBalloonData:function(objectId){return this.objectManager&&this.objectManager.objects.getById(objectId).properties.res},centeredPlaceMark:function(coords,objectId,zoom,isCluster,model){var oldId,mapZoom=zoom||this.map&&this.map.getZoom(),that=this,offset=that.opts.withGeoCoderSearch?0:43/Math.pow(2,mapZoom-1);if(this.activePlacemark&&(oldId=this.activePlacemark.id,this.objectManager&&this.objectManager.objects.setObjectOptions(oldId,{iconImageHref:that.icons.blue.iconImageHref})),this.objectManager&&this.objectManager.objects.setObjectOptions(objectId,{iconImageHref:that.icons.red.iconImageHref}),this.activePlacemark={coords:coords,id:objectId},coords&&coords[0]&&coords[1]){var center=this.map.getCenter(),equal=!0;that.__mapStateCenter||(that.__mapStateCenter=[]),that.__mapStateCenter[1]!==center[1]&&(equal=!1),!equal||equal&&that.__mapOpenedBalloonId!==objectId?isCluster?(model&&(model.loading=!1),that.preventBoundsChangeBalloon=!1):that.map.zoomRange.get([coords[0],coords[1]-offset]).then(function(range){that.map.setCenter([coords[0],coords[1]-offset],range[1]-2),model&&(model.loading=!1),$timeout(function(){that.objectManager.objects.balloon.open(objectId),that.__mapStateCenter=that.map.getCenter(),that.__mapOpenedBalloonId=objectId,that.preventBoundsChangeBalloon=!1},600)}):(model&&(model.loading=!1),that.preventBoundsChangeBalloon=!1)}else{that.closeBalloon();var addr=that.list[that.activePlacemark.id].address,elementId=that.list[that.activePlacemark.id].elementId;that.opts.ballonButtonClick(addr,elementId,!0)}},openAddress:function(objectValue){var objectById=this.list.find(function(item){return item.elementId===objectValue.elementId}),objectId=objectById&&objectById.id,mapZoom=this.map.getZoom();(!mapZoom||mapZoom<15)&&(mapZoom=15);var obj=this.objectManager.objects.getById(objectId);if(obj&&obj.geometry){var coords=obj.geometry.coordinates;this.centeredPlaceMark(coords,objectId,mapZoom),this.hideHomePlaceMark(),PGU.Events.publish(":__mapIsOpened")}},setBoundsAndZoom:function(model,boundsFromService,item){var that=this;if(that.map&&that.map.geoObjects&&that.map.geoObjects.getLength()&&(!model||model&&!model.loading)){model&&(model.loading=!0);var cont=$(".PGU-Panel-FieldMapWithListPhone");that.map.container.fitToViewport();var bounds=boundsFromService||that.map.geoObjects.getBounds();bounds&&bounds.every(function(dotes){return dotes.every(function(dote){return!isNaN(dote)})})&&(that.preventBoundsChange=!0,
that.map.setBounds(bounds,{checkZoomRange:!0}).then(function(){cont.hasClass("PGU-FMWLPhone-show-map");item&&item.selectPlacemarkData&&void 0!==item.selectPlacemarkData.id&&item.selectPlacemarkData.coords?(that.centeredPlaceMark(item.selectPlacemarkData.coords,item.selectPlacemarkData.id,void 0,!1,model),item.selectPlacemarkData={}):model&&(model.loading=!1),that.preventBoundsChange=!1,api.applyScope()},function(err){}))}},reverseBoundsValue:function(bounds){if(!bounds)return null;var innerBounds=bounds.slice(),result=[];return innerBounds.forEach(function(item){Array.isArray(item)&&result.push(item.slice().reverse())}),result},setListByBounds:function(bounds,showNewPins,notZoom){var self=this,codes=this.opts.cachedIds;if(showNewPins){var singleMandateCode,userCoords=this.userCoords;self.preventBoundsChange=!0,this.opts.withSingleMandate&&(singleMandateCode=this.singleMandateCode?this.singleMandateCode.code:"");var withDigitalElement,reverseBounds,subjCode=self.opts.subjCode,okrugNum=self.opts.okrugNum,voteLevel=self.opts.voteLevel,subjCodeByConditions=self.opts.isOnlyBounds?"":subjCode,withDigitalPath=self.opts.withDigitalPath,withDigitalValue=1;if(reverseBounds=self.reverseBoundsValue(bounds||this.map.getBounds()))return subjCode?(withDigitalPath&&(withDigitalElement=api.find(withDigitalPath))&&"2"===withDigitalElement.value()&&(withDigitalValue=0),sharedExtServices.ElectionService.getListByBoundsOkrugNum(reverseBounds,userCoords,codes,singleMandateCode,subjCodeByConditions,okrugNum,voteLevel,withDigitalValue).then(function(response){var data=response.data;self.addCollection(data,bounds,notZoom)},function(){self.addCollection([])})):sharedExtServices.ElectionService.getListByBounds(reverseBounds,userCoords,codes,singleMandateCode,$rootScope.geoCoderInitAddress.kladrCode).then(function(response){var data=response.data;self.addCollection(data,bounds,notZoom)},function(){self.addCollection([])})}else this.setBoundsAndZoom(null,bounds)},getUserCoordsFromFias:function(fiasAdress){var self=this;self.getUserCoords($rootScope.geoCoderInitAddress.fullAddress).then(function(realCoords){self.getUserCoords(fiasAdress).then(function(data){self.initGeoSearchByOpts(data,fiasAdress,realCoords)},function(error){})})},setHomePlaceMark:function(coords){(coords=coords||this.homeCoords)&&coords.length&&(!this.homePlaceMark||this.homePlaceMarkHidden?(this.homePlaceMarkHidden=!1,this.homePlaceMark=new this.ymaps.Placemark(coords,{},this.icons.house),this.map.geoObjects.add(this.homePlaceMark)):this.homePlaceMark.geometry.setCoordinates(coords))},createHomeIconePlaceMark:function(){if(!this.icons.house){var resUri=LOC.RESOURCE_URI.split(":"),resourceUrl=$rootScope.inOpWidget?resUri[1].replace("/designer/","/widgets/"):resUri[1];this.icons.house={iconLayout:"default#image",iconImageHref:resourceUrl+"img/elements/home_pin_icon.svg",iconImageSize:[24,40],iconImageOffset:[-12,-20],iconShape:{type:"Circle",coordinates:[0,0],radius:23},openBalloonOnClick:!1}}},hideHomePlaceMark:function(){this.map.geoObjects.remove(this.homePlaceMark),this.homePlaceMarkHidden=!0}}}}]),function(){"use strict";angular.module("serverForm.directives").directive("lang",["$rootScope","$timeout","TEMPLATES","translate",function($rootScope,$timeout,TEMPLATES,translate){return{restrict:"E",templateUrl:TEMPLATES.LANG,link:function(scope,element,attrs){function applyScope(){$timeout.cancel(applying),applying=$timeout(function(){scope.$apply()},200,!1)}var applying;scope.fullPath="__selectFormLanguage",scope.$on("changeLang",function(event,lang){lang&&(scope.selectedLang=scope.langs.find(function(item){return item.key===lang.key}),applyScope())}),scope.translates=[],scope.langs=[],$rootScope.env.formParam&&$rootScope.env.formParam.translationForm&&(scope.langs=JSON.parse($rootScope.env.formParam.translationForm));var langKey=translate.get();scope.selectedLang=scope.langs.find(function(item){return item.key===langKey}),scope.collapsed=function(){scope.isOpen=!scope.isOpen,scope.isOpen&&scope.$emit("selectDropdownOpened",{fullPath:scope.fullPath})},scope.$on("selectDropdownClose",function(evt,attrs){attrs.fullPath===scope.fullPath&&(scope.isOpen=!1,applyScope())}),scope.selected=function(lang){scope.selectedLang=lang,$timeout(function(){translate.use(lang.key)})}}}}])}(),angular.module("serverFormWidgets.general").directive("epguForm",["TEMPLATES","api","$compile","$sce","$rootScope","$timeout","apiInner","PGU","LOC",function(TEMPLATES,api,$compile,$sce,$rootScope,$timeout,apiInner,PGU,LOC){return{replace:!1,templateUrl:TEMPLATES.FORM,scope:{item:"="},controller:["$scope","$rootScope",function($scope,$rootScope){function showStep(el){if(angular.isNumber(el)){if($scope.item&&$scope.item.items)for(var i=0;i<$scope.item.items.length;i++)$scope.item.items[i].visibleStep=!1;$scope.item&&$scope.item.items&&$scope.item.items[el]&&($scope.item.items[el].visibleStep=!0,$rootScope.isDesigner||($scope.item.items[el].stepNumber=el+1)),$scope.visibleStep=el}else if("FormStep"==el.item.className)for(var i=0;i<$scope.item.items.length;i++)el.item.fullPath==$scope.item.items[i].fullPath&&showStep(i);else showStep(el.$parent)}function showAllSteps(){for(var i=0;i<$scope.item.items.length;i++)$scope.item.items[i].visibleStep=!0}function hideAllSteps(){$scope.showedAll=!1;for(var i=0;i<$scope.item.items.length;i++)$scope.item.items[i].visibleStep=!1;$scope.item.items&&$scope.item.items.length&&($scope.item.items[$scope.visibleStep].visibleStep=!0)}$scope.visibleStep=0,$rootScope.showStep=showStep;var resourceUrl=$rootScope.settings.selfFormPlayerUrlStatic||LOC.RESOURCE_URI;$scope.defaultImgSrc=resourceUrl+"img/elements/nut_arrow_1.svg",showStep($scope.visibleStep),$scope.item.getCatalogIcon=function(icons,type,defaultImg){if(icons&&icons.length>0){var img=icons.find(function(v){if(v.iconType==type)return!0});if(img)return img.path}return defaultImg},$rootScope.isDesigner||($scope.item.showAllSteps&&showAllSteps(),$scope.$watch("item.currentItem",function(val){val&&$scope.item.showAllSteps&&showAllSteps()}),$scope.$watch("item.showAllSteps",function(val,oldVal){void 0!==val&&void 0!==oldVal&&(val?showAllSteps():hideAllSteps())}),$scope.$watch("item.maxSizeAllFile",function(){$rootScope.env.totalOrderFileSize=$scope.item.maxSizeAllFile}),$rootScope.$on("integrationModuleDraft",function(){$rootScope.integrationModule&&($scope.item.visible=!0,$scope.item.integrationModuleDisclaimer={title:$rootScope.settings.integrationModuleDisclaimer.title,html:$rootScope.settings.integrationModuleDisclaimer.text,fullPath:$scope.item.fullPath+".integrationModuleDisclaimer",type:"important",visible:!0},$scope.item.integrationModuleMode=$rootScope.settings.integrationModuleMode,apiInner.loopThroughTheTree($scope.item.items,function(items,item){item.disabled=!0,"NavPanel"==item.className&&(item.visible=!1)}))}))}],link:function(scope,element,attrs){scope.isMobile=device.mobile(),scope.isIframe=api.isIframe(),scope.toggleModalVisible=function(value){scope.item.showEsiaModal=void 0!==value?value:!scope.item.showEsiaModal},scope.item.clickClosePopup=0;var formParam=api.env("formParam");if(scope.isDesktop=device.desktop(),formParam&&"true"===formParam.activateProgressBar){scope.item.progressBar={questions:40,answers:0},PGU.Events.unsubscribe("","updateProgressBar"),PGU.Events.subscribe("","updateProgressBar",function(evt,data){scope.item.progressBar.answers=data.value?++scope.item.progressBar.answers:--scope.item.progressBar.answers});var stickyProgressBar=function(){var topOffset,wrapPB=element[0].querySelector(".EPGU-progress-bars-Wrap"),colParentPB=element[0].querySelector(".EPGU-progress-bar-column"),parent=element[0].getElementsByClassName("PGU-FormContentBody")[0],scrollTop=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0,docHeight=document.documentElement.clientHeight,getRectData=function(el,key){return el.getBoundingClientRect()[key]};wrapPB&&parent&&(topOffset=scope.isDesktop?getRectData(parent,"top")<=0:getRectData(wrapPB,"top")-scrollTop<=0,topOffset?getRectData(parent,"height")-scrollTop-docHeight<=0&&colParentPB?colParentPB.classList.contains("align-self-end")||(colParentPB.classList.add("align-self-end"),wrapPB.classList.remove("PGU-Form-Sticky-ProgressBar")):wrapPB.classList.contains("PGU-Form-Sticky-ProgressBar")||(wrapPB.classList.add("PGU-Form-Sticky-ProgressBar"),colParentPB&&colParentPB.classList.remove("align-self-end")):(wrapPB.classList.contains("PGU-Form-Sticky-ProgressBar")&&wrapPB.classList.remove("PGU-Form-Sticky-ProgressBar"),colParentPB&&colParentPB.classList.contains("align-self-end")&&colParentPB.classList.remove("align-self-end")))};window.addEventListener("scroll",stickyProgressBar),scope.$on("$destroy",function(){window.removeEventListener("scroll",stickyProgressBar)})}scope.hideEsiaDialog=function(){return++scope.item.clickClosePopup},$rootScope.settings.paymentBlocks={},scope.$sce=$sce,scope.item.finishPage=!1,"false"===scope.item.hidePreview&&(scope.item.hidePreview="true"),PGU.Events.subscribe("","widget-has-payments",function(evt,data){PGU.Events.publish(data.fullPath+":widget-has-payments",data)}),PGU.Events.subscribe("","needDisableForm",function(evt,data){api.allFieldsDisabled(data.fullPath)}),PGU.Events.subscribe("","needUnDisableForm",function(evt,data){api.allFieldsUnDisabled()});var watchers;scope.$watch("item.shaded",function(val,oldVal){val!==oldVal&&($rootScope.mainLoader.show=val)}),scope.$on("suspend",function(){watchers=scope.$$watchers,scope.$$watchers=[]}),scope.$on("resume",function(){scope.$$watchers=watchers,watchers=null})}}}]).factory("FormExt",["containerAttrs","$rootScope",function(containerAttrs,$rootScope){return{attrs:angular.extend({},containerAttrs.attrs,{needLoadDraft:{type:"boolean",default:!0,"scope:editor":$rootScope.isAdminUser},title:{type:"string",default:"Название формы"},subTitle:{type:"string",default:"","scope:editor":!1},titleNew:{type:"string",default:"","scope:editor":$rootScope.isAdminUser},stepsOnTop:{type:"boolean",default:!0,"scope:editor":$rootScope.isAdminUser},showDescription:{type:"boolean",default:!0,"scope:editor":$rootScope.isAdminUser},presetType:{type:"string",default:"sf","scope:editor":!1},engineVersion:{type:"string",default:"1","scope:editor":$rootScope.isAdminUser,"scope:sync":!0},hidePreview:{type:"string",enum:["true","false"],enumOptions:{true:"Выкл",false:"Вкл"},default:"false","scope:editor":!1,"scope:sync":!0},dataSources:{"scope:editor":!1,default:""},dataSourcesId:{"scope:editor":!1,default:1},iconType:{type:"string",enum:["","registration","registration_service","kindergarten_service","gibdd","fns","fssp","passport","passport-foreign","driver_license","inn","fns_tax","registration_cadastral","mother_cap_cert","mother_cap","pension","registration_jur","registration_auto","registration_estate","keep_guns","detect_violation_advertising","check_criminal_record","prikreplenie_clinic","proverka_oms","vrach_nadom","attestation","land_section_queue"],enumOptions:{"":"без иконки",registration:"Регистрация",registration_service:"Регистрация (услуга)",kindergarten_service:"Детсад (услуга)",gibdd:"ГИБДД",fns:"ФНС",fssp:"ФССП",passport:"Паспорт","passport-foreign":"Загранпаспорт",driver_license:"Вод. права",inn:"ИНН",fns_tax:"Налоговая декларация",registration_cadastral:"Кадастровый учет",mother_cap_cert:"Получение материнского капитала",mother_cap:"Распоряжение материнским капиталом",pension:"Получение пенсий",registration_jur:"Регистрация юр. лиц",registration_auto:"Регистрация автотраспортных средств",registration_estate:"Регистрация прав недвижимости",keep_guns:"keep_guns",detect_violation_advertising:"Выявление нарушения законодательства о рекламе",check_criminal_record:"Получение справки о наличии судимости",health_home:"health_home",health_doctor:"health_doctor",prikreplenie_clinic:"Прикрепление к медицинской организации",proverka_oms:"Проверка ОМС",vrach_nadom:"Вызов врача на дом",attestation:"ЕГЭ",land_section_queue:"Очередь на предоставление земельного участка"},default:"","scope:editor":!1},showAllSteps:{type:"boolean",default:!1,"scope:editor":$rootScope.isAdminUser},applyingLazyRules:{type:"boolean",enum:[!0,!1],enumOptions:{true:"Да",false:"Нет"},default:!0,"scope:editor":$rootScope.isAdminUser},serviceMnemonic:{type:"string",default:"","scope:editor":!1},serviceTargetId:{type:"string",default:"","scope:editor":!1},loaderTitle:{type:"string",default:"","scope:editor":$rootScope.isAdminUser},loaderMsg:{type:"string",default:"Это может занять некоторое время","scope:editor":$rootScope.isAdminUser},orderTypeHidden:{type:"boolean",default:!1,"scope:editor":$rootScope.isAdminUser},maxSizeAllFile:{type:"integer",default:5120,"scope:editor":!0},showEsiaModal:{type:"boolean",default:!1,"scope:editor":!1},esiaDataForSave:{"scope:editor":!1,default:[]},pathToFinalHandler:{type:"string","scope:editor":$rootScope.isAdminUser,default:""},shaded:{type:"boolean",default:!1,"scope:ruleEditor":!0,"scope:editor":$rootScope.isAdminUser},draftsMap:{type:"string",default:"","scope:editor":!1},rules:{type:"string",default:""},autoSetStepNumbers:{type:"boolean",default:!1,"scope:editor":!0}})}}]),angular.module("serverFormWidgets.general").directive("epguFormStep",["$compile","TEMPLATES","api","$sce","$rootScope","CONFIG","sharedExtServices","$timeout","PGU","$q","apiInner",function($compile,TEMPLATES,api,$sce,$rootScope,CONFIG,sharedExtServices,$timeout,PGU,$q,apiInner){return{templateUrl:TEMPLATES.FORM_STEP,replace:!1,scope:{item:"=",stepIndex:"="},link:function(scope,element,attrs){function openStepForEdit(){scope.item.__draft=api.saveStepDraft([scope.item]),api.toggleDisabledStep(scope.item,!1),scope.item.editableMode=!0,api.editPreviousStep(scope.item)}function cancelEdit(withoutNext){function deleteAllClonesOnStep(item){item&&item.items&&item.items.length&&item.items.forEach(function(it){"Panel"===it.className&&(it.clonable&&api.find(it.fullPath).clones().slice().forEach(function(clone,i){i&&clone.element.destroy()}),it.isClone||deleteAllClonesOnStep(it)),"FieldDropdownMultiple"!=it.className&&"FieldDropdownMultipleExt2v"!=it.className||it.clearModel()})}PGU.Events.publish(":cancelEdit"),scope.item.__draft?(deleteAllClonesOnStep(scope.item),api.setDraft(scope.item.__draft,"cancel").then(function(data){scope.item.editableMode=!1,scope.item.__draft=null,$rootScope.$emit("setDraftAfterStepEdit"),withoutNext||(PGU.allPromises?$q.all(PGU.allPromises).then(function(){scope.item.editableMode=!1,scope.item.__draft=null,api.triggerNextStep()}):$timeout(function(){api.triggerNextStep()}))})):(scope.item.editableMode=!1,scope.item.__draft=null,withoutNext||api.triggerNextStep())}function saveEdit(){scope.item.editableMode=!1,api._previousStep=-1,PGU.Events.publish(":saveEdit"),api.setDraft(api.saveStepDraft([scope.item]),"save").then(function(data){var steps=api.getVisibleSteps(),visibleSteps=steps.filter(function(i){if(i.step.visibleStep)return i}),stepsLength=steps.length-visibleSteps.length,supportSignature=api.env("supportSignature"),cancelHandler=!1;scope.item.__draft=null,(0===stepsLength||supportSignature&&1===stepsLength)&&(cancelHandler=!0),api.triggerNextStep(cancelHandler)})}function stepFieldDisable(step,temp){function fieldsDisable(items,temp){items.forEach(function(item,index){"Panel"==item.className||void 0===item.disabled||item.disabled||(api.find(item.fullPath).disabled(!0),temp&&api.temporaryDisabled.push(item.fullPath)),item.items&&item.items.length&&fieldsDisable(item.items,temp)})}fieldsDisable(step.items,temp)}var label,watchers;if(!scope.item.name){["userRemovedProcc","formStepCode","userId","formStepType"].forEach(function(item){scope.item.attrs[item]&&(scope.item.attrs[item]["scope:sync"]=!1)})}scope.ui={btnStepEdit:{balign:"left",btnColor:"white",label:"Изменить данные шага",fullPath:scope.item.fullPath?scope.item.fullPath+"._btnStepEdit":"_btnStepEdit",floating:"PGU-BtnFloat",buttonSize:"small",visible:!0},btnCancelEdit:{balign:"left",btnColor:"white",label:"Отменить изменения",fullPath:scope.item.fullPath?scope.item.fullPath+"_btnCancelEdit":"_btnCancelEdit",floating:"PGU-BtnFloat",buttonSize:"small",visible:!0},btnSaveEdit:{balign:"right",btnColor:"blue",label:"Внести изменения",fullPath:scope.item.fullPath?scope.item.fullPath+"._btnSaveEdit":"_btnSaveEdit",floating:"PGU-BtnFloat",buttonSize:"small",visible:!0},isDesktop:device.desktop(),isPhone:device.mobile()},scope.$on("suspend",function(){watchers=scope.$$watchers,scope.$$watchers=[]}),scope.$on("resume",function(){scope.$$watchers=watchers,watchers=null}),scope.$root=$rootScope;var siaWebHostEdit=$rootScope.settings.siaWebHostEdit?$rootScope.settings.siaWebHostEdit:CONFIG.ESIA_LK;scope.item.hrefLk=siaWebHostEdit,scope.$emit(scope.item.fullPath+":ScopeApplied",{scope:scope,element:element}),scope.item.isScopeAppliedDone={scope:scope,element:element},scope.$watch("item.visibleStep",function(newVal,oldVal){oldVal!=newVal&&1==newVal&&PGU.Events.publish(":showSubmitButton")}),scope.$watch("item.visible",function(val,oldVal){var stepsLen=api.getVisibleSteps().length;void 0!==val&&void 0!==oldVal&&((val!==oldVal||!0===val&&1===stepsLen||2===stepsLen||api.env("showAllSteps"))&&api.setSubmitBtnName(),api.find().attr("autoSetStepNumbers")&&val!==oldVal&&api.setStepsLabels())}),$rootScope.isDesigner?scope.$sce=$sce:(scope.item.html&&(scope.$sce=$sce),label=scope.item.label,api.env("showAllSteps")?scope.item.stepNumber=label:(scope.item.isAccordionMode=!0,scope.item.editableMode=!1,isNaN(+label)&&(scope.item.title=label)),scope.$watch("item.label",function(label){label&&(api.env("showAllSteps")?scope.item.stepNumber=label+"":isNaN(+label)&&(scope.item.title=label))})),scope.item.openStepForEdit=openStepForEdit,scope.item.cancelEdit=cancelEdit,scope.item.saveEdit=saveEdit;var systemData=$rootScope.env.systemData,stepType=scope.item.formStepType,userId=scope.item.userId;systemData&&systemData.signCnt&&+systemData.signCnt>1&&("user"===stepType?userId?systemData.allSign&&"true"===systemData.allSign&&systemData.isOwner&&"true"===systemData.isOwner?+userId!==api.env("user").userId?stepFieldDisable(scope.item,!1):stepFieldDisable(scope.item,!0):+userId!==api.env("user").userId&&stepFieldDisable(scope.item,!1):scope.item.visible=!1:systemData.allSign&&"true"===systemData.allSign&&systemData.isOwner&&"true"===systemData.isOwner?stepFieldDisable(scope.item,!0):systemData.isOwner&&"false"===systemData.isOwner&&systemData.editAnotherUser&&"true"===systemData.editAnotherUser&&stepFieldDisable(scope.item,!0));!function(){if(void 0!==scope.item.stepLoader)var stepShaded=scope.$watch("item.stepLoader",function(val,oldVal){if(val<=0){scope.item.shaded=!1;var fullPath=scope.item.fullPath;PGU.Events.publish(fullPath+":stepRendered"),api._FormStepRendered[fullPath]=!0,$rootScope.settings.remainingStepsLength&&--$rootScope.settings.remainingStepsLength,$rootScope.settings.remainingStepsLength||$rootScope.env.remainingStepsDefer.resolve(),stepShaded()}})}()}}}]).factory("FormStepExt",["containerAttrs","$rootScope",function(containerAttrs,$rootScope){return{attrs:angular.extend({},containerAttrs.attrs,{html:{"scope:ruleEditor":!0,"scope:editor":$rootScope.isAdminUser},label:{default:"Шаг","scope:ruleEditor":!0},title:{default:"Заголовок шага","scope:ruleEditor":!0},mnemonicHint:{type:"string",default:"","scope:editor":$rootScope.isAdminUser},hasEsiaHint:{type:"boolean",default:!1,"scope:editor":$rootScope.isAdminUser},esiaHint:{type:"string",default:"Изменение личных данных будет происходить в личном кабинете","scope:editor":$rootScope.isAdminUser},hintBackground:{type:"string",default:"#CAD8E7","scope:editor":!1},userRemovedProcc:{type:"string",enum:["true","false"],enumOptions:{true:"Выкл",false:"Вкл"},default:"false","scope:editor":!1,"scope:sync":!0},disabled:{type:"boolean",default:!1,"scope:editor":!1,humanity:"Недоступно"},formStepCode:{type:"string",default:"","scope:sync":!0,"scope:editor":$rootScope.isAdminUser},userId:{type:"string",default:"","scope:sync":!0,"scope:editor":!1},formStepType:{type:"string",enum:["simple","user"],enumOptions:{simple:"Обычный",user:"С данными пользователя"},default:"simple","scope:sync":!0,"scope:editor":$rootScope.isAdminUser},shaded:{type:"boolean",default:!1,"scope:ruleEditor":!0,"scope:editor":$rootScope.isAdminUser},rules:{type:"string",default:""}})}}]).factory("CUSTOM_STEPS",["$rootScope","sharedExtServices",function($rootScope,sharedExtServices){return{getCaptchaStep:function(formName){return{className:"FormStep",name:"__FormStepCaptcha",fullPath:formName+".__FormStepCaptcha",label:"",title:"",doNotSaveDraft:!0,doNotShowInPdf:!0,submitEvents:{submit:[{eventType:"submit",_id:0,context:{},requestBinding:{order:{id:"__orderId"},draft:{id:"__draftId",version:"__draftVersion"}},responseBinding:{draft:{id:"__draftId",version:"__draftVersion"}},processor:"saveDraftProcessor"}]},items:[{className:"Panel",name:"PanelCaptcha",fullPath:formName+".__FormStepCaptcha.PanelCaptcha",title:"",submitEvents:{},items:[{className:"Captcha",name:"captchaAnswer",fullPath:formName+".__FormStepCaptcha.PanelCaptcha.captchaAnswer",doNotSaveDraft:!0,doNotShowInPdf:!0,notRequiredText:"",label:"",captchaId:"",captchaSimpleAttemptsCount:3,captchaBaseTime:15,captchaIncrementTime:30,submitEvents:{},maxlength:"255"}],rules:[]}],rules:[]}},getSMSConfirmStep:function(formName,systemData){return{className:"SMSConfirmDialog",name:"SMSConfirmDialog",fullPath:formName+".SMSConfirmDialog",visible:!1,smsConfCodeExpTime:systemData.smsConfCodeExpTime,smsConfCodeAttempt:systemData.smsConfCodeAttempt||3,items:[{className:"FieldText",name:"SMSConfirmDialogCode",fullPath:formName+".SMSConfirmDialog.SMSConfirmDialogCode",label:"Код",notRequiredText:"",visible:!0,required:!0,doNotSaveDraft:!0,maxlength:systemData.smsConfCodeLength}]}},addSmsConfirmStep:function(param){var formStructure=param.formStructure,smsStep=this.getSMSConfirmStep(formStructure.fullPath,param.systemData);return $rootScope.settings.EsepResult&&(smsStep.smsConfCodeExpTime=0),formStructure.items.push(smsStep),smsStep},addCaptchaStep:function(param){var captchaStep,self=this,formStructure=param.formStructure,navPanel=(param.api,_.find(formStructure.items,function(item){return"NavPanel"===item.className}));if($rootScope.env.systemData.isNeedCaptcha){$rootScope.env.isNeedCaptcha=!0,$rootScope.pathToCaptcha={},$rootScope.pathToCaptcha.step=formStructure.fullPath+".__FormStepCaptcha",$rootScope.pathToCaptcha.field=$rootScope.pathToCaptcha.step+".PanelCaptcha.captchaAnswer",captchaStep=self.getCaptchaStep(formStructure.fullPath);var pasteTo=0;return $rootScope.env.serviceFormInfo.SMS_CONFIRM&&--pasteTo,navPanel&&--pasteTo,"false"===$rootScope.env.formParam.defaultVisibleCaptcha&&(captchaStep.visible=!1),formStructure.items.splice(pasteTo,0,captchaStep),captchaStep}return captchaStep}}}]),angular.module("serverFormWidgets.general").directive("epguFormPreview",["$compile","TEMPLATES","api","$sce","formPreviewProperties","$rootScope","PGU",function($compile,TEMPLATES,api,$sce,formPreviewProperties,$rootScope,PGU){return{templateUrl:TEMPLATES.FORM_PREVIEW,replace:!0,scope:{item:"="},controller:["$scope","api",function($scope,api){$scope.generateContent=function(){$scope.item.elements=api.getPreviewContent()}}],link:function(scope,element,attrs,controller){scope.item.attrs={},formPreviewProperties.init(scope.item.attrs),scope.$root=$rootScope,scope.$watch("item.visibleStep",function(val){void 0!==val&&val&&scope.generateContent()});var watchers;scope.$on("suspend",function(){watchers=scope.$$watchers,scope.$$watchers=[]}),scope.$on("resume",function(){scope.$$watchers=watchers,watchers=null})}}}]).factory("formPreviewProperties",["containerAttrs",function(containerAttrs){return{init:function(m){angular.extend(m,containerAttrs.attrs,this.getAttrs())},getAttrs:function(){return{label:{default:"Предпросмотр формы"}}}}}]),angular.module("serverFormWidgets.general").directive("epguPanel",["$compile","TEMPLATES","api","apiInner","PGU","$rootScope","$sce","sharedExtServices","PanelProps","CONFIG","suggests","$timeout",function($compile,TEMPLATES,api,apiInner,PGU,$rootScope,$sce,sharedExtServices,PanelProps,CONFIG,suggests,$timeout){return{templateUrl:$rootScope.isDesigner?"js/designer/overrideTmpl/Panel/Panel.html":TEMPLATES.PANEL,replace:!1,controller:["$scope",function($scope){}],scope:{item:"="},link:function(scope,element,attrs){if(scope.item.fullPath.indexOf("DataGrid")+1&&(scope.item.isCloneContainer=!0),scope.item.inPanelTitle=!0,scope.openBlock=function(event){scope.item.isAccordionMode&&(scope.opened=!scope.opened,scope.rendered||(scope.accordionShade=!0,scope.rendered=!0,$timeout(function(){scope.accordionShade=!1},3e3,!1)),scope.opened?scope.accordionError=!1:api.scrollTo(scope.item.fullPath,"",-60)),PGU.Events.publish(":documentClick",event)},scope.item.stickyTitle){var stickyTitle=function(){var panelTitle=element[0].querySelector(".PGU-Panel-Title-box"),parent=element[0].getElementsByClassName("PGU-Panel-inner")[0],scrollTop=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0,getRectData=function(el,key){return el.getBoundingClientRect()[key]};panelTitle&&parent&&(getRectData(parent,"top")<0&&getRectData(parent,"top")+scrollTop+getRectData(parent,"height")-180>=scrollTop?panelTitle.classList.contains("PGU-Panel-Sticky-Title")||(panelTitle.style.width=getRectData(element[0].querySelector(".PGU-Panel-Title-box"),"width")+42+"px",panelTitle.classList.add("PGU-Panel-Sticky-Title")):panelTitle.classList.contains("PGU-Panel-Sticky-Title")&&(panelTitle.classList.remove("PGU-Panel-Sticky-Title"),panelTitle.style.width=""))};window.addEventListener("scroll",stickyTitle),scope.$on("$destroy",function(){window.removeEventListener("scroll",stickyTitle)})}scope.item.isAccordionMode?(scope.item.clonable&&!scope.item.isClone&&(scope.opened=scope.rendered=!0),PGU.Events.subscribe(scope.item.fullPath,"accordionError",function(){scope.opened||(api.__setFirstFieldError&&api.__setFirstFieldError.indexOf(scope.item.fullPath)>-1?scope.openBlock():scope.accordionError=!0,api.applyScope())})):scope.rendered=!0,scope.titleBoxClass=($rootScope.device.device?"device ":"")+($rootScope.device.mobile?"mobile ":"")+($rootScope.device.tablet?"tablet":""),scope.item.hrefLk=$rootScope.settings.siaWebHostEdit?$rootScope.settings.siaWebHostEdit:CONFIG.ESIA_LK,scope.item.isLastClone=void 0!==scope.item.isLastClone?scope.item.isLastClone:!!(scope.item.clonable&&scope.item.maxCloned>1),scope.itemclass="PGU-LabelWidth-{{item.labelWidth}} PGU-Panel-GridWidth-{{item.gridWidth}} PGU-Panel-GridWidth_palm-{{::item.gridWidthMobile}} PGU-Panel-GridWidth_lap-{{::item.gridWidthTablet}} PGU-Panel-Width-{{::item.width}} ",scope.$sce=$sce,scope.$root=$rootScope,scope.item.api=api,scope.panelClass="PGU-LabelWidth-"+scope.item.labelWidth+" PGU-Panel-GridWidth-"+scope.item.gridWidth+" PGU-Panel-GridWidth_palm-"+scope.item.gridWidthMobile+" PGU-Panel-GridWidth_lap-"+scope.item.gridWidthTablet+" PGU-Panel-Width-"+scope.item.width+(scope.item.isGrid?" PGU-Panel-Grid":"")+(scope.item.isGridItem?" PGU-Panel-Grid-Item":"")+(scope.item.hideOnMobile?" PGU-Control-HideOnMobile":"")+(scope.item.hideOnTablet?" PGU-Control-HideOnTablet":"")+(scope.item.hideOnDesktop?" PGU-Control-HideOnDesktop":"")+(scope.item.withRadioButton?" PGU-Panel-WithRadioBtn":"")+(scope.item.inRightPlace?" PGU-Panel-inRightPlace":"")+(scope.item.customClassName?" "+scope.item.customClassName:"")+(scope.item.isClone?" PGU-Panel-isClone":"")+(scope.item.clonable?" PGU-Panel-Clonable":"")+(scope.item.isAccordionMode?" PGU-Panel-Accordion":""),scope.addClone=function(){if(scope.item.disabled)return!1;var clone=scope.item.addClone(!1,scope.item.cloneIndex?1*scope.item.cloneIndex+1:1,api);$rootScope.isDesigner||suggests.init(api),$rootScope.rTreeRunner(clone,clone.cloneIndex),$timeout(function(){scope.item.api.applyScope()},300)},scope.removeClone=scope.item.destroy=function(){if(scope.item.disabled)return!1;scope.item.removeClone(),scope.item.isAccordionMode&&PGU.Events.unsubscribe(scope.item.fullPath,"accordionError"),scope.$destroy(),element.remove(),api.applyScope()},$rootScope.isDesigner&&(scope.$watch("item.radioGroupName",function(val,oldVal){var radio;void 0!==val&&val!==oldVal&&(radio=api.find(scope.item.fullPath+"."+oldVal),val?apiInner.isEmptyObject(radio)?(radio={className:"FieldRadio",name:val,list:[{label:"",value:""}],visible:!1,forceXml:!0,classNameRu:"Радио",fullPath:scope.item.fullPath+"."+val},scope.item.items.unshift(radio)):radio.attr("name",val):scope.item.items.splice(0,1))}),scope.$watch("item.clonable",function(val,oldVal){var parentEl=scope.item.parent&&scope.item.parent.apiElem.element;if(val&&val!==oldVal)"Panel"!==scope.item.parent.className?PanelProps.addParentPanelToClonable(apiInner,api):parentEl.isCloneContainer=!0;else if(!val&&parentEl){var hasOtherClones=parentEl.items.some(function(panel){return panel.clonable});parentEl.isCloneContainer=hasOtherClones}})),scope.item.radioGroupName&&(scope.initRadioGroupMode=function(){scope.radioGroup=[];for(var radioLists=[],radioGroupName=scope.item.radioGroupName,i=0,il=scope.item.items.length;i<il;i++){var item=scope.item.items[i];"FieldRadio"===item.className&&(item.radioGroupName===radioGroupName&&(scope.radioGroup.push(item),radioLists=radioLists.concat(item.list)),item.name===radioGroupName&&(scope.radioGroupHiddenItem=item))}scope.radioGroupHiddenItem.list=radioLists,PGU.Events.subscribe(scope.item.fullPath+"."+radioGroupName,"groupChangeActive",function(evt,data){scope.changeActiveRadio(data)})},scope.changeActiveRadio=function(data){for(var item,panel,i=0,il=this.radioGroup.length;i<il;i++){item=this.radioGroup[i];var parentPanel=api.find(item.parentFullPath);panel=parentPanel?parentPanel.find(item.name+"_panel"):void 0,item.list[0].value!==data.value?(item.value="",panel&&"Panel"===panel.attr("className")&&panel.attr("visible",!1)):panel&&"Panel"===panel.attr("className")&&panel.attr("visible",!0)}scope.radioGroupHiddenItem.value=data.value},scope.initRadioGroupMode());var watchers;scope.$on("suspend",function(){watchers=scope.$$watchers,scope.$$watchers=[]}),scope.$on("resume",function(){scope.$$watchers=watchers,watchers=null});var code=scope.item.mnemonicHint;code&&api.getHintInitCacheData(code).then(function(data){var itemHint=data.find(function(item){return item.code===code});itemHint&&itemHint.message?(scope.item.hintHtml=api.cleanMnemonicHintHtml(itemHint.message),scope.item.mnemonicHintShow=!0):scope.item.mnemonicHintShow=!1}),scope.item.clonable&&(PanelProps.initFullPathForXml(scope.item,scope.item.fullPath,scope.item.name,0),scope.$watch("item.visible",function(val,oldVal){(val!==oldVal||val)&&api.find(scope.item.fullPath).clones().forEach(function(panel){panel.clonable()||panel.visible(val)})})),scope.$emit(scope.item.fullPath+":ScopeApplied",{scope:scope,element:element}),scope.item.isScopeAppliedDone={scope:scope,element:element}}}}]).factory("PanelExt",["basePanelAttrs","containerAttrs","PanelProps","PGU","$rootScope","$timeout","suggests",function(basePanelAttrs,containerAttrs,PanelProps,PGU,$rootScope,$timeout,suggests){return{_addClone:function(noRender,index){var that=this;$rootScope.$applyAsync(that.addClone.bind(that.element,noRender,index,that.element.api,!0))},addClone:function(noRender,index,api){var panel=this.isClone?api.find(this.cloneParent).element:this,parent=api.find(panel.fullPath).parent(),nameWithoutIndex=PanelProps.changeIndex(panel.name),newIndex=noRender?index:panel.cloneId,model=(parent.attr("fullPath"),PGU.copy(JSON.parse(panel._model))),isMaxClone=!1,panelIndex=-1;if(this.api=api,parent.attr("items").forEach(function(item,ind){(item.isLastClone||item.clonable)&&(item.cloneParent&&item.cloneParent===panel.fullPath||item.fullPath===panel.fullPath)&&(item.isLastClone=!1,panelIndex=ind)}),!(panel.cloneCounter>=panel.maxCloned)){panel.cloneCounter+1===panel.maxCloned&&(isMaxClone=!0)
;var fullPathForXml=(parent.element.fullPathForXml?parent.element.fullPathForXml:parent.element.fullPath)+"."+nameWithoutIndex+"["+newIndex+"]",rendered=PGU.fireEvents.formRendered,modelRemoveBtnHidden=model.removeBtnHidden||!1;if(angular.extend(model,{isClone:!0,visible:panel.visible,cloneParent:panel.fullPath,cloneIndex:newIndex,cloneStyles:!0,clonable:!1,isLastClone:!0,isMaxClone:isMaxClone,name:nameWithoutIndex+"["+newIndex+"]",fullPathForXml:fullPathForXml,removeBtnHidden:rendered}),rendered){$rootScope.mainLoader.loadCounter<=0&&($rootScope.mainLoader.loadCounter=void 0);var watchLoader=$rootScope.$watch("mainLoader.loadCounter",function(newValue,oldValue){newValue<=0&&(api.find(fullPathForXml).removeBtnHidden(modelRemoveBtnHidden),watchLoader())})}return PanelProps.replaceFullPathInAttrs(model,panel.fullPath,panel.name,newIndex),PanelProps.initFullPathForXml(model,panel.fullPathForXml||panel.fullPath,panel.name,newIndex),panel.cloneId=noRender?index+1:panel.cloneId+1,panelIndex>-1&&parent.attr("items").splice(panelIndex+1,0,model),api.initAttrs([model],void 0,parent.element),PGU.Events.publish(panel.fullPath+":cloneAdded",{cloneIndex:newIndex}),api.afterMemberChanged(parent.element,panel.fullPath,"parentItem",parent.clones().length,parent.clones().length-1,panel,!0),PGU.toggleRemovedClone(fullPathForXml,!0),panel.cloneCounter++,model}},_removeClone:function(){this.element.removeClone()},removeClone:function(){function deleteFromFormHash(fullPath){fullPath&&Object.keys(FormHash).forEach(function(item){item!=fullPath&&0!==item.indexOf(fullPath)||delete FormHash[item]}.bind(this))}var panel=this.isClone?this.api.find(this.cloneParent).element:this,parent=this.api.find(panel.fullPath).parent(),panelIndex=-1,previousPanelIndex=-1;this.removeThisClone=!0;var parentClonesFP=[];this.api.__addToMarkDeletedRuntime(this.fullPathForXml,this),"true"===this.api.env("formParam").isSaveElDraft&&this.api.uploadDraft(!1,null,null,!1,panel,!0),parent.element.api.applyScope();var items=[],copyItem=parent.attr("items");for(var item in copyItem)items[item]=copyItem[item];items.forEach(function(item,ind){parentClonesFP.push(item.fullPathForXml),item.removeThisClone?(item.isLastClone&&(previousPanelIndex=ind-1),panelIndex=ind):item.isLastClone&&(item.isMaxClone=!1)}),panelIndex>-1&&items.splice(panelIndex,1),previousPanelIndex>-1&&(items[previousPanelIndex].isLastClone=!0),this._fetchItems(this.items,function(item){if(item.suggest){var hash=suggests.getHash();Object.keys(hash).forEach(function(key){hash[key]&&hash[key].elements&&hash[key].elements.slice().forEach(function(el,index){el.fullPath===item.fullPath&&hash[key].elements.splice(index,1)})}),suggests.setHash(hash)}item._removeParent&&!PGU.cancelEdit&&item._removeParent(),"function"==typeof item.__destroy&&item.__destroy()}),PGU.Events.publish(panel.fullPath+":cloneDeleted",{cloneIndex:panelIndex,parentClonesFP:parentClonesFP}),PGU.toggleRemovedClone(this.fullPath),panel.cloneCounter--,parent.attr("items",items),FormHash[this.fullPath]?deleteFromFormHash.call(this,this.fullPath):FormHash[this.originalFullPath]&&deleteFromFormHash.call(this,this.originalFullPath)},_fetchItems:function(items,callback){var self=this;items.forEach(function(item,index){callback&&callback(item),item.items&&item.items.length&&self._fetchItems(item.items,callback)})},attrs:angular.extend({},basePanelAttrs.attrs,{inlineCSS:{type:"string",default:"","scope:editor":!1,"scope:noChanges":!0},clonable:{type:"boolean",default:!1,"scope:noChanges":!0},isClone:{type:"boolean",default:!1,"scope:editor":!1,"scope:noChanges":!0},isCloneContainer:{type:"boolean",default:!1,"scope:editor":!1,"scope:noChanges":!0},cloneParent:{"scope:editor":!1,"scope:noChanges":!0},cloneId:{type:"integer",default:1,"scope:editor":!1},cloneIndex:{type:"string","scope:editor":!1,default:"0"},maxCloned:{type:"integer",default:20,checkInput:"interval",humanity:"Максимальное количество клонов","scope:ruleEditor":!0},cloneButtonName:{type:"string",default:"",maxLength:"100","scope:noChanges":!0},isGrid:{type:"boolean",default:!1,"scope:noChanges":!0},isGridItem:{type:"boolean",default:!1,"scope:noChanges":!0},gridWidth:{type:"string",enum:["one-whole","one-half","one-third","two-third","one-quarter","two-quarters","three-quarters","one-fifth","two-fifths","three-fifths","four-fifths","one-sixth","two-sixths","three-sixths"],enumOptions:{"one-whole":"1","one-half":"1/2","one-third":"1/3","two-third":"2/3","one-quarter":"1/4","two-quarters":"2/4","three-quarters":"3/4","one-fifth":"1/5","two-fifths":"2/5","three-fifths":"3/5","four-fifths":"4/5","one-sixth":"1/6","two-sixths":"2/6","three-sixths":"3/6"},default:"one-whole","scope:noChanges":!0},gridWidthMobile:{type:"string",enum:["one-whole","one-half","one-third","two-third","one-quarter","two-quarters","three-quarters","one-fifth","two-fifths","three-fifths","four-fifths","one-sixth","two-sixths","three-sixths"],enumOptions:{"one-whole":"1","one-half":"1/2","one-third":"1/3","two-third":"2/3","one-quarter":"1/4","two-quarters":"2/4","three-quarters":"3/4","one-fifth":"1/5","two-fifths":"2/5","three-fifths":"3/5","four-fifths":"4/5","one-sixth":"1/6","two-sixths":"2/6","three-sixths":"3/6"},default:"one-whole","scope:editor":$rootScope.isAdminUser,"scope:noChanges":!0},gridWidthTablet:{type:"string",enum:["one-whole","one-half","one-third","two-third","one-quarter","two-quarters","three-quarters","one-fifth","two-fifths","three-fifths","four-fifths","one-sixth","two-sixths","three-sixths"],enumOptions:{"one-whole":"1","one-half":"1/2","one-third":"1/3","two-third":"2/3","one-quarter":"1/4","two-quarters":"2/4","three-quarters":"3/4","one-fifth":"1/5","two-fifths":"2/5","three-fifths":"3/5","four-fifths":"4/5","one-sixth":"1/6","two-sixths":"2/6","three-sixths":"3/6"},default:"one-whole","scope:editor":$rootScope.isAdminUser,"scope:noChanges":!0},withRadioButton:{type:"boolean",default:!1,"scope:editor":$rootScope.isAdminUser,"scope:noChanges":!0},radioGroupName:{type:"string",default:"","scope:editor":$rootScope.isAdminUser,"scope:noChanges":!0},inRightPlace:{type:"boolean",default:!1,"scope:editor":$rootScope.isAdminUser,"scope:noChanges":!0},hideOnMobile:{type:"boolean",enum:[!0,!1],enumOptions:{true:"Да",false:"Нет"},default:!1,"scope:editor":$rootScope.isAdminUser,"scope:noChanges":!0},hideOnDesktop:{type:"boolean",enum:[!0,!1],enumOptions:{true:"Да",false:"Нет"},default:!1,"scope:editor":$rootScope.isAdminUser,"scope:noChanges":!0},hideOnTablet:{type:"boolean",enum:[!0,!1],enumOptions:{true:"Да",false:"Нет"},default:!1,"scope:editor":$rootScope.isAdminUser,"scope:noChanges":!0},mnemonicHint:{type:"string",default:"","scope:editor":$rootScope.isAdminUser,"scope:noChanges":!0},cloneCounter:{type:"integer",default:1,"scope:editor":!1},hasEsiaHint:{type:"boolean",default:!1,"scope:editor":$rootScope.isAdminUser,"scope:noChanges":!0},esiaHint:{type:"string",default:"Изменение личных данных будет происходить в личном кабинете","scope:editor":$rootScope.isAdminUser,"scope:noChanges":!0},hintBackground:{type:"string",default:"#CAD8E7","scope:editor":!1,"scope:noChanges":!0},serviceCardTitle:{type:"string",default:"","scope:editor":!1,"scope:noChanges":!0},removeBtnHidden:{type:"boolean",default:!1,"scope:editor":$rootScope.isAdminUser},addBtnHidden:{type:"boolean",default:!1,"scope:editor":$rootScope.isAdminUser},validateAlways:{type:"boolean",default:!1,"scope:editor":!1,"scope:noChanges":!0},shaded:{type:"boolean",default:!1,"scope:ruleEditor":!0,"scope:editor":$rootScope.isAdminUser},stickyTitle:{type:"boolean",default:!1,"scope:editor":$rootScope.isAdminUser,"scope:noChanges":!0},isAccordionMode:{type:"boolean",default:!1,"scope:editor":$rootScope.isAdminUser,"scope:noChanges":!0},openAccordionTitle:{type:"string",default:"Развернуть","scope:editor":$rootScope.isAdminUser,"scope:noChanges":!0},closeAccordionTitle:{type:"string",default:"Свернуть","scope:editor":$rootScope.isAdminUser,"scope:noChanges":!0},customClassName:{type:"string",default:"","scope:editor":!1,"scope:noChanges":!0},rules:{type:"string",default:"","scope:noChanges":!0}})}}]).factory("PanelProps",[function(){return{replaceFullPathInAttrs:function(model,fullPath,panelName,cloneIndex){if(model.fullPath&&(model.fullPath=this.replaceFullPath(model.fullPath,fullPath,panelName,cloneIndex)),this.filterByAttrs(model,fullPath,panelName,cloneIndex),model.items&&model.items.length)for(var i=0,il=model.items.length;i<il;i++)this.replaceFullPathInAttrs(model.items[i],fullPath,panelName,cloneIndex)},filterByAttrs:function(model,fullPath,panelName,cloneIndex){for(var attrs=["responseBindings","requestBinding","handlers","limits","dictionary"],i=0,il=attrs.length;i<il;i++)model[attrs[i]]&&this.replaceAttrs(attrs[i],model,fullPath,panelName,cloneIndex)},replaceAttrs:function(attrName,model,fullPath,panelName,cloneIndex){function dictionaryBindHelper(obj,key){obj.forEach&&obj.forEach(function(item,i){obj[i][key]=self.replaceFullPath(item[key],fullPath,panelName,cloneIndex),item.subSelectData&&item.subSelectData.requestAttrs&&item.subSelectData.requestAttrs.length&&item.subSelectData.requestAttrs.forEach(function(li,j){li.attrValue=self.replaceFullPath(li.attrValue,fullPath,panelName,cloneIndex)})})}var attr,listen,self=this;switch(attrName){case"dictionary":model.dictionary&&(attr=model.dictionary,attr.requestBinding&&dictionaryBindHelper(attr.requestBinding,"value"),attr.responseBindings&&dictionaryBindHelper(attr.responseBindings,"field"));break;case"handlers":if(model.handlers){attr=model.handlers;for(var i=0,il=attr.length;i<il;i++)if(attr[i].listen){listen=attr[i].listen;for(var j=0,jl=listen.length;j<jl;j++)listen[j].component=this.replaceFullPath(listen[j].component,fullPath,panelName,cloneIndex)}}break;case"limits":model.limits&&(attr=model.limits,model.limits=this.replaceFullPath(model.limits,fullPath,panelName,cloneIndex))}},changeIndex:function(name,ind){var match,str;return(match=name.match(/^([a-zA-Z0-9_]+)(\[\d+\])$/))?(str=match[1],ind&&(str+=ind),str):str=ind?name+ind:name},replaceFullPath:function(str,fullPath,panelName,cloneIndex){if(str){var regexp,cloneName,regexpClone=new RegExp(/\[0]/gi),cleanPath=str.replace(regexpClone,""),cleanFullPath=fullPath.replace(regexpClone,""),indexOfFullPath=cleanPath.indexOf(cleanFullPath);return cleanPath.indexOf(cleanFullPath)>-1?(panelName="."+panelName,indexOfFullPath<0?str:(cloneName=panelName+"["+cloneIndex+"]",str.indexOf(panelName+"[0]")>-1&&(panelName+="[0]"),indexOfFullPath+cleanFullPath.length<cleanPath.length?(panelName+=".",cloneName+=".",regexp=new RegExp(panelName.replace(/([-[\]{}()*+?.,\\^$|#])/g,"\\$1"),"g")):regexp=new RegExp((panelName+"$").replace(/([-[\]{}()*+?.,\\^|#])/g,"\\$1"),"g"),str.match(regexp)?str.replace(regexp,cloneName):str)):str}},initFullPathForXml:function(model,fullpath,panelName,index){var self=this;return model.fullPathForXml=self.replaceFullPath(model.fullPathForXml||model.fullPath,fullpath,panelName,index),function(model){model.items&&model.items.length&&model.items.forEach(function(item){return item.fullPathForXml=model.fullPathForXml+(item.name?"."+item.name:""),"FieldDropdownHierarchic"===item.className&&item.clones&&item.clones.length&&item.clones.forEach(function(clone){clone.fullPathForXml=model.fullPathForXml+(clone.name?"."+clone.name:"")}),self.initFullPathForXml(item,fullpath,panelName,index)})}(model)},addParentPanelToClonable:function(apiInner,api){apiInner.loopThroughTheTree(api.getForm(),function(items,item){if(item.currentItem){item.items=item.items||[];var newItem={className:"Panel",classNameRu:"Панель",name:item.name+"_container",fullPath:item.fullPath+"_container",items:[],isCloneContainer:!0},copyItem={className:"Panel",classNameRu:"Панель",name:item.name,fullPath:item.fullPath+"_container."+item.name,items:item.items},copyKeys=["addBtnHidden","clonable","cloneButtonName","closeAccordionTitle","customClassName","esiaHint","fixName","gridWidth","gridWidthMobile","gridWidthTablet","handlers","hasEsiaHint","hideOnDesktop","hideOnMobile","hideOnTablet","inRightPlace","isAccordionMode","isGrid","isGridItem","maxCloned","mnemonicHint","openAccordionTitle","radioGroupName","rules","stickyTitle","title","visible","withRadioButton"];Object.keys(item).forEach(function(key){copyKeys.indexOf(key)>-1&&(copyItem[key]=item[key])});var updateFullPath=function(items,newPath,oldPath){items.forEach(function(item){item.fullPath=item.fullPath.replace(oldPath,newPath),item.items&&item.items.length&&updateFullPath(item.items,newPath,oldPath)})};updateFullPath(copyItem.items,copyItem.fullPath,item.fullPath),item.parent.apiElem.element.items.some(function(it){if(it.fullPath===item.fullPath)return Object.keys(it).forEach(function(key){"parent"!==key&&(delete it[key],newItem[key]&&(it[key]=newItem[key]))}),it.items.push(copyItem),!0}),api.initAttrs(item.parent.apiElem.element.items,null,item.parent)}})}}}]),angular.module("serverFormWidgets.general").directive("epguFieldText",["TEMPLATES","api","$rootScope","$sce","sharedExtServices","$timeout","suggests","LOC","PGU","FORM_ERRORS","declineOfUnit",function(TEMPLATES,api,$rootScope,$sce,sharedExtServices,$timeout,suggests,LOC,PGU,FORM_ERRORS,declineOfUnit){return{templateUrl:TEMPLATES.FIELD_TEXT,replace:!1,scope:{item:"="},link:function(scope,element,attrs){function closeSuggest(event){$(event.target).closest('[full-path="'+scope.item.fullPath+'"]').length||(scope.ui.suggest.show=!1,scope.$applyAsync(),$(document).off("click",closeSuggest))}if($rootScope.isDesigner&&!$rootScope.isAdminUser&&(scope.item.forceXml=!0),scope.withCaptchaId=scope.item.captchaId,scope.captchaId=$rootScope.settings.lkApiUrl+"captcha/get?id="+scope.item.captchaId,scope.withCaptchaId){scope.item.captchaSimpleAttemptsCount=scope.item.captchaSimpleAttemptsCount-1,scope.captchaSetting={captchaSimpleAttemptsCount:scope.item.captchaSimpleAttemptsCount,captchaBaseTime:scope.item.captchaBaseTime,captchaIncrementTime:scope.item.captchaIncrementTime,inc:0,showTimeout:!1};var timeoutCounter,getCounter=function(num,titles,notNum){return notNum?declineOfUnit.get(num,titles):num+" "+declineOfUnit.get(num,titles)},secondTitles=["секундa","секунды","секунд"],updateCounter=function(num){if(timeoutCounter&&$timeout.cancel(timeoutCounter),!num)return scope.captchaSetting.showTimeout=!1,void(scope.captchaSetting.captchaSimpleAttemptsCount=scope.item.captchaSimpleAttemptsCount);scope.captchaSetting.counter=getCounter(num,secondTitles),timeoutCounter=$timeout(function(){--num,updateCounter(num)},1e3)};PGU.Events.subscribe("","wrongCaptchaAnswer",function(){var settings=scope.captchaSetting;settings.captchaSimpleAttemptsCount>0?(settings.captchaSimpleAttemptsCount--,PGU.Events.publish(":showSubmitButton"),sharedExtServices.captchaService.getCaptchaId(function(data){var field=api.find($rootScope.pathToCaptcha.field);field.value("").captchaId(data.captchaId),$rootScope.env.captchaId=data.captchaId,scope.captchaId=$rootScope.settings.lkApiUrl+"captcha/get?id="+scope.item.captchaId,api.find($rootScope.pathToCaptcha.step).visible(!0),api.scrollTo($rootScope.pathToCaptcha.step),$timeout(function(){field.error(FORM_ERRORS[3003])},400,!1)})):(api.find($rootScope.pathToCaptcha.field).value(""),updateCounter(settings.captchaBaseTime+settings.captchaIncrementTime*settings.inc),settings.inc++,settings.showTimeout=!0,sharedExtServices.captchaService.getCaptchaId(function(data){api.find($rootScope.pathToCaptcha.field).captchaId(data.captchaId),$rootScope.env.captchaId=data.captchaId,scope.captchaId=$rootScope.settings.lkApiUrl+"captcha/get?id="+scope.item.captchaId}))})}var watchers;scope.isMobile=$rootScope.device.mobile,scope.$on("suspend",function(){watchers=scope.$$watchers,scope.$$watchers=[]}),scope.$on("resume",function(){scope.$$watchers=watchers,watchers=null}),scope.models={suggest:{values:[],prepareSuggest:function(valueId,fullPath){scope.item._changedByUser=!0,suggests.set(scope.item.mnemonicAutofill,valueId,fullPath,!0),scope.ui.suggest.show=!1,$(document).off("click",closeSuggest)},removeSuggest:function(id,$event){$event.stopPropagation(),suggests.remove(id,scope.item.mnemonicAutofill)}}},scope.ui={suggest:{show:!1,hasValues:!1}},scope.$sce=$sce,scope.changeByUser=function(masked,clear){scope.item._changedByUser=!0},scope.$root=$rootScope,scope.$on(scope.item.fullPath+":keyup",function(obj,$event){9!==$event.which&&27!==$event.which||(scope.ui.suggest.show=!1,$(document).off("click",closeSuggest))}),scope.$on(scope.item.fullPath+":focus",function(){scope.item.mnemonicAutofill&&(scope.ui.suggest.show=!0,$(document).click(closeSuggest))}),PGU.Events.subscribe("","buttonClick",function(e,evt){closeSuggest(evt)}),scope.item.required&&api.find(scope.item.fullPath).setRequired(!0),scope.$watch("item.required",function(val,oldVal){void 0===val||val===oldVal||scope.item.withoutApi||api.find(scope.item.fullPath).setRequired(val)}),scope.$watch("item.value",function(val,oldVal){void 0!==val&&val!==oldVal&&(scope.withCaptchaId&&($rootScope.env.captchaAnswer=val,api.env("captchaAnswer",val)),scope.changeByUser(),!scope.item.withoutApi&&api.find(scope.item.fullPath).afterSetValue(val,oldVal))}),scope.$emit(scope.item.fullPath+":ScopeApplied",{scope:scope,element:element}),scope.item.isScopeAppliedDone={scope:scope,element:element},scope.item.withCheckbox&&(scope.models.label=scope.item.checkboxLabel,scope.item.isRusStatVersion&&(scope.item.cbInField=scope.models,scope.models.isCheckedFromField=!1),scope.toggleValue=function(val){var value="true"===val;scope.item._changedByUser=!value,scope.item.statusCheckbox=value||!1,scope.item._changedByUser=!1,scope.models.isCheckedFromField=value||!1,api.updateDependentFields(value,scope.item.dependentFields,scope.item.fullPath,scope.item.bindAttrsOnValue)}),(scope.item.hint||scope.item.mnemonicHint&&scope.item.mnemonicHint.length)&&(scope.item.needShadow=!0),scope.item.mnemonicHint&&"white_pgu.hint.phone"===scope.item.mnemonicHint&&!$rootScope.settings.smsNotificationsEnabled&&(scope.item.mnemonicHint=""),suggests.controlItemWithSuggest(scope.item,scope.ui)}}}]).factory("FieldTextExt",["$rootScope","fieldAttrs",function($rootScope,fieldAttrs){return{_changedByUser:!1,suggest:{},attrs:angular.extend({},fieldAttrs.attrs,{maxlength:{type:"integer",default:"","scope:noChanges":!0},minlength:{type:"integer",default:"",checkInput:"minlength",humanity:"Минимальное количество символов","scope:noChanges":!0},strategy:{type:"string",default:"",enum:$rootScope.editor&&[""].concat($rootScope.strategyKeys),enumOptions:$rootScope.editor&&$.extend({"":""},$rootScope.strategyHash),"scope:noChanges":!0},fieldWidth:{type:"string",enum:["20","40","60","80","100"],enumOptions:{20:"20%",40:"40%",60:"60%",80:"80%",100:"100%"},default:"40","scope:editor":!1,"scope:noChanges":!0},forceXml:{type:"boolean",enum:[!0,!1],enumOptions:{true:"Да",false:"Нет"},default:!1,"scope:editor":$rootScope.isAdminUser},theMaskValue:{type:"string",default:"","scope:noChanges":!0},theMaskedValue:{type:"string",default:"","scope:editor":!1,"scope:noChanges":!0},saveWithMask:{type:"boolean",enum:[!0,!1],enumOptions:{true:"Да",false:"Нет"},default:!1,"scope:noChanges":!0},mnemonicHint:{type:"string",default:"","scope:editor":$rootScope.isAdminUser,"scope:noChanges":!0},mnemonicAutofill:{type:"string",default:"","scope:editor":$rootScope.isAdminUser,"scope:noChanges":!0},withCheckbox:{type:"boolean",default:!1,"scope:editor":!1,"scope:noChanges":!0},checkboxLabel:{type:"string",default:"","scope:editor":!1,"scope:noChanges":!0},bindAttrsOnValue:{type:"string",default:"","scope:editor":!1,"scope:noChanges":!0},longLabel:{type:"string",default:"","scope:ruleEditor":!0},statusCheckbox:{type:"booleng",default:!1,"scope:editor":!1,"scope:noChanges":!0},captchaId:{type:"",default:"","scope:editor":!1,"scope:noChanges":!0},disabledViewType:{type:"string",default:"","scope:editor":$rootScope.isAdminUser}}),setAutofillValues:function(values){this.suggest={values:values}}}}]),angular.module("serverFormWidgets.general").directive("epguFieldTextDate",["fieldAttrs","TEMPLATES","api","$rootScope","$moment","$q","dateHelpers","$timeout","PGU","suggests",function(fieldAttrs,TEMPLATES,api,$rootScope,$moment,$q,dateHelpers,$timeout,PGU,suggests){return{templateUrl:TEMPLATES.FIELD_TEXT_DATE,replace:!0,scope:{item:"="},controller:["$scope","$timeout","ERRORSMSG","PGU",function($scope,$timeout,ERRORSMSG,PGU){function setFullDate(value){angular.forEach(dateHelpers.getDateParts(value),function(value,key){$scope.item[key]=value})}var options;if($scope.$watch("item.required",function(val,oldVal){void 0!==val&&val!==oldVal&&api.find($scope.item.fullPath).setRequired(val)}),$scope.item.__destroy=function(){PGU.Events.unsubscribe($scope.item.fullPath,"changeSettings")},$scope.item.value&&setFullDate($scope.item.value),$scope.$watch("item.value",function(value,oldValue){var dateReg=/\d{1,2}\.\d{1,2}.\d{4}/g;void 0===value||value===oldValue||!dateReg.test(value)&&""!==value?value&&10!=value.length&&api.find($scope.item.fullPath).validate(!0):($scope.item.isValid=!0,$scope.item.error=!1,api.find($scope.item.fullPath).afterSetValue(value,oldValue),$timeout(function(){api.find($scope.item.fullPath).validate()&&($rootScope.$broadcast($scope.item.fullPath+":dateChange",{value:value}),setFullDate(value))},0,!1))}),$scope.item.required&&api.find($scope.item.fullPath).setRequired(!0),$scope.item.limits&&(options=dateHelpers.setLimitsConditions($scope.item.fullPath,$scope.item.limits,$scope.item.yearRange),$scope.item.dateSettings=options.settings,$scope.item.limitsParts=options.limitsParts,$scope.item.limitsParts.depends)){var relatedFieldPath=$scope.item.limitsParts.depends;$scope.item.dateSettings=dateHelpers.updateDependantField($scope.item.limitsParts,$scope.item.fullPath,relatedFieldPath,$scope.item.yearRange),$rootScope.$on(relatedFieldPath+":dateChange",function(evt,data){if(void 0!==data.value&&api._FormHash[$scope.item.fullPath]&&($scope.item.dateSettings=dateHelpers.updateDependantField($scope.item.limitsParts,$scope.item.fullPath,relatedFieldPath,$scope.item.yearRange),$scope.item.value&&!api.find($scope.item.fullPath).validate())){var dateValue=$moment($scope.item.value,"DD.MM.YYYY").toDate(),maxDate=$scope.item.dateSettings.maxDate,minDate=$scope.item.dateSettings.minDate;$scope.item.value=dateValue>maxDate.toDate()?maxDate.format("DD.MM.YYYY"):minDate.format("DD.MM.YYYY")}})}}],link:function(scope,element,attrs){function formatDate(settings){return{minDate:settings.minDate.format("DD.MM.YYYY"),maxDate:settings.maxDate.format("DD.MM.YYYY")}}function getDefaultSettings(){var lp=scope.item.limitsParts,ds=scope.item.dateSettings,defaultMaxDate=lp.defaultMaxDate,defaultMinDate=lp.defaultMinDate;return{minDate:(ds.minDate===defaultMinDate?lp.minDate:ds.minDate).format("DD.MM.YYYY"),maxDate:(ds.maxDate===defaultMaxDate?lp.maxDate:ds.maxDate).format("DD.MM.YYYY")}}function setPositionInModal(input,inst,data){var cal=inst.dpDiv,inputRect=input.getBoundingClientRect(),elemTop=inputRect.top,elemLeft=inputRect.left,top=elemTop+input.offsetHeight;data?cal.css({top:top,left:elemLeft}):$timeout(function(){cal.css({top:top,left:elemLeft})})}if(!$rootScope.isDesigner){scope.isMobile=$rootScope.device.mobile,PGU.settedDefaultDatepicker||($.datepicker.setDefaults({dateFormat:"dd.mm.yy",firstDay:1,constrainInput:!0,closeText:"Готово",currentText:"Сегодня",dayNames:["Воскресенье","Понедельник","Вторник","Среда","Четверг","Пятница","Суббота"],dayNamesMin:["Вс","Пн","Вт","Ср","Чт","Пт","Сб"],dayNamesShort:["Вс","Пн","Вт","Ср","Чт","Пт","Сб"],monthNames:["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"],monthNamesShort:["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"],nextText:"",prevText:"",yearSuffix:"",changeMonth:!0,changeYear:!0,onSelect:function(date){api.find(PGU.lastActiveDatepickerPath).value(date)}}),PGU.settedDefaultDatepicker=!0);var inputDatePicker=$("input:first",$(element)),datepickerSetted=!1,setDatepickerOnVisible=function(picker){if(!scope.item.isComplete&&!datepickerSetted)if(picker.attr("id")!==scope.item.fullPath)$timeout(function(){inputDatePicker=$("input:first",$(element)),setDatepickerOnVisible(inputDatePicker)},500,!1);else if(picker.is(":visible"))picker.datepicker("destroy").datepicker(getDefaultSettings()),datepickerSetted=!0;else if(api.inheritedVisibility(scope.item.fullPath))$timeout(function(){setDatepickerOnVisible(picker)},500,!1);else if(!scope.item.visible)var watcher=scope.$watch("item.visible",function(newV,oldV){newV&&(setDatepickerOnVisible(picker),watcher())})};setDatepickerOnVisible(inputDatePicker),PGU.Events.subscribe(scope.item.fullPath,"changeSettings",function(event,settings){$timeout(function(){if(settings&&settings.dialog){try{PGU.Events.unsubscribe(settings.fullPath,"modalScroll"),inputDatePicker.datepicker("destroy")}catch(e){}var beforeShow={beforeShow:function(input,inst){setPositionInModal(input,inst),PGU.Events.subscribe(settings.fullPath,"modalScroll",function(evt,data){var elemTop=input.getBoundingClientRect().top;data&&data.top>elemTop?(inputDatePicker.datepicker("hide"),input.blur()):setPositionInModal(input,inst,data)})}};_.extend(beforeShow,formatDate(settings.dateSettings)),inputDatePicker.datepicker(beforeShow)}else{try{inputDatePicker.datepicker("destroy")}catch(e){}inputDatePicker.datepicker(formatDate(settings))}})});var range=scope.item.limitsParts.rangeFields;(range.maxDate||range.minDate)&&(PGU.Events.subscribe(scope.item.fullPath,"rangeChange",function(evt,data){if(data&&(data.maxDate||data.minDate)){try{inputDatePicker.datepicker("destroy")}catch(e){}angular.extend(scope.item.limitsParts,data),inputDatePicker.datepicker(formatDate(scope.item.limitsParts))}}),$timeout(function(){PGU.Events.publish(scope.item.fullPath+":rangeChange",scope.item.limitsParts)},500,!1));var watchers;scope.$on("suspend",function(){watchers=scope.$$watchers,scope.$$watchers=[]}),scope.$on("resume",function(){scope.$$watchers=watchers,watchers=null}),scope.setPicker=function(){setDatepickerOnVisible(inputDatePicker)},scope.hidePicker=function(){$(".ui-datepicker").hide()},PGU.Events.subscribe("","buttonClick",function(e,event){inputDatePicker.datepicker("hide")}),suggests.controlItemWithSuggest(scope.item),scope.$emit(scope.item.fullPath+":ScopeApplied",{scope:scope,element:element}),scope.item.isScopeAppliedDone={scope:scope,element:element}}}}}]).factory("FieldTextDateExt",["fieldAttrs","$moment","ERRORSMSG","$rootScope","$q",function(fieldAttrs,$moment,ERRORSMSG,$rootScope,$q){return{dateSettings:{},attrs:angular.extend({},fieldAttrs.attrs,{longLabel:{type:"string",default:"","scope:ruleEditor":!0},validators:{default:[],"scope:editor":!1},limits:{type:"string",default:"||||","scope:editor":!0},year:{type:"string",default:"1970","scope:sync":!0,"scope:editor":!1},month:{type:"string",default:"01","scope:sync":!0,"scope:editor":!1},date:{type:"string",default:"01","scope:sync":!0,"scope:editor":!1},hours:{type:"string",default:"0","scope:sync":!0,"scope:editor":!1},minutes:{type:"string",default:"0","scope:sync":!0,"scope:editor":!1},second:{type:"string",default:"0","scope:sync":!0,"scope:editor":!1},timezone:{type:"string",default:"+0400","scope:sync":!0,"scope:editor":!1},timestamp:{type:"string",default:"0","scope:sync":!0,"scope:editor":!1},format:{type:"string",default:"dd.mm.yyyy","scope:sync":!0,"scope:editor":!1},strategy:{type:"string",default:"",enum:$rootScope.editor&&[""].concat($rootScope.strategyKeys),enumOptions:$rootScope.editor&&$.extend({"":""},$rootScope.strategyHash),"scope:editor":$rootScope.isAdminUser},fieldWidth:{type:"string",enum:["20","40","60","80","100"],enumOptions:{20:"20%",40:"40%",60:"60%",80:"80%",100:"100%"},default:"40","scope:editor":!1},forceXml:{type:"boolean",enum:[!0,!1],enumOptions:{true:"Да",false:"Нет"},default:!1,"scope:editor":$rootScope.isAdminUser},theMaskValue:{type:"string",default:"00.00.0000","scope:editor":!1},theMaskedValue:{type:"string",default:"","scope:editor":!1},saveWithMask:{type:"boolean",default:!0,"scope:editor":!1},yearRange:{type:"string",default:"1900:2120"},maxlength:{type:"integer",default:"10","scope:editor":$rootScope.isAdminUser},mnemonicAutofill:{type:"string",default:"","scope:editor":$rootScope.isAdminUser}}),preValidate:function(){if(this.attr("limitsParts")){var value=this.value();if(!this.element.required&&""===value)return!1;var condition=this.attr("limitsParts").condition||"",minDate=this.attr("dateSettings").minDate,maxDate=this.attr("dateSettings").maxDate,minDateRange=this.attr("limitsParts").minDate||minDate,maxDateRange=this.attr("limitsParts").maxDate||maxDate,date=$moment(value,"DD.MM.YYYY"),inheritedVisibility=this.inheritedVisibility(this.attr("fullPath")),isValid=date.isValid(),errorMsg="",hasEqual=condition.indexOf("=")>-1,dateReg=this.element.required?/\d{1,2}\.\d{1,2}.\d{4}/g:/(\d{1,2}\.\d{1,2}.\d{4}|(^$))/g,customErrorMessage=this.attr("customErrorMessage");return inheritedVisibility?(isValid?(dateReg.test(this.value())||(errorMsg=ERRORSMSG.incorrectDate),this.attr("checkInterval")(date,hasEqual,minDate,maxDate)||(errorMsg=customErrorMessage||ERRORSMSG.incorrectDateInterval+" c "+minDate.format("DD.MM.YYYY")+" по "+maxDate.format("DD.MM.YYYY")),Object.keys(this.attr("limitsParts").rangeFields).length&&!this.attr("checkInterval")(date,hasEqual,minDateRange,maxDateRange)&&(errorMsg=customErrorMessage||ERRORSMSG.incorrectDateInterval+" c "+minDateRange.format("DD.MM.YYYY")+" по "+maxDateRange.format("DD.MM.YYYY"))):errorMsg=ERRORSMSG.incorrectDateFormat,errorMsg):errorMsg}},checkInterval:function(date,hasEqual,minDate,maxDate){return date.diff(minDate)>=0&&date.diff(maxDate)<=0}}}]).factory("dateHelpers",["$rootScope","$moment","api","ERRORSMSG","DATE_LIMITS_PARTS","PGU",function($rootScope,$moment,api,ERRORSMSG,DATE_LIMITS_PARTS,PGU){function checkAndSetDate(limitsParts,fieldPath,settings,key){var settedFromDesigner,defaultDateKey="default"+key.charAt(0).toUpperCase()+key.slice(1),self=this;if(limitsParts[key]&&limitsParts[key].indexOf("fullPath")>-1){var field=self.getLimitField(limitsParts[key]),fieldValue=field.value();settings[key]=limitsParts[defaultDateKey],limitsParts[key]=fieldValue?self.getDateFromString(fieldValue):limitsParts[defaultDateKey],limitsParts.rangeFields[key]=field,$rootScope.$watch(function(){return field.value()},function(newVal,oldVal){if(newVal!==oldVal){var date=newVal?self.getDateFromString(newVal):limitsParts[defaultDateKey],obj={};obj[key]=date,PGU.Events.publish(fieldPath+":rangeChange",obj)}})}else settings[key]=limitsParts[key]?"current"===limitsParts[key]?$moment():self.getDateFromString(limitsParts[key]):limitsParts[defaultDateKey],settedFromDesigner=!!limitsParts[key],limitsParts[key]=settings[key];return settedFromDesigner}return{setLimitsConditions:function(fieldPath,limits,yearRange){var param,mdO,xdO,opts=limits.split("|"),settings={},limitsPartsName=DATE_LIMITS_PARTS,limitsParts={defaultMinDate:this.getDateFromString("01.01.1900"),defaultMaxDate:this.getDateFromString("01.01.2120")};angular.forEach(limitsPartsName,function(item,ind){limitsParts[item]=opts[ind]}),limitsParts.depends&&(limitsParts.depends=limitsParts.depends.replace(/\[0\]/gi,"")),limitsParts.rangeFields={};var hasMinDate=checkAndSetDate.call(this,limitsParts,fieldPath,settings,"minDate"),hasMaxDate=checkAndSetDate.call(this,limitsParts,fieldPath,settings,"maxDate");if(limitsParts.condition&&"current"!==limitsParts.condition&&!hasMaxDate&&hasMinDate)switch(mdO={">=":this.getDateFromString(limitsParts.minDate),"<=":limitsParts.defaultMinDate,">":this.getDateWithShift(limitsParts.minDate,!0),"<":limitsParts.defaultMinDate},xdO={">=":limitsParts.defaultMaxDate,"<=":this.getDateFromString(limitsParts.minDate),">":limitsParts.defaultMaxDate,"<":this.getDateWithShift(limitsParts.minDate)},limitsParts.condition){case">=":case"<=":
case">":case"<":limitsParts.minDate=settings.minDate=mdO[limitsParts.condition],limitsParts.maxDate=settings.maxDate=xdO[limitsParts.condition]}if("current"===limitsParts.condition){param=limitsParts.modifier.indexOf("-")>-1;var midnight=$moment({h:0,m:0,s:0,ms:0});settings.minDate=param?this.getOffsetDate(limitsParts.modifier):midnight,settings.maxDate=param?midnight:this.getOffsetDate(limitsParts.modifier)}return"past"!==limitsParts.modifier&&"future"!==limitsParts.modifier||(param="past"===limitsParts.modifier,settings.minDate=param?limitsParts.defaultMinDate:this.getOffsetDate("+1d"),settings.maxDate=param?this.getOffsetDate("-1d"):limitsParts.defaultMaxDate),settings=this.setRangeYears(settings,yearRange),PGU.Events.publish(fieldPath+":changeSettings",settings),{limitsParts:limitsParts,settings:settings}},updateDependantField:function(limits,fieldPath,relatedFieldPath,yearRange){var field=api.find(fieldPath),relatedField=api.find(relatedFieldPath),date=relatedField&&relatedField.value()?$moment(relatedField.value(),"DD.MM.YYYY"):$moment({h:0,m:0,s:0,ms:0}),offsetDate=this.getOffsetDate(limits.modifier,date),settings={};return limits.modifier?offsetDate.diff(date)>0?settings=this.setOptsFromConditions(yearRange,fieldPath,limits,offsetDate,date,">"):offsetDate.diff(date)<0&&(settings=this.setOptsFromConditions(yearRange,fieldPath,limits,offsetDate,date,"<")):settings=this.setOptsFromConditions(yearRange,fieldPath,limits,date),"="===limits.condition&&(settings.minDate=offsetDate,settings.maxDate=offsetDate,field.attr("disabled",!0),field.value(offsetDate.format("DD.MM.YYYY"))),null!=date&&relatedField&&""!==relatedField.value()||(field.value(""),settings.minDate=limits.defaultMinDate,settings.maxDate=limits.defaultMaxDate),settings=this.setRangeYears(settings,yearRange),PGU.Events.publish(fieldPath+":changeSettings",settings),settings},setOptsFromConditions:function(yearRange,fieldPath,limits,date,currentLimit,param){var settings={},charHigher=param&&">"===param,charLower=param&&"<"===param;switch(limits.condition){case">":settings.minDate=this.getOffsetDate("+1d",date),settings.maxDate=charLower?currentLimit:limits.maxDate;break;case">=":settings.minDate=date,settings.maxDate=charLower?currentLimit:limits.maxDate;break;case"<":settings.minDate=charHigher?currentLimit:limits.minDate,settings.maxDate=this.getOffsetDate("-1d",date);break;case"<=":settings.minDate=charHigher?currentLimit:limits.minDate,settings.maxDate=date}return settings=this.setRangeYears(settings,yearRange),PGU.Events.publish(fieldPath+":changeSettings",settings),settings},setRangeYears:function(settings,yearRange){if(!yearRange)return settings;var yearRangeArr=yearRange.split(":").map(function(item){return parseInt(item)}),minRange=yearRangeArr[0],maxRange=yearRangeArr[1];return settings.minDate.year()<minRange&&settings.minDate.year(minRange),settings.maxDate.year()>maxRange&&settings.maxDate.year(maxRange),settings},getDateFromString:function(str){return $moment(str,"DD.MM.YYYY")},getDateWithShift:function(str,isTomorrow){return this.getDateFromString(str)[isTomorrow?"add":"subtract"](1,"d")},getOffsetDate:function(condition,originDate){for(var date=originDate&&originDate.clone()||$moment({h:0,m:0,s:0,ms:0}),pattern=/([+-])([0-9]+)\s*(d|D|w|W|m|M|y|Y)?/g,matched=pattern.exec(condition);matched;)date["+"===matched[1]?"add":"subtract"](parseInt(matched[2],10),"y"===matched[3]||"m"===matched[3]?matched[3].toUpperCase():matched[3].toLowerCase()),matched=pattern.exec(condition);return date},getDateParts:function(str){var splitDate,datePartsFromStr,date=$moment(str,"DD.MM.YYYY"),defaultDateSet={year:"1970",month:"01",date:"01",timestamp:"0",hours:"0",minutes:"0",second:"0",timezone:"+0400",format:"dd.mm.yyyy"};return""===str?defaultDateSet:date.isValid()?(splitDate=str.split("."),datePartsFromStr={year:splitDate[2],month:splitDate[1],date:splitDate[0],timestamp:(date.valueOf()-6e4*date.utcOffset())/1e3},angular.extend(defaultDateSet,datePartsFromStr)):void 0},getLimitField:function(limitPart){var path=limitPart.replace("fullPath:","");return api.find(path)}}}]),angular.module("serverFormWidgets.general").directive("epguFieldTextArea",["TEMPLATES","api","$rootScope","$timeout","$sce",function(TEMPLATES,api,$rootScope,$timeout,$sce){return{templateUrl:TEMPLATES.FIELD_TEXT_AREA,replace:!0,scope:{item:"="},controller:["$scope",function($scope){function logElForm(result){"true"===$rootScope.env.formParam.isLogElForm&&$rootScope.$emit("HEALTH_SEND",{event:"logElForm",timing:0,result:result,el:$scope.item.fullPath,order_id:api.env("orderId")})}var valueOnFocus="";$scope.changeByUser=function(){$scope.item._changedByUser=!0},$scope.onFocusHandler=function(){$scope.item.disabled&&$scope.item.readonly||(valueOnFocus=$scope.item.value,$scope.inFocus=!0,$scope.isSmall=!0,logElForm(3))},$scope.onBlurHandler=function(){$scope.item.value===valueOnFocus||api.env("autosaveDisabled")||api.uploadDraft(!1,null,null,!1,$scope.item),$timeout(function(){$scope.inFocus=!1,$scope.item.value||($scope.isSmall=!1),logElForm(4)},0)},$scope.$watch("item.value",function(val,oldVal){void 0===val||val===oldVal||$scope.item.withoutApi||api.find($scope.item.fullPath).afterSetValue(val,oldVal)}),$scope.$watch("item.required",function(val,oldVal){void 0===val||val===oldVal||$scope.item.withoutApi||api.find($scope.item.fullPath).setRequired(val)})}],link:function(scope,element,attrs){scope.$root=$rootScope,scope.$emit(scope.item.fullPath+":ScopeApplied",{scope:scope,element:element}),scope.item.isScopeAppliedDone={scope:scope,element:element};var watchers;scope.$on("suspend",function(){watchers=scope.$$watchers,scope.$$watchers=[]}),scope.$on("resume",function(){scope.$$watchers=watchers,watchers=null}),scope.isPhone=device.mobile(),scope.isTablet=device.tablet(),scope.isDesktop=device.desktop(),scope.isMobile=$rootScope.device.mobile,scope.item.maxlength&&element[0].querySelector("textarea").setAttribute("maxlength",scope.item.maxlength)}}}]).factory("FieldTextAreaExt",["$rootScope","fieldAttrs",function($rootScope,fieldAttrs){return{attrs:angular.extend({},fieldAttrs.attrs,{maxlength:{type:"integer",default:""},minlength:{type:"integer",default:"",checkInput:"minlength",humanity:"Минимальное количество символов"},strategy:{type:"string",default:"",enum:$rootScope.editor&&[""].concat($rootScope.strategyKeys),enumOptions:$rootScope.editor&&$.extend({"":""},$rootScope.strategyHash)},fieldWidth:{type:"string",enum:["20","40","60","80","100"],enumOptions:{20:"20%",40:"40%",60:"60%",80:"80%",100:"100%"},default:"40","scope:editor":!1},forceXml:{type:"boolean",enum:[!0,!1],enumOptions:{true:"Да",false:"Нет"},default:!1,"scope:editor":$rootScope.isAdminUser},longLabel:{type:"string",default:"","scope:ruleEditor":!0},rows:{type:"string",default:""},disabledViewType:{type:"string",default:"","scope:editor":$rootScope.isAdminUser}}),_changedByUser:!1}}]),angular.module("serverFormWidgets.general").directive("epguFieldCheckbox",["TEMPLATES","api","$rootScope","$timeout",function(TEMPLATES,api,$rootScope,$timeout){return{templateUrl:TEMPLATES.FIELD_CHECKBOX,replace:!1,scope:{item:"="},link:function(scope,element,attrs){var watchers;void 0===scope.item.value&&(scope.item.value="false",scope.item.textValue="Нет"),scope.$root=$rootScope,scope.$on("suspend",function(){watchers=scope.$$watchers,scope.$$watchers=[]}),scope.$on("resume",function(){scope.$$watchers=watchers,watchers=null});var isInitDraft=!1;scope.toggleValue=function(val,item,fromWatcher){var itemValue="true"===scope.item.value,itemChecked=scope.item.checked;if(void 0!==val){if("checked"===fromWatcher){if(itemValue===val)return;scope.item.value=val?"true":"false",api.afterMemberChanged(api.find(scope.item.fullPath).parent().element,scope.item.fullPath,"checked",val,void 0,api.find(scope.item.fullPath))}else if("value"===fromWatcher){if(itemValue===itemChecked)return;scope.item.checked=itemValue}scope.item.textValue="true"===scope.item.value?"Да":"Нет",isInitDraft?("true"===$rootScope.env.formParam.isLogElForm&&$rootScope.$emit("HEALTH_SEND",{event:"logElForm",timing:0,result:3,el:scope.item.fullPath,order_id:api.env("orderId")}),api.uploadDraft(!1,null,null,!1,scope.item)):isInitDraft=!0,scope.item.unchecked=!scope.item.checked,api.afterMemberChanged(api.find(scope.item.fullPath).parent().element,scope.item.fullPath,"unchecked",!itemChecked,void 0,api.find(scope.item.fullPath)),api.find(scope.item.fullPath).afterSetValue(val,void 0)}},scope.toggleValue(scope.item.value),scope.$emit(scope.item.fullPath+":ScopeApplied",{scope:scope,element:element}),scope.item.isScopeAppliedDone={scope:scope,element:element},scope.$watch("item.required",function(val,oldVal){void 0!==val&&val!==oldVal&&api.find(scope.item.fullPath).setRequired(val)}),scope.$watch("item.value",function(val,oldVal){void 0!==val&&val!==oldVal&&scope.toggleValue(val,null,"value")}),scope.$watch("item.checked",function(val,oldVal){void 0!==val&&val!==oldVal&&scope.toggleValue(val,null,"checked")})}}}]).factory("FieldCheckboxExt",["$rootScope","fieldAttrs",function($rootScope,fieldAttrs){return{_changedByUser:!1,attrs:angular.extend({},fieldAttrs.attrs,{checked:{type:"boolean",enum:[!0,!1],enumOptions:{true:"Да",false:"Нет"},default:!1,humanity:"чекнут","scope:ruleEditor":!0},unchecked:{type:"boolean",default:!0,humanity:"не чекнут","scope:ruleEditor":!0,"scope:editor":!1},marginTop:{type:"string",enum:["default","half","quarter","none"],enumOptions:{default:"По умолчанию",half:"Половина",quarter:"Четверть",none:"Нет"},default:"default","scope:editor":!1},textValue:{type:"string","scope:sync":!0,"scope:editor":!1,default:""},value:{"scope:editor":!1,"scope:sync":!0},iconType:{type:"string",enum:["","category_auto_A","category_auto_B","category_auto_C","category_auto_D","category_auto_EtoB","category_auto_EtoC","category_auto_EtoD"],enumOptions:{"":"без иконки",category_auto_A:"Категория прав А",category_auto_B:"Категория прав B",category_auto_C:"Категория прав C",category_auto_D:"Категория прав D",category_auto_EtoB:"Категория прав E к B",category_auto_EtoC:"Категория прав E к C",category_auto_EtoD:"Категория прав E к D"},default:"","scope:sync":!1,"scope:editor":$rootScope.isAdminUser},forceXml:{type:"boolean",enum:[!0,!1],enumOptions:{true:"Да",false:"Нет"},default:!1,"scope:editor":$rootScope.isAdminUser}})}}]),angular.module("serverFormWidgets.general").directive("epguFieldRadio",["TEMPLATES","api","apiInner","PGU","$rootScope","$timeout","suggests",function(TEMPLATES,api,apiInner,PGU,$rootScope,$timeout,suggests){return{templateUrl:TEMPLATES.FIELD_RADIO,replace:!1,scope:{item:"="},link:function(scope,element,attrs){if(scope.$root=$rootScope,$rootScope.isDesigner||(element.on("click",".PGU-FieldRadioInput",function(evt){var activeElement,itemValue=this.getAttribute("data-itemvalue");itemValue&&(activeElement=scope.item.list.find(function(elem){return elem.value==itemValue}),scope.setActiveRadio(activeElement.value,activeElement.label),api.applyScope())}),scope.setActiveRadio=function(value,textValue){var oldVal=scope.item.value;scope.item.disabled||scope.item.readonly||(scope.item._changedByUser=!0,scope.item.value=value,scope.item.textValue=textValue,void 0===value||scope.item.withoutApi||(oldVal===value||api.env("autosaveDisabled")||api.uploadDraft(!1,null,null,!1,scope.item),"true"===$rootScope.env.formParam.isLogElForm&&$rootScope.$emit("HEALTH_SEND",{event:"logElForm",timing:0,result:3,el:scope.item.fullPath,order_id:api.env("orderId")}),api.find(scope.item.fullPath).afterSetValue(value,oldVal)))},scope.setActiveRadioKeyPress=function($event,value,textValue){13!==$event.which&&32!==$event.which||(scope.setActiveRadio(value,textValue),$event.preventDefault())},suggests.controlItemWithSuggest(scope.item)),scope.item.radioGroupName){var control,parentsFullPath=apiInner.getListFullNames(scope.item.fullPath).reverse(),searchParentByFullPath=parentsFullPath.filter(function(item,ind){return control=api.find(item),"Panel"===control.attr("className")&&control.attr("radioGroupName")===scope.item.radioGroupName});scope.item.parentFullPath=searchParentByFullPath.length&&searchParentByFullPath[0]?searchParentByFullPath[0]:"",scope.$watch("item.value",function(val,oldVal){if(void 0!==val){var radioItem=scope.item.list.filter(function(item,ind){return item.value==val});scope.item.textValue=radioItem.length&&radioItem[0].label?radioItem[0].label:"",""!==val&&PGU.Events.publish(scope.item.parentFullPath+"."+scope.item.radioGroupName+":groupChangeActive",{value:val}),api.find(scope.item.fullPath).afterSetValue(val,oldVal)}})}else scope.$watch("item.value",function(val,oldVal){if(void 0!==val){var radioItem=scope.item.list.filter(function(item,ind){return item.value==val});scope.item.textValue=radioItem.length&&radioItem[0].label?radioItem[0].label:""}});var watchers;scope.$on("suspend",function(){watchers=scope.$$watchers,scope.$$watchers=[]}),scope.$on("resume",function(){scope.$$watchers=watchers,watchers=null}),scope.$emit(scope.item.fullPath+":ScopeApplied",{scope:scope,element:element}),scope.item.isScopeAppliedDone={scope:scope,element:element}}}}]).factory("FieldRadioExt",["$rootScope","fieldAttrs",function($rootScope,fieldAttrs){return{_changedByUser:!1,attrs:angular.extend({},fieldAttrs.attrs,{validators:{"scope:editor":!1,"scope:noChanges":!0},sex:{type:"boolean",enum:[!0,!1],enumOptions:{true:"Да",false:"Нет"},default:!1,"scope:editor":!0},withIcons:{type:"boolean",enum:[!0,!1],enumOptions:{true:"Да",false:"Нет"},default:!1,"scope:editor":$rootScope.isAdminUser},availableIconsType:{type:"string",enum:["","category_auto_A","category_auto_B","category_auto_C","category_auto_D","category_auto_EtoB","category_auto_EtoC","category_auto_EtoD"],enumOptions:{"":"без иконки",category_auto_A:"Категория прав А",category_auto_B:"Категория прав B",category_auto_C:"Категория прав C",category_auto_D:"Категория прав D",category_auto_EtoB:"Категория прав E к B",category_auto_EtoC:"Категория прав E к C",category_auto_EtoD:"Категория прав E к D"},default:"","scope:sync":!1,"scope:editor":!1},list:{type:"options",default:[{label:"Первый элемент",value:"1",icon:""},{label:"Второй элемент",value:"2",icon:""}]},textValue:{type:"string","scope:sync":!0,"scope:editor":!1},listMode:{type:"string",enum:["vertical","horizontal"],enumOptions:{vertical:"Вертикально",horizontal:"Горизонтально"},default:"vertical"},radioGroupName:{type:"string",default:"","scope:editor":$rootScope.isAdminUser},forceXml:{type:"boolean",enum:[!0,!1],enumOptions:{true:"Да",false:"Нет"},default:!1,"scope:editor":$rootScope.isAdminUser},strategy:{type:"string",default:"",enum:$rootScope.editor&&[""].concat($rootScope.strategyKeys),enumOptions:$rootScope.editor&&$.extend({"":""},$rootScope.strategyHash),"scope:editor":$rootScope.isAdminUser},mnemonicAutofill:{type:"string",default:"","scope:editor":$rootScope.isAdminUser}})}}]),angular.module("serverFormWidgets.general").directive("epguLabel",["TEMPLATES","$sce","$rootScope","sharedExtServices","$timeout","api","PGU",function(TEMPLATES,$sce,$rootScope,sharedExtServices,$timeout,api,PGU){return{templateUrl:TEMPLATES.LABEL,replace:!0,scope:{item:"="},link:function(scope,element,attrs){scope.$root=$rootScope,scope.$sce=$sce,scope.$emit(scope.item.fullPath+":ScopeApplied",{scope:scope,element:element}),scope.item.isScopeAppliedDone={scope:scope,element:element};var watchers;if(scope.$on("suspend",function(){watchers=scope.$$watchers,scope.$$watchers=[]}),scope.$on("resume",function(){scope.$$watchers=watchers,watchers=null}),scope.item.mnemonicHint){var code=scope.item.mnemonicHint;api.getHintInitCacheData(code).then(function(data){var itemHint=data.find(function(item){return item.code===code});itemHint&&itemHint.message?(scope.item.hintHtml=api.cleanMnemonicHintHtml(itemHint.message),scope.item.mnemonicHintShow=!0):scope.item.mnemonicHintShow=!1})}scope.item.hyphenation&&$timeout(function(){element.hyphenate()}),element.on("click",function(evt){PGU.Events.publish(scope.item.fullPath+":click")})}}}]).factory("LabelExt",["controlAttrs","$rootScope",function(controlAttrs,$rootScope){return{attrs:angular.extend({},controlAttrs.attrs,{text:{type:"string",default:"текст","scope:ruleEditor":!0},mnemonicHint:{type:"string",default:"","scope:editor":$rootScope.isAdminUser},likeListItem:{type:"boolean",default:!1,"scope:editor":$rootScope.isAdminUser},hintBackground:{type:"string",default:"#CAD8E7","scope:editor":!1},inlineCSS:{type:"string",default:"","scope:editor":!1},hyphenation:{type:"boolean",default:!1,"scope:editor":!1},showInPdf:{type:"boolean",default:!1,"scope:editor":$rootScope.isAdminUser}})}}]),angular.module("serverFormWidgets.general").directive("epguFormButton",["$compile","TEMPLATES","api","$rootScope","$timeout","$location","PGU","KEYCODES",function($compile,TEMPLATES,api,$rootScope,$timeout,$location,PGU,KEYCODES){return{templateUrl:TEMPLATES.BUTTON,replace:!0,scope:{item:"=",clickHandlerBtn:"=",clickAttr:"="},link:function(scope,element,attrs){if($rootScope.isDesigner)return void(scope.context_uri="/designer/");scope.context_uri=api.env("context_uri")||"/",scope.$root=$rootScope,$timeout(function(){scope.$emit(scope.item.fullPath+":ScopeApplied",{scope:scope,element:element}),scope.item.isScopeAppliedDone={scope:scope,element:element}},0,!1);var watchers;scope.$on("suspend",function(){watchers=scope.$$watchers,scope.$$watchers=[]}),scope.$on("resume",function(){scope.$$watchers=watchers,watchers=null}),scope.item&&"__nextStep"===scope.item.name&&(scope.item.buttonSize=""),scope.item&&(scope.item.isLoad=scope.item&&scope.item.isLoad||!1),PGU.Events.subscribe("","showSubmitButton",function(){scope.item.isLoad&&!scope.item.isNotSubmit&&(scope.item.isLoad=!1)}),scope.item&&scope.item.handleOnEnter&&element.on("keyup",".PGU-Button",function(evt){if(evt){var keyCodes=KEYCODES;switch(evt.which){case keyCodes.enter:evt.preventDefault(),element.find(".PGU-Button")[0].click()}}}),scope.handleClick=function(evt){if(!scope.item.isLoad)if(element.find(".PGU-Button").blur(),window.PGU=PGU,evt.stopPropagation(),scope.item.finalButton&&api.validate()&&(scope.item.isLoad=!0),"function"==typeof scope.clickHandlerBtn)scope.clickHandlerBtn(scope.clickAttr,evt);else{var notifySMU=api.env("notifySMU");scope.item.href?notifySMU?(evt.preventDefault(),evt.stopPropagation(),notifySMU({eventType:"click",eventParams:[{key:"href",value:scope.item.isAbsoluteUrl?scope.item.href:scope.context_uri+scope.item.href}]})):$location.path(scope.item.href):(evt.preventDefault(),evt.stopPropagation(),PGU.Events.publish(":buttonClick",evt),PGU.Events.publish(scope.item.fullPath+":click"))}};var ua=window.navigator.userAgent;scope.msieversion=ua.indexOf("MSIE ")>0||!!ua.match(/Trident.*rv\:11\./)}}}]).factory("FormButtonExt",["fieldAttrs",function(fieldAttrs){return{attrs:angular.extend({},fieldAttrs.attrs,{label:{type:"string",default:"Кнопка","scope:editor":!0,"scope:ruleEditor":!0},action:{type:"string",default:"","scope:editor":!1},balign:{type:"string",enum:["left","right"],enumOptions:{left:"Слева",right:"Справа"},default:"left","scope:editor":!0},floating:{type:"string",enum:["PGU-BtnFloat-nofloat","PGU-BtnFloat"],enumOptions:{"PGU-BtnFloat-nofloat":"В столбец","PGU-BtnFloat":"В строчку"},default:"PGU-BtnFloat-nofloat","scope:editor":!0},btnMargin:{type:"string",enum:["0","20","40","60","80"],enumOptions:{0:"0%",20:"20%",40:"40%",60:"60%",80:"80%"},default:"0","scope:editor":!0},btnColor:{type:"string",enum:["blue","white"],enumOptions:{blue:"Синий",white:"Белый"},default:"blue"},btnIcon:{type:"string",enum:["without_icon","arrow-white-east","arrow-white-west","arrow-gray-east","arrow-gray-west"],enumOptions:{without_icon:"без стрелок","arrow-white-east":"Белая, >","arrow-white-west":"Белая, <","arrow-gray-east":"Серая, >","arrow-gray-west":"Серая, <"},default:"without_icon"},withoutMarginTop:{type:"boolean",enum:[!0,!1],enumOptions:{true:"Да",false:"Нет"},default:!1},href:{type:"string",default:""},linkTarget:{type:"string",default:""},isAbsoluteUrl:{type:"boolean",default:!1},buttonSize:{type:"string",default:"small",enum:["small","medium","larger"],enumOptions:{small:"Маленькая",medium:"Средняя",larger:"Большая"}},finalButton:{type:"boolean",default:!1},handleOnEnter:{type:"boolean",default:!1,"scope:editor":!1},isNotActive:{type:"boolean",default:!1}})}}]),angular.module("serverFormWidgets.general").directive("epguNavPanel",["TEMPLATES","commonPresets","api","$rootScope","DEFAULT_NAVIGATION_HANDLERS","ENGINE_REPOSITORY",function(TEMPLATES,commonPresets,api,$rootScope){return{replace:!0,templateUrl:TEMPLATES.NAV_PANEL,scope:{item:"="},link:function(scope,element,attrs){$rootScope.isDesigner&&void 0===scope.item.visible&&(scope.item.visible=!0),scope.$root=$rootScope;var watchers;scope.$on("suspend",function(){watchers=scope.$$watchers,scope.$$watchers=[]}),scope.$on("resume",function(){scope.$$watchers=watchers,watchers=null}),scope.$emit(scope.item.fullPath+":ScopeApplied",{scope:scope,element:element}),scope.item.isScopeAppliedDone={scope:scope,element:element}}}}]).factory("NavPanelExt",["containerAttrs",function(containerAttrs){return{attrs:angular.extend({},containerAttrs.attrs,{html:{"scope:editor":!1},visible:{type:"boolean",enum:[!0,!1],enumOptions:{true:"Да",false:"Нет"},default:!1},fixName:{type:"boolean",enum:[!0,!1],enumOptions:{true:"Да",false:"Нет"},default:!1,"scope:editor":!1},label:{type:"string",default:"","scope:editor":!1},nameButton:{type:"string",default:"Подать заявление","scope:ruleEditor":!0}})}}]),angular.module("serverFormWidgets.general").directive("epguInnerStep",["$compile","api","$sce","innerStepProperties","$rootScope","TEMPLATES",function($compile,api,$sce,innerStepProperties,$rootScope,TEMPLATES){return{templateUrl:TEMPLATES.INNER_STEP,replace:!0,scope:{item:"="},link:function(scope,element,attrs){scope.item.attrs={},innerStepProperties.init(scope.item.attrs);var watchers;scope.$on("suspend",function(){watchers=scope.$$watchers,scope.$$watchers=[]}),scope.$on("resume",function(){scope.$$watchers=watchers,watchers=null}),scope.$sce=$sce,scope.$root=$rootScope,scope.$watch("item.currentItem",function(val){val&&$rootScope.showStep(scope)}),scope.$emit(scope.item.fullPath+":ScopeApplied",{scope:scope,element:element})}}}]).factory("innerStepProperties",["panelProperties",function(panelProperties){return{init:function(m){angular.extend(m,panelProperties.attrs,this.getAttrs())},getAttrs:function(){return{innerStepCode:{type:"string",enum:["plain","start","finish","logic","authority"],enumOptions:{plain:"Обычный",start:"Стартовый",finish:"Финишный",logic:"С логикой",authority:"Авторизация"},default:"plain"},innerStepNumber:{type:"string",default:""},innerStepColor:{type:"string",enum:["purple","magenta","orange","blue","cyan","green","deep_green","gray"],enumOptions:{purple:"Фиолетовый",magenta:"Пурпурный",orange:"Оранжевый",blue:"Синий",cyan:"Голубой",green:"Зеленый",deep_green:"Темно-зеленый",gray:"Серый"},default:"purple"},isCheckAssuranceLevel:{type:"boolean",default:!1}}}}}]),angular.module("serverFormWidgets.general").directive("epguStateStructure",["$compile","api","stateStructureProperties","$rootScope","$sce","TEMPLATES",function($compile,api,stateStructureProperties,$rootScope,$sce,TEMPLATES){return{templateUrl:TEMPLATES.STATE_STRUCTURE,replace:!0,scope:{item:"="},link:function(scope,element,attrs){scope.$sce=$sce,scope.$root=$rootScope;var watchers;scope.$on("suspend",function(){watchers=scope.$$watchers,scope.$$watchers=[]}),scope.$on("resume",function(){scope.$$watchers=watchers,watchers=null}),$rootScope.isDesigner&&scope.$watch("item.currentItem",function(val){val&&$rootScope.showStep(scope)}),scope.$emit(scope.item.fullPath+":ScopeApplied",{scope:scope,element:element})}}}]).factory("stateStructureProperties",["controlAttrs",function(controlAttrs){return{attrs:angular.extend({},controlAttrs.attrs,{text:{type:"string",default:"текст"},imgSrc:{type:"string",default:""},altText:{type:"string",default:""},title:{type:"string",default:"Услугу предоставляет"}})}}]),angular.module("serverFormWidgets.general").directive("epguHelperBox",["TEMPLATES","api","$rootScope","$sce","$timeout",function(TEMPLATES,api,$rootScope,$sce,$timeout){return{templateUrl:TEMPLATES.HELPER_BOX,replace:!0,scope:{item:"="},link:function(scope,element,attrs){scope.$sce=$sce,scope.$root=$rootScope;var watchers;scope.$on("suspend",function(){watchers=scope.$$watchers,scope.$$watchers=[]}),scope.$on("resume",function(){scope.$$watchers=watchers,watchers=null}),scope.$emit(scope.item.fullPath+":ScopeApplied",{scope:scope,element:element}),scope.item.isScopeAppliedDone={scope:scope,element:element}}}}]).factory("HelperBoxExt",["controlAttrs",function(controlAttrs){return{attrs:angular.extend({},controlAttrs.attrs,{type:{type:"string",default:"important",enum:["important","veryImportant","done"],enumOptions:{important:"Важно",veryImportant:"Очень важно",done:"Успешное действие"}},title:{type:"string",default:"","scope:ruleEditor":!0},html:{type:"string",default:""},height:{type:"integer",default:"","scope:editor":!1},width:{type:"integer",default:"","scope:editor":!1},mode:{type:"string",default:"","scope:editor":!1},isErrorHelperBox:{type:"boolean",enum:[!0,!1],enumOptions:{true:"Да",false:"Нет"},default:!1}})}}]),angular.module("serverFormWidgets.general").directive("epguNalogList",["TEMPLATES","api","$rootScope","$sce","LOC",function(TEMPLATES,api,$rootScope,$sce,LOC){return{templateUrl:TEMPLATES.NALOG_LIST,replace:!0,scope:{item:"="},controller:["$scope","$rootScope",function($scope,$rootScope){$scope.models={},$scope.$root=$rootScope,$scope.throbberShow=!0,$scope.$sce=$sce,$scope.betaUrl=LOC.EPGU_URI,$scope.$watch("item.value",function(val){if(val){$scope.models.total=$scope.item.value.total.total,$scope.models.fines=[];for(var fine in $scope.item.value)-1==["requestInfo","requestParams","total","personalData"].indexOf(fine)&&$scope.models.fines.push($scope.item.value[fine])}})}],link:function(scope,element,attrs){scope.$root=$rootScope;var watchers;scope.$on("suspend",function(){watchers=scope.$$watchers,scope.$$watchers=[]}),scope.$on("resume",function(){scope.$$watchers=watchers,watchers=null}),scope.$emit(scope.item.fullPath+":ScopeApplied",{scope:scope,element:element})}}}]).factory("NalogListExt",["$rootScope","basePanelAttrs",function($rootScope,basePanelAttrs){return{attrs:angular.extend({},basePanelAttrs.attrs,{throbberTitle:{type:"string",default:"Идет загрузка"},throbberText:{type:"string",default:"Это может занять некоторое время"},immutable:{type:"boolean",default:!1,humanity:"неизменяемое"},helperBox:{default:[]}})}}]),angular.module("serverFormWidgets.general").directive("epguFieldDropdown",["fieldDropdownProperties","TEMPLATES","api","$rootScope","$timeout","PGU","pguSelectService","$http","$templateCache","$compile","apiInner","pguSaveDataEsiaSrvc","pguKladrService","sharedExtServices","$q",function(fieldDropdownProperties,TEMPLATES,api,$rootScope,$timeout,PGU,pguSelectService,$http,$templateCache,$compile,apiInner,pguSaveDataEsiaSrvc,pguKladrService,sharedExtServices,$q){var getTemplate=function(){var baseUrl=$rootScope.isDesigner?"js/designer/overrideTmpl/FieldDropdown/FieldDropdown.html":TEMPLATES.FIELD_DROPDOWN;return $http.get(baseUrl,{cache:$templateCache})};return{replace:!1,scope:{item:"="},link:function(scope,element,attrs){function modelChange(val,oldVal){if(val&&val!==oldVal&&api.find(scope.item.fullPath).validate(!0),scope.item.isOkato&&(scope.item.codeRegion=scope.item.value,scope.item.fullPathStr=scope.item.text_value),(scope.item.isMonth&&"CELL_START_MONTH"==scope.item.parent.name||scope.item.isYear&&"CELL_START_YEAR"==scope.item.parent.name)&&(scope.item.required=!0),scope.item.isHierarchic){var itemCI=scope.item.cloneIndex?+scope.item.cloneIndex:0,itemVL=scope.item.validLevel?+scope.item.validLevel:0;if(0===itemVL&&scope.item.required?scope.item.required=!0:itemCI?scope.item.required=itemCI<=itemVL:scope.item.value&&itemVL&&(scope.item.required=!0),scope.item.longLabel&&scope.item.clones&&scope.item.clones.forEach(function(clone){clone.longLabel=scope.item.longLabel}),val!==oldVal&&(scope.item.visibleLevel=!0,!scope.item.cancelEdit)){fieldDropdownProperties.updateHierarchicClones(scope.item);var rootDropDown=api.find(scope.item.originalFullPath);rootDropDown.validLevel()&&(rootDropDown.value()?(rootDropDown.required(!0),rootDropDown.element.notRequiredTextHide=!0):(rootDropDown.element.notRequiredTextHide=!1,rootDropDown.required(rootDropDown.element.initRequired)))}if(scope.item.lastLevelValue!==val)if(scope.item.parentDropdown){for(var lastLevelValue="",parent=api.find(scope.item.parentDropdown).element,i=parent.clones.length;i--&&!lastLevelValue;)lastLevelValue=parent.clones[i].value;parent.lastLevelValue=lastLevelValue||parent.value}else scope.item.lastLevelValue=val;if(!1===scope.item.visibleLevel){var item,valForRequest="",clones=scope.item.clones;clones&&clones.length?(valForRequest=clones[clones.length-1].value,item=clones[clones.length-1]):(valForRequest=scope.item.value,item=scope.item);var options={refName:scope.item.dictionary.code,pageSize:scope.models.pageSize,pageNum:scope.models.pageNum,item:scope.item,parentRefItemValue:valForRequest};pguSelectService.loadDataFromServer(options,function(data){data&&data.items&&data.items.length&&scope.item.addClone(item,void 0,api)}),scope.item.visibleLevel=!0}}if(scope.item.isMultiple&&(scope.item.isChangeByUser?scope.item.isChangeByUser=!1:fieldDropdownProperties.addMultipleClone(scope.item,val)),scope.item.dictionary&&scope.item.dictionary.responseBindings){var responseBindings=(scope.item.dictionary||{}).responseBindings||[];if(!(responseBindings&&responseBindings.length&&scope.item.list&&scope.item.list.length))return;pguSelectService.makeBinding(responseBindings,scope.item.listOriginal,val)}scope.item.isFias||scope.item.isFiasDaData||(scope.item.filter=void 0),scope.item.isFiasDaData||api.find(scope.item.fullPath).afterSetValue(val,oldVal),scope.item.isKladr&&PGU.Kladr&&PGU.Kladr[scope.item.fullPath]&&(api.find(scope.item.kladrPath).validate(!0),scope.$emit(scope.item.kladrPath+":kladrSelectChange",{name:scope.item.name,value:scope.item.value,kladrId:apiInner.getListElemFromValue(PGU.Kladr[scope.item.fullPath].originList,scope.item.value)?apiInner.getListElemFromValue(PGU.Kladr[scope.item.fullPath].originList,scope.item.value).kladrId:void 0}))}function loadMore(callback){var selectedItemsCount=0;scope.item.isMultiple&&scope.item.value&&(selectedItemsCount=scope.item.value.split(",").length),scope.models.total>scope.models.sizeNow&&scope.models.sizeNow<=scope.item.list.length+selectedItemsCount&&(scope.models.pageNum++,scope.models.sizeNow=1*scope.models.sizeNow+1*scope.models.pageSize,scope.models.isLoad=!0,loadData(scope.item.filter?callback:void 0,!0))}function cacheDataLoad(){var curListLength=scope.item.isMultiple?scope.item.list.length+scope.item.value.split(",").length:scope.item.list.length;if(scope.item.isKladr){var load=PGU.Kladr&&PGU.Kladr[scope.item.fullPath];load&&load.list&&load.list.length&&load.list.length>curListLength&&(scope.item.list=scope.item.list.concat(load.list.slice(curListLength,curListLength+20)))}else("FieldDropdown"===scope.item.className||"FieldDropdownHierarchic"===scope.item.className||scope.item.isMultiple)&&scope.item.listOriginal&&(scope.item.listOriginal.length>scope.item.list.length&&!scope.item.filterString||scope.item.filterString&&scope.item.listOriginal.length>scope.item.filteredList.length)&&(scope.item.filterString?scope.item.fullFilteredList&&scope.item.fullFilteredList.length>scope.item.filteredList.length?scope.item.list=scope.item.filteredList=scope.item.list.concat(scope.item.fullFilteredList.slice(curListLength,curListLength+20)):scope.item.list=scope.item.filteredList:scope.item.list=scope.item.list.concat(scope.item.listOriginal.slice(curListLength,curListLength+20)))}function loadDataKladr(callback){
scope.item.originalFullPath=scope.item.originalFullPath||scope.item.fullPath,scope.item.originalName=scope.item.originalName||scope.item.name,scope.item.filter=void 0;var cacheKey,kladrParams=pguKladrService.getKladrRequestParams(scope.item.name,scope.item.depends,scope.item.fullPath,scope.item.requestParams),cache=scope.$root.kladrCache,isRusStat=!!scope.item.requestParams,parentCode="";if(!kladrParams)return scope.item.value="",scope.item.text_value="",void(callback&&callback({list:{entries:[]},error:"",searchIsEmpty:!0}));var needDeferWrap,requestParams=angular.toJson(kladrParams);if(isRusStat)if(scope.item.parentId=parentCode,kladrParams.type)parentCode=scope.item.parentId=kladrParams.parentId;else for(var k in kladrParams)kladrParams.hasOwnProperty(k)&&(parentCode=scope.item.parentId=kladrParams[k]||"");else parentCode=scope.item.parentId=kladrParams.parentCode;cacheKey=scope.item.remoteMethod+requestParams,PGU.PromiseStack=PGU.PromiseStack||{},PGU.PromiseStack[scope.item.fullPath]||(PGU.PromiseStack[scope.item.fullPath]=$q.defer(),needDeferWrap=function(){var df=$q.defer();return df.resolve(),df.promise}()),cache[cacheKey]?"loading..."!==cache[cacheKey]&&(pguKladrService.kladrReceiver(scope.item,cache[cacheKey],parentCode,callback,isRusStat),needDeferWrap?needDeferWrap.then(function(){PGU.PromiseStack[scope.item.fullPath]&&PGU.PromiseStack[scope.item.fullPath].resolve()}):PGU.PromiseStack[scope.item.fullPath]&&PGU.PromiseStack[scope.item.fullPath].resolve()):(cache[cacheKey]="loading...",isRusStat?sharedExtServices.rusStatSrv(scope.item.remoteMethod,kladrParams,function(data){cache[cacheKey]=data,pguKladrService.kladrReceiver(scope.item,data,parentCode,callback,isRusStat),PGU.PromiseStack[scope.item.fullPath]&&PGU.PromiseStack[scope.item.fullPath].resolve()},function(error){if("loading..."===cache[cacheKey])return delete cache[cacheKey],!1}):sharedExtServices.kladrService(scope.item.remoteMethod+(kladrParams.parentCode?"/"+kladrParams.parentCode:""),kladrParams.parentCode?kladrParams.params:null,function(data){cache[cacheKey]=data,pguKladrService.kladrReceiver(scope.item,data,kladrParams.parentCode,callback),PGU.PromiseStack[scope.item.fullPath]&&PGU.PromiseStack[scope.item.fullPath].resolve()},function(error){if("loading..."===cache[cacheKey])return delete cache[cacheKey],!1}))}function loadData(callback,isMore,isInitRequest){if(!$rootScope.isDesigner)if(scope.item.isKladr)loadDataKladr(callback);else{isMore=void 0!==isMore?isMore:scope.models.pageNum>1,scope.item.originalFullPath=(scope.item.originalFullPath||scope.item.fullPath).replace(/\[\d+\]$/gi,""),scope.item.originalName=scope.item.originalName||scope.item.name;var resolveItemLoad=function(){scope.item.promiseLoadDate=scope.item.promiseLoadDate||$q.defer(),scope.item.promiseLoadDate.resolve()},options=pguSelectService.buildRequestOpts(scope.item,scope.models);if(scope.item.dictionary&&("true"===scope.item.dictionary.initRequest||!0===scope.item.dictionary.initRequest)&&!1===typeof scope.item.responseError)return;scope.item.responseError=!1;var rootPath=scope.item.parentDropdown?scope.item.parentDropdown:scope.item.fullPath;api.find(rootPath).isLoadingData&&api.find(rootPath).isLoadingData(!0),scope.searchFromServerTimeout&&$timeout.cancel(scope.searchFromServerTimeout),scope.currentTimeoutQueue=scope.currentTimeoutQueue||[],scope.searchFromServerTimeout=$timeout(function(queueLength){pguSelectService.loadDataFromServer(options,function(data,withoutCache){if(queueLength===scope.currentTimeoutQueue.length&&!PGU.checkElementOnRemovedClone(rootPath)){scope.item.haveData=data.items&&data.items.length&&scope.item.cached,scope.models.pageNum>1&&(data.error&&"searchIsEmpty"===data.error.code||data.items&&0===data.items.length)&&(scope.models.pageNum-=1,scope.models.sizeNow-=scope.models.pageSize);var checkErrorData=fieldDropdownProperties.checkResponseData(data);if(checkErrorData)checkErrorData.error&&(isInitRequest?scope.models.options.openCallback=loadData:(scope.item.error="",scope.item.responseError=!0)),"FieldDropdownHierarchic"===scope.item.className&&checkErrorData.searchIsEmpty&&(scope.item.fullFilled=!0),"GibddDropdown"===scope.item.name&&"function"==typeof callback?callback(data.original||data,withoutCache):callback&&callback(checkErrorData,withoutCache),resolveItemLoad();else{if(scope.item.parentRefItemValue)var items=fieldDropdownProperties.getChildrenItems_v2(PGU.copy(data.items),scope.item.parentRefItemValue);var listItems=scope.item.isHierarchic&&items&&items.haveChildren?items.children:data.items&&PGU.copy(data.items);isMore?(scope.item.list=scope.item.list.concat(pguSelectService.removeOpts(listItems,scope.item.removeOpts)),scope.item.isMultiple?scope.item.listOriginal=scope.item.listOriginal.concat(PGU.copy(data.items)):scope.item.listOriginal=scope.item.list):(listItems.length>100?(scope.item.listOriginal=pguSelectService.removeOpts(listItems,scope.item.removeOpts),scope.item.list=scope.item.listOriginal.slice(0,100)):scope.item.list=scope.item.listOriginal=pguSelectService.removeOpts(listItems,scope.item.removeOpts),scope.item.isMultiple&&(scope.item.listOriginal=JSON.parse(JSON.stringify(scope.item.listOriginal))),resolveItemLoad()),scope.item.isMultiple&&(scope.item.list=apiInner.removeFromArray(scope.item.list,scope.item.selectedMultiple),scope.item.fullFilteredList=scope.item.fullFilteredList||scope.item.list,scope.firtsLoadListLength=scope.firtsLoadListLength||data.items.length,data.searchIsEmpty=!(scope.item.list&&scope.item.list.length),data.allItemsSelected=scope.item.selectedMultiple&&scope.item.selectedMultiple.length==scope.firtsLoadListLength&&!(scope.item.filter&&scope.item.filter.length)),scope.models.total&&scope.models.total==data.total||(scope.models.total=data.total),scope.models.sizeNow&&scope.models.sizeNow==data.items.length||(scope.models.sizeNow=data.items.length),scope.models.pageNum||(scope.models.pageNum=1),scope.item.filterString&&(scope.item.list=scope.item.filteredList),callback&&callback(data,withoutCache)}scope.item.defer.resolve(),api.find(rootPath).isLoadingData&&api.find(rootPath).isLoadingData(!1)}},scope.item.withoutCache,scope.item.isFilterPrepared)},500,!1,scope.currentTimeoutQueue.push(scope.searchFromServerTimeout))}}function searchFromServer(queryString,callback){if(scope.item.filter&&scope.item.filter.length>=3){scope.item.responseError=!1,scope.models.pageNum=1;var opts=pguSelectService.buildRequestOpts(scope.item,scope.models,!0);pguSelectService.loadDataFromServer(opts,function(data){var checkErrorData=fieldDropdownProperties.checkResponseData(data);if(checkErrorData)checkErrorData.error&&(scope.item.responseError=!0),callback&&callback(checkErrorData);else if(scope.item.listOriginal=scope.item.list=pguSelectService.removeOpts(data.items,scope.item.removeOpts),scope.item.isMultiple&&(scope.item.fullFilteredList=apiInner.removeFromArray(scope.item.list,scope.item.selectedMultiple)),scope.models.total=data.total,scope.models.sizeNow=data.items.length,PGU.Events.publish(scope.item.fullPath+":selected"),callback){if(!data.items.length&&!searchIsEmpty)var searchIsEmpty=!0;callback({searchIsEmpty:searchIsEmpty})}},scope.item.withoutCache)}else""==scope.item.filter?(scope.item.filterString="",delete scope.item.filter,loadData(callback)):callback&&callback({searchIsEmpty:!0})}function searchOkatoFromServer(queryString,callback){scope.searchOkatoTimeout&&$timeout.cancel(scope.searchOkatoTimeout),scope.currentTimeoutQueue=scope.currentTimeoutQueue||[],scope.searchOkatoTimeout=$timeout(function(queueLength){scope.item.error="",pguSelectService.loadOkatoFromServer({refName:scope.item.dictionary.code,searchString:scope.item.filter||""},function(data){queueLength===scope.currentTimeoutQueue.length&&(data&&data.error&&0===data.error.code?queryString===scope.item.filter&&(scope.item.listOriginal=scope.item.list=pguSelectService.mappingHierarchy(data.tree),PGU.Events.publish(scope.item.fullPath+":selected")):scope.item.list=[],callback&&callback({searchIsEmpty:data.tree&&!data.tree.length}))},function(error){scope.item.error="Что-то пошло не так. Попробуйте повторить запрос позднее",scope.item.list=[],callback&&callback({searchIsEmpty:!1})})},500,!1,scope.currentTimeoutQueue.push(scope.searchOkatoTimeout))}function searchFiasFromServer(queryString,callback,normalized){!scope.item.selectType||"DropdownForFias"!==scope.item.selectType&&"DropdownForFiasDaData"!==scope.item.selectType||scope.item.filter&&0!=scope.item.filter.length||(scope.item.value="",scope.item.htmlTitle="",scope.item.text_value=""),scope.$emit(scope.item.fullPath+":fiasDropdownSearch",{queryString:queryString,filter:scope.item.filter,keyCode:scope.item.lastKeyCode,callback:callback,normalized:normalized})}function geoSearchFromServer(queryString,callback){ymaps&&scope.item.filter&&scope.item.filter.length>=3&&ymaps.geocode(queryString,{results:5}).then(function(response){var result,geoObject,geoObjects=response.geoObjects,geoObjectsLength=geoObjects.getLength();if(geoObjectsLength){result=[];for(var i=0,il=geoObjectsLength;i<il;i++)geoObject=response.geoObjects.get(i),result.push({title:geoObject.properties.get("text"),value:geoObject.properties.get("boundedBy"),point:geoObject.geometry.getCoordinates()});scope.item.list=result}else result={searchIsEmpty:!0};"function"==typeof callback&&callback(result)},function(error){})}function toggleFiasFields(show,newEvent){var result={};arguments.length?(result.fiasFieldsShow=show,result.newEvent=newEvent,scope.item.fiasFieldsShow=show):(scope.item.fiasFieldsShow=!scope.item.fiasFieldsShow,scope.item.isOpenFromList=!0),scope.item.toggleLabel=scope.item.fiasFieldsShow?"Скрыть поля адреса":"Уточнить адрес",scope.$emit(scope.item.fullPath+":toggleFiasFields",result)}var watchers;getTemplate().success(function(html){element.html(html)}).then(function(response){element.replaceWith($compile(element.html())(scope))});scope.$on("suspend",function(){watchers=scope.$$watchers,scope.$$watchers=[]}),scope.item.initRequired=scope.item.required,"evOptDict"===$rootScope.env.engineVersion&&($rootScope.settings.isFirstDictionaryInit?scope.item.dictionary.initRequest=!1:$rootScope.settings.isFirstDictionaryInit=!0),scope.$on("resume",function(){scope.$$watchers=watchers,watchers=null}),scope.item.defer=$q.defer(),scope.models={},scope.models.options={modelChange:modelChange},scope.$root=$rootScope,function(){if(scope.item.value=scope.item.value||"",scope.item.responseErrorText="Не удалось получить данные. Попробуйте позже или обратитесь в службу поддержки",scope.models.pageSize=scope.item.pageSize&&"0"!==scope.item.pageSize?scope.item.pageSize:"258",scope.models.pageNum=scope.models.pageNum||1,scope.item.required&&api.find(scope.item.fullPath).setRequired(!0),"FieldDropdownHierarchic"===scope.item.className&&scope.item.clones&&scope.item.clones.length){var lastClone=scope.item.clones[scope.item.clones.length-1];lastClone.value&&(lastClone.fullFilled=!0)}if(scope.$watch("item.required",function(val,oldVal){void 0!==val&&val!==oldVal&&api.find(scope.item.fullPath).setRequired(val)}),scope.$watch("item.disabled",function(val,oldVal){val&&(scope.item.responseError=!1),"FieldDropdownHierarchic"===scope.item.className&&scope.item.clones&&scope.item.clones.length&&scope.item.clones.forEach(function(item){item.disabled=val})}),scope.item.isKladr&&(scope.$root.kladrCache||(scope.$root.kladrCache={}),scope.item.loadData=loadDataKladr,scope.item.withCheckbox&&(scope.item.cbInField={syncRender:!0,isCheckedFromField:!1},scope.item.cbInField.label=scope.item.checkboxLabel,scope.toggleValue=function(val){var value="true"===val;scope.item._changedByUser=!value,scope.item.statusCheckbox=value||!1,scope.item._changedByUser=!1,scope.item.cbInField.isCheckedFromField=value||!1,api.updateDependentFields(value,scope.item.dependentFields,scope.item.fullPath,scope.item.bindAttrsOnValue)})),"DropdownSearchForChild"===scope.item.className&&(scope.models.options.isOnlySearch=!0,scope.models.options.isOkato=!0,scope.models.options.filterServerMinLength=3,scope.item.list=[]),"DropdownForFiasDaData"===scope.item.selectType&&(scope.item.searchBar=!0,scope.item.isFiasDaData=!0,scope.item.toggleLabel="Уточнить адрес",scope.item.fiasFieldsShow=!1,scope.item.isOnlySearch=!0,scope.item.isOpen=!1,scope.models.options.search=!0,scope.models.options.isOnlySearch=!0,scope.models.options.filterServerMinLength=0,scope.models.options.globalSFDadataDebounce=void 0!==$rootScope.settings.globalSFDadataDebounce?$rootScope.settings.globalSFDadataDebounce:500,scope.models.options.toggleFiasFields=toggleFiasFields,scope.item.toggleFiasFields=function(val,newEvent){void 0!==val?toggleFiasFields(val,newEvent):toggleFiasFields()},scope.models.options.blurCallback=function(){scope.$emit(scope.item.fullPath+":blur")}),"DropdownForFias"===scope.item.selectType&&(scope.item.searchBar=!0,scope.item.isFias=!0,scope.item.isOnlySearch=!0,scope.models.options.isOnlySearch=!0,scope.models.options.blurCallback=function(){scope.$emit(scope.item.fullPath+":blur")},scope.models.options.filterServerMinLength=0),scope.item.geoSearchDropdown&&(scope.item.isOnlySearch=!0,scope.item.searchBar=!0,scope.models.options.isOnlySearch=!0),scope.item.medResourceDropdown&&(scope.models.options.selectElementCallback=scope.item.medResourceCallback),"FieldBirthCountry"===scope.item.className){var esiaValue=!1;$rootScope.settings.user?scope.item.value=$rootScope.settings.user.person.birthCountryCode:PGU.Events.subscribe("",":userReady",function(){scope.item.value=$rootScope.settings.user.person.birthCountryCode}),esiaValue=!!scope.item.value,PGU.Events.subscribe("","submitForm",function(){scope.item.value&&pguSaveDataEsiaSrvc.save("country",{birthCountryCode:scope.item.value},scope.item.fullPath,scope.item.validators||[],esiaValue)})}if("FieldDropdownMultiple"==scope.item.className||"FieldDropdownMultipleExt2v"===scope.item.className){if(scope.models.options.noEmptyField=!0,!1===$rootScope.setDraft)fieldDropdownProperties.initMultiClone(scope.item);else var isDraft=$rootScope.$watch("setDraft",function(newVal,oldVal){!1===newVal&&(fieldDropdownProperties.initMultiClone(scope.item),isDraft())});scope.deleteMultiClone=function(index){scope.item.disabled||fieldDropdownProperties.deleteMultiClone(index,scope.item)},$rootScope.$on("setDraftAfterStepEdit",function(){scope.item.value&&(fieldDropdownProperties.addMultipleClone(scope.item,scope.item.value),scope.item.selectedMultiple.reverse())})}if($rootScope.settings.initStrategy&&$rootScope.settings.initStrategy[scope.item.fullPath]&&$rootScope.settings.initStrategy[scope.item.fullPath].title&&(scope.item.filter=$rootScope.settings.initStrategy[scope.item.fullPath].title,scope.item.text_value=$rootScope.settings.initStrategy[scope.item.fullPath].title),scope.item.searchBar&&(scope.item.isOkato?scope.models.options.changeCallback=searchOkatoFromServer:scope.item.isFias||scope.item.isFiasDaData?scope.models.options.changeCallback=searchFiasFromServer:scope.item.geoSearchDropdown?scope.models.options.changeCallback=geoSearchFromServer:scope.models.options.changeCallback=searchFromServer,scope.models.options.searchFromServer=!0),scope.item.hasContextSearch&&(scope.models.options.search=!0),"FieldMonthExt"==scope.item.className){var list=scope.item.attrs.options.value.map(function(item){return{title:item.text,value:item.value}});scope.item.list=list.slice()}if("FieldYear"==scope.item.className&&(scope.models.options.search=!0,scope.models.options.isOnlyNumbers=!0,scope.models.options.maxlength=4,scope.item.list=fieldDropdownProperties.getYearsList(scope.item.limits,scope.item),scope.models.options.changeCallback=function(queryNum,callback){/[\d]{4}/g.test(queryNum.toString())&&scope.item.list&&scope.item.list.some(function(item){return item.value==queryNum})&&(scope.item.filter="",callback({value:queryNum}))}),!scope.item.isMonth&&!scope.item.isYear&&!scope.item.isMedResource){var dictionary=scope.item.dictionary,initRequest=dictionary&&("true"===dictionary.initRequest||!0===dictionary.initRequest),hasValue="FieldDropdownHierarchic"===scope.item.className&&scope.item.parentDropdown||scope.item.value;dictionary&&(dictionary.code||dictionary.isSop)&&(initRequest||hasValue)&&(scope.item.isOkato?searchOkatoFromServer():loadData(null,!1,!0)),scope.item.isOnlySearch||(scope.models.options.openCallback=loadData)}scope.models.options.loadMore=loadMore,scope.models.options.cacheDataLoad=cacheDataLoad,scope.$watch("item.parentRefItemValue",function(val,oldVal){val&&oldVal!=val&&loadData()}),["FieldDropdown","FieldDropdownMultiple"].includes(scope.item.className)&&(scope.item.setCustomList=function(list,setImmediately){setImmediately&&(scope.item.list=scope.item.listOriginal=scope.models.list=scope.models.listOriginal=list),scope.models.options.openCallback=function(callback){scope.item.list=scope.item.listOriginal=scope.models.list=scope.models.listOriginal=list,callback({})}}),scope.$emit(scope.item.fullPath+":ScopeApplied",{scope:scope,element:element}),scope.item.isScopeAppliedDone={scope:scope,element:element}}(),scope.item.isMultiple&&scope.$watch("item.removeOpts",function(val,oldVal){if(void 0!==val&&val!==oldVal){var values=scope.item.selectedMultiple||[],removeOpts=val&&val.split&&val.split(",")||[],result=[];values.forEach(function(item){-1===removeOpts.indexOf(item.value)&&result.push(item)}),scope.item.selectedMultiple=result,scope.item.value=result.map(function(item){return item.value}).join(",")}}),scope.item.filterCache=function(filter){var kladrParams=pguKladrService.getKladrRequestParams(scope.item.name,scope.item.depends,scope.item.fullPath,scope.item.requestParams);if(void 0!==filter&&PGU.Kladr&&PGU.Kladr[scope.item.fullPath]&&kladrParams){var regexp,list=[];return filter&&filter.length?(regexp=new RegExp("("+filter.replace(/([\/|()*+?$^{}\[\].])/g,"\\$1")+")","i"),PGU.Kladr[scope.item.fullPath].originList.forEach(function(item){item.title.search(regexp)+1&&list.push(item)}),scope.item.list=list.slice(0,20),PGU.Kladr[scope.item.fullPath].list=list):(scope.item.list=PGU.Kladr[scope.item.fullPath].originList.slice(0,20),PGU.Kladr[scope.item.fullPath].list=PGU.Kladr[scope.item.fullPath].originList),scope.item.list}},"DropdownHall"==scope.item.name||"GibddDropdown"==scope.item.name?scope.item.getList=function(callback){return loadData(function(data){!data||data.error&&0!==data.error.code||!data.items&&0!==data.code?callback&&callback.error&&callback.error(data):callback&&callback.done&&callback.done(data.items||[]),callback&&callback.always&&callback.always()})}:scope.item.getList=function(callback){return loadData(function(data){!data||data.error&&0!==data.error.code?callback&&callback.error&&callback.error(data):callback&&callback.done&&callback.done(data.items||[]),callback&&callback.always&&callback.always()})}}}}]).factory("FieldDropdownExt",["$rootScope","fieldAttrs","PGU",function($rootScope,fieldAttrs,PGU){return{attrs:angular.extend({},fieldAttrs.attrs,{validators:{default:[],"scope:editor":!1},label:{default:"Подпись",type:"string"},longLabel:{type:"string",default:""},value:{enumerable:!0,"scope:rule:all":!0,"scope:sync":!0,"scope:ruleEditor":!0},text_value:{type:"string","scope:sync":!0,"scope:editor":!1,"scope:rule:all":!0,"scope:noChanges":!0},forceXml:{type:"boolean",enum:[!0,!1],enumOptions:{true:"Да",false:"Нет"},default:!1,"scope:editor":$rootScope.isAdminUser},pageNum:{type:"string",value:"1",default:"1","scope:sync":!0,"scope:editor":!1,"scope:noChanges":!0},dictionary:{default:{},"scope:noChanges":!0,"scope:editor":!0},total:{type:"integer","scope:editor":!1,"scope:noChanges":!0},searchBar:{type:"boolean",default:!1,"scope:noChanges":!0},parentItem:{default:"",enumerable:!0,enum:"","scope:ruleEditor":!0,"scope:editor":$rootScope.isAdminUser,"scope:noChanges":!0},"dictionary.code":{enumerable:!0,enum:"","scope:model":!1,"scope:editor":!1,"scope:noChanges":!0},options:{default:[],"scope:model":!1,"scope:editor":!1,"scope:noChanges":!0},disclosed:{default:!1,"scope:model":!1,"scope:editor":!1,"scope:noChanges":!0},fieldWidth:{type:"string",enum:["20","40","60","80","100"],enumOptions:{20:"20%",40:"40%",60:"60%",80:"80%",100:"100%"},default:"80","scope:editor":!1,"scope:noChanges":!0},removeOpts:{type:"string",default:"","scope:editor":$rootScope.isAdminUser,"scope:ruleEditor":!0},emptyField:{type:"string",default:"[Не выбрано]","scope:editor":$rootScope.isAdminUser,"scope:noChanges":!0},strategy:{type:"string",default:"",enum:window.Editor&&[""].concat(Editor.strategyKeys),enumOptions:window.Editor&&$.extend({"":""},Editor.strategyHash),"scope:editor":$rootScope.isAdminUser,"scope:noChanges":!0},cached:{type:"boolean",default:!1,"scope:editor":!0,"scope:sync":!1,"scope:noChanges":!0},error:{value:"","scope:model":!1,"scope:editor":!1},getFullResult:{type:"boolean",default:!1,"scope:noChanges":!0},hasContextSearch:{type:"boolean",default:!1,"scope:noChanges":!0},pageSize:{type:"string",default:"0","scope:noChanges":!0},orderBy:{type:"string",default:"","scope:noChanges":!0,"scope:editor":$rootScope.isAdminUser},sortDirection:{type:"string",enum:["ASC","DESC"],enumOptions:{ASC:"ASC",DESC:"DESC"},default:"ASC","scope:editor":$rootScope.isAdminUser,"scope:noChanges":!0},withoutCache:{type:"boolean","scope:editor":!1,default:!1,"scope:noChanges":!0},geoSearchDropdown:{type:"boolean",default:!1,"scope:editor":!1,"scope:noChanges":!0},geoSearchCallback:{type:"function",default:"","scope:editor":!1,"scope:noChanges":!0},withFilterCodes:{type:"boolean",default:!1,"scope:editor":!1},checkboxLabel:{type:"string",default:"","scope:editor":!1},statusCheckbox:{type:"boolean",default:!1,"scope:editor":!1,"scope:noChanges":!0}}),addClone:function(item,index,api){if(item){var original=api.find(item.originalFullPath).getElement(),clone=function(elem){var obj={};for(var item in elem)"attrs"!=item&&elem.hasOwnProperty(item)&&elem.attrs.hasOwnProperty(item)&&(obj[item]=PGU.copy(elem[item]));return obj.className=elem.className,obj.originalName=elem.originalName,obj.originalFullPath=elem.originalFullPath,obj}(original);clone.clones=void 0,clone.list=void 0,clone.cloneIndex=void 0===index?void 0!==item.cloneIndex?1*item.cloneIndex+1:1:index,clone.parentRefItemValue=item.value,clone.parentItem=item.value,clone.fullPath=clone.originalFullPath.replace(/\[\d+\]$/gi,"")+"["+clone.cloneIndex+"]",clone.name=clone.originalName+"["+clone.cloneIndex+"]",clone.value=void 0,clone.text_value=void 0,item.isHierarchic&&(clone.availableForHide=!0,clone.visibleLevel=!0,clone.lastLevelValue="0",clone.value=clone.value||"",clone.required=!!(original.validLevel&&index+1<=original.validLevel),clone.parentDropdown=original.originalFullPath,original.required&&(original.notRequiredTextHide?+clone.cloneIndex>+original.validLevel&&(clone.required=!1):clone.required=!0)),original.clones=original.clones||[];for(var isFind=!1,originalClonesCopy=original.clones.concat(),i=0;i<originalClonesCopy.length;i++)originalClonesCopy[i].cloneIndex==clone.cloneIndex&&(isFind=i);return!1===isFind&&(originalClonesCopy.push(clone),original.clones=_.sortBy(originalClonesCopy,function(elem){return parseInt(elem.cloneIndex,10)})),api.initAttrs(original.clones),api.__addToMarkDeletedRuntime(clone.fullPathForXml||clone.fullPath),clone}},clearModel:function(){this.clones=void 0,this.list=[],this.selectedMultiple=void 0,this.cloneIndex=0,this.parentRefItemValue="",this.value="",this.text_value="",this.codeRegion=void 0,this.fullPathStr=void 0,this.disabled=!1,this.required=!1},setCustomList:function(list,sortType){if(list&&list.length){var listWithStructure=[];list.forEach(function(item,i){listWithStructure.push({value:item.value||i.toString(),parentValue:null,title:item.title||item,isLeaf:!0,children:[],attributes:[],attributeValues:{}})}),sortType&&["ASC","DESC"].indexOf(sortType)>-1&&listWithStructure.sort(function(a,b){var nameA=a.title.toLowerCase(),nameB=b.title.toLowerCase(),firstCompare="ASC"===sortType?nameA<nameB:nameA>nameB,secondCompare="ASC"===sortType?nameA>nameB:nameA<nameB;return firstCompare?-1:secondCompare?1:0}),this.element.setCustomList&&this.element.setCustomList(listWithStructure)}}}}]).factory("FieldDropdownMultipleExt",["$rootScope","FieldDropdownExt",function($rootScope,FieldDropdownExt){return{attrs:angular.extend({},FieldDropdownExt.attrs,{forceXml:{type:"boolean",enum:[!0,!1],enumOptions:{true:"Да",false:"Нет"},default:!1,"scope:editor":!1},cloneIndex:{type:"string","scope:editor":!1,"scope:sync":!0,default:"0"},isCloneRemove:{type:"boolean","scope:editor":!1,"scope:sync":!0,default:!1},isChangeByUser:{type:"boolean","scope:editor":!1,default:!1},withoutCache:{type:"boolean","scope:editor":!1,default:!1},isMultiple:{type:"boolean","scope:editor":!1,default:!0}}),validate:FieldDropdownExt.validate,addClone:FieldDropdownExt.addClone,_stringToDictionary:function(value,separator){var dict={};return value&&angular.forEach(value.split(separator||","),function(code,i){dict[code]=!0}),dict},clearModel:FieldDropdownExt.clearModel,setCustomList:FieldDropdownExt.setCustomList}}]).factory("FieldDropdownHierarchicExt",["$rootScope","FieldDropdownExt",function($rootScope,FieldDropdownExt){return{isHierarchic:!0,attrs:angular.extend({},FieldDropdownExt.attrs,{forceXml:{type:"boolean",enum:[!0,!1],enumOptions:{true:"Да",false:"Нет"},default:!1,"scope:editor":!1},cloneIndex:{type:"string","scope:editor":!1,"scope:sync":!0,default:"0"},deepLevel:{type:"number","scope:editor":!0,default:0},validLevel:{type:"number","scope:editor":!0,default:0},lastLevelValue:{type:"string","scope:editor":!1,"scope:sync":!0,default:"0"},hierarchicCache:{"scope:editor":!1,"scope:sync":!1,default:{}},isLoadingData:{"scope:editor":!1,"scope:sync":!1,default:!1},visibleLevel:{"scope:editor":!1,"scope:sync":!0,default:!1},withoutCache:{type:"boolean","scope:editor":!1,default:!1}}),validate:FieldDropdownExt.validate,clearModel:FieldDropdownExt.clearModel,addClone:FieldDropdownExt.addClone}}]).factory("FieldYearExt",["$rootScope","FieldTextDateExt","FieldDropdownExt",function($rootScope,FieldTextDateExt,FieldDropdownExt){return{isYear:!0,attrs:angular.extend({},FieldDropdownExt.attrs,FieldTextDateExt.attrs,{forceXml:{type:"boolean",enum:[!0,!1],enumOptions:{true:"Да",false:"Нет"},default:!1,"scope:editor":!1},searchBar:{type:"boolean",default:!1,"scope:editor":$rootScope.isAdminUser},disclosed:{default:!1,"scope:model":!1,"scope:editor":!1},format:{type:"string",default:"yyyy","scope:sync":!1,"scope:editor":!1},pageNum:{type:"string",value:"1",default:"1","scope:sync":!1,"scope:editor":!1},validators:{default:[],"scope:editor":!1},strategy:{type:"string",default:"","scope:editor":!1},cached:{type:"boolean",default:!1,"scope:editor":!1,"scope:sync":!1},limits:{type:"string",default:"||||","scope:editor":!1},mnemonicAutofill:{type:"string",default:"","scope:editor":!1},maxlength:{type:"integer",default:"","scope:editor":!1},year:{type:"string",default:"1970","scope:sync":!1,"scope:editor":!1},month:{type:"string",default:"01","scope:sync":!1,"scope:editor":!1},date:{type:"string",default:"01","scope:sync":!1,"scope:editor":!1},hours:{type:"string",default:"0","scope:sync":!1,"scope:editor":!1},minutes:{type:"string",default:"0","scope:sync":!1,"scope:editor":!1},second:{type:"string",default:"0","scope:sync":!1,"scope:editor":!1},timezone:{type:"string",default:"+0400","scope:sync":!1,"scope:editor":!1},timestamp:{type:"string",default:"0","scope:sync":!1,"scope:editor":!1},sortingType:{type:"string",default:"sortAsc",enum:$rootScope.editor&&["sortDesc","sortAsc"],enumOptions:$rootScope.editor&&{sortDesc:"По убыванию",sortAsc:"По возрастанию"},"scope:editor":!1},dictionary:{"scope:editor":!1},getFullResult:{"scope:editor":!1},pageSize:{"scope:editor":!1}}),validate:FieldTextDateExt.validate,clearModel:FieldDropdownExt.clearModel}}]).factory("FieldMonthExtExt",["$rootScope","FieldDropdownExt","FieldTextDateExt",function($rootScope,FieldDropdownExt,FieldTextDateExt){return{list:[],isMonth:!0,attrs:angular.extend({},FieldDropdownExt.attrs,FieldTextDateExt.attrs,{forceXml:{type:"boolean",enum:[!0,!1],enumOptions:{true:"Да",false:"Нет"},default:!1,"scope:editor":!1},searchBar:{type:"boolean",default:!1,"scope:editor":$rootScope.isAdminUser},hasContextSearch:{type:"boolean",default:!0,"scope:editor":$rootScope.isAdminUser},parentItem:{default:"","scope:editor":!1},cached:{default:!1,"scope:editor":!1},mnemonicAutofill:{type:"string",default:"","scope:editor":!1},maxlength:{type:"integer",default:"","scope:editor":!1},yearRange:{type:"string",default:"","scope:editor":!1},format:{type:"string",default:"mm","scope:sync":!1,"scope:editor":!1},limits:{type:"string",default:"||||","scope:editor":!1},pageNum:{type:"string",value:"1",default:"1","scope:sync":!1,"scope:editor":!1},strategy:{type:"string",default:"",enum:$rootScope.editor&&[""].concat($rootScope.strategyKeys),enumOptions:$rootScope.editor&&$.extend({"":""},$rootScope.strategyHash),"scope:editor":!1},options:{default:"",value:[{text:"Январь",value:"01"},{text:"Февраль",value:"02"},{text:"Март",value:"03"},{text:"Апрель",value:"04"},{text:"Май",value:"05"},{text:"Июнь",value:"06"},{text:"Июль",value:"07"},{text:"Август",value:"08"},{text:"Сентябрь",value:"09"},{text:"Октябрь",value:"10"},{text:"Ноябрь",value:"11"},{text:"Декабрь",value:"12"}],"scope:model":!1,"scope:editor":!1},year:{type:"string",default:"1970","scope:sync":!1,"scope:editor":!1},month:{type:"string",default:"01","scope:sync":!1,"scope:editor":!1},date:{type:"string",default:"01","scope:sync":!1,"scope:editor":!1},hours:{type:"string",default:"0","scope:sync":!1,"scope:editor":!1},minutes:{type:"string",default:"0","scope:sync":!1,"scope:editor":!1},second:{type:"string",default:"0","scope:sync":!1,"scope:editor":!1},timezone:{type:"string",default:"+0400","scope:sync":!1,"scope:editor":!1},timestamp:{type:"string",default:"0","scope:sync":!1,"scope:editor":!1},getFullResult:{"scope:editor":!1},pageSize:{"scope:editor":!1}}),validate:FieldTextDateExt.validate,clearModel:FieldDropdownExt.clearModel}}]).factory("DropdownSearchForChildExt",["$rootScope","FieldDropdownExt",function($rootScope,FieldDropdownExt){return{isOnlySearch:!0,isOkato:!0,dictionary:{code:"OKATO"},attrs:angular.extend({},FieldDropdownExt.attrs,{forceXml:{type:"boolean",enum:[!0,!1],enumOptions:{true:"Да",false:"Нет"},default:!1,"scope:editor":!1},fullPathStr:{type:"string",default:"","scope:sync":!0,"scope:editor":!1},codeRegion:{default:"","scope:sync":!0,"scope:editor":!1},searchBar:{type:"boolean",default:!0},shortTitle:{type:"string",default:"","scope:sync":!0,"scope:editor":!1},text_value:{type:"string",default:"","scope:sync":!0,"scope:editor":!1},dictionary:{"scope:editor":!1},getFullResult:{"scope:editor":!1},pageSize:{"scope:editor":!1}}),validate:FieldDropdownExt.validate,clearModel:FieldDropdownExt.clearModel}}]).factory("FieldBirthCountryExt",["$rootScope","FieldDropdownExt",function($rootScope,FieldDropdownExt){return{dictionary:{code:"STRANI_IST_v2",initRequest:!0},getFullResult:{value:!0},attrs:angular.extend({},FieldDropdownExt.attrs,{forceXml:{type:"boolean",enum:[!0,!1],enumOptions:{true:"Да",false:"Нет"},default:!1,"scope:editor":!1},searchBar:{type:"boolean",default:!0}}),validate:FieldDropdownExt.validate,clearModel:FieldDropdownExt.clearModel}}]).factory("KladrDropdownExt",["$rootScope","fieldAttrs",function($rootScope,fieldAttrs){return{isKladr:!0,attrs:angular.extend({},fieldAttrs.attrs,{label:{default:"Подпись",type:"string"},value:{default:"",enumerable:!0,"scope:rule:all":!0},text_value:{type:"string","scope:sync":!0,"scope:editor":!1,"scope:rule:all":!0},remoteMethod:{default:"","scope:editor":!1},searchBar:{type:"boolean",default:!1},options:{default:[],"scope:editor":!1},disclosed:{default:!1,"scope:editor":!1},fieldWidth:{type:"string",enum:["20","40","60","80","100"],enumOptions:{20:"20%",40:"40%",60:"60%",80:"80%",100:"100%"},default:"80"},removeOpts:{type:"string",default:"",
"scope:editor":!0,"scope:ruleEditor":!0},emptyField:{type:"string",default:"[Не выбрано]"},cached:{type:"boolean",default:!0,"scope:editor":!1},error:{value:"","scope:editor":!1},hasContextSearch:{type:"boolean","scope:editor":!1,default:!0},initRequest:{type:"boolean","scope:editor":!1,default:!1},kladrPath:{type:"string","scope:editor":!1,default:""}})}}]).factory("fieldDropdownProperties",["$rootScope","fieldAttrs","Validators","api","apiInner","$q","PanelProps","PGU","dateHelpers",function($rootScope,fieldAttrs,Validators,api,apiInner,$q,PanelProps,PGU,dateHelpers){return{getChildrenItems:function(items,parentItem){if(!items||!items.length)return[];if(items[0].parentValue&&items[0].parentValue==parentItem)return items;for(var i=0;i<items.length;i++){if(items[i].value==parentItem)return items[i].children||[];var children=this.getChildrenItems(items[i].children,parentItem);if(children&&children.length)return children}},getChildrenItems_v2:function(items,parentItem,result){result||(result=[]);for(var itemChildren,haveChildren=!1,i=0,il=items.length;i<il;i++)for(var j=0,jl=items[i].children?items[i].children.length:0;j<jl;j++)haveChildren=!0,itemChildren=items[i].children[j],itemChildren.parentValue===parentItem&&result.push(itemChildren),this.getChildrenItems_v2([itemChildren],parentItem,result);return{children:result,haveChildren:haveChildren}},updateHierarchicClones:function(item,index){if(item&&!item.cancelEdit){var j,jl,itemCloneIndex=+(item.cloneIndex||0);if(item.deepLevel&&item.deepLevel<=itemCloneIndex+1)return void(item.fullFilled=!0);if(!itemCloneIndex){for(j=0,jl=item.clones?item.clones.length:0;j<jl;j++)$rootScope.$emit(item.clones[j].fullPath+":StopHandle"),api._FormHash[item.clones[j].fullPath]&&(api._FormHash[item.clones[j].fullPath]=null),item.markDeletedDraft=item.markDeletedDraft||{},item.markDeletedDraft[item.clones[j].fullPath]={deleted:!0};item.clones=[]}var original=api.find(item.originalFullPath).getElement();original.markDeletedDraft=original.markDeletedDraft||{};var originalSpliced;original.clones=original.clones||[];for(var i=0;i<original.clones.length;i++)if(original.clones[i].cloneIndex==itemCloneIndex){for(originalSpliced=original.clones.splice(i+1,original.clones.length),j=0,jl=originalSpliced.length;j<jl;j++)$rootScope.$emit(originalSpliced[j].fullPath+":StopHandle"),api._FormHash[originalSpliced[j].fullPath]&&(api._FormHash[originalSpliced[j].fullPath]=null,original.markDeletedDraft[originalSpliced[j].fullPath]={deleted:!0});originalSpliced=[];break}if(void 0===item.value||""===item.value)return void api.uploadDraft(!1,null,null,!1,original);var clone=PGU.copy(JSON.parse(original._model));clone.cloneIndex=itemCloneIndex+1,clone.parentRefItemValue=item.value,clone.parentItem=item.value,PanelProps.replaceFullPathInAttrs(clone,original.fullPath,original.originalName,clone.cloneIndex),clone.name=original.originalName+"["+clone.cloneIndex+"]",clone.parent=item.parent,clone.parentDropdown=original.fullPath,clone.required=!!(original.validLevel&&itemCloneIndex+1<=original.validLevel),item.required&&(original.notRequiredTextHide?+clone.cloneIndex>+original.validLevel&&(clone.required=!1):clone.required=!0),clone.originalName=item.originalName,clone.originalFullPath=item.originalFullPath,clone.fullPathForXml=item.fullPathForXml?item.fullPathForXml.replace(/\[\d+]$/gi,"")+"["+clone.cloneIndex+"]":"",clone.value="",clone.dictionary.initRequest=!0,clone.availableForHide=!0,api.initAttrs([clone],void 0,clone.parent?clone.parent.element:void 0),original.clones.push(clone),original.markDeletedDraft[clone.fullPath]&&(original.markDeletedDraft[clone.fullPath].deleted=!1),clone.visibleLevel=!0,api.__addToMarkDeletedRuntime(clone.fullPath),api.uploadDraft(!1,null,null,!1,original)}},addMultipleClone:function(item,values){function showSetClone(){var draftData=item.__draftData?item.__draftData.slice():[];item.clones=[],item.value="",item.text_value="",item.selectedMultiple=[],values.split(",").filter(function(value){return!!value}).forEach(function(value){var draftDataItemIndex=-1;item.__draftDataLength&&draftData.forEach(function(draftItem,i){draftItem.value===value&&(draftDataItemIndex=i)}),draftDataItemIndex>-1&&--item.__draftDataLength,item.isValueSelectedByUser=!0;var text_value="",list=item.listOriginal||item.list;list&&list.forEach(function(it){it.value==value&&(text_value=it.title)}),text_value&&(item.value=value,item.text_value=text_value,self.addMultipleClone(item))})}var self=this;if(""===values)return item.selectedMultiple=[],void(item.list=item.listOriginal&&item.listOriginal.slice());if("string"==typeof values&&!item.isValueSelectedByUser)return item.promiseLoadDate||(item.promiseLoadDate=$q.defer()),item.selectedMultiple=[],item.list=item.listOriginal&&item.listOriginal.slice(),void(1===item.promiseLoadDate.promise.$$state.status?showSetClone():item.promiseLoadDate.promise.then(showSetClone));item.selectedMultiple=item.selectedMultiple||[],item.selectedMultiple.unshift({value:item.value,text_value:item.text_value});var value=item.selectedMultiple[0].value;item.isChangeByUser=item.selectedMultiple.length>1,item.value=item.selectedMultiple.map(function(item){return item.value}).join(",");for(var length=item.list?item.list.length:0,i=0;i<length;i++)if(item.list[i].value==value){item.list.splice(i,1);break}item.clones=[];for(var i=0;i<item.selectedMultiple.length;i++)item.clones.push({value:item.selectedMultiple[i].value,text_value:item.selectedMultiple[i].text_value,cloneIndex:i+1,pageNum:"1",fullPath:item.originalFullPath+"["+i+"]",className:item.className,attrs:item.attrs,fullPathForXml:item.fullPathForXml?item.fullPathForXml+"["+i+"]":""});item.isValueSelectedByUser=!1},deleteMultiClone:function(index,item){if(!item.disabled){var deleted=item.selectedMultiple.splice(index,1);if(item.isChangeByUser=!0,item.value=item.selectedMultiple.map(function(item){return item.value}).join(","),item.selectedMultiple.length||(item.text_value=""),!item.listOriginal||!item.listOriginal.length)return void $rootScope.$applyAsync();for(var list=item.list,listOriginal=item.listOriginal,count=0,i=0;i<listOriginal.length;i++)if(list[count]&&list[count].value==listOriginal[i].value)count+=1;else if(deleted[0].value==listOriginal[i].value)break;var deletedClones={},itemFullPath=item.fullPathForXml?item.fullPathForXml:item.originalFullPath||"";item.clones.forEach(function(li){deletedClones[li.fullPath]=!0}),item.clones=[];for(var i=0;i<item.selectedMultiple.length;i++){var postfix="["+i+"]";deletedClones[itemFullPath+postfix]&&(deletedClones[itemFullPath+postfix]=!1),item.clones.push({value:item.selectedMultiple[i].value,text_value:item.selectedMultiple[i].text_value,cloneIndex:i+1,pageNum:"1",fullPath:item.originalFullPath+"["+i+"]",className:item.className,attrs:item.attrs,fullPathForXml:item.fullPathForXml?item.fullPathForXml+"["+i+"]":""})}item.markDeletedDraft=item.markDeletedDraft||{};for(var k in deletedClones)deletedClones.hasOwnProperty(k)&&deletedClones[k]&&(item.markDeletedDraft[k]={deleted:!0});list.splice(count,0,apiInner.getListElemFromValue(listOriginal,deleted[0].value))}},initMultiClone:function(item){if(item.clones&&item.clones.length){item.selectedMultiple=[];for(var draftData=item.__draftData,i=0;i<item.clones.length;i++)item.selectedMultiple.push({value:item.clones[i].value,text_value:item.clones[i].text_value||item.clones[i].text,cloneIndex:item.clones[i].cloneIndex});item.value&&draftData&&draftData.length&&draftData.forEach(function(draftItem){draftItem.fullPathForXml=item.fullPathForXml+"["+draftItem.cloneIndex+"]"}),item.list&&item.list.length&&(item.list=apiInner.removeFromArray(item.list,item.selectedMultiple))}},getYearsList:function(limits,item){var opts=limits.split("|"),condition=opts[0],minDate=opts[1],maxDate=opts[2],modif=opts[3],range=(opts[4],{min:1900,max:2120});if(item.yearRange){var rangesArr=item.yearRange.split(":").map(function(item){return parseInt(item)});range.min=rangesArr[0],range.max=rangesArr[1]}var options={minDate:""===minDate?new Date(range.min,0,1).getFullYear():"current"===minDate?(new Date).getFullYear():minDate,maxDate:""===maxDate?new Date(range.max,0,1).getFullYear():"current"===maxDate?(new Date).getFullYear():maxDate};if((""!=condition||"current"!=condition)&&""===maxDate&&""!=minDate){var mdO={">=":minDate,"<=":new Date(range.min,0,1).getFullYear(),">":minDate,"<":new Date(range.min,0,1).getFullYear()},xdO={">=":new Date(range.max,0,1).getFullYear(),"<=":minDate,">":new Date(range.max,0,1).getFullYear(),"<":minDate};switch(condition){case">=":case"<=":case">":case"<":options={minDate:mdO[condition],maxDate:xdO[condition]}}}if("current"===condition){var param=-1!=$.inArray("-",modif),midnight=(new Date).getFullYear();options={minDate:param?this._offsetString(modif,(new Date).getFullYear()):midnight,maxDate:param?(new Date).getFullYear():this._offsetString(modif,(new Date).getFullYear())}}if("current-modifier"===minDate||"current-modifier"===maxDate){var minDateWithModif=minDate,maxDateWithModif=maxDate;modif=modif||"","current-modifier"===minDate&&(minDateWithModif=this._offsetString(modif,(new Date).getFullYear())),"current-modifier"===maxDate&&(maxDateWithModif=this._offsetString(modif,(new Date).getFullYear())),options={minDate:minDateWithModif,maxDate:maxDateWithModif}}if("past"===modif||"future"===modif){var param="past"===modif;options={minDate:param?new Date(range.min,0,1).getFullYear():(new Date).getFullYear(),maxDate:param?(new Date).getFullYear():new Date(range.max,0,1).getFullYear()}}for(var minYear=options.minDate,maxYear=options.maxDate,list=[];minYear<=maxYear;minYear++){var year={};year.title=minYear,year.value=minYear,"sortAsc"===item.sortingType?list.push(year):list.unshift(year)}return list},_offsetString:function(offset,originDate){for(var date=originDate||(new Date).getFullYear(),pattern=/([+-]?[0-9]+)\s*(y|Y)?/g,matches=pattern.exec(offset);matches;){switch(matches[2]||"d"){case"y":case"Y":date+=parseInt(matches[1],10)}matches=pattern.exec(offset)}return date},copyStructure:function(elem){var obj={};for(var item in elem)"attrs"!=item&&elem.hasOwnProperty(item)&&elem.attrs.hasOwnProperty(item)&&(obj[item]=PGU.copy(elem[item]));return elem.clearModel&&(obj.clearModel=elem.clearModel),obj.className=elem.className,obj},checkResponseData:function(data){var obj,code=data&&void 0!==data.code?data.code:data&&data.error&&void 0!==data.error.code?data.error.code:0;return code&&(obj={error:!1,searchIsEmpty:!1},"searchIsEmpty"!==code?obj.error=!0:obj.searchIsEmpty=!0),obj}}}]),angular.module("serverFormWidgets.general").directive("epguFieldDropdownHierarchicMultiple",["fieldDHMProperties","TEMPLATES","api","$rootScope","apiInner","$q","pguSelectService","UFFDPService","checkSignStatusSrv",function(fieldDHMProperties,TEMPLATES,api,$rootScope,apiInner,$q,pguSelectService,UFFDPService,checkSignStatusSrv){return{templateUrl:TEMPLATES.FIELD_DROPDOWN_HIERARCHIC_MULTIPLE,replace:!0,scope:{item:"="},link:function(scope,element,attrs){function loadChildren(item){var params;params=isSop?getRequestDataForSop(item,item.value):angular.extend(initOpts,{item:item,dictionary:scope.item.dictionary,parentRefItemValue:item.value}),item.loaded||item.dictionaryFullLoaded?item.checkbox.checked&&fieldDHMProperties.checkDirectChildren(item):fieldDHMProperties.loadData(params,scope.ui,function(){item.checkbox.checked&&fieldDHMProperties.checkDirectChildren(item)})}function toggleValue(val,item){!1===val||"false"===val?fieldDHMProperties.uncheckAllChildren(item.children,item.parentValue,scope.item.children):!0!==val&&"true"!==val||fieldDHMProperties.checkAllChildren(item.children,item.parentValue,scope.item.children)}function cancelPopup(validate,isReject){isReject&&(scope.hasFileWithSign=hasFileWithSignPrev),scope.ui.showPopup=!1,api.scrollTo(scope.item.fullPath,"",-60),validate&&api.find(scope.item.fullPath).validate()}function clearPopup(){apiInner.loopThroughTheTree(scope.item.children,function(items,item){item.checkbox={},item.opened=!1},"children")}function savePopup(){scope.item.listResult=fieldDHMProperties.hideFromResult(scope.item.children.slice());var deletedClones={};scope.item.clones&&scope.item.clones.length&&scope.item.clones.forEach(function(li){deletedClones[li.fullPathForXml]=!0}),scope.item.listResult&&(scope.item.clones=fieldDHMProperties.cloneIndexSort(fieldDHMProperties.createClones(scope.item.listResult,null,null,null,null,scope.item.fullPathForXml))),scope.item.clones&&scope.item.clones.length&&scope.item.clones.forEach(function(li){deletedClones[li.fullPathForXml]&&(deletedClones[li.fullPathForXml]=!1)});for(var k in deletedClones)deletedClones.hasOwnProperty(k)&&deletedClones[k]&&(api.__getMarkDeleted()[k]={deleted:!0});api.env("autosaveDisabled")||api.uploadDraft(!1,null,null,!1,scope.item),scope.item.isDigitalProfileUploader?(scope.hasFileWithSign=scope.item.listResult.some(function(it){return it.checkbox&&it.checkbox.checked&&it.hasSign}),UFFDPService.attachDocumentsToOrder(scope.item.children).then(cancelPopup)):cancelPopup(!0)}function loadAllClones(clones,dictionaryFullLoaded){if(clones&&clones.length){for(var dictionary=api.find(clones[0].originalFullPath).element.dictionary,defers=[],i=0;i<clones.length;i++)!function(i){var clone=clones[i],deffered=$q.defer();defers.push(deffered.promise);var params;params=isSop?getRequestDataForSop(clone,clone.value):{refName:dictionary.code,filter:clone.filter,item:clone,dictionary:scope.item.dictionary,parentRefItemValue:clone.value,dictionaryFullLoaded:dictionaryFullLoaded},fieldDHMProperties.loadData(params,{},function(){deffered.resolve()})}(i);return $q.all(defers)}}function getRequestDataForSop(item,parentValue){item.parentRefItemValue=parentValue||"",item.isHierarchicMultiple=!0,item.dictionary||(item.dictionary=scope.item.dictionary);var opts=pguSelectService.buildRequestOpts(item,{pageSize:pageSize,pageNum:1});return opts.item=item,opts.dictionaryFullLoaded=!1,opts}scope.ui={},scope.ui.showPopup=!1,scope.ui.isMobile=device.mobile(),scope.item.fullPathForXml=scope.item.fullPathForXml||scope.item.fullPath;var initOpts,isSop=scope.item.dictionary&&scope.item.dictionary.isSop,pageSize=scope.item.pageSize&&"0"!=scope.item.pageSize?scope.item.pageSize:258,hasFileWithSignPrev=!1;initOpts=isSop?getRequestDataForSop(scope.item,scope.item.parentRefItemValue):{refName:scope.item.dictionary.code,filter:scope.item.filter,item:scope.item,parentRefItemValue:scope.item.parentRefItemValue,dictionaryFullLoaded:scope.item.dictionaryFullLoaded},scope.ui.openPopup=function(){hasFileWithSignPrev=scope.hasFileWithSign,scope.hasFileWithSign=!1,scope.ui.showPopup=!0,scope.item.notInitRequest?(fieldDHMProperties.loadData(initOpts,scope.ui,function(){fieldDHMProperties.setResultInPopup(scope.item.listResult,scope.item.children)}),scope.item.notInitRequest=!1):fieldDHMProperties.setResultInPopup(scope.item.listResult,scope.item.children)},$rootScope.isDesigner||function(){scope.item&&(scope.item.dictionary&&!apiInner.toBoolean(scope.item.dictionary.initRequest)||scope.item.isDigitalProfileUploader)?scope.item.notInitRequest=!0:fieldDHMProperties.loadData(initOpts,scope.ui),scope.$watch("item.value",function(val,oldVal){void 0!==val&&val!==oldVal&&api.find(scope.item.fullPath).afterSetValue(val,oldVal)}),scope.$watch("item.parentRefItemValue",function(val,oldVal){val&&oldVal!=val&&fieldDHMProperties.loadData(initOpts,scope.ui)});var isDraft=$rootScope.$watch("setDraft",function(newVal,oldVal){if(!1===newVal){var fromDraft=scope.item.value?[scope.item.value]:[];if(scope.item.clones&&scope.item.clones.length||scope.item.wasChecked){scope.item.clones&&scope.item.clones.length&&scope.item.clones.forEach(function(item){item.isClone=!0,item.fullPathForXml=scope.item.fullPathForXml+"["+item.cloneIndex+"]",fromDraft.push(item.value)});var load=function(){fieldDHMProperties.addFirstClone(scope.item),scope.item.dictionaryFullLoaded?fieldDHMProperties.initMultiClone(scope.item,scope.ui):loadAllClones(scope.item.clones,!1).then(function(){fieldDHMProperties.initMultiClone(scope.item,scope.ui)})};if(scope.item.isDigitalProfileUploader){if(scope.item.isClone)return;var someCheckedWithSign=!1;fieldDHMProperties.loadData(initOpts,scope.ui,function(){scope.item.children.forEach(function(child){fromDraft.includes(child.value)&&(child.checkbox.checked=!0,someCheckedWithSign=!0)}),savePopup(),someCheckedWithSign&&checkSignStatusSrv.getCheckSingStatus(scope.item.fullPath)})}else scope.item.notInitRequest?(fieldDHMProperties.loadData(initOpts,scope.ui,load),scope.item.notInitRequest=!1):load();isDraft()}}});scope.openCallback=loadChildren,scope.ui.toggleValue=toggleValue,scope.ui.cancel=cancelPopup,scope.ui.clear=clearPopup,scope.ui.save=savePopup}(),scope.$emit(scope.item.fullPath+":ScopeApplied",{scope:scope,element:element}),scope.item.isScopeAppliedDone={scope:scope,element:element}}}}]).directive("fdhmCheckbox",["$rootScope","$timeout","api",function($rootScope,$timeout,api){return{restrict:"E",replace:!0,template:'<div class="PGU-FieldCheckBox PGU-FieldCheckBox-MarginTop-{{el.marginTop}}" ng-class="{\'PGU-Disabled\': el.disabled,\'PGU-FieldCheckBox-active\': el.checked,\'PGU-FieldCheckBox-NotAllItemsChecked\': el.notAllItemsChecked,}"><a ng-click="toggleChecked()" class="PGU-FieldCheckBoxWrap"><input type="checkbox" id="{{el.fullPath}}"/><i class="PGU-LabelIcon"><i></i></i><span class="PGU-Icon-List-Item PGU-Icon-{{el.iconType}}" ng-if="el.iconType"></span><label for="" class="PGU-FieldLabel-List">{{el.label}}</label></a></div>',scope:{el:"=",toggle:"=",item:"=",disabled:"=",setCheckbox:"="},link:function(scope,element,attrs){if(scope.el.value){var isChecked;isChecked="true"===scope.el.value,scope.el.checked=isChecked,scope.el.textValue=isChecked?"Да":"Нет"}scope.disabled&&(scope.el.disabled=!0);var watchers;scope.$on("suspend",function(){watchers=scope.$$watchers,scope.$$watchers=[]}),scope.$on("resume",function(){scope.$$watchers=watchers,watchers=null}),scope.$watch("disabled",function(val,oldVal){"undefined"!==val&&val!=oldVal&&(scope.el.disabled=!!val)}),scope.$watch("el.value",function(val,oldVal){"undefined"!==val&&val!=oldVal&&scope.$applyAsync(function(){var isChecked;isChecked="true"===scope.el.value,scope.el.checked=isChecked,scope.el.textValue=isChecked?"Да":"Нет"})}),scope.$watch("el.checked",function(val,oldVal){"undefined"!==val&&val!=oldVal&&scope.$applyAsync(function(){scope.el.value=val+"",scope.el.textValue=val?"Да":"Нет"})}),scope.toggleChecked=function(){if(scope.el.disabled)return!1;scope.el.checked=!scope.el.checked,scope.el.notAllItemsChecked=!1,scope.el.value=scope.el.checked+"",scope.el.textValue=scope.el.checked?"Да":"Нет",scope.toggle&&scope.toggle(scope.el.value,scope.item)}}}}]).directive("listHierarchic",["$compile","apiInner","$rootScope",function($compile,apiInner,$rootScope){return{restrict:"E",replace:!0,scope:{list:"=",openz:"=",toggleValue:"=",disabledTree:"=",hideEmptyChildren:"=",loading:"=",dictionaryFullLoaded:"=?"},link:function(scope,element,attrs){scope.toggleView=function(item){item.opened=!item.opened||item.loaded&&(!item.children||!item.children.length),item.opened&&scope.openz&&scope.openz(item)};var watchers;scope.$on("suspend",function(){watchers=scope.$$watchers,scope.$$watchers=[]}),scope.$on("resume",function(){scope.$$watchers=watchers,watchers=null}),$(element).html("<div ng-show='loading && !list' class='PGU-throbber-small'>Подождите</div><div class='PGU-Error-Load' ng-show='!loading && !list'>Ошибка загрузки данных.</div><div ng-show='!loading && list && !list.length'>Информации по выбранным значениям не найдено.</div><div class='PGU-hierarchy-list'><ul>   <li ng-repeat='item in list' ng-class='{\"PGU-up\": item.opened, \"PGU-down\": !item.opened, \"PGU-selected\": item.checkbox.checked}' ng-if='(item.showResults !== false && hideEmptyChildren || !hideEmptyChildren)'>       <span class='ico' ng-click='toggleView(item)' ng-hide='(item.opened || dictionaryFullLoaded) && (!item.children || !item.children.length)'></span>       <span class='t PGU-Lable' ng-click='toggleView(item)'           ng-class='{               \"PGU-tree-item-no-child\": (item.opened || dictionaryFullLoaded) && (!item.children || !item.children.length) && !loading,               \"plain-text\": (item.opened || dictionaryFullLoaded) && (!item.children || !item.children.length) && !loading,               \"text-link\": (!item.opened && !dictionaryFullLoaded) && (item.children && item.children.length) && !loading}'>{{item.title}}           <span data-ng-if=\"item.isUploader && !disabledTree\"><br><a href=\"{{item.link}}\" target=\"_blank\" class=\"t PGU-tree-item-no-child plain-text link\">Скачать</a></span>           <check-sign-status data-ng-if=\"item.hasSign && item.isUploader && disabledTree\"\n                 data-file=\"item\" data-main-file-title=\"item.title\" data-button-path=\"item.fullPath\"></check-sign-status>       </span>              <fdhm-checkbox el='item.checkbox' item='item' toggle='toggleValue' disabled='disabledTree'></fdhm-checkbox>       <div ng-show='loading && item.opened && item.children && !item.children.length && !item.loaded' class='PGU-throbber-small'>Подождите</div>       <div class='PGU-Error-Load' ng-show='item.errorLoad'>Ошибка загрузки данных.</div>       <div ng-show='item.opened && item.children && item.children.length'>           <list-hierarchic list='item.children' openz='openz' selected='item.checkbox.value' toggle-value='toggleValue' hide-empty-children='hideEmptyChildren' disabled-tree='disabledTree'></list-hierarchic>       </div>   </li></ul></div>"),$compile(element.contents())(scope)}}}]).factory("FieldDropdownHierarchicMultipleExt",["fieldAttrs","$rootScope",function(fieldAttrs,$rootScope){return{attrs:angular.extend({},fieldAttrs.attrs,{label:{default:"Подпись"},value:{enumerable:!0,"scope:rule:all":!0,"scope:ruleEditor":!0},text_value:{type:"string","scope:sync":!1,"scope:editor":!1,"scope:rule:all":!0},dictionary:{default:{}},"dictionary.code":{enumerable:!0,enum:"","scope:model":!1,"scope:editor":!1},dictionaryFullLoaded:{type:"boolean",default:!1},fieldWidth:{type:"string",enum:["20","40","60","80","100"],enumOptions:{20:"20%",40:"40%",60:"60%",80:"80%",100:"100%"},default:"80","scope:editor":!1},removeOpts:{type:"string",default:"","scope:editor":$rootScope.isAdminUser,"scope:ruleEditor":!0},strategy:{type:"string",default:"",enum:$rootScope.editor&&[""].concat($rootScope.strategyKeys),enumOptions:$rootScope.editor&&$.extend({"":""},$rootScope.strategyHash),"scope:editor":$rootScope.isAdminUser},cached:{type:"boolean",default:!1,"scope:editor":!1,"scope:sync":!1},getFullResult:{type:"boolean",default:!1},cloneIndex:{type:"string","scope:editor":!1,"scope:sync":!0,default:"0"},deepLevel:{type:"number","scope:editor":!0,default:0,"scope:sync":!0},validLevel:{type:"number","scope:editor":!0,default:0},lastLevelValue:{type:"string","scope:editor":!1,"scope:sync":!0,default:"0"},validators:{default:[],"scope:editor":!1},sendAllParents:{type:"boolean",default:!0,"scope:editor":$rootScope.isAdminUser},popupTitle:{type:"string",default:""},selectButtonTitle:{type:"string",default:"Выбрать значения"},title:{"scope:editor":!1,"scope:sync":!0,"scope:ruleEditor":!0},parentPath:{"scope:editor":!1,"scope:sync":!0},visibleChildren:{"scope:editor":!1,"scope:sync":!0},wasChecked:{"scope:editor":!1,"scope:sync":!0},checkedAllChildren:{"scope:editor":!1,"scope:sync":!0},notAllItemsChecked:{"scope:editor":!1,"scope:sync":!0,default:!1},withoutCache:{type:"boolean","scope:editor":!1,default:!1},pageSize:{type:"number",default:0},isHierarchicMultiple:{type:"boolean","scope:editor":!1,default:!0}}),validate:function(lazy){if(lazy||this.disabled()||!this.visible()||!this.inheritedVisibility())return this.error(""),!0;var that=this,valid=!0,required=this.required();if(this.canValidate=!0,required){this.error("");if(!(that.element.listResult&&that.element.listResult.length)){var requiredValidObj=this.validators();return requiredValidObj&&requiredValidObj.length&&requiredValidObj.forEach(function(validator){"required"===validator.mnemonic&&that.error(validator.message)}),valid=!1}}return valid},addClone:function(item,index,api){if(item){var original=api.find(item.originalFullPath).getElement(),clone=function(el,index){var clone=angular.extend({},el);return clone.loaded=void 0,clone.clones=void 0,clone.cloneIndex=void 0===index?void 0!==el.cloneIndex?1*el.cloneIndex+1:1:index,clone.fullPath=el.originalFullPath+"["+clone.cloneIndex+"]",clone.name=el.originalName+"["+clone.cloneIndex+"]",clone}(item,index);original.clones&&original.clones.length||(original.clones=[]);for(var isFind=!1,i=0;i<original.clones.length;i++)original.clones[i].cloneIndex==clone.cloneIndex&&(isFind=i);return!1===isFind&&original.clones.push(clone),api.initAttrs(original.clones),clone}},clearAll:function(){function childrenClearing(children){angular.forEach(children,function(item){item.checkbox={},item.showResults=!1,item.opened=!1,item.visibleChildren=!1,item.children&&item.children.length>0&&childrenClearing(item.children)})}this.element&&(this.element.listResult=[],this.element.clones=[],this.element.children=[],this.element.notInitRequest=!0,this.element.loaded=!1,childrenClearing(this.element.children),$rootScope.$applyAsync())}}}]).factory("fieldDHMProperties",["$rootScope","fieldAttrs","Validators","api","apiInner","pguSelectService","ELEMS_EXTENTIONS","UFFDPService",function($rootScope,fieldAttrs,Validators,api,apiInner,pguSelectService,ELEMS_EXTENTIONS,UFFDPService){return{validate:function(lazy){if(lazy||this.disabled()||!this.inheritedVisibility())return this.error(!1),!0;var that=this,valid=!0,required=this.required();if(this.canValidate=!0,required){this.error(!1);if(!(that.element.listResult&&that.element.listResult.length)){var requiredValidObj=this.validators();return requiredValidObj&&requiredValidObj.length&&requiredValidObj.forEach(function(validator){"required"===validator.mnemonic&&that.error(validator.message)}),valid=!1}}return valid},loadData:function(request,ui,callback,defer){function handleItems(data){if(data.items){var list=pguSelectService.removeOpts(angular.copy(data.items),opts.item.removeOpts);list=list||[];var parentPath=opts.item.parentPath?opts.item.parentPath.split(",").reverse():"",parentValue="";parentValue=parentPath?parentPath.join("|")+"|"+opts.parentRefItemValue:(opts.item.parentValue?opts.item.parentValue+"|":"")+(opts.parentRefItemValue||"");for(var i=0;i<list.length;i++)opts.item.checkbox=opts.item.checkbox||{},list[i].checkbox={},list[i].originalFullPath=opts.item.originalFullPath,list[i].originalName=opts.item.originalName,list[i].attrs=opts.item.attrs,list[i].dictionaryFullLoaded=opts.item.dictionaryFullLoaded,list[i].parentValue=parentValue,list[i].children&&list[i].children.length&&that.initChildren(list[i]);opts.item.children=list}data.error&&0!=data.error.code&&"searchIsEmpty"!=data.error.code&&(opts.item.errorLoad=!0),opts.item.loaded=!0,ui.loading=!1,callback&&callback(opts.item,defer)}var that=this,opts=angular.extend({pageSize:99999,pageNum:1},request);return opts.item.loaded||opts.item.children&&opts.item.children.length?void(void 0!==defer&&defer.resolve()):opts.item.dictionaryFullLoaded&&opts.item.value&&0!=opts.item.deepLevel?(opts.item.loaded=!0,void(void 0!==defer&&defer.resolve())):(ui.showResult=!1,ui.loading=!0,opts.item.originalFullPath=opts.item.originalFullPath||opts.item.fullPath,opts.item.originalName=opts.item.originalName||opts.item.name,opts.item.errorLoad=!1,void(opts.item.isDigitalProfileUploader?UFFDPService.getDocuments(opts.item.fileTypes).then(handleItems):pguSelectService.loadDataFromServer(opts,handleItems,opts.item.withoutCache)))},initChildren:function(item){var list=pguSelectService.removeOpts(angular.copy(item.children),item.removeOpts);list=list||[];for(var that=this,i=0;i<list.length;i++)list[i].checkbox={},list[i].originalFullPath=item.originalFullPath,list[i].originalName=item.originalName,list[i].attrs=item.attrs,list[i].parentValue=(item.parentValue?item.parentValue+"|":"")+item.value,item.loaded=!0,list[i].dictionaryFullLoaded=!0,list[i].children&&list[i].children.length&&that.initChildren(list[i]);item.children=list},createClones:function(list,cloneIndex,deepLevel,parentPath,skip,fullPathForXml){if(list&&list.length){for(var cloneIndex=cloneIndex||0,deepLevel=deepLevel||0,parentPath=parentPath||""===parentPath?parentPath:"",clones=[],i=0;i<list.length;i++){var item=list[i];if(list[i].checkbox.checked||list[i].showResults){item.children&&item.children.length?item.checkedAllChildren=this.isFirstChildrenChecked(item.children)+"":item.checkedAllChildren="false";var clone={};clone.value=item.value,clone.title=item.title,clone.cloneIndex=cloneIndex,clone.deepLevel=deepLevel+"",clone.wasChecked=!!item.checkbox.checked+"",clone.parentPath=parentPath,clone.originalFullPath=item.originalFullPath,clone.originalName=item.originalName,clone.fullPathForXml=fullPathForXml,clone.fullPath=item.originalFullPath+"["+cloneIndex+"]",clone.name=item.originalName+"["+cloneIndex+"]",clone.attrs=item.attrs,clone.opened=item.opened,item.opened&&(clone.visibleChildren="true"),clone.checkedAllChildren=item.checkedAllChildren,clone.notAllItemsChecked=!!item.checkbox&&!!item.checkbox.notAllItemsChecked,clones.push(clone),cloneIndex++}}deepLevel++;for(var i=0;i<list.length;i++){var item=list[i],that=this;item.children&&item.children.length&&(clones=clones.concat(that.createClones(item.children,cloneIndex,deepLevel,parentPath?item.value+","+parentPath:item.value,"true"===item.checkedAllChildren,fullPathForXml)))}return clones}},cloneIndexSort:function(clones){if(clones){for(var i=0;i<clones.length;i++)clones[i].cloneIndex=i,clones[i].fullPath=clones[i].originalFullPath.replace(/\[\d+\]$/gi,"")+"["+i+"]",clones[i].name=clones[i].originalName.replace(/\[\d+\]$/gi,"")+"["+i+"]",clones[i].fullPathForXml=clones[i].fullPathForXml+"["+i+"]";return clones}},addFirstClone:function(item){var original=api.find(item.originalFullPath).getElement(),clone={},itemCheckbox=item.checkbox||{};return clone.className=item.className,clone.value=item.value,clone.title=item.title,clone.loaded=void 0,clone.dictionary=item.dictionary,clone.cloneIndex=0,clone.deepLevel=0,clone.checkbox=_.extend({},itemCheckbox),clone.wasChecked=item.wasChecked,clone.notAllItemsChecked=item.notAllItemsChecked,clone.parentPath=item.parentPath,clone.originalFullPath=item.originalFullPath,clone.fullPathForXml=item.fullPathForXml+"[0]",clone.originalName=item.originalName,clone.fullPath=item.originalFullPath+"[0]",clone.name=item.originalName+"[0]",clone.attrs=item.attrs,clone.visibleChildren=item.visibleChildren,clone.opened=item.visibleChildren,original.clones&&original.clones.length||(original.clones=[]),ELEMS_EXTENTIONS.initAttrs({element:clone}),original.clones.unshift(clone),clone},initMultiClone:function(item,ui){function applyChildren(clone,items,parents,index){for(var i=0;i<items.length;i++)if(items[i].value==parents[index]){var parent=items[i];if(parent.children||(parent.children=[]),0==index)if(parent.children&&parent.children.length&&!parent.dictionaryFullLoaded)for(var j=0;j<parent.children.length;j++){var child=parent.children[j];child.value==clone.value&&(angular.extend(child,clone),parent.opened=!0),"true"==child.checkedAllChildren&&child.children&&child.children.length&&that.checkDirectChildren(child)}else parent.children.push(clone),parent.opened=!0,"true"==clone.checkedAllChildren&&clone.children&&clone.children.length&&that.checkDirectChildren(clone);else index-=1,applyChildren(clone,parent.children,parents,index)}}for(var clones=item.clones,that=this,i=0;i<clones.length;i++){var clone=clones[i];clone.checkbox={value:("true"==clone.wasChecked)+"",checked:"true"==clone.wasChecked,textValue:"true"==clone.wasChecked?"Да":"Нет"},clone.checkbox.notAllItemsChecked="true"===clone.notAllItemsChecked||!0===clone.notAllItemsChecked,clone.opened=!1,
clone.dictionaryFullLoaded=item.dictionaryFullLoaded}!function(){for(var res=[],i=0;i<clones.length;i++){var clone=clones[i],parents=clone.parentPath?clone.parentPath.split(","):"";"0"==clone.deepLevel?res.push(clone):applyChildren(clone,res,parents,parents.length-1)}item.listResult=that.hideFromResult(res),$rootScope.$$phase||$rootScope.$apply()}()},setResultInPopup:function(listResult,children){if(listResult&&listResult.length)for(var isFirstLevel=listResult.length!==children.length,i=0;i<listResult.length;i++)for(var j=0;j<children.length;j++)if(listResult[i].value==children[j].value){if(children[j].checkbox.checked=listResult[i].checkbox.checked,children[j].checkbox.notAllItemsChecked=listResult[i].checkbox.notAllItemsChecked,children[j].checkedAllChildren=listResult[i].checkedAllChildren,children[j].showResults=listResult[i].showResults,children[j].loaded=listResult[i].loaded,children[j].opened=listResult[i].opened,children[j].children&&children[j].children.length||!children[j].loaded||!listResult[i].children||!listResult[i].children.length?children[j].children&&children[j].children.length&&listResult[i].children&&listResult[i].children.length&&this.setResultInPopup(listResult[i].children,children[j].children):this.extendItemFromListToChildren(listResult[i].children,children[j]),!isFirstLevel)break}else listResult[j]||(this.uncheckAllChildren(children[j].children),children[j].checkbox.checked=!1,children[j].checkbox.notAllItemsChecked=!1,children[j].checkedAllChildren=!1,children[j].showResults=!1,children[j].opened=!1)},extendItemFromListToChildren:function(items,parent){var self=this;parent.children=[],items.forEach(function(item){var extended=_.extend({},item);extended.checkbox=_.extend({},item.checkbox),extended.checkbox.disabled=!1,parent.children.push(extended),item.children&&item.children.length&&parent.loaded&&self.extendItemFromListToChildren(item.children,extended)})},hideFromResult:function(list){if(list){for(var i=0;i<list.length;i++)list[i].checkbox.checked?list[i].showResults=!0:list[i].showResults=!!list[i].children&&this.isOneChildChecked(list[i].children),list[i].children&&list[i].children.length&&this.isOneChildChecked(list[i].children)&&(list[i].children=this.hideFromResult(list[i].children));return this.isOneChildChecked(list)?list:[]}},isOneChildChecked:function(list){function runInTree(list){for(var i=0;i<list.length&&!flag;i++){if(list[i].checkbox.checked)return flag++,!0;list[i].children&&list[i].children.length&&runInTree(list[i].children)}}var flag=0;return runInTree(list),!!flag},isOneChildUnChecked:function(list){function runInTree(list){for(var i=0;i<list.length&&!flag;i++){if(!list[i].checkbox.checked)return flag++,!0;list[i].opened&&list[i].children&&list[i].children.length&&runInTree(list[i].children)}}var flag=0;return runInTree(list),!!flag},checkDirectChildren:function(item){if(item.children&&item.children.length)for(var isDisabled=item.checkbox.disabled,k=0;k<item.children.length;k++)item.children[k].checkbox={value:"true",checked:!0,disabled:isDisabled}},checkAllChildren:function(children,parentValue,fullList){apiInner.loopThroughTheTree(children,function(items,i){i.checkbox={value:"true",checked:!0,notAllItemsChecked:!1}},"children");var parentsValues;parentValue&&fullList&&fullList.length&&(parentsValues=parentValue.split("|"),this.findParentByValue(fullList,parentsValues,0,!0))},uncheckAllChildren:function(children,parentValue,fullList){var parentsValues;apiInner.loopThroughTheTree(children,function(items,i){i.checkbox={},i.showResults=!1},"children"),parentValue&&fullList&&fullList.length&&(parentsValues=parentValue.split("|"),this.findParentByValue(fullList,parentsValues,0))},findParentByValue:function(list,parentsValues,i,isChecked){var self=this,value=parentsValues[i];list.forEach(function(item,ind){var isFirstChildrenChecked=!0;isChecked?item.value===value&&item.children&&item.children.length&&(i++,self.findParentByValue(item.children,parentsValues,i,isChecked),isFirstChildrenChecked=self.isFirstChildrenChecked(item.children),isFirstChildrenChecked?(item.checkbox.notAllItemsChecked=!1,item.checkbox.checked=!0):item.checkbox.notAllItemsChecked=!0):item.value===value&&(item.checkbox.value="false",item.checkbox.checked=!1,item.checkbox.notAllItemsChecked=!0,item.children&&item.children.length&&(i++,self.findParentByValue(item.children,parentsValues,i),(isFirstChildrenChecked=self.isFirstChildrenChecked(item.children,!1,"notAllItemsChecked",!1))&&(item.checkbox.notAllItemsChecked=!1)))})},isFirstChildrenChecked:function(list,check,secondCheckAttribute,secondCheckAttributeValue){for(var checked=0,i=0;i<list.length;i++)void 0!==check?!!list[i].checkbox.checked==check&&(void 0!==secondCheckAttribute?!!list[i].checkbox[secondCheckAttribute]===secondCheckAttributeValue&&checked++:checked++):list[i].checkbox.checked&&checked++;return checked==list.length}}}]),angular.module("serverFormWidgets.general").directive("epguTimeSlotExt",["$compile","$q","TEMPLATES","api","apiInner","PGU","$rootScope","$sce","$location","pguSelectService","pguEqueueService","$window","$timeout","TimeSlotExtExt","$moment","$routeParams","TIME_SLOT_ERRORS","HealthSrv",function($compile,$q,TEMPLATES,api,apiInner,PGU,$rootScope,$sce,$location,pguSelectService,pguEqueueService,$window,$timeout,TimeSlotExtExt,$moment,$routeParams,TIME_SLOT_ERRORS,HealthSrv){return{templateUrl:TEMPLATES.TIME_SLOT_EXT,replace:!0,controller:["$scope","$element",function($scope,$element){function buildGibddFilter(){function getAsString(binding,previousSearchQuery){if("AppointmentDate"==binding.name)return datePickerValue+"T00:00:00";if("AppointmentDateTo"==binding.name)return datePickerValue+"T23:59:59";var el=api.find(binding.value);return el&&!apiInner.isEmptyObject(el)?el.getElement()[binding.attr]:"title"==binding.name&&previousSearchQuery?"":binding.value}var requestBinding=($scope.item.dictionary||{}).requestBinding||[],opts={},datePicker=api.find($scope.item.fullPath+".FieldTextDate"),datePickerValue=function(date){return!!(date.split(".")[2]&&4==date.split(".")[2].length&&date.split(".")[1]&&2==date.split(".")[1].length&&date.split(".")[0]&&2==date.split(".")[0].length)&&date.split(".")[2]+"-"+date.split(".")[1]+"-"+date.split(".")[0]}(datePicker.value());if(!datePickerValue||!datePicker.validate())return!1;if(requestBinding.length){var previousSearchQuery=!1,parts=$.map(requestBinding,function(binding){return opts.filter||"title"!==binding.name?{simple:{attributeName:binding.name,condition:"title"==binding.name?"CONTAINS":"EQUALS",value:{asString:getAsString(binding,previousSearchQuery)}}}:void(previousSearchQuery=!0)});opts.filter=1==parts.length?parts[0]:{union:{unionKind:"AND",subs:parts}}}return opts.filter}function getList(callback){var self=this;if($scope.item.datePickerMode){if(self.slotsCollection=[],$scope.item.gibddDropdown||($scope.item.gibddDropdown=api.find($scope.item.fullPath+"._gibddDropdown")),$scope.item.gibddDropdown.element.filter=buildGibddFilter(),$scope.item.gibddDropdown.element.filter){$scope.models.isLoading=!0,$scope.models.isEmpty=!1,$scope.ui.fetched=!0,$scope.item.gibddDropdown.element.isFilterPrepared=!0;var requestBegin=(new Date).getTime(),organizationId="";$scope.item.gibddDropdown.element.filter.union.subs.forEach(function(i){var it=i.simple;"departmentID"===it.attributeName&&(organizationId=it.value.asString)});var health={type:"getSlotsMVD",startTime:requestBegin,addParams:{organizationId:organizationId,orderId:$rootScope.settings.orderId}};$scope.item.gibddDropdown.element.getList({done:function(data){if(data&&data.length){var dateFromResponse=data[0].value.split("T")[0],year=dateFromResponse.split("-")[0],month=dateFromResponse.split("-")[1],date=dateFromResponse.split("-")[2],day={title:pguEqueueService.getDayOfWeek(new Date(year,month-1,date),year,month,+date),opened:!0,slots:[]};day.slots=prepareGibddSlots(data,year,month,date),self.slotsCollection.push(day),$scope.models.isLoading=!1,$scope.models.isEmpty=!1}else $scope.item.errorMessageHeader="Нет свободного времени для записи в выбранный день",$scope.item.errorMessageBody="Попробуйте выбрать другой день или изменить подразделение для посещения",$scope.ui.fetched=!1,$scope.models.isLoading=!1,$scope.models.isEmpty=!0;health.addParams.slotsCount=data&&data.length||0,HealthSrv.checkHealthWhenDone(health,{items:data})},error:function(error){var msgHeader="Невозможно выбрать время для записи",msgBody="Попробуйте записаться позднее или выбрать другое подразделение для записи.",errorCode=0;error&&error.error&&error.error.code&&(errorCode=error.error.code),3001===errorCode&&(msgHeader=TIME_SLOT_ERRORS[errorCode].title,msgBody=TIME_SLOT_ERRORS[errorCode].message),$scope.item.errorMessageHeader=msgHeader,$scope.item.errorMessageBody=msgBody,$scope.ui.fetched=!1,$scope.models.isLoading=!1,$scope.models.isEmpty=!0,health.addParams.slotsCount=0,HealthSrv.checkHealthWhenError(health,{data:error})}})}}else{$scope.models.isLoading=!0,$scope.models.isEmpty=!1,$scope.ui.popup.isPhoneHelpers=!1;var formattedDate=apiInner.getFormattedDateObj(new Date);$scope.models.today=formattedDate.date+" "+formattedDate.month+" "+formattedDate.year+" "+formattedDate.yearTitle;var filter,bookingFiltersParams,result={},params=pguEqueueService.buildParamsAggSlot(this.aggSlotsParams),bookingFilters=api.env("bookingFilters"),organizationId=params.organizationId&&params.organizationId.length?params.organizationId[0]:"";bookingFilters?(bookingFiltersParams=pguEqueueService.buildParamsWithFilters(bookingFilters,organizationId,this.requestBinding),bookingFiltersParams&&bookingFiltersParams.areaId&&bookingFiltersParams.areaId.length&&(params.areaId=bookingFiltersParams.areaId),filter=bookingFiltersParams&&bookingFiltersParams.filter):(bookingFiltersParams=pguEqueueService.buildParamsWithFilters(!1,!1,this.requestBinding),filter=bookingFiltersParams&&bookingFiltersParams.filter),params.attributes=pguEqueueService.buildAttributes(this.aggSlotAttributes),$scope.item.clinicExamMode&&(params.attributes.forEach(function(item){"organizationId"!==item.name&&"MO_Id"!==item.name||(item.value=$scope.item.clinicOrganizationId),"Service_Id"===item.name&&(item.value=$scope.item.clinicServiceId),"Resource_Id"===item.name&&(item.value=$scope.item.clinicResourceId)}),params.organizationId=[$scope.item.clinicOrganizationId],params.serviceId=[$scope.item.clinicServiceId]),$scope.item.routeNumber=$scope.item.routeNumber?$scope.item.routeNumber:pguEqueueService.findParamByName(this.aggSlotsParams,"routeNumber"),filter&&(filter.union||filter.simple)&&(params.filter=filter),$scope.getAggSlotsTimeout&&$timeout.cancel($scope.getAggSlotsTimeout),$scope.getAggSlotsTimeoutQueue=$scope.getAggSlotsTimeoutQueue||[],$scope.getAggSlotsTimeout=$timeout(function(queueLength){pguEqueueService.getAggSlots(params,function(data){if(zagsTypeForBooking="",queueLength===$scope.getAggSlotsTimeoutQueue.length){if($scope.item.isAreaZagsType=!1,$rootScope.env.formParam.ShowOneArea){var tmp=TimeSlotExtExt.filterDataByZagsType(data,$scope.item,api);zagsTypeForBooking=tmp.zagsAddress,$scope.item.isAreaZagsType="AREA"===tmp.type}var error,serverErrorMessage="",errorDetail=data.error&&data.error.errorDetail;if(data.error?(error=errorDetail&&errorDetail.errorCode?errorDetail.errorCode:0,!!errorDetail.errorMessage,0!==(errorDetail&&errorDetail.errorCode)&&(serverErrorMessage=errorDetail.errorMessage)):error=0,$scope.ui.popup.isPhoneHelpers=!!data.slots.length,$scope.item.clinicExamMode?callback():callback&&(callback&&callback.done&&0===error?callback.done(data.slots):callback&&callback.error&&0!==error&&callback.error(data.slots,error),callback&&callback.allways&&callback.allways(data.slots)),self.mapSlots(data.slots,serverErrorMessage,error),$scope.item.clinicExamMode&&api.find($scope.item.clinicWidgetFullPath),$scope.item.filterByHall)if($scope.item.hallDropDown||($scope.item.hallDropDown=api.find($scope.item.fullPath+"_hallDropDown")),$scope.$watch("item.hallDropDown.value()",function(val){if(val){$scope.item.activeHall=val;for(var i=0;i<$scope.item.hallList.length;i++)$scope.item.hallList[i].value==val&&($scope.item.selectedHallTitle=$scope.item.hallList[i].title)}}),prepareData($scope.item.hallsFromSlots),!$scope.item.hallTitleFromAreaId&&$scope.item.hallsFromSlots&&$scope.item.hallsFromSlots.length>1)$scope.item.hallDropDown.element.getList({done:function(data){if($scope.item.hallList=[],data&&data.length){$scope.item.hallDropDown.value(data[0].value),$scope.item.hallDropDown.text_value(data[0].title),$scope.item.hallDropDown.visible(!0),$scope.item.hallDropDown.disabled($scope.item.disabled),$scope.needHideHeader=!1,$scope.item.activeHall=data[0].value,$scope.item.hallList.push(data[0]);for(var i=0;i<$scope.item.hallsFromSlots.length;i++){for(var existing=!1,j=0;j<data.length;j++)if(data[j].value===$scope.item.hallsFromSlots[i].value){existing=!0,data[j].showInHallList=!0;break}if(!existing){var tmpObj={};angular.copy(data[0],tmpObj),tmpObj.value=$scope.item.hallsFromSlots[i].value,tmpObj.title=$scope.item.hallsFromSlots[i].title,tmpObj.showInHallList=!0,data.push(tmpObj)}}for(i=1;i<data.length;i++)data[i].showInHallList&&$scope.item.hallList.push(data[i])}else if($scope.item.hallsFromSlots&&$scope.item.hallsFromSlots.length)for($scope.item.hallDropDown.element.list=[],$scope.item.hallDropDown.value($scope.item.hallsFromSlots[0].value),$scope.item.hallDropDown.text_value($scope.item.hallsFromSlots[0].title),i=0;i<$scope.item.hallsFromSlots.length;i++)$scope.item.hallList.push({title:$scope.item.hallsFromSlots[i].title,value:$scope.item.hallsFromSlots[i].value});$scope.item.hallDropDown.setCustomList($scope.item.hallList,"ASC"),$scope.ui.needShowHeader=!0},error:function(error){if($scope.item.hallsFromSlots&&$scope.item.hallsFromSlots.length){for($scope.item.hallList=[],$scope.item.hallDropDown.element.list=[],$scope.item.hallDropDown.value($scope.item.hallsFromSlots[0].value),$scope.item.hallDropDown.text_value($scope.item.hallsFromSlots[0].title),i=0;i<$scope.item.hallsFromSlots.length;i++)$scope.item.hallList.push({title:$scope.item.hallsFromSlots[i].title,value:$scope.item.hallsFromSlots[i].value});$scope.item.hallDropDown.setCustomList($scope.item.hallList,"ASC"),$scope.ui.needShowHeader=!0}}});else if($scope.item.hallsFromSlots&&1===$scope.item.hallsFromSlots.length){$scope.item.hallList=[],$scope.item.hallDropDown.value($scope.item.hallsFromSlots[0].value),$scope.item.hallDropDown.text_value($scope.item.hallsFromSlots[0].title);for(var i=0;i<data.length;i++)$scope.item.hallList.push($scope.item.hallsFromSlots[i]);$scope.item.selectedHallTitle=$scope.item.hallsFromSlots[0].title,$scope.item.hasOneHall=!0,$scope.item.hallDropDown.visible(!1),$scope.item.hallDropDown.disabled($scope.item.disabled),$scope.needHideHeader=!0,$scope.ui.needShowHeader=!0}else $scope.item.hallTitleFromAreaId&&$scope.item.hallsFromSlots&&$scope.item.hallsFromSlots.length&&($scope.item.hallList=$scope.item.hallsFromSlots.concat(),$scope.item.hallDropDown.value($scope.item.hallsFromSlots[0].value),$scope.item.hallDropDown.text_value($scope.item.hallsFromSlots[0].title),$scope.item.hallDropDown.visible(!0),$scope.item.hasOneHall=!1,$scope.item.hallDropDown.disabled($scope.item.disabled),$scope.needHideHeader=!1,$scope.item.activeHall=$scope.item.hallsFromSlots[0].value,$scope.item.hallDropDown.setCustomList($scope.item.hallList,"ASC"),$scope.ui.needShowHeader=!0)}},function(error){queueLength===$scope.getAggSlotsTimeoutQueue.length&&(result.slots=[],$scope.item.clinicExamMode&&callback(),callback&&callback.error&&0!==error&&callback.error(result.slots,error),$scope.item.errorMessageHeader="Невозможно выбрать время для записи",$scope.item.errorMessageBody="Попробуйте записаться позднее или выбрать другое подразделение для записи.",self.mapSlots(result.slots,!0))})},0,!1,$scope.getAggSlotsTimeoutQueue.push($scope.getAggSlotsTimeout))}}function prepareGibddSlots(data,year,month,date){var slots=[];return data.forEach(function(item,i){var slot={visitTimeFromIso:item.title,year:year,month:month,day:date,value:item.value};slots.push(slot)}),slots}function prepareData(data){data.forEach(function(elem,ind){elem.title=elem.title||($scope.item.hallTitleFromAreaId?"":$scope.item.hallName+" ")+elem.value})}function mapSlots(slots,serverError,errorCode){if($scope.item.hallsFromSlots=[],this.slotsCollection=[],this.calendarMonths=[],slots.length){var firstItemIsoDate=slots.length?pguEqueueService.parseISODateFormat(slots[0].visitTimeStr):[],minuteOffsetFromTorm=0;firstItemIsoDate.length&&"Z"!==firstItemIsoDate[8]&&void 0!==firstItemIsoDate[9]&&(minuteOffsetFromTorm=60*firstItemIsoDate[10]+parseInt(firstItemIsoDate[11],10),"+"===firstItemIsoDate[9]&&(minuteOffsetFromTorm=0-minuteOffsetFromTorm)),0===minuteOffsetFromTorm&&"Z"!==firstItemIsoDate[8]&&!0;var today=new Date;today.setHours(0,0,0,0);var localTimeZone=today.getTimezoneOffset(),utcTime=today.getTime()+60*localTimeZone*1e3,todayMidnight=utcTime+864e5;slots.sort(function(a,b){return a.visitTimeStr>b.visitTimeStr?1:a.visitTimeStr<b.visitTimeStr?-1:0});var data=pguEqueueService.createDataFromSlots(this.fullPath,slots,utcTime,todayMidnight,$scope.item.isEnabledDuration,$scope.item.filterByHall);for(var key in data.hallsFromSlots)data.hallsFromSlots.hasOwnProperty(key)&&$scope.item.hallsFromSlots.push(data.hallsFromSlots[key]);this.intervalBinding&&(data.listDay=pguEqueueService.setIntervalsBindings(data.listDay,this.intervalBinding)),this.createSlots(data)}else serverError?202===errorCode?($scope.item.errorMessageHeader="У вас уже есть запись на прием",$scope.item.errorMessageBody="Повторная запись на прием будет доступна после завершения приема или отмены записи в данном подразделении. Либо вы можете выбрать другое подразделение для записи."):3001===errorCode?($scope.item.errorMessageHeader=TIME_SLOT_ERRORS[errorCode].title,$scope.item.errorMessageBody=TIME_SLOT_ERRORS[errorCode].message):($scope.item.errorMessageHeader="Невозможно выбрать время для записи",$scope.item.errorMessageBody=serverError||"Попробуйте записаться позднее или выбрать другое подразделение для записи."):($scope.item.errorMessageHeader="Нет свободного времени для записи в выбранном подразделении",$scope.item.errorMessageBody="Попробуйте выбрать другое подходящее подразделение."),this.slotsCollection=[],this.calendarMonths=[],$scope.models.isLoading=!1;$scope.models.isEmpty=!slots.length}function createSlots(data){var monthName=["января","февраля","марта","апреля","мая","июня","июля","августа","сентября","октября","ноября","декабря"],self=this;self.monthIndex=0,self.months=[];var messageAboutService,firstMonth=data.months[0],lastMonth=data.months[data.months.length-1];firstMonth.needGenerateFullMonth=!0,firstMonth.needGeneratePreviousDays=!0,firstMonth.needGenerateWeekDays=!0,lastMonth.needGenerateFullMonth=!0,messageAboutService=firstMonth.days[0].year!==lastMonth.days[lastMonth.days.length-1].year?"Запись открыта с "+firstMonth.days[0].day+" "+monthName[firstMonth.days[0].month-1]+" "+firstMonth.days[0].year+" года по "+lastMonth.days[lastMonth.days.length-1].day+" "+monthName[lastMonth.days[lastMonth.days.length-1].month-1]+" "+lastMonth.days[lastMonth.days.length-1].year+" года":"Запись открыта с "+firstMonth.days[0].day+" "+monthName[firstMonth.days[0].month-1]+" по "+lastMonth.days[lastMonth.days.length-1].day+" "+monthName[lastMonth.days[lastMonth.days.length-1].month-1],$scope.item.messageAboutService=messageAboutService,self.calendarMonths||(self.calendarMonths=[]),data.months.forEach(function(month,ind){month.weeks=pguEqueueService.generateMonthStructure(month).weeks.concat(),self.months.push(month)}),1==self.months.length&&($scope.item.lastMonth=!0),self.calendarMonths.push(self.months[self.monthIndex]),self.slotsCollection?(self.slotsCollection.length=0,self.slotsCollection=data.listDay):self.slotsCollection=data.listDay,$scope.item.clinicExamDay=self.slotsCollection[0],self.clinicExamMode&&self.months&&self.months.length&&self.months[0].days.length&&self.months[0].days.length&&(self.months[0].days[0].active=!0),$scope.models.isLoading=!1,$rootScope.settings.mobOptimizeEqueue&&self.slotsCollection.forEach(function(day,index){index>9&&(day.hide=!0)})}function aggBook(evt){evt&&(evt.preventDefault(),evt.stopPropagation());var fullRequest,self=this,params=pguEqueueService.buildParamsAggBook(this.slotParams);if("true"!=$rootScope.env.formParam.aggBookMetric||$rootScope.vaccineForm)$rootScope.vaccineForm&&api.sendReachGoal("book_vaccine",{vaccine:{success:["book"]}},24845174);else{var passportId=$routeParams.passportId?$routeParams.passportId:"",targetId=$routeParams.targetId?$routeParams.targetId:"",goal="book"+passportId+targetId;api.sendReachGoal(goal)}if(1==PGU.medExamData.needMedParams){var medParams=[];if($rootScope.user){if($rootScope.user.fullName&&medParams.push({name:"pacientname",value:$rootScope.user.fullName}),$rootScope.user.gender){var genders={F:"Женский",M:"Мужской"};medParams.push({name:"genderperson",value:genders[$rootScope.user.gender]})}if($rootScope.user.birthDate){var userAge=$moment().diff($moment($rootScope.user.birthDate,"DD.MM.YYYY"),"years");medParams.push({name:"ageperson",value:userAge})}}var medSlotParams=PGU.medExamData.medObject;medSlotParams.resourceId&&medParams.push({name:"doctorid",value:medSlotParams.resourceId}),medSlotParams.resourceName&&medParams.push({name:"doctorname",value:medSlotParams.resourceName}),medSlotParams.room&&medParams.push({name:"room",value:medSlotParams.room}),params.params=medParams}if(this.aggBookSlotParams&&this.aggBookSlotParams.length&&(params.params=pguEqueueService.buildAttributes(this.aggBookSlotParams)),!this.selectedHallTitle||!$rootScope.env.formParam.ShowOneArea&&this.hasOneHall||(params.selectedHallTitle=this.selectedHallTitle),params.attributes=pguEqueueService.buildAttributes(this.slotAttributes),$scope.item.clinicExamMode&&(params.attributes.forEach(function(item){"MO_Id"===item.name&&(item.value=$scope.item.clinicOrganizationId),"Service_Id"===item.name&&(item.value=$scope.item.clinicServiceId),"Resource_Id"===item.name&&(item.value=$scope.item.clinicResourceId),"Slot_DateTime"===item.name&&(item.value=$moment.parseZone($scope.item.recommendedSlotDateTime).format("YYYY-MM-DDTHH:mm:ssZ"))}),params.address=$scope.item.address,params.organizationId=$scope.item.clinicOrganizationId,params.calendarName=$scope.item.calendarName,params.subject=$scope.item.calendarName,params.orgName=$scope.item.orgName,params.serviceId=[$scope.item.clinicServiceId]),PGU.timeSlotData.orgName=$scope.item.orgName,PGU.timeSlotData.orgAddress=$scope.item.orgAddress,PGU.timeSlotData.selectedHallTitle=$scope.item.selectedHallTitle,PGU.timeSlotData.comment=$scope.item.comment||"Забронировано",$scope.item.currentSlot){var cs=$scope.item.currentSlot,dateFromISO=pguEqueueService.parseISODateFormat(cs.visitTimeStr?cs.visitTimeStr:cs.value);if(dateFromISO&&dateFromISO.length){var date=new Date(dateFromISO[1],dateFromISO[2]-1,dateFromISO[3]),fDate=apiInner.getFormattedDateObj(date);PGU.timeSlotData.visitTime=fDate.date+" "+fDate.month+" "+fDate.year+", "+fDate.day+", "+dateFromISO[4]+":"+dateFromISO[5]}}var slotIs=angular.isArray(self.currentSlot.slotId)?self.currentSlot.slotId:[self.currentSlot.slotId],ids={slotId:slotIs||["blind_request"],bookId:self.bookIdFromSearch||self.value||uuid.v4()};if(self.bookId=self.bookId?self.bookId:ids.bookId,fullRequest=this.getBookIdFromParams?angular.extend(ids,params):angular.extend(params,ids),self.hallDropDown&&self.hallList&&self.hallList.length>1&&(fullRequest.selectedHallTitle=self.selectedHallTitle),zagsTypeForBooking&&(fullRequest.hallAddress=$scope.item.orgAddress,fullRequest.address=zagsTypeForBooking),$scope.ui.popup.isLoading=!0,$scope.item.saveBookIdToDraft&&!$scope.item.datePickerMode&&($scope.ui.buttons.btnCancelChanges.visible=!1),$scope.item.datePickerMode)$scope.ui.popup.isLoading=!1,$scope.ui.closeDialog(),$scope.item.value=self.currentSlot.value,$scope.item.isSlotChosen=!0,$scope.item.error="",$scope.isPhone&&($scope.toggleVisibleField(!1,"Region"),$scope.toggleVisibleField(!1,"Org")),$scope.ui.oldTitle=$scope.item.title,$scope.item.title="",$scope.ui.buttons.btnBookingChange.visible=!$scope.item.bookingChangeBtnIsHide,$scope.ui.fetched=!1;else{var startSendForm=(new Date).getTime();pguEqueueService.aggBook(fullRequest,function(data){if(data.error&&0!==data.error.code){$scope.ui.popup.isLoading=!1,$rootScope.vaccineForm&&(api.sendReachGoal("book_vaccine",{vaccine:{error:["book"]}},24845174),$rootScope.$emit("HEALTH_SEND",{event:"formBook",timing:(new Date).getTime()-startSendForm,result:1,ServiceError:data.error&&data.error.errorDetail?data.error.errorDetail.errorCode:""}));202===(data.error.errorDetail&&data.error.errorDetail.errorCode?data.error.errorDetail.errorCode:-1)?($scope.ui.popup.errorTitle=$scope.item.errorMessageHeader="У вас уже есть запись на прием",$scope.ui.popup.error=$scope.item.errorMessageBody="Повторная запись на прием будет доступна после завершения приема или отмены записи в данном подразделении. Либо вы можете выбрать другое подразделение для записи.",$scope.models.isEmpty=!0,$scope.ui.closeCalendar(),$scope.ui.popup.isPhoneHelpers=!1):($scope.ui.popup.errorTitle="Невозможно сохранить время записи",$scope.ui.popup.error=data.error.errorDetail&&data.error.errorDetail.errorMessage||"Выберите другую дату и время или другое подразделение.")}else{api.find();$scope.ui.popup.doneAndStayInQueue=!0;var currentStep=api.getVisibleSteps()[api.step()].step;if($scope.item.clinicExamMode)$scope.ui.closeDialog(),$("body").removeClass("PGU-SF-Dialog-Show"),api.find($scope.item.clinicWidgetFullPath).element.handleBooking(data),$scope.item.value=data.bookId,$rootScope.$emit("HEALTH_SEND",{event:"logElForm",timing:0,result:4,el:$scope.item.fullPath,order_id:api.env("orderId")});else if($scope.item.saveBookIdToDraft)$scope.item.value||($scope.item.value=data.bookId||self.bookId),$scope.item.orgAddressZags=zagsTypeForBooking,$scope.item.comment="Забронировано",data.timeSlot&&data.timeSlot.attributes&&data.timeSlot.attributes.forEach(function(item){$scope.item[item.name]=item.value}),$scope.ui.buttons.btnShowFullStep.visible=!1,$scope.ui.buttons.btnBookingChange.visible=!$scope.item.bookingChangeBtnIsHide,$scope.ui.buttons.btnCancelBooking.visible=!$scope.item.bookingCancelBtnIsHide,$scope.ui.buttons.btnCancelChanges.visible=!1,$scope.ui.needShowHeader=!0,$scope.ui.showInfo=!0,$scope.ui.toggleState("Reserved"),$scope.ui.saveBookIdMode.showChart=!0,$scope.ui.popup.isPhoneHelpers=!1,$scope.isPhone&&($scope.ui.showCalendar=!1),$scope.ui.saveBookIdMode.preReservationPeriod=0,$scope.ui.closeDialog(),$scope.ui.setPreReservTimer(),"true"===$rootScope.env.formParam.isLogElForm&&$rootScope.$emit("HEALTH_SEND",{event:"logElForm",timing:0,result:4,el:$scope.item.fullPath,order_id:api.env("orderId")}),PGU.Events.publish(":updateChart",{}),"true"===api.env("formParam").isSaveElDraft?api.uploadDraft(!1,null,null,!1,$scope.item):api.find(currentStep.fullPath).submit("submit",0,{},{},!0,!1),$scope.ui.popup.isLoading=!1;else{var redirectId=data.bookId||self.bookId;$rootScope.settings.isOnlineCustom?api.__getSuggestsForDraft().then(function(){api.shade(!1),$window.location.href=(api.env("lkUrl")||"https://lk.gosuslugi.ru/")+"notifications/details/EQUEUE/"+redirectId}):"true"===api.env("formParam").isSaveElDraft?api.uploadDraft(!1,function(data){api.shade(!1),$window.location.href=(api.env("lkUrl")||"https://lk.gosuslugi.ru/")+"notifications/details/EQUEUE/"+redirectId},function(error){api.shade(!1)},!1,$scope.item):api.find(currentStep.fullPath).submit("submit",0,{done:function(){api.shade(!1),$window.location.href=(api.env("lkUrl")||"https://lk.gosuslugi.ru/")+"notifications/details/EQUEUE/"+redirectId},error:function(error){api.shade(!1)}},!1,!0,!1)}$rootScope.vaccineForm&&$rootScope.$emit("HEALTH_SEND",{event:"formBook",timing:(new Date).getTime()-startSendForm,result:0})}},function(error){$rootScope.vaccineForm&&(api.sendReachGoal("book_vaccine",{vaccine:{error:["book"]}},24845174),$rootScope.$emit("HEALTH_SEND",{event:"formBook",timing:(new Date).getTime()-startSendForm,result:1,BrowserError:error&&error.status?error.status:""})),$scope.ui.popup.isLoading=!1,$scope.ui.popup.errorTitle="Невозможно сохранить время записи",$scope.ui.popup.error="Выберите другую дату и время или другое подразделение."})}}function clearActiveDays(){$scope.item.calendarMonths[0].days.forEach(function(day){day.active=$scope.item.clinicExamDay.day===day.day&&$scope.item.clinicExamDay.month===day.month&&$scope.item.clinicExamDay.year===day.year})}function showNextMonth(){var self=this;self.monthIndex<self.months.length-1&&(self.calendarMonths=[],self.calendarMonths.push(self.months[++self.monthIndex]),$scope.item.lastMonth=!1,$scope.item.firstMonth=!1,$scope.item.clinicExamMode&&clearActiveDays(self.calendarMonths)),self.monthIndex==self.months.length-1&&($scope.item.lastMonth=!0)}function showPrevMonth(){var self=this;self.monthIndex>0&&(self.calendarMonths=[],self.calendarMonths.push(self.months[--self.monthIndex]),$scope.item.firstMonth=!1,$scope.item.lastMonth=!1,$scope.item.clinicExamMode&&clearActiveDays()),0==self.monthIndex&&($scope.item.firstMonth=!0)}function gotToCalendar(){$("html, body").animate({scrollTop:$element.find(".js-PGU-TimeSlotExtSlotsWrap").offset().top-50},0)}function returnToCalendarOnPad(){$scope.item.clearAllDays.call($scope.item),$scope.item.dayIsClicked=!$scope.item.dayIsClicked,$("html, body").animate({scrollTop:$element.find(".js-PGU-TimeSlotExt-CalendarWrap").offset().top-50},800)}function hasSlotsThisDay(slots){for(var timeToExit=!1,ind=0;ind<slots.length;ind++)if(slots[ind].areaId&&slots[ind].areaId==$scope.item.activeHall){timeToExit=!0;break}return timeToExit}$scope.models={},$scope.item.currentSlot={};var zagsTypeForBooking="";$scope.item.getList=getList,$scope.item.mapSlots=mapSlots,$scope.item.createSlots=createSlots,$scope.item.aggBook=aggBook,$scope.item.showNextMonth=showNextMonth,$scope.item.showPrevMonth=showPrevMonth,$scope.item.gotToCalendar=gotToCalendar,$scope.item.returnToCalendarOnPad=returnToCalendarOnPad,$scope.item.opened=!1,$scope.openSlots=function(day){day.opened=!day.opened},$scope.item.changeActiveHall=function(val){if(this.calendarMonths&&this.calendarMonths.length){for(var m=0,ml=this.calendarMonths.length;m<ml;m++)for(var weeks=this.calendarMonths[m].weeks,w=0,wl=weeks.length;w<wl;w++)for(var week=weeks[w],d=0,dl=week.days.length;d<dl;d++)week.days[d].active=!1;val&&$scope.item.hallDropDown.value(val)}},$scope.item.hasSlotsThisDay=hasSlotsThisDay}],scope:{item:"="},link:function(scope,element,attrs){function clearAllDays(){for(var weeks,week,dayWithSlots,m=0,ml=this.calendarMonths.length;m<ml;m++){weeks=this.calendarMonths[m].weeks;for(var w=0,wl=weeks.length;w<wl;w++){week=weeks[w];for(var d=0,dl=week.days.length;d<dl;d++)week.days[d].active=!1}}for(var sd=0,sdl=this.slotsCollection.length;sd<sdl;sd++)dayWithSlots=this.slotsCollection[sd],dayWithSlots.active=!1}function scrollToDayWithSlots(event,day){if(event.stopPropagation(),day.slots&&!day.slots.length)return this;for(var weeks,week,dayWithSlots,dayId=this.fullPath+":"+day.date.getTime(),$day=element.find(document.getElementById(dayId)),m=0,ml=this.calendarMonths.length;m<ml;m++){weeks=this.calendarMonths[m].weeks;for(var w=0,wl=weeks.length;w<wl;w++){week=weeks[w];for(var d=0,dl=week.days.length;d<dl;d++)week.days[d].active=!1}}for(var sd=0,sdl=this.slotsCollection.length;sd<sdl;sd++)dayWithSlots=this.slotsCollection[sd],dayWithSlots.active=dayWithSlots.dayId===dayId,dayWithSlots.active&&(scope.item.clinicExamDay=dayWithSlots);day.active=!0,scope.isPhone?scope.item.clinicExamMode||(scope.ui.toggleCalendarMode=!!$rootScope.settings.mobOptimize,scope.item.$calendarElement=element.find(".PGU-TimeSlotExtPhone-Content"),api.applyScope(),$timeout(function(){$day=element.find(document.getElementById(dayId)),
scope.item.$calendarElement.scrollTo(0,$day.offset().top-scope.item.$calendarElement.offset().top-50,500)},0)):(scope.isTablet&&!scope.item.clinicExamMode&&(scope.item.$calendarElement=element.find(".js-PGU-TimeSlotExt-Calendar"),scope.item.dayIsClicked=!0,scope.item.isUnderTopLine=!0),scope.item.clinicExamMode||$timeout(function(){api.checkOpIframeScroll($day,function(){$("html, body").animate({scrollTop:$day.offset().top-scope.item.$calendarElement.height()-150},800)})}))}function showActiveDayInCalendar(event,dayId,over){event.stopPropagation();for(var weeks,week,dayWithSlots,m=0,ml=this.calendarMonths.length;m<ml;m++){weeks=this.calendarMonths[m].weeks;for(var w=0,wl=weeks.length;w<wl;w++){week=weeks[w];for(var d=0,dl=week.days.length;d<dl;d++)week.days[d].date&&(week.days[d].active=!over&&this.fullPath+":"+week.days[d].date.getTime()===dayId)}}if(!scope.isDesktop)for(var sd=0,sdl=this.slotsCollection.length;sd<sdl;sd++)dayWithSlots=this.slotsCollection[sd],dayWithSlots.active=dayWithSlots.dayId===dayId}var watchers;scope.$on("suspend",function(){watchers=scope.$$watchers,scope.$$watchers=[]}),scope.$on("resume",function(){scope.$$watchers=watchers,watchers=null}),$rootScope.settings.mobOptimizeEqueue&&(scope.item.hint=scope.item.html),scope.$watch("item.error",function(value,oldValue){value?"Поле обязательно для заполнения"===value&&(scope.item.error="Необходимо выбрать время записи"):scope.item.error=""}),scope.item.datePickerMode,scope.isPhone=device.mobile()||$rootScope.settings.tabletLikePhone,scope.isTablet=device.tablet()&&!$rootScope.settings.tabletLikePhone,scope.isDesktop=device.desktop(),scope.item.items=[],scope.item.firstMonth=!0,scope.ui={},scope.ui.fetched=!1,scope.ui.hasPayment=!1,scope.ui.isSticky=!1,scope.ui.state="content",scope.ui.toggleCalendarMode=!0,scope.ui.needShowHeader=!scope.item.saveBookIdToDraft,scope.ui.popup={isLoading:!1,error:"",isPhoneHelpers:!1},scope.item.datePickerMode&&(scope.item.attrs.value["scope:sync"]=!0),scope.ui.toggleState=function(state){scope.isPhone&&"Reserved"!==state&&""!==state&&(scope.ui.showCalendar=!0,$rootScope.settings.mobOptimizeEqueue&&(scope.ui.popupElement=scope.ui.popupElement||element.find(".PGU-TimeSlotExtPhone-Content"),scope.ui.popupElement.on("scroll",function(){var top=scope.ui.popupElement.scrollTop(),oldVal=scope.ui.scrollToTopBtn;scope.ui.scrollToTopBtn=top>300,void 0!==oldVal&&oldVal!=scope.ui.scrollToTopBtn&&scope.$apply()})),$("body").addClass("PGU-SF-Dialog-Show")),scope.item.changeActiveHall();var actionsState=!("Reserved"==state||"Change"==state);scope.toggleVisibleField(actionsState,"Region"),scope.toggleVisibleField(actionsState,"Org"),scope.ui.saveBookIdMode.actionsState=state},scope.ui.closeCalendar=function(evt){evt&&evt.preventDefault(),$("body").removeClass("PGU-SF-Dialog-Show"),scope.ui.toggleCalendarMode=!0,scope.ui.showCalendar=!1},scope.toggleVisibleField=function(visible,type){var regionField,attr="pathTo"+type+"Field",fullPath=scope.item[attr];fullPath&&(regionField=api.find(fullPath))&&regionField.visible(visible)},scope.ui.saveBookIdMode={needUpdateInfo:!1,actionsState:"",showChart:!1,showComment:!1,showStartDate:!1,preReservationPeriod:0},scope.ui.setPreReservTimer=function(canceled){if(scope.ui.saveBookIdMode.theArc){if(canceled)return scope.ui.saveBookIdMode.preReservationPeriod=0,scope.ui.updateChart(scope.ui.saveBookIdMode.preReservationPeriod,1,0),void clearInterval(scope.ui.saveBookIdMode.interval);scope.ui.saveBookIdMode.preReservationPeriod=scope.ui.saveBookIdMode.preReservationPeriod||scope.item.preliminaryReservationPeriod,scope.ui.saveBookIdMode.timerCounter=1,clearInterval(scope.ui.saveBookIdMode.interval),scope.ui.updateChart(scope.ui.saveBookIdMode.preReservationPeriod,scope.ui.saveBookIdMode.timerCounter,scope.ui.saveBookIdMode.preReservationPeriod-scope.ui.saveBookIdMode.timerCounter),scope.ui.saveBookIdMode.interval=setInterval(function(){scope.ui.saveBookIdMode.timerCounter++;var diff=scope.ui.saveBookIdMode.preReservationPeriod-scope.ui.saveBookIdMode.timerCounter;diff<0?scope.item.checkInvitation():scope.ui.updateChart(scope.ui.saveBookIdMode.preReservationPeriod,scope.ui.saveBookIdMode.timerCounter,diff)},6e4)}},scope.item.checkInvitation=function(){if(scope.item.isAreaZagsType=!1,PGU.fireEvents.formRendered){var boo=!!scope.item.value;return TimeSlotExtExt.checkTimeSlotInvitation(!boo,boo||void 0,scope.item.fullPath,scope.ui,scope.item,scope.models,pguEqueueService,apiInner,api)}PGU.Events.subscribe("","formRendered",function(){var boo=!!scope.item.value;return TimeSlotExtExt.checkTimeSlotInvitation(!boo,boo||void 0,scope.item.fullPath,scope.ui,scope.item,scope.models,pguEqueueService,apiInner,api)})},scope.ui.clearBooking=function(canceled){for(var attrs=["comment","orgName","orgAddress","startDate","value","error","pincode","window","orgAddressZags"],i=0,il=attrs.length;i<il;i++)scope.item.hasOwnProperty(i)&&(scope.item[i]="");scope.ui.showInfo=!1,scope.ui.saveBookIdMode.showChart=!1,scope.item.comment="",canceled?(scope.item.preReservationCanceledMsg=scope.item.preliminaryReservationCanceledText,scope.ui.toggleState("Canceled")):scope.ui.toggleState(""),scope.item.hallDropDown&&(scope.item.hallDropDown.value(scope.item.hallList.length?scope.item.hallList[0].value:scope.item.hallDropDown.value()),scope.item.hallDropDown.disabled(!1)),scope.ui.needShowHeader=!scope.item.saveBookIdToDraft,scope.item.value="",scope.ui.buttons.btnShowFullStep.visible=!1,scope.ui.buttons.btnBookingChange.visible=!1,scope.ui.buttons.btnCancelBooking.visible=!1,scope.ui.buttons.btnCancelChanges.visible=!1,scope.item.getList(),scope.ui.setPreReservTimer(!0)},scope.ui.isChartCreated=!1,scope.ui.createChart=function(){var self=this;scope.isPhone?element.find(".js-PGU-Chart-Area-Phone"):element.find(".js-PGU-Chart-Area");!function(total,goal,avg){self.saveBookIdMode.paper=null,self.saveBookIdMode.paper=Raphael(scope.item.fullPath+":canvas",130,130),self.saveBookIdMode.paper.customAttributes.arc=function(xloc,yloc,value,total,R){var path,alpha=360/total*value,a=(90-alpha)*Math.PI/180,x=xloc+R*Math.cos(a),y=yloc-R*Math.sin(a);return path=total==value?[["M",xloc,yloc-R],["A",R,R,0,1,1,xloc-.01,yloc-R]]:[["M",xloc,yloc-R],["A",R,R,0,+(alpha>180),1,x,y]],{path:path}},self.saveBookIdMode.backCircle=self.saveBookIdMode.paper.circle(65,65,55).attr({stroke:"#2cc846","stroke-width":4}),self.saveBookIdMode.theArc=self.saveBookIdMode.paper.path().attr({stroke:"#ebebed","stroke-width":4,arc:[65,65,0,100,55]});var timeStr=pguEqueueService.mapTimeToStr(self.saveBookIdMode.preReservationPeriod);self.saveBookIdMode.timeStr=self.saveBookIdMode.paper.text(65,65,timeStr).attr({"font-size":16,fill:"#000","font-family":"ekibastuz","font-weight":600}),self.saveBookIdMode.paper.renderfix()}(),scope.ui.isChartCreated=!0,self.saveBookIdMode.preReservationPeriod||self.setPreReservTimer()},scope.ui.addMoreSlots=function(){for(var i=0;i<scope.item.slotsCollection.length;i++){if(scope.item.slotsCollection[i-1]&&scope.item.slotsCollection[i-1].show&&!scope.item.slotsCollection[i].show)var begin=i,end=end||i+10;i>=begin&&i<end?(scope.item.slotsCollection[i].show=!0,end==scope.item.slotsCollection.length-1&&(scope.ui.hideAddSlots=!0)):begin=end=void 0}},$rootScope.settings.mobOptimizeEqueue&&(scope.slotsCount=10,scope.ui.addMoreSlots=function(){scope.slotsCount=scope.slotsCount+10;for(var i=0;i<scope.slotsCount;i++)scope.item.slotsCollection[i].hide=!1;scope.slotsCount>=scope.item.slotsCollection.length&&(scope.ui.hideAddSlots=!0)},scope.ui.scrollToTop=function($event){scope.ui.popupElement.scrollTop(0)}),scope.ui.updateChart=function(period,data,diff){if(data>0){var color,self=this;color=diff>0&&diff<=5?"#e05050":diff>5&&diff<=15?"#ffc300":diff>15?"#2cc846":"#ebebed";var timeStr=pguEqueueService.mapTimeToStr(diff);0==+period?self.saveBookIdMode.theArc.attr("arc",[65,65,0,100,55]):self.saveBookIdMode.theArc.rotate(0,100,100).animate({arc:[65,65,data/period*100,100,55]},1e3),self.saveBookIdMode.timeStr.attr("text",timeStr),color&&self.saveBookIdMode.backCircle.attr("stroke",color)}},scope.ui.showFullStep=function(){scope.item.preReservationCanceledMsg="",scope.ui.saveBookIdMode.needUpdateInfo=!0,scope.item.getList()},scope.ui.bookingChange=function(clickAttrs,event){if(scope.item.datePickerMode)event.preventDefault(),scope.ui.fetched=!1,scope.item.isSlotChosen=!1,scope.item.value="",scope.item.title=scope.ui.oldTitle,scope.isPhone&&(scope.toggleVisibleField(!0,"Region"),scope.toggleVisibleField(!0,"Org"));else{var orgName=scope.item.orgName,orgAddress=scope.item.orgAddress,selectedHallTitle=scope.item.selectedHallTitle,comment=scope.item.comment,pincode=scope.item.pincode,window=scope.item.window;scope.item.error="",scope.ui.showInfo=!1,scope.ui.saveBookIdMode.showChart=!1,scope.ui.buttons.btnCancelChanges.visible=!0,scope.ui.buttons.btnShowFullStep.visible=!1,scope.ui.buttons.btnBookingChange.visible=!1,scope.ui.buttons.btnCancelBooking.visible=!1,scope.ui.needShowHeader=!0,scope.ui.toggleState("Change"),scope.ui.saveBookIdMode.prevOrgName=orgName,scope.ui.saveBookIdMode.prevOrgAddress=orgAddress,scope.ui.saveBookIdMode.prevSelectedHallTitle=selectedHallTitle,scope.ui.saveBookIdMode.prevComment=comment,scope.ui.saveBookIdMode.prevPincode=pincode,scope.ui.saveBookIdMode.prevWindow=window,scope.ui.saveBookIdMode.showStartDate=!1,scope.ui.saveBookIdMode.showComment=!1,scope.item.hallDropDown&&scope.item.hallDropDown.disabled(!1)}scope.item.getList()},scope.ui.cancelBooking=function(){scope.models.isLoading=!0,scope.ui.saveBookIdMode.showChart=!1,scope.item.error="";var data={eserviceId:scope.item.eqServiceId,bookId:scope.item.value,userSelectedRegion:api.env("userSelectedRegion")};""!=scope.item.routeNumber&&(data.routeNumber=scope.item.routeNumber);var success=function(data){if(data&&data.status&&[301,302,303].indexOf(data.status.statusCode)>-1){scope.ui.clearBooking();api.stepList()[api.step()];$rootScope.settings.isOnlineCustom||api.env("autosaveDisabled")||api.uploadDraft(!1,null,null,!1,scope.item)}else scope.item.error="Во время отмены бронирования произошла ошибка. Пожалуйста, повторите попытку позже.";scope.models.isLoading=!1},error=function(error){scope.item.error="Во время отмены бронирования произошла ошибка. Пожалуйста, повторите попытку позже.",scope.models.isLoading=!1};pguEqueueService.cancelBooking(data,success,error)},scope.ui.cancelChanges=function(){var orgName=scope.ui.saveBookIdMode.prevOrgName,orgAddress=scope.ui.saveBookIdMode.prevOrgAddress,selectedHallTitle=scope.ui.saveBookIdMode.prevSelectedHallTitle,comment=scope.ui.saveBookIdMode.prevComment,pincode=scope.ui.saveBookIdMode.prevPincode,window=scope.ui.saveBookIdMode.prevWindow;scope.ui.showInfo=!0,scope.ui.popup.isPhoneHelpers=!1,scope.ui.toggleState("Reserved"),scope.ui.buttons.btnShowFullStep.visible=!1,scope.ui.buttons.btnBookingChange.visible=!scope.item.bookingChangeBtnIsHide,scope.ui.buttons.btnCancelBooking.visible=!scope.item.bookingCancelBtnIsHide,scope.ui.buttons.btnCancelChanges.visible=!1,scope.ui.saveBookIdMode.showChart=!0,scope.item.orgName=orgName,scope.item.orgAddress=orgAddress,scope.item.selectedHallTitle=selectedHallTitle,scope.item.comment=comment,scope.item.pincode=pincode,scope.item.window=window,$timeout(function(){PGU.Events.publish(":updateChart",{})})};var systemData=$rootScope.env.systemData||{},notNeedCheck=systemData.signCnt&&+systemData.signCnt>1&&"false"===systemData.isOwner&&"true"===systemData.editAnotherUser;if(!scope.item.value||scope.item.datePickerMode||scope.item.clinicExamMode||notNeedCheck||scope.item.checkInvitation(),scope.item.saveBookIdToDraft&&!scope.item.datePickerMode?(scope.item.attrs.value["scope:sync"]=!0,scope.ui.buttons={btnShowFullStep:{btnColor:"white",label:scope.item.showFullStepText,fullPath:scope.item.fullPath?scope.item.fullPath+"_btnShowFullStep":"_btnShowFullStep",floating:"PGU-BtnFloat",buttonSize:"small",visible:!1},btnBookingChange:{btnColor:"white",label:scope.item.bookingChangeBtnText,fullPath:scope.item.fullPath?scope.item.fullPath+"_btnBookingChange":"_btnBookingChange",floating:"PGU-BtnFloat",buttonSize:"small",visible:!1},btnCancelBooking:{btnColor:"white",label:scope.item.bookingCancelBtnText,fullPath:scope.item.fullPath?scope.item.fullPath+"_btnCancelBooking":"_btnCancelBooking",floating:"PGU-BtnFloat",buttonSize:"small",visible:!1},btnCancelChanges:{btnColor:"white",label:scope.item.cancelChangesText,fullPath:scope.item.fullPath?scope.item.fullPath+"_btnCancelChanges":"_btnCancelChanges",floating:"PGU-BtnFloat",buttonSize:"small",visible:!1},btnToggleState:{btnColor:"blue",label:"Выбрать время",fullPath:scope.item.fullPath?scope.item.fullPath+"_btnToggleState":"_btnToggleState",floating:"PGU-BtnFloat",buttonSize:"small",visible:!0}}):scope.ui.buttons={btnToggleState:{btnColor:"blue",label:"Выбрать время",fullPath:scope.item.fullPath?scope.item.fullPath+"_btnToggleState":"_btnToggleState",floating:"PGU-BtnFloat",buttonSize:"small",visible:!0}},scope.item.datePickerMode){scope.ui.buttons={btnBookingChange:{btnColor:"white",label:scope.item.bookingChangeBtnText,fullPath:scope.item.fullPath?scope.item.fullPath+"_btnBookingChange":"_btnBookingChange",floating:"PGU-BtnFloat",buttonSize:"small",visible:!1},btnToggleState:{btnColor:"blue",label:"Выбрать время",fullPath:scope.item.fullPath?scope.item.fullPath+"_btnToggleState":"_btnToggleState",floating:"PGU-BtnFloat",buttonSize:"small",visible:!1}},scope.item.items=[{className:"FieldTextDate",name:"TimeSlotFieldTextDate",fullPath:scope.item.fullPath+".FieldTextDate",required:!0,label:"Выберите дату посещения",limits:">||||"+scope.item.pathToCurrentDateField,year:"",month:"",date:"",hours:"",minutes:"",second:"",timezone:"",timestamp:"",format:"",submitEvents:{},doNotSaveDraft:!0,disabled:scope.item.disabled}],api.initAttrs(scope.item.items),scope.$watch("item.disabled",function(value,oldValue){"undefined"!==value&&value!==oldValue&&api.find(scope.item.fullPath+".FieldTextDate").disabled(value)}),scope.item.toggleSlotsOff=function(){scope.ui.fetched=!1,scope.item.items[0].error="",scope.item.isSlotChosen=!1,scope.item.value="",scope.item.title=scope.ui.oldTitle,scope.models.isEmpty=!1};var timeSlotDatePicker=api.find(scope.item.fullPath+".FieldTextDate");scope.$watch("item.items[0].value",function(val){timeSlotDatePicker.validate()?(scope.item.items[0].error="",scope.item.getList()):scope.item.toggleSlotsOff(),scope.item.error=""}),scope.item.dictionary.initRequest=!1,scope.item._gibddItems=[];var gibddSlotObj={className:"FieldDropdown",name:"GibddDropdown",label:"",selectType:"FieldDropdownExt",visible:!1,required:!1,fullPath:scope.item.fullPath?scope.item.fullPath+"._gibddDropdown":"._gibddDropdown",availableForHide:!1,dictionary:scope.item.dictionary,withoutCache:!0,getFullResult:!0};scope.item._gibddItems.push(gibddSlotObj),api.initAttrs(scope.item._gibddItems),scope.$emit(scope.item.fullPath+":ScopeApplied",{scope:scope,element:element}),scope.item.isScopeAppliedDone={scope:scope,element:element}}scope.ui.showDialog=function(slot){var date=new Date(slot.year,slot.month-1,slot.day),fDate=apiInner.getFormattedDateObj(date);scope.ui.popup.errorTitle="",scope.ui.popup.error="",scope.ui.popup.isLoading=!1,$rootScope.env.timeslotPopupOpened=!0,scope.ui.isDialogShow=!0,scope.item.currentSlot=slot,pguEqueueService.mapResponseBinding(scope.item.responseBinding,slot),scope.ui.slotInfo=fDate.date+"&nbsp;"+fDate.month+", "+fDate.year+" "+fDate.yearShortTitle+", "+fDate.day+", "+slot.visitTimeFromIso,scope.item.clinicExamMode&&(scope.item.recommendedSlotDateTime=slot.visitTimeISO||slot.visitTimeStr),PGU.Events.subscribe(scope.item.fullPath,"hidePopup",function(){api.scrollTo(scope.item.fullPath,"",-60),PGU.Events.unsubscribe(scope.item.fullPath,"hidePopup")}),$rootScope.vaccineForm&&api.sendReachGoal("book_vaccine",{vaccine:{success:["slot"]}},24845174)},scope.ui.closeDialog=function(evt){if(evt&&(evt.preventDefault(),evt.stopPropagation()),$rootScope.env.timeslotPopupOpened=!1,scope.ui.isDialogShow=!1,scope.item.clinicExamMode){if(api.find(scope.item.clinicWidgetFullPath).attr("fastBook",!1),!scope.item.clinicFullSlotMode){var fullPathArr=scope.item.fullPath.split("_"),itemId=fullPathArr[fullPathArr.length-1],scrollId='[data-id="ClinicExam'+itemId+'"]';$timeout(function(){$("html, body").animate({scrollTop:$(document).find(scrollId).offset().top-60},100)},500)}}else api.scrollTo(scope.item.fullPath,"",-60)},scope.item.clinicExamMode&&(scope.item.showClinicDialog=function(slot){var date=new Date(slot.slotDateTime),fDate=apiInner.getFormattedDateObj(date);scope.ui.popup.errorTitle="",scope.ui.popup.error="",scope.ui.popup.isLoading=!1,scope.ui.isDialogShow=!0,scope.item.currentSlot=slot,pguEqueueService.mapResponseBinding(scope.item.responseBinding,slot),scope.ui.slotInfo=fDate.date+"&nbsp;"+fDate.month+", "+fDate.year+" "+fDate.yearShortTitle+", "+fDate.day+", "+slot.visitTimeFromIso},scope.item.cancelClinicBooking=function(medItemId){var clinicWidget=api.find(scope.item.clinicWidgetFullPath);scope.item.error="";var data={eserviceId:scope.item.eqServiceId,bookId:scope.item.value,userSelectedRegion:api.env("userSelectedRegion")};""!=scope.item.routeNumber&&(data.routeNumber=scope.item.routeNumber);var success=function(data){data&&data.status&&[301,302,303].indexOf(data.status.statusCode)>-1?scope.item.error="":scope.item.error="Во время отмены бронирования произошла ошибка. Пожалуйста, повторите попытку позже.",clinicWidget.element.handleCancelBooking(data,medItemId,scope.item.error),scope.models.isLoading=!1,scope.item.value=""},error=function(error){scope.item.error="Во время отмены бронирования произошла ошибка. Пожалуйста, повторите попытку позже.",clinicWidget.element.handleCancelBooking(data,medItemId,scope.item.error)};pguEqueueService.cancelBooking(data,success,error)}),scope.$sce=$sce,scope.item.clearAllDays=clearAllDays,scope.item.scrollToDayWithSlots=scrollToDayWithSlots,scope.item.showActiveDayInCalendar=showActiveDayInCalendar,scope.item.$calendarContainer=element.find(".PGU-TimeSlotExt-CalendarInner"),scope.item.$calendarElement=element.find(".js-PGU-TimeSlotExt-Calendar"),scope.__element=element,scope.$sce=$sce,scope.$root=$rootScope,scope.ui.chartCreation=function(){$timeout(function(){scope.ui.isChartCreated?scope.__element.is(":visible")?scope.ui.updateChart(scope.ui.saveBookIdMode.preReservationPeriod,scope.ui.saveBookIdMode.timerCounter,scope.ui.saveBookIdMode.preReservationPeriod-scope.ui.saveBookIdMode.timerCounter):PGU.Events.publish(":updateChart",{}):PGU.Events.publish(":createChart",{})},100)},PGU.Events.subscribe("","formRendered",function(){scope.ui.chartCreation()}),PGU.Events.subscribe("","createChart",function(){scope.item.datePickerMode||scope.item.clinicExamMode||(scope.ui.createChart?(scope.ui.createChart(),scope.ui.setPreReservTimer()):PGU.Events.publish(":createChart",{}))}),PGU.Events.subscribe("","widget-has-payments",function(evt,data){scope.ui.hasPayment=!0}),PGU.Events.subscribe("","updateChart",function(){scope.ui.chartCreation()}),scope.item.hideButton=!1;var $windowEl=angular.element($window);scope.isDesktop&&$windowEl.on("scroll",function(evt){if(scope.item.$buttonUpContainerWrap=element.find(".js-PGU-TimeSlotExt-ButtonUpContainer"),scope.item.$buttonUpWrap=element.find(".js-PGU-TimeSlotExtButtonUpWrap"),scope.item.$daysWraper=element.find(".js-PGU-ButtonScrollContainer"),scope.item.$buttonUpWrap.offset()&&scope.item.$buttonUpContainerWrap.height()&&scope.item.$daysWraper.height()){var top=$windowEl.scrollTop()-scope.item.$buttonUpWrap.offset().top+70,bottom=top+scope.item.$buttonUpContainerWrap.height()-scope.item.$daysWraper.height()-20;top<0?(top=0,scope.item.$buttonUpContainerWrap.css({display:"none"})):bottom>0&&(top-=bottom),top>70&&scope.item.$buttonUpContainerWrap.css({display:"block"}),scope.item.$buttonUpContainerWrap.css({top:top+"px"})}}),scope.isTablet&&(scope.item.outOfBottom=!1,scope.item.isUnderTopLine=!0,$windowEl.on("scroll",function(evt){if(scope.item.$daysWraper=element.find(".js-PGU-ButtonScrollContainer"),scope.item.$title=element.find(".js-PGU-TimeSlotExtSlotsWrap"),scope.item.$dateFilter=element.find(".js-DateFilterContainer"),scope.item.$title.offset()&&scope.item.$daysWraper.offset()&&scope.item.$daysWraper.height()){var topLine=scope.item.$title.offset().top,bottomLine=scope.item.$daysWraper.offset().top+scope.item.$daysWraper.height()-50;scope.item.dayIsClicked?($windowEl.scrollTop()>=bottomLine?scope.item.$dateFilter.css({display:"none"}):scope.item.$dateFilter.css({display:"block"}),$windowEl.scrollTop()>=topLine&&scope.item.dayIsClicked?scope.item.$dateFilter.css({"border-top":"1px solid #cdd1d4","border-bottom":"1px solid #cdd1d4","background-color":"#ffffff",position:"fixed",top:"40px",left:"0","padding-left":"50px"}):scope.item.$dateFilter.css({display:"block",position:"static","border-top":"0","border-bottom":"0","padding-left":"0"})):scope.item.$dateFilter.css({display:"none"})}}));var searchObj=$location.search();searchObj&&searchObj.bookId?scope.item.bookIdFromSearch=searchObj.bookId:scope.item.initRequest&&scope.item.getList(),scope.item._items=[],scope.item._hallItems=[],scope.item._items.push({className:"HelperBox",html:scope.item.helperBoxHtml,visible:!0,type:"important",mode:"Calendar"}),$rootScope.settings.mobOptimizeEqueue&&(scope.item.hintHtml=scope.item.helperBoxHtml),scope.item.dictionary.initRequest=!1;var hallObj={className:"FieldDropdown",name:"DropdownHall",label:"",selectType:"FieldDropdownExt",visible:!0,required:!0,fullPath:scope.item.fullPath?scope.item.fullPath+"_hallDropDown":"_hallDropDown",availableForHide:!1,dictionary:scope.item.dictionary,withoutCache:!1,getFullResult:!1,disabled:scope.item.disabled};scope.item._hallItems.push(hallObj),api.initAttrs(scope.item._hallItems),scope.$emit(scope.item.fullPath+":ScopeApplied",{scope:scope,element:element})}}}]).factory("TimeSlotExtExt",["controlAttrs","$q","$timeout","PGU","$rootScope",function(controlAttrs,$q,$timeout,PGU,$rootScope){return{attrs:angular.extend({},controlAttrs.attrs,{inlineCSS:{default:""},title:{default:"Подпись",type:"string","scope:ruleEditor":!0},pageNum:{type:"string",value:"1",default:"1","scope:sync":!0,"scope:editor":!1},fieldWidth:{type:"string",enum:["20","40","60","80","100"],enumOptions:{20:"20%",40:"40%",60:"60%",80:"80%",100:"100%"},default:"80"},total:{type:"integer","scope:editor":!1},initRequest:{type:"boolean",default:!1},dictionary:{default:{}},organizationId:{type:"string",default:""},eqBindings:{default:[]},intervalBinding:{type:"string",enum:["","15","20","30"],enumOptions:{"":"...",15:"15 мин.",20:"20 мин.",30:"30 мин."},default:""},requestBinding:{default:[],"scope:editor":!1},responseBinding:{default:[],"scope:editor":!1},slotAttributes:{default:[],"scope:editor":!1},aggSlotsParams:{default:[],"scope:editor":!1},aggBookSlotParams:{default:[],"scope:editor":!1},aggSlotAttributes:{default:[],"scope:editor":!1},slotParams:{default:[],"scope:editor":!1},messageAboutService:{type:"string",default:""},orgName:{type:"string",default:""},orgAddress:{type:"string",default:""},comment:{type:"string",default:""},pincode:{type:"string",default:"","scope:editor":!1},window:{type:"string",default:"","scope:editor":!1},getBookIdFromParams:{type:"boolean",default:!1},isEnabledDuration:{type:"boolean",default:!1},helperBoxHtml:{type:"string",default:"<p>Вы&nbsp;записываетесь на&nbsp;прием в&nbsp;том часовом поясе, где находится ведомство&nbsp;/ МФЦ</p>"},saveBookIdToDraft:{type:"boolean",default:!1},bookingChangeBtnText:{type:"string",default:"Изменить запись"},bookingChangeBtnIsHide:{type:"boolean",default:!1},bookingCancelBtnText:{type:"string",default:"Отменить запись"},bookingCancelBtnIsHide:{type:"boolean",default:!1},value:{type:"string",default:"","scope:editor":!1},startDate:{type:"string",default:"","scope:editor":!1},error:{type:"string","scope:editor":!1,default:""},preliminaryReservationPeriod:{type:"string",default:""},pathToRegionField:{type:"string",default:""},pathToOrgField:{type:"string",default:""},pathToMap:{type:"string",default:"form.FormStep5.Panel1.ZagsOrganization"},required:{type:"boolean",default:!1,humanity:"обязательное","scope:ruleEditor":!0},disabled:{type:"boolean",default:!1,"scope:ruleEditor":!0},preliminaryReservationCanceledText:{type:"string",default:"Время предварительного бронирования истекло. Для отправки заявления повторите бронирование."},preReservationCanceledMsg:{type:"string",default:""},showFullStepText:{type:"string",default:"Выбрать заново"},cancelChangesText:{type:"string",default:"Отменить изменения"},chartTitle:{type:"string",default:"До конца предварительного бронирования осталось:"},eqServiceId:{type:"string",default:""},filterByHall:{type:"boolean",default:!1},hallName:{type:"string",default:"Зал"},headHallLabel:{type:"string",default:"Зал регистрации"},selectedHallTitle:{type:"string",default:"","scope:sync":!0},routeNumber:{type:"string",default:""},datePickerMode:{type:"boolean",default:!1},pathToCurrentDateField:{type:"string",default:""},isSlotChosen:{type:"boolean",default:!1,"scope:editor":!1},doNotSaveDraft:{type:"boolean",default:!1,"scope:editor":!1},originalFrom:{type:"string",default:"field","scope:editor":!1},errorMessageHeader:{type:"string",default:"Невозможно выбрать время для записи","scope:editor":!1},errorMessageBody:{type:"string",default:"Попробуйте записаться позднее или выбрать другое подразделение для записи.","scope:editor":!1},hallTitleFromAreaId:{type:"boolean",default:!1}}),checkTimeSlotInvitation:function(lazy,needUpdateInfo,fullPath,ui,item,models,pguEqueueService,apiInner,api){var df=$q.defer();return api.find(fullPath).value()?(models.isLoading=!!lazy,ui.saveBookIdMode.needUpdateInfo=!0,pguEqueueService.checkInvitation(fullPath).then(function(data){if(data&&!data.error){var dateFromISO,date,fDate,numberMinutesToEndPreliminaryReservation,invitation=data.invitation,addressKey="address";$rootScope.env.formParam.ShowOneArea&&invitation.invitationHallAddress&&(addressKey="invitationHallAddress",item.isAreaZagsType=!0);for(var ikey in invitation)invitation.hasOwnProperty(ikey)&&(item.hasOwnProperty(ikey)?"startDate"===ikey?(dateFromISO=pguEqueueService.parseISODateFormat(invitation[ikey]),dateFromISO.length&&(date=new Date(dateFromISO[1],dateFromISO[2]-1,dateFromISO[3]),fDate=apiInner.getFormattedDateObj(date),ui.slotInfo=fDate.date+"&nbsp;"+fDate.month+", "+fDate.day+", "+dateFromISO[4]+":"+dateFromISO[5],PGU.timeSlotData.visitTime=fDate.date+" "+fDate.month+" "+fDate.year+", "+fDate.day+", "+dateFromISO[4]+":"+dateFromISO[5])):item[ikey]=invitation[ikey]||"":ikey===addressKey&&(item.orgAddress=invitation[ikey]),"address"===ikey&&item.isAreaZagsType&&(item.orgAddressZags=invitation[ikey]));PGU.timeSlotData.orgName=invitation.orgName,PGU.timeSlotData.orgAddress=invitation[addressKey],PGU.timeSlotData.selectedHallTitle=invitation.selectedHallTitle||invitation.invitationHall||"",PGU.timeSlotData.comment=invitation.comment||" - ",item.visible=!0,"CONFIRMED"===invitation.invitationStatus?(lazy||ui.toggleState("Reserved"),ui.showInfo=!0,ui.saveBookIdMode.showChart=!0,ui.needShowHeader=!0,ui.showCalendar=!1,ui.buttons.btnCancelChanges.visible=!1,ui.buttons.btnShowFullStep.visible=!1,ui.buttons.btnBookingChange.visible=!item.bookingChangeBtnIsHide,ui.buttons.btnCancelBooking.visible=!item.bookingCancelBtnIsHide,ui.saveBookIdMode.preReservationPeriod=invitation.minutesToEndPreliminaryReservation,numberMinutesToEndPreliminaryReservation=+invitation.minutesToEndPreliminaryReservation,"N"===invitation.preliminaryReservation?(ui.saveBookIdMode.showChart=!1,ui.setPreReservTimer(!0)):numberMinutesToEndPreliminaryReservation<=0?$timeout(function(){ui.saveBookIdMode.timerCounter=0,PGU.Events.publish(":updateChart",{}),ui.setPreReservTimer(!0)},0):$timeout(function(){PGU.Events.publish(":updateChart",{})},0),df.resolve({fullPath:item.fullPath,valid:!0,type:"invitation"})):(ui.clearBooking(!0),df.resolve({fullPath:item.fullPath,valid:!1,type:"invitation"})),ui.saveBookIdMode.needUpdateInfo=!needUpdateInfo}else df.resolve({fullPath:item.fullPath,valid:!1,type:"invitation"})})):df.resolve({fullPath:item.fullPath,valid:!1,type:"invitation"}),df.promise},getResponseBindingsMap:function(bindings,attr){var binding;return bindings&&(binding=bindings.find(function(li){return li.name===attr})),binding},filterDataByZagsType:function(data,item,api){var map,dataFilteredByZagsType,mapList,type="",areaName="",responseBindingType="",responseBindingZagsCode="",responseBindingAreaName="",responseBindingZagsAddress="",zagsCode="",zagsAddress="",filteredMapItems=[],filterByZagsType={name:"areaId",value:""};return map=api.find(item.pathToMap).element||{},map.dictionary&&map.dictionary.responseBindings&&map.dictionary.responseBindings.length&&(responseBindingType=this.getResponseBindingsMap(map.dictionary.responseBindings,"TYPE"),responseBindingZagsCode=this.getResponseBindingsMap(map.dictionary.responseBindings,"CODE"),responseBindingAreaName=this.getResponseBindingsMap(map.dictionary.responseBindings,"AREA_NAME"),responseBindingZagsAddress=this.getResponseBindingsMap(map.dictionary.responseBindings,"zags_address"),responseBindingType&&responseBindingZagsCode&&(type=api.find(responseBindingType.field).value(),zagsCode=api.find(responseBindingZagsCode.field).value(),areaName=api.find(responseBindingAreaName.field).value())),type&&("ZAGS"===type?(mapList=map.__responseData&&map.__responseData.items&&map.__responseData.items.length?map.__responseData.items:[],mapList.length&&mapList.forEach(function(li){"ZAGS"!==li.attributeValues.TYPE&&li.attributeValues.CODE==zagsCode&&filteredMapItems.push(li.attributeValues.AREA_NAME)}),filteredMapItems.length&&(filterByZagsType.value=filteredMapItems)):"AREA"===type&&(filterByZagsType.value=areaName,zagsAddress=responseBindingZagsAddress&&api.find(responseBindingZagsAddress.field).value()),filterByZagsType.value&&(dataFilteredByZagsType=this.getDataFilteredByZagsType(data.slots,filterByZagsType))&&(data.slots=dataFilteredByZagsType)),{zagsAddress:zagsAddress,type:type}},getDataFilteredByZagsType:function(data,dataFilter){return!data||data.slots&&!data.slots.length?null:Array.isArray(dataFilter.value)?data.filter(function(li){return!~dataFilter.value.indexOf(li[dataFilter.name])}):data.filter(function(li){return li[dataFilter.name]===dataFilter.value})}}}]),angular.module("serverFormWidgets.general").directive("epguDataGrid",["dataGridProperties","TEMPLATES","api","$rootScope","fieldAttrs","$timeout","PGU",function(dataGridProperties,TEMPLATES,api,$rootScope,fieldAttrs,$timeout,PGU){return{templateUrl:TEMPLATES.DATAGRID,replace:!0,scope:{item:"=?",list:"=?"},link:function(scope,element,attrs){function renderDataGrid(callback,nextPage,response){if(response=response||{},response.error)callback&&callback.error&&callback.error(response.code);else{var responseBindings=scope.item.dictionary.responseBindings||[],item=scope.item,list=scope.item.list;dataGridProperties.render(item,list,responseBindings,scope),nextPage||dataGridProperties.initPaging(scope.item.paging,scope.item.totalAttr),callback&&callback.done&&callback.done(item.list)}callback&&callback.always&&callback.always(),api.fixedShade(!1)}scope.ui={},scope.item.paging={},scope.list=scope.item.list||[],scope.item.paging={pageSize:scope.item.maxFields||15},scope.item.fakeClones=scope.item.fakeClones||[],function(){scope.item.tableMode=!0,scope.item.list=scope.item.list||[],renderDataGrid()}(),scope.$emit(scope.item.fullPath+":ScopeApplied",{scope:scope,element:element}),scope.item.isScopeAppliedDone={scope:scope,element:element},scope.item.removeClones=function(){var clones=scope.item.fakeClones,firstClone=scope.list[0];scope.list=[],scope.list.push(firstClone);for(var i=1;i<clones.length;i++)"function"==typeof clones[i].items[0].__itemDestroy&&clones[i].items[0].__itemDestroy(),
"function"==typeof clones[i].__itemDestroy&&clones[i].__itemDestroy();scope.item.list=[],scope.item.fakeClones=[],api.applyScope()},scope.item.__itemDestroy=function(){scope.$destroy(),element.remove(),api.applyScope()},scope.item.loadAndRenderDataGrid=function(pageNum,callback,nextPage){scope.item.removeClones(),scope.item.initializedFormDraft=!1,dataGridProperties.loadData({refName:scope.item.dictionary.code,filter:scope.item.filter,item:scope.item,parentRefItemValue:scope.item.parentRefItemValue,pageNum:pageNum||1,urlSrv:scope.item.url||void 0,mapResponse:scope.item.mapResponse,requestAttrs:JSON.parse(scope.item.requestAttrs||"{}"),useAtmosphere:scope.item.useAtmosphere},scope.ui,function(data){renderDataGrid(callback,nextPage,data)})},scope.setPage=function(paging,page){scope.item.paging.currentPage=page-1,api.fixedShade(!0),scope.item.loadAndRenderDataGrid(page,!1,!0)},scope.$watch("item.visible",function(val,oldVal){val!==oldVal&&scope.item.fakeClones&&scope.item.fakeClones.length&&scope.item.fakeClones.forEach(function(clone){clone.visible=val})})}}}]).factory("DataGridExt",["containerAttrs","DataGridProps",function(containerAttrs,DataGridProps){return{attrs:angular.extend({},containerAttrs.attrs,{title:{default:"Название DataGrid"},html:{"scope:editor":!1},clonable:{type:"boolean",default:!0,"scope:editor":!1},isClone:{type:"boolean",default:!1,"scope:editor":!1},saveDataGrid:{type:"boolean",default:!1,"scope:editor":!0},isCloneContainer:{type:"boolean",default:!1,"scope:editor":!1},cloneParent:{"scope:editor":!1},cloneId:{type:"integer",default:1,"scope:editor":!1},cloneIndex:{type:"string","scope:editor":!1,default:"0"},maxFields:{type:"integer",default:10,"scope:editor":!0},cloneButtonName:{type:"string",default:"",maxLength:"100","scope:editor":!1},dictionary:{default:{}},total:{type:"integer","scope:editor":!1},url:{type:"string","scope:editor":!1},mapResponse:{type:"string","scope:editor":!1},useAtmosphere:{type:"string","scope:editor":!1},fakeClones:{default:[],"scope:editor":!1},contentCurrentGrid:{default:[],"scope:editor":!1},itemsSyncRender:{type:"boolean",default:!1,"scope:editor":!1},numberOfClones:{type:"number",default:0,"scope:editor":!0},initializedFormDraft:{type:"boolean",default:!1,"scope:editor":!1}}),fetch:function(id,callback){this.element.loadAndRenderDataGrid(id,callback)},addClone:function(item,api,apiInner,PGU){function initElement(el,i,name,attr,item,isBind){var elApi=api.crateApiElement(el);if(elApi.init(),isBind)if("value"===name)elApi[attr](item[name]);else{var tmpItem=item.attributeValues||item;elApi[attr](tmpItem[name]+"")}if(i&&i>0){if("DataGrid"===el.className){var gridInGrid=api.find(scope.item.fullPath).find(el.fullPath.split("].")[1]),gridDictionary=gridInGrid.element.dictionary,elApiDictionary=elApi.element.dictionary;gridDictionary&&gridDictionary.requestBinding&&(elApiDictionary.requestBinding=JSON.parse(JSON.stringify(gridDictionary.requestBinding)),elApiDictionary.requestBinding.forEach(function(item){if(item.value.indexOf(scope.item.fullPath)>-1){var arrPath=item.value.split(scope.item.fullPath);item.value=scope.item.fullPath+"["+i+"]"+arrPath[1]}})),gridDictionary&&gridDictionary.responseBindings&&(elApiDictionary.responseBindings=JSON.parse(JSON.stringify(gridDictionary.responseBindings)),elApiDictionary.responseBindings.forEach(function(item){if(item.field.indexOf(scope.item.fullPath)>-1){var arrPath=item.field.split(scope.item.fullPath);item.field=scope.item.fullPath+"["+i+"]"+arrPath[1]}}))}el.cloneIndex=i,api._FormHash[el.fullPath]=elApi,apiInner.initRules.call(elApi,elApi.element,scope.itemsInRules),apiInner.attachHandlers.call(api,elApi.element,scope.itemsInRules)}}if(!item)return!1;var origin=api.find(item.originalFullPath).getElement();origin.initializedFormDraft=!0;var pushItem,dataGridPath=item.fullPathForXml||item.fullPath,pathField="";if(origin&&origin.numberOfClones>0)pushItem=function(grid,iClone){var newGrid={};if(grid){var clones=api.find(dataGridPath).fakeClones(),parent=api.find(dataGridPath).parent();newGrid=PGU.copy(JSON.parse(grid._model)),newGrid.fullPath=dataGridPath+"["+iClone+"]",newGrid.name=newGrid.name+"["+iClone+"]",newGrid.cloneIndex=iClone+"",DataGridProps.replaceFullPathInAttrs(newGrid,grid.fullPath,grid.name,iClone),api.initAttrs([newGrid],void 0,parent.element),clones.push(newGrid),api.find(dataGridPath).fakeClones(clones);var elApi=api.find(newGrid.fullPath);return api._FormHash[newGrid.fullPath]=elApi,apiInner.attachHandlers.call(api,elApi.element,{}),newGrid}return{}}(item,api.find(item.fullPath).fakeClones().length),origin.list.push(pushItem);else{var clones=api.find(item.fullPath).fakeClones();pushItem=item,clones.push(pushItem),api.find(item.fullPath).fakeClones(clones),origin.list=[],origin.list.push(pushItem)}origin.dictionary.responseBindings.forEach(function(bind){pathField=bind.field.split(dataGridPath+".")[1],initElement(DataGridProps.dataGridFind(pushItem,pathField))}),origin.numberOfClones++,api.applyScope()}}}]).factory("dataGridProperties",["$rootScope","containerAttrs","pguSelectService","apiInner","api","$timeout","FieldDropdownExt","sharedExtServices","PGU","DataGridProps",function($rootScope,containerAttrs,pguSelectService,apiInner,api,$timeout,FieldDropdownExt,sharedExtServices,PGU,DataGridProps){var model;return{initPaging:function(paging,total){paging.totalPages=Math.ceil(total/paging.pageSize),paging.currentPage=0},loadData:function(opts,ui,callback){var opts=angular.extend({pageSize:opts.item.paging.pageSize||15,pageNum:opts.pageNum||1},opts);ui.loading=!0,opts.urlSrv?sharedExtServices.requestSrvByUrl(opts,function(data,error){var response={};if(error?(response.error=!0,response.code=data.code):(opts.item.list=data.items,opts.item.totalAttr=data.total,ui.loading=!1,response.error=!1),data){var map=JSON.parse(opts.mapResponse||"{}");if(map.request)for(var key in map.request[0])opts.item[key]=data[map.request[0][key]];map.responseBindings&&(opts.item.dictionary.responseBindings=map.responseBindings),map.filter&&map.filter.func&&(opts.item.filterAnswer=eval("(function() {return "+map.filter.func+";})()"),opts.item.list=opts.item.list&&opts.item.list.length?opts.item.list.filter(opts.item.filterAnswer):[],opts.item.totalAttr=opts.item.list.length),ui.loading=!1,callback&&callback(response)}else callback&&callback()}):pguSelectService.loadDataFromServer(opts,function(data){var response={},error=data.error;!error||error&&0===error.code?(opts.item.list=data.items,opts.item.totalAttr=data.total,ui.loading=!1,response.error=!1):(response.error=!0,response.code=data.code),callback&&callback(response)},!0)},render:function(itemDataGrid,list,responseBindings,scope){function copyGrid(grid,iClone){var newGrid={};if(grid){var clones=api.find(dataGridPath).fakeClones(),parent=api.find(dataGridPath).parent();newGrid=PGU.copy(JSON.parse(grid._model)),newGrid.fullPath=dataGridPath+"["+iClone+"]",newGrid.name=newGrid.name+"["+iClone+"]",newGrid.cloneIndex=iClone+"",DataGridProps.replaceFullPathInAttrs(newGrid,grid.fullPath,grid.name,iClone),api.initAttrs([newGrid],void 0,parent.element),clones.push(newGrid),api.find(dataGridPath).fakeClones(clones);var elApi=api.find(newGrid.fullPath);return api._FormHash[newGrid.fullPath]=elApi,apiInner.attachHandlers.call(api,elApi.element,scope.itemsInRules),newGrid}return{}}function initElement(el,i,name,attr,item,isBind){var elApi=api.crateApiElement(el);if(elApi.init(),isBind)if("value"===name)elApi[attr](item[name]);else{var tmpItem=item.attributeValues||item;elApi[attr](tmpItem[name]+"")}if(i&&i>0){if("DataGrid"===el.className){var gridInGrid=api.find(scope.item.fullPath).find(el.fullPath.split("].")[1]),gridDictionary=gridInGrid.element.dictionary,elApiDictionary=elApi.element.dictionary;gridDictionary&&gridDictionary.requestBinding&&(elApiDictionary.requestBinding=JSON.parse(JSON.stringify(gridDictionary.requestBinding)),elApiDictionary.requestBinding.forEach(function(item){if(item.value.indexOf(scope.item.fullPath)>-1){var arrPath=item.value.split(scope.item.fullPath);item.value=scope.item.fullPath+"["+i+"]"+arrPath[1]}})),gridDictionary&&gridDictionary.responseBindings&&(elApiDictionary.responseBindings=JSON.parse(JSON.stringify(gridDictionary.responseBindings)),elApiDictionary.responseBindings.forEach(function(item){if(item.field.indexOf(scope.item.fullPath)>-1){var arrPath=item.field.split(scope.item.fullPath);item.field=scope.item.fullPath+"["+i+"]"+arrPath[1]}}))}el.cloneIndex=i,api._FormHash[el.fullPath]=elApi,apiInner.initRules.call(elApi,elApi.element,scope.itemsInRules),apiInner.attachHandlers.call(api,elApi.element,scope.itemsInRules)}}var list=list||[],responseBindings=responseBindings||[],dataGridPath=itemDataGrid.fullPathForXml||itemDataGrid.fullPath,pathField="";new RegExp(itemDataGrid.fullPath,"g");if(scope.list=scope.item.initializedFormDraft?scope.list||[]:[],scope.itemsInRules=scope.itemsInRules||{},!scope.item.initializedFormDraft)if(list.length)api.find(itemDataGrid.fullPath).fakeClones([]),list.forEach(function(item,i,all){var pushItem;if(i>0)pushItem=copyGrid(itemDataGrid,i),pushItem.contentCurrentGrid=all[i];else{itemDataGrid.contentCurrentGrid=all[i];var clones=api.find(itemDataGrid.fullPath).fakeClones();clones.push(itemDataGrid),api.find(itemDataGrid.fullPath).fakeClones(clones),pushItem=itemDataGrid}scope.list.push(pushItem),responseBindings.forEach(function(bind){pathField=bind.field.split(dataGridPath+".")[1],initElement(DataGridProps.dataGridFind(pushItem,pathField),i,bind.name,bind.attr,item,!0)})}),api.applyScope();else{var pushItem=itemDataGrid;scope.list.push(pushItem)}}}}]).factory("DataGridProps",[function(){return{replaceFullPathInAttrs:function(model,fullPath,panelName,cloneIndex){if(model.fullPath&&(model.fullPath=this.replaceFullPath(model.fullPath,fullPath,panelName,cloneIndex)),this.filterByAttrs(model,fullPath,panelName,cloneIndex),model.items&&model.items.length)for(var i=0,il=model.items.length;i<il;i++)this.replaceFullPathInAttrs(model.items[i],fullPath,panelName,cloneIndex)},filterByAttrs:function(model,fullPath,panelName,cloneIndex){for(var attrs=["responseBindings","requestBinding","handlers","limits","dictionary"],i=0,il=attrs.length;i<il;i++)model[attrs[i]]&&this.replaceAttrs(attrs[i],model,fullPath,panelName,cloneIndex)},replaceAttrs:function(attrName,model,fullPath,panelName,cloneIndex){function dictionaryBindHelper(obj,key){obj.forEach&&obj.forEach(function(item,i){obj[i][key]=self.replaceFullPath(item[key],fullPath,panelName,cloneIndex)})}var attr,listen,self=this;switch(attrName){case"dictionary":model.dictionary&&(attr=model.dictionary,attr.requestBinding&&dictionaryBindHelper(attr.requestBinding,"value"),attr.responseBindings&&dictionaryBindHelper(attr.responseBindings,"field"));break;case"handlers":if(model.handlers){attr=model.handlers;for(var i=0,il=attr.length;i<il;i++)if(attr[i].handler&&(attr[i].handler=this.replaceFullPath(attr[i].handler,fullPath,panelName,cloneIndex)),attr[i].listen){listen=attr[i].listen;for(var j=0,jl=listen.length;j<jl;j++)listen[j].component=this.replaceFullPath(listen[j].component,fullPath,panelName,cloneIndex)}}break;case"limits":model.limits&&(attr=model.limits,model.limits=this.replaceFullPath(model.limits,fullPath,panelName,cloneIndex))}},changeIndex:function(name,ind){var match,str;return(match=name.match(/^([a-zA-Z0-9_]+)(\[\d+\])$/))?(str=match[1],ind&&(str+=ind),str):str=ind?name+ind:name},replaceFullPath:function(str,fullPath,panelName,cloneIndex){if(str){var regexp,cloneName,originPanelName=panelName,regexpClone=new RegExp(/\[0]/gi),cleanPath=str.replace(regexpClone,""),cleanFullPath=fullPath.replace(regexpClone,""),indexOfFullPath=cleanPath.indexOf(cleanFullPath);if(!(cleanPath.indexOf(cleanFullPath)>-1)||!str)return str;panelName="."+panelName;var replaceName=cleanFullPath.replace("."+originPanelName,"."+originPanelName+"["+cloneIndex+"]");return indexOfFullPath<0?str:(cloneName=panelName+"["+cloneIndex+"]",str.indexOf(panelName+"[0]")>-1&&(panelName+="[0]"),indexOfFullPath+cleanFullPath.length<cleanPath.length?(panelName+=".",cloneName+=".",regexp=new RegExp(panelName.replace(/([-[\]{}()*+?.,\\^$|#])/g,"\\$1"),"g")):regexp=new RegExp((panelName+"$").replace(/([-[\]{}()*+?.,\\^|#])/g,"\\$1"),"g"),str.match(regexp)?str.replace(new RegExp(cleanFullPath,"gi"),replaceName):str)}},initFullPathForXml:function(model,fullpath,panelName,index){var self=this;return model.fullPathForXml=self.replaceFullPath(model.fullPathForXml||model.fullPath,fullpath,panelName,index),function(model){model.items&&model.items.length&&model.items.forEach(function(item){return item.fullPathForXml=model.fullPathForXml+(item.name?"."+item.name:""),"FieldDropdownHierarchic"===item.className&&item.clones&&item.clones.length&&item.clones.forEach(function(clone){clone.fullPathForXml=model.fullPathForXml+(clone.name?"."+clone.name:"")}),self.initFullPathForXml(item,fullpath,panelName,index)})}(model)},dataGridFind:function(item,str){function find(context,key){if(context.name===key)return context;if(context.items)for(var i=0;i<Object.keys(context.items).length;i++){var el=context.items[i],c=find(el,key);if(c)return c}}return function(str){var search=str.split("."),context=item;return search.forEach(function(iter){context&&(context=find(context,iter))}),context}(str)}}}]),angular.module("serverFormWidgets.general").directive("epguTable",["TEMPLATES","api","TableExt","$rootScope",function(TEMPLATES,api,TableExt,$rootScope){return{templateUrl:TEMPLATES.TABLE,replace:!0,scope:{item:"="},link:function(scope,element,attrs){$rootScope.isDesigner||(!function(){scope.isMobile=api.isMobile(),scope.item.originalFullPath=TableExt.getNotCloneFullParh(scope.item.fullPath),scope.$emit(scope.item.fullPath+":ScopeApplied",{scope:scope,element:element});var regex=/\[(.+?)\]/,parentFullPath=scope.item.parent.fullPath,lastParentElement=parentFullPath.substr(parentFullPath.lastIndexOf("."),parentFullPath.length),setTitle=!regex.exec(lastParentElement);if(scope.parentElement=api.find(parentFullPath).element,scope.item.titles=api.find(scope.item.originalFullPath).element.titles||[],setTitle){if(scope.item.titles=scope.item.theRows[0].row,scope.item.theRows.splice(0,1),"DataGrid"===scope.parentElement.className&&scope.parentElement._model){var newModel=JSON.parse(scope.parentElement._model);newModel&&newModel.items&&newModel.items.some(function(it){return it.fullPath===scope.item.fullPath&&(it.theRows.splice(0,1),!0)}),scope.parentElement._model=JSON.stringify(newModel)}}else scope.isMobile||(delete scope.item.titles,scope.item.rows={});scope.item.rows={},scope.item.theRows.forEach(function(rowObj,key){scope.item.rows[key]=[],rowObj.row.forEach(function(itemName){var item=api.find(scope.item.fullPath+"."+itemName.obj).element;item&&scope.item.rows[key].push(item)})}),scope.parentElement=api.find(parentFullPath).element}(),scope.item.__itemDestroy=function(){scope.$destroy(),element.remove(),api.applyScope()})}}}]).factory("TableExt",["containerAttrs",function(containerAttrs){return{getNotCloneFullParh:function(fullPath){var firstFound=!0;return fullPath.split(".").reverse().map(function(name){return firstFound&&name.match(/\[[0-9]+]/g)&&(firstFound=!1,name=name.replace(/\[[0-9]+]/g,"")),name}).reverse().join(".")},attrs:angular.extend({},containerAttrs.attrs,{tableEdit:{},theRows:{type:"string"},visible:{type:"boolean",enum:[!0,!1],enumOptions:{true:"Да",false:"Нет"},default:"false"}})}}]),angular.module("serverFormWidgets.general").directive("epguPanelWorkActivity",["panelWorkActivityProps","TEMPLATES","api","$rootScope","$sce","$timeout","PGU","apiInner","PanelWorkActivityExt","panelWorkActivityStructure","$window",function(panelWorkActivityProps,TEMPLATES,api,$rootScope,$sce,$timeout,PGU,apiInner,PanelWorkActivityExt,panelWorkActivityStructure,$window){return{templateUrl:TEMPLATES.WORK_FMS,replace:!0,scope:{item:"="},link:function(scope,element,attrs){function getRadioForWatch(item,val){return"1"===val?item.find("Panel10.FieldRadio11").getElement():"2"===val?item.find("Panel10.FieldRadio22").getElement():void 0}function getVisibleRadio(item){var sex=scope.item.sexField&&api.find(scope.item.sexField)?api.find(scope.item.sexField).getElement():void 0;return sex&&"1"==sex.value?function(){return item.find("Panel10.FieldRadio22").visible(!1),item.find("Panel10.FieldRadio11").visible(!0).getElement()}():function(){return item.find("Panel10.FieldRadio11").visible(!1),item.find("Panel10.FieldRadio22").visible(!0).getElement()}()}function cleanClone(cloneIndex){var el=api.find(scope.item.fullPath).find("workActivityClones.workActivityPanel["+cloneIndex+"]");apiInner.loopThroughTheTree(el.getElement().items,function(items,item){!!item.value&&(item.value=""),!!item.textValue&&(item.textValue=""),!!item.text_value&&(item.text_value="")})}function unsetWatchers(cloneIndex){watchersClear[cloneIndex].forEach(function(li){li()}),watchersClear[cloneIndex]=[]}function setWatchers(cloneIndex){watchersClear[cloneIndex]=[];var parent=api.find(scope.item.fullPath),el=cloneIndex?parent.find("workActivityClones.workActivityPanel["+cloneIndex+"]"):parent.find("workActivityClones.workActivityPanel"),atrpresent=el.find("PANEL_ATPRESENT.CELL_ATPRESENT.ATPRESENT").getElement(),end_month=el.find("CELL_END_MONTH.END_MONTH").getElement(),end_year=el.find("CELL_END_YEAR.END_YEAR").getElement(),start_month=el.find("CELL_START_MONTH.START_MONTH").getElement(),start_year=el.find("CELL_START_YEAR.START_YEAR").getElement(),address=el.find("CELL_ADDRESS.ADDRESS").getElement(),org=el.find("CELL_ORG.ORG").getElement(),position=el.find("CELL_POSITION.POSITION").getElement(),sex=scope.item.sexField&&api.find(scope.item.sexField)?api.find(scope.item.sexField).getElement():void 0,radio=getVisibleRadio(el),radio_1=getRadioForWatch(el,"1"),radio_2=getRadioForWatch(el,"2");scope.item.fiasField&&api.find(scope.item.fiasField)&&api.find(scope.item.fiasField).getElement();!scope.ui.isMobile&&$rootScope.settings.mobOptimizeWorkActivity&&panelWorkActivityStructure.setSexStatuses(api.find(scope.item.sexField),radio,scope.ui,!0),sex&&(position.label="Должность (без сокращений)"),watchersClear[cloneIndex][0]=scope.$watch(function(){return atrpresent.value},function(val,oldVal){if(val&&oldVal&&val!=oldVal){var currentDate=new Date,currMonth=apiInner.leadingZero(currentDate.getMonth()+1),currYear=currentDate.getFullYear()+"";val&&"true"==val?(panelWorkActivityProps.disableValue(end_month,currMonth),panelWorkActivityProps.disableValue(end_year,currYear),panelWorkActivityProps.checkPanelData(el,scope.item.fieldNames)):val&&"false"==val&&(panelWorkActivityProps.enableValue(end_month),panelWorkActivityProps.enableValue(end_year),panelWorkActivityProps.checkPanelData(el,scope.item.fieldNames))}}),watchersClear[cloneIndex][1]=scope.$watch(function(){return start_month.value},function(val,oldVal){val!=oldVal&&(end_month._changedByUser=!0,end_year._changedByUser=!0,panelWorkActivityProps.checkPanelData(el,scope.item.fieldNames))}),watchersClear[cloneIndex][2]=scope.$watch(function(){return start_year.value},function(val,oldVal){val!=oldVal&&(end_month._changedByUser=!0,end_year._changedByUser=!0,panelWorkActivityProps.checkPanelData(el,scope.item.fieldNames))}),watchersClear[cloneIndex][3]=scope.$watch(function(){return end_month.value},function(val,oldVal){val!=oldVal&&(end_month._changedByUser=!0,end_year._changedByUser=!0,panelWorkActivityProps.checkPanelData(el,scope.item.fieldNames))}),watchersClear[cloneIndex][4]=scope.$watch(function(){return end_year.value},function(val,oldVal){val!=oldVal&&(end_month._changedByUser=!0,end_year._changedByUser=!0,panelWorkActivityProps.checkPanelData(el,scope.item.fieldNames))}),watchersClear[cloneIndex][5]=scope.$watch(function(){return org.value},function(val,oldVal){val!=oldVal&&panelWorkActivityProps.checkPanelData(el,scope.item.fieldNames)}),watchersClear[cloneIndex][6]=scope.$watch(function(){return position.value},function(val,oldVal){val!=oldVal&&panelWorkActivityProps.checkPanelData(el,scope.item.fieldNames)}),watchersClear[cloneIndex][7]=scope.$watch(function(){return address.value},function(val,oldVal){val!=oldVal&&panelWorkActivityProps.checkPanelData(el,scope.item.fieldNames)}),watchersClear[cloneIndex][8]=scope.$watch(function(){return radio_1.value},function(val,oldVal){val!=oldVal&&(panelWorkActivityStructure.setLabelsFromRadioValue({position:position,org:org,address:address,sex:sex,val:val,isMobile:scope.ui.isMobile}),scope.ui.isMobile||panelWorkActivityProps.checkPanelData(el,scope.item.fieldNames))}),watchersClear[cloneIndex][9]=scope.$watch(function(){return radio_2.value},function(val,oldVal){val!=oldVal&&(panelWorkActivityStructure.setLabelsFromRadioValue({position:position,org:org,address:address,sex:sex,val:val,isMobile:scope.ui.isMobile}),scope.ui.isMobile||panelWorkActivityProps.checkPanelData(el,scope.item.fieldNames))}),sex&&(watchersClear[cloneIndex][10]=scope.$watch(function(){return sex.value},function(val,oldVal){val!=oldVal&&$rootScope.settings.mobOptimizeWorkActivity&&(panelWorkActivityStructure.setSexStatuses(api.find(scope.item.sexField),getVisibleRadio(el),scope.ui,!0),radio_1.visible?radio_1.value=radio_2.value:radio_2.visible&&(radio_2.value=radio_1.value))})),panelWorkActivityStructure.setLabelsFromRadioValue({position:position,org:org,address:address,sex:sex,val:radio.value,fromDraft:!0}),scope.ui.isMobile||panelWorkActivityProps.checkPanelData(el,scope.item.fieldNames),scope.$emit(scope.item.fullPath+":ScopeApplied",{scope:scope,element:element})}var $el=element,watchersClear={};scope.$sce=$sce;var watchers;if(scope.$on("suspend",function(){watchers=scope.$$watchers,scope.$$watchers=[]}),scope.$on("resume",function(){scope.$$watchers=watchers,watchers=null}),$rootScope.settings.mobOptimizeWorkActivity){var allValidItems=[];device.mobile()&&scope.item.fieldNames.push({name:"atPresent",field:"PANEL_ATPRESENT.CELL_ATPRESENT.ATPRESENT"}),scope.ui={isMobile:device.mobile(),isTablet:device.tablet(),isDesktop:device.desktop(),isNotSelf:!1,btnShowDialog:{label:"Начать",fullPath:scope.item.fullPath?scope.item.fullPath+"._btnShowDialog":"_btnShowDialog",visible:!0,btnColor:"blue"},btnAddWork:{label:"Добавить еще",show:!0,clickHandler:function(){var element=api.find(scope.item.fullPath).find("workActivityClones.workActivityPanel");if("input"==scope.ui.state){scope.item.list=scope.item.list||[];var $popupFade,listItem,listItemValid,cloneId=element.cloneId();PanelWorkActivityExt.validation(element)&&(listItemValid=panelWorkActivityProps.convertItemToListItem({element:element,cloneId:scope.item.list.length?cloneId:0,visibleRadioValue:getVisibleRadio(element),fieldNames:scope.item.fieldNames,noClear:!0}),listItem=panelWorkActivityProps.convertItemToListItem({element:element,cloneId:scope.item.list.length?cloneId:0,visibleRadioValue:getVisibleRadio(element),fieldNames:scope.item.fieldNames}),allValidItems.push(listItemValid),$timeout(function(){scope.item.list.push(listItem),scope.item.chartIntervals=panelWorkActivityProps.checkListMobile(scope.item.list,scope.item.validPeriod,allValidItems),$popupFade=$el.find(".PGU-Popup_fade"),$popupFade.scrollToElementAnimated($popupFade.find(".PGU-Popup"),0,200),getVisibleRadio(element).value="1"},0,!1),scope.item.fieldNames.forEach(function(fN){var findedFN=element.find(fN.field);findedFN.required(!1),findedFN._changedByUser=!1,findedFN.customError&&(findedFN.customError=""),findedFN.error(""),findedFN.validate(!0),findedFN.visible(!0)}))}else"list"==scope.ui.state&&(getVisibleRadio(element).value="1",scope.ui.state="input")}},btnClearPopup:{label:"Очистить список",clickHandler:function(){scope.ui.state="clear"}},btnConfirmClearAll:{label:"Подтвердить",clickHandler:function(){for(var listLength=scope.item.list.length,i=0;i<listLength;i++)scope.ui.deleteFromList(0,!0);scope.item.chartIntervals=panelWorkActivityProps.checkListMobile(scope.item.list,scope.item.validPeriod,allValidItems)}},btnCancelClearAll:{label:"Отменить",clickHandler:function(){scope.ui.state="list"}},modalShow:!1,state:"input",deleteFromList:function(index,deleteAll){var formHash=api._FormHash,deletedElement=scope.item.list.splice(index,1)[0],deletedIndex=-1;allValidItems.forEach(function(el,i){el.fullPath==deletedElement.fullPath&&(deletedIndex=i)}),deletedIndex>=0&&allValidItems.splice(deletedIndex,1);var item_el=api.find(scope.item.fullPath),clones=item_el.find("workActivityClones")?item_el.find("workActivityClones").element.items:[];for(var key in formHash)key.indexOf(deletedElement.fullPath)+1&&delete formHash[key];var deletedCloneIndex=-1;if(clones.forEach(function(elem,i){elem.fullPath===deletedElement.fullPath&&(deletedCloneIndex=i)}),deletedCloneIndex>=0&&clones.splice(deletedCloneIndex,1),deleteAll||(scope.item.chartIntervals=panelWorkActivityProps.checkListMobile(scope.item.list,scope.item.validPeriod,allValidItems)),!scope.item.list.length){scope.ui.state="input";getVisibleRadio(api.find(scope.item.fullPath).find("workActivityClones.workActivityPanel")).value="1"}},showList:function(){scope.item.list&&scope.item.list.length&&(scope.ui.state="list")}}}else scope.ui={};scope.ui.isMobile&&(scope.ui.toggleModalVisible=function(visible){var data,clones,cloneItems,firstElem,address,org,position,el,sex;if(scope.elements||(scope.elements=element.find("input"),scope.elements.bind("focus blur",function(event){scope.ui.btnAddWork.show="focus"!=event.type})),scope.ui.modalShow=visible,visible||(scope.ui.state="input"),scope.item.chartIntervals&&scope.item.chartIntervals.status)switch(scope.item.chartIntervals.status){case"full":scope.ui.state="list",scope.ui.btnShowDialog.label="Продолжить заполнять";break;case"expect":scope.ui.btnShowDialog.label="Продолжить заполнять"}else visible&&(data={fields:panelWorkActivityProps.getFieldsPaths(),values:panelWorkActivityProps.getDefaultInterval(),parentFullPath:scope.item.fullPath},panelWorkActivityProps.setDefaultInterval(data)),scope.ui.btnShowDialog.label="Начать";visible?(el=api.find(scope.item.fullPath),cloneItems=el.find("workActivityClones"),firstElem=cloneItems.find("workActivityPanel"),scope.item.isFirstPopupOpen||(address=firstElem.find("CELL_ADDRESS.ADDRESS").getElement(),org=firstElem.find("CELL_ORG.ORG").getElement(),position=firstElem.find("CELL_POSITION.POSITION").getElement(),sex=scope.item.sexField&&api.find(scope.item.sexField)?api.find(scope.item.sexField).getElement():void 0,panelWorkActivityStructure.setLabelsFromRadioValue({position:position,org:org,address:address,sex:sex,val:getVisibleRadio(firstElem).value}),data={fields:panelWorkActivityProps.getFieldsPaths(),values:panelWorkActivityProps.getDefaultInterval(),parentFullPath:scope.item.fullPath},panelWorkActivityProps.setDefaultInterval(data),scope.item.isFirstPopupOpen=!0),scope.item.fieldNames.forEach(function(fN){var findedFN=firstElem.find(fN.field);findedFN.required(!1),findedFN._changedByUser=!1,findedFN.customError&&(findedFN.customError=""),findedFN.error(""),findedFN.validate(!0)}),getVisibleRadio(firstElem).value="1",clones=cloneItems.element.items||[],clones.forEach(function(clone,i){clone.cloneParent&&(clone.visible=!1)})):api.scrollTo(scope.item.fullPath,"",-60)},scope.item.list=scope.item.multiValue&&scope.item.multiValue.length?JSON.parse(scope.item.multiValue):[],panelWorkActivityStructure.setSexStatuses(api.find(scope.item.sexField),getVisibleRadio(api.find(scope.item.fullPath+".workActivityClones.workActivityPanel")),scope.ui),scope.item.list.length&&(scope.item.chartIntervals=panelWorkActivityProps.checkListMobile(scope.item.list,scope.item.validPeriod,allValidItems),scope.ui.btnShowDialog.label="Продолжить заполнять")),$rootScope.isDesigner||function(){scope.item.validPeriod=scope.item.validPeriod||10,!scope.ui.isMobile&&$rootScope.settings.mobOptimizeWorkActivity&&panelWorkActivityStructure.setSexStatuses(api.find(scope.item.sexField),getVisibleRadio(api.find(scope.item.fullPath+".workActivityClones.workActivityPanel")),scope.ui);var item_el=api.find(scope.item.fullPath);if(panelWorkActivityProps.recheckData(item_el.find("workActivityClones"),scope.item.fieldNames),scope.item.items&&scope.item.items.length){var it=scope.item.items[0];it.items[it.items.length-1].isLastClone=!1,it.items=it.items.sort(function(k,l){return+k.cloneIndex-+l.cloneIndex}),it.items[it.items.length-1].isLastClone=!0}PGU.Events.subscribe(item_el.find("workActivityClones.workActivityPanel").attr("fullPath"),"cloneAdded",function(a,data){cleanClone(data.cloneIndex),setWatchers(data.cloneIndex)}),PGU.Events.subscribe(item_el.find("workActivityClones.workActivityPanel").attr("fullPath"),"cloneDeleted",function(a,data){var deletedClone=item_el.find("workActivityClones").element;if(panelWorkActivityProps.recheckData(item_el.find("workActivityClones"),scope.item.fieldNames,deletedClone.items[data.cloneIndex].cloneIndex),deletedClone){var parentClonesFP=data.parentClonesFP,notFullPathInRecheck="",deletedItem=deletedClone.items[data.cloneIndex],notFoundPath=!0;if(parentClonesFP.forEach(function(li){notFoundPath&&((notFoundPath=deletedClone.items.find(function(dli){return dli.fullPathForXml===li}))||(notFullPathInRecheck=li))}),notFullPathInRecheck&&notFullPathInRecheck!==deletedItem.fullPathForXml){var markDeletedRuntime=api.__getToMarkDeletedRuntime();for(var k in markDeletedRuntime)markDeletedRuntime.hasOwnProperty(k)&&~k.indexOf(deletedItem.fullPathForXml)&&(markDeletedRuntime[k]=!1,api.__addToMarkDeletedRuntime(k.replace(deletedItem.fullPathForXml,notFullPathInRecheck)))}else api.__addToMarkDeletedRuntime(deletedClone.items[data.cloneIndex].fullPathForXml,deletedClone.items[data.cloneIndex]);"true"===api.env("formParam").isSaveElDraft&&api.uploadDraft(!1,null,null,!1,scope.item,!0),unsetWatchers(deletedClone.items[data.cloneIndex].cloneIndex)}});var clones=item_el.find("workActivityClones")?item_el.find("workActivityClones").element.items:[];scope.item.list=clones&&clones.length?[]:scope.item.list||[];var scopeItemListLength=scope.item.list.length;clones&&clones.length&&angular.forEach(clones,function(clone,i){var item=api.find(clone.fullPath);if("true"==item.find("PANEL_ATPRESENT.CELL_ATPRESENT.ATPRESENT").getElement().value&&(item.find("CELL_END_MONTH.END_MONTH").getElement().disabled=!0,item.find("CELL_END_YEAR.END_YEAR").getElement().disabled=!0),scope.ui.isMobile&&$rootScope.settings.mobOptimizeWorkActivity&&!scopeItemListLength&&clones.length){var listItemValid=panelWorkActivityProps.convertItemToListItem({element:item,fieldNames:scope.item.fieldNames,visibleRadioValue:getVisibleRadio(item),clonesLength:clones.length,noClear:!0}),convertItem=panelWorkActivityProps.convertItemToListItem({element:item,fieldNames:scope.item.fieldNames,visibleRadioValue:getVisibleRadio(item),clonesLength:clones.length});convertItem&&(scope.item.list.push(convertItem),allValidItems.push(listItemValid))}!scope.ui.isMobile&&$rootScope.settings.mobOptimizeWorkActivity?panelWorkActivityStructure.setSexStatuses(api.find(scope.item.sexField),getVisibleRadio(item),scope.ui,!0):getVisibleRadio(item),setWatchers(i)}),scope.ui.isMobile&&$rootScope.settings.mobOptimizeWorkActivity&&(scope.item.chartIntervals=panelWorkActivityProps.checkListMobile(scope.item.list,scope.item.validPeriod,allValidItems),scope.item.list.length&&(scope.ui.btnShowDialog.label="Продолжить заполнять")),$rootScope.$on(":formRendered",function(evt,data){clones&&clones.length&&angular.forEach(clones,function(clone,i){var item=api.find(clone.fullPath);item.find("CELL_START_MONTH.START_MONTH").getElement().required=!0,item.find("CELL_START_YEAR.START_YEAR").getElement().required=!0})})}()}}}]).factory("PanelWorkActivityExt",["basePanelAttrs","panelWorkActivityStructure",function(basePanelAttrs,panelWorkActivityStructure){return{attrs:angular.extend({},basePanelAttrs.attrs,{validPeriod:{type:"integer",default:10},filledPeriods:{type:"integer",default:10},clonesContainer:{type:"string",default:""},sexField:{type:"string","scope:editor":!0,
default:"form.FormStep1.OtherData.TCell2.SEX"},fiasField:{type:"string",default:"form.FormStep_5.Panel2.Panel_LPLACE.LPLACE"}}),fieldNames:[{name:"startMonth",field:"CELL_START_MONTH.START_MONTH"},{name:"startYear",field:"CELL_START_YEAR.START_YEAR"},{name:"endMonth",field:"CELL_END_MONTH.END_MONTH"},{name:"endYear",field:"CELL_END_YEAR.END_YEAR"},{name:"pos",field:"CELL_POSITION.POSITION"},{name:"org",field:"CELL_ORG.ORG"},{name:"addr",field:"CELL_ADDRESS.ADDRESS"}],fillItems:function(item){return this.fillFullPath(panelWorkActivityStructure.getStructure(),this.element.fullPath)},validation:function(element){var validate=[];return this.fieldNames.forEach(function(field){var apiEl=element.find(element.fullPath()+"."+field.field);"atPresent"!==field.name&&apiEl.required(!0),validate.push(apiEl.validate()),apiEl.customError&&!apiEl.validate(!0)&&apiEl.error(apiEl.customError)}),validate.indexOf(!1)+1==0},fillFullPath:function(structure,parentPath){if(structure.fullPath=parentPath+"."+structure.name,structure.originalFullPath=parentPath+"."+structure.name,structure.items&&structure.items.length)for(var i=0;i<structure.items.length;i++)structure.items[i]=this.fillFullPath(structure.items[i],structure.fullPath);return structure}}}]).factory("panelWorkActivityProps",["$rootScope","basePanelAttrs","panelWorkActivityStructure","apiInner","api","PGU",function($rootScope,basePanelAttrs,panelWorkActivityStructure,apiInner,api,PGU){return{disableValue:function(item,value,text_value){item.reserveDisabled={value:item.value,text_value:item.text_value},item.value=value||"",value||(item.text_value=text_value||""),item.disabled=!0},enableValue:function(item){item.value=item.reserveDisabled?item.reserveDisabled.value||"":{},item.text_value=item.reserveDisabled?item.reserveDisabled.text_value||"":{},item.disabled=!1},recheckData:function(parent,fieldNames,deletedCloneIndex){var that=this;that.allValidItems=[],angular.forEach(parent.attr("items"),function(panel,index){that.checkPanelData(api.find(panel.fullPath),fieldNames,deletedCloneIndex)})},checkPanelData:function(panel,fieldNames,deletedCloneIndex){if(!device.mobile()||!$rootScope.settings.mobOptimizeWorkActivity){angular.forEach(fieldNames,function(fieldName,index){panel.find(fieldName.field).setRequired(!0)}),panel.element.isWorkActivity=!0;panel.validate(!0)?this.addValidItems(panel,fieldNames,deletedCloneIndex):this.removeValidItems(panel.attr("fullPath"),fieldNames),this.checkAllData(panel,fieldNames);var parent=panel.parent().parent(),scrollPanel=$("[full-path='"+panel.attr("fullPath")+"']");deletedCloneIndex?parent.attr("scrollTo",scrollPanel.offset().top-scrollPanel.outerHeight(!0)+70):scrollPanel.length>0&&parent.attr("scrollTo",scrollPanel.offset().top)}},addValidItemsWithOptimize:function(list){this.allValidItems=list||[]},addValidItems:function(panel,fieldNames,deletedCloneIndex){if(deletedCloneIndex!==panel.element.cloneIndex||void 0==deletedCloneIndex){this.allValidItems=this.allValidItems||[];var items=this.allValidItems;this.removeValidItems(panel.attr("fullPath"),fieldNames);var obj={panel:panel.attr("fullPath")};angular.forEach(fieldNames,function(fieldName,index){obj[fieldName.field]=panel.find(fieldName.field)}),obj.dateStart=parseInt(obj["CELL_START_MONTH.START_MONTH"].value(),10)+12*(parseInt(obj["CELL_START_YEAR.START_YEAR"].value(),10)-1),obj.dateEnd=parseInt(obj["CELL_END_MONTH.END_MONTH"].value(),10)+12*(parseInt(obj["CELL_END_YEAR.END_YEAR"].value(),10)-1),obj.pos=obj["CELL_POSITION.POSITION"].value(),obj.addr=obj["CELL_ADDRESS.ADDRESS"].value(),obj.org=obj["CELL_ORG.ORG"].value(),items.push(obj)}},removeValidItems:function(fullPath,fieldNames){if(this.allValidItems=this.allValidItems||[],this.allValidItems.length)for(var i=this.allValidItems.length-1;i>=0;i--)this.allValidItems[i].panel==fullPath&&this.allValidItems.splice(i,1)},checkListMobile:function(list,validPeriod,allValidItems){this.addValidItemsWithOptimize(allValidItems),this.checkAllData(null,null,list);var items=list.sort(function(next,prev){return next.dateStart>prev.dateStart||!(next.dateStart<prev.dateStart)&&0});validPeriod*=12;for(var today=new Date,currentDate=new Date(today.getFullYear(),today.getMonth(),1),currMonth=currentDate.getMonth()+1,currYear=currentDate.getFullYear(),dateEnd=currMonth+12*(currYear-1),dateStart=currMonth+12*(currYear-1)-validPeriod,pointer=dateStart,intervals={valid:[],invalid:[]},presentInterval=null,i=0;i<items.length;i++)items[i].dateEnd==dateEnd&&(presentInterval=items[i]),items[i].dateStart&&items[i].dateEnd&&(items[i].dateStart<=pointer+1?(items[i].dateEnd>=pointer||presentInterval&&items[i].dateEnd<=presentInterval.dateEnd)&&(intervals.valid.push({start:items[i].dateStart,end:items[i].dateEnd}),pointer=items[i].dateEnd):(intervals.invalid.push({start:pointer,end:items[i].dateStart}),intervals.valid.push({start:items[i].dateStart,end:items[i].dateEnd}),pointer=items[i].dateEnd)),!presentInterval&&i==items.length-1&&items[i].dateEnd<dateEnd&&intervals.invalid.push({start:items[i].dateEnd<pointer?pointer:items[i].dateEnd,end:dateEnd});for(var m=_.range(dateEnd-dateStart).map(function(){return 0}),i=0;i<m.length;i++){var current=dateStart+i;m[i]=_.filter(intervals.valid,function(x){return x.start<=current&&x.end>=current}).length>0?1:0}for(var valid=[],invalid=[],sInd=-1,i=0;i<m.length;i++)m[i]&&-1==sInd&&(sInd=i),!m[i]&&sInd>=0&&(valid.push({start:dateStart+sInd,end:dateStart+i}),sInd=-1);sInd>=0&&valid.push({start:dateStart+sInd,end:dateEnd}),sInd=-1;for(var i=0;i<m.length;i++)m[i]||-1!=sInd||(sInd=i),m[i]&&sInd>=0&&(invalid.push({start:dateStart+sInd,end:dateStart+i-1}),sInd=-1);return sInd>=0&&invalid.push({start:dateStart+sInd,end:dateEnd}),valid.length&&!invalid.length?intervals.status="full":invalid.length&&items.length?intervals.status="expect":intervals.status="",intervals.valid=valid,intervals.invalid=invalid,intervals},checkAllData:function(panel,fieldNames,listFromOptimize){function compare(i,ii){return i.dateStart>ii.dateStart?1:i.dateStart<ii.dateStart?-1:i.dateEnd>ii.dateEnd?1:i.dateEnd<ii.dateEnd?-1:i.pos>ii.pos?1:i.pos<ii.pos?-1:i.org>ii.org?1:i.org<ii.org?-1:i.addr>ii.addr?1:i.addr<ii.addr?-1:0}function setFullPathForXML(item,sort){item.fullPathForXml&&(item.cloneIndex!==sort.index.toString()&&api.__addToMarkDeletedRuntime(item.fullPathForXml),item.fullPathForXml=item.fullPathForXml.replace(/workActivityPanel\[[0-9]*\]/,"workActivityPanel["+sort.index+"]"),item.cloneIndex=sort.index.toString()),item&&item.items&&item.items.length&&angular.forEach(item.items,function(item,i){setFullPathForXML(item,sort)})}function setFullPathForXMLForListFromOptimize(item,sortIndex){var fullPathForXml=item.fullPathForXml||item.cloneParent;fullPathForXml&&(item.cloneIndex!==sort.index.toString()&&api.__addToMarkDeletedRuntime(item.fullPathForXml),item.fullPathForXml=fullPathForXml.replace(/workActivityPanel\[[0-9]*\]/,"workActivityPanel["+sortIndex+"]"),item.cloneIndex=sortIndex)}var items=this.allValidItems||[],arrSort=items.sort(compare);if(!listFromOptimize){for(var parent=panel.parent().parent(),validPeriod=parent?12*parent.attr("validPeriod"):0,today=new Date,currentDate=new Date(today.getFullYear(),today.getMonth(),1),currMonth=currentDate.getMonth()+1,currYear=currentDate.getFullYear(),dateEnd=currMonth+12*(currYear-1),dateStart=currMonth+12*(currYear-1)-validPeriod,pointer=dateStart,intervals={valid:[],invalid:[]},presentInterval=null,i=0;i<items.length;i++)items[i].dateEnd==dateEnd&&(presentInterval=items[i]),items[i].dateStart&&items[i].dateEnd&&(items[i].dateStart<=pointer+1?(items[i].dateEnd>=pointer||presentInterval&&items[i].dateEnd<=presentInterval.dateEnd)&&(intervals.valid.push({start:items[i].dateStart,end:items[i].dateEnd}),pointer=items[i].dateEnd):(intervals.invalid.push({start:pointer,end:items[i].dateStart}),intervals.valid.push({start:items[i].dateStart,end:items[i].dateEnd}),pointer=items[i].dateEnd)),!presentInterval&&i==items.length-1&&items[i].dateEnd<dateEnd&&intervals.invalid.push({start:items[i].dateEnd<pointer?pointer:items[i].dateEnd,end:dateEnd});for(var m=_.range(dateEnd-dateStart).map(function(){return 0}),i=0;i<m.length;i++){var current=dateStart+i;m[i]=_.filter(intervals.valid,function(x){return x.start<=current&&x.end>=current}).length>0?1:0}for(var valid=[],invalid=[],sInd=-1,i=0;i<m.length;i++)m[i]&&-1==sInd&&(sInd=i),!m[i]&&sInd>=0&&(valid.push({start:dateStart+sInd,end:dateStart+i}),sInd=-1);sInd>=0&&valid.push({start:dateStart+sInd,end:dateEnd}),sInd=-1;for(var i=0;i<m.length;i++)m[i]||-1!=sInd||(sInd=i),m[i]&&sInd>=0&&(invalid.push({start:dateStart+sInd,end:dateStart+i-1}),sInd=-1);sInd>=0&&invalid.push({start:dateStart+sInd,end:dateEnd}),intervals.valid=valid,intervals.invalid=invalid,parent.attr("chartIntervals",intervals)}var sortedArr=this._sortItems(arrSort,fieldNames);listFromOptimize?sortedArr.length?sortedArr.forEach(function(sort){var elem=listFromOptimize.find(function(i){return i.fullPath===sort.fullPath});elem&&setFullPathForXMLForListFromOptimize(elem,sort.index.toString())}):listFromOptimize.forEach(function(elem,i){setFullPathForXMLForListFromOptimize(elem,i.toString())}):angular.forEach(sortedArr,function(sort,i){setFullPathForXML(api.find(sort.panel).element,sort)})},_sortItems:function(arrSort,fieldNames){var self=this;self.jobsData={};for(var cnt=[],i=0;i<arrSort.length;i++){var targetIndex=i,srcBlock=self.allValidItems[targetIndex];!function(srcBlock,targetBlock){var obj={},months=["","январь","февраль","март","апрель","май","июнь","июль","август","сентябрь","октябрь","ноябрь","декабрь"];angular.forEach(fieldNames,function(item,ind){obj[srcBlock.fullName+"."+item.field]={value:targetBlock[item.name]},"startMonth"!==item.name&&"endMonth"!==item.name||(obj[srcBlock.fullName+"."+item.field].text_value=months[parseInt(targetBlock[item.name],10)])}),_.extend(self.jobsData,obj)}(srcBlock,arrSort[targetIndex]),arrSort[i].index=targetIndex,cnt.push(srcBlock)}return cnt},updateChart:function(panel){},getFieldsPaths:function(){return["workActivityClones.workActivityPanel.CELL_START_MONTH.START_MONTH","workActivityClones.workActivityPanel.CELL_START_YEAR.START_YEAR","workActivityClones.workActivityPanel.CELL_END_MONTH.END_MONTH","workActivityClones.workActivityPanel.CELL_END_YEAR.END_YEAR","workActivityClones.workActivityPanel.PANEL_ATPRESENT.CELL_ATPRESENT.ATPRESENT"]},setDefaultInterval:function(data){var fields=data.fields,parent=api.find(data.parentFullPath);fields.forEach(function(item){var field=parent.find(item),fieldName=field.name();field&&fieldName&&("atpresent"===fieldName.toLowerCase()?(field.checked(data.values[fieldName.toLowerCase()]),field.value("false")):field.value(data.values[fieldName.toLowerCase()]))})},getDefaultInterval:function(){var date=new Date,month=apiInner.leadingZero(date.getMonth()+1),year=date.getFullYear();return{start_year:year-10,start_month:month,end_year:year,end_month:month,atpresent:!1}},convertItemToListItem:function(params){var element=params.element,cloneParent=element.cloneParent()||element.fullPath(),cloneId=params.cloneId,fullPath=element.fullPath(),clonesLength=params.clonesLength,isOneFieldsEmpty=!1,noClear=params.noClear,cloneFullPath=(element.find("PANEL_ATPRESENT.CELL_ATPRESENT.ATPRESENT"),void 0!==cloneId?fullPath+"["+cloneId+"]":cloneParent+"["+element.cloneIndex()+"]"),listItem={activity:function(){var visibleRadio=params.visibleRadioValue,activity=visibleRadio?visibleRadio.value:"",result={value:activity,textValue:visibleRadio?visibleRadio.textValue||"":"",fieldName:visibleRadio?visibleRadio.name||"":""};switch(activity){case"1":return result.icon="work",result.text="Работа",result;case"2":return result.icon="edu",result.text="Учеба",result;case"3":return result.icon="military",result.text="Военная служба",result;case"4":return result.icon="other",result.text="Иное",result}}(),fullPath:cloneFullPath,cloneParent:cloneParent+"[0]"};return params.fieldNames.forEach(function(item){var el=element.find(item.field),value=el.value()||"";value||(isOneFieldsEmpty=!0);var textValue="function"==typeof el.text_value;"function"==typeof el.textValue?(listItem[item.name]={textValue:el.textValue()||"",value:value},void 0===cloneId||noClear||el.value("false")&&el.checked&&el.checked(!1)):(listItem[item.name]=textValue?{text_value:el.text_value()||"",value:value}:value,void 0===cloneId||noClear||el.value("")&&el.text_value&&el.text_value("")),el.text_value&&PGU.Events.publish(el.fullPath()+":removeCurrentItem"),el.disabled(!1),el.element.reserveDisabled&&(el.element.reserveDisabled={})}),clonesLength&&isOneFieldsEmpty?null:(void 0===cloneId||noClear||element.cloneId(element.cloneId()+1),listItem.dateStart=parseInt(listItem.startMonth.value,10)+12*(parseInt(listItem.startYear.value,10)-1),listItem.dateEnd=parseInt(listItem.endMonth.value,10)+12*(parseInt(listItem.endYear.value,10)-1),listItem)}}}]).factory("panelWorkActivityStructure",["$rootScope","$moment",function($rootScope,$moment){return{setSexStatuses:function(sexField,radio,ui,needUpdateRadio){if(!(this.study&&this.study.length&&ui.isMobile)||needUpdateRadio){radio.list=[];var sex,envUser=$rootScope.settings.user,envUserGender=envUser.gender||"";if(!envUserGender||sexField&&sexField.element){ui.isNotSelf=!0;sex=sexField&&sexField.element&&"1"===sexField.element.value?"M":"F"}else sex=envUserGender||"F";var category,birthDate=$rootScope.user?$rootScope.user.birthDate||"":"",age=$moment().diff($moment(birthDate,"DD.MM.YYYY"),"years");switch(sex){case"F":category=age<18?"Учащаяся":"Студентка",radio.list.push({label:ui.isNotSelf?"Работала":"Я работала",value:"1"}),radio.list.push({label:ui.isNotSelf?"Училась":"Я училась",value:"2"}),radio.list.push({label:ui.isNotSelf?"Служила":"Я служила",value:"3"}),radio.list.push({label:ui.isNotSelf?"Не работала (иное)":"Я не работала (иное)",value:"4"});break;default:category=age<18?"Учащийся":"Студент",radio.list.push({label:ui.isNotSelf?"Работал":"Я работал",value:"1"}),radio.list.push({label:ui.isNotSelf?"Учился":"Я учился",value:"2"}),radio.list.push({label:ui.isNotSelf?"Служил":"Я служил",value:"3"}),radio.list.push({label:ui.isNotSelf?"Не работал (иное)":"Я не работал (иное)",value:"4"})}this.study=category}},getDataForField:function(sex,isMobile){return{1:{org:{visible:!0,label:"Место работы (без сокращений)"},position:{label:sex?"Должность (без сокращений)":"Ваша должность (без сокращений)",visible:!0},address:{value:"",label:"Укажите адрес",customError:"Поле обязательно для заполнения",hint:"Адрес мест трудовой или учебной деятельности необходимо указывать в следующем порядке: страна, область, город, район, улица, дом"}},2:{org:{visible:!0,label:"Место учебы (без сокращений)"},position:{visible:!0,label:sex?"Учащийся или студент?":"Вы учащийся или студент?",value:this.study||""},address:{value:"",label:"Укажите адрес учебного заведения",customError:"Поле обязательно для заполнения",hint:"Адрес мест трудовой или учебной деятельности необходимо указывать в следующем порядке: страна, область, город, район, улица, дом"}},3:{org:{visible:!0,label:"Номер части и род (вид) войск"},position:{visible:!0,label:"Воинская должность и звание"},address:{value:"",label:"Адрес расположения воинской части",hint:"Адрес расположения войсковой части",customError:"Поле обязательно для заполнения"}},4:{org:{visible:!1,forceXml:!isMobile,label:"Место работы(без аббревиатур и без сокращений)",value:sex&&"1"==sex.value?"Не работал":"Не работала"},position:{visible:!1,forceXml:!isMobile,value:sex&&"1"==sex.value?"Не работал":"Не работала",label:sex?"Учащийся или студент?":"Вы учащийся или студент?"},address:{label:"Адрес регистрации в данный период",hint:"Адрес в формате, страна, область, город, район, улица, дом",customError:"Поле обязательно для заполнения: Адрес регистрации, предзаполняем текущим значением Адреса регистрации",value:$rootScope.user&&$rootScope.user.registrationAddress?$rootScope.user.registrationAddress:""}}}},setLabelsFromRadioValue:function(params){var dataMobile=this.getDataForField(params.sex,params.isMobile),obj={position:params.position,org:params.org,address:params.address},val=params.val||"1";for(var key in obj)obj.hasOwnProperty(key)&&(params.fromDraft?("address"===key&&(dataMobile[val][key].value=obj[key].value),"2"===val&&"position"===key&&(dataMobile[val][key].value=obj[key].value)):obj[key].value="",obj[key]=angular.extend(obj[key],dataMobile[val][key]),"address"===key&&(obj[key].hintHtml=dataMobile[val][key].hint||""))},getStructure:function(){var structure={className:"Panel",name:"workActivityClones",handlers:[],title:"",isCloneContainer:!0,items:[{className:"Panel",name:"workActivityPanel",title:"",clonable:!0,isWorkActivity:!0,cloneButtonName:"Добавить данные",cloneIndex:"0",maxCloned:120,saveDraft:["cloneIndex"],items:[{className:"Panel",name:"Panel10",title:"",isGridItem:!0,doNotSaveDraft:!0,items:[{className:"FieldRadio",name:"FieldRadio11",label:"",list:$rootScope.settings.mobOptimizeWorkActivity?[]:[{value:"1",label:"Я работал"},{value:"2",label:"Я учился"},{value:"3",label:"Я служил"},{value:"4",label:"Я не работал (иное)"}],textValue:"",listMode:"horizontal",draftValue:"",required:!0},{className:"FieldRadio",name:"FieldRadio22",label:"",visible:!1,list:[{value:"1",label:"Я работала"},{value:"2",label:"Я училась"},{value:"3",label:"Я служила"},{value:"4",label:"Я не работала (иное)"}],textValue:"",listMode:"horizontal",draftValue:"",required:!0}]},{className:"Panel",name:"CELL_START_MONTH",title:"",isGridItem:!0,gridWidth:"two-sixths",gridWidthMobile:$rootScope.settings.mobOptimizeWorkActivity?"one-half":"one-whole",items:[{className:"FieldMonthExt",name:"START_MONTH",validators:[{mnemonic:"required"}],required:!0,label:" С какого месяца",format:"dd.mm.yyyy",text_value:""}]},{className:"Panel",name:"CELL_START_YEAR",title:"",isGridItem:!0,gridWidth:"one-sixth",gridWidthMobile:$rootScope.settings.mobOptimizeWorkActivity?"one-half":"one-whole",items:[{className:"FieldYear",name:"START_YEAR",validators:[{mnemonic:"required"}],required:!0,label:"Года",limits:"|1964|current||",format:"dd.mm.yyyy",sortingType:"sortDesc"}]},{className:"Panel",name:"CELL_END_MONTH",title:"",isGridItem:!0,gridWidth:"two-sixths",gridWidthMobile:$rootScope.settings.mobOptimizeWorkActivity?"one-half":"one-whole",items:[{className:"FieldMonthExt",name:"END_MONTH",notRequiredText:"",required:!0,label:"По какой месяц",format:"dd.mm.yyyy",text_value:""}]},{className:"Panel",name:"CELL_END_YEAR",title:"",isGridItem:!0,gridWidth:"one-sixth",gridWidthMobile:$rootScope.settings.mobOptimizeWorkActivity?"one-half":"one-whole",items:[{className:"FieldYear",name:"END_YEAR",handlers:[],validators:[],notRequiredText:"",required:!0,label:"Год",limits:"|1964|current||",format:"dd.mm.yyyy",sortingType:"sortDesc"}]},{className:"Panel",name:"PANEL_ATPRESENT",title:"",items:[{className:"Panel",name:"Panel21",title:"",isGridItem:!0,gridWidth:"one-half",gridWidthMobile:"one"},{className:"Panel",name:"CELL_ATPRESENT",title:"",isGridItem:!0,gridWidth:"one-half",items:[{className:"FieldCheckbox",name:"ATPRESENT",label:"По настоящее время",marginTop:"half"}]}]},{className:"Panel",name:"CELL_POSITION",title:"",isGridItem:!0,gridWidth:"one-half",items:[{className:"FieldText",name:"POSITION",validators:[{mnemonic:"FMS_workAtivityText",message:"Допустимые символы: 33 прописные и строчные буквы русского алфавита; 26 прописных и строчных букв латинского алфавита; арабские цифры; специальные знаки: « » (знак пробела), «(», «)», «?», «.», «\"», «,», «#», «№», «:», «;», «-», «+», «/», «'», «*»"},{mnemonic:"required"}],required:!0,label:"Ваша должность",maxlength:150}]},{className:"Panel",name:"CELL_ORG",title:"",isGridItem:!0,gridWidth:"one-half",items:[{className:"FieldText",name:"ORG",validators:[{mnemonic:"FMS_workAtivityText",message:"Допустимые символы: 33 прописные и строчные буквы русского алфавита; 26 прописных и строчных букв латинского алфавита; арабские цифры; специальные знаки: « » (знак пробела), «(», «)», «?», «.», «\"», «,», «#», «№», «:», «;», «-», «+», «/», «'», «*»"},{mnemonic:"required"}],required:!0,label:"Место работы"}]},{className:"Panel",name:"CELL_ADDRESS",title:"",isGridItem:!0,items:[{className:"FieldText",name:"ADDRESS",validators:[{mnemonic:"FMS_workAtivityText",message:"Допустимые символы: 33 прописные и строчные буквы русского алфавита; 26 прописных и строчных букв латинского алфавита; арабские цифры; специальные знаки: « » (знак пробела), «(», «)», «?», «.», «\"», «,», «#», «№», «:», «;», «-», «+», «/», «'», «*»"},{mnemonic:"required"}],required:!0,label:"Укажите адрес",maxlength:150,hint:"Адрес мест трудовой или учебной деятельности необходимо указывать в следующем порядке: страна, область, город, район, улица, дом"}]}]}]};if(device.mobile()&&$rootScope.settings.mobOptimizeWorkActivity){structure.title="Новая запись о деятельности";var items=structure.items[0].items,begin=items.splice(0,3),atpresent=items.splice(2,1);begin[0].items[0].required=!0,structure.items[0].items=begin.concat(atpresent,items);var changeRequired=function(element){if(!element.items||!element.items.length)return element.validators=[{mnemonic:"required"}],element.required=!1,element.addToXml=!1,element.notRequiredText="",void("FieldRadio"==element.className&&(element.value="1"));element.items.forEach(function(item){changeRequired(item)})};changeRequired(structure)}return angular.copy(structure)}}}]).filter("intervalFilled",["apiInner",function(apiInner){return function(input,type){if(!input||!input.valid||!input.valid.length)return"0 лет";for(var res=0,i=0;i<input.valid.length;i++)res+=input.valid[i].end-input.valid[i].start;return"month"==type?res:Math.floor(res/12)+" "+apiInner.getRightName(Math.floor(res/12))}}]).filter("intervalNotFilled",["apiInner",function(apiInner){return function(input,type){if(!input||!input.invalid||!input.valid)return"10 лет";if(!input.invalid.length&&!input.valid.length)return"10 лет";for(var res=0,i=0;i<input.invalid.length;i++)res+=input.invalid[i].end-input.invalid[i].start;return"month"==type?res:Math.ceil(res/12)+" "+apiInner.getRightName(Math.ceil(res/12))}}]).filter("intervalDate",["$moment",function($moment){return function(input,type){var today=new Date,currentDate=new Date(today.getFullYear(),today.getMonth(),1),period=(currentDate.getMonth(),currentDate.getFullYear(),1*input),periodYear=Math.floor(period/12),periodMonth=input-12*periodYear,res=new Date(periodYear+1,periodMonth-1,1);return{start:["января","февраля","марта","апреля","мая","июня","июля","августа","сентября","октября","ноября","декабря"],end:["январь","февраль","март","апрель","май","июнь","июль","август","сентябрь","октябрь","ноябрь","декабрь"]}[type][res.getMonth()]+" "+res.getFullYear()}}]).directive("intervalScrollTo",["$timeout",function($timeout){return{restrict:"A",scope:{scrollTo:"=intervalScrollTo"},link:function(scope,element,attrs){scope.$watch("scrollTo",function(val){$timeout(function(){val?$(element).animate({top:val-$(".PGU-Additional").offset().top+"px"},300):$(element).css("top","0")},100)})}}}]).directive("circularProgress",[function(){return{restrict:"E",scope:{filled:"=",all:"="},link:function(scope,element,attrs){function draw(){var percent=Math.round(scope.filled/scope.all*100)||0;ctx.clearRect(0,0,canvas.width,canvas.height),drawLine(0,1,green),prev&&percent?100!==prev?(drawLine(0,prev/100,red,!0),prev<percent?drawAnimGreen(prev,percent):drawAnimRed(prev,percent)):drawAnimRed(prev,percent):percent?percent<100&&drawLine(0,percent/100,red,!0):percent||drawLine(0,1,red,!0),prev=percent}function drawAnimGreen(val,finish){var timer=setInterval(function(){val>=finish&&clearInterval(timer),drawLine(val/100,(val+1)/100,green,!1),val++},30)}function drawAnimRed(val,finish){var timer=setInterval(function(){val<=finish&&clearInterval(timer),drawLine((val-1)/100,val/100,red,!1),val--},30)}function drawLine(start,end,color,rotate){ctx.beginPath(),ctx.arc(canvas.width/2,canvas.height/2,55,start*Math.PI*2-Math.PI/2,end*Math.PI*2-Math.PI/2,rotate),ctx.strokeStyle=color,ctx.lineCap="square",ctx.lineWidth=5,ctx.stroke()}var canvas=document.createElement("canvas"),span=document.createElement("span"),green="#2cc846",red="#e05050";span.style.position="absolute",span.style.top="67px",span.style.left="0px",span.style.right="0px",span.style.textAlign="center",span.style.fontFamily="ekibastuz",span.style.fontWeight="200",span.style.fontSize="24px",span.textContent="10 лет";var ctx=canvas.getContext("2d");canvas.width=120,canvas.height=120;var prev;element.append(canvas),element.append(span),scope.$watch("filled",function(val){void 0!==val&&draw()})}}}]).directive("lineProgress",[function(){return{restrict:"E",scope:{intervals:"=",all:"="},link:function(scope,element,attrs){function drawLine(start,end,color){line.beginPath(),line.moveTo(start,0),line.lineTo(end,0),line.strokeStyle=color,line.stroke()}var canvas=document.createElement("canvas"),ctx=canvas.getContext("2d"),lineCanvas=document.createElement("canvas"),line=lineCanvas.getContext("2d"),today=new Date,currentDate=new Date(today.getFullYear(),today.getMonth(),1),validPeriod=12*scope.all,currMonth=currentDate.getMonth()+1,currYear=currentDate.getFullYear(),dateStart=currMonth+12*(currYear-1)-validPeriod,text=document.createElement("span");canvas.className="border",lineCanvas.className="range",text.innerHTML=today.getFullYear()-10+" &rarr; "+today.getFullYear(),text.className="text",lineCanvas.height=canvas.height=8,lineCanvas.width=canvas.width=screen.width,ctx.strokeStyle="#969696",lineCanvas.strokeStyle="#969696",line.lineCap="butt",line.lineWidth=20,ctx.lineWidth=1;for(var positions=[],i=1;i<=10;i++)ctx.strokeRect(positions[i-2]||0,0,canvas.width/10,canvas.height),positions.push(canvas.width/10*i);element.append(lineCanvas),element.append(canvas),element.append(text),scope.$watch("intervals",function(intervals){if(void 0!==intervals)for(var key in intervals)Array.isArray(intervals[key])&&intervals[key].forEach(function(item){drawLine(Math.round(lineCanvas.width*(item.start-dateStart)/validPeriod),Math.round(lineCanvas.width*(item.end-dateStart)/validPeriod),"valid"==key?"#0063B0":"#fff")})})}}}]),angular.module("serverFormWidgets.general").directive("epguFieldMap",["fieldMapProperties","TEMPLATES","api","$rootScope","$timeout","$compile","pguSelectService","sharedExtServices","PGU","$window","$q","declineOfUnit","LOC",function(fieldMapProperties,TEMPLATES,api,$rootScope,$timeout,$compile,pguSelectService,sharedExtServices,PGU,$window,$q,declineOfUnit,LOC){return{template:'<div ng-include="getTemplateUrl()"></div>',replace:!0,scope:{item:"="},link:function(scope,element,attrs){function selectItem(data){data.value&&PGU.Events.publish(scope.item.fullPath+"_map:changeFilter",data)}function addDropdown(){var label="Выберите местоположение в день голосования (город, улица, станция метро)";scope.item._geoItems=[],geoSearchDropdown={className:"FieldDropdown",name:"geoSearchDropdown",label:label,selectType:"FieldDropdownExt",visible:!0,required:!1,fullPath:scope.item.fullPath?scope.item.fullPath+"._geoSearchDropdown":"_geoSearchDropdown",availableForHide:!1,geoSearchDropdown:!0,dictionary:{},withoutCache:!1,getFullResult:!1,searchBar:!0,geoSearchCallback:selectItem},scope.isMobile?geoSearchDropdown.longLabel=label:geoSearchDropdown.label=label,scope.item._geoItems.push(geoSearchDropdown),api.initAttrs(scope.item._geoItems)}function addPriorityAddress(){var priorityAddr={className:"FieldText",name:"priorityAddress",visible:!0,withoutApi:!0,value:$rootScope.userSelectedRegionValue?$rootScope.userSelectedRegionValue:scope.esiaAddress,fullPath:scope.item.fullPath?scope.item.fullPath+"._priorityAddress":"_priorityAddress"};scope.item._extAddr=[],scope.item._extAddr.push(priorityAddr),priorityAddr.value&&addrPaths.push(priorityAddr.fullPath),api.initAttrs(scope.item._extAddr)}function fieldMapWithList(){function subscribeOnAddressChange(evt,data){var fiasAddress,mustChangeAddress=!0,regionCode=data.regionKladrCode&&data.regionKladrCode.substring(0,2)||"";if(addressPaths.length>1){var path=evt.name.split(":")[1],visible=api.inheritedVisibility(addressPaths[1]);mustChangeAddress=visible&&path===addressPaths[1]||!visible&&path===addressPaths[0]}data.visible&&mustChangeAddress&&previousAddress!==data.fias_full_code&&(scope.isMobile?(previousAddress=data.fias_full_code,"91"==regionCode&&(regionCode="93"),"92"==regionCode&&(regionCode="94"),$rootScope.geoCoderInitAddress.kladrCode=regionCode,addressPaths.length>1&&($rootScope.geoCoderInitAddress.fullAddress=data.fullAddress),fiasAddress=fieldMapProperties.getGeoSearchDataFromFias(data),$rootScope.geoCoderInitAddress.geoSearchDropdownVal=fiasAddress,scope.clearWidgetAllParams(),scope.model.options.subjCode=fieldMapProperties.getCodeWithoutStartZero($rootScope.geoCoderInitAddress.kladrCode),scope.model.options.oikNum="",scope.addressForMobile=fiasAddress,scope.fullAddressForMobile=data.fullAddress):(scope.isVisibleMap&&scope.isVisibleMap(),api.inheritedVisibility(scope.item.fullPath)?(previousAddress=data.fias_full_code,"91"==regionCode&&(regionCode="93"),"92"==regionCode&&(regionCode="94"),$rootScope.geoCoderInitAddress.kladrCode=regionCode,addressPaths.length>1&&($rootScope.geoCoderInitAddress.fullAddress=data.fullAddress),fiasAddress=fieldMapProperties.getGeoSearchDataFromFias(data),$rootScope.geoCoderInitAddress.geoSearchDropdownVal=fiasAddress,scope.clearWidgetAllParams(),scope.model.options.subjCode=fieldMapProperties.getCodeWithoutStartZero($rootScope.geoCoderInitAddress.kladrCode),scope.model.options.oikNum="",PGU.Events.publish("fiasChanged:"+scope.item.fullPath+"_map",{fiasAddress:fiasAddress})):scope.isVisibleMap=scope.$watch(function(){return api.inheritedVisibility(scope.item.fullPath)},function(val,oldVal){if(val){if(path===addressPaths[1]&&addressPaths[1]&&!api.inheritedVisibility(addressPaths[1]))return void scope.isVisibleMap();previousAddress=data.fias_full_code,"91"==regionCode&&(regionCode="93"),"92"==regionCode&&(regionCode="94"),$rootScope.geoCoderInitAddress.kladrCode=regionCode,addressPaths.length>1&&($rootScope.geoCoderInitAddress.fullAddress=data.fullAddress);var fiasAddress=fieldMapProperties.getGeoSearchDataFromFias(data);$rootScope.geoCoderInitAddress.geoSearchDropdownVal=fiasAddress,scope.clearWidgetAllParams(),scope.model.options.subjCode=fieldMapProperties.getCodeWithoutStartZero($rootScope.geoCoderInitAddress.kladrCode),scope.model.options.oikNum="",scope.clearWidgetAllParams(),PGU.Events.publish("fiasChanged:"+scope.item.fullPath+"_map",{fiasAddress:fiasAddress}),scope.isVisibleMap()}})))}scope.model={},scope.model.searchDivision={},scope.model.mapInput={visible:!0,value:"",fullPath:scope.item.fullPath+"_mapInput"},scope.model.redraw=0,scope.model.options={},scope.model.options.voteDate=electionDate,scope.model.options.clusterBalloon={},scope.model.options.isWithList=!0,$rootScope.geoCoderInitAddress={};var addressPaths,previousAddress="";$rootScope.isDesigner||(addPriorityAddress(),scope.model.options.cacheIds=[],scope.model.options.mappingAttributes=scope.item.dictionary.mappingAttributes,scope.model.options.setGeoSearchDropdownVal=function(value,textValue){geoSearchDropdown.value=value,geoSearchDropdown.text_value=textValue},scope.model.filterChange={},scope.item.withGeoCoderSearch?(scope.model.options.voteLevel=voteLevel&&voteLevel.value()||"1",scope.item.subjCode=subjCode&&subjCode.value()?subjCode.value():"1",scope.item.okrugNum=oikNum&&oikNum.value()?oikNum.value():"1",scope.item.subjCode&&(scope.item.withSingleMandate=!1),(scope.item.addressPath||addrPaths.length)&&(addressPaths=scope.item.addressPath?scope.item.addressPath.split(","):[],scope.model.options.withDigitalPath=scope.item.withDigitalPath,addressPaths.forEach(function(i){if(PGU.Events.subscribe("saveFormData",i,subscribeOnAddressChange),api.inheritedVisibility(i)&&api.inheritedVisibility(scope.item.fullPath)){var df=$q.defer();sharedExtServices.normalizeAddressInDaData({
q:api.find(i).value()},function(data){df.resolve(data)},function(){df.resolve()}),df.promise.then(function(data){var fiasAddress={},regionCode="";if(data&&data.address&&data.address.elements)data.address.elements.forEach(function(i){1===i.level?(fiasAddress.region=i.data,fiasAddress.regionType=i.type,fiasAddress.regionFiasCode=i.fiasCode,fiasAddress.regionKladrCode=i.kladrCode.substring(0,2)):3===i.level?(fiasAddress.area=i.data,fiasAddress.areaType=i.type):4===i.level&&(fiasAddress.city=i.data,fiasAddress.cityType=i.type)}),fiasAddress.fullAddress=data.address.fullAddress,fiasAddress.fias_full_code=data.address.fiasCode;else{var el=api.find(i).element;fiasAddress={region:el.region,regionType:el.regionType,regionFiasCode:"МОСКВА"===el.region.toUpperCase()?"0c5b2444-70a0-4932-980c-b4dc0d3f02b5":"",regionKladrCode:el.region_code.substring(0,2),city:el.city,cityType:el.cityType,area:el.area,areaType:el.areaType,fias_full_code:el.fias_full_code,fullAddress:el.value}}fiasAddress.visible=!0,$rootScope.geoCoderInitAddress.geoSearchDropdownVal=fieldMapProperties.getGeoSearchDataFromFias(fiasAddress),regionCode="91"==fiasAddress.regionKladrCode?"93":"92"==fiasAddress.regionKladrCode?"94":fiasAddress.regionKladrCode,$rootScope.geoCoderInitAddress.kladrCode=regionCode,addressPaths.length>1&&($rootScope.geoCoderInitAddress.fullAddress=fiasAddress.fullAddress,previousAddress=fiasAddress.fias_full_code),PGU.Events.publish("geoCoderInitAddress:"+scope.item.fullPath+"_map",$rootScope.geoCoderInitAddress)})}})),scope.item.subjCode&&!scope.item.addressPath&&(scope.model.options.isOnlyBounds=!0,fieldMapProperties.getFiasDataFromUserRegionTitle($rootScope.userSelectedRegion||api.env("userSelectedRegion")).then(function(fiasAddress){$rootScope.geoCoderInitAddress.geoSearchDropdownVal=fieldMapProperties.getGeoSearchDataFromFias(fiasAddress),$rootScope.geoCoderInitAddress.kladrCode=fiasAddress.regionKladrCode,$rootScope.geoCoderInitAddress.fullAddress=fiasAddress.fullAddress,PGU.Events.publish("geoCoderInitAddress:"+scope.item.fullPath+"_map",$rootScope.geoCoderInitAddress)})),addDropdown()):scope.item.initRequest&&loadData(void 0),setPlaceMarkClick(),scope.model.options.afterUserClose=function(){scope.cancelSelect(),api.applyScope()},scope.openBaloon=function(elem){scope.cancelSelect(),scope.showConfirmAfterRemove=!0,scope.model.activeValue=elem.value,scope.model.elementId=elem.elementId,$timeout(function(){PGU.Events.publish(":"+scope.model.mapList[0].fullPath+"_map_centered",{coords:elem.center,id:elem.id}),scope.model.openedVal={address:elem.attributeValues.address_out?elem.attributeValues.address_out:elem.attributeValues.Address_MO,elementId:elem.elementId}},500)},scope.model.options.ballonButtonClick=function(addr,elementId,notCoords,itemData){if(!scope.item.withGeoCoderSearch||!scope.item.needChangeColorBtn){if(scope.model.tempElementId=elementId,scope.model.tempItemData=itemData,api.find(scope.item.fullPath).pdf=scope.model,scope.isMobile)return scope.mobile.setCurrentItem(addr,!0,elementId,itemData);itemData&&scope.model.activeValue!==itemData.value&&(scope.model.activeValue=itemData.value,scope.model.elementId=elementId),scope.model.selectedElement||notCoords?notCoords?scope.showAcceptWithoutPin(scope.model.selectedElement):(scope.model.selectedAddr=addr,scope.showAcceptWindow()):scope.confirmSelect(elementId,itemData),api.find(scope.item.fullPath).validate(),scope.model.searchDivision={},api.env("autosaveDisabled")||api.uploadDraft(!1,null,null,!1,scope.item),"true"===$rootScope.env.formParam.isLogElForm&&$rootScope.$emit("HEALTH_SEND",{event:"logElForm",timing:0,result:4,el:scope.model.fullPath,order_id:api.env("orderId")})}},scope.showAcceptWindow=function(){scope.model.showConfirm=!0,scope.showConfirmAfterRemove=!0},scope.confirmSelect=function(elementId,itemData){if(scope.model.selectedElement=itemData||scope.model.tempItemData||fieldMapProperties.getElemFromAddr(scope.model.selectedAddr,scope.model.mapList,elementId||scope.model.tempElementId),scope.item.withGeoCoderSearch){var tid=scope.model.tempItemData,uikNumber=tid.numIk||tid.numberuik;$rootScope.geoCoderInitAddress.numberUik=uikNumber;var uikText=scope.item.subjCode&&scope.model.options.isOnlyBounds?" участок для голосования ":" избирательный участок ";if(scope.model.selectedElement.underMapInfo=[{label:"Вы выбрали"+uikText+"№"+uikNumber,value:tid.addressP||tid.address}],!scope.item.withSingleMandate&&electionDate){var otherCampaign="";scope.item.subjCode?(scope.model.options.isOnlyBounds?scope.model.selectedElement.underMapInfo.push({value:"<b>"+electionDate+" на выбранном участке для голосования пройдёт общероссийское голосование по вопросу одобрения изменений в Конституцию Российской Федерации</b>",label:""}):tid.votingList.forEach(function(li){otherCampaign+=li.namVibor+"<br/>"}),otherCampaign&&scope.model.selectedElement.underMapInfo.push({label:electionDate+" на выбранном избирательном участке проводятся выборы по избирательным кампаниям: ",value:otherCampaign})):(tid.votingList.forEach(function(item){2===item.level&&(otherCampaign+=item.name+"<br/>")}),otherCampaign&&scope.model.selectedElement.underMapInfo.push({label:electionDate,value:otherCampaign}))}scope.model.selectedElement&&!scope.model.selectedElement.btnFromCluster&&(scope.item.needChangeColorBtn=!0)}scope.saveSelectedItemToWidget(),fieldMapProperties.mapBindings(scope.model.selectedElement,scope.item),scope.cancelSelect()},scope.cancelSelect=function(){scope.model.selectedAddr=void 0,scope.model.showConfirm=!1,scope.model.showAcceptWithoutPinSelected=!1,scope.model.showAcceptWithoutPin=!1,scope.model.tempElementId=""},scope.clearWidget=function(){scope.item.text_value=scope.item.textValue="",scope.model.selectedElement=void 0,scope.item.needChangeColorBtn=!1},scope.clearWidgetAllParams=function(){scope.cancelSelect(),scope.clearWidget()},scope.saveSelectedItemToWidget=function(){scope.model.selectedElement?(scope.item.value=scope.model.selectedElement.value||scope.model.selectedElement.address||"",scope.item.text_value=scope.item.textValue=scope.model.selectedElement.title||scope.model.selectedElement.numIk||scope.model.selectedElement.nameIk||""):(scope.item.value="",scope.clearWidget())},PGU.Events.subscribe("","__changeMap",function(){scope.model.showConfirm&&(scope.model.showConfirm=!1,scope.$apply())}))}function fieldMapWithListDC(){function cancelSelectDC(){PGU.Events.publish(":"+scope.item.fullPath+"_map_closeBaloon"),scope.model.showAcceptWithoutPinSelected=!1,scope.model.showAcceptWithoutPin=!1}scope.model={},scope.model.searchDivision={},scope.model.mapInput={visible:!0,value:"",fullPath:scope.item.fullPath+"_mapInput"},scope.model.options={},scope.model.options.isWithList=!0,scope.model.options.selectedIds=[],scope.item.selectedItems=[],scope.item.fieldMapListBtnText=scope.item.fieldMapListBtnText||"Добавить",scope.item.fieldMapListBtnDeleteText=scope.item.fieldMapListBtnDeleteText||"Удалить",scope.item.removeAllSelectedItem=function(){scope.item.selectedItems.slice().forEach(function(item){scope.deleteDC(item,!0)})},scope.item.addSelectedItem=function(value){scope.$applyAsync(function(){var el=fieldMapProperties.getElemFromValue(scope.model.list,value);scope.model.activeValue=value,el&&scope.addDC(el,!0)})},scope.item.addImportantDC=function(value){var el=fieldMapProperties.getElemFromValue(scope.model.list,value);el&&scope.setImportantDC(el)},scope.item.initRequest&&loadData(void 0,!0),setPlaceMarkClick(),scope.openBaloon=function(elem){scope.model.activeValue=elem.value,scope.model.elementId=elem.elementId,scope.model.openedVal={address:elem.attributeValues.address_out||elem.attributeValues.Address_MO,elementId:elem.elementId},scope.checkDisabledBtn(elem)},scope.checkDisabledBtn=function(elem){var isSelected=fieldMapProperties.isSelectedDC(elem,scope.item.selectedItems);elem.checkbox&&elem.checkbox.checked||isSelected?scope.item.needChangeColorBtn=!1:scope.item.needChangeColorBtn=scope.item.selectedItems.length>(scope.item.limitNumberOfEntries?scope.item.limitNumberOfEntries-1:2),elem.attributeValues.address_out||elem.attributeValues.Address_MO||elem.attributeValues.ADDRESS||scope.showAcceptWithoutPin(elem.checkbox&&elem.checkbox.checked||isSelected)},scope.model.options.ballonButtonClick=function(addr,elementId){var el=fieldMapProperties.getElemFromAddr(addr,scope.model.mapList,elementId);fieldMapProperties.isSelectedDC(el,scope.item.selectedItems)?scope.deleteDC(el):scope.addDC(el),PGU.Events.publish(scope.item.fullPath+":click",scope.model.selectedElement),api.env("autosaveDisabled")||api.uploadDraft(!1,null,null,!1,scope.item),"true"===$rootScope.env.formParam.isLogElForm&&$rootScope.$emit("HEALTH_SEND",{event:"logElForm",timing:0,result:4,el:$scope.model.fullPath,order_id:api.env("orderId")}),scope.$applyAsync()},scope.model.options.afterBaloonOpen=function(addr,elementId){var elem=fieldMapProperties.getElemFromAddr(addr,scope.model.list,elementId);scope.checkDisabledBtn(elem)},scope.toggleDC=function(value,item){scope.item.selectedItems.length>(scope.item.limitNumberOfEntries?scope.item.limitNumberOfEntries-1:2)?scope.deleteDC(item):(value&&"true"==value?scope.addDC(item):scope.deleteDC(item),PGU.Events.publish(scope.item.fullPath+":click",scope.model.selectedElement))},scope.model.options.afterUserClose=function(){scope.model.activeValue="",scope.model.openedVal={},api.applyScope()},scope.deleteDC=function(item,noRename,fromRadio){scope.model.showAcceptWithoutPin&&scope.model.showAcceptWithoutPinSelected&&scope.showAcceptWithoutPin(!1);var selectedIds=scope.model.options.selectedIds,el=fieldMapProperties.getElemFromValue(scope.model.list,item.value);el||(el=fieldMapProperties.getElemFromValue(scope.model.originList,item.value)),fieldMapProperties.removeDC(el,scope.item.selectedItems,selectedIds),scope.model.importantDC=scope.model.importantDC==item.value?"":scope.model.importantDC,el.priority&&(el.priority=2),el&&(el.checkbox={checked:!1,value:"false"},noRename||changeButtonName()),validate(),fromRadio&&(PGU.Events.publish(scope.item.fullPath+"_map:changePinBG",{objectId:el.id}),scope.checkDisabledBtn(el))},scope.addDC=function(item,noRename){if(item||(item={value:scope.model.activeValue}),!(scope.item.selectedItems.length>(scope.item.limitNumberOfEntries?scope.item.limitNumberOfEntries-1:2))){scope.model.showAcceptWithoutPin&&!scope.model.showAcceptWithoutPinSelected&&scope.showAcceptWithoutPin(!0);var el=fieldMapProperties.getElemFromValue(scope.model.list,item.value);fieldMapProperties.addDC(el,scope.item.selectedItems,scope.model.options.selectedIds),scope.model.activeValue=item.value,el&&(el.checkbox={checked:!0,value:"true",className:"isCheckboxDC"},noRename||changeButtonName()),validate()}},scope.setImportantDC=function(dc){scope.model.importantDC=dc?dc.value:"";for(var i=0;i<scope.item.selectedItems.length;i++)scope.item.selectedItems[i].priority=2;dc&&(dc.priority=1),validate()},scope.moveImportantDC=function(current,inc){var newNum=current+inc;scope.item.selectedItems.forEach(function(si){si.priorityNumber===newNum?si.priorityNumber=current:si.priorityNumber===current&&(si.priorityNumber=newNum)}),scope.item.selectedItems.sort(function(it1,it2){var a=it1.priorityNumber,b=it2.priorityNumber;return a>b?1:a<b?-1:0})};var entriesText1=["детского","детских","детских"],entriesText2=["сада","садов","садов"];scope.item.limitNumberOfEntries>50&&(scope.item.limitNumberOfEntries=50),scope.item.currentLimitNumberOfEntries=scope.item.limitNumberOfEntries,scope.item.currentLimitNumberOfEntriesText=declineOfUnit.get(scope.item.currentLimitNumberOfEntries,entriesText1)+" "+declineOfUnit.get(scope.item.currentLimitNumberOfEntries,entriesText2),PGU.Events.subscribe("","__mapIsOpened",changeButtonName),scope.$watch("item.limitNumberOfEntries",function(val,oldVal){void 0!==val&&val!==oldVal&&(scope.item.currentLimitNumberOfEntries=val,scope.item.currentLimitNumberOfEntriesText=declineOfUnit.get(val,entriesText1)+" "+declineOfUnit.get(val,entriesText2)),val>50&&val!==oldVal&&(scope.item.limitNumberOfEntries=50)}),scope.confirmSelect=scope.addDC,scope.cancelSelect=cancelSelectDC}function validate(){api.find(scope.item.fullPath).validate()}function changeButtonName(){var el=fieldMapProperties.getElemFromValue(scope.model.list,scope.model.activeValue),text=el&&el.checkbox&&el.checkbox.checked?scope.item.fieldMapListBtnDeleteText:scope.item.fieldMapListBtnText,showError=scope.item.selectedItems.length>=(scope.item.limitNumberOfEntries||3)&&!(el&&el.checkbox&&el.checkbox.checked),setText=function(){var err=$(".PGU-Panel-FieldMapWithList-DC .PGU-FieldMapContainer .PGU-FieldMapWithList-Baloon .PGU-FieldMapWithList-buttonwrap .max-error"),btn=$(".PGU-Panel-FieldMapWithList-DC .PGU-FieldMapContainer .PGU-FieldMapWithList-Baloon .PGU-FieldMapWithList-buttonwrap .PGU-Button");err.toggleClass("ng-hide",!showError),btn.length?btn.text(text):setTimeout(setText,400)};setText()}function setPlaceMarkClick(){scope.model.options.placemarkClick=function(id){if(scope.item.withGeoCoderSearch&&scope.model.selectedElement){var strId=id+"";scope.item.needChangeColorBtn=strId===scope.model.selectedElement.code}if(scope.model.showConfirm=!1,scope.model.list)for(var i=0;i<scope.model.list.length;i++)if(scope.model.list[i].id==id){scope.model.activeValue=scope.model.list[i].value,scope.$apply();break}}}function fieldMap(){scope.item.baloon=fieldMapProperties.getBaloonContent(scope.item)}function loadData(callback,isDC){if(scope.model=scope.model||{},scope.item.withGeoCoderSearch)return scope.item.subjCode?(scope.model.options.isOnlyBounds&&(loadDataIsInit=!0),loadDataIsInit?(scope.model.options.voteLevel=voteLevel.value(),scope.model.options.voteLevel=voteLevel.value(),scope.model.options.subjCode=fieldMapProperties.getCodeWithoutStartZero($rootScope.geoCoderInitAddress.kladrCode),scope.model.options.oikNum=oikNum.value(),void(!scope.isMobile&&loadDataIsInit&&(scope.model.coords=1))):void(loadDataIsInit=!0)):void(scope.isMobile||(scope.model.coords=1));scope.model.mapInput&&(scope.model.mapInput.value=""),scope.model.loading=!0;var options={refName:scope.item.dictionary.code,pageSize:"9999",pageNum:"1",item:scope.item,type:"map"};if(scope.item.filterRegion){var regionFilter=[],regionFilterValue="";if(scope.item.dictionary&&scope.item.dictionary.requestBinding&&scope.item.dictionary.requestBinding.length&&(regionFilter=scope.item.dictionary.requestBinding.filter(function(item){return item.name===scope.item.filterRegion})),regionFilter.length&&api.find(regionFilter[0].value).value()){regionFilterValue=api.find(regionFilter[0].value).value();var userOKATO=api.env("userSelectedRegionData").code+"";if(userOKATO.substr(0,2)===regionFilterValue.substr(0,2)){if(!("71"!==userOKATO.substr(0,2)&&"71"!==regionFilterValue.substr(0,2)||"711"!==userOKATO.substr(0,3)&&"711"!==regionFilterValue.substr(0,3))){var checkDitailUser=userOKATO.substr(3,1),checkDitailSelectRegion=regionFilterValue.substr(3,1);if(+checkDitailSelectRegion<4&&+checkDitailUser>=4||+checkDitailSelectRegion>4&&+checkDitailUser<=4)return void(scope.item.uncorrectedHelperBox=!0)}}else if(userOKATO.substr(0,2)!==regionFilterValue.substr(0,2))return void(scope.item.uncorrectedHelperBox=!0);scope.item.uncorrectedHelperBox=!1}}(scope.model.openedVal||scope.model.activeValue)&&(scope.model.activeValue="",PGU.Events.publish(":"+scope.item.fullPath+"_map_closeBaloon")),"function"==typeof scope.clearWidgetAllParams&&firstLoadData&&scope.clearWidgetAllParams(),pguSelectService.loadDataFromServer(options,function(data){var addressesArray=[];scope.pageNum=1,scope.model.cachedList=[],scope.model.mapList=[],scope.model.loadCoords=!0,firstLoadData=!0,isDC?(scope.model.list=pguSelectService.removeOpts(fieldMapProperties.addData(data.items||[]),scope.item.removeOpts),scope.model.mapList=fieldMapProperties.fromAttributesToMap(!0,scope.model.list,scope.item.dictionary.mappingAttributes,scope.item.fullPath,scope.item.fieldMapListBtnText,scope.item.fieldMapListBtnDeleteText,addressesArray)):scope.item.hideMapInMobile&&scope.isMobile?(scope.model.cachedList=data.items,scope.localTotal=0,scope.loadMore(),scope.model.coords=void 0,scope.model.loadCoords=!1,scope.model.loading=!1):(scope.model.list=fieldMapProperties.getAttrsForList(pguSelectService.removeOpts(data.items,scope.item.removeOpts),scope.item.dictionary.mappingAttributes),scope.model.mapList=fieldMapProperties.fromAttributesToMap(!1,scope.model.list,scope.item.dictionary.mappingAttributes,scope.item.fullPath,"","",addressesArray)),addressesArray.length?loadCoords(addressesArray):scope.item.hideMapInMobile&&scope.isMobile||(scope.model.originList=JSON.parse(JSON.stringify(scope.model.list||[])),scope.model.originMapList=JSON.parse(JSON.stringify(scope.model.mapList)),scope.model.coords=isNaN(scope.model.coords)?1:+scope.model.coords+1,scope.model.loadCoords=!1,scope.model.loading=!1),scope.item.__responseData=data,"function"==typeof callback&&callback(data)},!0)}function loadCoords(addressesArray){scope.model.loading=!0,sharedExtServices.getCoordsByAddress({address:addressesArray||fieldMapProperties.getAddrArray(scope.model.mapList)},function(res){if(res.coords&&res.coords.length){var resultHash={};res.coords.forEach(function(item,ind){resultHash[item.address]=item}),scope.item.hideMapInMobile&&scope.isMobile||scope.model.mapList.forEach(function(item,i){var coords;item.center||(coords=resultHash[item.coordsValue]||"")&&coords.latitude&&coords.longitude&&(item.center=scope.model.list[i].center=[coords.latitude,coords.longitude])}),scope.model.mapList.forEach(function(item,i){var coords;item.center||(coords=resultHash[item.coordsValue]||"")&&coords.latitude&&coords.longitude&&(item.center=scope.model.list[i].center=[coords.latitude,coords.longitude])}),scope.model.originList=JSON.parse(JSON.stringify(scope.model.list||[])),scope.model.originMapList=JSON.parse(JSON.stringify(scope.model.mapList)),scope.model.coords=isNaN(scope.model.coords)?1:+scope.model.coords+1,scope.model.loading=!1}else scope.model.originList=JSON.parse(JSON.stringify(scope.model.list||[])),scope.model.originMapList=JSON.parse(JSON.stringify(scope.model.mapList)),scope.model.coords=isNaN(scope.model.coords)?1:+scope.model.coords+1,scope.model.loading=!1;addressesArray.length=0},function(){scope.model.originList=JSON.parse(JSON.stringify(scope.model.list||[])),scope.model.originMapList=JSON.parse(JSON.stringify(scope.model.mapList)),scope.model.coords=isNaN(scope.model.coords)?1:+scope.model.coords+1,addressesArray.length=0,scope.model.loading=!1})}function initMobileProps(){scope.isMobile&&(scope.mobile={itemDetails:{},currentState:"form",currentStateObserve:"form",prevState:"",searchValue:"",showSearch:"",toggleState:function(prevState,currentState,notClearSearch){if(scope.mobile.currentState=currentState,scope.mobile.prevState=prevState,notClearSearch||scope.mobile.clearSearchField(),"form"===prevState&&(scope.model.coords||(scope.model.coords=1)),$("body").toggleClass("PGU-SF-Dialog-Show","form"!==currentState),$rootScope.inOpWidgetIframe){document.getElementsByClassName("PGU-widgets-container")[0].style.maxHeight="form"!==currentState?$rootScope.iframeDeviceHeight+"px":"100%","form"===currentState&&api.checkOpIframeScroll($('[full-path="'+scope.item.fullPath+'"]'),function(){})}scope.item.withGeoCoderSearch?"map"===currentState&&scope.fullAddressForMobile!==scope.lastFetchedAddress&&$timeout(function(){scope.lastFetchedAddress=scope.fullAddressForMobile,PGU.Events.publish("fiasChanged:"+scope.item.fullPath+"_map",{fiasAddress:scope.addressForMobile})},500,!1):$timeout(function(){scope.mobile.currentStateObserve=currentState}),("mob"===$rootScope.version&&device.tablet()||scope.orientationChanged)&&$timeout(function(){scope.mobile.currentStateObserve=currentState}),"form"===currentState&&api.scrollTo(scope.item.fullPath,"",-60)},setCurrentItem:function(value,fromAddrs,elementId,itemData){if(scope.model.selectedElement=fromAddrs?itemData||scope.model.tempItemData||fieldMapProperties.getElemFromAddr(value,scope.model.mapList,elementId):fieldMapProperties.getElemFromValue(scope.model.mapList,value),scope.item.withGeoCoderSearch){var tid=scope.model.selectedElement;if(!scope.item.withSingleMandate&&electionDate){var hasTitle;scope.model.selectedElement.attrs=[],scope.item.subjCode?scope.model.options.isOnlyBounds?scope.model.selectedElement.attrs.push({value:"<b>"+electionDate+" на выбранном участке для голосования пройдёт общероссийское голосование по вопросу одобрения изменений в Конституцию Российской Федерации</b>"}):tid.votingList.forEach(function(li){hasTitle||(scope.model.selectedElement.attrs.push({value:"<b>"+electionDate+" на выбранном избирательном участке проводятся выборы по избирательным кампаниям: </b>"}),hasTitle=!0),scope.model.selectedElement.attrs.push({value:li.namVibor})}):tid.votingList.forEach(function(item){2===item.level&&(hasTitle||(scope.model.selectedElement.attrs.push({value:"<b>"+electionDate+"</b>"}),hasTitle=!0),scope.model.selectedElement.attrs.push({value:item.name}))})}(!itemData||itemData&&!itemData.btnFromCluster)&&(scope.item.needChangeColorBtn=!0)}scope.saveSelectedItemToWidget(),scope.mobile.toggleState(scope.mobile.currentState,"form"),fieldMapProperties.mapBindings(scope.model.selectedElement,scope.item),scope.mobile.clearSearchField(),api.env("autosaveDisabled")||api.uploadDraft(!1,null,null,!1,scope.item),"true"===$rootScope.env.formParam.isLogElForm&&$rootScope.$emit("HEALTH_SEND",{event:"logElForm",timing:0,result:4,el:$scope.model.fullPath,order_id:api.env("orderId")})},toggleSearch:function(){scope.mobile.showSearch=!scope.mobile.showSearch},clearSearch:function(){scope.mobile.searchValue=""},clearSearchField:function(){scope.mobile.searchValue=""},showDetails:function(item,prevState,notClearSearch){scope.mobile.toggleState(prevState,"details",notClearSearch);var mappedConfig=fieldMapProperties.getMappedConfig(scope.item.dictionary.mappingAttributes);item.value=item.value||item.address,item.center=item.center||fieldMapProperties.getCoords(mappedConfig.coords,fieldMapProperties.getUpperCaseCoordsAttrs(item,mappedConfig.coords)).center,$rootScope.settings.mobOptimizeEqueue?item.details=item.baloonContent||item.details||fieldMapProperties.getMappedDetails(mappedConfig.details,item):item.details=item.details||fieldMapProperties.getMappedDetails(mappedConfig.details,item),scope.mobile.itemDetails=item,scope.item.isFieldMapWithListDC&&(scope.model.showAcceptWithoutPin=!scope.mobile.getItemFromMapList(item.value).coordsValue),"function"==typeof scope.checkDisabledBtn&&scope.checkDisabledBtn(item)},isSelectedDC:function(item){return fieldMapProperties.isSelectedDC(item,scope.item.selectedItems)},getItemFromMapList:function(value){if(value)return fieldMapProperties.getElemFromValue(scope.model.mapList,value)}},$rootScope.settings.mobOptimizeEqueue&&(scope.mobile.selectPlacemark=function(elem,prevState,notClearSearch){scope.mobile.toggleState(prevState,"map",notClearSearch),scope.item.selectPlacemarkData={coords:elem.center,id:elem.id}}),scope.$watch("mobile.searchValue",function(val,oldVal){val!==oldVal&&(scope.filterMapItems&&$timeout.cancel(scope.filterMapItems),scope.filterMapItems=$timeout(function(){PGU.Events.publish(":"+scope.item.fullPath+"_map_closeBaloon");var searchVal=val.toUpperCase();scope.item.hideMapInMobile?(scope.model.mapList=[],scope.pageNum=1,scope.localTotal=0,scope.localSearchValue=searchVal,scope.loadMore()):(scope.model.list=scope.model.originList.filter(function(item,index){var checkingTitle=item.title.toUpperCase();return item.id=index,checkingTitle.indexOf(searchVal)>-1}),scope.model.mapList=fieldMapProperties.fromAttributesToMap(!1,scope.model.list,scope.item.dictionary.mappingAttributes,scope.item.fullPath,"","",void 0,void 0,!0),scope.model.coords=isNaN(scope.model.coords)?1:+scope.model.coords+1),api.applyScope()},400,!1))}))}function initNavigation(){function navigation(key){switch(key){case"down":changeHoveredItem("next"),checkAndDoScroll();break;case"up":changeHoveredItem("prev"),checkAndDoScroll();break;case"enter":scope.hoveredItem>-1&&scope.model.list[scope.hoveredItem]&&scope.openBaloon(scope.model.list[scope.hoveredItem])}}function changeHoveredItem(moveDirection){"next"===moveDirection?-1!==scope.hoveredItem&&scope.hoveredItem<scope.model.list.length-1?scope.hoveredItem++:scope.hoveredItem=0:"prev"===moveDirection&&(-1===scope.hoveredItem||0===scope.hoveredItem?scope.hoveredItem=scope.model.list.length-1:scope.hoveredItem--)}function checkAndDoScroll(){el||(el=angular.element(element[0].nextSibling),list=el.find("ul"),listContainer=angular.element(list[0].parentElement)[0],listContainerHeight=listContainer.offsetHeight);var currentItem=list.find("li")[scope.hoveredItem];if(currentItem){var optionsOuterHeight=currentItem.offsetHeight,itemOffsetInContainer=currentItem.getBoundingClientRect().top-listContainer.getBoundingClientRect().top;listContainerHeight<itemOffsetInContainer+optionsOuterHeight?listContainer.scrollTop+=itemOffsetInContainer+optionsOuterHeight-listContainerHeight:itemOffsetInContainer<0&&(listContainer.scrollTop+=itemOffsetInContainer)}}var navigateKeycodes={13:"enter",38:"up",40:"down"};scope.hoveredItem=-1,$rootScope.$on(scope.item.fullPath+"_mapInput:keyup",function(evt,data){var key=navigateKeycodes[data&&data.keyCode];scope.model.list&&key&&navigation(key)}),$rootScope.$on(scope.item.fullPath+"_mapInput:blur",function(evt,data){scope.hoveredItem=-1}),scope.mouseenterElement=function(currentItem){scope.hoveredItem=currentItem},scope.mouseleaveElement=function(){scope.hoveredItem=-1};var el,list,listContainer,listContainerHeight}var addrPaths=[];scope.isElection="true"===$rootScope.env.formParam.election,scope.esiaAddress=function(){var address={};return $rootScope.settings&&$rootScope.settings.user&&$rootScope.settings.user.addresses&&$rootScope.settings.user.addresses.length&&$rootScope.settings.user.addresses.forEach(function(item){"PRG"===item.type&&(address=item)}),address&&address.addressStr?address.addressStr:""}(),scope.prevDeviceState=scope.isMobile=api.isMobile();LOC.EPGU_URI;angular.element($window).bind("orientationchange",function(){if(scope.isMobile=api.isMobile(),scope.orientationChanged=!0,scope.prevDeviceState!==scope.isMobile){var prevSelectedElement=scope.model.selectedElement;scope.getTemplateUrl(),scope.initMapParams(),scope.item.getList(),scope.model.selectedElement=prevSelectedElement,scope.saveSelectedItemToWidget()}api.applyScope()}),scope.getTemplateUrl=function(){return!$rootScope.isDesigner&&scope.isMobile&&"FieldMap"!==scope.item.className?"FieldMapWithListDC"==scope.item.className?TEMPLATES.FIELD_MAP_WITH_LIST_DC_MOBILE:TEMPLATES.FIELD_MAP_WITH_LIST_MOBILE:$rootScope.isDesigner?"js/designer/overrideTmpl/FieldMap/FieldMap.html":TEMPLATES.FIELD_MAP},scope.item.getList=loadData,scope.item.api=api;var electionDate=$rootScope.env.formParam&&$rootScope.env.formParam.humanReadableElectionDate;scope.$watch("item.value",function(val,oldVal){void 0!==val&&val!==oldVal&&(""===val&&scope.clearWidget(),api.find(scope.item.fullPath).afterSetValue(val,oldVal))});var firstLoadData=!1,subjCode=api.find("form.FormStep4.Panel_Region.regionCode"),oikNum=api.find("form.FormStep4.Panel_Region.oikNum"),voteLevel=api.find("form.FormStep0.Panel0.voteLevel");scope.initMapParams=function(){switch(scope.item.className){case"FieldMap":fieldMap();break;case"FieldMapWithList":initMobileProps(),fieldMap(),fieldMapWithList(),initNavigation();break;case"FieldMapWithListDC":initMobileProps(),scope.item.getList=function(callback){loadData(callback||void 0,!0)},fieldMapWithListDC(),initNavigation()}},scope.initMapParams(),$rootScope.$on(scope.item.fullPath+"_mapInput:inputChange",function(env,data){void 0!==typeof data.newV&&data.oldV!==data.newV&&scope.filterList(data.newV)}),scope.filterList=function(string){scope.searchFieldLoading=!0,scope.filterRun&&$timeout.cancel(scope.filterRun),scope.filterRun=$timeout(function(){PGU.Events.publish(":"+scope.item.fullPath+"_map_closeBaloon"),scope.model.options.afterUserClose(),"function"==typeof scope.cancelSelect&&scope.cancelSelect();var searchVal=string.toUpperCase();scope.model.list=scope.model.originList.filter(function(item){return item.title.toUpperCase().indexOf(searchVal)>-1}),"FieldMapWithListDC"===scope.item.className&&scope.item.selectedItems.length&&scope.item.selectedItems.forEach(function(si){scope.model.list.some(function(item){if(si.value===item.value)return item.checkbox={checked:!0,value:"true",className:"isCheckboxDC"},!0})}),scope.model.mapList=fieldMapProperties.fromAttributesToMap(!1,scope.model.list,scope.item.dictionary.mappingAttributes,scope.item.fullPath,"",""),scope.model.coords=isNaN(scope.model.coords)?1:+scope.model.coords+1,api.applyScope(),scope.searchFieldLoading=!1},400,!1)};var geoSearchDropdown;scope.localFilter=function(searchVal,list){return list.filter(function(item){return item.title.toUpperCase().indexOf(searchVal)>-1})},scope.loadMore=function(){var filteredList,offset=10*(scope.pageNum-1);if(scope.localTotal&&scope.localTotal<offset)return scope.localTotal;scope.localSearchValue&&(filteredList=scope.localFilter(scope.localSearchValue,scope.model.cachedList));var dataList=filteredList||scope.model.cachedList;scope.localTotal=dataList.length;var list=fieldMapProperties.getAttrsForList(pguSelectService.removeOpts(dataList.slice(offset,offset+10),scope.item.removeOpts),scope.item.dictionary.mappingAttributes);fieldMapProperties.fromAttributesToMap(!1,list,scope.item.dictionary.mappingAttributes,scope.item.fullPath,"","",void 0,scope.model.mapList),scope.pageNum++},scope.showAcceptWithoutPin=function(selected){scope.model.showAcceptWithoutPinSelected=selected,scope.model.showAcceptWithoutPin=!0,scope.showConfirmAfterRemove=!0};var watchers,loadDataIsInit=!1;scope.$on("suspend",function(){watchers=scope.$$watchers,scope.$$watchers=[]}),scope.$on("resume",function(){scope.$$watchers=watchers,watchers=null}),scope.$emit(scope.item.fullPath+":ScopeApplied",{scope:scope,element:element}),scope.item.isScopeAppliedDone={scope:scope,element:element}}}}]).factory("FieldMapExt",["fieldAttrs","$rootScope",function(fieldAttrs,$rootScope){return{isFieldMap:!0,attrs:angular.extend({},fieldAttrs.attrs,{strategy:{type:"string",default:"",enum:$rootScope.editor&&[""].concat($rootScope.strategyKeys),enumOptions:$rootScope.editor&&$.extend({"":""},$rootScope.strategyHash)},baloonContent:{type:"string",default:""},required:{type:"boolean",default:!1,humanity:"обязательное","scope:editor":!1},disabled:{type:"boolean",default:!1,humanity:"Недоступно","scope:editor":!1,"scope:ruleEditor":!0},readonly:{type:"boolean",default:!1,humanity:"только чтение","scope:editor":!1,"scope:ruleEditor":!0},validators:{default:[],"scope:editor":!1},immutable:{type:"boolean",default:!1,humanity:"неизменяемое","scope:editor":!1},fieldWidth:{type:"string",enum:["20","40","60","80","100"],enumOptions:{20:"20%",40:"40%",60:"60%",80:"80%",100:"100%"},default:"80"},getBalloonContent:{type:"string",default:""}})}}]).factory("FieldMapWithListExt",["fieldAttrs","$rootScope",function(fieldAttrs,$rootScope){return{isFieldMapWithList:!0,attrs:angular.extend({},fieldAttrs.attrs,{label:{default:"Подпись","scope:ruleEditor":!0},value:{enumerable:!0,"scope:rule:all":!0,"scope:sync":!0,default:"","scope:ruleEditor":!0},text_value:{type:"string",default:"","scope:editor":!1,"scope:sync":!0},textValue:{type:"string",default:"","scope:editor":!1,"scope:sync":!0},fieldMapListBtnText:{type:"string",default:"Выбрать время записи на прием"},dictionary:{default:{}},parentItem:{default:"",enumerable:!0,enum:""},"dictionary.code":{enumerable:!0,enum:"","scope:editor":!1},fieldWidth:{type:"string",enum:["20","40","60","80","100"],enumOptions:{20:"20%",40:"40%",60:"60%",80:"80%",100:"100%"},default:"80"},removeOpts:{type:"string",default:"","scope:editor":!0,"scope:ruleEditor":!0},strategy:{type:"string",default:"",
enum:$rootScope.editor&&[""].concat($rootScope.strategyKeys),enumOptions:$rootScope.editor&&$.extend({"":""},$rootScope.strategyHash)},cached:{type:"boolean",default:!1,"scope:editor":!1,"scope:sync":!1},total:{type:"integer","scope:editor":!1},initRequest:{type:"boolean",default:!1},setBalloonContent:{type:"string",default:""},hideMapInMobile:{type:"boolean",default:!1},departmentNameButton:{type:"string",default:"Выбрать отделение"},selectedDepartmentNameButton:{type:"string",default:"Выбрать другое отделение"},filterRegion:{type:"string",default:""},uncorrectedRegionText:{type:"string",default:"Ваше местоположение определило состав полей формы заявления при его создании. Для отображения списка подразделений введнный вами адрес должен соответствовать этому местоположению."},withGeoCoderSearch:{type:"boolean",default:!1},withSingleMandate:{type:"boolean",default:!1},addressPath:{type:"string",default:""},withDigitalPath:{type:"string",default:""}}),validate:function(lazy){var self=this,valid=!0;return!(!lazy&&!self.disabled()&&self.visible()&&self.inheritedVisibility())||(self.required()&&(self.value()&&self.textValue()?self.error(!1):(self.error("Поле обязательно для заполнения"),valid=!1)),!self.__setFirstFieldError||valid||lazy||(self.__setFirstFieldError=!1,self.scrollToError(self)),!this.element.api||this.element.api.__setFirstFieldError||lazy||valid||(this.element.api.__setFirstFieldError=this.element.fullPath),valid)}}}]).factory("FieldMapWithListDCExt",["fieldAttrs","$rootScope",function(fieldAttrs,$rootScope){return{isFieldMapWithListDC:!0,attrs:angular.extend({},fieldAttrs.attrs,{label:{default:""},value:{enumerable:!0,"scope:rule:all":!0,"scope:sync":!0,default:"","scope:ruleEditor":!0},fieldMapListBtnText:{type:"string",default:"Добавить"},fieldMapListBtnDeleteText:{type:"string",default:"Удалить"},dictionary:{default:{}},parentItem:{default:"",enumerable:!0,enum:""},"dictionary.code":{enumerable:!0,enum:"","scope:model":!1,"scope:editor":!1},fieldWidth:{type:"string",enum:["20","40","60","80","100"],enumOptions:{20:"20%",40:"40%",60:"60%",80:"80%",100:"100%"},default:"80"},removeOpts:{type:"string",default:"","scope:editor":!0,"scope:ruleEditor":!0},strategy:{type:"string",default:"",enum:$rootScope.editor&&[""].concat($rootScope.strategyKeys),enumOptions:$rootScope.editor&&$.extend({"":""},$rootScope.strategyHash)},initRequest:{type:"boolean",default:!1},filterRegion:{type:"string",default:""},uncorrectedRegionText:{type:"string",default:"Ваше местоположение определило состав полей формы заявления при его создании. Для отображения списка подразделений введнный вами адрес должен соответствовать этому местоположению."},withFilterCodes:{type:"boolean",default:!1},limitNumberOfEntries:{type:"number",default:3},addressPath:{type:"string",default:""},isNewView:{type:"boolean",default:!1}}),validate:function(lazy){if(lazy||this.disabled()||!this.visible()||!this.inheritedVisibility())return!0;var element=this.getElement(),valid=!0;if(this.attr("haveFirstValidate",!0),this.isValid(!0),this.error(!1),element.selectedItems&&element.selectedItems.length||(this.error("Необходимо выбрать хотя бы один детский сад"),this.isValid(!1),valid=!1),!element.isNewView){var validPriority=!1;angular.forEach(element.selectedItems,function(item){1==+item.priority&&(validPriority=!0)}),validPriority||(this.error("Необходимо указать приоритетный детский сад"),this.isValid(!1),valid=!1)}return!this.element.api||this.element.api.__setFirstFieldError||lazy||valid||(this.element.api.__setFirstFieldError=this.element.fullPath),valid},selectedItems:function(){return arguments.length?(this.getElement().selectedItems=arguments[0],this):this.getElement().selectedItems||[]},removeAllSelectedItem:function(){return this.element.removeAllSelectedItem()},addSelectedItem:function(value){return this.element.addSelectedItem(value)},addImportantDC:function(value){return this.element.addImportantDC(value)}}}]).factory("fieldMapProperties",["$rootScope","$q","fieldAttrs","api","geoCoder","DICT_DATA","PGU","sharedExtServices",function($rootScope,$q,fieldAttrs,api,geoCoder,DICT_DATA,PGU,sharedExtServices){return{getAddrArray:function(list){var res=[];if(!list||!list.length)return res;for(var i=0;i<list.length;i++)if(list[i].coords&&list[i].coords.length)for(var j=0;j<list[i].coords.length;j++)res.push(list[i].coords[j].value);return res},getBaloonContent:function(item){if(item.getBalloonContent){var content="",getBalloonContent=item.getBalloonContent,data=getBalloonContent?api.find(getBalloonContent).value():null;if(data){var jsonData=JSON.parse(data);jsonData.btnName="",content='<div class="PGU-FieldMapWithList-Baloon-attrs-wrap"><h3 class="PGU-FieldMapWithList-Item-title-text">'+jsonData.title+"</h3>";for(var i=0;i<jsonData.attrs.length;i++){var attr=jsonData.attrs[i];attr.value&&(content+='<div class="PGU-FieldMapWithList-Item-Attrs"><span class="PGU-AttrsLabel">'+attr.label+':&nbsp;</span><span class="PGU-AttrsValue">'+attr.value+"</span></div>")}jsonData.btnName&&(content+='<div class="PGU-FieldMapWithList-Item-wrap cf"> <a class="PGU-Button js-PGU-Button"><span class="PGU-ButtonText">'+jsonData.btnName+'</span><span class="PGU-ButtonRight"></span></a></div></div>')}return content}return item.baloonContent+(geoCoder.get(item.value)?"<br />"+geoCoder.get(item.value).name:"")},getMappedConfig:function(mappingAttributes){var mappedConfig=DICT_DATA.defaultConf,btnName=mappedConfig.btnName,keys=DICT_DATA.keys;if(mappingAttributes){mappedConfig.btnName=mappingAttributes.mappedConfig&&mappingAttributes.mappedConfig.btnName||"",api.isTablet()&&mappedConfig.btnName===btnName&&(mappedConfig.btnName="Выбрать время");for(var i=0;i<mappingAttributes.list.length;i++)for(var key in keys)mappingAttributes.list[i][key]&&(mappedConfig[keys[key]]=[]);for(var i=0;i<mappingAttributes.list.length;i++)for(var key in keys)mappingAttributes.list[i][key]&&mappedConfig[keys[key]].push(mappingAttributes.list[i])}return mappedConfig},fromAttributesToMap:function(isDC,list,mappingAttributes,fullPath,addButton,deleteButton,addressesArray,mapList,isMobile){var mappedConfig=DICT_DATA.defaultConf,btnName=mappedConfig.btnName,keys=DICT_DATA.keys,that=this,res=mapList||[];if(mappingAttributes){mappedConfig.btnName=mappingAttributes.mappedConfig&&mappingAttributes.mappedConfig.btnName||"",api.isTablet()&&mappedConfig.btnName===btnName&&(mappedConfig.btnName="Выбрать время");for(var i=0;i<mappingAttributes.list.length;i++)for(var key in keys)mappingAttributes.list[i][key]&&(mappedConfig[keys[key]]=[]);for(var i=0;i<mappingAttributes.list.length;i++)for(var key in keys)mappingAttributes.list[i][key]&&mappedConfig[keys[key]].push(mappingAttributes.list[i])}return angular.forEach(list,function(item,index){var obj={},mapCords=that.getCoords(mappedConfig.coords,item,addressesArray);mapCords.center||item.center?(item.center?obj.center=item.center:obj.center=item.center=mapCords.center,obj.coordsValue=item.coordsValue=mapCords.coordsValue):obj.coordsValue=item.coordsValue=mapCords.coordsValue,obj.elementId=item.elementId=mapCords.elementId,obj.id=isMobile?item.id:item.id=index,obj.number=index+1,obj.btnName=isDC?addButton||"Добавить":mappedConfig.btnName,obj.attrs=that.getMappedAttrs(mappedConfig.attrs,item),obj.details=that.getMappedDetails(mappedConfig.details,item),obj.baloonContent=that.getMappedAttrsForBaloon(mappedConfig.baloonContent,item),obj.underMapInfo=that.getMappedUnderMapInfo(mappedConfig.underMap,item),obj.fullPath=fullPath,obj.title=item.title,obj.value=item.value,obj.slots=that.getSlotsInfo(item.attributeValues),isDC&&(obj.checkbox=item.checkbox),isDC&&(obj.priority=2),res.push(obj)}),res},mapBindings:function(hashMap,item){var withoutUnderScore,responseBindings=item.dictionary.responseBindings||[],needSaveBalloonContent=item.setBalloonContent,lowerItemKeysMap={};if(hashMap){Object.keys(hashMap).forEach(function(li){var liToLower=li.toLowerCase();lowerItemKeysMap[liToLower]=li})}if(responseBindings.length&&hashMap&&angular.forEach(responseBindings,function(val,key){var lowerCaseName=val.name&&val.name.toLowerCase();withoutUnderScore=lowerCaseName.replace("_","");var valueToBind=hashMap[lowerItemKeysMap[lowerCaseName]]||hashMap[lowerCaseName]||hashMap[lowerItemKeysMap[withoutUnderScore]]||hashMap[val.name]||hashMap.attrs&&hashMap.attrs[val.name];null!==valueToBind&&void 0!==valueToBind||(valueToBind=""),api.find(val.field).attr(val.attr,valueToBind.toString())}),needSaveBalloonContent){var balloonData={attrs:hashMap.balloonContent,title:hashMap.title};api.find(needSaveBalloonContent).value(angular.toJson(balloonData))}PGU.Events.publish(item.fullPath+":click",hashMap)},getMappedAttrsForBaloon:function(attrs,item){for(var res=[],i=0;i<attrs.length;i++)if("SLOTPERCENT"!==attrs[i].name){var itemValue=attrs[i].name?item.attributeValues[attrs[i].name]:"";if(attrs[i].name)switch(attrs[i].name.toLowerCase()){case"address_out":itemValue=item.attributeValues[attrs[i].name].replace(/\s{0,}(,{1,}\s{0,}){1,}/g,", ").replace(/(^,\s)|(,\s)$/g,"");break;case"phone_out":itemValue=item.attributeValues[attrs[i].name].replace(/;|,|\./g,", ")}res.push({value:itemValue,label:attrs[i].label})}return res},getMappedAttrs:function(attrs,item){return item.attributeValues},getAttrsForList:function(list,attrs){if(list&&list.length)return list.map(function(item){return item.attrsList=item.attrsList||[],item.attributes&&item.attributes.length&&item.attributes.forEach(function(attr){var attrFilter=attrs.list.filter(function(filterAttr){return filterAttr.isMain&&filterAttr.name===attr.name});attrFilter&&attrFilter.length&&attrFilter[0].label&&item.attrsList.push({value:attr.value.value,label:attrFilter.length?attrFilter[0].label:""})}),item})},getMappedDetails:function(details,item){var nameTolowerCase,withoutUnderScore,res=[],lowerItemKeysMap={},itemKeys=Object.keys(item);itemKeys.forEach(function(li){var liToLower=li.toLowerCase();lowerItemKeysMap[liToLower]=li});for(var i=0;i<details.length;i++)nameTolowerCase=details[i].name&&"title"!==details[i].name?details[i].name.toLowerCase():"",withoutUnderScore=nameTolowerCase.replace("_",""),res.push({value:nameTolowerCase&&item[nameTolowerCase]||withoutUnderScore&&item[lowerItemKeysMap[withoutUnderScore]]||item.attributeValues&&item.attributeValues[details[i].name],label:details[i].label});return res},getUpperCaseCoordsAttrs:function(item,mapping){var arr=["LATITUDE","LONGITUDE","ADDRESS"],result={},lowerItemKeysMap={};return Object.keys(item).forEach(function(li){var liToLower=li.toLowerCase();lowerItemKeysMap[liToLower]=li}),arr.forEach(function(attr){if(item[attr.toLowerCase()])result[attr]=item[attr.toLowerCase()];else{var mappingName="",mapVal=mapping&&mapping.find(function(li){return~li.name.indexOf(attr.toLowerCase().substring(0,3))});mapVal&&(mappingName=lowerItemKeysMap[mapVal.name.toLowerCase().replace("_","")],result[mapVal.name]=item[mapVal.name]||item[mappingName],mapVal.mappingName=attr)}}),result},getCoords:function(coords,item,addressesArray){for(var coordsValue,res=[],mapData={coordsValue:"",elementId:item.elementId||Math.random().toString(36).substr(2,9)},latString="LATITUDE",longString="LONGITUDE",latToLower=latString.toLowerCase(),longToLower=longString.toLowerCase(),latitude="",longitude="",i=0;i<coords.length;i++)res.push({value:item.attributeValues&&item.attributeValues[coords[i].name]||item[coords[i].name],label:coords[i].label,name:coords[i].name,mappingName:coords[i].mappingName||""});return 3===res.length?(latitude=this.getReplacedCommaToDotValue(res,latString),longitude=this.getReplacedCommaToDotValue(res,longString),coordsValue=latitude&&longitude?[latitude,longitude]:_.find(res,function(item){return item.name!==latString&&item.name!==longString&&item.name!==latToLower&&item.name!==longToLower}).value):2===res.length?(latitude=this.getReplacedCommaToDotValue(res,latString),longitude=this.getReplacedCommaToDotValue(res,longString),coordsValue=[latitude,longitude]):coordsValue=1===res.length?res[0].value:"",!_.isArray(coordsValue)&&coordsValue?(void 0!==addressesArray&&addressesArray.push(coordsValue),mapData.coordsValue=coordsValue):(mapData.coordsValue=res.length?res[0].value:"",coordsValue||(coordsValue=[]),mapData.center=coordsValue.map(function(coords){return+coords})),mapData},getReplacedCommaToDotValue:function(coords,name){var val=_.find(coords,function(item){return item.name===name||item.name.toLowerCase()===name.toLowerCase()||item.mappingName&&item.mappingName.toLowerCase()===name.toLowerCase()}),value=val?val.value:"";return"number"==typeof value&&(value=value.toString()),"string"!=typeof value?"":value?value.replace(",","."):value},getMappedUnderMapInfo:function(undermap,item){for(var res=[],i=0;i<undermap.length;i++){var value="",label="";value=item.attributeValues[undermap[i].name],label=undermap[i].label,"title"==undermap[i].name?(label="Подразделение",value=item.title):"address_out"==undermap[i].name?label="Адрес подразделения":"scheduleComment_out"==undermap[i].name&&(label="Комментарий"),res.push({value:value,label:label})}return res},getElemFromAddr:function(addr,list,elementId){if(list)for(var i=0;i<list.length;i++)if(list[i].elementId===elementId)return list[i]},getElemFromValue:function(list,value){if(list&&list.length)for(var i=0;i<list.length;i++)if(list[i].value==value)return list[i]},addData:function(list){for(var i=0;i<list.length;i++)list[i].checkbox={};return list},addDC:function(dc,list,selectedIds){if(list)return selectedIds.push(dc.id),list.push({value:dc.value,title:dc.title,priority:dc.priority||2,priorityNumber:list.length+1}),list},removeDC:function(dc,list,selectedIds){if(list&&list.length&&dc){var indexOfId=selectedIds.indexOf(dc.id);indexOfId>-1&&selectedIds.splice(indexOfId,1);for(var removedPN=0,i=0;i<list.length;i++)if(list[i].value===dc.value){dc.priority=2,removedPN=list[i].priorityNumber,list.splice(i,1);break}return removedPN&&list.forEach(function(it){it.priorityNumber>removedPN&&it.priorityNumber--}),list}},isSelectedDC:function(dc,list){if(!list||!list.length||!dc)return!1;for(var i=0;i<list.length;i++)if(list[i].value==dc.value)return!0;return!1},getListCoordsBoundedBy:function(coords){var request={bounds:coords,usercoords:[],codes:[]};return sharedExtServices.getCoordsBoundedBy(request)},getSlotsInfo:function(attrs){var obj={},percent=attrs&&attrs.SLOTPERCENT;if(obj.value=percent||"",percent){var num=+percent;num>=70?(obj.className="green",obj.message="Свободно"):num>=30?(obj.className="yellow",obj.message="Средняя загруженность"):num>=0?(obj.className="red",obj.message="Высокая загруженность"):obj.value=""}return obj},getGeoSearchDataFromFias:function(data){var value="";return data.region&&(value+=data.cityType!==data.regionType?data.region+" "+data.regionType:data.region),data.area&&(value+=value?", "+data.areaType+" "+data.area:data.areaType+" "+data.area),data.city&&(value+=value?", "+data.cityType+" "+data.city:data.cityType+" "+data.city),value},getCodeWithoutStartZero:function(code){var codeString="";return"number"==typeof code&&(codeString=code.toString()),"string"!=typeof code?codeString:(codeString=code,codeString&&0===codeString.indexOf("0")?codeString.substring(1):codeString)},handleResponseFiasDataFromUserRegionTitle:function(data){var fiasAddress={region:"",regionType:"",regionFiasCode:"",regionKladrCode:"",city:"",cityType:"",area:"",areaType:"",fias_full_code:"",fullAddress:""};return data&&data.address&&data.address.elements&&(data.address.elements.forEach(function(i){1===i.level?(fiasAddress.region=i.data,fiasAddress.regionType=i.type,fiasAddress.regionFiasCode=i.fiasCode,fiasAddress.regionKladrCode=i.kladrCode.substring(0,2)):3===i.level?(fiasAddress.area=i.data,fiasAddress.areaType=i.type):4===i.level&&(fiasAddress.city=i.data,fiasAddress.cityType=i.type)}),fiasAddress.fullAddress=data.address.fullAddress),fiasAddress},handleResponseRegionTitle:function(df,userSelectedRegion){var self=this;sharedExtServices.normalizeAddressInDaData({q:userSelectedRegion},function(data){df.resolve(self.handleResponseFiasDataFromUserRegionTitle(data))},function(){df.resolve(self.handleResponseFiasDataFromUserRegionTitle({}))})},getFiasDataFromUserRegionTitle:function(envUserSelectedRegion){var self=this,df=$q.defer(),userSelectedRegion="Москва";return sharedExtServices.selectRegionTitle(envUserSelectedRegion).then(function(response){response.data&&response.data.path&&(userSelectedRegion=response.data.path.replace(/\//g," ")),self.handleResponseRegionTitle(df,userSelectedRegion)},function(){self.handleResponseRegionTitle(df,userSelectedRegion)}),df.promise}}}]).filter("getAddress",function(){return function(input){return input&&input.attributeValues&&input.attributeValues.address_out?input.attributeValues.address_out:""}}).filter("hightlightSearch",[function($sce){return function(input,str){return str&&input?(str=str.replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1"),input.replace(new RegExp(str,"gi"),'<span class="highlightedText">$&</span>')):input}}]).filter("search",[function(){return function(items,scope){var filtered=[];return items.forEach(function(item){if(item.title){(scope?item.title.toUpperCase().indexOf(scope.toUpperCase()):0)>=0&&filtered.push(item)}}),filtered}}]).directive("scrollToActive",["$timeout",function($timeout){return{restrict:"A",link:function(scope,element,attrs){attrs.$observe("scrollToActive",function(val){if(val){var parent=$(element),el=parent.find("[it-value='"+val+"']"),top=el.position()&&el.position().top;(top||0===top)&&parent.animate({scrollTop:top},1e3)}})}}}]).directive("scrollToFm",["$timeout","api",function($timeout,api){return{restrict:"A",link:function(scope,element,attrs){attrs.$observe("scrollToFm",function(val){val&&"[]"!==val&&api.checkOpIframeScroll($(element),function(){$("html, body").animate({scrollTop:$(element).offset().top},1e3)})})}}}]).directive("adjustMargin",["$timeout",function($timeout){return{restrict:"A",link:function(scope,element,attrs){attrs.$observe("adjustMargin",function(val){if(val){var el=$(element),mapContainer=el.parent(),button=mapContainer.find(".PGU-Button-Choose"),btnParent=button.closest(".PGU-FieldMapWithList-Baloon");button&&button.offset()&&el.css({top:button.offset().top-mapContainer.offset().top+button[0].offsetHeight+10+"px",left:button.offset().left-mapContainer.offset().left-(button.offset().left-btnParent.offset().left)-10+"px"})}})}}}]),angular.module("serverFormWidgets.general").directive("epguKladr",["TEMPLATES","api","$rootScope","$timeout","PGU","$http","$templateCache","$compile","apiInner","KLADR_STRUCTURE","KLADR_LABELS","RKN_CONDITIONS","ADDRESS_RKN_CONDITIONS","pguKladrService","$q",function(TEMPLATES,api,$rootScope,$timeout,PGU,$http,$templateCache,$compile,apiInner,KLADR_STRUCTURE,KLADR_LABELS,RKN_CONDITIONS,ADDRESS_RKN_CONDITIONS,pguKladrService,$q){return{templateUrl:TEMPLATES.KLADR,replace:!0,scope:{item:"="},link:function(scope,element,attrs){function closeKladr(){scope.ui.showPanelByName("true"===scope.item.manualEnter?"manual":"mixed"),scope.item.items=[],scope.models.selectsIsChanged=!1,scope.item.popUpOpened=!1,scope.item.lastZipcodeRequestKladr=scope.models.lastZipcodeRequestKladr,api.scrollTo(scope.item.fullPath,"",-60)}if(!$rootScope.isDesigner){scope.item.items=[],scope.item.clearForms=function(){},scope.models={},scope.models.lastZipcodeRequestKladr=null,scope.models.preventUpdateSelects=!1;var isRKN,kladrRKN=["KladrAddressRKN","KladrNaturalPersonRKN","KladrJuridicalPersonRKN"],isRusStat="KladrRusStat"===scope.item.className;-1!==kladrRKN.indexOf(scope.item.className)&&(isRKN=!0),isRusStat&&(scope.item.attrs.building1["scope:sync"]=!1,scope.item.attrs.building2["scope:sync"]=!1,scope.item.attrs.post_index["scope:sync"]=!1,scope.item.attrs.other_info["scope:sync"]=!1),PGU.Events.subscribe(scope.item.fullPath,"selectItem",pguKladrService.clearDependency.bind(scope));var watchers;if(scope.$on("suspend",function(){watchers=scope.$$watchers,scope.$$watchers=[]}),scope.$on("resume",function(){scope.$$watchers=watchers,watchers=null}),scope.$on(scope.item.fullPath+":kladrSelectChange",function(evt,data){scope.models.updateSelects(data)}),scope.$watch("item.value",function(val,oldVal){void 0!==val&&val!==oldVal&&(scope.item._changedByUser=!0,api.find(scope.item.fullPath).afterSetValue(val,oldVal))}),scope.models.updateSelects=function(data){if(!scope.models.preventUpdateSelects){scope.models.selectsIsChanged=!0;var mixedContent=scope.item.items.filter(function(item){return"mixed"===item.name});isRusStat||pguKladrService.tryToGetZipCode(scope.item,scope.models,data.kladrId);var oldName="";PGU.PromiseStack={},mixedContent[0].items.forEach(function(item){item.depends&&item.depends.length&&item.depends.indexOf(data.name)>-1&&(item.parentId=data.value,oldName||(oldName=item.fullPath),angular.equals(PGU.PromiseStack,{})?item.loadData():(PGU.PromiseStack[oldName]=$q.defer(),PGU.PromiseStack[oldName].promise.then(function(){item.loadData()}),oldName=item.fullPath))});var indexPanel=scope.item.items.find(function(item){return"postIndexPanel"===item.name});indexPanel&&data.kladrId&&"LocationBasedOnKladr"!==scope.item.className&&!isRusStat&&api.find(indexPanel.items[0].fullPath).value(scope.item.post_index)}},scope.models.saveData=function(){pguKladrService.saveData(scope.item,scope.models,scope.ui.formState)&&(scope.item.error=!1,scope.item.isValid=!0,scope.ui.cancel())},$rootScope.$on(scope.item.fullPath+":hidePopup",function(){}),isRKN){$rootScope.$on(scope.item.fullPath+".mixed.apartment:inputChange",function(env,date){date.newV&&(api.find(scope.item.fullPath+".mixed.apartment").element.error="")}),$rootScope.$on(scope.item.fullPath+".mixed.house:inputChange",function(env,date){var otherInfoElement=api.find(scope.item.fullPath+".mixed.other_info").element;date.newV?(api.find(scope.item.fullPath+".mixed.house").element.error="",otherInfoElement.fullPath==scope.item.fullPath+".mixed.other_info"&&api.find(scope.item.fullPath+".mixed.other_info").attr("required",!1).attr("disabled",!0)):otherInfoElement.fullPath==scope.item.fullPath+".mixed.other_info"&&api.find(scope.item.fullPath+".mixed.other_info").attr("required",!0).attr("disabled",!1)}),$rootScope.$on(scope.item.fullPath+".manual.house:inputChange",function(env,date){var otherInfoElement=api.find(scope.item.fullPath+".manual.other_info").element;date.newV?(api.find(scope.item.fullPath+".manual.other_info")&&api.find(scope.item.fullPath+".manual.other_info").attr("disabled",!0),otherInfoElement.fullPath==scope.item.fullPath+".manual.other_info"&&api.find(scope.item.fullPath+".manual.other_info").attr("required",!1).attr("disabled",!0)):otherInfoElement.fullPath==scope.item.fullPath+".manual.other_info"&&api.find(scope.item.fullPath+".manual.other_info").attr("required",!0).attr("disabled",!1)}),$rootScope.$on(scope.item.fullPath+".mixed.building1",function(env,date){date.newV&&api.find(scope.item.fullPath+".mixed.building1").validate()}),$rootScope.$on(scope.item.fullPath+".mixed.other_info:inputChange",function(env,date){var apiEl=api.find(scope.item.fullPath+".mixed");date.newV?(apiEl.find("street").attr("disabled",!0).attr("value",""),apiEl.find("house").attr("required",!1)&&apiEl.find("house").attr("required",!1).attr("disabled",!0).attr("hookCheckbox",!0).attr("value",""),apiEl.find("building1").attr("required",!1)&&apiEl.find("building1").attr("required",!1).attr("disabled",!0).attr("hookCheckbox",!0).attr("value",""),apiEl.find("building2").attr("required",!1)&&apiEl.find("building2").attr("required",!1).attr("disabled",!0).attr("hookCheckbox",!0).attr("value",""),apiEl.find("apartment").attr("required",!1)&&apiEl.find("apartment").attr("required",!1).attr("disabled",!0).attr("hookCheckbox",!0).attr("value","")):(apiEl.find("street").attr("disabled",!1),apiEl.find("house").attr("required",!0)&&apiEl.find("house").attr("required",!0).attr("hookCheckbox",!1).attr("disabled",!1),apiEl.find("building1").attr("required",!1)&&apiEl.find("building1").attr("required",!1).attr("hookCheckbox",!1).attr("disabled",!1),apiEl.find("building2").attr("required",!1)&&apiEl.find("building2").attr("required",!1).attr("hookCheckbox",!1).attr("disabled",!1),"KladrAddressRKN"==scope.item.className?apiEl.find("apartment")&&apiEl.find("apartment").attr("hookCheckbox",!1).attr("disabled",!1):apiEl.find("apartment").attr("required",!0)&&apiEl.find("apartment").attr("required",!0).attr("hookCheckbox",!1).attr("disabled",!1))}),$rootScope.$on(scope.item.fullPath+".manual.other_info:inputChange",function(env,date){var apiEl=api.find(scope.item.fullPath+".manual");date.newV?(apiEl.find("street").attr("required",!1).attr("disabled",!0).attr("hookCheckbox",!0).attr("value",""),apiEl.find("house").attr("required",!1).attr("disabled",!0).attr("hookCheckbox",!0).attr("value",""),apiEl.find("building1").attr("required",!1).attr("disabled",!0).attr("hookCheckbox",!0).attr("value",""),apiEl.find("building2").attr("required",!1).attr("disabled",!0).attr("hookCheckbox",!0).attr("value",""),apiEl.find("apartment").attr("required",!1).attr("disabled",!0).attr("hookCheckbox",!0).attr("value","")):(apiEl.find("street").attr("required",!0).attr("hookCheckbox",!1).attr("disabled",!1),apiEl.find("house").attr("required",!0).attr("hookCheckbox",!1).attr("disabled",!1),apiEl.find("building1").attr("required",!1).attr("hookCheckbox",!1).attr("disabled",!1),apiEl.find("building2").attr("required",!1).attr("hookCheckbox",!1).attr("disabled",!1),"KladrAddressRKN"==scope.item.className?apiEl.find("apartment").attr("hookCheckbox",!1).attr("disabled",!1):apiEl.find("apartment").attr("required",!0).attr("hookCheckbox",!1).attr("disabled",!1))}),$rootScope.$on(scope.item.fullPath+".mixed.region:selectItem",function(env,data){if(data.scope.model.value){api.find(scope.item.fullPath+".mixed").find("city").attr("required",!1)}}),$rootScope.$on(scope.item.fullPath+".postIndexPanel.post_index:inputChange",function(env,data){data.newV&&api.find(scope.item.fullPath+".postIndexPanel.post_index").validate()}),$rootScope.$on(scope.item.fullPath+".mixed.building1:inputChange",function(env,data){data.newV&&api.find(scope.item.fullPath+".mixed.building1").error("")});for(var manual=["region","district","city","street","house","building1","apartment","town"],i=0;i<manual.length;i++)$rootScope.$on(scope.item.fullPath+".manual."+manual[i]+":inputChange",function(env,data){if(data.newV){var fullPath=env.name.replace(":inputChange","");api.find(fullPath).validate()}})}scope.$watch("ui.showPopup",function(val,oldVal){if(void 0!==val&&val!==oldVal){if(!1===val&&closeKladr(),void 0!==val&&!0===val&&isRKN){var apiElMixed=api.find(scope.item.fullPath+".mixed");apiElMixed.find("street").attr("required",!1),apiElMixed.find("city").attr("required",!1)}!0===val&&"true"==scope.item.manualEnter&&$timeout(function(){})}scope.$emit(scope.item.fullPath+":ScopeApplied",{scope:scope})}),scope.ui={showPopup:!1,formState:isRusStat&&"true"===scope.item.manualEnter?"manual":"mixed",clearModel:function(){scope.item.disabled||pguKladrService.clearKladr(scope.item,scope.models)},cancel:function(){scope.ui.showPopup=!1,closeKladr()},showPanelMixed:function(){scope.ui.showPanelByName("mixed")},showPanelManual:function(){scope.ui.showPanelByName("manual")},showPanelByName:function(name){var self=scope.ui,rusStatMixedElements=["house","apartment"];self.formState!==name&&(isRusStat?(pguKladrService.copyFieldsValues(scope.item,scope.models.copyFieldsValues,self.formState,name,rusStatMixedElements),pguKladrService.clearData(scope.item,scope.models,self.formState,rusStatMixedElements),scope.item.items.forEach(function(item){"mixed"===item.name?item.items.forEach(function(li){~rusStatMixedElements.indexOf(li.name)&&(li.visible="mixed"===name)}):item.visible=item.name===name||item.name===scope.models.postIndexPanelName||item.name===scope.models.labelName})):(pguKladrService.copyFieldsValues(scope.item,scope.models.copyFieldsValues,self.formState,name),pguKladrService.clearData(scope.item,scope.models,self.formState),scope.item.items.forEach(function(item){item.visible=item.name===name||item.name===scope.models.postIndexPanelName||item.name===scope.models.labelName}),scope.models.postIndexPanelName&&(api.find(scope.item.fullPath+"."+scope.models.postIndexPanelName).element.serviceCardTitle="manual"!==name?scope.models.postIndexTitle:"")),self.formState=name)},showDialog:function(){if(!scope.item.disabled){var ks=KLADR_STRUCTURE.slice();scope.item.items=pguKladrService.createKladrForms(scope.item,scope.models,ks),api.initAttrs(scope.item.items),pguKladrService.restoreKladrPartsToFields(scope.item,scope.models),scope.ui.showPopup=!0,scope.item.popUpOpened=!0,$timeout(function(){$rootScope.$applyAsync()},200)}},btnOpenDialog:{btnColor:"blue",label:scope.item.text,fullPath:scope.item.fullPath?scope.item.fullPath+"_btnOpenDialog":"_btnOpenDialog",floating:"PGU-BtnFloat",buttonSize:"small",visible:!0},btnClearModel:{btnColor:"blue",label:"Очистить",fullPath:scope.item.fullPath?scope.item.fullPath+"_btnClearModel":"_btnClearModel",floating:"PGU-BtnFloat",buttonSize:"small",visible:!0},btnCancel:{btnColor:"white",label:"Отменить",fullPath:scope.item.fullPath?scope.item.fullPath+"_btnCancel":"_btnCancel",floating:"PGU-BtnFloat",buttonSize:"small",visible:!0},btnSaveData:{btnColor:"blue",label:"Сохранить",fullPath:scope.item.fullPath?scope.item.fullPath+"_btnSaveData":"_btnSaveData",floating:"PGU-BtnFloat",buttonSize:"small",visible:!0},btnShowPanelManual:{balign:"right",btnColor:"white",label:"Ввести адрес вручную",fullPath:scope.item.fullPath?scope.item.fullPath+"_btnShowPanelManual":"_btnShowPanelManual",floating:"PGU-BtnFloat",buttonSize:"small",visible:!0},btnShowPanelMixed:{balign:"right",btnColor:"white",label:"Выбор из справочника",fullPath:scope.item.fullPath?scope.item.fullPath+"_btnShowPanelMixed":"_btnShowPanelMixed",floating:"PGU-BtnFloat",buttonSize:"small",visible:!0}},scope.$emit(scope.item.fullPath+":ScopeApplied",{scope:scope,element:element})}}}}]).factory("KladrExt",["$rootScope","fieldAttrs","KLADR_STRUCTURE",function($rootScope,fieldAttrs,KLADR_STRUCTURE){return{attrs:angular.extend({},fieldAttrs.attrs,{value:{"scope:sync":!0,type:"string",default:"","scope:editor":!1,"scope:rule:all":!0},strategy:{type:"string",default:"",enum:$rootScope.editor&&[""].concat($rootScope.strategyKeys),enumOptions:$rootScope.editor&&$.extend({"":""},$rootScope.strategyHash),"scope:editor":$rootScope.isAdminUser,"scope:noChanges":!0},street:{type:"string",default:"","scope:sync":!0,"scope:editor":!1,"scope:rule:all":!0},street_code:{type:"string",default:"","scope:sync":!0,"scope:editor":!1,"scope:rule:all":!0,"scope:noChanges":!0},apartment:{type:"string",default:"","scope:sync":!0,"scope:editor":!1,"scope:rule:all":!0},apartment_code:{type:"string",default:"","scope:sync":!0,"scope:editor":!1,"scope:rule:all":!0},town:{type:"string",default:"","scope:sync":!0,"scope:editor":!1,"scope:rule:all":!0},town_code:{type:"string",default:"","scope:sync":!0,"scope:editor":!1,"scope:rule:all":!0,"scope:noChanges":!0},city:{type:"string",default:"","scope:sync":!0,"scope:editor":!1,"scope:rule:all":!0},city_code:{type:"string",default:"","scope:sync":!0,"scope:editor":!1,"scope:rule:all":!0,"scope:noChanges":!0},district:{type:"string",default:"","scope:sync":!0,"scope:editor":!1,"scope:rule:all":!0},district_code:{type:"string",default:"","scope:sync":!0,"scope:editor":!1,"scope:rule:all":!0,"scope:noChanges":!0},house:{type:"string",default:"","scope:sync":!0,"scope:editor":!1,"scope:rule:all":!0},house_code:{type:"string",default:"","scope:sync":!0,"scope:editor":!1,"scope:rule:all":!0},post_index:{type:"string",default:"","scope:sync":!0,"scope:editor":!1,"scope:rule:all":!0},region:{type:"string",default:"","scope:sync":!0,"scope:editor":!1,"scope:rule:all":!0},region_code:{type:"string",default:"","scope:sync":!0,"scope:editor":!1,"scope:rule:all":!0,"scope:noChanges":!0},building1:{type:"string",default:"",
"scope:sync":!0,"scope:editor":!1,"scope:rule:all":!0},building2:{type:"string",default:"","scope:sync":!0,"scope:editor":!1,"scope:rule:all":!0},taxCode:{type:"string",default:"","scope:sync":!0,"scope:editor":!1,"scope:rule:all":!0,"scope:noChanges":!0},taxAreaCode:{type:"string",default:"","scope:sync":!0,"scope:editor":!1,"scope:rule:all":!0,humanity:"Код территориального участка налогового органа","scope:noChanges":!0},dictionaryOnly:{type:"boolean",enum:[!0,!1],"scope:editor":!0,enumOptions:{true:"Разрешить",false:"Запретить"},default:!0,"scope:noChanges":!0},validators:{"scope:editor":!1,"scope:noChanges":!0},readonly:{"scope:editor":!1},allowOptionalBuilding1:{type:"boolean",default:!1,"scope:editor":!1,enum:[!1,!0],enumOptions:{false:"Обязательный",true:"Необязательный"},"scope:noChanges":!0},includeLogicValidation:{type:"boolean",default:!1,"scope:editor":!1,"scope:rule:all":!0,enum:[!1,!0],enumOptions:{false:"Выключен",true:"Включен"},"scope:noChanges":!0},allowEditlabels:{default:[],"scope:editor":$rootScope.isAdminUser,"scope:noChanges":!0},text:{type:"string",default:"Изменить адрес","scope:editor":!0,"scope:noChanges":!0},other_info:{type:"string",default:"","scope:sync":!0,"scope:editor":!1,"scope:rule:all":!0},needStreetField:{type:"boolean",default:"true",enum:[!0,!1],enumOptions:{true:"Да",false:"Нет"},"scope:editor":!1},kladrVersion:{type:"string",default:"",enum:["","KladrAddressRKN","KladrNaturalPersonRKN","KladrJuridicalPersonRKN","LocationBasedOnKladr"],enumOptions:{"":"",KladrAddressRKN:"РКН",KladrNaturalPersonRKN:"РКН ФЛ",KladrJuridicalPersonRKN:"РКН ЮЛ/ИП",LocationBasedOnKladr:"Местоположение"},"scope:editor":!1,"scope:noChanges":!0},manualEnter:{type:"string",default:"false","scope:sync":!0,"scope:editor":!1,"scope:noChanges":!0},pageNum:{"scope:sync":!1,"scope:editor":!1,"scope:noChanges":!0},apartmentDisabled:{type:"string",default:"no","scope:sync":!0,"scope:editor":!1},houseDisabled:{type:"string",default:"no","scope:sync":!0,"scope:editor":!1}}),clearModel:function(){this.value="",this.taxCode="",this.taxAreaCode="",this.manualEnter="false";for(var ks=KLADR_STRUCTURE.slice(),i=0;i<ks.length;i++){var field=ks.slice()[i];this.hasOwnProperty(field.name)&&(this.hasOwnProperty(field.name+"_code")&&(this[field.name+"_code"]=""),this[field.name]="")}this.post_index&&(this.post_index=""),this.items=[]}}}]),angular.module("serverForm.services").factory("pguKladrService",["apiInner","$rootScope","$compile","$routeParams","$http","CONFIG","$q","sharedExtServices","api","KLADR_STRUCTURE","KLADR_LABELS","RKN_CONDITIONS","ADDRESS_RKN_CONDITIONS","PGU","$filter","RUSSTAT_CONDITIONS",function(apiInner,$rootScope,$compile,$routeParams,$http,CONFIG,$q,sharedExtServices,api,KLADR_STRUCTURE,KLADR_LABELS,RKN_CONDITIONS,ADDRESS_RKN_CONDITIONS,PGU,$filter,RUSSTAT_CONDITIONS){return{val2Code:function(val){return val.split(":")[1]},val2Id:function(val){return val.split(":")[0]},getRusStatRequestParams:function(name,depends,fullPath){},getKladrRequestParams:function(name,depends,fullPath,isRusStat){var parentCode,result;if(isRusStat){if(result={},!isRusStat.name)return result;result[isRusStat.name]=isRusStat.value}else result={params:{name:""},parentCode:""};var value,parent=api.find(fullPath).parent(),regionCode=void 0===parent.find("region").attr("value")?"":parent.find("region").attr("value");if(depends.length)if("street"===name&&["78000000000","77000000000","99000000000","92000000000"].indexOf(regionCode)>-1&&!parent.find("town").attr("value"))result.parentCode=regionCode;else{for(var i=0,il=depends.length;i<il;i++){if(value=void 0===parent.find(depends[i]).attr("value")?"":parent.find(depends[i]).attr("value")){parentCode=value,parentCode&&(isRusStat?"type"===isRusStat.name?result.parentId=parentCode:result[isRusStat.name]=parentCode:result.parentCode=parentCode);break}if(isRusStat&&0===i&&("house"===name||"apartment"===name)){result[isRusStat.name]="";break}}if(!parentCode)return null}return result},kladrReceiver:function(select,data,parentId,callback,isRusStat){isRusStat?data&&select.parentId===parentId&&(PGU.Kladr=PGU.Kladr||{},PGU.Kladr[select.fullPath]={list:[],originList:[]},"street"===select.name?PGU.Kladr[select.fullPath].list=data.map(function(option){return{value:option.streetId,title:(option.abbrCode?option.abbrCode+" "||"":"")+option.streetName,kladrId:option.streetId}}):"house"===select.name?PGU.Kladr[select.fullPath].list=data.map(function(option){return{value:option.houseId,title:option.houseNumber,kladrId:option.houseId}}):"apartment"===select.name?PGU.Kladr[select.fullPath].list=data.map(function(option){return{value:option.flatId,title:option.flatNumber,kladrId:option.flatId}}):PGU.Kladr[select.fullPath].list=data.map(function(option){return{value:option.addressId,title:option.addressName,kladrId:option.addressCode}}),PGU.Kladr[select.fullPath].originList=PGU.Kladr[select.fullPath].list,select.list=PGU.Kladr[select.fullPath].list.slice(0,20),data.length||(data.searchIsEmpty=!0)):data&&data.error&&!data.error.code&&data.list&&data.list.entries&&select.parentId===parentId&&(PGU.Kladr=PGU.Kladr||{},PGU.Kladr[select.fullPath]={list:[],originList:[]},PGU.Kladr[select.fullPath].list=data.list.entries.map(function(option){return{value:option.code,title:option.name+" "+option.type.toLowerCase(),kladrId:option.id}}),PGU.Kladr[select.fullPath].originList=PGU.Kladr[select.fullPath].list,select.list=PGU.Kladr[select.fullPath].list.slice(0,20),data.list.entries.length||(data.searchIsEmpty=!0)),callback&&callback(data)},clearDependency:function(evt,data){var kladrScope=this,selectScope=data.scope,removeChild=!1;kladrScope.item.items.forEach(function(item){"Panel"===item.className&&item.items.forEach(function(el){"KladrDropdown"===el.className&&(removeChild&&(el.list=[],el.value="",el.text_value="",PGU.Events.publish(el.fullPath+":removeCurrentItem")),el.name===selectScope.model.name&&(removeChild=!0))})})},getKladrValidatorsByMnemonic:function(mnemonic){var result={mnemonic:mnemonic};switch(mnemonic){case"kladrHouse":result.regexp="(^([0-9])([-А-Яа-яёЁ0-9,.№\\\\/\\s]*)$)|(^$)",result.message="Возможные значения: цифры, кириллица, знаки ., №,\\,/, - . Первый знак обязательно цифра";break;case"kladrInput":result.regexp="(^([-А-Яа-яёЁ0-9,.№\\\\/\\s]+)$)|(^$)",result.message="Возможные значения: цифры, кириллица, знаки ., №,\\,/, - ";break;case"kladrInputRkn":result.regexp="(^([-А-Яа-яёЁ0-9,.();№'\\\\/\"\\s]+)$)|(^$)",result.message='Возможные значения: цифры, кириллица, знаки точка, запятая, №, \\, /, -, (, ), ", ;.';break;case"kladrPostIndex":result.regexp="(^(\\d{6}$))|(^$)",result.message="Пожалуйста, введите 6 цифр.";break;default:result.regexp="",result.message=""}return result},getKladrInfoByVersion:function(version,labels,allowOptionalBuilding1){var result='<p class="PGU-PlainText PGU-PlainText-FirstItem ">Если значение поля «'+labels.city+"» не выбрано, то&nbsp;поле «"+labels.town+"» обязательно должно быть выбрано.</p>";switch(version){case"Kladr":case"KladrJuridicalPersonRKN":case"KladrNaturalPersonRKN":result+=(allowOptionalBuilding1?"":'<p class="PGU-PlainText">При установке флага «Нет» для&nbsp;поля «'+labels.house+"», поле «"+labels.building1+"» обязательно для&nbsp;заполнения. </p>")+'<p class="PGU-PlainText PGU-PlainText-LastItem">Если ввод данных в&nbsp;поле «'+labels.apartment+"» не&nbsp;требуется, то&nbsp;установите флаг «Нет» для&nbsp;этого поля. </p>"}return result},getKladrInfoAndPostIndex:function(infoHtml,labels,path,kladrVersion){var self=this,panelName="postIndexPanel",result={postIndexPanelName:panelName,labelName:"kladrInfo"};return result.label={className:"Label",fullPath:path+".kladrInfo",name:"kladrInfo",text:infoHtml},result.postIndexPanel={className:"Panel",title:"",name:panelName,fullPath:path+"."+panelName,serviceCardTitle:labels.postIndexTitle?labels.postIndexTitle:"",items:"LocationBasedOnKladr"!==kladrVersion&&"KladrRusStat"!==kladrVersion?[{className:"FieldText",label:labels.post_index,validators:[self.getKladrValidatorsByMnemonic("kladrPostIndex")],required:!0,name:"post_index",fullPath:path+"."+panelName+".post_index",doNotSaveDraft:!0}]:[]},result},createKladrForms:function($item,models,dataOrg){var withCheckbox,kladrOtherFields,dependentFields,itemName,data=this.cloneStructureKLADR(dataOrg),self=this,items=[],allowOptionalBuilding1=$item.allowOptionalBuilding1,kladrVersion=$item.kladrVersion||$item.className,fullPath=$item.fullPath,labels=KLADR_LABELS;angular.isObject($item.allowEditlabels)&&angular.extend(labels,$item.allowEditlabels);var kladrInfo,otherInfo={name:"other_info",remoteMethod:"",level:10,dependentFields:"house, building1, building2, apartment, street",checkboxLabel:"Нет",maxlength:10,required:!0,mnemonic:"kladrInputRkn",hint:"Доступно для заполнения при незаполненном поле «"+labels.house+"»"},isRKNVersion="KladrAddressRKN"===kladrVersion||"KladrJuridicalPersonRKN"===kladrVersion||"KladrNaturalPersonRKN"===kladrVersion,isRusStatVersion="KladrRusStat"===kladrVersion,rknConditions=isRusStatVersion?RUSSTAT_CONDITIONS:RKN_CONDITIONS;"KladrAddressRKN"===kladrVersion&&(rknConditions.apartment.required=!1),"KladrNaturalPersonRKN"===kladrVersion&&(rknConditions.apartment.required=!0);var otherInfoNeed=!0;if("KladrAddressRKN"===kladrVersion&&(data&&data.length&&data.forEach(function(item){if("other_info"===item.name)return void(otherInfoNeed=!1)}),otherInfoNeed&&data.push(otherInfo)),isRKNVersion||isRusStatVersion)for(var i=0,il=data.length;i<il;i++){if(itemName=data[i].name,rknConditions[itemName])for(var key in rknConditions[itemName])rknConditions[itemName].hasOwnProperty(key)&&(data[i][key]=rknConditions[itemName][key]);if("KladrAddressRKN"===kladrVersion&&ADDRESS_RKN_CONDITIONS[itemName])for(var k in ADDRESS_RKN_CONDITIONS[itemName])ADDRESS_RKN_CONDITIONS[itemName].hasOwnProperty(k)&&(data[i][k]=ADDRESS_RKN_CONDITIONS[itemName][k])}"LocationBasedOnKladr"===kladrVersion&&(data=data.filter(function(item){return item.remoteMethod})),kladrInfo=self.getKladrInfoByVersion(kladrVersion,labels,allowOptionalBuilding1);var mixedForm=data.map(function(item,ind){return dependentFields=item.dependentFields?self.mapDependentFields(item.name,fullPath+".mixed",item.dependentFields,allowOptionalBuilding1,"house"==item.name):[],withCheckbox=item.withCheckbox,item.remoteMethod?{className:"KladrDropdown",name:item.name,fullPath:fullPath+".mixed."+item.name,depends:item.depends,label:labels[item.name],required:item.required||!1,emptyField:"",kladrPath:fullPath,remoteMethod:item.remoteMethod,notRequiredText:"",value:$item[item.name+"_code"]?$item[item.name]:"",doNotSaveDraft:!0,withCheckbox:isRusStatVersion&&withCheckbox,bindAttrsOnValue:isRusStatVersion&&withCheckbox?self.getToggleAttrs(!1,[{attrName:"text_value",dependentValue:""}]):"",checkboxLabel:isRusStatVersion&&item.checkboxLabel,dependentFields:dependentFields,requestParams:item.requestParams,visible:!isRusStatVersion||(!item.isMixedWhenManual||"true"!==$item.manualEnter),isRusStatVersion:isRusStatVersion}:{className:"FieldText",required:item.requiredTextField||!1,validators:[self.getKladrValidatorsByMnemonic(item.mnemonic)],name:item.name,fullPath:fullPath+".mixed."+item.name,dependentFields:dependentFields,label:labels[item.name],withCheckbox:item.withCheckbox,checkboxLabel:item.checkboxLabel,bindAttrsOnValue:item.withCheckbox?self.getToggleAttrs():"",notRequiredText:"",maxlength:item.maxlength,hint:item.hint?item.hint:"",shortTitle:item.shortTitle||"",doNotSaveDraft:!0,value:$item[item.name],visible:!item.isExclude,isRusStatVersion:isRusStatVersion}});if($item.dictionaryOnly)var manualForm=data.map(function(item,ind){return dependentFields=item.dependentFields?self.mapDependentFields(item.name,fullPath+".manual",item.dependentFields,allowOptionalBuilding1,"house"==item.name||"city"==item.name):[],isRusStatVersion?{className:"FieldText",required:item.required||item.requiredTextField||!1,validators:[self.getKladrValidatorsByMnemonic(item.mnemonic)],name:item.name,fullPath:fullPath+".manual."+item.name,dependentFields:dependentFields,label:labels[item.name],withCheckbox:item.withCheckbox,checkboxLabel:item.checkboxLabel,bindAttrsOnValue:item.withCheckbox?self.getToggleAttrs():"",notRequiredText:"",maxlength:item.maxlength,hint:item.hint?item.hint:"",shortTitle:item.shortTitle||"",doNotSaveDraft:!0,value:$item[item.name],visible:!(item.isExclude||!item.isMixedWhenManual),isRusStatVersion:isRusStatVersion}:{className:"FieldText",required:item.required||item.requiredTextField||!1,validators:[self.getKladrValidatorsByMnemonic(item.mnemonic)],name:item.name,fullPath:fullPath+".manual."+item.name,dependentFields:dependentFields,label:labels[item.name],withCheckbox:item.withCheckbox,checkboxLabel:item.checkboxLabel,bindAttrsOnValue:item.withCheckbox?self.getToggleAttrs():"",notRequiredText:"",maxlength:item.maxlength,hint:item.hint||"",shortTitle:item.shortTitle||"",value:$item[item.name],doNotSaveDraft:!0}});return models.postIndexTitle=labels.postIndexTitle,items.push({name:"mixed",title:"",serviceCardTitle:labels.title,className:"Panel",fullPath:fullPath+".mixed",items:mixedForm,visible:!0}),$item.dictionaryOnly&&items.push({name:"manual",serviceCardTitle:labels.title,title:"",fullPath:fullPath+".manual",className:"Panel",items:manualForm,visible:!!isRusStatVersion&&"true"===$item.manualEnter}),kladrOtherFields=self.getKladrInfoAndPostIndex(kladrInfo,labels,fullPath,kladrVersion),"LocationBasedOnKladr"===kladrVersion||isRusStatVersion||(models.postIndexPanelName=kladrOtherFields.postIndexPanelName),models.labelName=kladrOtherFields.labelName,items.push(kladrOtherFields.label,kladrOtherFields.postIndexPanel),items.concat()},tryToGetZipCode:function(item,models,kladrCode,postIndexPanelName){var method,params={};if(kladrCode&&models.lastZipcodeRequestKladr!==kladrCode)method="/"+kladrCode;else{if(api.find(item.fullPath+".mixed").attr("items").forEach(function(item){item.value&&"KladrDropdown"==item.className&&(params.value=item.value,params.path=item.fullPath)}),!params||!params.value)return this;method="/"+apiInner.getListElemFromValue(PGU.Kladr[params.path].originList,params.value).kladrId}sharedExtServices.kladrService(method,null,function(data){data.hasOwnProperty("uno")&&(models.taxCode=data.uno),data.hasOwnProperty("gninmb")&&(models.taxAreaCode=data.gninmb),models.lastZipcodeRequestKladr==kladrCode&&data.hasOwnProperty("zipcode")&&models.postIndexPanelName&&(api.find(item.fullPath+"."+models.postIndexPanelName).find("post_index").element.value=data.zipcode||""),item.lastZipcodeRequestKladr===models.lastZipcodeRequestKladr&&(api.find(item.fullPath+"."+models.postIndexPanelName).find("post_index").element.value=item.post_index)},function(error){return!1}),models.lastZipcodeRequestKladr=kladrCode},mapDependentFields:function(name,path,dependentFields,allowOptionalBuilding1,dependHack){var field,arr,fullPath,attrs,result=[];if(dependentFields){if("house"===name&&allowOptionalBuilding1)return result;arr=dependentFields.split(",");for(var i=0,il=arr.length;i<il;i++)attrs=this.getToggleAttrs(dependHack),field=arr[i].trim(),fullPath=path+"."+field,"other_info"===name&&"street"===field&&attrs.push({attrName:"withCheckbox",dependentValue:!1}),result.push({fullPath:fullPath,attrs:attrs})}return result},getFieldsData:function(items){var result=[];return items.forEach(function(item){"KladrDropdown"===item.className?result.push({name:item.name,value:item.value,text_value:item.text_value||"",shortTitle:item.shortTitle||""}):result.push({name:item.name,value:"",text_value:item.value,shortTitle:item.shortTitle||""})}),result},getToggleAttrs:function(dependHack,attrs){var result;return result=dependHack?[{attrName:"required",dependentValue:!0}]:[{attrName:"value",dependentValue:""},{attrName:"disabled",dependentValue:!0},{attrName:"required",dependentValue:!1}],attrs&&(result=result.concat(attrs)),result},clearData:function(item,models,panelName,includeOnly){models.preventUpdateSelects=!0;var items=panelName?api.find(item.fullPath+"."+panelName).items:item.items;apiInner.loopThroughTheTree(items,function(items,item){(!includeOnly||includeOnly&&~includeOnly.indexOf(item.name))&&(void 0!==item.value&&(item.value=""),void 0!==item.text_value&&(item.text_value=""),item.error&&(item.error=""))}),item.taxCode="",item.taxAreaCode="",models.preventUpdateSelects=!1},clearKladr:function(item,models){var ks=KLADR_STRUCTURE.slice();item.value="",item.taxCode="",item.taxAreaCode="",item.manualEnter="false";for(var i=0;i<ks.length;i++){var field=ks[i];field.withCheckbox,item.hasOwnProperty(field.name)&&(item.hasOwnProperty(field.name+"_code")&&(item[field.name+"_code"]=""),item.hasOwnProperty(field.name+"_statusCheckbox")&&(item[field.name+"_statusCheckbox"]=!1),item.hasOwnProperty(field.name+"Disabled")&&(item[field.name+"Disabled"]="no"),item[field.name]="")}if(item.post_index&&(item.post_index=""),item.other_info&&(item.other_info=""),item.items&&item.items.length)for(var i=0;i<item.items.length;i++){var panel=item.items[i];if(panel&&panel.items&&panel.items.length)for(var j=0;j<panel.items.length;j++){var field=panel.items[j];void 0!==field.value&&(field.value=""),void 0!==field.text_value&&(field.text_value=""),field.error&&(field.error=!1),field.isValid||(field.isValid=!0)}}api.env("autosaveDisabled")||api.uploadDraft(!1,null,null,!1,item)},saveData:function(item,models,formState,lazy){var field,fullAddress="",str="",validInfo=this.kladrValidate(item,lazy),isValidItem=validInfo.isValidItem,panels=validInfo.panels,taxCode=models.taxCode?models.taxCode:"",taxAreaCode=models.taxAreaCode;if(isValidItem)for(var i=0,il=panels.length;i<il;i++)for(var j=0,jl=panels[i].items.length;j<jl;j++)field=panels[i].items[j],item[field.name+"_statusCheckbox"]=field.statusCheckbox||!1,item.hasOwnProperty(field.name)&&api.inheritedVisibility(field.fullPath)&&(item.hasOwnProperty(field.name+"_code")&&(item[field.name+"_code"]="KladrDropdown"===field.className?field.value:""),item[field.name]="KladrDropdown"===field.className?field.text_value||"":field.value,item.hasOwnProperty(field.name+"Disabled")&&(item[field.name+"Disabled"]=field.statusCheckbox?"yes":"no"),(str=item[field.name])&&("post_index"===field.name?fullAddress=str+", "+fullAddress:"apartment"===field.name&&field.label&&"Квартира"!==field.label?fullAddress+=fullAddress?", "+field.label+" "+str:field.label+" "+str:fullAddress+=fullAddress?", "+(field.shortTitle?field.shortTitle+" ":"")+str:(field.shortTitle?field.shortTitle+" ":"")+str));return isValidItem&&(item.value=fullAddress,item.taxCode=taxCode,item.taxAreaCode=taxAreaCode,item.manualEnter="manual"===formState?"true":"false"),api.env("autosaveDisabled")||api.uploadDraft(!1,null,null,!1,item),isValidItem},restoreKladrPartsToFields:function($item,models){var field,allDependsValid,panel,partCode,partText,self=this,otherInfoDisabled=!1;models.preventUpdateSelects=!0,$item.items.forEach(function(item){if("Panel"===item.className&&item.items&&item.items.length){for(var otherInfoDependentFields=[],needDisabledDependentFields=!1,i=0,il=item.items.length;i<il;i++)panel=api.find(item.fullPath),field=item.items[i],partCode=$item[field.name+"_code"],partText=$item[field.name],"KladrDropdown"===field.className?(allDependsValid=self.checkDependsValue(panel,field.depends),field.value=allDependsValid&&partCode||"",field.text_value=allDependsValid&&partCode&&partText?partText:"",$item.hasOwnProperty(field.name+"Disabled")&&(field.statusCheckbox="yes"===$item[field.name+"Disabled"])):("house"===field.name&&""!=partText&&(otherInfoDisabled=!0),"other_info"===field.name&&otherInfoDisabled?(field.disabled=otherInfoDisabled,field.required=!otherInfoDisabled):"other_info"===field.name&&""!=partText&&(needDisabledDependentFields=!0,angular.copy(field.dependentFields,otherInfoDependentFields)),field.statusCheckbox=$item[field.name+"_statusCheckbox"],$item.hasOwnProperty(field.name+"Disabled")&&(field.statusCheckbox="yes"===$item[field.name+"Disabled"]),partText&&(field.value=partText));if(needDisabledDependentFields)for(i=0;i<otherInfoDependentFields.length;i++)api.find(otherInfoDependentFields[i].fullPath).disabled(!0),api.find(otherInfoDependentFields[i].fullPath).required(!1),"function"==typeof api.find(otherInfoDependentFields[i].fullPath).withCheckbox&&api.find(otherInfoDependentFields[i].fullPath).withCheckbox()&&(api.find(otherInfoDependentFields[i].fullPath).element.hookCheckbox=!0)}}),models.preventUpdateSelects=!1},checkDependsValue:function(panel,depends){var hasValue=!1;if(!depends.length)return!0;for(var i=0,il=depends.length;i<il;i++)if(panel.find(depends[i])&&panel.find(depends[i]).attr("value")){hasValue=!0;break}return hasValue},copyFieldsValues:function(item,selectsIsChanged,from,to,includeOnly){for(var field,fieldTo,panelFrom=api.find(item.fullPath+"."+from),panelTo=api.find(item.fullPath+"."+to),i=0,il=panelFrom.attr("items").length;i<il;i++)field=panelFrom.attr("items")[i],fieldTo=panelTo.find(field.name),item[field.name],fieldTo&&(!includeOnly||includeOnly&&~includeOnly.indexOf(field.name))&&(field.isRusStatVersion&&fieldTo.element.isRusStatVersion&&fieldTo.element.withCheckbox&&field.withCheckbox&&(fieldTo.element.disabled=field.disabled,fieldTo.element.cbInField.checked=field.disabled),"KladrDropdown"===field.className?field.text_value&&!fieldTo.attr("disabled")?fieldTo.element.value=field.text_value:fieldTo.element.value?(field.currentItemKLADR&&-1!==field.currentItemKLADR&&(fieldTo.element.value=field.text_value),field.isRusStatVersion&&fieldTo.element.isRusStatVersion&&(fieldTo.element.value=field.text_value)):fieldTo.element.value="":"KladrDropdown"===fieldTo.element.className?field.value!==fieldTo.element.text_value&&(fieldTo.element.value="",fieldTo.element.text_value=""):fieldTo.element.value=field.value,fieldTo.element.error=!1,fieldTo.element.isValid=!0);var postIndex=api.find(item.fullPath+".postIndexPanel.post_index")?api.find(item.fullPath+".postIndexPanel.post_index").element:{};postIndex.error=!1,postIndex.isValid=!0},kladrValidate:function($item,lazy){for(var item,visibleMixedPanel,visibleManulPanel,region,city,town,street,regionCode,house,building1,apartment,otherInfo,isValidItemAll=!0,panels=[],errWithCheckbox="KladrAddressRKN"==$item.className?"Поле обязательно для заполнения":'Это поле необходимо заполнить или выбрать вариант "Нет"',isRusStat="KladrRusStat"===$item.className,i=0,il=$item.items.length;i<il;i++){item=$item.items[i];var isValidItem=!0;if(isRusStat&&(visibleMixedPanel="",visibleManulPanel=""),!lazy&&item.visible&&"Panel"===item.className&&("mixed"===item.name?visibleMixedPanel=item.fullPath:"manual"===item.name&&(visibleManulPanel=item.fullPath)),item.visible&&"Panel"===item.className){visibleMixedPanel&&(region=api.find(visibleMixedPanel).find("region"),city=api.find(visibleMixedPanel).find("city"),town=api.find(visibleMixedPanel).find("town"),street=api.find(visibleMixedPanel).find("street"),house=api.find(visibleMixedPanel).find("house"),building1=api.find(visibleMixedPanel).find("building1"),apartment=api.find(visibleMixedPanel).find("apartment"),otherInfo=api.find(visibleMixedPanel).find("other_info"),regionCode=region.attr("value"),city.element.required=!town.attr("value"),!1==!town.attr("value")&&(city.element.error=!1),(-1!==["78000000000","77000000000","99000000000","92000000000"].indexOf(regionCode)||isRusStat&&~["2710","6865","19159"].indexOf(""+regionCode))&&(city.element.required=!1,town.element.required=!1),isRusStat||(street.element.required=!1));var fieldValidate=api.find(item.fullPath);if(isValidItem=fieldValidate.validate(),fieldValidate.element.items.forEach(function(item){item.withCheckbox&&!api.find(item.fullPath).validate()?item.error='Это поле необходимо заполнить или выбрать вариант "Нет"':item.error=!1}),!visibleMixedPanel&&!isRusStat){var regionManual=api.find(item.fullPath).find("region"),cityManual=api.find(item.fullPath).find("city"),townManual=api.find(item.fullPath).find("town");regionManual&&(regionManual.attr("value")?regionManual.element.error=!1:(regionManual.element.error="Это поле необходимо заполнить",isValidItemAll=!1,fieldValidate.scrollToError(fieldValidate,"popup",$item))),cityManual&&(cityManual.disabled()&&!townManual.attr("value")?(townManual.element.error="Это поле необходимо заполнить",isValidItemAll=!1,fieldValidate.scrollToError(fieldValidate,"popup",$item)):townManual.element.error=!1,cityManual.disabled()||cityManual.attr("value")?cityManual.element.error=!1:(cityManual.element.error=errWithCheckbox,isValidItemAll=!1,fieldValidate.scrollToError(fieldValidate,"popup",$item)))}visibleManulPanel&&isRusStat&&(house=api.find(item.fullPath).find("house"),apartment=api.find(item.fullPath).find("apartment")),isValidItem&&panels.push(item),isValidItemAll&&!isValidItem&&fieldValidate.scrollToError(fieldValidate,"popup",$item),isValidItemAll=isValidItemAll&&isValidItem}}(visibleMixedPanel||isRusStat)&&(region.element.error=!regionCode&&"Поле обязательно для заполнения",city.required(!town.attr("value")),!1==!town.attr("value")&&(city.element.error=!1),city.attr("value")||town.attr("value")||(!isRusStat&&-1==["78000000000","77000000000","99000000000","92000000000"].indexOf(regionCode)||isRusStat&&!~["2710","6865","19159"].indexOf(""+regionCode)?(city.element.error="Если значение поля «"+city.attr("label")+"» не выбрано, то поле «"+town.attr("label")+"» обязательно должно быть выбрано.",isValidItemAll=!1):(city.element.error=!1,town.element.error=!1)),"LocationBasedOnKladr"!==$item.className&&(isRusStat&&street.validate(),house.attr("value")||house.disabled()?house.element.error=!1:house.element.error=errWithCheckbox,apartment.attr("value")||apartment.disabled()?apartment.element.error=!1:(isValidItemAll=!1,apartment.element.error=errWithCheckbox),house.attr("disabled")&&building1&&(building1.attr("value")||(!otherInfo||otherInfo.attr("value"))&&otherInfo?building1.element.error=!1:building1.element.error="Это поле необходимо заполнить")));var postIndex=api.find($item.fullPath+".postIndexPanel.post_index");return postIndex&&!isRusStat&&(postIndex.attr("value")&&postIndex.validate()?postIndex.element.error=!1:postIndex.element.error="Это поле необходимо заполнить шестизначным числовым значением"),{isValidItem:isValidItemAll,panels:panels}},cloneStructureKLADR:function(dataOrg){var data=[];return dataOrg.forEach(function(item,i){data[i]={};for(var k in item)data[i][k]=item[k]}),data}}}]),angular.module("serverFormWidgets.general").directive("epguFias",["pguFiasService","TEMPLATES","api","apiInner","$rootScope","$timeout","$q","Validators","PGU",function(pguFiasService,TEMPLATES,api,apiInner,$rootScope,$timeout,$q,Validators,PGU){return{template:'<div        ng-show="(!!item.visible)"        class="            PGU-{{::item.className}}            PGU-LabelWidth-{{::item.labelWidth}}            PGU-Labelalign-{{::item.labelAlign}}            {{item.disabled ? \'PGU-Disabled\' : \'\'}}            {{item.required ? \'PGU-Required\' : \'\'}}            {{item.error    ? \'PGU-Error\'    : \'\'}}            "        id="{{::id}}"        full-path="{{::item.fullPath}}"        >    <div class="PGU-KladrWrap PGU-FiasWrap PGU-FieldBody">        <div>            <div class="address-in-one"></div>        </div>        <div class="PGU-Fias-Fields-Container-V2 js-PGU-Fias-Fields-Container-V2">            <form-tree ng-repeat="item_i in item.items track by $index" item="item_i"></form-tree>        </div>        <div class="PGU-FieldNotRequired" ng-if="item.notRequiredText">{{::item.notRequiredText}}</div>        <div class="PGU-FieldHint" ng-if="item.hint">{{::item.hint}}</div>                    <div class="PGU-FieldError" data-ng-if="item.error">{{(item.error.mnemonic + \'.validator\' | translate:item.error.text) || (item.error.text || item.error)}}</div>\n    </div></div>',replace:!0,scope:{item:"="},link:function(scope,element,attrs){if(!$rootScope.isDesigner){scope.model={},$rootScope.settings.initStrategy=$rootScope.settings.initStrategy||[],$rootScope.settings.initStrategy[scope.item.fullPath+".PanelControls.PanelDropdown.Dropdown"]={title:scope.item.value},scope.item.setValueToString=function(addressString,fiasCode,okatoCode){pguFiasService.setValueToString(scope,addressString,fiasCode,okatoCode)},scope.item.required&&api.find(scope.item.fullPath).setRequired(!0);var watchers;scope.$on("suspend",function(){watchers=scope.$$watchers,scope.$$watchers=[]}),scope.$on("resume",function(){scope.$$watchers=watchers,watchers=null}),function(){pguFiasService.initFiasFields(scope).then(function(initData){pguFiasService.setWatchers(scope),scope.$emit(scope.item.fullPath+":ScopeApplied",{scope:scope,element:element}),scope.item.label&&(api.find(scope.item.fullPath+".PanelControls.PanelDropdown.Dropdown").label(scope.item.label),scope.item.label="")},function(failed){})}(),scope.item.setDraftFromEdit=function(){var defer=$q.defer();return pguFiasService.setDraftFromEdit(scope,defer),defer.promise},scope.item.api=api}}}}]).factory("FiasExt",["$rootScope","fiasStructure","fieldAttrs","Validators",function($rootScope,fiasStructure,fieldAttrs,Validators){return{attrs:angular.extend({},fieldAttrs.attrs,{validators:{"scope:editor":!1},value:{"scope:editor":!1,"scope:sync":!0},strategy:{type:"string",default:"",enum:window.Editor&&[""].concat(Editor.strategyKeys),enumOptions:window.Editor&&$.extend({"":""},Editor.strategyHash)},readonly:{"scope:editor":!1},post_index:{type:"string",default:"","scope:sync":!0},region:{type:"string",default:"","scope:sync":!0},regionFias:{type:"string",default:"","scope:editor":!1,"scope:sync":!0},regionKladr:{type:"string",default:"","scope:editor":!1,"scope:sync":!0},regionType:{type:"string",default:"","scope:editor":!1,"scope:sync":!0},regionShortType:{type:"string",default:"","scope:editor":!1,"scope:sync":!0},area:{type:"string",default:"","scope:sync":!0},areaType:{type:"string",default:"","scope:sync":!0},areaShortType:{type:"string",default:"","scope:sync":!0},areaFias:{type:"string",default:"","scope:editor":!1,"scope:sync":!0},areaKladr:{type:"string",default:"","scope:editor":!1,"scope:sync":!0},city:{type:"string",default:"","scope:sync":!0},cityType:{type:"string",default:"","scope:sync":!0},cityShortType:{type:"string",default:"","scope:sync":!0},cityFias:{type:"string",default:"","scope:editor":!1,"scope:sync":!0},cityKladr:{type:"string",default:"","scope:editor":!1,"scope:sync":!0},cityArea:{type:"string",default:"","scope:sync":!0},cityAreaType:{type:"string",default:"","scope:sync":!0},cityAreaShortType:{type:"string",default:"","scope:sync":!0},cityAreaFias:{type:"string",default:"","scope:editor":!1,"scope:sync":!0},cityAreaKladr:{type:"string",default:"","scope:editor":!1,"scope:sync":!0},place:{type:"string",default:"","scope:sync":!0},placeType:{type:"string",default:"","scope:sync":!0},placeShortType:{type:"string",default:"","scope:sync":!0},placeFias:{type:"string",default:"","scope:editor":!1,"scope:sync":!0},placeKladr:{type:"string",default:"","scope:editor":!1,"scope:sync":!0},street:{type:"string",default:"","scope:sync":!0},streetType:{type:"string",default:"","scope:sync":!0},streetShortType:{type:"string",default:"","scope:sync":!0},streetFias:{type:"string",default:"","scope:editor":!1,"scope:sync":!0},streetKladr:{type:"string",default:"","scope:editor":!1,"scope:sync":!0},additionalArea:{type:"string",default:"","scope:sync":!0},additionalAreaType:{type:"string",default:"","scope:sync":!0},additionalAreaShortType:{type:"string",default:"","scope:sync":!0},additionalAreaFias:{type:"string",default:"","scope:editor":!1,"scope:sync":!0},additionalAreaKladr:{type:"string",default:"","scope:editor":!1,"scope:sync":!0},additionalStreet:{type:"string",default:"","scope:sync":!0},additionalStreetType:{type:"string",default:"","scope:sync":!0},additionalStreetShortType:{type:"string",default:"","scope:sync":!0},additionalStreetFias:{type:"string",default:"","scope:editor":!1,"scope:sync":!0},
additionalStreetKladr:{type:"string",default:"","scope:editor":!1,"scope:sync":!0},house:{type:"string",default:"","scope:sync":!0},houseType:{type:"string",default:"","scope:sync":!0},houseShortType:{type:"string",default:"","scope:sync":!0},houseFias:{type:"string",default:"","scope:editor":!1,"scope:sync":!0},houseKladr:{type:"string",default:"","scope:editor":!1,"scope:sync":!0},building1:{type:"string",default:"","scope:sync":!0},building1Type:{type:"string",default:"","scope:sync":!0},building1ShortType:{type:"string",default:"","scope:sync":!0},building2:{type:"string",default:"","scope:sync":!0},building2Type:{type:"string",default:"","scope:sync":!0},building2ShortType:{type:"string",default:"","scope:sync":!0},apartment:{type:"string",default:"","scope:sync":!0},fias_full_code:{type:"string",default:"","scope:sync":!0},numericFiasCode:{type:"string",default:"","scope:sync":!1},kladrCode:{type:"string",default:"","scope:sync":!0},cityDisabled:{type:"string",default:"no","scope:sync":!0,"scope:editor":!1},houseDisabled:{type:"string",default:"no","scope:sync":!0,"scope:editor":!1},apartmentDisabled:{type:"string",default:"no","scope:sync":!0,"scope:editor":!1},removeOpts:{type:"string",default:""},fullCodes:{type:"boolean",enum:[!0,!1],enumOptions:{true:"Да",false:"Нет"},default:!1},elmCode:{type:"string",default:"","scope:editor":!1,"scope:sync":!0},oktmoCode:{type:"string",default:"","scope:editor":!1,"scope:sync":!0},withoutFiasCode:{type:"boolean",enum:[!0,!1],enumOptions:{true:"Да",false:"Нет"},default:!1,"scope:editor":!0,"scope:sync":!1},fiasDone:{type:"string",default:"","scope:editor":!1,"scope:sync":!0},pageNum:{"scope:sync":!1},allowOptionalBuilding1:{type:"boolean","scope:editor":!0,enum:[!1,!0],enumOptions:{false:"Обязательный",true:"Необязательный"},"scope:sync":!1,default:!0}}),fillItems:function(item){return this.fillFullPath(fiasStructure.getStructure(),this.element.fullPath)},fillFullPath:function(structure,parentPath){if(structure.fullPath=parentPath+"."+structure.name,structure.originalFullPath=parentPath+"."+structure.name,structure.items&&structure.items.length)for(var i=0;i<structure.items.length;i++)structure.items[i]=this.fillFullPath(structure.items[i],structure.fullPath);return structure},validate:function(lazy){var self=this,valid=!0,validFields=!0,errNoFullFiasCode="Адрес не может быть автоматически распознан. Пожалуйста, начните вводить адрес с названия региона и следуйте подсказкам.";if(this.error(!1),this.disabled()||!this.visible()||!this.inheritedVisibility())return!0;for(var c in this.attr("controlsObj"))validFields=this.attr("controlsObj")[c].el.validate(lazy)&&validFields;return validFields?self.required()?self.withoutFiasCode()?self.value()||lazy||(self.error("Поле обязательно для заполнения"),valid=!1):(self.value()||self.attr("fias_full_code")||lazy||(self.error("Поле обязательно для заполнения"),valid=!1),self.value()&&!self.attr("fias_full_code")&&(self.error(errNoFullFiasCode),valid=!1)):!self.value()||self.attr("fias_full_code")||self.attr("withoutFiasCode")||(self.error(errNoFullFiasCode),valid=!1):(self.error(!1),valid=!1),self.find("PanelControls.PanelDropdown.Dropdown").error(valid?!valid:" "),!self.__setFirstFieldError||valid||lazy||(self.__setFirstFieldError=!1,self.scrollToError(self)),!this.element.api||this.element.api.__setFirstFieldError||lazy||valid||(this.element.api.__setFirstFieldError=this.element.fullPath),valid}}}]).factory("fiasStructure",[function(){function getStructure(){var structure={className:"Panel",name:"PanelControls",title:"",isGrid:!0,doNotSave:!0,doNotSaveDraft:!0,items:[{className:"Panel",name:"PanelDropdown",title:"",isGridItem:!0,doNotSaveDraft:!0,items:[{className:"FieldDropdown",name:"Dropdown",label:"ФИАС",selectType:"DropdownForFias",notRequiredText:"",doNotSaveDraft:!0,doNotShowInPdf:!0}]},{className:"Panel",name:"PanelFullAddress",title:"",isGridItem:!0,visible:!1,doNotSaveDraft:!0,items:[{className:"FieldText",name:"FullAddress",label:"Полный адрес",notRequiredText:"",disabled:!0,visible:!0,doNotSaveDraft:!0,doNotShowInPdf:!0}]},{className:"Panel",name:"PanelRegion",title:"",isGridItem:!0,visible:!1,doNotSaveDraft:!0,items:[{className:"FieldText",name:"Region",label:"Регион",notRequiredText:"",visible:!0,validators:[factory.getFiasValidatorsByMnemonic("FiasString")],maxlength:50,doNotSaveDraft:!0,doNotShowInPdf:!0}]},{className:"Panel",name:"PanelArea",title:"",isGridItem:!0,visible:!1,gridWidth:"one-half",doNotSaveDraft:!0,items:[{className:"FieldText",name:"Area",label:"Район",notRequiredText:"",visible:!0,validators:[factory.getFiasValidatorsByMnemonic("FiasString")],maxlength:100,doNotSaveDraft:!0,doNotShowInPdf:!0}]},{className:"Panel",name:"PanelCity",title:"",isGridItem:!0,visible:!1,gridWidth:"one-half",doNotSaveDraft:!0,items:[{className:"FieldText",name:"City",label:"Город",notRequiredText:"",visible:!0,validators:[factory.getFiasValidatorsByMnemonic("FiasString")],maxlength:150,doNotSaveDraft:!0,doNotShowInPdf:!0},{className:"FieldCheckbox",name:"CityNo",label:"Нет",notRequiredText:"",visible:!0,doNotSaveDraft:!0,doNotShowInPdf:!0}]},{className:"Panel",name:"PanelCityArea",title:"",isGridItem:!0,visible:!1,gridWidth:"one-half",doNotSaveDraft:!0,items:[{className:"FieldText",name:"CityArea",label:"Внутригородской район",notRequiredText:"",visible:!0,validators:[factory.getFiasValidatorsByMnemonic("FiasString")],maxlength:150,doNotSaveDraft:!0,doNotShowInPdf:!0}]},{className:"Panel",name:"PanelPlace",title:"",isGridItem:!0,visible:!1,gridWidth:"one-half",doNotSaveDraft:!0,items:[{className:"FieldText",name:"Place",label:"Населенный пункт",notRequiredText:"",visible:!0,validators:[factory.getFiasValidatorsByMnemonic("FiasString")],maxlength:150,doNotSaveDraft:!0,doNotShowInPdf:!0}]},{className:"Panel",name:"PanelStreet",title:"",isGridItem:!0,visible:!1,gridWidth:"one-half",doNotSaveDraft:!0,items:[{className:"FieldText",name:"Street",label:"Улица",notRequiredText:"",visible:!0,validators:[factory.getFiasValidatorsByMnemonic("FiasString")],maxlength:100,doNotSaveDraft:!0,doNotShowInPdf:!0}]},{className:"Panel",name:"PanelAdditionalArea",title:"",isGridItem:!0,visible:!1,gridWidth:"one-half",doNotSaveDraft:!0,items:[{className:"FieldText",name:"AdditionalArea",label:"Доп. территория",notRequiredText:"",visible:!0,validators:[factory.getFiasValidatorsByMnemonic("FiasString")],doNotSaveDraft:!0,doNotShowInPdf:!0}]},{className:"Panel",name:"PanelAdditionalStreet",title:"",isGridItem:!0,visible:!1,gridWidth:"one-half",doNotSaveDraft:!0,items:[{className:"FieldText",name:"AdditionalStreet",label:"Улица на доп. территории",notRequiredText:"",visible:!0,validators:[factory.getFiasValidatorsByMnemonic("FiasString")],doNotSaveDraft:!0,doNotShowInPdf:!0}]},{className:"Panel",name:"PanelHBBA",title:"",isGrid:!0,isGridItem:!0,gridWidth:"one-whole",doNotSaveDraft:!0,items:[{className:"Panel",name:"PanelHouse",title:"",isGridItem:!0,visible:!1,gridWidth:"one-sixth",doNotSaveDraft:!0,items:[{className:"FieldText",name:"House",label:"Дом",notRequiredText:"",visible:!0,required:!0,validators:[{mnemonic:"required"},factory.getFiasValidatorsByMnemonic("FiasString")],maxlength:10,doNotSaveDraft:!0,doNotShowInPdf:!0},{className:"FieldCheckbox",name:"HouseNo",label:"Нет",notRequiredText:"",visible:!0,doNotSaveDraft:!0,doNotShowInPdf:!0}]},{className:"Panel",name:"PanelBuilding1",title:"",isGridItem:!0,visible:!1,gridWidth:"one-sixth",doNotSaveDraft:!0,items:[{className:"FieldText",name:"Building1",label:"Корпус",notRequiredText:"",visible:!0,validators:[factory.getFiasValidatorsByMnemonic("FiasString")],maxlength:10,doNotSaveDraft:!0,doNotShowInPdf:!0}]},{className:"Panel",name:"PanelBuilding2",title:"",isGridItem:!0,visible:!1,gridWidth:"one-sixth",doNotSaveDraft:!0,items:[{className:"FieldText",name:"Building2",label:"Строение",notRequiredText:"",visible:!0,validators:[factory.getFiasValidatorsByMnemonic("FiasString")],maxlength:10,doNotSaveDraft:!0,doNotShowInPdf:!0}]},{className:"Panel",name:"PanelApartment",title:"",isGridItem:!0,visible:!1,gridWidth:"one-sixth",doNotSaveDraft:!0,items:[{className:"FieldText",name:"Apartment",label:"Квартира",notRequiredText:"",visible:!0,required:!0,validators:[{mnemonic:"required"},factory.getFiasValidatorsByMnemonic("FiasString")],maxlength:10,doNotSaveDraft:!0,doNotShowInPdf:!0},{className:"FieldCheckbox",name:"ApartmentNo",label:"Нет",notRequiredText:"",visible:!0,doNotSaveDraft:!0,doNotShowInPdf:!0}]}]},{className:"Panel",name:"PanelPostIndex",title:"",isGridItem:!0,visible:!1,gridWidth:"one-third",doNotSaveDraft:!0,items:[{className:"FieldText",name:"PostIndex",label:"Индекс",notRequiredText:"",visible:!0,required:!0,validators:[{mnemonic:"required"},factory.getFiasValidatorsByMnemonic("FiasPostIndex")],maxlength:6,doNotSaveDraft:!0,doNotShowInPdf:!0}]}]};return angular.copy(structure)}var factory={getStructure:getStructure,getFiasValidatorsByMnemonic:function(mnemonic){var result={mnemonic:mnemonic};switch(mnemonic){case"FiasString":result.regexp="(^([-А-Яа-яёЁ0-9,.();№'\\\\/\"\\s]+)$)|(^$)",result.message='Возможные значения: цифры, кириллица, знаки: точка, запятая, №, \\, /, -, (, ), ", ;.';break;case"FiasPostIndex":result.regexp="(^(\\d{6}$))|(^$)",result.message="Пожалуйста, введите 6 цифр.";break;default:result.regexp="",result.message=""}return result}};return factory}]),angular.module("serverFormWidgets.general").directive("epguFiasDaData",["pguFiasDaDataService","TEMPLATES","api","apiInner","$rootScope","$timeout","$q","Validators","PGU","TEMPLATES_PLAYER",function(pguFiasDaDataService,TEMPLATES,api,apiInner,$rootScope,$timeout,$q,Validators,PGU,TEMPLATES_PLAYER){var directive={replace:!0,scope:{item:"="},link:function(scope,element,attrs){function render(){var asyncDone;scope.model=pguFiasDaDataService.initFiasFields(scope.item.fullPath,scope.item.fieldsConfig),pguFiasDaDataService.addWidgetToReachGoalAnalyse(scope.item.fullPath),scope.model.popup={tpl:TEMPLATES_PLAYER.MODAL_FIAS_DADATA,userAddress:"",normalizeAddress:"",show:!1,isEditOpen:!1},scope.model.isFirstOpen=!1,scope.item.showPostIndex=!1,scope.item.maxDadataQcCompleteFromConfig=scope.model.maxDadataQcCompleteFromConfig,scope.item.dadataEvent={event:"",config:{}},scope.item.controlsObj=scope.model.controlsObj,scope.item.qcControls=scope.model.qcControls,scope.item.popupData=scope.model.popup,asyncDone=pguFiasDaDataService.initDraftSet(scope.item,scope.model),$rootScope.mainLoader.stackControlsWithAsyncData.push(asyncDone),asyncDone.then(function(initData){pguFiasDaDataService.setWatchers(scope),scope.$emit(scope.item.fullPath+":ScopeApplied",{scope:scope,element:element}),scope.item.isScopeAppliedDone={scope:scope,element:element},scope.item.disabled&&pguFiasDaDataService.toggleDisabled(scope.model,!0,scope.item.fullPath),scope.item.removeOpts&&scope.item.value&&PGU.Events.publish(scope.item.fullPath+".PanelControls.PanelDropdown.Dropdown:blur")},function(failed){})}if(!$rootScope.isDesigner){scope.model={},scope.saveAddress=function(){var dropdownApi=api.find(scope.item.fullPath).find("PanelControls.PanelDropdown.Dropdown");scope.model.popup.userAddress="",scope.model.popup.normalizeAddress="",scope.toggleModalVisible(!1),dropdownApi.element.toggleFiasFields(!1)},scope.editAddress=function(){var dropdownApi=api.find(scope.item.fullPath).find("PanelControls.PanelDropdown.Dropdown");pguFiasDaDataService.enableAllFields(scope.model),scope.model.popup.isEditOpen=!0,scope.model.popup.userAddress="",scope.model.popup.normalizeAddress="",scope.toggleModalVisible(!1),dropdownApi.element.toggleFiasFields(!0)},scope.toggleModalVisible=function(visible){visible||--$rootScope.env.dadataPopupCounter,scope.model.popup.show=visible,visible||api.scrollTo(scope.item.fullPath,"",-60)},scope.model.__tempCachedNormalized=null,scope.item.normalizeFromValidate=function(){scope.model.isFirstOpen=!0;var needStopValidate=pguFiasDaDataService.fetchFullFiasData(scope.item,scope.model,scope.item.__draftCachedNormalized,!1,!0);return scope.item.__draftCachedNormalized=null,needStopValidate},$rootScope.settings.initStrategy=$rootScope.settings.initStrategy||[],$rootScope.settings.initStrategy[scope.item.fullPath+".PanelControls.PanelDropdown.Dropdown"]={title:scope.item.value},scope.item.setValueToString=function(addressString,fiasCode,okatoCode){scope.model.isRestore=!0,scope.model.isSetFromHandler=!0,pguFiasDaDataService.setValueToString(scope.item,scope.model,addressString,fiasCode,okatoCode),scope.item.__draftCachedNormalized=null},scope.item.required&&api.find(scope.item.fullPath).setRequired(!0),scope.showFields=function(evt){var PanelControls=api.find(scope.item.fullPath).find("PanelControls");PanelControls.element.visible=!PanelControls.element.visible},$timeout(function(){$rootScope.$applyAsync(render)},0,!1),scope.item.setDraftFromEdit=function(){var defer=$q.defer();return pguFiasDaDataService.setDraftFromEdit(scope.item,scope.model,defer),defer.promise},scope.item.api=api,scope.$watch("item.disabled",function(val,oldVal){"undefined"!==val&&val!==oldVal&&pguFiasDaDataService.toggleDisabled(scope.model,val,scope.item.fullPath)}),scope.$watch("item.apartmentLabel",function(val,oldVal){val!==oldVal&&pguFiasDaDataService.setApartmentLabel(scope.model,val||"")});var watchers;scope.$on("suspend",function(){watchers=scope.$$watchers,scope.$$watchers=[]}),scope.$on("resume",function(){scope.$$watchers=watchers,watchers=null})}}};return $rootScope.isDesigner?directive.templateUrl="js/designer/overrideTmpl/FiasDaData/FiasDaData.html":directive.template='<div        ng-show="(!!item.visible)"        ng-class="{\'PGU-{{::item.className}}\': true,\'PGU-LabelWidth-{{::item.labelWidth}}\': true,\'PGU-Labelalign-{{::item.labelAlign}}\': true,\'PGU-Disabled\': item.disabled,\'PGU-Required\': item.required,\'PGU-Error\': item.error,\'PGU-FiasDaDataWrapper\': true,\'PGU-FiasDaData_mob-optimize\': $root.settings.mobOptimizeFiasDaData}"        id="{{::id}}"        full-path="{{::item.fullPath}}"        >    <label class="PGU-FieldLabel">{{item.longLabel || item.label}}</label>    <div class="PGU-KladrWrap PGU-FiasWrap PGU-FieldBody">        <div>            <div class="address-in-one"></div>        </div>        <div class="PGU-Fias-Fields-Container-V2 js-PGU-Fias-Fields-Container-V2">            <form-tree ng-repeat="item_i in item.items track by $index" item="item_i"></form-tree>        </div>        <div class="PGU-FieldHint" ng-if="item.hint">{{::item.hint}}</div>    </div>    <modal-dialog data-ng-if="model.popup.show" show="model.popup.show" hide-modal="toggleModalVisible(false)"><div ng-include src="model.popup.tpl" ng-if="model.popup.show"></div></modal-dialog></div>',directive}]).factory("FiasDaDataExt",["$rootScope","$timeout","fiasDaDataStructure","fieldAttrs","Validators","KladrExt","KLADR_CONDITIONS","KLADR_STRUCTURE","KLADR_LABELS","RKN_CONDITIONS","ADDRESS_RKN_CONDITIONS",function($rootScope,$timeout,fiasDaDataStructure,fieldAttrs,Validators,KladrExt,KLADR_CONDITIONS,KLADR_STRUCTURE,KLADR_LABELS,RKN_CONDITIONS,ADDRESS_RKN_CONDITIONS){return{isFiasDaData:!0,attrs:angular.extend({},fieldAttrs.attrs,KladrExt.attrs,{longLabel:{type:"string",default:""},dictionaryOnly:{"scope:editor":!1,"scope:noChanges":!0},validators:{"scope:editor":!1,"scope:noChanges":!0},value:{"scope:editor":!1,"scope:sync":!0,type:"string",default:""},strategy:{type:"string",default:"",enum:window.Editor&&[""].concat(Editor.strategyKeys),enumOptions:window.Editor&&$.extend({"":""},Editor.strategyHash),"scope:noChanges":!0},readonly:{"scope:editor":!1,"scope:noChanges":!0},post_index:{type:"string",default:"","scope:sync":!0,"scope:editor":!1},region:{type:"string",default:"","scope:sync":!0,"scope:editor":!1},regionFias:{type:"string",default:"","scope:editor":!1,"scope:sync":!0,"scope:noChanges":!0},regionKladr:{type:"string",default:"","scope:editor":!1,"scope:sync":!0},regionType:{type:"string",default:"","scope:editor":!1,"scope:sync":!0,"scope:noChanges":!0},regionShortType:{type:"string",default:"","scope:editor":!1,"scope:sync":!0,"scope:noChanges":!0},area:{type:"string",default:"","scope:sync":!0,"scope:editor":!1},areaType:{type:"string",default:"","scope:sync":!0,"scope:editor":!1,"scope:noChanges":!0},areaShortType:{type:"string",default:"","scope:sync":!0,"scope:editor":!1,"scope:noChanges":!0},areaFias:{type:"string",default:"","scope:editor":!1,"scope:sync":!0,"scope:noChanges":!0},areaKladr:{type:"string",default:"","scope:editor":!1,"scope:sync":!0,"scope:noChanges":!0},city:{type:"string",default:"","scope:sync":!0,"scope:editor":!1},cityType:{type:"string",default:"","scope:sync":!0,"scope:editor":!1,"scope:noChanges":!0},cityShortType:{type:"string",default:"","scope:sync":!0,"scope:editor":!1,"scope:noChanges":!0},cityFias:{type:"string",default:"","scope:editor":!1,"scope:sync":!0,"scope:noChanges":!0},cityKladr:{type:"string",default:"","scope:editor":!1,"scope:sync":!0,"scope:noChanges":!0},cityArea:{type:"string",default:"","scope:sync":!0,"scope:editor":!1},cityAreaType:{type:"string",default:"","scope:sync":!0,"scope:editor":!1,"scope:noChanges":!0},cityAreaShortType:{type:"string",default:"","scope:sync":!0,"scope:editor":!1,"scope:noChanges":!0},cityAreaFias:{type:"string",default:"","scope:editor":!1,"scope:sync":!0,"scope:noChanges":!0},cityAreaKladr:{type:"string",default:"","scope:editor":!1,"scope:sync":!0,"scope:noChanges":!0},place:{type:"string",default:"","scope:sync":!0,"scope:editor":!1},placeType:{type:"string",default:"","scope:sync":!0,"scope:editor":!1,"scope:noChanges":!0},placeShortType:{type:"string",default:"","scope:sync":!0,"scope:editor":!1,"scope:noChanges":!0},placeFias:{type:"string",default:"","scope:editor":!1,"scope:sync":!0,"scope:noChanges":!0},placeKladr:{type:"string",default:"","scope:editor":!1,"scope:sync":!0,"scope:noChanges":!0},street:{type:"string",default:"","scope:sync":!0,"scope:editor":!1},streetType:{type:"string",default:"","scope:sync":!0,"scope:editor":!1,"scope:noChanges":!0},streetShortType:{type:"string",default:"","scope:sync":!0,"scope:editor":!1,"scope:noChanges":!0},streetFias:{type:"string",default:"","scope:editor":!1,"scope:sync":!0,"scope:noChanges":!0},streetKladr:{type:"string",default:"","scope:editor":!1,"scope:sync":!0,"scope:noChanges":!0},additionalArea:{type:"string",default:"","scope:sync":!0,"scope:editor":!1},additionalAreaType:{type:"string",default:"","scope:sync":!0,"scope:editor":!1,"scope:noChanges":!0},additionalAreaShortType:{type:"string",default:"","scope:sync":!0,"scope:editor":!1,"scope:noChanges":!0},additionalAreaFias:{type:"string",default:"","scope:editor":!1,"scope:sync":!0,"scope:noChanges":!0},additionalAreaKladr:{type:"string",default:"","scope:editor":!1,"scope:sync":!0,"scope:noChanges":!0},additionalStreet:{type:"string",default:"","scope:sync":!0,"scope:editor":!1},additionalStreetType:{type:"string",default:"","scope:sync":!0,"scope:editor":!1,"scope:noChanges":!0},additionalStreetShortType:{type:"string",default:"","scope:sync":!0,"scope:editor":!1,"scope:noChanges":!0},additionalStreetFias:{type:"string",default:"","scope:editor":!1,"scope:sync":!0,"scope:noChanges":!0},additionalStreetKladr:{type:"string",default:"","scope:editor":!1,"scope:sync":!0,"scope:noChanges":!0},house:{type:"string",default:"","scope:sync":!0,"scope:editor":!1},houseType:{type:"string",default:"","scope:sync":!0,"scope:editor":!1,"scope:noChanges":!0},houseShortType:{type:"string",default:"","scope:sync":!0,"scope:editor":!1,"scope:noChanges":!0},houseFias:{type:"string",default:"","scope:editor":!1,"scope:sync":!0,"scope:noChanges":!0},houseKladr:{type:"string",default:"","scope:editor":!1,"scope:sync":!0,"scope:noChanges":!0},building1:{type:"string",default:"","scope:sync":!0,"scope:editor":!1},building1Type:{type:"string",default:"","scope:sync":!0,"scope:editor":!1,"scope:noChanges":!0},building1ShortType:{type:"string",default:"","scope:sync":!0,"scope:editor":!1,"scope:noChanges":!0},building2:{type:"string",default:"","scope:sync":!0,"scope:editor":!1},building2Type:{type:"string",default:"","scope:sync":!0,"scope:editor":!1,"scope:noChanges":!0},building2ShortType:{type:"string",default:"","scope:sync":!0,"scope:editor":!1,"scope:noChanges":!0},apartment:{type:"string",default:"","scope:sync":!0,"scope:editor":!1},fias_full_code:{type:"string",default:"","scope:sync":!0,"scope:editor":!1},numericFiasCode:{type:"string",default:"","scope:sync":!1,"scope:editor":!1,"scope:noChanges":!0},kladrCode:{type:"string",default:"","scope:sync":!0,"scope:editor":!1},cityDisabled:{type:"string",default:"no","scope:sync":!0,"scope:editor":!1,"scope:noChanges":!0},houseDisabled:{type:"string",default:"no","scope:sync":!0,"scope:editor":!1},apartmentDisabled:{type:"string",default:"no","scope:sync":!0,"scope:editor":!1},removeOpts:{type:"string",default:"","scope:editor":$rootScope.isAdminUser,"scope:noChanges":!0},fullCodes:{type:"boolean",enum:[!0,!1],enumOptions:{true:"Да",false:"Нет"},default:!0,"scope:editor":!1,"scope:noChanges":!0},elmCode:{type:"string",default:"","scope:editor":!1,"scope:sync":!0},oktmoCode:{type:"string",default:"","scope:editor":!1,"scope:sync":!0,"scope:noChanges":!0},withoutFiasCode:{type:"boolean",enum:[!0,!1],enumOptions:{true:"Да",false:"Нет"},default:!1,"scope:editor":!1,"scope:sync":!1,"scope:noChanges":!0},fiasDone:{type:"string",default:"","scope:editor":!1,"scope:sync":!0},pageNum:{"scope:sync":!1,"scope:editor":!1,"scope:noChanges":!0},apartmentLabel:{type:"string",default:"","scope:ruleEditor":!0,"scope:editor":!$rootScope.isAdminUser,"scope:noChanges":!0},allowOptionalBuilding1:{type:"boolean","scope:editor":$rootScope.isAdminUser,enum:[!1,!0],enumOptions:{false:"Обязательный",true:"Необязательный"},"scope:sync":!1,default:!0,"scope:noChanges":!0}}),fillItems:function(item){var element=this.element,settings=this.getSettingsByClassName(element.className),customLabels={};element.apartmentLabel&&(customLabels.apartment=element.apartmentLabel),element.allowEditlabels&&(customLabels=element.allowEditlabels);var structureV2=fiasDaDataStructure.getStructureV2(element.removeOpts,customLabels),structure=structureV2.structure;return element.fieldsConfig=structureV2.fieldsConfig,element.removeOpts&&fiasDaDataStructure.removedItems.length&&(element.removedItems=[],fiasDaDataStructure.removedItems.forEach(function(itemName){element.attrs.hasOwnProperty(itemName)&&element.removedItems.push(itemName)})),this.fillFullPath(structure,this.element.fullPath,settings,this.element.removeOpts)},fillFullPath:function(structure,parentPath,settings){var fieldName=structure.name.toLowerCase();if(settings&&settings[fieldName])for(var j in settings[fieldName])settings[fieldName].hasOwnProperty(j)&&("mnemonic"===j?structure.validators=[fiasDaDataStructure.getFiasValidatorsByMnemonic(settings[fieldName][j])]:structure[j]=settings[fieldName][j]);if(structure.fullPath=parentPath+"."+structure.name,structure.originalFullPath=parentPath+"."+structure.name,structure.items&&structure.items.length)for(var i=0;i<structure.items.length;i++)structure.items[i]=this.fillFullPath(structure.items[i],structure.fullPath,settings);return structure},getSettingsByClassName:function(className){var isRKN,settings,kladrRKN=["KladrAddressRKN","KladrNaturalPersonRKN","KladrJuridicalPersonRKN"];return-1!==kladrRKN.indexOf(className)&&(isRKN=!0),"Kladr"===className?settings=KLADR_CONDITIONS:isRKN&&(settings=RKN_CONDITIONS),settings},validate:function(lazy,fromSrv,validateForSubmit){var noPreventSubmit=!0,disabled=this.disabled();lazy||!this.inheritedVisibility()||this.element.isFirstOpen||!this.element.__draftCachedNormalized||disabled||(noPreventSubmit=this.element.normalizeFromValidate());var control,fieldDaDataQcComplete,self=this,requiredMsg="Поле обязательно для заполнения",controlsObj=this.attr("controlsObj"),qcControls=this.attr("qcControls"),popupData=this.attr("popupData"),dd=self.find("PanelControls.PanelDropdown.Dropdown"),valid=!0,validFields=!0,isValidPostIndex=(this.element.post_index,!0),flat=this.element.apartment||(qcControls&&qcControls.apartment&&qcControls.apartment.checkbox?"function"==typeof qcControls.apartment.checkbox.checked&&qcControls.apartment.checkbox.checked():""),city=this.element.city,place=this.element.place,isStreetValid=!0,isBuilding1InValidate=!0,isHouseValid=!0,isFlatValid=!0,daDataQcComplete=dd.element.dadataQcComplete,style='style="color: #D0021B"',daDataErrorMsg="",controlObjName="",isElValid=!0,withoutFiasCode=this.element.withoutFiasCode,removeOpts=(this.element.removeOpts||"").split(",");if(this.error(!1),disabled||!this.visible()||!this.inheritedVisibility()){var disableValid=!!this.value();return!(this.required()&&!lazy&&disabled&&!disableValid&&this.inheritedVisibility())||(qcControls.labelError.panel.visible(!0),qcControls.labelError.el.text("<span "+style+">"+requiredMsg+"</span>"),dd.error(requiredMsg),this.find("PanelControls.PanelQCFields").visible(!0),!1)}for(var c in controlsObj)controlsObj.hasOwnProperty(c)&&(isElValid=controlsObj[c].el.validate(lazy),self.fullPath(),"post_index"===c?isValidPostIndex=isElValid:"building1"===c?isBuilding1InValidate=isElValid:"city"===c?isStreetValid=isElValid:"house"!==c||lazy||fromSrv?"apartment"!==c||lazy||fromSrv||(isFlatValid=isElValid):isHouseValid=isElValid,isElValid||fieldDaDataQcComplete||(fieldDaDataQcComplete=controlsObj[c].daDataQcComplete),validFields=isElValid&&validFields);isBuilding1InValidate=!!fromSrv||isBuilding1InValidate;var house=this.element.house||(controlsObj?qcControls.house&&qcControls.house.checkbox&&"function"==typeof qcControls.house.checkbox.checked&&qcControls.house.checkbox.checked()&&isBuilding1InValidate:"");if(!lazy)if(validFields||fromSrv||dd.element.fiasFieldsShow||dd.element.toggleFiasFields(),dd.element.fiasFieldsShow&&(validFields?daDataQcComplete="0":fieldDaDataQcComplete&&"7"!==daDataQcComplete&&(daDataQcComplete=fieldDaDataQcComplete),dd.element.dadataQcComplete=daDataQcComplete),(city||place)&&"2"===daDataQcComplete&&(daDataQcComplete=isStreetValid?"4":"3"),validFields&&this.element.maxDadataQcCompleteFromConfig&&("0"===daDataQcComplete||daDataQcComplete>this.element.maxDadataQcCompleteFromConfig)&&(daDataQcComplete="0",flat=!0),daDataQcComplete)switch(daDataQcComplete){case"0":flat||(daDataErrorMsg="Укажите квартиру/помещение",controlObjName="apartment",daDataQcComplete="5");break;case"1":daDataErrorMsg="Укажите регион",controlsObj.region&&controlsObj.region.panel.visible(!0),dd.element.fiasFieldsShow&&!self.element.isToggleAll||controlsObj.region&&controlsObj.region.el.value(dd.element.filter);break;case"2":daDataErrorMsg="Укажите город или населенный пункт";break;case"3":daDataErrorMsg="Укажите улицу";break;case"4":house&&isHouseValid?flat?daDataQcComplete="0":(daDataErrorMsg="Укажите квартиру/помещение",controlObjName="apartment"):(daDataErrorMsg="Укажите дом",controlObjName="house");break;case"5":removeOpts.includes("14")||flat&&isFlatValid?daDataQcComplete="0":(daDataErrorMsg="Укажите квартиру/помещение",controlObjName="apartment");break;case"6":daDataErrorMsg="Проверьте правильность адреса";break;case"7":withoutFiasCode?(style='style="color: #7f7f7f"',daDataErrorMsg="Невозможно проверить адрес, будьте внимательны при вводе"):daDataErrorMsg="Укажите адрес на территории РФ, использование иностранного адреса недопустимо";break;case"10":removeOpts.includes("14")||flat&&isFlatValid?daDataQcComplete="0":(daDataErrorMsg="Укажите квартиру/помещение",controlObjName="apartment");break;case"100":isValidPostIndex?daDataQcComplete="0":daDataErrorMsg="Укажите индекс"}else dd.element.filter&&controlsObj.region.el.value(dd.element.filter);validFields?self.required()?self.withoutFiasCode()?self.value()&&!lazy&&(daDataErrorMsg=requiredMsg,self.error(requiredMsg),valid=!1):(self.value()||self.attr("fias_full_code")||lazy||(self.error(requiredMsg),daDataErrorMsg=requiredMsg,valid=!1),self.value()&&!self.attr("fias_full_code")&&(self.error(""),"7"!==daDataQcComplete&&(daDataQcComplete="6",daDataErrorMsg="Проверьте правильность адреса"),valid=!1)):self.value()?self.attr("fias_full_code")||self.attr("withoutFiasCode")||(daDataErrorMsg="Укажите регион",self.error(""),valid=!1):dd.element.filter&&dd.element.filter.length&&dd.element.filter.length>=3?(self.error(""),daDataErrorMsg="Невозможно проверить адрес, будьте внимательны при вводе",valid=!1):(valid=!0,daDataQcComplete="0",daDataErrorMsg="error"):(self.error(!1),!self.fias_full_code()&&self.element.isToggleAll&&dd.element.filter&&(controlsObj.region&&controlsObj.region.el.value(dd.element.filter),controlObjName=""),!daDataQcComplete&&dd.element.filter&&(daDataErrorMsg="Укажите регион"),valid=!1),lazy||(valid="0"===daDataQcComplete);for(var k in qcControls)qcControls.hasOwnProperty(k)&&(control=qcControls[k],lazy||control.panel&&control.panel.visible&&control.panel.visible(!1),k!==controlObjName||controlsObj[k].checkbox.element.checked?"post_index"!==k||daDataErrorMsg&&"100"!==daDataQcComplete||(lazy||(valid=isValidPostIndex,daDataErrorMsg=isValidPostIndex?"":"Укажите индекс",control.panel&&control.panel.visible&&control.panel.visible(this.element.showPostIndex&&!dd.element.fiasFieldsShow)),control.el.element._changedByUser=!0,control.el&&control.el.validate(lazy),control.el.error(control.el.error())):control.panel&&control.panel.visible&&control.panel.visible(!dd.element.fiasFieldsShow));if(!lazy){if(!1===noPreventSubmit&&(valid=noPreventSubmit),dd.element.fiasFieldsShow){var isFederalObject,handleField=function(key,funcKey,arg){if(controlsObj[key])return controlsObj[key].el[funcKey](arg)},cityValue=handleField("city","value"),areaValue=handleField("area","value"),placeValue=handleField("place","value"),regionValue=handleField("region","value"),withStreet=!!controlsObj.street,streetValue=handleField("street","value");if(regionValue){isFederalObject=["0c5b2444-70a0-4932-980c-b4dc0d3f02b5","c2deb16a-0330-4f05-821f-1d09c93331e6","63ed1a35-4be6-4564-a1ec-0c51f7383314","6fdecb78-893a-4e3f-a5ba-aa062459463b"].includes(controlsObj.region.data.fiasCode)}else handleField("region","required",!0),$timeout(function(){handleField("region","validate")}),valid=!1;handleField("city","required",!1),handleField("area","required",!1),controlsObj.city&&controlsObj.city.checkbox.checked()?areaValue||(handleField("area","setRequired",!0),$timeout(function(){handleField("area","validate")}),valid=!1):isFederalObject||cityValue||areaValue||(handleField("city","setRequired",!0),handleField("area","setRequired",!0),$timeout(function(){handleField("city","validate"),handleField("area","validate")}),valid=!1),handleField("street","required",!1),handleField("place","required",!1),!withStreet||streetValue||placeValue||(handleField("street","required",!0),handleField("place","required",!0),$timeout(function(){handleField("street","validate"),handleField("place","validate")}),valid=!1)}popupData.show&&(valid=!1),dd.error(valid?!valid:" "),daDataErrorMsg=valid?"":daDataErrorMsg,qcControls.labelError.panel.visible(!0),qcControls.labelError.el.text("<span "+style+">"+daDataErrorMsg+"</span>"),this.find("PanelControls.PanelQCFields").visible(!dd.element.fiasFieldsShow||!valid&&validFields),this.element.api.applyScope()}return!self.__setFirstFieldError||valid||lazy||(self.__setFirstFieldError=!1,self.scrollToError(self)),!this.element.api||this.element.api.__setFirstFieldError||lazy||valid||(this.element.api.__setFirstFieldError=this.element.fullPath),valid}}}]).factory("fiasDaDataStructure",["$rootScope",function($rootScope){function getStructure(){var structure={className:"Panel",name:"PanelControls",title:"",isGrid:!0,doNotSave:!0,doNotSaveDraft:!0,syncRender:!0,visible:!0,items:[{className:"Panel",name:"PanelDropdown",title:"",isGridItem:!0,doNotSaveDraft:!0,syncRender:!0,items:[{className:"FieldDropdown",name:"Dropdown",label:"Укажите адрес полностью",selectType:"DropdownForFiasDaData",hasContextSearch:!0,notRequiredText:"",
doNotSaveDraft:!0,syncRender:!0,doNotShowInPdf:!0}]},{className:"Panel",name:"PanelQCFields",title:"",doNotSave:!0,doNotSaveDraft:!0,syncRender:!0,validateAlways:!0,visible:!1,items:[{className:"Panel",name:"PanelQCFieldsControls",title:"",isGridItem:!0,visible:!0,doNotSaveDraft:!0,syncRender:!0,items:[{className:"Panel",name:"PanelLabel",title:"",isGridItem:!1,visible:!1,inlineCSS:"margin-top: -10px;",gridWidth:"three-quarters",doNotSaveDraft:!0,syncRender:!0,items:[{className:"Label",name:"LabelError",visible:!0,inlineCSS:"margin: 0; font-size: 12px;",doNotSaveDraft:!0,syncRender:!0}]},{className:"Panel",name:"PanelHouse",title:"",isGridItem:!1,inlineCSS:"margin-top: -20px",gridWidth:"one-third",visible:!1,doNotSaveDraft:!0,syncRender:!0,items:[{className:"FieldCheckbox",name:"HouseNo",label:"Нет дома",notRequiredText:"",visible:!0,doNotSaveDraft:!0,syncRender:!0}]},{className:"Panel",name:"PanelApartment",title:"",isGridItem:!1,inlineCSS:"margin-top: -20px",gridWidth:"one-third",visible:!1,doNotSaveDraft:!0,syncRender:!0,items:[{className:"FieldCheckbox",name:"ApartmentNo",label:"Нет квартиры",notRequiredText:"",visible:!0,doNotSaveDraft:!0,syncRender:!0}]}]},{className:"Panel",name:"PanelPostIndex",title:"",isGridItem:!0,visible:!1,gridWidth:"one-third",doNotSaveDraft:!0,syncRender:!0,items:[{className:"FieldText",name:"PostIndex",label:"Индекс",notRequiredText:"",visible:!0,required:!0,validators:[{mnemonic:"required"},factory.getFiasValidatorsByMnemonic("FiasPostIndex")],maxlength:6,doNotSaveDraft:!0,syncRender:!0}]}]},{className:"Panel",name:"PanelHandFields",title:"",doNotSave:!0,doNotSaveDraft:!0,syncRender:!0,visible:!1,validateAlways:!0,items:[{className:"Panel",name:"PanelFullAddress",title:"",isGridItem:!0,visible:!0,doNotSaveDraft:!0,syncRender:!0,items:[{className:"FieldText",name:"FullAddress",label:"Полный адрес",notRequiredText:"",disabled:!0,visible:!0,doNotSaveDraft:!0,syncRender:!0}]},{className:"Panel",name:"PanelRegion",title:"",isGridItem:!0,visible:!1,doNotSaveDraft:!0,syncRender:!0,items:[{className:"FieldText",name:"Region",label:"Регион",notRequiredText:"",visible:!0,validators:[factory.getFiasValidatorsByMnemonic("FiasString")],maxlength:50,doNotSaveDraft:!0,syncRender:!0}]},{className:"Panel",name:"PanelArea",title:"",isGridItem:!0,visible:!1,gridWidth:"one-half",doNotSaveDraft:!0,syncRender:!0,items:[{className:"FieldText",name:"Area",label:"Район",notRequiredText:"",visible:!0,validators:[factory.getFiasValidatorsByMnemonic("FiasString")],maxlength:100,doNotSaveDraft:!0,syncRender:!0}]},{className:"Panel",name:"PanelCity",title:"",isGridItem:!0,visible:!1,gridWidth:"one-half",doNotSaveDraft:!0,syncRender:!0,items:[{className:"FieldText",name:"City",label:"Город",notRequiredText:"",visible:!0,validators:[factory.getFiasValidatorsByMnemonic("FiasString")],maxlength:150,doNotSaveDraft:!0,syncRender:!0},{className:"FieldCheckbox",name:"CityNo",label:"Нет",notRequiredText:"",visible:!0,doNotSaveDraft:!0,syncRender:!0}]},{className:"Panel",name:"PanelCityArea",title:"",isGridItem:!0,visible:!1,gridWidth:"one-half",doNotSaveDraft:!0,syncRender:!0,items:[{className:"FieldText",name:"CityArea",label:"Внутригородской район",notRequiredText:"",visible:!0,validators:[factory.getFiasValidatorsByMnemonic("FiasString")],maxlength:150,doNotSaveDraft:!0,syncRender:!0}]},{className:"Panel",name:"PanelPlace",title:"",isGridItem:!0,visible:!1,gridWidth:"one-half",doNotSaveDraft:!0,syncRender:!0,items:[{className:"FieldText",name:"Place",label:"Населенный пункт",notRequiredText:"",visible:!0,validators:[factory.getFiasValidatorsByMnemonic("FiasExtendedString")],maxlength:150,doNotSaveDraft:!0,syncRender:!0}]},{className:"Panel",name:"PanelStreet",title:"",isGridItem:!0,visible:!1,gridWidth:"one-half",doNotSaveDraft:!0,syncRender:!0,items:[{className:"FieldText",name:"Street",label:"Улица",notRequiredText:"",visible:!0,validators:[factory.getFiasValidatorsByMnemonic("FiasExtendedString")],maxlength:100,doNotSaveDraft:!0,syncRender:!0}]},{className:"Panel",name:"PanelOtherInfo",title:"",isGridItem:!0,visible:!1,gridWidth:"one-half",doNotSaveDraft:!0,syncRender:!0,items:[{className:"FieldText",name:"OtherInfo",label:"Иные реквизиты адреса",hint:"Доступно для заполнения при незаполненном поле «Дом»",notRequiredText:"",visible:!1,validators:[factory.getFiasValidatorsByMnemonic("FiasString")],doNotSaveDraft:!0,syncRender:!0}]},{className:"Panel",name:"PanelHBBA",title:"",isGrid:!0,doNotSaveDraft:!0,syncRender:!0,items:[{className:"Panel",name:"PanelHBBAWrap",title:"",isGridItem:!0,gridWidth:"one-whole",doNotSaveDraft:!0,syncRender:!0,items:[{className:"Panel",name:"PanelHouse",title:"",isGridItem:!0,visible:!1,gridWidth:"one-sixth",doNotSaveDraft:!0,syncRender:!0,items:[{className:"FieldText",name:"House",label:"Дом",notRequiredText:"",visible:!0,required:!0,validators:[{mnemonic:"required"},factory.getFiasValidatorsByMnemonic("FiasString")],maxlength:20,doNotSaveDraft:!0,syncRender:!0},{className:"FieldCheckbox",name:"HouseNo",label:"Нет дома",notRequiredText:"",visible:!0,doNotSaveDraft:!0,syncRender:!0}]},{className:"Panel",name:"PanelBuilding1",title:"",isGridItem:!0,visible:!1,gridWidth:"one-sixth",doNotSaveDraft:!0,syncRender:!0,items:[{className:"FieldText",name:"Building1",label:"Корпус",notRequiredText:"",visible:!0,validators:[factory.getFiasValidatorsByMnemonic("FiasString")],maxlength:10,doNotSaveDraft:!0,syncRender:!0}]},{className:"Panel",name:"PanelBuilding2",title:"",isGridItem:!0,visible:!1,gridWidth:"one-sixth",doNotSaveDraft:!0,syncRender:!0,items:[{className:"FieldText",name:"Building2",label:"Строение",notRequiredText:"",visible:!0,validators:[factory.getFiasValidatorsByMnemonic("FiasString")],maxlength:10,doNotSaveDraft:!0,syncRender:!0}]},{className:"Panel",name:"PanelApartment",title:"",isGridItem:!0,visible:!1,gridWidth:"one-sixth",doNotSaveDraft:!0,syncRender:!0,items:[{className:"FieldText",name:"Apartment",label:"Кв.",notRequiredText:"",visible:!0,required:!0,validators:[{mnemonic:"required"},factory.getFiasValidatorsByMnemonic("FiasString")],maxlength:50,doNotSaveDraft:!0,syncRender:!0},{className:"FieldCheckbox",name:"ApartmentNo",label:"Нет квартиры",notRequiredText:"",visible:!0,doNotSaveDraft:!0,syncRender:!0}]}]}]},{className:"Panel",name:"PanelPostIndex",title:"",isGridItem:!0,visible:!1,gridWidth:"one-third",doNotSaveDraft:!0,syncRender:!0,items:[{className:"FieldText",name:"PostIndex",label:"Индекс",notRequiredText:"",visible:!0,required:!0,validators:[{mnemonic:"required"},factory.getFiasValidatorsByMnemonic("FiasPostIndex")],maxlength:6,doNotSaveDraft:!0,syncRender:!0}]}]}]};return JSON.parse(JSON.stringify(structure))}var factory={getStructure:getStructure,getFiasValidatorsByMnemonic:function(mnemonic){var result={mnemonic:mnemonic};switch(mnemonic){case"FiasString":case"kladrInputRkn":case"kladrInput":result.regexp="(^([-А-Яа-яёЁ0-9,.();№N'_+<>\\\\/\"\\s]+)$)|(^$)",result.message='Возможные значения: цифры, кириллица, точки, запятые, №, N, \\, /, -, (, ), ", ;, _, +, <, >';break;case"FiasPostIndex":result.regexp="(^(\\d{6}$))|(^$)",result.message="Пожалуйста, введите 6 цифр.";break;case"kladrHouse":result.regexp="(^([0-9])([-А-Яа-яёЁ0-9,.№\\\\/\\s]*)$)|(^$)",result.message="Возможные значения: цифры, кириллица, знаки ., №,\\,/, - . Первый знак обязательно цифра";break;case"FiasExtendedString":result.regexp="(^([-А-Яа-яёЁ0-9,.();№N'_+<>iIxXvV\\\\/\"\\s]+)$)|(^$)",result.message='Возможные значения: цифры, кириллица, точки, запятые, №, N, \\, /, -, (, ), ", ;, _, +, <, >, i, I, v, V, x, X';break;default:result.regexp="",result.message=""}return result},upperCaseFirst:function(str){return str.charAt(0).toUpperCase()+str.substring(1)},getFiasModels:function(){return[{level:1,daDataQcComplete:"1",levelName:"region",label:"Регион",shortType:"обл",longAbbr:"область",supportCheck:!1,checked:!1,validator:"",validators:[{mnemonic:"FiasString"}],maxlength:50},{level:3,daDataQcComplete:"2",levelName:"area",label:"Район",shortType:"р-н",longAbbr:"район",supportCheck:!1,checked:!1,validators:[{mnemonic:"FiasString"}],maxlength:100},{level:4,daDataQcComplete:"2",levelName:"city",label:"Город",checkboxLabel:"Нет города",abbr:"г",longAbbr:"город",supportCheck:!0,checked:!1,gridWidth:"one-half",validators:[{mnemonic:"FiasString"}],maxlength:150},{level:5,daDataQcComplete:"2",levelName:"cityArea",label:"Внутригородской район",abbr:"окр",longAbbr:"округ",supportCheck:!1,subscribe:["city"],checked:!1,validators:[{mnemonic:"FiasString"}],maxlength:150},{level:6,daDataQcComplete:"2",levelName:"place",label:"Населенный пункт",abbr:"п",longAbbr:"п.",supportCheck:!1,checked:!1,subscribe:["city"],validators:[{mnemonic:"FiasString"}],maxlength:150},{level:7,daDataQcComplete:"3",levelName:"street",label:"Улица",abbr:"ул",longAbbr:"улица",supportCheck:!1,checked:!1,validators:[{mnemonic:"FiasString"}],maxlength:100},{level:11,daDataQcComplete:"4",levelName:"house",label:"Дом",abbr:"д",supportCheck:!0,checkboxLabel:"Нет дома",checked:!1,required:!0,validators:[{mnemonic:"FiasString"},{mnemonic:"required"}],maxlength:20},{level:12,daDataQcComplete:"4",levelName:"building1",label:"Корпус",abbr:"корп",supportCheck:!1,subscribe:["house"],gridWidth:"one-sixth",checked:!1,validators:[{mnemonic:"FiasString"}],maxlength:10},{level:13,daDataQcComplete:"4",levelName:"building2",label:"Строение",abbr:"стр",gridWidth:"one-sixth",supportCheck:!1,checked:!1,validators:[{mnemonic:"FiasString"}],maxlength:10},{level:14,daDataQcComplete:"5",levelName:"apartment",label:"Кв.",abbr:"кв",notUseShortType:!0,supportCheck:!0,checked:!1,checkboxLabel:"Нет квартиры",required:!0,validators:[{mnemonic:"FiasString"},{mnemonic:"required"}],maxlength:50},{level:100,daDataQcComplete:"100",levelName:"post_index",customName:"postIndex",label:"Индекс",notUseShortType:!0,abbr:"",supportCheck:!1,checked:!1,required:!0,validator:"FiasPostIndex",validators:[{mnemonic:"FiasPostIndex"},{mnemonic:"required"}],maxlength:6}]},getPanelsStructure:function(removeOpts,customLabels){var self=this,fieldsConfig=this.getFiasFieldsConfig(removeOpts,customLabels),qcFieldLevels=[11,14,100],panelHBBAWrapLevels=[11,12,13,14],panelQCControlsCSS=(factory.getFiasValidatorsByMnemonic("FiasString"),"mob"==$rootScope.version?"margin-top: 10px;":"margin-top: -10px;"),panelQCControls={className:"Panel",name:"PanelQCFieldsControls",customClassName:"PanelQCFieldsControls",title:"",isGridItem:!0,visible:!0,doNotSaveDraft:!0,syncRender:!0,items:[{className:"Panel",name:"PanelLabel",title:"",isGridItem:!1,visible:!1,customClassName:"PGU-FiasDaData-PanelLabelError",inlineCSS:panelQCControlsCSS,gridWidth:"three-quarters",doNotSaveDraft:!0,syncRender:!0,items:[{className:"Label",name:"LabelError",visible:!0,inlineCSS:"margin: 0; font-size: 12px;",doNotSaveDraft:!0,syncRender:!0}]}]},panelHBBA={className:"Panel",name:"PanelHBBA",title:"",isGrid:!0,doNotSaveDraft:!0,syncRender:!0,items:[{className:"Panel",name:"PanelHBBAWrap",title:"",isGridItem:!0,gridWidth:"one-whole",doNotSaveDraft:!0,syncRender:!0,items:[]}]},panelQCControlsInStructure=!1,isHBBAInStructure=!1,result={PanelQCFields:[],PanelHandFields:[],fieldsConfig:fieldsConfig};return _.each(fieldsConfig,function(field){panelQCControlsInStructure||(result.PanelQCFields.push(panelQCControls),panelQCControlsInStructure=!0),qcFieldLevels.indexOf(field.level)>-1&&(100===field.level?result.PanelQCFields.push(self.getFiasTextField(field)):panelQCControls.items[0].items.push(self.getFiasCheckbox(field))),panelHBBAWrapLevels.indexOf(field.level)>-1?(isHBBAInStructure||(result.PanelHandFields.push(panelHBBA),isHBBAInStructure=!0),11===field.level||14===field.level?panelHBBA.items[0].items.push(self.getFiasTextFieldWithCheckbox(field)):panelHBBA.items[0].items.push(self.getFiasTextField(field,field.gridWidth,!1))):4===field.level?result.PanelHandFields.push(self.getFiasTextFieldWithCheckbox(field,field.gridWidth)):6===field.level||7===field.level?result.PanelHandFields.push(self.getFiasTextField(field,field.gridWidth,!0)):result.PanelHandFields.push(self.getFiasTextField(field,field.gridWidth,!1))}),result},extendItemConfig:function(item,customLabel){var upperCaseFirstName=this.upperCaseFirst(item.customName?item.customName:item.levelName),panelPath="Panel"+upperCaseFirstName;return item.name=upperCaseFirstName,item.panelPath=panelPath,item.elPath=panelPath+"."+upperCaseFirstName,item.label=customLabel||item.label,item.checkboxLabel&&(customLabel&&(item.checkboxLabel="Нет"),item.checkboxName=upperCaseFirstName+"No",item.checkboxPath=panelPath+"."+upperCaseFirstName+"No"),item},getFiasFieldsConfig:function(removeOpts,customLabels){var removeFilter=removeOpts&&removeOpts.split(","),fiasModels=this.getFiasModels(),self=this;return self.removedItems=[],removeOpts?_.filter(fiasModels,function(item,ind){var remove=!1;return _.each(removeFilter,function(filter,fIndex){(item.level===+filter||9===item.level&&90==+filter)&&(remove=!0)}),remove?self.removedItems.push(item.levelName):self.extendItemConfig(item,customLabels[item.levelName]),!remove}):(_.each(fiasModels,function(item){self.extendItemConfig(item,customLabels[item.levelName])}),fiasModels)},getFiasTextField:function(field,gridWidth,isValidatorExtended){return{className:"Panel",name:field.panelPath,title:"",isGridItem:!0,visible:!1,gridWidth:gridWidth||"one-half",doNotSaveDraft:!0,syncRender:!0,items:[{className:"FieldText",name:field.name,label:field.label,notRequiredText:"",visible:!0,required:field.required||!1,maxlength:field.maxlength,validators:[factory.getFiasValidatorsByMnemonic(isValidatorExtended?"FiasExtendedString":field.validator||"FiasString")],doNotSaveDraft:!0,syncRender:!0}]}},getFiasCheckbox:function(field){return{className:"Panel",name:field.panelPath,title:"",isGridItem:!1,inlineCSS:"margin-top: -20px",gridWidth:"one-third",visible:!1,doNotSaveDraft:!0,syncRender:!0,items:[{className:"FieldCheckbox",name:field.checkboxName,label:field.checkboxLabel,notRequiredText:"",visible:!0,doNotSaveDraft:!0,syncRender:!0}]}},getFiasTextFieldWithCheckbox:function(field,gridWidth){return{className:"Panel",name:field.panelPath,title:"",isGridItem:!0,visible:!1,gridWidth:gridWidth||"one-sixth",doNotSaveDraft:!0,syncRender:!0,items:[{className:"FieldText",name:field.name,label:field.label,notRequiredText:"",visible:!0,required:field.required||!1,validators:[field.required?{mnemonic:"required"}:{},factory.getFiasValidatorsByMnemonic(field.validator||"FiasString")],maxlength:field.maxlength,doNotSaveDraft:!0,syncRender:!0},{className:"FieldCheckbox",name:field.checkboxName,label:field.checkboxLabel,notRequiredText:"",visible:!0,doNotSaveDraft:!0,syncRender:!0}]}},getStructureV2:function(removeOpts,customLabels){var panelsStructure=this.getPanelsStructure(removeOpts,customLabels),result={fieldsConfig:panelsStructure.fieldsConfig},fullAddress={className:"Panel",name:"PanelFullAddress",title:"",isGridItem:!0,visible:!0,doNotSaveDraft:!0,syncRender:!0,items:[{className:"FieldText",name:"FullAddress",label:"Полный адрес",notRequiredText:"",disabled:!0,visible:!0,doNotSaveDraft:!0,syncRender:!0}]};result.structure={className:"Panel",name:"PanelControls",title:"",isGrid:!0,doNotSave:!0,doNotSaveDraft:!0,syncRender:!0,visible:!0,items:[{className:"Panel",name:"PanelDropdown",title:"",isGridItem:!0,doNotSaveDraft:!0,syncRender:!0,items:[{className:"FieldDropdown",name:"Dropdown",label:"Укажите адрес полностью",selectType:"DropdownForFiasDaData",hasContextSearch:!0,notRequiredText:"",doNotSaveDraft:!0,syncRender:!0,doNotShowInPdf:!0}]},{className:"Panel",name:"PanelQCFields",title:"",doNotSave:!0,doNotSaveDraft:!0,syncRender:!0,validateAlways:!0,visible:!1},{className:"Panel",name:"PanelHandFields",title:"",doNotSave:!0,doNotSaveDraft:!0,syncRender:!0,visible:!1,validateAlways:!0}]};var PanelQCFields=_.find(result.structure.items,function(item){return"PanelQCFields"===item.name}),PanelHandFields=_.find(result.structure.items,function(item){return"PanelHandFields"===item.name});return PanelQCFields.items=panelsStructure.PanelQCFields,PanelHandFields.items=panelsStructure.PanelHandFields,PanelHandFields.items.unshift(fullAddress),result},removedItems:[]};return factory}]),angular.module("serverFormWidgets.general").directive("epguFieldUpload",["$rootScope","TEMPLATES","api","LOC","$timeout","PGU","sharedExtServices","$q",function($rootScope,TEMPLATES,api,LOC,$timeout,PGU,sharedExtServices,$q){return{templateUrl:TEMPLATES.FIELD_UPLOAD,replace:!0,scope:{item:"="},link:function(scope,element,attrs){function findCloneParent(element){if(element.parent){var parent=api.find(element.parent.fullPath).element;return!!parent.isClone||findCloneParent(parent)}}$rootScope.haveUploaders=!0;var watchers,dictionaryModification="FieldUploadDictionary"==scope.item.className;scope.$on("suspend",function(){watchers=scope.$$watchers,scope.$$watchers=[]}),scope.$on("resume",function(){scope.$$watchers=watchers,watchers=null}),scope.ui={},scope.ui.isMobile=device.mobile(),scope.ui.isTablet=device.tablet(),scope.ui.notRequiredTextForMobile="",scope.item.multipleUpload=!dictionaryModification&&scope.item.multipleUpload,scope.item.onClonePanel=findCloneParent(scope.item),PGU.removed={},$rootScope.env.orderId&&(scope.item.orderId=$rootScope.env.orderId);var uploadRetry={file:null,offset:0},retryUpLoad=function(){uploadRetry.file.loaded=uploadRetry.offset,uploadRetry.file.status=plupload.UPLOADING,scope.uploader.state=plupload.STARTED,scope.uploader.trigger("UploadFile",uploadRetry.file)};scope.handleAddFileForParent=function(file,addedToFormHash){var fileToParent,result;"function"==typeof scope.item.handleUploaded&&(result={},(fileToParent=scope.item.files.find(function(item){return item.mnemonic===file.mnemonic}))&&(result.file=fileToParent,addedToFormHash&&(result.element=api._FormHash[file.mnemonic].element),scope.item.handleUploaded(result)))},scope.item.clearTemporaryData=function(saving,defer){var il,deleted=scope.item.temporaryData.deleted,added=scope.item.temporaryData.added,i=0,finishDelete=[];if(saving)if(deleted.forEach(function(file){if(file.uploaded){var removeDef=sharedExtServices.imageEditor.removeImage(scope.item.orderId,file.mnemonic,function(data){},function(error){});finishDelete.push(removeDef)}scope.uploader.files.forEach(function(uploadedFile,i){file.mnemonic==uploadedFile.mnemonic&&(scope.uploader.removeFile(file),delete api._FormHash[file.mnemonic])})}),added.length){finishDelete.length?$q.all(finishDelete).then(function(){setMultipartParams(added[0].params),scope.uploader.start()}):(setMultipartParams(added[0].params),$timeout(function(){scope.uploader.start()}));var addedDeferArray=[];added.forEach(function(file){file.def&&addedDeferArray.push(file.def)}),$q.all(addedDeferArray).then(function(){defer&&defer.resolve()},function(){defer&&defer.resolve()})}else defer&&defer.resolve();else{for(i=0,il=added.length;i<il;i++)added[i].def&&added[i].def.reject();defer&&defer.resolve()}scope.item.temporaryData.added=[],scope.item.temporaryData.deleted=[]},scope.item.setDraftFromEdit=function(data,action){var draftData,defer=$q.defer(),currentData=scope.item.files,uploadedAllFilesSize=0;switch(draftData=data.multiValue?JSON.parse(data.multiValue):"",action){case"cancel":if(scope.item.finishDef&&scope.item.finishDef.resolve(),!data.isFile)if(draftData){angular.forEach(currentData,function(file){file.uploaded||scope.uploader.removeFile(file)}),angular.forEach(draftData,function(file){uploadedAllFilesSize+=file.size}),scope.item.uploadedAllFilesSize=uploadedAllFilesSize,scope.item.files=draftData;var fileNamesArray=[];angular.forEach(scope.item.files,function(file){fileNamesArray.push(file.name)}),scope.uploader.files=draftData.slice(),scope.item.onClonePanel&&PGU.removed[scope.item.fullPath]&&PGU.removed[scope.item.fullPath].length&&delete PGU.removed[scope.item.fullPath]}else scope.removeAllFiles();scope.item.temporaryData.deleted=[],scope.item.temporaryData.added=[];break;case"save":draftData||data.isFile?(scope.item.clearTemporaryData(!0,defer),scope.uploader.files=scope.item.files.slice()):scope.item.clearTemporaryData(!0,defer)}return scope.uploader.refresh(),defer.promise},scope.item.temporaryData={added:[],deleted:[]},scope.codeErrors={"-600_form":"Общий объем файлов превышает максимально допустимый размер: ","-600_multiple":"превышает максимально допустимый размер: ","-600":" превышает максимально допустимый размер: ","-600_count":"Превышено максимальное количество загружаемых файлов","-602":"Файл уже загружен.","-603_validation":'Загруженный Вами файл не соответствует маске: FNS_1KK*_????_*_01_01_01.zip Пожалуйста, не переименовывайте файл, сгенерированный программой "Налогоплательщик ЮЛ"!',"-600_invalid_length":"Имя файла не может более 128 символов. Загрузите файл после корректировки","-600_invalid_char":"Имя файла не может содержать символы: «» / <> ; \\ : | . ? *, заканчиваться точкой или пробелом. Загрузите файл после корректировки","-600_invalid_name":"Имя файла не может быть CON, PRN, AUX, NUL, COM1, COM2, COM3, COM4, COM5, COM6, COM7, COM8, COM9, LPT1, LPT2, LPT3, LPT4, LPT5, LPT6, LPT7, LPT8 и 9. Загрузите файл после корректировки"};var setMultipartParams=function(params){if(scope.uploader){var settings=scope.uploader.settings;if(settings.multipart_params=params,"function"==typeof scope.item.getSignedData){var signedData=scope.item.getSignedData();signedData&&(settings.multipart_params.signedMnemonic=signedData)}}};!$rootScope.isDesigner&&!$rootScope.isPreview&&$timeout(function(){var $baseWrapper=$(element[0]),$button=$baseWrapper.find(".button-upload-multiple"),dropElem=element.find(".PGU-FieldUploadDnD"),isSafari=!1,file_extension=/\.[0-9a-z]+$/i;(scope.ui.isMobile||scope.ui.isTablet)&&($button=$baseWrapper.find(".js-manual-upload-mobile")),scope.uploadedAllFilesSize=0,scope.item.files=[],scope.calculateHumanSize();var draftData={};scope.item.multiValue&&(draftData=JSON.parse(scope.item.multiValue),scope.item.multipleUpload&&(scope.item.cloneIndex=function(){var cloneIndexArr=[];return draftData.forEach(function(item){item.cloneIndex&&cloneIndexArr.push(item.cloneIndex)}),cloneIndexArr.length?Math.max.apply(null,cloneIndexArr)+1:1}.call())),draftData&&draftData.length&&(scope.item.files=draftData,angular.forEach(scope.item.files,function(file){scope.item.uploadedAllFilesSize+=file.size})),scope.item.fileType?scope.allowedTypes=scope.item.fileType.toLowerCase().replace(/[\s\.\*]/g,"").split(","):scope.allowedTypes=null,navigator&&-1!==navigator.userAgent.indexOf("Safari")&&-1==navigator.userAgent.indexOf("Chrome")&&(isSafari=!0);var getStepVisble=function(el){return"FormStep"===el.element.className?api.inheritedVisibility(scope.item.fullPath)&&!!el.element.visibleStep:getStepVisble(el.parent())},handleVisible=scope.$watch(function(){return getStepVisble(scope.item.parent.apiElem)},function(newVal){!0===newVal&&(handleVisible(),$timeout(function(){scope.uploader.refresh()}))});PGU.Events.subscribe("","formRendered",function(){var handleVisible=scope.$watch(function(){return getStepVisble(scope.item.parent.apiElem)},function(newVal){!0===newVal&&(handleVisible(),$timeout(function(){scope.uploader.refresh()},700))})}),scope.ui.isMobile||scope.ui.isTablet||($button=$baseWrapper.find(".button-upload"));var fileType=scope.item.fileType.replace(/[\s\.\*]/g,""),uploaderParams={runtimes:"html5,flash,html4",browse_button:$button[0],max_file_count:scope.item.multipleUpload?scope.item.countFiles:1,multi_selection:!(!scope.item.multipleUpload||1==scope.item.countFiles),dragdrop:scope.item.multipleUpload||!scope.item.multipleUpload,drop_element:scope.item.multipleUpload||!scope.item.multipleUpload?dropElem.get(0):null,url:LOC.WIDGET_URI+"api/storage/v1/files/upload",required_features:"send_browser_cookies",filters:{max_file_size:scope.item.fileSize+"kb",mime_types:[{title:"Types files",extensions:fileType||"*"}]},flash_swf_url:LOC.WIDGET_URI+"htdocs/common/js/lib/plupload/plupload.flash.swf",fieldUploadedNamePGU:scope.item.mnemonic,prevent_duplicates:!1,chunk_size:$rootScope.env.systemData&&$rootScope.env.systemData.chunkSize||"5Mb",init:{Init:function(){if(scope.checkSpecificSmuConditions(),$timeout(function(){scope.uploader.refresh()},400),!$button[0].getBoundingClientRect().width||!$button[0].getBoundingClientRect().height)var sizeLoaderButtonWatcher=scope.$watch(function(){return $button[0].getBoundingClientRect().width>0},function(val){val&&(scope.uploader.refresh(),sizeLoaderButtonWatcher())})},Browse:function(up,files){var fnIE=scope.item.fullPath,ciIE=parseInt(scope.item.cloneIndex)+1;$rootScope.env.fieldUploadedNamePGU=fnIE+"["+ciIE+"]"},FilesAdded:function(up,files){if("true"===$rootScope.env.formParam.isLogElForm&&$rootScope.$emit("HEALTH_SEND",{event:"logElForm",timing:0,result:3,el:scope.item.fullPath,order_id:api.env("orderId")}),scope.stackFile=!1,scope.filesAdded=files,!scope.isNotFirstLoad){scope.item.finishDef=$q.defer();var finishUpload=function(defer){scope.item.finishDef&&scope.item.finishDef.promise.then(function(){defer.resolve()})};api.addRequestToQueue(finishUpload),scope.isNotFirstLoad=!0,api.checkParentIsEditableMode(scope.item.fullPath)&&api.addRequestToQueue(finishUpload)}files[0].size||(files[0].size=0),scope.loading=!0;var validatedFiles=function(files){var preCheckSize=1024*$rootScope.env.totalOrderFileSize,tmpArrayFile=[],errorMessage="",dublicate=void 0,commonSize=0,fieldMaxSize=1024*scope.item.fileSize,totalFieldSize=0;files.forEach(function(file){commonSize+=file.size});var hashFiles={};scope.item.files.forEach(function(uploadedFile){var size=uploadedFile.size;totalFieldSize+=size,hashFiles[uploadedFile.name]=size});var recentSize=fieldMaxSize-totalFieldSize;return commonSize+=scope.item.uploadedAllFilesSize||0,files.forEach(function(file){if(dublicate=!(!hashFiles[file.name]||file.size!==hashFiles[file.name]))return errorMessage=scope.codeErrors[-602],scope.uploader.removeFile(file),scope.loading=!1,errorMessage;var maskValidation=!0;if(scope.item.validators&&scope.item.validators.forEach(function(item){file.name.match(item.regexp)||(errorMessage=item.message,maskValidation=!1)}),!maskValidation)return scope.uploader.removeFile(file),scope.loading=!1,errorMessage;if(commonSize>=preCheckSize)return errorMessage=scope.codeErrors["-600_form"]+" "+scope.item.fileSize+" Кб.",scope.uploader.removeFile(file),scope.loading=!1,errorMessage;if(file.size>recentSize)return errorMessage=scope.codeErrors["-600_form"]+" "+scope.item.fileSize+" Кб.",scope.uploader.removeFile(file),scope.loading=!1,errorMessage;if(0===file.size||"number"!=typeof file.size||isNaN(file.size))return scope.uploader.removeFile(file),scope.loading=!1,!1;if(!scope.item.multipleUpload&&scope.item.files&&scope.item.files.length||!scope.item.multipleUpload&&files.length>1||scope.item.multipleUpload&&scope.item.files.length+files.length>scope.item.countFiles)return errorMessage=scope.codeErrors["-600_count"],scope.uploader.removeFile(file),scope.loading=!1,errorMessage;if($rootScope.env.supportSignature&&file.name){var stopWordsOfName=["CON","PRN","AUX","NUL","COM1","COM2","COM3","COM4","COM5","COM6","COM7","COM8","COM9","LPT1","LPT2","LPT3","LPT4","LPT5","LPT6","LPT7","LPT8","LPT8"],fileName=file.name.split(".").slice(0,-1).join("."),indexLastDot=file.name.lastIndexOf("."),lastCharName=file.name[indexLastDot-1],isErrorLength=fileName&&fileName.length>128,isErrorChar=!!file.name.match(/[<>:"«»\|\?\*\/\\]/gi),isEndDotSpace="."===lastCharName||" "===lastCharName,isErrorWord=stopWordsOfName.indexOf(fileName.toUpperCase())>-1;if(isEndDotSpace||isErrorChar||isErrorWord||isErrorLength)return isErrorLength?errorMessage=scope.codeErrors["-600_invalid_length"]:isErrorChar||isEndDotSpace?errorMessage=scope.codeErrors["-600_invalid_char"]:isErrorWord&&(errorMessage=scope.codeErrors["-600_invalid_name"]),scope.uploader.removeFile(file),scope.loading=!1,errorMessage}var fullPath=scope.item.fullPathForXml||scope.item.fullPath;scope.item.cloneIndex=scope.item.cloneIndex||1,file.cloneIndex=scope.item.cloneIndex,scope.item.multipleUpload&&scope.item.countFiles>1?file.mnemonic=fullPath+"["+file.cloneIndex+"]":file.mnemonic=fullPath,file.params={objectType:"2",objectId:scope.item.orderId,BusinessName:scope.item.name,mnemonic:file.mnemonic},scope.item.cloneIndex++,recentSize-=file.size,tmpArrayFile.push(file)}),scope.item.errorMessage=errorMessage,errorMessage&&scope.item.finishDef.resolve(),api.applyScope(),tmpArrayFile}(files);scope.item.addTemporaryFileToQueue=function(file){var previousFile=scope.item.temporaryData.added[scope.item.temporaryData.added.length-1];previousFile&&(previousFile.def=$q.defer(),previousFile.def.promise.then(function(){scope.checkLimits(up,file)||(setMultipartParams(file.params),scope.uploader.start())})),file.percent=100,scope.loading=!1,scope.item.temporaryData.added.push(file)},validatedFiles.forEach(function(file,key){api.checkTotalAmount(file.size).done(function(d){var checkLimits;d.permission&&scope.item.countFiles>0||dictionaryModification?(checkLimits=scope.checkLimits(up,file),checkLimits?(scope.uploadFile(file,!1,checkLimits),scope.uploader.removeFile(file)):(scope.item.addTemporaryFileToQueue(file),api.checkParentIsEditableMode(scope.item.fullPath)||scope.item.temporaryData.added.length==validatedFiles.length&&(setMultipartParams(scope.item.temporaryData.added[0].params),scope.uploader.start()),scope.uploadFile(file,!1)),scope.item.uploading=!0):(checkLimits=scope.checkLimits({files:[file]},file,d.max),scope.uploadFile(file,!1,checkLimits,!1,!0),scope.uploader.removeFile(file),scope.loading=!1)})}),scope.$apply()},UploadProgress:function(up,file){scope.loading=!0,scope.item.uploading=!0,scope.loading=!0,scope.$apply()},BeforeUpload:function(up,file){uploadRetry.file=file,uploadRetry.offset=0},ChunkUploaded:function(up,file,info){uploadRetry.offset=info.offset},FileUploaded:function(up,file){scope.item.uploading=!1;var needAddToFormHash=scope.item.multipleUpload&&scope.item.countFiles>1;scope.loading=!1,file.def&&file.def.resolve("uploaded"),needAddToFormHash&&(api._FormHash[file.mnemonic]={},api._FormHash[file.mnemonic].element={className:scope.item.className,value:file.name,mnemonic:file.mnemonic,size:file.size,businessName:scope.item.name,docTypeString:scope.item.docTypeString,cloneIndex:file.cloneIndex,setDraftFromEdit:scope.item.setDraftFromEdit,makePromiseForReadyUploader:scope.item.makePromiseForReadyUploader}),file.uploaded=!0,scope.handleAddFileForParent(file,needAddToFormHash),api.checkParentIsEditableMode(scope.item.fullPath)||(scope.item.temporaryData.added=[]),uploadRetry.file=null,api.env("autosaveDisabled")||api.uploadDraft(!1,null,null,!1,"true"!==api.env("formParam").isSaveElDraft?null:scope.item),"true"===$rootScope.env.formParam.isLogElForm&&$rootScope.$emit("HEALTH_SEND",{event:"logElForm",timing:0,result:4,el:scope.item.fullPath,order_id:api.env("orderId")}),scope.$apply()},UploadComplete:function(up,files){scope.filesAdded.length==files.length&&(scope.item.errorMessage="",scope.filesAdded=[]),scope.item.finishDef&&(scope.item.finishDef.resolve(),scope.isNotFirstLoad=!1),"function"==typeof scope.item.updateSignData&&scope.item.updateSignData()},Error:function(up,err){if(!("501"!=err.code&&"502"!=err.code&&"503"!=err.code&&"504"!=err.code&&"-200"!=err.code||"-200"==err.code&&("-200"!=err.code||"501"!=err.status&&"502"!=err.status&&"503"!=err.status&&"504"!=err.status)))return scope.uploader.stop(),void $timeout(retryUpLoad,2e3);err.file.error="Что-то пошло не так","-600"==err.code?scope.item.errorMessage=err.file.name+" "+scope.codeErrors[scope.item.multipleUpload?err.code+"_multiple":err.code]+" "+scope.item.fileSize+" Кб.":"-601"==err.code?scope.item.errorMessage=err.file.name+" имеет неверный тип. Только файлы с расширениями "+scope.item.fileType+" доступны к загрузке.":"-200"==err.code?scope.item.errorMessage="Что-то пошло не так":scope.item.errorMessage=scope.codeErrors[err.code]||err.message,scope.item.uploading=!1,
err.file.def&&err.file.def.reject("uploaded"),scope.item.finishDef&&scope.item.finishDef.resolve(),scope.uploader.removeFile(err.file),scope.item.temporaryData.added=scope.item.temporaryData.added.filter(function(file){if(err.file.id!=file.id)return file}),scope.loading=!1,api.applyScope()}}};$rootScope.inOpWidget&&$rootScope.settings.sessionToken&&(uploaderParams.headers={Authorization:"bearer "+$rootScope.settings.sessionToken}),scope.uploader=new plupload.Uploader(uploaderParams),scope.uploader.init(),scope.removeFile=function(index,file,draft,up,callback){scope.item.uploadedAllFilesSize-=file.size,scope.item.uploadedAllFilesSize=scope.item.uploadedAllFilesSize>0?scope.item.uploadedAllFilesSize:0,scope.item.size=scope.item.uploadedAllFilesSize,api.find(scope.item.fullPath).validate(scope.item.files.length),api.checkParentIsEditableMode(scope.item.fullPath)?(scope.item.temporaryData.deleted.push(file),"function"==typeof callback&&callback()):(scope.uploader.removeFile(file),sharedExtServices.imageEditor.removeImage(scope.item.orderId,file.mnemonic,function(data){if(angular.forEach(scope.uploader.files,function(file,i){data.mnemonic==file.mnemonic&&(data.findInUploader=!0,scope.uploader.removeFile(file),delete api._FormHash[file.mnemonic],api.__getMarkDeleted()[file.mnemonic]={deleted:!0})}),data.findInUploader||(delete api._FormHash[data.mnemonic],api.__getMarkDeleted()[data.mnemonic]={deleted:!0}),scope.uploadedAllFilesSize-=file.size,scope.item.uploadedFileSize=scope.uploadedAllFileSize,scope.item.multipleUpload)if(scope.item.files.length>1){var fileNames=scope.item.value.split(", "),removedArray=[];fileNames.forEach(function(filename){file.name!=filename&&removedArray.push(filename)}),scope.item.value=removedArray.join(", "),scope.item.size-=data.fileSize}else scope.item.value="",scope.item.size=0;else scope.item.value="",scope.item.size=0;api.uploadDraft(!1,null,null,!1,"true"!==api.env("formParam").isSaveElDraft?null:scope.item),api.find(scope.item.fullPath).validate(),"function"==typeof callback&&callback()},function(error){"function"==typeof callback&&callback({error:error})})),scope.item.files.splice(index,1),scope.calculateHumanSize(),$timeout(function(){scope.uploader.refresh()},500)},"function"==typeof scope.item.handleRemoveFileFromParent&&(scope.item.removeFileFromParent=function(gridItemId){var fileIndex="-1",fileByRowUid=scope.item.files[fileIndex];scope.item.files.forEach(function(item,ind){item.rowUid===gridItemId&&(fileIndex=ind,fileByRowUid=item)}),fileIndex>-1&&scope.removeFile(fileIndex,fileByRowUid,null,null,scope.item.handleRemoveFileFromParent)}),scope.removeAllFiles=function(){var removeFilesPromisesArr=[],temporary=scope.item.temporaryData;(scope.item.files&&scope.item.files.length||!scope.item.multipleUpload&&scope.uploader.files>1)&&(scope.item.files.forEach(function(file,index){if(file.uploaded){var df=$q.defer();removeFilesPromisesArr.push(df),sharedExtServices.imageEditor.removeImage(scope.item.orderId,file.mnemonic,function(data){df.resolve()},function(error){df.resolve()})}delete api._FormHash[file.mnemonic],scope.uploader.removeFile(file),scope.item.value="",scope.item.uploadedAllFilesSize-=file.size}),scope.item.files=[],scope.calculateHumanSize());for(var i=0,il=temporary.deleted.length;i<il;i++){var df=$q.defer();removeFilesPromisesArr.push(df),sharedExtServices.imageEditor.removeImage(scope.item.orderId,temporary.deleted[i].mnemonic,function(data){df.resolve()},function(error){df.resolve()})}scope.item.uploadedAllFilesSize=0,scope.item.temporaryData.added.forEach(function(file){scope.uploader.removeFile(file)}),scope.item.temporaryData.deleted=scope.item.temporaryData.added=scope.uploader.files=[],$q.all(removeFilesPromisesArr).then(api.uploadDraft),scope.uploader.total.reset()},dropElem[0].ondragover=function(){return scope.item.hover=!0,scope.$apply(),!1},dropElem[0].ondragleave=function(){return scope.item.hover=!1,scope.$apply(),!1},dropElem[0].ondrop=function(event){var files=event.dataTransfer.files;scope.item.hover=!1,scope.item.drop=!0,!isSafari||scope.ui.isTablet||scope.ui.isMobile||angular.forEach(files,function(self){scope.uploader.addFile(self)}),scope.$apply()};!function(){if((!scope.item.multiValue||!scope.item.multiValue.length)&&scope.item.value&&scope.item.value.length){var file={size:scope.item.size,value:scope.item.value};if(scope.item.multipleUpload)for(var i=0;i<scope.item.cloneIndex;i++)file.mnemonic=scope.item.fullPath+i,scope.removeFile(scope.item.cloneIndex,file);else file.mnemonic=scope.item.fullPath,scope.removeFile(scope.item.cloneIndex,file);scope.item.cloneIndex=0,scope.item.mimeType=""}}();scope.checkLimits=function(up,file,maxTotalSize){var error,fileExtension;if(!up.files||!up.files.length)return"";fileExtension=file.name.match(file_extension)?file.name.match(file_extension)[0].substring(1).toLowerCase():"-";var fileSize=up.files[up.files.length-1].size;if(scope.allowedTypes&&scope.allowedTypes.length)if(-1!=$.inArray(fileExtension,scope.allowedTypes)){if(dictionaryModification)return"";scope.item.minSize&&fileSize<plupload.parseSize(scope.item.minSize)&&(error="Файл меньше минимально допустимого размера "+api.parseMinSize(scope.item.minSize)+"."),maxTotalSize&&(error=scope.codeErrors["-600_form"]+maxTotalSize+" Кб")}else error=up.files[up.files.length-1].name+" имеет неверный тип. Только файлы с расширениями "+scope.item.fileType+" доступны к загрузке.";else scope.item.minSize&&fileSize<plupload.parseSize(scope.item.minSize)&&(error="Файл меньше минимально допустимого размера "+api.parseMinSize(scope.item.minSize)+"."),maxTotalSize&&(error=scope.codeErrors["-600_form"]+maxTotalSize+" Кб");return error},$timeout(function(){scope.$emit(scope.item.fullPath+":ScopeApplied",{scope:scope,element:element}),scope.item.isScopeAppliedDone={scope:scope,element:element}}),scope.uploadFile=function(file,uploaded,error,fromSmu,maxTotalSize){if(uploaded)scope.item.multipleUpload?fromSmu?5===scope.smu.files[scope.smu.files.length-1].status&&(scope.loading=!1):5===scope.uploader.files[scope.uploader.files.length-1].status&&(scope.loading=!1):5===file.status&&(scope.loading=!1),scope.calculateHumanSize(),scope.countFiles=scope.countFiles-1;else{if(error){if(maxTotalSize)return scope.item.errorMessage=error,scope.item.error=error,void scope.item.finishDef.resolve();file.error=error}else scope.item.error=!1,scope.item.errorMessage="";if(file.sizeToSting=api.humanSize(file.size),scope.item.multipleUpload||(scope.item.files=[],scope.item.uploadedAllFilesSize=0,scope.item.cloneIndex=1),scope.item.files.push(file),scope.item.files.length){var tnf="";scope.item.files.forEach(function(v,i){tnf+=v.name+", "}),tnf=tnf.substr(0,tnf.length-2),scope.item.value=tnf}scope.showHint=function(file){file.xShowHint=!file.xShowHint}}scope.item.uploadedAllFilesSize+=file.size},scope.checkSpecificSmuConditions=function(){var wp=device.windowsPhone(),notifySMU=api.env("notifySMU"),needSmu=window.needUseAttacheSmuAdapter||wp;notifySMU&&needSmu&&(plupload.addEvent($baseWrapper.find("input")[0],"click",function(e){var smuObj={eventType:"fileUpload",eventParams:[{key:"full_path",value:scope.item.fullPath},{key:"input_id",value:this.id},{key:"multi_selection",value:scope.item.multipleUpload},{key:"file_type",value:scope.item.fileType},{key:"min_size",value:1024*scope.item.minSize},{key:"max_size",value:1024*scope.item.fileSize}]};notifySMU&&notifySMU(smuObj)}),window.PGU=window.PGU||PGU,PGU.Events.subscribe(scope.item.fullPath,"filesAdded",function(evt,data){try{var parseData=data;"string"==typeof parseData&&(parseData=JSON.parse(data)),scope.fileErrorMessage="",scope.smu={},scope.smu.files=parseData.files,scope.smu.files[0].size||(scope.smu.files[0].size=0),scope.loading=!0;var preCheckSize=1024*$rootScope.env.totalOrderFileSize-scope.item.uploadedAllFilesSize,tmpArrayFile=[];preCheckSize-scope.smu.files[0].size>0&&scope.item.countFiles>0&&(angular.forEach(scope.smu.files,function(value,key){if(value.base64){var blob=scope.dataURItoBlob(value.base64);if(blob.name=value.name,preCheckSize-=blob.size,blob.mnemonic=(scope.item.fullPathForXml||scope.item.fullPath)+"["+scope.item.cloneIndex+"]",scope.ui.isMobile&&scope.item.cloneIndex++,preCheckSize<0||key+1>scope.item.countFiles||scope.item.files.length==scope.item.countFiles);else{if(!scope.item.multipleUpload&&tmpArrayFile.length>=1)return!1;tmpArrayFile.push(blob)}}}),scope.smu.files=tmpArrayFile),angular.forEach(scope.smu.files,function(file,index){api.checkTotalAmount(file.size).done(function(d){var checkLimits;if(d.permission&&scope.item.countFiles>0||dictionaryModification){var fd=new FormData;if(fd.append("name",file.name),fd.append("file",file),checkLimits=scope.checkLimits({files:[file]},file),scope.item.orderId&&(fd.append("objectType",2),fd.append("objectId",scope.item.orderId)),fd.append("mnemonic",file.mnemonic),checkLimits){scope.uploadFile(file,!1,checkLimits);var removeIndex=-1;angular.forEach(scope.item.files,function(itemFile,ind){itemFile.name===file.name&&(removeIndex=ind)}),removeIndex>-1&&(scope.item.files.splice(removeIndex,1),scope.fileErrorMessage=checkLimits,scope.loading=!1,scope.$apply())}else{scope.item.mnemonic=(scope.item.fullPathForXml||scope.item.fullPath)+"["+scope.item.cloneIndex+"]",scope.uploadFile(file,!1);var xhr=new XMLHttpRequest;xhr.open("POST",scope.uploader.getOption("url")),xhr.withCredentials=!0,xhr.onloadend=function(evt){200==xhr.status?(file.percent=100,file.status=5,scope.item.uploading=!1,scope.uploadFile(file,!0,!1,!0),scope.handleAddFileForParent(file),scope.item.uploading=!1,scope.loading=!1,scope.$apply()):(scope.loading=!1,file.error="Что-то пошло не так",scope.item.errorMessage="Что-то пошло не так",scope.loading=!1,scope.item.uploading=!1,scope.$apply())},scope.item.uploading=!0,scope.loading=!0,scope.$apply(),xhr.send(fd)}}else checkLimits=scope.checkLimits({files:[file]},file,d.max),scope.uploadFile(file,!1,checkLimits,!1,!0),scope.uploader.removeFile(file)})})}catch(e){}}))},scope.dataURItoBlob=function(dataURI){var byteString;byteString=dataURI.split(",")[0].indexOf("base64")>=0?atob(dataURI.split(",")[1]):unescape(dataURI.split(",")[1]);for(var mimeString=dataURI.split(",")[0].split(":")[1].split(";")[0],ia=new Uint8Array(byteString.length),i=0;i<byteString.length;i++)ia[i]=byteString.charCodeAt(i);return new Blob([ia],{type:mimeString})};var fullPathObj={fullPath:scope.item.fullPath,fullPathForXml:scope.item.fullPathForXml};scope.item.readyUploader&&scope.item.readyUploader.resolve(fullPathObj)}),scope.calculateHumanSize=function(){var msg="";scope.item.required||(msg+="необязательно "),!scope.item.multipleUpload||scope.ui.isMobile||scope.ui.isTablet||(msg+="Осталось "+api.humanSize(1024*scope.item.fileSize-(scope.item.uploadedAllFilesSize?scope.item.uploadedAllFilesSize:0))),scope.ui.notRequiredTextForMobile=msg},PGU.Events.subscribe(scope.item.fullPath,"removeParent",function(){if(scope.item.onClonePanel&&api.checkParentIsEditableMode(scope.item.fullPath)){if(scope.item.files&&scope.item.files.length){PGU.removed[scope.item.fullPath]=[];var removedFilesArr=[];scope.item.files.forEach(function(){var defer=$q.defer();PGU.removed[scope.item.fullPath].push(defer),removedFilesArr.push(defer.promise)}),scope.item.finishDef.resolve(),$q.all(removedFilesArr).then(function(){scope.removeAllFiles()})}}else scope.removeAllFiles()}),PGU.Events.subscribe("","cancelEdit",function(){scope.item.onClonePanel&&PGU.removed[scope.item.fullPath]&&delete PGU.removed[scope.item.fullPath]}),PGU.Events.subscribe("","saveEdit",function(){scope.item.onClonePanel&&PGU.removed[scope.item.fullPath]&&PGU.removed[scope.item.fullPath].forEach(function(defer){defer.resolve()})})},controller:["$scope","$rootScope","api",function($scope,$rootScope,api){$scope.$watch("item.hint + item.fileSize + item.minSize + item.fileType",function(val){$scope.item.defaultNote?$scope.item.fileType?$scope.item.minSize?$scope.item.mergeHint=$scope.item.hint+($scope.item.hint?"<br />":"")+" Для загрузки выберите файл с расширением "+$scope.item.fileType+". Минимально допустимый размер файла — "+api.parseMinSize($scope.item.minSize)+", максимально допустимый — "+$scope.item.fileSize+" Кб.":$scope.item.mergeHint=$scope.item.hint+($scope.item.hint?"<br />":"")+" Для загрузки выберите файл с расширением "+$scope.item.fileType+". Максимально допустимый размер файла — "+$scope.item.fileSize+" Кб.":$scope.item.minSize?$scope.item.mergeHint=$scope.item.hint+($scope.item.hint?"<br />":"")+" Минимально допустимый размер файла — "+api.parseMinSize($scope.item.minSize)+", максимально допустимый — "+$scope.item.fileSize+" Кб.":$scope.item.mergeHint=$scope.item.hint+($scope.item.hint?"<br />":"")+" Максимально допустимый размер файла — "+$scope.item.fileSize+" Кб.":$scope.item.mergeHint=$scope.item.hint||""})}]}}]).factory("FieldUploadExt",["$rootScope","fieldAttrs","PGU","$q",function($rootScope,fieldAttrs,PGU,$q){return{crutchOrderId:function(id){id&&(this.element.orderId=id)},_removeParent:function(){PGU.Events.publish(this.fullPath+":removeParent",{})},setDraftFromEdit:function(){},makePromiseForReadyUploader:function(){return this.readyUploader=$q.defer(),this.readyUploader},attrs:angular.extend({},fieldAttrs.attrs,{mimeType:{type:"string","scope:sync":!0,"scope:editor":!1,default:""},fileType:{type:"string",default:"","scope:editor":!0},fileSize:{type:"integer",default:5120,"scope:editor":!0},minSize:{type:"string",default:"","scope:editor":!0,checkInput:"minFileSize"},docTypeString:{type:"string",default:"","scope:editor":!1,"scope:sync":!0},uploadedFileSize:{type:"integer",default:0,"scope:editor":!1,"scope:sync":!1},uploadedAllFilesSize:{default:0,"scope:editor":!1,"scope:sync":!1},epguSign:{type:"boolean",default:!1,"scope:editor":$rootScope.isAdminUser},defaultNote:{type:"boolean",default:!0},mnemonic:{type:"string",default:"","scope:editor":!1,"scope:sync":!0},size:{type:"string",default:"","scope:editor":!1,"scope:sync":!0},externalLoader:{default:{file:{}},"scope:editor":!1},countFiles:{default:"10"},minCountFiles:{type:"integer",default:0,"scope:editor":!1,"scope:sync":!1},multipleUpload:{type:"boolean",default:!1},cloneIndex:{default:"1","scope:editor":!1,"scope:sync":!0,type:"string"},businessName:{type:"string",default:"","scope:editor":$rootScope.isAdminUser,"scope:sync":!0},setDraftFromEdit:{type:"string",default:"","scope:editor":!1,"scope:sync":!0},rowUid:{type:"string",default:"","scope:editor":!1,"scope:sync":!0},isEditableGridUploader:{type:"boolean",default:!1,"scope:editor":!1},editableGridUploaderBtnText:{type:"string",default:"Добавить документ","scope:editor":!1}})}}]),angular.module("serverFormWidgets.general").directive("epguImageEditor",["imageEditorProperties","TEMPLATES","TEMPLATES_PLAYER","api","$rootScope","fieldAttrs","$sce","$q","$timeout","LOC","sharedExtServices","PGU","$document","IMAGE_EDITOR_ERRORS_MSG","$filter","HealthSrv",function(imageEditorProperties,TEMPLATES,TEMPLATES_PLAYER,api,$rootScope,fieldAttrs,$sce,$q,$timeout,LOC,sharedExtServices,PGU,$document,IMAGE_EDITOR_ERRORS_MSG,$filter,HealthSrv){return{templateUrl:TEMPLATES.IMAGE_EDITOR,replace:!0,scope:{item:"="},link:function(scope,element,attrs){function DnD(element,settings){this.dragstartCallbacks=[],this.dragCallbacks=[],this.dragendCallbacks=[],this.element=element,this.settings=settings||{},this.settings.dragstart&&this.dragstartCallbacks.push(this.settings.dragstart),this.settings.drag&&this.dragCallbacks.push(this.settings.drag),this.settings.dragend&&this.dragendCallbacks.push(this.settings.dragend),this.bindedDragstart=this._dragstart.bind(this),this.bindedDrag=this._drag.bind(this),this.bindedDragend=this._dragend.bind(this),document.addEventListener("mousedown",this.bindedDragstart),document.addEventListener("touchstart",this.bindedDragstart)}function ImageModel(imgW,imgH,settings){Math.sign=Math.sign||function(x){return x=+x,0===x||isNaN(x)?x:x>0?1:-1},scope.item.isCustomSized?(this.guide={w:scope.item.customWidth,h:scope.item.customHeight},this.image={w:imgW,h:imgH},this.guideInMM={w:scope.item.containerWidthInMM,h:scope.item.containerHeightInMM}):(this.guide={w:190,h:244},this.image={w:imgW,h:imgH},this.guideInMM={w:35,h:45}),this.scaleFactor=1,this.settings=settings,this.angle=0,this.midpoint={x:this.image.w/2,y:this.image.h/2};var minWidthByDPI;this.settings.canvasSrc&&(this.canvasSrc=settings.canvasSrc),this.settings.fitIn&&this._fitIn(),this.settings.imgDPI?(minWidthByDPI=this.guideInMM.w/25.4*this.settings.imgDPI,this.maxScaleFactor=this.guide.w/minWidthByDPI):this.maxScaleFactor=1}function checkFileSizeAndShowError(file,byPermission){if(file.size<scope.item.minFileSize||file.size>scope.item.maxFileSize)return scope.updateState(imageEditorProperties.getClientUploadState({errorCode:file.size<scope.item.minFileSize?"14":"15",minFileSize:scope.item.minFileSize,maxFileSize:scope.item.maxFileSize}),file,!0),!0;if(byPermission){scope.ui.totalFileSizeError=!0;var state=imageEditorProperties.getClientUploadState({errorCode:"-600_form"});return state.errorMsg+=" "+$filter("filterFileSize")(1024*$rootScope.env.totalOrderFileSize),scope.updateState(state,file,!0),!0}return!1}scope.isPhone=device.mobile(),scope.isTablet=device.tablet(),scope.isDesktop=device.desktop(),scope.customLines=imageEditorProperties.createCustomLinesData(scope.item),scope.customText=imageEditorProperties.createCustomLinesText(scope.item,scope.isPhone);var setCustomAttributes=function(parameters){scope.item.customWidth=scope.item.minWidth="mob"===$rootScope.version?parameters.mobWidth:parameters.width,scope.item.customHeight=scope.item.minHeight="mob"===$rootScope.version?parameters.mobHeight:parameters.height,scope.item.minAspectRatio=parameters.minAspectRatio,scope.item.maxAspectRatio=parameters.maxAspectRatio,scope.item.containerWidthInMM=parameters.containerWidthInMM,scope.item.containerHeightInMM=parameters.containerHeightInMM,scope.item.isCustomSized=!0,scope.item.minFileSize=1024,scope.item.minFileFinalSize=1024,scope.item.maxFileSize=10485760,scope.item.imgDPI=parameters.dpi||0};if("europrotocolPhotoEditCustom"===scope.item.name){var parameters={mobWidth:220,width:400,mobHeight:110,height:200,minAspectRatio:.1,maxAspectRatio:2,containerWidthInMM:200,containerHeightInMM:100};setCustomAttributes(parameters)}if("ChildBirthPolis"===scope.item.name){var parameters={mobWidth:160,width:160,mobHeight:200,height:200,minAspectRatio:.1,maxAspectRatio:1.25,containerWidthInMM:32,containerHeightInMM:40,dpi:300};setCustomAttributes(parameters)}if("HandwrittenSignExample"===scope.item.name){var parameters={mobWidth:184,width:368,mobHeight:40,height:80,minAspectRatio:.1,maxAspectRatio:4.6,containerWidthInMM:10,containerHeightInMM:46,dpi:300};setCustomAttributes(parameters)}scope.ui={actions:{imageRotateLeftEnabled:!1,imageRotateRightEnabled:!1,imageCropEnabled:!1,previousImageEnabled:!1,deleteImageEnabled:!1,imageZoomEnabled:!0},linesText:{top:scope.isPhone?"Голова":"Голова не&nbsp;должна быть выше этой линии",middle:scope.isPhone?"Глаза":"Глаза должны быть на&nbsp;уровне этой линии",bottom:scope.isPhone?"Плечи":"Плечи должны быть на&nbsp;уровне этой линии"},modalState:"info",fileState:"",isDetailsShow:!1,isDetailsDialogShow:!1,changeBtnText:"Изменить фотографию",fileReaderMode:!1,modalShow:!1,zoom:0,initedPopup:!1,imgRotateAngle:-90,moveEnabled:!1,imageZoom:{lastPosition:0,maxScaleFactor:0,minScaleFactor:0,deltaBtn:.2},mmInInch:25.4,containerWidthInMM:scope.item.containerWidthInMM||35,containerHeightInMM:scope.item.containerHeightInMM||45,imgDpi:scope.item.imgDPI||0,imgLoading:!1,showProgressBar:!1,progressBarPercent:0,btnShowDialog:{label:scope.item.btnName,fullPath:scope.item.fullPath?scope.item.fullPath+"._btnShowDialog":"_btnShowDialog",buttonSize:"small",visible:!0},btnSave:{balign:"right",btnColor:"blue",label:"Сохранить",fullPath:scope.item.fullPath?scope.item.fullPath+"_btnSave":"_btnSave",floating:"PGU-BtnFloat",buttonSize:"",visible:!0},btnCancel:{label:"Отменить",fullPath:scope.item.fullPath?scope.item.fullPath+"._btnCancel":"_btnCancel",floating:"PGU-BtnFloat",buttonSize:"",visible:!0}},scope.item.isCustomSized&&(scope.ui.fileReaderMode=!0,scope.ui.customStyles={width:scope.item.customWidth+"px",height:scope.item.customHeight+"px"},"ChildBirthPolis"===scope.item.name&&(scope.ui.additionalActions={needColorToGray:!0,resize:{needed:!1,width:320,height:400}},scope.ui.customClassName="child-birth-polis_photo"),"HandwrittenSignExample"===scope.item.name&&(scope.ui.customStyles.margin="0 auto",scope.ui.customClassName="handwritten-sign-example_photo")),scope.ui.toggleBtnLabel=function(){scope.ui.btnShowDialog.label=scope.item.mnemonic?"Изменить фотографию":scope.item.btnName},scope.ui.saveChanges=function(){scope.ui.saveClientImage()},DnD.prototype.bind=function(phaseName,callback){this[phaseName+"Callbacks"].push(callback)},DnD.prototype._checkModifier=function(e){var modifierPressed=e.altKey||e.ctrlKey||e.metaKey||e.shiftKey;return!(this.settings.modifier||this.settings.gesture||modifierPressed)||!(!this.settings.modifier||!e[this.settings.modifier+"Key"])},DnD.prototype._callback=function(name){var callbackArgs=[].slice.call(arguments,1);this[name+"Callbacks"].forEach(function(callback){callback.apply(this.element,callbackArgs)}.bind(this))},DnD.prototype._dragstart=function(event){var touches,touch,multiTouches=[];if(event.target===this.element&&(touches=event.touches,this._checkModifier(event))){if(event.touches&&event.touches.length&&event.touches.length>1){for(var i=0,il=event.touches.length;i<il;i++)touch=event.touches[i],multiTouches.push({id:touch.identifier,x:touch.pageX,y:touch.pageY});this.prevTouches=multiTouches.concat()}this.prevPageX=event.pageX||touches[0].pageX,this.prevPageY=event.pageY||touches[0].pageY,document.addEventListener("mousemove",this.bindedDrag),document.addEventListener("mouseup",this.bindedDragend),document.addEventListener("touchmove",this.bindedDrag),document.addEventListener("touchend",this.bindedDragend),this._callback("dragstart")}},DnD.prototype._drag=function(event){var touch,touches=event.touches,multiTouches=[];if(this.prevTouches&&this.prevTouches.length>1&&touches&&touches.length>1){for(var i=0,il=event.touches.length;i<il;i++)touch=event.touches[i],multiTouches.push({id:touch.identifier,x:touch.pageX,y:touch.pageY});this._callback("drag",{touches:this.prevTouches},{touches:multiTouches}),this.prevTouches=multiTouches.concat()}else this._callback("drag",{x:this.prevPageX,y:this.prevPageY},{x:event.pageX||touches[0].pageX,y:event.pageY||touches[0].pageY}),this.prevPageX=event.pageX||touches[0].pageX,this.prevPageY=event.pageY||touches[0].pageY},DnD.prototype._dragend=function(event){document.removeEventListener("mousemove",this.bindedDrag),document.removeEventListener("mouseup",this.bindedDragend),document.removeEventListener("touchmove",this.bindedDrag),document.removeEventListener("touchend",this.bindedDragend),this._callback("dragend")},ImageModel.prototype._updateScaleFactor=function(deltaScale){this.scaleFactor*deltaScale>this.maxScaleFactor?this.scaleFactor=this.maxScaleFactor:this.scaleFactor*=deltaScale},ImageModel.prototype._fitIn=function(){var wScale=this.guide.w/this.image.w,hScale=this.guide.h/this.image.h;this.minScaleFactor=Math.max(wScale,hScale),this.scaleFactor=Math.max(wScale,hScale)},ImageModel.prototype._unscale=function(scaled){var unscaled={};return["x","y","w","h"].forEach(function(key){void 0!==scaled[key]&&(unscaled[key]=scaled[key]/this.scaleFactor)}.bind(this)),unscaled},ImageModel.prototype.move=function(from,to){from=this._unscale(from),to=this._unscale(to);var delta={x:to.x-from.x,y:to.y-from.y},deltaRotated={x:delta.x*Math.cos(-this.angle)-delta.y*Math.sin(-this.angle),y:delta.x*Math.sin(-this.angle)+delta.y*Math.cos(-this.angle)};this.midpoint.x-=deltaRotated.x,this.midpoint.y-=deltaRotated.y},ImageModel.prototype.rotate=function(from,to,around){from=this._unscale(from),to=this._unscale(to),around=this._unscale(around);var A={x:from.x-around.x,y:from.y-around.y},B={x:to.x-around.x,y:to.y-around.y},dotProduct=A.x*B.x+A.y*B.y,absA=Math.sqrt(A.x*A.x+A.y*A.y),absB=Math.sqrt(B.x*B.x+B.y*B.y),deltaAngle=Math.acos(Math.min(dotProduct/(absA*absB),1)),crossProduct=A.x*B.y-B.x*A.y;deltaAngle*=Math.sign(crossProduct),this.angle+=deltaAngle},ImageModel.prototype.rotateBy=function(angle){var sin=Math.sin(angle),cos=Math.cos(angle),around={x:0,y:0},from={x:1,y:0},to={x:from.x*cos-from.y*sin,y:from.x*sin+from.y*cos};this.rotate(from,to,around)},ImageModel.prototype.scale=function(from,to,around){from=this._unscale(from),to=this._unscale(to),around=this._unscale(around);var A={x:from.x-around.x,y:from.y-around.y},B={x:to.x-around.x,y:to.y-around.y},absA=Math.sqrt(A.x*A.x+A.y*A.y),absB=Math.sqrt(B.x*B.x+B.y*B.y),deltaScale=absB/absA;this._updateScaleFactor(deltaScale)},ImageModel.prototype._movePoint=function(point,to){return{x:point.x+to.x,y:point.y+to.y}},ImageModel.prototype._rotatePoint=function(point,angle){return{x:point.x*Math.cos(angle)-point.y*Math.sin(angle),y:point.x*Math.sin(angle)+point.y*Math.cos(angle)}},ImageModel.prototype.align=function(options){options&&options.useAngleStep&&(this.angle=Math.round(this.angle/this.settings.angleStep)*this.settings.angleStep);var guideUnscaled=this._unscale(this.guide),guideVertexes=[{x:-guideUnscaled.w/2,y:-guideUnscaled.h/2},{x:guideUnscaled.w/2,y:-guideUnscaled.h/2},{x:guideUnscaled.w/2,y:guideUnscaled.h/2},{x:-guideUnscaled.w/2,y:guideUnscaled.h/2}].map(function(vertex){return this._rotatePoint(vertex,-this.angle)}.bind(this)).map(function(vertex){return this._movePoint(vertex,this.midpoint)}.bind(this)),xSorted=guideVertexes.concat().sort(function(a,b){return a.x-b.x}),ySorted=guideVertexes.concat().sort(function(a,b){return a.y-b.y}),guideBoundingBox={x:xSorted[0].x,y:ySorted[0].y,w:xSorted[3].x-xSorted[0].x,h:ySorted[3].y-ySorted[0].y},deltaScale=Math.max(guideBoundingBox.w/this.image.w,guideBoundingBox.h/this.image.h);if(deltaScale>1)return this._updateScaleFactor(deltaScale),options&&options.deltaScale&&deltaScale===options.deltaScale?void(scope.ui.isNotMoreAction=!0):void this.align({deltaScale:deltaScale});var deltaMove={x:0,y:0};guideBoundingBox.x<0?deltaMove.x=-guideBoundingBox.x:guideBoundingBox.x+guideBoundingBox.w-this.image.w>0&&(deltaMove.x=-(guideBoundingBox.x+guideBoundingBox.w-this.image.w)),guideBoundingBox.y<0?deltaMove.y=-guideBoundingBox.y:guideBoundingBox.y+guideBoundingBox.h-this.image.h>0&&(deltaMove.y=-(guideBoundingBox.y+guideBoundingBox.h-this.image.h)),deltaMove=this._rotatePoint(deltaMove,this.angle),deltaMove.x*=this.scaleFactor,deltaMove.y*=this.scaleFactor,this.move({x:deltaMove.x,y:deltaMove.y},{x:0,y:0})},ImageModel.prototype.scaleBy=function(percent){this.scaleFactor*=1+percent},HTMLCanvasElement.prototype.toBlob||Object.defineProperty(HTMLCanvasElement.prototype,"toBlob",{value:function(callback,type,quality){for(var binStr=atob(this.toDataURL(type,quality).split(",")[1]),len=binStr.length,arr=new Uint8Array(len),i=0;i<len;i++)arr[i]=binStr.charCodeAt(i);callback(new Blob([arr],{type:type||"image/png"}))}});var mnemonic,watchers,model,img,guideFrame,canvas,dndDiv,slider,orderId=api.env("orderId")||null,startXSl=0,xSl=0,imagesLoaded=[];if(window.URL=window.URL||window.webkitURL,scope.$on("suspend",function(){watchers=scope.$$watchers,scope.$$watchers=[]}),scope.$on("resume",function(){scope.$$watchers=watchers,watchers=null}),scope.models={requestParams:["maxHeight","maxWidth","minHeight","minWidth","maxAspectRatio","minAspectRatio","maxFileSize","minFileSize","maxFileFinalSize","minFileFinalSize","mnemonic","pull","position","x1","y1","x2","y2","imgDivSizeWidth","imgDivSizeHeight"]},scope.isPhone=device.mobile(),scope.isTablet=device.tablet(),scope.isDesktop=device.desktop(),scope.ui.$dom=element,scope.ui.$imageEditorArea=element.find(".imageEditorArea"),scope.$sce=$sce,scope.$root=$rootScope,mnemonic=scope.item.mnemonic,scope.item.required&&api.find(scope.item.fullPath).setRequired(!0),scope.$watch("item.required",function(val,oldVal){void 0!==val&&val!==oldVal&&api.find(scope.item.fullPath).setRequired(val)}),window.FileReader&&scope.item.enableClientEdit){scope.item.checkDpi=!!scope.item.imgDPI,scope.ui.fileReaderMode=!0,scope.modalTmpl=TEMPLATES_PLAYER.MODAL_IMAGE_EDITOR;var $pageWrap=$("#page-wrap");scope.ui.$mainCnt=$pageWrap&&$pageWrap.length?$pageWrap:$("#epguWidget"),scope.ui.toggleModalVisible=function(visible,evt){scope.ui.totalFileSizeError=!1,scope.ui.clientEditError="",scope.isPhone&&scope.ui.$mainCnt.toggleClass("PGU-MainContent-Height-100",visible),$("body").toggleClass("PGU-SF-Dialog-Show",visible),scope.ui.modalShow=visible,scope.ui.initedPopup||(guideFrame=document.getElementById("guide_frame"),canvas=document.getElementById("canvas"),dndDiv=element.find(".PGU-ImageEditorDnDContainer"),new DnD(dndDiv[0],{drag:function(from,to){if(!scope.ui.isNotMoreAction){if(from.touches&&from.touches.length&&to.touches&&to.touches.length){model.multiTouch=!0;var beginCenter={x:(from.touches[0].x+from.touches[1].x)/2,y:(from.touches[0].y+from.touches[1].y)/2},endCenter={x:(to.touches[0].x+to.touches[1].x)/2,y:(to.touches[0].y+to.touches[1].y)/2},shift={x:endCenter.x-beginCenter.x,y:endCenter.y-beginCenter.y},begin={x:from.touches[0].x+shift.x,y:from.touches[0].y+shift.y},end={x:to.touches[0].x,y:to.touches[0].y},around={x:endCenter.x,y:endCenter.y};model.move({x:0,y:0},shift),model.rotate(begin,end,around),model.scale(begin,end,around)}else model.move(from,to);imageEditorProperties.updateElementsFromModel(model,imagesLoaded,dndDiv[0],null,scope.ui.additionalActions)}},dragend:function(){scope.ui.isNotMoreAction||(model.multiTouch?(model.align({useAngleStep:!0}),model.multiTouch=!1):model.align(),imageEditorProperties.updateElementsFromModel(model,imagesLoaded,dndDiv[0],canvas,scope.ui.additionalActions))}}),new DnD(dndDiv[0],{modifier:"alt",dragstart:function(){this._around=imageEditorProperties.getGlobalMidpoint(guideFrame)},drag:function(from,to){model.rotate(from,to,this._around),imageEditorProperties.updateElementsFromModel(model,imagesLoaded,dndDiv[0],null,scope.ui.additionalActions)},dragend:function(){model.align(),imageEditorProperties.updateElementsFromModel(model,imagesLoaded,dndDiv[0],canvas,scope.ui.additionalActions)}}),new DnD(dndDiv[0],{modifier:"shift",dragstart:function(){this._around=imageEditorProperties.getGlobalMidpoint(guideFrame)},drag:function(from,to){model.scale(from,to,this._around),imageEditorProperties.updateElementsFromModel(model,imagesLoaded,dndDiv[0],null,scope.ui.additionalActions)},dragend:function(){model.align(),imageEditorProperties.updateElementsFromModel(model,imagesLoaded,dndDiv[0],canvas,scope.ui.additionalActions)}}),scope.ui.sliderWidth=element.find(".PGU-ImageEditor-Slider").width(),scope.isDesktop&&(slider=element.find(".PGU-ImageEditor-Slider-Icon"),slider.on("mousedown",function(evt){evt.preventDefault(),startXSl=evt.pageX-xSl,$document.on("mousemove",scope.ui.mouseMoveSliderHandler),$document.on("mouseup",scope.ui.mouseUpSliderHandler)}),imageEditorProperties.addMouseWheel(dndDiv[0],function(evt){var percent,action,delta=evt.deltaY||evt.detail||evt.wheelDelta;delta<0?(action="plus",percent=.05):(action="minus",percent=-.05),scope.ui.start+=percent,scope.ui.start<0?scope.ui.start=0:scope.ui.start>=1&&(scope.ui.start=1),scope.ui.zoomImg(action,percent),evt.preventDefault()})),scope.createUploader(scope.item.fullPath+":upload",orderId),scope.ui.initedPopup=!0,$timeout(function(){scope._uploader.init()},400)),visible?$timeout(function(){scope._uploader.refresh()},400):(evt&&evt.preventDefault(),imageEditorProperties.setDefaultPopupSettings(scope.ui,scope.item.fullPath))},scope.ui.clientEdit=function(state,editorMethod,side){if(state&&!scope.ui.isNotMoreAction){var df=$q.defer();return"rotate"===editorMethod&&scope.ui.rotateImg(),"zoom"===editorMethod&&scope.ui.zoomImg(side),df.promise}}}scope.ui.rotateImg=function(){
if(model.rotateBy(imageEditorProperties.getDegree(scope.ui.imgRotateAngle)),model.align(),scope.ui.isNotMoreAction)return void model.rotateBy(imageEditorProperties.getDegree(-scope.ui.imgRotateAngle));imageEditorProperties.updateElementsFromModel(model,imagesLoaded,dndDiv[0],canvas,scope.ui.additionalActions)},scope.ui.saveClientImage=function(){scope.ui.btnSave.isLoad=!0;var mnemonicOld=scope.item.mnemonic;imageEditorProperties.clearModel(scope.item,["error"]),scope.ui.$imageEditorArea.empty(),scope.item.name,api.env("autosaveDisabled")||api.uploadDraft(!1,null,null,!1,"true"!==api.env("formParam").isSaveElDraft?null:scope.item),scope.ui.loading=!0,canvas.toBlob(function(blob){var startTime=(new Date).getTime();scope.sendFormData(scope._uploader.getOption("url"),blob,scope.item,scope.ui.fileName).then(function(data){var src;data.errorCode<2?(src=imageEditorProperties.createImagePath(data.mnemonic,orderId))&&(device&&window.webkit&&(device.android()?window.webkit.postMessage&&window.webkit.postMessage(src):device.ios()&&window.webkit.messageHandlers&&window.webkit.messageHandlers.callbackHandler&&window.webkit.messageHandlers.callbackHandler.postMessage&&window.webkit.messageHandlers.callbackHandler.postMessage(src)),scope.ui.renderImage(src,!0,canvas.toDataURL("image/jpeg",1)).then(function(){scope.ui.btnSave.isLoad=!1,scope.item.uploadedFileSize=blob.size,scope.item.value=data.fileName,scope.item.mimeType=blob.type,scope.item.size=blob.size.toString(),scope.item.pull=data.pull,scope.item.position=data.position,scope.item.mnemonic=data.mnemonic,scope.item.error="",scope.ui.loading=!1,scope.ui.toggleModalVisible(!1),mnemonicOld&&imageEditorProperties.removeRemoteFile(orderId,mnemonicOld),api.env("autosaveDisabled")||api.uploadDraft(!1,null,null,!1,"true"!==api.env("formParam").isSaveElDraft?null:scope.item),"true"===$rootScope.env.formParam.isLogElForm&&$rootScope.$emit("HEALTH_SEND",{event:"logElForm",timing:0,result:4,el:scope.item.fullPath,order_id:api.env("orderId")})})):(scope.updateState(imageEditorProperties.getClientUploadState({errorCode:data.errorCode,minFileSize:scope.item.minFileSize,maxFileSize:scope.item.maxFileSize,imgDPI:scope.item.imgDPI}),null,!0),scope.ui.btnSave.isLoad=!1),HealthSrv.checkHealthWhenDone({type:"imageEditor",startTime:startTime},data)},function(error){scope.updateState(imageEditorProperties.getClientUploadState({errorCode:"404"}),null,!0),scope.ui.btnSave.isLoad=!1,HealthSrv.checkHealthWhenError({type:"imageEditor",startTime:startTime},error)})},"image/jpeg",.85)},scope.ui.counter=0,scope.ui.zoomImg=function(operation,percent){var dynamicDelta;void 0!==percent&&(percent=percent<0?-1*percent:percent);var actionPercent=(model.maxScaleFactor-model.minScaleFactor)*(void 0!==percent?percent:scope.ui.imageZoom.deltaBtn),nextPercent=0;if(!scope.ui.isNotMoreAction&&operation){switch(operation){case"plus":nextPercent=model.scaleFactor+actionPercent,dynamicDelta=model.maxScaleFactor-nextPercent,dynamicDelta>=0?(scope.ui.counter++,dynamicDelta>=actionPercent?model.scaleFactor+=actionPercent:(scope.ui.counter=1/scope.ui.imageZoom.deltaBtn,model.scaleFactor=model.maxScaleFactor),scope.ui.updateSliderStyles(percent?100*scope.ui.start+"%":scope.ui.imageZoom.deltaBtn*scope.ui.counter*100+"%")):(scope.ui.counter=1/scope.ui.imageZoom.deltaBtn,model.scaleFactor=model.maxScaleFactor,scope.ui.updateSliderStyles(percent?100*scope.ui.start+"%":scope.ui.imageZoom.deltaBtn*scope.ui.counter*100+"%"));break;case"minus":nextPercent=model.scaleFactor-actionPercent,dynamicDelta=nextPercent-model.minScaleFactor,dynamicDelta>=0?(scope.ui.counter--,dynamicDelta>=actionPercent?model.scaleFactor-=actionPercent:(scope.ui.counter=0,model.scaleFactor=model.minScaleFactor),scope.ui.updateSliderStyles(percent?100*scope.ui.start+"%":scope.ui.imageZoom.deltaBtn*scope.ui.counter*100+"%")):(scope.ui.counter=0,model.scaleFactor=model.minScaleFactor,scope.ui.updateSliderStyles(percent?100*scope.ui.start+"%":scope.ui.imageZoom.deltaBtn*scope.ui.counter*100+"%"))}model.align(),imageEditorProperties.updateElementsFromModel(model,imagesLoaded,dndDiv[0],canvas,scope.ui.additionalActions)}},scope.item.checkImageSize=function(){return scope.ui.uploadEdit(!0,"resize")},scope.toggleDetails=function(isDetailsShow){scope.ui.isDetailsShow=isDetailsShow},scope.toggleDetailsDialog=function(){scope.ui.isDetailsDialogShow=!scope.ui.isDetailsDialogShow},$timeout(function(){scope.$emit(scope.item.fullPath+":ScopeApplied",{scope:scope,element:element}),scope.item.isScopeAppliedDone={scope:scope,element:element}}),scope.ui.uploadEdit=function(state,editorMethod,side){if(state){var df=$q.defer(),requestData={},self=this;for(var k in self.actions)self.actions.hasOwnProperty(k)&&(self.actions[k]=!1);return self.loading=!0,self.lastEditorMethod=editorMethod,self.imageCropEnabled=!1,self.imageCropActive=!1,self.selectedStart=!1,self.changeState(imageEditorProperties.setUploadState(!1)),requestData.data=imageEditorProperties.getRequestParams(scope.item,scope.models.requestParams),requestData.data.validate="1",requestData.data.editorMethod=editorMethod,"rotate"===editorMethod&&(requestData.data.rotate=side),sharedExtServices.imageEditor.uploadEdit(requestData,orderId).then(function(data){self.successEdit(scope.item,data),df.resolve()},function(xhrObj,status,errorCode){self.errorEdit(errorCode),df.reject()}),df.promise}},scope.ui.removeImage=function(file){if(this.actions.deleteImageEnabled){var removeFile=file||scope._uploader.files[0],mnemonic=scope.item.mnemonic;mnemonic&&sharedExtServices.imageEditor.removeImage(orderId,mnemonic,function(data){},function(error){}),imageEditorProperties.clearModel(scope.item),this.$imageEditorArea.empty(),this.changeState(imageEditorProperties.setUploadState({errorCode:0},this.lastEditorMethod,scope.item)),this.horizontalMargin=!1,this.verticalMargin=!1,scope._uploader.files.length&&scope._uploader.removeFile(removeFile),scope.item.error="",this.errorCode=0,this.actions.deleteImageEnabled=!1,this.stateShow=!1}},scope.ui.renderImage=function(src,clientEnable,objectUrl){var df=$q.defer(),self=this,naturalImgWidth=0,naturalImgHeight=0,imageEditorRatio=0,naturalImageRatio=0,image=new Image,$dom=self.$dom,btnText=self.changeBtnText;return image.onload=function(){var $img;naturalImgWidth=image.width,naturalImgHeight=image.height,imageEditorRatio=self.$imageEditorArea.width()/self.$imageEditorArea.height(),naturalImageRatio=naturalImgWidth/naturalImgHeight,naturalImageRatio<=imageEditorRatio?(self.horizontalMargin=!0,self.verticalMargin=!1):(self.horizontalMargin=!1,self.verticalMargin=!0),self.$imageEditorArea.find("img").imgAreaSelect({remove:!0}),self.$imageEditorArea.empty().append(image),scope.item.btnName=btnText,clientEnable||$(image).imgAreaSelect({aspectRatio:scope.item.isCustomSized?scope.item.containerWidthInMM+":"+scope.item.containerHeightInMM:"35:45",handles:!0,instance:!0,parent:$dom,onSelectStart:function(){self.selectedStart=!0},onSelectEnd:function(img,selection){scope.checkEnableCrop(selection),scope.item.y1=selection.y1,scope.item.x1=selection.x1,scope.item.x2=selection.x2,scope.item.y2=selection.y2}}),$img=self.$imageEditorArea.find("img"),scope.item.imgDivSizeWidth=$img.width(),scope.item.imgDivSizeHeight=$img.height(),objectUrl&&window.URL.revokeObjectURL(objectUrl),df.resolve()},image.src=objectUrl||src,df.promise},$rootScope.settings.mobOptimizeImageEditor||(scope.ui.toggleEnabledUploadBtn=function(isDisabled){var self=this;self.disabledUploadBtn=isDisabled,scope._uploader.disableBrowse(self.disabledUploadBtn)}),scope.ui.changeEnabledActions=function(actions,enabled){for(var self=this,i=0,il=actions.length;i<il;i++)self.actions.hasOwnProperty(actions[i])&&(self.actions[actions[i]]=enabled)},scope.ui.loadDraftImage=function(item){var self=this;self.loading=!0;var requestData={data:{validate:"1",maxHeight:item.maxHeight,maxWidth:item.maxWidth,minHeight:item.minHeight,minWidth:item.minWidth,maxAspectRatio:item.maxAspectRatio,minAspectRatio:item.minAspectRatio,maxFileSize:item.maxFileSize,minFileSize:item.minFileSize,mnemonic:item.mnemonic,checkDpi:item.checkDpi}};scope.item.isCustomSized?self.successEdit(scope.item,{mnemonic:item.mnemonic},!0):sharedExtServices.imageEditor.replaceImageOfDraft(requestData,orderId).then(function(data){self.successEdit(scope.item,data,!0)},function(){scope.updateState(imageEditorProperties.getClientUploadState({errorCode:"draftLoadError",localErrorCode:!0})),self.loading=!1})},scope.ui.changeState=function(stateResult){var actions=this.actions;if(stateResult.state){stateResult.removeImg&&this.removeImage();for(var k in actions)actions.hasOwnProperty(k)&&(stateResult.state.hasOwnProperty(k)?actions[k]=stateResult.state[k]:actions[k]=!1);scope.item.isValid=stateResult.isValid,scope.item.error=stateResult.errorMsg,this.errorCode=stateResult.errorCode,this.stateShow=!0}else scope.item.error="",this.stateShow=!1},scope.ui.loadDraftImageFromCanvas=function(src){var df=$q.defer();return sharedExtServices.imageEditor.getImageFromDraft({url:src}).then(function(data){var blob=new Blob([data],{type:"image/jpeg"}),objectUrl=window.URL.createObjectURL(blob);df.resolve(objectUrl)}),df.promise},scope.ui.successEdit=function(item,data,draft){var src,self=this,result="string"==typeof data?JSON.parse(data):data;item.mnemonic=result.mnemonic,item.position=result.position,item.pull=result.pull,src=imageEditorProperties.createImagePath(result.mnemonic,orderId),src?draft?scope.ui.loadDraftImageFromCanvas(src).then(function(objectUrl){self.renderImage(src,scope.item.enableClientEdit,objectUrl).then(function(data){self.changeState(imageEditorProperties.setUploadState(result,self.lastEditorMethod,scope.item)),self.loading=!1,api.env("imageEditorInitWithValue",!1),scope.item.stackDefer&&scope.item.stackDefer.resolve()})}):self.renderImage(src,scope.item.enableClientEdit).then(function(data){self.changeState(imageEditorProperties.setUploadState(result,self.lastEditorMethod,scope.item)),self.loading=!1,api.env("imageEditorInitWithValue",!1),scope.item.stackDefer&&scope.item.stackDefer.resolve()}):(self.changeState(imageEditorProperties.setUploadState(result,self.lastEditorMethod,scope.item)),self.loading=!1,draft&&(api.env("imageEditorInitWithValue",!1),scope.item.stackDefer&&scope.item.stackDefer.resolve()))},scope.ui.errorEdit=function(error){this.changeState(imageEditorProperties.setUploadState({errorCode:error,localErrorCode:!0},this.lastEditorMethod,scope.item)),this.loading=!1},scope.ui.colorImageToGray=function(){},scope.checkEnableCrop=function(selection){var self=this,requestData={data:{mnemonic:self.item.mnemonic,x1:selection.x1,x2:selection.x2,y1:selection.y1,y2:selection.y2,imgDivSizeWidth:self.item.imgDivSizeWidth||0,imgDivSizeHeight:self.item.imgDivSizeHeight||0}};self.item.maxPhotoHeightMM&&self.item.maxPhotoWidthMM&&(requestData.data.maxSidePhotoSize=self.item.maxPhotoHeightMM>=self.item.maxPhotoWidthMM?self.item.maxPhotoHeightMM:self.item.maxPhotoWidthMM,requestData.data.minSidePhotoSize=self.item.maxPhotoHeightMM<=self.item.maxPhotoWidthMM?self.item.maxPhotoHeightMM:self.item.maxPhotoWidthMM),sharedExtServices.imageEditor.checkForCrop(requestData,orderId).then(function(data){self.ui.actions.imageCropEnabled=data.canCropeImage,self.ui.imageCropActive=data.canCropeImage},function(error){self.ui.actions.imageCropEnabled=!0,self.ui.imageCropActive=!0})},scope.filesAddedCallback=function(){return scope.ui.fileReaderMode?function(data,files){scope.ui.isNotMoreAction=!1,scope.ui.totalFileSizeError=!1,data.permission?scope.handleFiles(files):scope.item.isCustomSized&&files[0].size&&files[0].size<scope.item.maxFileSize?scope.handleFiles(files):checkFileSizeAndShowError(files[0],!0)}:function(data,files){data.permission?(scope.item.pull="---",scope._uploader.settings.multipart_params={orderId:orderId,pull:scope.item.pull,position:1,x1:0,y1:0,x2:0,y2:0,validate:1,maxHeight:scope.item.maxHeight,maxWidth:scope.item.maxWidth,minHeight:scope.item.minHeight,minWidth:scope.item.minWidth,maxAspectRatio:scope.item.maxAspectRatio,minAspectRatio:scope.item.minAspectRatio,maxFileSize:scope.item.maxFileSize,minFileSize:scope.item.minFileSize},scope.item.isCustomSized&&(scope._uploader.settings.multipart_params.fileExt="jpg"),scope.item.maxPhotoHeightMM&&scope.item.maxPhotoWidthMM&&(scope._uploader.settings.multipart_params.maxSidePhotoSize=scope.item.maxPhotoHeightMM>=scope.item.maxPhotoWidthMM?scope.item.maxPhotoHeightMM:scope.item.maxPhotoWidthMM,scope._uploader.settings.multipart_params.minSidePhotoSize=scope.item.maxPhotoHeightMM<=scope.item.maxPhotoWidthMM?scope.item.maxPhotoHeightMM:scope.item.maxPhotoWidthMM),scope._uploader.start()):(scope.ui.toggleEnabledUploadBtn(!1),scope.ui.changeState(imageEditorProperties.setUploadState({errorCode:"checkTotalAmount",details:data.max+"&nbsp;Kb"},scope.ui.lastEditorMethod,scope.item)),scope.item.value="",scope.ui.loading=!1)}}(),scope.ui.start=0,scope.ui.mouseMoveSliderHandler=function(evt){evt.preventDefault();var oldXsl=xSl;xSl=evt.pageX-startXSl;var delta=(xSl-oldXsl)/scope.ui.sliderWidth;scope.ui.start+=delta,xSl!==oldXsl&&(scope.ui.start<0?scope.ui.start=0:scope.ui.start>=1&&(scope.ui.start=1),scope.ui.zoomImg(delta>=0?"plus":"minus",delta))},scope.ui.mouseUpSliderHandler=function(evt){$document.off("mousemove",scope.ui.mouseMoveSliderHandler),$document.off("mouseup",scope.ui.mouseUpSliderHandler)},scope.ui.tapHandler=function(evt){},scope.ui.clientHandleError=function(code){scope.ui.sizeError=IMAGE_EDITOR_ERRORS_MSG[15],scope.ui.modalState="info",scope.ui.fileState="",scope.ui.loading=!1,scope.ui.toggleEnabledUploadBtn(!1)},scope.updateState=function(state,file,setDefault){scope.ui.clientEditError=state.errorMsg,file&&imageEditorProperties.removeUploaderFile(scope._uploader,file),setDefault&&imageEditorProperties.setDefaultPopupSettings(scope.ui,scope.item.fullPath),api.applyScope(),$timeout(function(){scope._uploader&&scope._uploader.refresh()},400)},scope.handleFiles=function(files,isFileBlob){function allImagesLoaded(noCheckOrientation){var item,canvasDataUrl,imgFromCanvas;if(loadedImgCounter===imgLength)if(noCheckOrientation){for(var i=0,il=imagesLoaded.length;i<il;i++)item=imagesLoaded[i],item.className="PGU-ImageEditorImage",0===i?(dndDiv.height(item.height),dndDiv.width(item.width),item.className+=" PGU-ImageEditorImage-Opacity-2",element.find(".PGU-ImageEditorAreaInner").prepend(item)):element.find(".imageEditorAreaPopup").append(item),window.URL.revokeObjectURL(imagesLoaded[i].src);imageEditorProperties.updateElementsFromModel(model,imagesLoaded,dndDiv[0],canvas,scope.ui.additionalActions),scope.ui.loading=!1,scope.ui.updateProgressBar(100),scope.ui.showProgressBar=!1,scope.ui.fileState="uploaded",scope.ui.actions.imageRotateRightEnabled=!0,scope.ui.actions.imageZoomEnabled=!0,scope._uploader.removeFile(file),scope.$apply()}else imageEditorProperties.applyOrientation(imagesLoaded[0],function(canvasSrc){if(model=new ImageModel(canvasSrc?canvasSrc.width:imagesLoaded[0].width,canvasSrc?canvasSrc.height:imagesLoaded[0].height,{fitIn:!0,angleStep:Math.PI/2,imgDPI:scope.ui.imgDpi,canvasSrc:canvasSrc}),imageEditorProperties.updateImage(dndDiv[0],model),canvasSrc){imagesLoaded.forEach(function(item,ind){window.URL.revokeObjectURL(item.src)}),imagesLoaded=[],loadedImgCounter=0,canvasDataUrl=canvasSrc.toDataURL("image/jpeg",1);for(var j=0,jl=imgLength;j<jl;j++)imgFromCanvas=new Image,imgFromCanvas.onload=function(){return function(){loadedImgCounter++,imagesLoaded.push(this),allImagesLoaded(!0)}}(),imgFromCanvas.src=canvasDataUrl}else{for(var i=0,il=imagesLoaded.length;i<il;i++)item=imagesLoaded[i],item.className="PGU-ImageEditorImage",0===i?(dndDiv.height(item.height),dndDiv.width(item.width),item.className+=" PGU-ImageEditorImage-Opacity-2",element.find(".PGU-ImageEditorAreaInner").prepend(item)):element.find(".imageEditorAreaPopup").append(item),window.URL.revokeObjectURL(imagesLoaded[i].src);imageEditorProperties.updateElementsFromModel(model,imagesLoaded,dndDiv[0],canvas,scope.ui.additionalActions),scope.ui.loading=!1,scope.ui.updateProgressBar(100),scope.ui.showProgressBar=!1,scope.ui.fileState="uploaded",scope.ui.actions.imageRotateRightEnabled=!0,scope.ui.actions.imageZoomEnabled=!0,scope._uploader.removeFile(file),scope.$apply()}})}scope.ui.modalState="upload",api.applyScope(),scope.ui.updateProgressBar(10),element.find(".PGU-ImageEditorImage").each(function(ind,item){$(item).remove()}),imagesLoaded=[];var fileBlob,file=files[0];isFileBlob&&file.base64&&(fileBlob=scope.dataURItoBlob(file.base64),file.size=fileBlob.size,file.type=fileBlob.type),scope.ui.fileName=file.name;var objectUrl,fileNative,imageType=/^image\/(jpeg|png|bmp|x-bmp|x-ms-bmp)$/,imgLength=2,loadedImgCounter=0;if(!imageType.test(file.type))return void scope.updateState(imageEditorProperties.getClientUploadState({errorCode:"2"}),file,!0);if(!checkFileSizeAndShowError(file)){scope.ui.updateProgressBar(25),fileNative=fileBlob||file.getNative(),objectUrl=window.URL.createObjectURL(fileNative);for(var i=0,il=imgLength;i<il;i++)img=new Image,img.onload=function(){return function(){if(!(imageEditorProperties.getDPISize(this.height,scope.item.containerHeightInMM||45)>=scope.ui.imgDpi&&imageEditorProperties.getDPISize(this.width,scope.item.containerWidthInMM||35)>=scope.ui.imgDpi))return void scope.updateState(imageEditorProperties.getClientUploadState({errorCode:"17",imgDPI:scope.item.imgDPI}),file,!0);loadedImgCounter++,imagesLoaded.push(this),allImagesLoaded()}}(),img.src=objectUrl;$timeout(function(){scope._uploader.refresh()},400)}},scope.createUploader=function(browse_button,orderId){scope._uploader=new plupload.Uploader({runtimes:"html5, html4, flash",browse_button:browse_button,url:LOC.WIDGET_URI+"api/sf/v1/player/ie/"+orderId+"/upload",flash_swf_url:LOC.WIDGET_URI+"htdocs/common/js/lib/plupload/plupload.flash.swf",headers:{},filters:{mime_types:[{title:"Image files",extensions:"jpg,jpeg,bmp,png"}]},required_features:"send_browser_cookies",file_data_name:"uploadFile",multipart_params:{},multi_selection:!1,init:{Init:function(){scope.checkSpecificSmuConditions()},FileFiltered:function(up,files){},FilesAdded:function(up,files){$rootScope.settings.mobOptimizeImageEditor||scope.ui.toggleEnabledUploadBtn(!0),scope.ui.showProgressBar=!0,api.checkTotalAmount(files[0].size).done(function(data){"true"===$rootScope.env.formParam.isLogElForm&&$rootScope.$emit("HEALTH_SEND",{event:"logElForm",timing:0,result:3,el:scope.item.fullPath,order_id:api.env("orderId")}),scope.filesAddedCallback(data,files),scope.$apply()})},FileUploaded:function(up,file,data){var objData=JSON.parse(data.response||{});if(scope.ui.changeState(imageEditorProperties.setUploadState(objData,scope.ui.lastEditorMethod,scope.item)),(objData.errorCode<2||objData.errorCode>4)&&14!==objData.errorCode){var src,activeActions=["imageRotateLeftEnabled","imageRotateRightEnabled","brightUp","brightDown","deleteImageEnabled"],disabledActions=["previousImageEnabled","redo"];src=imageEditorProperties.createImagePath(objData.mnemonic,orderId),src&&scope.ui.renderImage(src).then(function(){scope.item.uploadedFileSize=file.size,scope.item.value=file.name,scope.item.mimeType=imageEditorProperties.getFileExtension(file.name),scope.item.size=file.size.toString(),scope.item.pull=objData.pull,scope.item.position=objData.position,scope.item.mnemonic=objData.mnemonic,scope.ui.changeEnabledActions(activeActions,!0),scope.ui.changeEnabledActions(disabledActions,!1),$rootScope.settings.mobOptimizeImageEditor||scope.ui.toggleEnabledUploadBtn(!1),scope.ui.loading=!1})}else $rootScope.settings.mobOptimizeImageEditor||scope.ui.toggleEnabledUploadBtn(!1),scope.ui.loading=!1},Error:function(up,err){if(scope.item.error="",$rootScope.settings.mobOptimizeImageEditor||scope.ui.toggleEnabledUploadBtn(!1),"-600"===err.code)scope.item.error=err.file.name+" "+err.message+" "+scope.item.fileSize+" Kb.",scope.item.value="";else if(-601===err.code){if(scope.ui.fileReaderMode)return void scope.updateState(imageEditorProperties.getClientUploadState({errorCode:"2"}),err.file,!0)}else scope.ui.removeImage(),413===err.status?scope.item.error=IMAGE_EDITOR_ERRORS_MSG[15]:scope.item.error=err.message;scope.ui.stateShow=!0,scope.ui.loading=!1,scope.$apply()}}})},scope.filesAddedCallbackSMU=function(isUploadImmediately){return isUploadImmediately?function(data){try{var parseData=data;if("string"==typeof parseData&&(parseData=JSON.parse(data)),scope.smu={},scope.smu.files=parseData.files,scope.smu.files&&scope.smu.files.length){var orderId=api.env("orderId")||null,blob=scope.dataURItoBlob(scope.smu.files[0].base64);blob.name=scope.smu.files[0].name,$rootScope.settings.mobOptimizeImageEditor||scope.ui.toggleEnabledUploadBtn(!0),scope.ui.loading=!0,api.checkTotalAmount(blob.size).done(function(data){if(data.permission){scope.item.pull="---";var fd=new FormData;fd.append("name",blob.name),fd.append("orderId",orderId),fd.append("pull",scope.item.pull),fd.append("position","1"),fd.append("x1","0"),fd.append("y1","0"),fd.append("x2","0"),fd.append("y2","0"),fd.append("validate","1"),fd.append("maxHeight",scope.item.maxHeight),fd.append("maxWidth",scope.item.maxWidth),fd.append("minHeight",scope.item.minHeight),fd.append("minWidth",scope.item.minWidth),fd.append("maxAspectRatio",scope.item.maxAspectRatio),fd.append("minAspectRatio",scope.item.minAspectRatio),fd.append("maxFileSize",scope.item.maxFileSize),fd.append("minFileSize",scope.item.minFileSize),fd.append("uploadFile",blob),scope.item.isCustomSized&&fd.append("fileExt","jpg"),scope.item.maxPhotoHeightMM&&scope.item.maxPhotoWidthMM&&(fd.append("maxSidePhotoSize",scope.item.maxPhotoHeightMM>=scope.item.maxPhotoWidthMM?scope.item.maxPhotoHeightMM:scope.item.maxPhotoWidthMM),fd.append("minSidePhotoSize",scope.item.maxPhotoHeightMM<=scope.item.maxPhotoWidthMM?scope.item.maxPhotoHeightMM:scope.item.maxPhotoWidthMM));var xhr=new XMLHttpRequest;xhr.open("POST",scope._uploader.getOption("url")),xhr.withCredentials=!0,xhr.onloadend=function(evt){if(200==xhr.status){try{var objData=JSON.parse(evt.currentTarget.response);if(scope.ui.changeState(imageEditorProperties.setUploadState(objData,scope.ui.lastEditorMethod,scope.item)),(objData.errorCode<2||objData.errorCode>4)&&14!==objData.errorCode){var src,activeActions=["imageRotateLeftEnabled","imageRotateRightEnabled","brightUp","brightDown","deleteImageEnabled"],disabledActions=["previousImageEnabled","redo"];src=imageEditorProperties.createImagePath(objData.mnemonic,orderId),src&&scope.ui.renderImage(src).then(function(){scope.item.uploadedFileSize=blob.size,scope.item.value=blob.name,scope.item.mimeType=imageEditorProperties.getFileExtension(blob.name),scope.item.size=blob.size.toString(),scope.item.pull=objData.pull,scope.item.position=objData.position,scope.item.mnemonic=objData.mnemonic,scope.ui.changeEnabledActions(activeActions,!0),scope.ui.changeEnabledActions(disabledActions,!1),$rootScope.settings.mobOptimizeImageEditor||scope.ui.toggleEnabledUploadBtn(!1),scope.ui.loading=!1})}else $rootScope.settings.mobOptimizeImageEditor||scope.ui.toggleEnabledUploadBtn(!1),scope.ui.loading=!1,scope.$apply()}catch(e){}scope.$apply()}else scope.item.error="",scope.ui.toggleEnabledUploadBtn(!1),scope.ui.stateShow=!0,scope.ui.loading=!1,scope.$apply()},xhr.send(fd)}else scope.ui.toggleEnabledUploadBtn(!1),scope.ui.changeState(imageEditorProperties.setUploadState({errorCode:"checkTotalAmount",details:data.max+"&nbsp;Kb"},scope.ui.lastEditorMethod,scope.item)),scope.item.value="",scope.ui.loading=!1;scope.$apply()})}}catch(e){}}:function(data){var parseData=data;try{"string"==typeof parseData&&(parseData=JSON.parse(data)),parseData.files&&parseData.files.length&&scope.handleFiles(parseData.files,!0)}catch(e){}}}(!scope.ui.fileReaderMode),scope.checkSpecificSmuConditions=function(isUploadImmediately){var wp=device.windowsPhone(),notifySMU=api.env("notifySMU"),needSmu=window.needUseAttacheSmuAdapter||wp;if(notifySMU&&needSmu){var browse_button_input=scope.ui.$dom.find('input[type="file"]')[0];plupload.addEvent(browse_button_input,"click",function(e){var smuObj={eventType:"fileUpload",eventParams:[{key:"full_path",value:scope.item.fullPath},{key:"input_id",value:this.id},{key:"multi_selection",value:!1},{key:"file_type",value:scope.item.fileType},{key:"min_size",value:1024*scope.item.minFileSize},{key:"max_size",value:1024*scope.item.maxFileSize}]};notifySMU&&notifySMU(smuObj)}),window.PGU=PGU,PGU.Events.subscribe(scope.item.fullPath,"filesAdded",function(evt,data){scope.filesAddedCallbackSMU(data)})}},scope.ui.updateProgressBar=function(percent){scope.ui.progressBarPercent=percent+"%"},scope.ui.updateSliderStyles=function(percent){slider&&slider.css({left:percent})},scope.dataURItoBlob=function(dataURI){var byteString;byteString=dataURI.split(",")[0].indexOf("base64")>=0?atob(dataURI.split(",")[1]):unescape(dataURI.split(",")[1]);for(var mimeString=dataURI.split(",")[0].split(":")[1].split(";")[0],ia=new Uint8Array(byteString.length),i=0;i<byteString.length;i++)ia[i]=byteString.charCodeAt(i);return new Blob([ia],{type:mimeString})},scope.sendFormData=function(url,blob,item,name){var df=$q.defer(),fd=new FormData;fd.append("name",name||blob.name),fd.append("orderId",orderId),fd.append("pull","---"),fd.append("position","1"),fd.append("x1","0"),fd.append("y1","0"),fd.append("x2","0"),fd.append("y2","0"),fd.append("validate","1"),fd.append("maxHeight",item.maxHeight),fd.append("maxWidth",item.maxWidth),fd.append("minHeight",item.minHeight),fd.append("minWidth",item.minWidth),fd.append("maxAspectRatio",item.maxAspectRatio),fd.append("minAspectRatio",item.minAspectRatio),fd.append("maxFileSize",item.maxFileSize),fd.append("minFileSize",item.minFileSize),fd.append("minFileFinalSize",item.minFileFinalSize),fd.append("maxFileFinalSize",item.maxFileFinalSize),fd.append("checkDpi",item.checkDpi),fd.append("uploadFile",blob,name),item.isCustomSized&&fd.append("fileExt","jpg"),item.maxPhotoHeightMM&&item.maxPhotoWidthMM&&(fd.append("maxSidePhotoSize",item.maxPhotoHeightMM>=item.maxPhotoWidthMM?item.maxPhotoHeightMM:item.maxPhotoWidthMM),fd.append("minSidePhotoSize",item.maxPhotoHeightMM<=item.maxPhotoWidthMM?item.maxPhotoHeightMM:item.maxPhotoWidthMM));var xhr=new XMLHttpRequest;return xhr.open("POST",url),xhr.withCredentials=!0,$rootScope.inOpWidget&&$rootScope.settings.sessionToken&&xhr.setRequestHeader("Authorization","bearer "+$rootScope.settings.sessionToken),xhr.onloadend=function(evt){if(200==xhr.status)try{var objData=JSON.parse(evt.currentTarget.response);df.resolve(objData)}catch(e){df.reject()}else df.reject()},xhr.send(fd),df.promise};scope.item.stackDefer;scope.item.getImEdPromise=function(df){scope.item.stackDefer=df},mnemonic&&api.env("imageEditorInitWithValue",scope.item.fullPath),$rootScope.isDesigner||$timeout(function(){scope.ui.fileReaderMode||(scope.createUploader(scope.item.fullPath+":upload",orderId),scope._uploader.init()),mnemonic?(scope.ui.loading=!0,scope.ui.toggleBtnLabel(),scope.ui.loadDraftImage(scope.item)):(api.env("imageEditorInitWithValue",!1),scope.item.stackDefer&&scope.item.stackDefer.resolve())})}}}]).factory("ImageEditorExt",["fieldAttrs","FieldUploadExt","Validators","$q",function(fieldAttrs,FieldUploadExt,Validators,$q){return{attrs:angular.extend({},fieldAttrs.attrs,FieldUploadExt.attrs,{html:{},value:{type:"string",default:"",humanity:"значение","scope:sync":!0},allDescription:{},pull:{type:"string",default:"---","scope:editor":!1,"scope:sync":!1},position:{type:"string",default:"1","scope:editor":!1,"scope:sync":!1},maxWidth:{type:"integer",default:3099,"scope:editor":!1,"scope:sync":!1},minWidth:{type:"integer",default:248,"scope:editor":!1,"scope:sync":!1},maxHeight:{type:"integer",default:3984,"scope:editor":!1,"scope:sync":!1},minHeight:{type:"integer",default:319,"scope:editor":!1,"scope:sync":!1},maxAspectRatio:{type:"string",default:"1.5","scope:editor":!1,"scope:sync":!1},minAspectRatio:{type:"string",default:"1.1","scope:editor":!1,"scope:sync":!1},x1:{type:"integer",default:0,"scope:editor":!1,"scope:sync":!1},x2:{type:"integer",default:0,"scope:editor":!1,"scope:sync":!1},y1:{type:"integer",default:0,"scope:editor":!1,"scope:sync":!1},y2:{type:"integer",default:0,"scope:editor":!1,"scope:sync":!1},mnemonic:{type:"string",default:"","scope:editor":!1,"scope:sync":!0},maxFileSize:{type:"integer",default:5242880,"scope:editor":!0,"scope:sync":!1},minFileSize:{type:"integer",default:204800,"scope:editor":!0,"scope:sync":!1},maxFileFinalSize:{type:"integer",default:512e3,"scope:editor":!0,"scope:sync":!1},minFileFinalSize:{type:"integer",default:204800,"scope:editor":!0,"scope:sync":!1},rotateLeftButton:{default:"Повернуть по часовой"},rotateRightButton:{default:"Повернуть против часовой"},cropButton:{default:"Обрезать фотографию"},cancelButton:{default:"Отменить последнее действие"},repeatButton:{default:"Повторить"},redEyesButton:{default:"Красные глаза"},brightUpButton:{default:"Яркость больше"},brightDownButton:{default:"Яркость меньше"},deleteButton:{default:"Удалить загруженную фотографию"},instructions:{default:"<p>Для изменения ориентации фотографии используйте кнопки «Повернуть по часовой», «Повернуть против часовой».</p><p>Для кадрирования большой фотографии до нужных размеров выделите мышью подходящую область и нажмите кнопку «Обрезать фотографию».</p><p>При выполнении вышеуказанных требований к формату файла фотографии будет доступен заказ услуги.</p>"},validators:{default:[],"scope:editor":!1},fileType:{type:"string",default:"","scope:editor":!1},imageEditorError:{type:"boolean",default:!1,"scope:editor":!1},externalLoader:{default:{file:{}},"scope:editor":!1,"scope:model":!0},btnLoadAgain:{type:"string",default:"Загрузить новое фото"},btnName:{type:"string",default:"Загрузить фотографию"},descrTitle:{type:"string",default:"Требования к фотографии"},gender:{type:"boolean",default:!0},disabledUploadBtn:{type:"boolean",default:!1,"scope:editor":!1},maxPhotoHeightMM:{type:"integer",default:0,"scope:editor":!0},maxPhotoWidthMM:{type:"integer",default:0,"scope:editor":!0},imgDivSizeWidth:{type:"integer",default:0,"scope:editor":!1},imgDivSizeHeight:{type:"integer",default:0,"scope:editor":!1},businessName:{type:"string",default:"","scope:editor":!1,"scope:sync":!1},enableClientEdit:{type:"boolean",default:!1},imgDPI:{type:"integer",default:0},lineYCoordinates:{type:"string",default:"16|195|217"},textMatrix:{type:"string",default:"(1 0 0 1 196.6665 10.8333)|(1 0 0 1 196.6664 25.2333)|(1 0 0 1 196.6665 173.3333)|(1 0 0 1 196.6664 187.7333)"},lineText1:{type:"string",default:"Голова не должна быть|выше этой линии"},lineText2:{type:"string",default:"Подбородок должен быть|между двумя линиями"},lineText3:{type:"string",default:""},lineText1Phone:{type:"string",default:"Верх|головы"},lineText2Phone:{type:"string",default:"Низ|головы"},lineText3Phone:{type:"string",default:""}})}}]).factory("imageEditorProperties",["$rootScope","$q","api","sharedExtServices","LOC","IMAGE_EDITOR_ERRORS_MSG",function($rootScope,$q,api,sharedExtServices,LOC,IMAGE_EDITOR_ERRORS_MSG){var healthArrCodes=["3","4","404","draftLoadError"];return{getFileExtension:function(fileName){var regexp=/\.[0-9a-z]+$/i,extension=fileName.match(regexp),result="application/octet-stream";return extension&&extension.length&&(result=mOxie.Mime.mimes[fileName.match(regexp)[0].substring(1)]||"application/octet-stream"),result},createImagePath:function(mnemonic,orderId){var src;return mnemonic&&(src=LOC.WIDGET_URI+"api/storage/v1/files/"+orderId+"/2/"+mnemonic+"/download"),src},setUploadState:function(state,lastEditorMethod,item){var errorMessages=IMAGE_EDITOR_ERRORS_MSG,removeImg=!1,stateCode=state.errorCode||0,stateMsg=state.errorMessage;return state?(0!==stateCode?(!1,state.localErrorCode?state.details?errorMessages[stateCode]+state.details:stateMsg||errorMessages[stateCode]:(14===stateCode&&(removeImg=!0),
19==stateCode&&window.yaCounter9722908&&window.yaCounter9722908.reachGoal("FMS_photo_toobig"),11==stateCode&&window.yaCounter9722908&&window.yaCounter9722908.reachGoal("FMS_photo_toosmall"),errorMessages[stateCode]&&14!==stateCode?errorMessages[stateCode]:stateMsg||errorMessages.default),10!==stateCode||"rotate"!==lastEditorMethod&&"previousImage"!==lastEditorMethod||(state.imageRotateLeftEnabled=!0,state.imageRotateRightEnabled=!0,state.deleteImageEnabled=!0)):(!1,errorMessages[stateCode],item.value&&item.mnemonic&&(state.imageRotateLeftEnabled=!0,state.imageRotateRightEnabled=!0,state.deleteImageEnabled=!0)),state.imageCropEnabled=!1,-1!==healthArrCodes.indexOf(stateCode)&&$rootScope.$emit("HEALTH_SEND",{event:"uploadPhoto",ServerError:stateCode}),{isValid:!0,state:state,errorMsg:"",errorCode:"",stateShow:!0,removeImg:removeImg}):{error:"",stateShow:!1}},setDefaultPopupSettings:function(obj,fullPath){obj.modalState="info",obj.fileState="",obj.toggleBtnLabel(),obj.loading=!1,obj.updateProgressBar(0),obj.counter=0,obj.updateSliderStyles(0),obj.showProgressBar=!1,obj.isNotMoreAction=!1,$rootScope.settings.mobOptimizeImageEditor||obj.toggleEnabledUploadBtn(!1),obj.isDetailsDialogShow=!1,api.scrollTo(fullPath,"",-60)},removeRemoteFile:function(orderId,mnemonic){sharedExtServices.imageEditor.removeImage(orderId,mnemonic,function(data){},function(error){})},removeUploaderFile:function(uploader,file){uploader&&uploader.files&&uploader.files.length&&file&&uploader.removeFile(file)},getClientUploadState:function(state){var result,stateCode,stateMsg,errorMessages=IMAGE_EDITOR_ERRORS_MSG,errorMsg="",removeImg=!1,isValid=!0;return state?(stateCode=state.errorCode||0,stateMsg=state.errorMessage,0!==stateCode&&(14==stateCode||15==stateCode?(state.details="Загрузите фотографию размером",state.minFileSize&&(state.details+=" от&nbsp;"+this.humanReadableFileSize(state.minFileSize)),state.maxFileSize&&(state.details+=" до "+this.humanReadableFileSize(state.maxFileSize)),state.details+=".",state.localErrorCode=!0):17==stateCode&&(state.imgDPI&&(state.details=state.imgDPI+"&nbsp;DPI (точек на&nbsp;дюйм)."),state.localErrorCode=!0),isValid=!1,15==stateCode&&window.yaCounter9722908&&window.yaCounter9722908.reachGoal("FMS_photo_toobig"),11==stateCode&&window.yaCounter9722908&&window.yaCounter9722908.reachGoal("FMS_photo_toosmall"),state.localErrorCode?errorMsg=state.details?errorMessages[stateCode]+" "+state.details:stateMsg||errorMessages[stateCode]:(14==stateCode&&(removeImg=!0),errorMsg=errorMessages[stateCode]&&14!=stateCode?errorMessages[stateCode]:stateMsg||errorMessages.default)),result={isValid:isValid,state:state,errorMsg:errorMsg,errorCode:stateCode,removeImg:removeImg},-1!==healthArrCodes.indexOf(stateCode)&&$rootScope.$emit("HEALTH_SEND",{event:"uploadPhoto",ServerError:stateCode})):result={errorCode:0,errorMsg:"",isValid:isValid},result},clearModel:function(item,skipAttributes){for(var attrs=item.attrs,attributes=["value","mnemonic","size","mimeType","pull","uploadedFileSize","btnName","error"],i=0,il=attributes.length;i<il;i++)(!skipAttributes||skipAttributes.indexOf(attributes[i])<0)&&(item[attributes[i]]=attrs[attributes[i]].default)},getRequestParams:function(item,params){for(var attr,result={},i=0,il=params.length;i<il;i++)attr=params[i],item.hasOwnProperty(attr)&&(result[attr]=item[attr]);return result},getDegree:function(angle){return angle*Math.PI/180},getDPISize:function(imgSideSizePx,maxSidePhotoSizeMM){return Math.ceil(imgSideSizePx/(maxSidePhotoSizeMM/25.4))},updateImage:function(image,model){image.style.webkitTransformOrigin=model.guide.w/2+"px "+model.guide.h/2+"px",image.style.transformOrigin=model.guide.w/2+"px "+model.guide.h/2+"px",image.style.webkitTransform="scale("+model.scaleFactor+") rotate("+model.angle+"rad) translate("+(model.guide.w/2-model.midpoint.x)+"px, "+(model.guide.h/2-model.midpoint.y)+"px)",image.style.transform="scale("+model.scaleFactor+") rotate("+model.angle+"rad) translate("+(model.guide.w/2-model.midpoint.x)+"px, "+(model.guide.h/2-model.midpoint.y)+"px)"},updateCanvas:function(img,canvas,model,additionalActions){canvas.width=model.guide.w/model.scaleFactor,canvas.height=model.guide.h/model.scaleFactor;var ctx=canvas.getContext("2d"),source=model.canvasSrc||img;ctx.setTransform(1,0,0,1,model.guide.w/(2*model.scaleFactor)-model.midpoint.x,model.guide.h/(2*model.scaleFactor)-model.midpoint.y),ctx.translate(model.midpoint.x,model.midpoint.y),ctx.rotate(model.angle),ctx.translate(-model.midpoint.x,-model.midpoint.y),ctx.drawImage(source,0,0,model.image.w,model.image.h,0,0,model.image.w,model.image.h),additionalActions&&(additionalActions.needColorToGray?this.colorToGray(img,canvas,model,additionalActions.resize):additionalActions.resize&&additionalActions.resize.needed&&this.resizeImage(img,canvas,model,{width:additionalActions.resize.width,height:additionalActions.resize.height}))},colorToGray:function(img,canvas,model,resize){var ctx=canvas.getContext("2d");ctx.drawImage(img,0,0,model.image.w,model.image.h,0,0,model.image.w,model.image.h);for(var imageData=ctx.getImageData(0,0,canvas.width,canvas.height),pix=imageData.data,i=0,dLength=pix.length;i<dLength;i+=4){var r=pix[i],g=pix[i+1],b=pix[i+2],v=.2126*r+.7152*g+.0722*b;pix[i]=pix[i+1]=pix[i+2]=v}ctx.putImageData(imageData,0,0);var pic=new Image;pic.src=canvas.toDataURL("image/jpeg",1),ctx.drawImage(pic,0,0),resize.needed&&this.resizeImage(pic,canvas,model,{width:resize.width,height:resize.height})},resizeImage:function(img,canvas,model,sizes){img.onload=function(){var ctx=canvas.getContext("2d");canvas.width=sizes.width,canvas.height=sizes.height,ctx.drawImage(img,0,0,sizes.width,sizes.height)}},updateElementsFromModel:function(model,images,dnd,canvas,additionalActions){this.updateImage(dnd,model);for(var i=0,il=images.length;i<il;i++)this.updateImage(images[i],model);canvas&&this.updateCanvas(images[0],canvas,model,additionalActions)},getGlobalMidpoint:function(guideFrame){var guideRect=guideFrame.getBoundingClientRect();return{x:window.pageXOffset+guideRect.left+5+95,y:window.pageYOffset+guideRect.top+5+122}},addMouseWheel:function(elem,handler){elem.addEventListener&&("onwheel"in document?elem.addEventListener("wheel",handler):"onmousewheel"in document&&elem.addEventListener("onmousewheel",handler))},humanReadableFileSize:function(size,si){var thresh=si?1e3:1024;if(Math.abs(size)<thresh)return size+"&nbsp;б";var units=["Кб","Мб","Гб","Тб","PB","EB","ZB","YB"],u=-1;do{size/=thresh,++u}while(Math.abs(size)>=thresh&&u<units.length-1);return(size.toFixed(1)%1>0?size.toFixed(1):size)+"&nbsp;"+units[u]},applyOrientation:function(img,callback){var canvas=document.createElement("canvas"),ctx=canvas.getContext("2d");EXIF.getData(img,function(){var orientation=EXIF.getTag(img,"Orientation"),w=img.width,h=img.height,needCanvas=!0;if(orientation){switch(orientation){case 1:canvas.width=w,canvas.height=h,needCanvas=!1;break;case 2:canvas.width=w,canvas.height=h,ctx.translate(w,0),ctx.scale(-1,1);break;case 3:canvas.width=w,canvas.height=h,ctx.translate(w,h),ctx.rotate(Math.PI);break;case 4:canvas.width=w,canvas.height=h,ctx.translate(0,h),ctx.scale(1,-1);break;case 5:canvas.width=h,canvas.height=w,ctx.rotate(.5*Math.PI),ctx.scale(1,-1);break;case 6:canvas.width=h,canvas.height=w,ctx.rotate(.5*Math.PI),ctx.translate(0,-h);break;case 7:canvas.width=h,canvas.height=w,ctx.rotate(.5*Math.PI),ctx.translate(w,-h),ctx.scale(-1,1);break;case 8:canvas.width=h,canvas.height=w,ctx.rotate(-.5*Math.PI),ctx.translate(-w,0);break;default:needCanvas=!1}needCanvas?(ctx.drawImage(img,0,0),callback(canvas)):callback()}else callback()})},createCustomLinesText:function(item,isPhone){for(var matrix=item.textMatrix.split("|"),allTextParts="",result=[],j=1;j<4;j++)allTextParts+=isPhone?item["lineText"+j+"Phone"]?item["lineText"+j+"Phone"]+"|":"":item["lineText"+j]+"|";var allTextPartsArr=allTextParts.split("|"),text="";return matrix.forEach(function(matrixItem,i){text=allTextPartsArr[i]||"",matrixItem&&text&&result.push({matrix:matrixItem,text:text})}),result},createCustomLinesData:function(item){var customLines=item.lineYCoordinates;return customLines.split("|").map(function(line,i){return{y:line,yD:parseInt(line,10)+1}})}}}]),angular.module("serverFormWidgets.general").directive("epguFieldInn",["TEMPLATES","$rootScope","pguSaveDataEsiaSrvc","PGU","$timeout","api",function(TEMPLATES,$rootScope,pguSaveDataEsiaSrvc,PGU,$timeout,api){return{templateUrl:TEMPLATES.FIELD_INN,replace:!0,scope:{item:"="},link:function(scope,element,attrs){var esiaValue=!1;PGU.Events.subscribe("","FinishedLoading",function(){esiaValue=!!scope.item.value}),scope.$emit(scope.item.fullPath+":ScopeApplied",{scope:scope,element:element}),$rootScope.$on(scope.item.fullPath+":blur",function(){scope.item.saveDataESIA()}),scope.item.saveDataESIA=function(){scope.item.value&&pguSaveDataEsiaSrvc.save("inn",{inn:scope.item.value},scope.item.fullPath,scope.item.validators||[],esiaValue)},scope.$watch("item.value",function(val,oldVal){void 0!==val&&val!==oldVal&&api.find(scope.item.fullPath).afterSetValue(val,oldVal)});var watchers;scope.$on("suspend",function(){watchers=scope.$$watchers,scope.$$watchers=[]}),scope.$on("resume",function(){scope.$$watchers=watchers,watchers=null}),scope.$root=$rootScope}}}]).factory("FieldInnExt",["$rootScope","fieldAttrs",function($rootScope,fieldAttrs){return{attrs:angular.extend({},fieldAttrs.attrs,{strategy:{type:"string",default:"",enum:$rootScope.editor&&[""].concat($rootScope.strategyKeys),enumOptions:$rootScope.editor&&$.extend({"":""},$rootScope.strategyHash)},immutable:{type:"boolean",default:!0,humanity:"неизменяемое","scope:editor":!1}})}}]),angular.module("serverFormWidgets.general").directive("epguAutomotiveAxles",["TEMPLATES","api","apiInner","$rootScope","$timeout","AutomotiveAxlesSrv",function(TEMPLATES,api,apiInner,$rootScope,$timeout,AutomotiveAxlesSrv){return{templateUrl:TEMPLATES.AUTOMOTIVE_AXLES,replace:!0,scope:{item:"="},link:function(scope,element,attrs){function initAxles(){var countAxles=2;countAxles=isNaN(countAxles)?2:countAxles;var draftData=scope.item.draftData?JSON.parse(scope.item.draftData):[];scope.item.axlesList=draftData||[];var params=_.extend({},checkBoxParams);if(scope.item.need1Wheel&&checkBoxesRequired.push("oneWheel"),scope.item.need2Wheel&&checkBoxesRequired.push("twoWheel"),scope.item.need8Wheel&&checkBoxesRequired.push("moreWheel"),!draftData.length)for(var i=0,il=countAxles;i<il;i++)params.itemIndex=i,params.listLength=countAxles,params.isTruckAxle=!!(i>0&&i<2),scope.item.axlesList.push(AutomotiveAxlesSrv.createAxle(params));scope.truckList=AutomotiveAxlesSrv.getTruckList(scope.item.axlesList),scope.trailerList=AutomotiveAxlesSrv.getTrailerList(scope.item.axlesList),scope.updateLists(scope.truckList,!1,"Truck"),scope.updateLists(scope.item.axlesList,!0),scope.updateLists(scope.trailerList,!1,"Trailer"),scope.firstSemiTrailer=AutomotiveAxlesSrv.checkFirstTrailerType(scope.trailerList),AutomotiveAxlesSrv.setFirstAxleInTruckList(scope.truckList,scope.firstSemiTrailer),scope.distanceAxleList=scope.item.axlesList,scope.truckListArrows=!1,scope.truckTrailerArrows=!1,scope.truckDistanceArrows=!0,scope.cabListActiveItem=scope.item.axlesList[0],scope.truckListActiveItem=scope.truckList[0],scope.trailerListActiveItem=scope.trailerList.length?scope.trailerList[0]:null,scope.distanceListActiveItem=scope.item.axlesList[1],scope.distanceActiveItem=scope.item.axlesList[0],scope.truckListActiveItem.wheelType||(scope.truckListActiveItem.wheelType="1")}function createAxle(number,countAxles){return{id:number,number:number,humanityNumber:getHumanity(number),last:number==countAxles,infoVisible:!0,load:"",loadIsSmall:!1,distance:"",distanceIsSmall:!1,oneWheel:0,twoWheel:0,moreWheel:0,error:[],need1Wheel:need1Wheel,need2Wheel:need2Wheel,need8Wheel:need8Wheel,isDistanceAxleActiveRight:!0,onClick_Humanity:function(){this.infoVisible=!this.infoVisible},onClick_countWheel:function(count){switch(count){case 1:this.oneWheel=0==this.oneWheel?1:0;break;case 2:this.twoWheel=0==this.twoWheel?1:0;break;case 8:this.moreWheel=0==this.moreWheel?1:0}},onFocus_load:function(){this.loadIsSmall=!0},onBlur_load:function(){this.loadIsSmall=!1},onFocus_distance:function(){this.distanceIsSmall=!0},onBlur_distance:function(){this.distanceIsSmall=!1}}}function getHumanity(number){var numberToHumanity={1:"Первая ось",2:"Вторая ось",3:"Третья ось",4:"Четвертая ось",5:"Пятая ось",6:"Шестая ось",7:"Седьмая ось",8:"Восьмая ось",9:"Девятая ось",10:"Десятая ось",11:"Одиннацатая ось",12:"Двенацатая ось"};return numberToHumanity[number]?numberToHumanity[number]:number+"-я ось"}function setWatchers(){scope.$watch("item.colAxles",function(val,old){initAxles()})}scope.item.items=[],scope.item.axlesList=[],scope.axlesItem={},scope.activeItemByType="";var checkBoxesRequired=[],checkBoxParams={need1Wheel:scope.item.need1Wheel,need2Wheel:scope.item.need2Wheel,need8Wheel:scope.item.need8Wheel};scope.onClickInputText=function(type,value){var item,itemType;switch(type){case"loadTruck":item="truck",itemType="load";break;case"load":item="trailer",itemType="load";break;case"distance":item="distance",itemType="distance";break;case"mass":item="trailer",itemType="mass";break;case"massCab":item="cab",itemType="mass"}scope.setInputIsSmall(item,itemType,void 0===value||value)},scope.onBlurInputText=function(type){scope.onClickInputText(type,!1)},scope.setInputIsSmall=function(item,type,value){scope[item+"ListActiveItem"]&&(scope[item+"ListActiveItem"][type+"IsSmall"]=value)},scope.onClick_countWheel=function(count,type){scope[type+"ListActiveItem"].wheelType=count},scope.updateLists=function(list,isFull,lastPostfix){var listLength=list.length,lastIndex=listLength-1,lastParam=lastPostfix?"last"+lastPostfix:"last";list.forEach(function(li,i){isFull&&(li.number=i+1,li.humanityNumber=AutomotiveAxlesSrv.getHumanity(li.number)),li[lastParam]=i===lastIndex})},scope.addTruckAxle=function(){var newItem,params=_.extend({},checkBoxParams),truckListLength=scope.truckList.length;params.isTruckAxle=!0,params.listLength=truckListLength+1,params.itemIndex=truckListLength,newItem=AutomotiveAxlesSrv.createAxle(params),!1===scope.item.axlesList[scope.item.axlesList.length-1].distanceInvalidRight&&(newItem.isDistanceAxleActiveRight=!0),scope.item.axlesList.splice(truckListLength,0,newItem),scope.updateLists(scope.item.axlesList,!0),scope.truckList=AutomotiveAxlesSrv.getTruckList(scope.item.axlesList),scope.updateLists(scope.truckList,!1,"Truck"),scope.truckListValid=!1,scope.setTruckListActiveItem()},scope.removeTruckAxle=function(){var activeIndex=-1;scope.truckList.forEach(function(li,i){li.isTruckAxleActive&&(activeIndex=i)}),activeIndex>0&&(scope.item.axlesList.splice(activeIndex,1),scope.item.axlesList.length-1>=activeIndex&&(scope.item.axlesList[activeIndex].distance="",scope.distanceListActiveItem=scope.item.axlesList[activeIndex]),scope.updateLists(scope.item.axlesList,!0),scope.truckList=AutomotiveAxlesSrv.getTruckList(scope.item.axlesList),scope.updateLists(scope.truckList,!1,"Truck"),scope.truckListActiveItem=null,scope.setTruckListActiveItem(activeIndex))},scope.onClick_truckListNext=function(activeNumber,withArrows){if("trailer"===withArrows){if(scope.trailerListActiveItem.error=scope.item.validateAxleLoad(scope.trailerListActiveItem),!scope.truckListValid||scope.trailerListActiveItem.error)return;return scope.activeItemByType=withArrows,void scope.setTrailerListActiveItem(activeNumber||void 0)}if(withArrows)return void(scope.activeItemByType="distance");scope.truckListActiveItem.error=scope.item.validateAxleLoad(scope.truckListActiveItem),scope.truckListActiveItem.error||(scope.activeItemByType="truck",scope.trailerListValid=!0,scope.setTruckListActiveItem(activeNumber))},scope.setTruckListActiveItem=function(nextActiveNumber){var activeNumber=scope.truckListActiveItem?scope.truckListActiveItem.number:-1,nextActiveNumberDefine=void 0!==nextActiveNumber,nextActive=nextActiveNumberDefine?nextActiveNumber:activeNumber+1,attributes=["load"],truckListValid=!0;attributes=attributes.concat(checkBoxesRequired),scope.truckListActiveItem&&AutomotiveAxlesSrv.validateListItem({item:scope.truckListActiveItem,attributes:attributes,api:api}),scope.truckList.forEach(function(item){(void 0===item.isTruckAxleInvalid||item.isTruckAxleInvalid)&&(truckListValid=!1)}),scope.truckListActiveItem&&scope.truckListActiveItem.isTruckAxleInvalid||scope.truckList.forEach(function(item){item.number===nextActive?(scope.truckListActiveItem=item,scope.truckListActiveItem.isTruckAxleActive=!0):item.isTruckAxleActive=!1}),scope.truckListActiveItem.wheelType||(scope.truckListActiveItem.wheelType="1"),scope.truckListValid=!nextActiveNumberDefine&&truckListValid,scope.truckListValid||AutomotiveAxlesSrv.changePositionData(element,scope.truckListActiveItem.number)},scope.setTrailerListActiveItem=function(nextActiveNumber){var truckListLength=scope.truckList.length;if(!(nextActiveNumber&&nextActiveNumber<=truckListLength)){var activeNumber=scope.trailerListActiveItem?scope.trailerListActiveItem.number:-1,nextActiveNumberDefine=void 0!==nextActiveNumber,nextActive=nextActiveNumberDefine?nextActiveNumber:activeNumber+1,attributes=["load"],truckListValid=!0;attributes=attributes.concat(checkBoxesRequired),scope.trailerListActiveItem&&((scope.trailerListActiveItem.isSemiTrailer||scope.trailerListActiveItem.isTrailerTruckAxle)&&attributes.push("mass"),AutomotiveAxlesSrv.validateListItem({item:scope.trailerListActiveItem,attributes:attributes,api:api})),scope.item.axlesList.forEach(function(item){(void 0===item.isTruckAxleInvalid||item.isTruckAxleInvalid)&&(truckListValid=!1)}),scope.trailerListActiveItem&&scope.trailerListActiveItem.isTruckAxleInvalid||scope.item.axlesList.forEach(function(item){item.number===nextActive?(scope.trailerListActiveItem=item,scope.trailerListActiveItem.isTruckAxleActive=!0):item.isTruckAxleActive=!1}),scope.trailerListValid=!nextActiveNumberDefine&&truckListValid,scope.trailerListActiveItem.wheelType||(scope.trailerListActiveItem.wheelType="1"),scope.trailerListValid||AutomotiveAxlesSrv.changePositionData(element,scope.trailerListActiveItem.number)}},scope.addTrailer=function(value){for(var lastIndex=scope.item.axlesList.length,i=0,il=value;i<il;i++){var params=_.extend({listLength:lastIndex+1+i,itemIndex:lastIndex+i,isTrailerTruckAxle:0===i&&value>1,isSemiTrailer:1===value,isTrailer:value>1},checkBoxParams),newItem=AutomotiveAxlesSrv.createAxle(params);!1==!scope.item.axlesList[scope.item.axlesList.length-1].distanceInvalidRight&&(newItem.isDistanceAxleActiveRight=!0),scope.item.axlesList.push(newItem)}scope.updateLists(scope.item.axlesList,!0),scope.trailerList=AutomotiveAxlesSrv.getTrailerList(scope.item.axlesList),scope.updateLists(scope.trailerList,!1,"Trailer"),scope.trailerListValid=!1,scope.trailerListActiveItem?scope.setTrailerListActiveItem():(scope.trailerListActiveItem=scope.trailerList[0],scope.activeItemByType="trailer",scope.trailerListActiveItem.wheelType||(scope.trailerListActiveItem.wheelType="1"),AutomotiveAxlesSrv.changePositionData(element,scope.item.axlesList.length-value+1)),scope.firstSemiTrailer=AutomotiveAxlesSrv.checkFirstTrailerType(scope.trailerList),AutomotiveAxlesSrv.setFirstAxleInTruckList(scope.truckList,scope.firstSemiTrailer),scope.toggleModalVisible(!1)},scope.removeTrailer=function(value){for(var removeItemCount=1,removeIndex=value-1,i=value,il=scope.item.axlesList.length;i<il&&!scope.item.axlesList[i].isTrailerTruckAxle;i++)removeItemCount+=i-removeIndex;scope.item.axlesList.splice(removeIndex,removeItemCount),scope.item.axlesList.length-1>=removeIndex&&(scope.item.axlesList[removeIndex].distance="",scope.distanceListActiveItem=scope.item.axlesList[removeIndex]),scope.updateLists(scope.item.axlesList,!0),scope.updateLists(scope.truckList,!1,"Truck"),scope.trailerList=AutomotiveAxlesSrv.getTrailerList(scope.item.axlesList),scope.updateLists(scope.trailerList,!1,"Trailer"),scope.firstSemiTrailer=AutomotiveAxlesSrv.checkFirstTrailerType(scope.trailerList),AutomotiveAxlesSrv.setFirstAxleInTruckList(scope.truckList,scope.firstSemiTrailer),scope.distanceListActiveItem=null,scope.trailerListActiveItem=null},scope.addTrailerAxle=function(){var newItem,params=_.extend({},checkBoxParams),lastIndex=scope.item.axlesList.length;params.listLength=lastIndex+1,params.itemIndex=lastIndex,params.willRemoveFromTrailer=!0,newItem=AutomotiveAxlesSrv.createAxle(params),scope.item.axlesList.splice(lastIndex,0,newItem),scope.updateLists(scope.item.axlesList,!0),scope.activeItemByType="trailer",scope.trailerListValid=!1,scope.setTrailerListActiveItem()},scope.removeTrailerAxle=function(){var activeIndex=-1;scope.item.axlesList.forEach(function(li,i){li.isTruckAxleActive&&(activeIndex=i)}),activeIndex>0&&(scope.item.axlesList.splice(activeIndex,1),scope.item.axlesList.length-1>=activeIndex&&(scope.item.axlesList[activeIndex].distance="",scope.distanceListActiveItem=scope.item.axlesList[activeIndex]),scope.updateLists(scope.item.axlesList,!0),scope.trailerListActiveItem=null,scope.setTrailerListActiveItem(activeIndex))},scope.scrollToWidgetPart=function(part){switch(part){case"truckAxle":api.scrollTo(scope.item.fullPath+"-truck","",-60),scope.addTruckAxle();break;case"trailer":scope.toggleModalVisible(!0);break;case"axle":api.scrollTo(scope.item.fullPath+"-trailer","",-60),scope.addTrailerAxle()}},scope.onClick_activeDistance=function(activeAxle,activeNeighbor){var activeNumber=-1===activeAxle?activeAxle:activeAxle.number;scope.distanceListActiveItem.error=scope.item.validateAxleDistance(scope.distanceListActiveItem),scope.distanceListActiveItem.error||scope.setDistanceListActiveItem(activeNumber,activeNeighbor)},scope.setDistanceListActiveItem=function(activeNumber,activeNeighbor){var nextActive,currentActiveNumber=-1===activeNumber?scope.distanceActiveItem.number+activeNeighbor:activeNumber,attributes=["distance"],distanceListValid=!0,nextActiveNumberDefine=!(-1===activeNumber),leftNeighborIndex=-1,elemInvalid=!1;activeNeighbor<0?(currentActiveNumber+=activeNeighbor,nextActive=activeNumber):nextActive=currentActiveNumber+activeNeighbor,scope.distanceListActiveItem&&AutomotiveAxlesSrv.validateListItem({item:scope.distanceListActiveItem,attributes:attributes,api:api}),scope.distanceListActiveItem&&scope.distanceListActiveItem.distanceError?(nextActive=scope.distanceListActiveItem.number,currentActiveNumber=nextActive-1,elemInvalid=!0):elemInvalid=!1,scope.distanceListActiveItem&&scope.distanceListActiveItem.number&&(scope.distanceListActiveItem.distanceInvalidRight=elemInvalid,scope.distanceAxleList[scope.distanceListActiveItem.number-2].distanceInvalidLeft=elemInvalid),scope.item.axlesList.forEach(function(item,i){i>0&&(void 0===item.distanceError||item.distanceError)&&(distanceListValid=!1)}),scope.distanceListActiveItem&&scope.distanceListActiveItem.distanceError||scope.distanceAxleList.forEach(function(item,i){item.number===nextActive?(item.isDistanceAxleActiveLeft=!1,item.isDistanceAxleActiveRight=!0,scope.distanceListActiveItem=item,leftNeighborIndex=i-1):item.number===currentActiveNumber?(scope.distanceActiveItem=item,item.isDistanceAxleActiveLeft=!0,item.isDistanceAxleActiveRight=!1):(item.isDistanceAxleActiveLeft=!1,item.isDistanceAxleActiveRight=!1)}),scope.distanceListValid=!nextActiveNumberDefine&&distanceListValid,!scope.distanceListValid&&scope.distanceListActiveItem&&AutomotiveAxlesSrv.changePositionData(element,scope.distanceListActiveItem.number,"distance")},scope.toggleModalVisible=function(visible){scope.modalShow=visible,scope.modalShow||api.scrollTo(scope.item.fullPath+"-trailer","",-60)},scope.item.addAxles=function(){var countAxles=scope.item.axlesList.length+1;countAxles<=scope.item.maxAxles&&(scope.item.axlesList.push(createAxle(countAxles,countAxles)),countAxles>1&&(scope.item.axlesList[countAxles-2].last=!1),$rootScope.$apply())},scope.item.removeAxles=function(){var countAxles=scope.item.axlesList.length;countAxles>0&&(countAxles>1&&(scope.item.axlesList[countAxles-2].last=!0),scope.item.axlesList.splice(countAxles-1,1),$rootScope.$apply())},function(){initAxles(),setWatchers(),scope.$emit(scope.item.fullPath+":ScopeApplied",{scope:scope,element:element}),scope.item.isScopeAppliedDone={scope:scope,element:element}}();var watchers;scope.$on("suspend",function(){watchers=scope.$$watchers,scope.$$watchers=[]}),scope.$on("resume",function(){scope.$$watchers=watchers,watchers=null}),scope.$watch("item.value",function(val,oldVal){void 0!==val&&val!==oldVal&&api.find(scope.item.fullPath).afterSetValue(val,oldVal)})}}}]).factory("AutomotiveAxlesExt",["$rootScope","fieldAttrs","Validators",function($rootScope,fieldAttrs,Validators){return{attrs:angular.extend({},fieldAttrs.attrs,{value:{default:""},maxAxles:{default:"2","scope:editor":!0},colAxles:{default:"2","scope:editor":!0},dataSave:{"scope:editor":!1},errorsArray:{default:[],"scope:editor":!1},text_value:{type:"string","scope:sync":!1,"scope:editor":!1,"scope:rule:all":!0},validators2:{default:[],"scope:editor":!0},trailersCount:{type:"string",default:"0","scope:editor":!0},need1Wheel:{type:"boolean",default:!0,"scope:editor":!0},need2Wheel:{type:"boolean",default:!0,"scope:editor":!0},need8Wheel:{type:"boolean",default:!0,"scope:editor":!0},draftData:{type:"string",default:"","scope:editor":!1,"scope:sync":!0},radioList:{type:"options",default:[{label:"Односкатные оси с пневмоподвеской",value:"1",icon:""},{label:"Двухскатные колеса",value:"2",icon:""},{label:"Восемь и более колес на оси",value:"8",icon:""}]}}),validate:function(lazy){if(this.disabled()||!this.visible()||!this.inheritedVisibility())return!0;var element=this.getElement();if(!lazy){this.error(!1);var validators=this.attr("validators");this.attr("validators2");element.axlesList.forEach(function(axle){Validators.isInvalid(validators,axle.distance),Validators.isInvalid(validators,axle.distance)})}return!0},validateAxleLoad:function(axle){return Validators.isInvalid(this.validators[0]?[this.validators[0]]:[],axle.load)},validateAxleDistance:function(axle){return Validators.isInvalid(this.validators[1]?[this.validators[1]]:[],axle.distance)}}}]).factory("AutomotiveAxlesSrv",["$rootScope","$timeout","Validators",function($rootScope,$timeout,Validators){return{createAxle:function(params){var self=this,need1Wheel=params.need1Wheel||!1,need2Wheel=params.need2Wheel||!1,need8Wheel=params.need8Wheel||!1,number=params.itemIndex+1,countAxles=params.listLength;return{id:number,number:number,isTruckAxleActive:!1,isTrailerAxleActive:!1,isDistanceActive:!1,withArrows:params.withArrows||!1,humanityNumber:self.getHumanity(number),last:number==countAxles,isCab:0===params.itemIndex,isTruckAxle:params.isTruckAxle||!1,isTrailer:params.isTrailer||!1,isSemiTrailer:params.isSemiTrailer||!1,isTrailerTruckAxle:params.isTrailerTruckAxle||!1,willRemoveFromTrailer:params.willRemoveFromTrailer||!1,load:"",loadIsSmall:!1,mass:"",massIsSmall:!1,distance:"",distanceIsSmall:!1,oneWheel:0,twoWheel:0,moreWheel:0,wheelType:"",error:[],need1Wheel:need1Wheel,need2Wheel:need2Wheel,need8Wheel:need8Wheel}},getHumanity:function(number){var numberToHumanity={1:"Первая",2:"Вторая",3:"Третья",4:"Четвертая",5:"Пятая",6:"Шестая",7:"Седьмая",8:"Восьмая",9:"Девятая",10:"Десятая",11:"Одиннадцатая",12:"Двенадцатая"};return numberToHumanity[number]?numberToHumanity[number]+" ось":number+"-я ось"},validateListItem:function(params){var self=this,item=params.item||{},attributes=params.attributes||[];item.isTruckAxleInvalid=!1,attributes.forEach(function(attr){if(void 0!==item[attr]){var validators=self.validatorsByName(attr);item[attr+"Error"]=Validators.isInvalid(validators,item[attr],params.api.formValidators),item.isTruckAxleInvalid=item[attr+"Error"]||item.isTruckAxleInvalid,item.isTruckAxleValid=!item.isTruckAxleInvalid}})},validatorsByName:function(name){var validators={load:{validators:[{id:55550,message:"Поле обязательно для заполнения",mnemonic:"required",name:"Обязательное поле",regexp:"\\s*\\S.*",shortDescription:"поле обязательно для заполнения, не пустое"}]},mass:{validators:[{id:55550,message:"Поле обязательно для заполнения",mnemonic:"required",name:"Обязательное поле",regexp:"\\s*\\S.*",shortDescription:"поле обязательно для заполнения, не пустое"}]},distance:{validators:[{id:55550,message:"Поле обязательно для заполнения",mnemonic:"required",name:"Обязательное поле",regexp:"\\s*\\S.*",shortDescription:"поле обязательно для заполнения, не пустое"}]},oneWheel:{validators:[{id:55550,message:"Поле обязательно для заполнения",mnemonic:"required",name:"Обязательное поле",regexp:"\\s*\\S.*",shortDescription:"поле обязательно для заполнения, не пустое"}]},twoWheel:{validators:[{id:55550,message:"Поле обязательно для заполнения",mnemonic:"required",name:"Обязательное поле",regexp:"\\s*\\S.*",shortDescription:"поле обязательно для заполнения, не пустое"}]},moreWheel:{validators:[{id:55550,message:"Поле обязательно для заполнения",mnemonic:"required",name:"Обязательное поле",regexp:"\\s*\\S.*",shortDescription:"поле обязательно для заполнения, не пустое"}]}};return validators[name]&&validators[name].validators?validators[name].validators:[]},getTruckList:function(list){return list.filter(function(elem){return elem.isCab||elem.isTruckAxle})},checkFirstTrailerType:function(list){return!!list.find(function(il,i){return 0===i&&il.isSemiTrailer})},setFirstAxleInTruckList:function(list,isSemi){list.length;list.forEach(function(li,i){1===i&&(li.isTruckFirstWithSemi=isSemi)})},getTrailerList:function(list){return list.filter(function(elem){return elem.isSemiTrailer||elem.isTrailerTruckAxle})},changePositionItemDataArrow:function(axleOffsetLeft,axleWidth,arrowWidth){return axleOffsetLeft+(axleWidth-arrowWidth)/2},changePositionData:function(element,activeItemNumber,activeType){var self=this;$timeout(function(){for(var leftPositionData,leftPositionArrow,domActiveAxlePrev,domActiveAxleIcon,domActiveAxleIconsPrev,domActiveAxleIconPrev,domActiveTruck=element[0].querySelector(".PGU-AutomotiveAxles-Item__Truck_Active"),trailerActiveNumber=activeItemNumber-1,domActiveWrapTruck=domActiveTruck.querySelector(".PGU-AutomotiveAxles-Item__Wrap-Truck-Axle"),domActiveWrapTruckList=domActiveTruck.querySelector(".flex-inline-container"),domActiveAxle=domActiveTruck.querySelectorAll(".PGU-AutomotiveAxles-Item__Truck-Axle")[trailerActiveNumber],domActiveAxleIcons=domActiveAxle.querySelectorAll(".js-PGU-AutomotiveAxles-Item__AxleIcon_Axle"),i=0,il=domActiveAxleIcons.length;i<il;i++)domActiveAxleIcons[i].offsetWidth&&(domActiveAxleIcon=domActiveAxleIcons[i]);var domActiveData=domActiveTruck.querySelector(".PGU-AutomotiveAxles-Item__Data"),domActiveDataArrow=domActiveTruck.querySelector(".PGU-AutomotiveAxles-Item__Data__Arrow"),domActiveAxleIconOffsetLeft=domActiveAxleIcon.offsetLeft,domActiveAxleIconOffsetWidth=domActiveAxleIcon.offsetWidth,domActiveAxlePosition=domActiveAxle.offsetWidth+domActiveAxleIcon.offsetLeft;domActiveWrapTruck.offsetWidth<=domActiveAxlePosition?domActiveWrapTruck.scrollLeft=domActiveWrapTruck.offsetWidth+domActiveAxlePosition:domActiveWrapTruck.scrollLeft=0;var scrollLefActiveWrapTruck=domActiveWrapTruck.scrollLeft;if(domActiveAxleIconOffsetLeft-=scrollLefActiveWrapTruck,"distance"===activeType){for(domActiveAxlePrev=domActiveTruck.querySelectorAll(".PGU-AutomotiveAxles-Item__Truck-Axle")[trailerActiveNumber-1],domActiveAxleIconsPrev=domActiveAxlePrev.querySelectorAll(".js-PGU-AutomotiveAxles-Item__AxleIcon_Axle"),i=0,il=domActiveAxleIconsPrev.length;i<il;i++)domActiveAxleIconsPrev[i].offsetWidth&&(domActiveAxleIconPrev=domActiveAxleIconsPrev[i]);var leftPosition=domActiveAxleIconOffsetLeft=domActiveAxleIconPrev.offsetLeft-scrollLefActiveWrapTruck+domActiveAxleIconPrev.offsetWidth/2;domActiveAxleIconOffsetWidth=domActiveAxleIcon.offsetLeft-scrollLefActiveWrapTruck+domActiveAxleIcon.offsetWidth/2-leftPosition}
leftPositionData=self.changePositionItemDataArrow(domActiveAxleIconOffsetLeft,domActiveAxleIconOffsetWidth,domActiveData.offsetWidth),domActiveWrapTruckList.offsetWidth-(domActiveData.offsetWidth+leftPositionData+scrollLefActiveWrapTruck)<0&&(leftPositionData=domActiveWrapTruckList.offsetWidth-domActiveData.offsetWidth-scrollLefActiveWrapTruck),leftPositionData=leftPositionData<0?0:leftPositionData,domActiveData.style.left=leftPositionData+"px",domActiveAxle&&(leftPositionArrow=self.changePositionItemDataArrow(domActiveAxleIconOffsetLeft,domActiveAxleIconOffsetWidth,domActiveDataArrow.offsetWidth),domActiveDataArrow.style.left=leftPositionArrow-leftPositionData+"px")},0)}}}]),angular.module("serverFormWidgets.general").directive("epguFieldBirthPlace",["fieldBirthPlaceProperties","TEMPLATES","$rootScope","pguSaveDataEsiaSrvc","PGU",function(fieldBirthPlaceProperties,TEMPLATES,$rootScope,pguSaveDataEsiaSrvc,PGU){return{templateUrl:TEMPLATES.FIELD_INN,replace:!0,scope:{item:"="},link:function(scope,element,attrs){scope.item.attrs={},scope.item.validate=fieldBirthPlaceProperties.validate,fieldBirthPlaceProperties.init(scope.item.attrs);var esiaValue=!1;PGU.Events.subscribe("","FinishedLoading",function(){esiaValue=!!scope.item.value}),$rootScope.$on(scope.item.fullPath+":blur",function(){scope.item.value&&pguSaveDataEsiaSrvc.save("bp",{birthPlace:scope.item.value},scope.item.fullPath,scope.item.validators||[],esiaValue)}),scope.$root=$rootScope,scope.$emit(scope.item.fullPath+":ScopeApplied",{scope:scope,element:element})}}}]).factory("fieldBirthPlaceProperties",["$rootScope","fieldAttrs",function($rootScope,fieldAttrs){return{init:function(m){angular.extend(m,fieldAttrs.attrs,this.getAttrs())},getAttrs:function(){return{strategy:{type:"string",default:"birthplace",enum:$rootScope.editor&&[""].concat($rootScope.strategyKeys),enumOptions:$rootScope.editor&&$.extend({"":""},$rootScope.strategyHash)},immutable:{type:"boolean",default:!0,humanity:"неизменяемое","scope:editor":!1}}}}}]),angular.module("serverFormWidgets.general").directive("epguFieldAddress",["TEMPLATES","$rootScope","pguSaveDataEsiaSrvc","pguFiasService","$timeout","PGU","$q","api",function(TEMPLATES,$rootScope,pguSaveDataEsiaSrvc,pguFiasService,$timeout,PGU,$q,api){return{templateUrl:TEMPLATES.FIELD_ADDRESS,replace:!0,scope:{item:"="},link:function(scope,element,attrs){function checkAddressChange(){for(var c in scope.model.strategyAddress){var control=scope.model.strategyAddress[c];if("value"!=c&&control!==scope.item[c])return!0}return!1}function saveEsiaData(){var newAddress={type:scope.model.type,countryId:"RUS",fiasCode:scope.item.numericFiasCode,addressStr:getFullAddressForEsia(),region:getValueWithLongTileForEsia("region"),street:getValueWithLongTileForEsia("street"),house:scope.item.house,frame:scope.item.building1,building:scope.item.building2,flat:scope.item.apartment,zipCode:scope.item.post_index},method="address";scope.model.esiaAddress&&scope.model.esiaAddress.id&&(method+="/"+scope.model.esiaAddress.id,newAddress.id=scope.model.esiaAddress.id),pguSaveDataEsiaSrvc.save(method,newAddress,scope.item.fullPath,[],!1,scope.model.defer)}function getFullAddressForEsia(){var fullAddress="";for(var c in scope.model.controlsObj){var control=scope.model.controlsObj[c];if(control.level>0&&control.level<10){var dataValue=control.data.dataValue||control.el.value(),longAbbr=control.data.type||control.longAbbr||"";longAbbr=longAbbr.toLowerCase();var itemValue=dataValue||"";control.checkbox&&control.checkbox.attr("checked")&&(itemValue=""),itemValue&&(fullAddress+=fullAddress?", "+itemValue+" "+longAbbr:itemValue+" "+longAbbr)}}return fullAddress}function getValueWithLongTileForEsia(controlName){var val=scope.item[controlName],control=scope.model.controlsObj[controlName];if(val&&control&&control.data){val=val+" "+(control.data.type||control.longAbbr||"").toLowerCase()}return val}scope.model={},scope.ui={},scope.ui.showESIAPopup=!1,scope.model.defer=$q.defer(),api.beforeSubmit(scope.model.defer,scope),PGU.Events.subscribe(scope.item.fullPath,"hidePopup",function(){scope.ui.showESIAPopup=!1,scope.model.defer.resolve(!0)}),scope.model.saveAddressWithQuestion="FieldRegistrationAddress"===scope.item.className||!(scope.item.fias_full_code&&scope.item.strategy),scope.model.type="FieldAddressOfResidence"===scope.item.className?"PLV":"PRG",scope.model.esiaAddress=function(){var address={};return $rootScope.settings&&$rootScope.settings.user&&$rootScope.settings.user.addresses&&$rootScope.settings.user.addresses.length&&$rootScope.settings.user.addresses.forEach(function(item){item.type===scope.model.type&&(address=item)}),address}(),scope.model.esiaAction=Object.keys(scope.model.esiaAddress).length?"update":"create",function(){scope.model.strategyAddress={fias_full_code:scope.item.fias_full_code||"",numericFiasCode:scope.item.numericFiasCode||"",post_index:scope.item.post_index||"",region:scope.item.region||"",area:scope.item.area||"",city:scope.item.city||"",cityArea:scope.item.cityArea||"",place:scope.item.place||"",street:scope.item.street||"",additionalArea:scope.item.additionalArea||"",additionalStreet:scope.item.additionalStreet||"",house:scope.item.house||"",building1:scope.item.building1||"",building2:scope.item.building2||"",apartment:scope.item.apartment||"",value:""}}(),function(){pguFiasService.initFiasFields(scope),pguFiasService.setWatchers(scope)}(),PGU.Events.subscribe("","submitForm",function(){checkAddressChange()?scope.model.saveAddressWithQuestion?scope.ui.showESIAPopup=!0:saveEsiaData():scope.model.defer.resolve(!0)}),scope.changeEsiaData=function(){scope.ui.showESIAPopup=!1,saveEsiaData()},scope.noChangeEsiaData=function(){scope.ui.showESIAPopup=!1,scope.model.defer.resolve(!0)};var watchers;scope.$on("suspend",function(){watchers=scope.$$watchers,scope.$$watchers=[]}),scope.$on("resume",function(){scope.$$watchers=watchers,watchers=null}),scope.$emit(scope.item.fullPath+":ScopeApplied",{scope:scope,element:element})}}}]).factory("FieldAddressOfResidenceExt",["$rootScope","FiasExt",function($rootScope,FiasExt){return{attrs:angular.extend({},FiasExt.attrs,{strategy:{type:"string",default:"address_live_fias",enum:$rootScope.editor&&[""].concat($rootScope.strategyKeys),enumOptions:$rootScope.editor&&$.extend({"":""},$rootScope.strategyHash)}}),fillItems:FiasExt.fillItems,fillFullPath:FiasExt.fillFullPath,validate:FiasExt.validate}}]).factory("FieldRegistrationAddressExt",["$rootScope","FiasExt",function($rootScope,FiasExt){return{attrs:angular.extend({},FiasExt.attrs,{strategy:{type:"string",default:"address_reg_fias",enum:$rootScope.editor&&[""].concat($rootScope.strategyKeys),enumOptions:$rootScope.editor&&$.extend({"":""},$rootScope.strategyHash)}}),fillItems:FiasExt.fillItems,fillFullPath:FiasExt.fillFullPath,validate:FiasExt.validate}}]),angular.module("serverFormWidgets.general").directive("epguFieldDrivingLicense",["TEMPLATES","$rootScope","pguSaveDataEsiaSrvc","PGU","$timeout","$q","pguDrivingLicenseSrvc","FieldDrivingLicenseExt","api",function(TEMPLATES,$rootScope,pguSaveDataEsiaSrvc,PGU,$timeout,$q,pguDrivingLicenseSrvc,FieldDrivingLicenseExt,api){return{templateUrl:TEMPLATES.FIELD_DL,replace:!0,scope:{item:"="},link:function(scope,element,attrs){var arrProp=[{field:"driver_license_series",popup:"series"},{field:"driver_license_number",popup:"number"},{field:"driver_license_issue_date",popup:"issueDate"},{field:"driver_license_valid_till",popup:"expiryDate"}];scope.ui={},scope.ui.showESIAPopup=!1,scope.dataStrategy={},scope.dataStrategy={driver_license_series:scope.item.driver_license_series,driver_license_number:scope.item.driver_license_number,driver_license_issue_date:scope.item.driver_license_issue_date,driver_license_valid_till:scope.item.driver_license_valid_till},scope.setData=function(){var arrData={};arrProp.forEach(function(val){arrData[val.popup]=scope.item[val.field]?scope.item[val.field]:""}),arrData.type="RF_DRIVING_LICENSE",$rootScope.settings.user&&$rootScope.settings.user.vu&&"RF_DRIVING_LICENSE"==$rootScope.settings.user.vu.type&&(arrData.id=$rootScope.settings.user.vu.id),pguSaveDataEsiaSrvc.save("driverLicense/"+arrData.id,arrData,scope.item.fullPath,scope.item.validators||[],!1,pguDrivingLicenseSrvc.srvcDefer)},scope.noChange=function(){scope.ui.showESIAPopup=!1,pguDrivingLicenseSrvc.srvcDefer.resolve("DL_nochange")},scope.$emit(scope.item.fullPath+":ScopeApplied",{scope:scope,element:element}),pguDrivingLicenseSrvc.initPopup(scope),pguDrivingLicenseSrvc.setFullData(scope),FieldDrivingLicenseExt.setWatchers(scope,api),scope.$root=$rootScope}}}]).factory("FieldDrivingLicenseExt",["$rootScope","fieldAttrs","drivingLicenseStructure",function($rootScope,fieldAttrs,drivingLicenseStructure){return{attrs:angular.extend({},fieldAttrs.attrs,{immutable:{type:"boolean",default:!1,humanity:"неизменяемое","scope:editor":!0},strategy:{type:"string",default:"driverlicenseallinfo",enum:$rootScope.editor&&[""].concat($rootScope.strategyKeys),enumOptions:$rootScope.editor&&$.extend({"":""},$rootScope.strategyHash)},driver_license_series:{type:"string",default:"","scope:editor":!1,"scope:sync":!0},driver_license_number:{type:"string",default:"","scope:editor":!1,"scope:sync":!0},driver_license_issue_date:{type:"string",default:"","scope:editor":!1,"scope:sync":!0},driver_license_valid_till:{type:"string",default:"","scope:editor":!1,"scope:sync":!0},seriesVisible:{type:"boolean",default:!0,humanity:"Серия"},numberVisible:{type:"boolean",default:!0,humanity:"Номер"},dateVisible:{type:"boolean",default:!0,humanity:"Дата"},validToVisible:{type:"boolean",default:!0,humanity:"Действительно до"}}),fillItems:function(item){return this.fillFullPath(drivingLicenseStructure.getStructure(),this.element.fullPath)},fillFullPath:function(structure,parentPath){if(structure.fullPath=parentPath+"."+structure.name,structure.originalFullPath=parentPath+"."+structure.name,structure.items&&structure.items.length)for(var i=0;i<structure.items.length;i++){switch(structure.items[i].name){case"Series":structure.items[i].visible=!1!==this.attr("seriesVisible");break;case"Number":structure.items[i].visible=!1!==this.attr("numberVisible");break;case"Date":structure.items[i].visible=!1!==this.attr("dateVisible");break;case"ValidTo":structure.items[i].visible=!1!==this.attr("validToVisible")}structure.items[i]=this.fillFullPath(structure.items[i],structure.fullPath)}return structure},setWatchers:function(scope,a){var self=scope,wg=a.find(scope.item.fullPath+".PanelControls");scope.$watch(function(){return wg.find("PanelSeries.Series").value()},function(val){val!=self.item.driver_license_series&&(self.item.driver_license_series=val)});var watchers;scope.$on("suspend",function(){watchers=scope.$$watchers,scope.$$watchers=[]}),scope.$on("resume",function(){scope.$$watchers=watchers,watchers=null}),scope.$watch(function(){return wg.find("PanelNumber.Number").value()},function(val,oldVal){val!=self.item.driver_license_number&&(self.item.driver_license_number=val,a.find(scope.item.fullPath).afterSetValue(val,oldVal))}),scope.$watch(function(){return wg.find("PanelDate.Date").value()},function(val,oldVal){val!=self.item.driver_license_issue_date&&(self.item.driver_license_issue_date=val,a.find(scope.item.fullPath).afterSetValue(val,oldVal))}),scope.$watch(function(){return wg.find("PanelValidTo.ValidTo").value()},function(val,oldVal){val!=self.item.driver_license_valid_till&&(self.item.driver_license_valid_till=val,a.find(scope.item.fullPath).afterSetValue(val,oldVal))})}}}]).factory("drivingLicenseStructure",[function(){function getStructure(){var structure={className:"Panel",name:"PanelControls",title:"",isGrid:!0,doNotSave:!0,doNotSaveDraft:!0,items:[{className:"Panel",name:"PanelSeries",title:"",isGridItem:!0,doNotSaveDraft:!0,items:[{className:"FieldText",name:"Series",label:"Серия",notRequiredText:"",visible:!0,doNotSaveDraft:!0,required:!0}]},{className:"Panel",name:"PanelNumber",title:"",isGridItem:!0,visible:!0,doNotSaveDraft:!0,items:[{className:"FieldText",name:"Number",label:"Номер",notRequiredText:"",visible:!0,doNotSaveDraft:!0,required:!0}]},{className:"Panel",name:"PanelDate",title:"",isGridItem:!0,visible:!0,doNotSaveDraft:!0,items:[{className:"FieldText",name:"Date",label:"Дата выдачи",notRequiredText:"",doNotSaveDraft:!0,visible:!0}]},{className:"Panel",name:"PanelValidTo",title:"",isGridItem:!0,visible:!0,gridWidth:"one-half",doNotSaveDraft:!0,items:[{className:"FieldText",name:"ValidTo",label:"Действительно до",notRequiredText:"",doNotSaveDraft:!0,visible:!0}]}]};return angular.copy(structure)}return{getStructure:getStructure}}]),angular.module("serverFormWidgets.general").directive("epguFieldVehicle",["TEMPLATES","$rootScope","pguSaveDataEsiaSrvc","PGU","$timeout","api","$q","pguVehicleSrvc","FieldVehicleExt",function(TEMPLATES,$rootScope,pguSaveDataEsiaSrvc,PGU,$timeout,api,$q,pguVehicleSrvc,FieldVehicleExt){return{templateUrl:TEMPLATES.FIELD_TC,replace:!0,scope:{item:"="},link:function(scope,element,attrs){scope.ui={},scope.ui.showESIAPopup=!1,scope.dataLK={},scope.setData=function(){var arrData={};return arrData={name:scope.item.nameVehicle,numberPlate:scope.item.vehicleId,regCertificate:{series:scope.item.series,number:scope.item.number}},pguSaveDataEsiaSrvc.save("cars",arrData,scope.item.fullPath,scope.item.validators||[],!1,pguVehicleSrvc.srvcDefer),arrData},scope.noChange=function(){scope.ui.popupShowDefer=!1,pguSaveDataEsiaSrvc.srvcDefer.resolve("V_nochange")},scope.$emit(scope.item.fullPath+":ScopeApplied",{scope:scope,element:element}),pguVehicleSrvc.initPopup(scope),FieldVehicleExt.setWatchers(scope,api),scope.$root=$rootScope}}}]).factory("FieldVehicleExt",["$rootScope","fieldAttrs","vehicleStructure",function($rootScope,fieldAttrs,vehicleStructure){return{attrs:angular.extend({},fieldAttrs.attrs,{immutable:{type:"boolean",default:!1,humanity:"неизменяемое","scope:editor":!0},strategy:{type:"string",default:"driverlicenseallinfo",enum:$rootScope.editor&&[""].concat($rootScope.strategyKeys),enumOptions:$rootScope.editor&&$.extend({"":""},$rootScope.strategyHash)},series:{type:"string",default:"","scope:editor":!1,"scope:sync":!0},number:{type:"string",default:"","scope:editor":!1,"scope:sync":!0},nameVehicle:{type:"string",default:"","scope:editor":!1,"scope:sync":!0},vehicleId:{type:"string",default:"","scope:editor":!1,"scope:sync":!0},numberAndSeries:{type:"string",default:"","scope:editor":!1,"scope:sync":!0},seriesVisible:{type:"boolean",default:!0,humanity:"Серия"},numberVisible:{type:"boolean",default:!0,humanity:"Номер"},nameVisible:{type:"boolean",default:!0,humanity:"Название"},vehicleIdVisible:{type:"boolean",default:!0,humanity:"Гос. номер"},numberAndSeriesVisible:{type:"boolean",default:!0,humanity:"Номер и серия"}}),fillItems:function(item){return this.fillFullPath(vehicleStructure.getStructure(),this.element.fullPath)},fillFullPath:function(structure,parentPath){if(structure.fullPath=parentPath+"."+structure.name,structure.originalFullPath=parentPath+"."+structure.name,structure.items&&structure.items.length)for(var i=0;i<structure.items.length;i++){switch(structure.items[i].name){case"Series":structure.items[i].visible=!1!==this.attr("seriesVisible");break;case"Number":structure.items[i].visible=!1!==this.attr("numberVisible");break;case"Name":structure.items[i].visible=!1!==this.attr("nameVisible");break;case"VehicleID":structure.items[i].visible=!1!==this.attr("vehicleIdVisible");break;case"NumberAndSeries":structure.items[i].visible=!1!==this.attr("numberAndSeriesVisible")}structure.items[i]=this.fillFullPath(structure.items[i],structure.fullPath)}return structure},setWatchers:function(scope,a){var self=scope,wg=a.find(scope.item.fullPath+".PanelControls");scope.$watch(function(){return wg.find("PanelSeries.Series").value()},function(val){val&&(self.item.series=val)}),scope.$watch(function(){return wg.find("PanelNumber.Number").value()},function(val){val&&(self.item.number=val)}),scope.$watch(function(){return wg.find("PanelName.Name").value()},function(val){val&&(self.item.nameVehicle=val)}),scope.$watch(function(){return wg.find("PanelVehicleID.VehicleID").value()},function(val){val&&(self.item.vehicleId=val)}),scope.$watch(function(){return wg.find("PanelNumberAndSeries.NumberAndSeries").value()},function(val){val&&(self.item.numberAndSeries=val)}),scope.$watch("item.numberAndSeries",function(val){val&&(self.item.series=val.split(" ")[0]||"",self.item.number=val.split(" ")[1]||"")});var watchers;scope.$on("suspend",function(){watchers=scope.$$watchers,scope.$$watchers=[]}),scope.$on("resume",function(){scope.$$watchers=watchers,watchers=null})}}}]).factory("vehicleStructure",[function(){function createStructure(json){angular.extend(this,json)}function getStructure(){return new createStructure({className:"Panel",name:"PanelControls",title:"",isGrid:!0,doNotSave:!0,doNotSaveDraft:!0,items:[{className:"Panel",name:"PanelName",title:"",isGridItem:!0,doNotSaveDraft:!0,items:[{className:"FieldText",name:"Name",label:"Название",notRequiredText:"",visible:!0,doNotSaveDraft:!0,required:!0}]},{className:"Panel",name:"PanelVehicleID",title:"",isGridItem:!0,visible:!0,doNotSaveDraft:!0,items:[{className:"FieldText",name:"VehicleID",label:"Государственный регистрационный знак",notRequiredText:"",visible:!0,doNotSaveDraft:!0,required:!0}]},{className:"Panel",name:"PanelSeries",title:"",isGridItem:!0,doNotSaveDraft:!0,items:[{className:"FieldText",name:"Series",label:"Серия",notRequiredText:"",visible:!0,doNotSaveDraft:!0,required:!0}]},{className:"Panel",name:"PanelNumber",title:"",isGridItem:!0,visible:!0,doNotSaveDraft:!0,items:[{className:"FieldText",name:"Number",label:"Номер",notRequiredText:"",visible:!0,doNotSaveDraft:!0,required:!0}]},{className:"Panel",name:"PanelNumberAndSeries",title:"",isGridItem:!0,visible:!0,doNotSaveDraft:!0,items:[{className:"FieldText",name:"NumberAndSeries",label:"Серяи и номер",notRequiredText:"",doNotSaveDraft:!0,visible:!0,required:!0}]}]})}return{getStructure:getStructure}}]),angular.module("serverFormWidgets.general").directive("epguInitialImpact",["TEMPLATES","api","$rootScope","$timeout","PGU",function(TEMPLATES,api,$rootScope,$timeout,PGU){return{templateUrl:TEMPLATES.INITIAL_IMPACT,replace:!1,scope:{item:"="},link:function($scope,element,attrs){function initDropdown(value){$scope.typesTSDropdown={className:"FieldDropdown",name:"TypesTSDropdown",fullPath:$scope.item.fullPath?$scope.item.fullPath+"._initialImpactDropdown":"._initialImpactDropdown",label:"Тип транспортного средства",selectType:"FieldDropdownExt",visible:!0,required:!0,availableForHide:!1,withoutCache:!0,getFullResult:!1,searchBar:!1,searchFromServer:!1,isOnlySearch:!1,value:value},api.initAttrs([$scope.typesTSDropdown]);var unsubscribeScopeApplied=$rootScope.$on($scope.item.fullPath+"._initialImpactDropdown:ScopeApplied",function(evt,data){data&&data.scope&&data.scope.item&&(data.scope.item.setCustomList(typesTSModel,!0),unsubscribeScopeApplied())}),unsubscribeSelectItem=$rootScope.$on($scope.item.fullPath+"._initialImpactDropdown:selectItem",function(evt,data){activeSectors=[],selectedSectors=[],$scope.item.sector="",$scope.item.error="",typeTSChange(data.scope.model.value),$scope.curTypeTS&&initSectors($scope.curTypeTS.sectorCount)});$scope.$on("$destroy",function(){unsubscribeSelectItem()})}function typeTSChange(value){$scope.curTypeTS=typesTSModel.find(function(item){return item.value===value}),$scope.item.typeTS=$scope.curTypeTS&&$scope.curTypeTS.value||""}function generateSectors(selected,disabled){this.isSelected=selected,this.isDisabled=disabled}function initSectors(count){$scope.sectors=[];for(var itemIsSelected,itemIsDisabled,i=0;i<count;i++)itemIsSelected=!1,itemIsDisabled=!1,selectedSectors.length&&(itemIsSelected=selectedSectors.includes(i),itemIsDisabled=!activeSectors.includes(i)),$scope.sectors.push(new generateSectors(itemIsSelected,itemIsDisabled))}function sortSectors(a,b){return a-b}function getSectorsToSave(sectors){return sectors=sectors.map(function(item){return++item}),sectors.sort(sortSectors).join("-")}function getActiveSectors(){var indexesOfActive=[];return 1===selectedSectors.length?($scope.curTypeTS.enableSectorCount>1&&(indexesOfActive=getNeighborSectors(selectedSectors[0])),indexesOfActive.push(selectedSectors[0])):selectedSectors.length>1&&(indexesOfActive=selectedSectors.slice()),indexesOfActive}function getNeighborSectors(index){var indexesOfActive=[];return index-1<0?indexesOfActive.push($scope.curTypeTS.sectorCount-1):indexesOfActive.push(index-1),index+1>$scope.curTypeTS.sectorCount-1?indexesOfActive.push(0):indexesOfActive.push(index+1),indexesOfActive}function toggleSectors(){activeSectors=getActiveSectors(),activeSectors.length?$scope.sectors.forEach(function(sector,index){sector.isDisabled=!activeSectors.includes(index)}):$scope.sectors.forEach(function(sector){sector.isDisabled=!1})}$scope.item.api=api;var typesTSModel=[{typeName:"car",title:"Легковой автомобиль",sectorCount:14,enableSectorCount:2,value:"2"},{typeName:"truck",title:"Грузовой автомобиль",sectorCount:12,enableSectorCount:2,value:"1"},{typeName:"moto",title:"Мотоцикл",sectorCount:4,enableSectorCount:1,value:"3"}];$scope.sectors=[];var activeSectors=[],selectedSectors=[];!function(){initDropdown($scope.item.typeTS),$scope.item.typeTS&&(typeTSChange($scope.item.typeTS),$scope.item.sector&&(selectedSectors=$scope.item.sector.split("-").map(function(item){var itemAsNumber=+item;return--itemAsNumber}),activeSectors=getActiveSectors()),initSectors($scope.curTypeTS.sectorCount)),$scope.$emit($scope.item.fullPath+":ScopeApplied",{scope:$scope,element:element}),$scope.item.isScopeAppliedDone={scope:$scope,element:element}}(),$scope.selectSector=function(index,sector){if(!sector.isDisabled){if($scope.item.error="",sector.isSelected=!sector.isSelected,sector.isSelected)selectedSectors.push(index);else{var unselectedItem=selectedSectors.indexOf(index);selectedSectors.splice(unselectedItem,1)}toggleSectors(),$scope.item.sector=getSectorsToSave(selectedSectors)}};var watchers;$scope.$on("suspend",function(){watchers=$scope.$$watchers,$scope.$$watchers=[]}),$scope.$on("resume",function(){$scope.$$watchers=watchers,watchers=null}),$scope.$watch("item.disabled",function(val,oldVal){api.find($scope.item.fullPath+"._initialImpactDropdown").disabled(val)})}}}]).factory("InitialImpactExt",["$rootScope","fieldAttrs",function($rootScope,fieldAttrs){return{attrs:angular.extend({},fieldAttrs.attrs,{value:{default:""},typeTS:{default:"","scope:editor":!0},version:{default:"1","scope:editor":!0},sector:{default:"",type:"string","scope:editor":!0}}),validate:function(lazy){if(this.disabled()||!this.visible()||!this.inheritedVisibility())return!0;var self=this,valid=!0,element=this.getElement();if(!lazy){valid=self.find("_initialImpactDropdown").validate(),valid&&((valid=!!element.sector)||this.error("Поле обязательно для заполнения"))}return!this.element.api||this.element.api.__setFirstFieldError||lazy||valid||(this.element.api.__setFirstFieldError=this.element.fullPath),valid}}}]),angular.module("serverFormWidgets.general").directive("epguPayment",["$rootScope","TEMPLATES","pguPaymentSrvc","$q","$timeout","api","PGU","$filter","HealthSrv",function($rootScope,TEMPLATES,pguPaymentSrvc,$q,$timeout,api,PGU,$filter,HealthSrv){return{templateUrl:TEMPLATES.PAYMENT,replace:!0,scope:{item:"="},link:function(scope,element,attrs){scope.item.parseParams=pguPaymentSrvc.getFormParams(scope.item.formParamsString);var orgType=$rootScope.settings&&$rootScope.settings.orgType;scope.discountEnabled=$rootScope.settings&&$rootScope.settings.discountEnabled,orgType&&"L"===orgType&&(scope.discountEnabled=!1),scope.uiPaymentModel=[],scope.item.listPayment=scope.item.listPayment||[],scope.item.sale={class:"important",title:"Получите скидку 30% на оплату госпошлины",text:'Скидка действует при электронной оплате госпошлины на портале. <a target="_blank" href="/help/news/oplachivayte_gosposhliny_so_skidkoy_30">Подробнее о скидке</a>'};var def=$q.defer();$rootScope.settings.paymentBlocks[scope.item.fullPath]=def.promise,scope.item.getList=function(success,error,callCount){scope.item.loading=!1;var opt={dictionary:scope.item.dictionary,filter:{dictem_code:scope.item.parseParams.dictCode(),FiasCode:scope.item.parseParams.code()}};callCount||(opt.filter.filter_reg=scope.item.parseParams.filter_reg()),pguPaymentSrvc.getList(opt,function(list){if(!list.length)return callCount?void(scope.item.fetched=!1):void scope.item.getList(success,error,1);if(list.length>1)return def.resolve({uidPayment:!1}),scope.item.fetched=!0,void(scope.item.errorLoad=!0);scope.item.fetched=!0;var cacheList=[],equal=!0;scope.item.uidPayment&&(cacheList=JSON.parse(scope.item.uidPayment),cacheList.length===list.length?cacheList.forEach(function(item,index){Object.keys(item.attr).forEach(function(attr){"uin"!==attr&&"status"!==attr&&item.attr[attr]!==list[index].attr[attr]&&(equal=!1)})}):equal=!1,equal&&(list=cacheList));var checkStatusCallback=function(data,thatUin,index){data&&(thatUin.attr.status=!!data[index]&&data[index].paid,scope.uiPaymentModel&&scope.uiPaymentModel.attr&&(scope.uiPaymentModel.attr.status=thatUin.attr.status),(Array.isArray(data)?data:[]).forEach(function(pay){pay.paid&&(scope.item.sale={class:"done",title:"Вы оплатили госпошлину со скидкой 30%",text:'Оплачивайте госпошлины на Госуслугах. <a href="/help/news/oplachivayte_gosposhliny_so_skidkoy_30">Подробнее о скидке</a>'})}),scope.item.checked=!0,scope.item.uidPayment=JSON.stringify(scope.item.listPayment)),scope.timeoutRecheck&&$timeout.cancel(scope.timeoutRecheck),scope.timeoutRecheck=$timeout(function(){pguPaymentSrvc.checkStatus(scope.item.paymentCode,function(data){checkStatusCallback(data,thatUin,index)})},6e4)};"true"===$rootScope.env.formParam.isLogElForm&&$rootScope.$emit("HEALTH_SEND",{event:"logElForm",timing:0,result:4,el:$scope.model.fullPath,order_id:api.env("orderId")}),list&&list.length?(def.resolve({uidPayment:!0}),PGU.Events.publish(":widget-has-payments",{fullPath:scope.item.fullPath,uidPayment:!0})):def.resolve({uidPayment:!1});var userIndex=scope.item.paymentCode,savedUin=$rootScope.env.formOrderPayments&&$rootScope.env.formOrderPayments[userIndex];(list||[]).forEach(function(uin,index){delete uin.attr.status;var def=$q.defer(),thatUin=uin;if(scope.promise=scope.promise||[],scope.promise.push(def.promise),savedUin&&(thatUin.attr.uin=savedUin),thatUin.attr.uin)pguPaymentSrvc.checkStatus(scope.item.paymentCode,function(data){checkStatusCallback(data,thatUin,index)}),def.resolve();else{var requestBegin=(new Date).getTime();pguPaymentSrvc.getUin(uin,scope.item.parseParams,scope.item.paymentCode,function(uin){thatUin.attr.uin=uin,pguPaymentSrvc.checkStatus(scope.item.paymentCode,function(data){checkStatusCallback(data,thatUin,index)}),def.resolve()},function(error,response){if(response&&500===response.status){var errorInfo={type:"createPriorBillAuth",startTime:requestBegin,addParams:{utm_source:"createPriorBillAuth_no",epguId:api.env("orderId"),userId:api.env("user").userId,dateTime:requestBegin}};HealthSrv.checkHealthWhenError(errorInfo,response)}scope.item.errorLoad=!0})}}),savedUin&&scope.promise.push(pguPaymentSrvc.getBillDetails(savedUin)),$q.all(scope.promise).then(function(data){scope.item.listPayment=list,scope.item.uidPayment=JSON.stringify(scope.item.listPayment),scope.uiPaymentModel=JSON.parse(JSON.stringify(scope.item.listPayment[0]));var indexOfBillDetails=data.length-1;if(data&&data[indexOfBillDetails]&&Object.keys(data[indexOfBillDetails]).length)angular.extend(scope.uiPaymentModel.attr,data[indexOfBillDetails]);else if(scope.discountEnabled){var sum=scope.uiPaymentModel.attr.sum;scope.uiPaymentModel.attr.sum=(sum/100*.7).toFixed(2),scope.uiPaymentModel.attr.originalSum=(sum/100).toFixed(2)}else scope.uiPaymentModel.attr.sum=(scope.uiPaymentModel.attr.sum/100).toFixed(2);scope.uiPaymentModel.attr&&(PGU.payData.uin=scope.uiPaymentModel.attr.uin,PGU.payData.paymentPurpose=scope.uiPaymentModel.attr.paymentPurpose,PGU.payData.recipientTitle=scope.uiPaymentModel.attr.recipientTitle,PGU.payData.sum=scope.uiPaymentModel.attr.originalSum||scope.uiPaymentModel.attr.sum,scope.discountEnabled&&(PGU.payData.sumWithDiscount=scope.uiPaymentModel.attr.sum)),api.env("autosaveDisabled")||api.uploadDraft(!1,function(){scope.item.loading=!0},null,"true"!==api.env("formParam").isSaveElDraft?null:scope.item)},function(){scope.item.errorLoad=!0})},function(data){callCount||scope.item.getList(void 0,void 0,1)})};var userIndex=scope.item.paymentCode,savedUin=$rootScope.env.formOrderPayments&&$rootScope.env.formOrderPayments[userIndex];savedUin?scope.item.getList():def.resolve({uidPayment:!1}),scope.initPayment=function(){function initPayment(uin){$rootScope.disableInvitationSaveDraft=!1,api.uploadDraft(!1,function(){/^(PRIOR)/.test(uin)||(uin="PRIOR"+uin),$rootScope.initPayment(uin,!1,"","",$rootScope.env.requestUrl,{noQuittance:scope.item.ePaymentRequired,orderId:$rootScope.settings.orderId})})}savedUin?initPayment(savedUin):scope.uiPaymentModel.attr.uin?initPayment(scope.uiPaymentModel.attr.uin):scope.item.getList(function(){initPayment(scope.uiPaymentModel.attr.uin)})},scope.$emit(self.fullPath+":ScopeApplied",{scope:scope,element:element})}}}]).filter("floor",["$filter",function($filter){return function(value){if(value){value=value.toString();var fixedTo=0,fixedVal=value.split(".")[1];return fixedVal?"00"!=fixedVal&&(fixedTo=2):fixedTo=0,value=value.replace(/\s/g,""),$filter("currency")(value,"",fixedTo).trim()}}}]).factory("PaymentExt",["fieldAttrs",function(fieldAttrs){return{attrs:angular.extend({},fieldAttrs.attrs,{dictionary:{default:{}},hint:{default:[],"scope:editor":!1},notRequiredText:{default:[],"scope:editor":!1},disabled:{default:[],"scope:editor":!1,"scope:ruleEditor":!0},readonly:{default:[],"scope:editor":!1,"scope:ruleEditor":!0},immutable:{default:[],"scope:editor":!1,"scope:ruleEditor":!0},labelAlign:{default:[],"scope:editor":!1},labelWidth:{default:[],"scope:editor":!1},longLabel:{default:[],"scope:editor":!1},title:{type:"string",default:"","scope:ruleEditor":!0},paymentDescription:{type:"string",default:""},targetId:{type:"string",default:"","scope:editor":!1,"scope:sync":!0},orderId:{type:"string",default:"","scope:editor":!1,"scope:sync":!0},ePaymentRequired:{type:"boolean",default:!1},formParams:{default:"",type:"string","scope:editor":!1,"scope:sync":!0},formParamsString:{default:"code:form.FormStep5.Panel1.FiasCode,dictCode:form.FormStep10.Panel1.DictCode,filter_reg:form.FormStep5.Panel1.ZagsCode,docType:form.FormStep2.Panel1.Panel14.DocType,docSerial:form.FormStep2.Panel1.Panel11.DocSeries,docNumber:form.FormStep2.Panel1.Panel12.DocNumber,orderId:form.FormStep1.Panel1.caseNumber,snils:form.FormStep1.Panel2.Panel1_3.PanelGrid.Panel13.Snils",type:"string"},paymentCode:{type:"string",default:"1"},uidPayment:{type:"string",default:"","scope:sync":!0,"scope:editor":!1},payRemoveAllowed:{type:"boolean",default:!0,"scope:editor":!1}})}}]),angular.module("serverFormWidgets.general").directive("epguClinicExam",["$rootScope","TEMPLATES","$q","$timeout","api","PGU","ClinicExamService","sharedExtServices","pguSelectService","$moment",function($rootScope,TEMPLATES,$q,$timeout,api,PGU,ClinicExamService,sharedExtServices,pguSelectService,$moment){return{templateUrl:TEMPLATES.CLINIC_EXAM,replace:!0,scope:{item:"="},link:function(scope,element,attrs){function initTimeSlot(medItem){if(!medItem.clinicsDropdown)var clinicOrgId=medItem.availableClinicResources&&medItem.availableClinicResources[0]&&medItem.availableClinicResources[0].clinic&&medItem.availableClinicResources[0].clinic.clinicId;var timeSlot={className:"TimeSlotExt",name:"TimeSlot",visible:!0,label:"",required:!0,value:"",title:"",slotAttributes:scope.item.slotAttributes,aggSlotsParams:scope.item.aggSlotsParams,aggSlotAttributes:scope.item.aggSlotAttributes,aggBookSlotParams:scope.item.aggBookSlotParams,
slotParams:scope.item.slotParams,clinicOrganizationId:clinicOrgId||"",clinicServiceId:medItem.medicalService.serviceId,clinicResourceId:medItem.selectedResource?medItem.selectedResource.resourceId:"",clinicWidgetFullPath:scope.item.fullPath,clinicExamMode:!0,saveBookIdToDraft:!1,fullPath:(scope.item.fullPath?scope.item.fullPath+"._TimeSlotExt":"._TimeSlotExt")+"_"+medItem.id};medItem._timeSlots.push(timeSlot),api.initAttrs(medItem._timeSlots)}function updateClinicItem(clinicItem,data){var selectedClinic="";clinicItem.availableClinicResources&&clinicItem.availableClinicResources.length&&clinicItem.availableClinicResources.forEach(function(resource){resource.clinic&&"object"==typeof resource.clinic?selectedClinic=resource.clinic:resource.clinic&&resource.clinic.length&&resource.clinic.forEach(function(clinic){clinic.clinicId===(data.timeSlot&&data.timeSlot.clinicId)&&(selectedClinic=clinic)})}),clinicItem.epguStatus=statusMapping["Запланирована"],clinicItem.bookingData={bookingId:data.bookId,bookingDateTime:new Date(data.timeSlot.visitTimeStr),resource:{resourceName:clinicItem.selectedResource.resourceName,resourceId:clinicItem.selectedResource.resourceId,room:clinicItem.selectedResource.room},clinic:clinicItem.availableClinicResources.clinic||selectedClinic},clinicItem.detailUrl=(api.env("lkUrl")||"https://lk.gosuslugi.ru/")+"notifications/details/EQUEUE/"+clinicItem.bookingData.bookingId;var scrollId='[data-id="ClinicExam'+clinicItem.id+'"]';$("body").removeClass("PGU-SF-Dialog-Show"),$timeout(function(){$("html, body").animate({scrollTop:element.find(scrollId).offset().top-60},100)},500)}function setDropdownData(item,available,type){var availResource=available[type],resourcesSize="resource"===type&&available.resource&&available.resource.length,names={resource:{title:"resourceName",value:"resourceId"},clinic:{title:"clinicName",value:"clinicId"}},resourcePrototype={attributeValues:{},attributes:[],children:[],isLeaf:!0,parentValue:null},resource={};if("resource"===type){for(var resourceArr=[],i=0;i<resourcesSize;i++)resource=JSON.parse(JSON.stringify(resourcePrototype)),resource.title=availResource[i].resourceName,resource.value=availResource[i].resourceId,resourceArr.push(resource);item.resourceDD.element.list=resourceArr,1===resourcesSize&&(item.resourceDD.value(availResource[0].resourceId),item.selectedResource=availResource[0])}else resource.title=availResource[names[type].title],resource.value=availResource[names[type].value],item.clinicsDD.element.list.push(resource)}function createClinicsDropdown(item,id){item.clinicsDD=api.crateApiElement(scope.item.fullPath+"._clinicsDropdown_"+id),item.clinicsDD.element.list=[],scope.ui.clinicsDropdown.medResourceCallback=function(data){item.hideSlotSelectLink=!1,item.timeSlotOpen=!1;var setNullParameters=function(){item.selectedResource={},item.clinicData={},item.resourceDropdown&&(item.resourceDropdown=[])};""===data?(setNullParameters(),item.selectedResource=void 0,item.selectedClinicResource={},item.hideSlotSelectLink=!0):item.availableClinicResources.forEach(function(res,index){res.clinic&&res.clinic&&res.clinic.clinicId&&res.clinic.clinicId===data&&(setNullParameters(),item.selectedClinicResource=res,item.selectedClinic=res.clinic,item._timeSlots[0].clinicOrganizationId=res.clinic.clinicId,item.clinicData.clinic=res.clinic,createDropDown(item,index,"resource"))})},item.clinicsDropdown.push(angular.extend({},scope.ui.clinicsDropdown,{fullPath:(scope.item.fullPath?scope.item.fullPath+"._clinicsDropdown":"._clinicsDropdown")+"_"+id})),api.initAttrs(item.clinicsDropdown),item.clinicsDD=api.find(scope.item.fullPath+"._clinicsDropdown_"+id),item.clinicsDD.element.list=[],item.availableClinicResources.forEach(function(resource){setDropdownData(item,resource,"clinic")})}function createDropDown(item,id,type){item.clinicsDropdown?scope.ui.resourceDropdown.medResourceCallback=function(data){item.hideSlotSelectLink=!1,item.timeSlotOpen=!1,""===data?(item.selectedResource=void 0,item.hideSlotSelectLink=!0):(item.selectedResource={},item.availableClinicResources.forEach(function(el){el.resource&&el.resource.forEach(function(res){res.resourceId===data&&(item.selectedResource=res)})}))}:scope.ui.resourceDropdown.medResourceCallback=function(data){item.timeSlotOpen=!1,item.hideSlotSelectLink=!1,""===data?(item.selectedResource=void 0,item.hideSlotSelectLink=!0):(item.selectedResource={},item.availableClinicResources[0].resource&&item.availableClinicResources[0].resource.forEach(function(el){el.resourceId===data&&(item.selectedResource=el)}))},item.resourceDropdown.push(angular.extend({},scope.ui.resourceDropdown,{fullPath:(scope.item.fullPath?scope.item.fullPath+"._resourceDropdown":"._resourceDropdown")+"_"+id,isMedResource:!0})),api.initAttrs(item.resourceDropdown),item.resourceDD=api.find(scope.item.fullPath+"._resourceDropdown_"+id),item.resourceDD.element.list=[],item.clinicsDropdown&&type&&"resource"!==type?setDropdownData(item,item.selectedClinicResource,"clinic"):type&&"resource"===type?setDropdownData(item,item.selectedClinicResource,"resource"):setDropdownData(item,item.availableClinicResources[0],"resource")}function prepareClinicData(items){var innerObj={};innerObj.resource=[];for(var i=0;i<items.length;i++){var item=items[i];switch(item.title){case"Clinic_text":innerObj.clinic={clinicName:item.attributeValues.ClinicName,clinicId:item.attributeValues.ClinicId,clinicAddress:item.attributeValues.ClinicAddress};break;case"Resource_text":var resource={resourceName:item.attributeValues.ResourceName,resourceId:item.attributeValues.ResourceId,room:item.attributeValues.Room};item.attributeValues.SlotId&&item.attributeValues.SlotDateTime&&(resource.recommendedSlot={slotDateTime:item.attributeValues.SlotDateTime,slotId:item.attributeValues.SlotId}),innerObj.resource.push(resource)}}return innerObj}function prepareMedData(items,obj,medicalData,isBookingData,clinicIndex){for(var i=0;i<items.length;i++){var item=items[i];if(item.parentValue)switch(innerObj=obj,item.title){case"BookingData":innerObj.bookingData={bookingDateTime:item.attributeValues.BookingDateTime},item.attributeValues.BookingId&&(innerObj.bookingData.bookingId=item.attributeValues.BookingId),prepareMedData(item.children,innerObj,medicalData,!0);break;case"Clinic_text":innerObj[isBookingData?"bookingData":"availableClinicResources"].clinic={clinicName:item.attributeValues.ClinicName,clinicId:item.attributeValues.ClinicId,clinicAddress:item.attributeValues.ClinicAddress};break;case"Resource_text":if(isBookingData)innerObj.bookingData.resource={resourceName:item.attributeValues.ResourceName,resourceId:item.attributeValues.ResourceId,room:item.attributeValues.Room};else{var resource={resourceName:item.attributeValues.ResourceName,resourceId:item.attributeValues.ResourceId,room:item.attributeValues.Room};item.attributeValues.SlotId&&item.attributeValues.SlotDateTime&&(resource.recommendedSlot={slotDateTime:item.attributeValues.SlotDateTime,slotId:item.attributeValues.SlotId}),innerObj.availableClinicResources.resource.push(resource)}break;case"AvailableClinicResources":innerObj.availableClinicResources||(innerObj.availableClinicResources=[]);var clinicObject=prepareClinicData(item.children);innerObj.availableClinicResources.push(clinicObject)}else{var innerObj={};innerObj.medicalService={serviceName:item.title,serviceId:item.value},innerObj.serviceStatus=item.attributeValues.ServiceStatus,innerObj.required=item.attributeValues.Required,"Недоступна"===innerObj.serviceStatus&&(innerObj.unavailableReason=item.attributeValues.UnavailableReason),prepareMedData(item.children,innerObj,medicalData),medicalData.push(innerObj)}}}var watchers,statusMapping={"Оказана":{value:"provided",title:"Услуга оказана"},"Запланирована":{value:"planned",title:"Запись подтверждена"},"Недоступна":{value:"unavailable",title:""},"Доступна":{value:"available",title:"Доступно для записи"}};scope.isPhone=device.mobile(),scope.$on("suspend",function(){watchers=scope.$$watchers,scope.$$watchers=[]}),scope.$on("resume",function(){scope.$$watchers=watchers,watchers=null}),scope._chosenMedItem=void 0,scope.questionHelper={hasEsiaHint:!1,hintHtml:"Специалист или место, которое вы выбрали при записи. Это может быть ФИО врача или место проведения процедуры, например флюорографический кабинет.",ui:{deviceShow:!0}},scope.ui={resourceDropdown:{className:"FieldDropdown",name:"ResourceDropdown",label:"Специалист",selectType:"FieldDropdownExt",visible:!0,required:!0,availableForHide:!1,withoutCache:!1,getFullResult:!1,searchBar:!1,searchFromServer:!1,isOnlySearch:!0,medResourceDropdown:!0},clinicsDropdown:{className:"FieldDropdown",name:"ClinicsDropdown",label:"Место приема",selectType:"FieldDropdownExt",visible:!0,required:!0,availableForHide:!1,withoutCache:!1,getFullResult:!1,searchBar:!1,searchFromServer:!1,isOnlySearch:!0,medResourceDropdown:!0}},scope.ui.closePopup=function(event){event.preventDefault(),event.stopPropagation();var scrollId='[data-id="ClinicExam'+scope.scrollItemId+'"]';$("html, body").animate({scrollTop:element.find(scrollId).offset().top-60},100),scope.showCard=!scope.showCard},scope.ui.openSlots=function(event,medItem){if(event.preventDefault(),event.stopPropagation(),!medItem.timeSlotOpen){medItem.timeSlotOpen=!0,medItem.canHideTimeSlot=!1,medItem.resourceDD.disabled(!0);var currentTimeSlot=api.find(scope.item.fullPath+"._TimeSlotExt_"+medItem.id);currentTimeSlot.attr("clinicFullSlotMode",!0),currentTimeSlot.attr("clinicResourceId",medItem.selectedResource.resourceId),currentTimeSlot.attr("calendarName",medItem.medicalService.serviceName),medItem.clinicsDropdown?(currentTimeSlot.attr("orgName",medItem.selectedClinic.clinicName),currentTimeSlot.attr("address",medItem.selectedClinic.clinicAddress)):(currentTimeSlot.attr("orgName",medItem.availableClinicResources[0].clinic.clinicName),currentTimeSlot.attr("address",medItem.availableClinicResources[0].clinic.clinicAddress)),currentTimeSlot.attr("recommendedSlotDateTime",""),currentTimeSlot.element.getList(function(){medItem.canHideTimeSlot=!0,medItem.resourceDD.disabled(!1)}),scope._chosenMedItem=void 0}medItem.canHideTimeSlot&&medItem.timeSlotOpen&&(medItem.timeSlotOpen=!medItem.timeSlotOpen),PGU.medExamData.medObject=medItem.selectedResource,PGU.medExamData.needMedParams=!0},scope.item.handleBooking=function(data){scope._chosenMedItem=scope.item.medicalData.find(function(item){return item.medicalService.serviceId===data.timeSlot.serviceId}),scope._chosenMedItem.preCancel=!1,updateClinicItem(scope._chosenMedItem,data)},scope.item.handleCancelBooking=function(data,medItemId,errorText){var medItem=scope.item.medicalData.find(function(item){return item.id===medItemId});errorText||(medItem.epguStatus=statusMapping["Доступна"],delete medItem.bookingData,medItem.placement="full",medItem.timeSlotOpen=!1,scope.item.getList(function(){$timeout(function(){var scrollId='[data-id="ClinicExam'+medItemId+'"]';$("html, body").animate({scrollTop:element.find(scrollId).offset().top-60},100)})})),medItem.errorText=errorText,medItem.preCancel=!1},scope.item.getList=function(callback){scope.item.loading=!0,scope.item.dataError=!1,ClinicExamService.getClinicExamInfo(scope.item,function(data){scope.item.medicalData=[],prepareMedData(data.items,{},scope.item.medicalData),scope.item.loading=!1,angular.forEach(scope.item.medicalData,function(item,index){item.epguStatus=statusMapping[item.serviceStatus],item.id=index,item.resourceDropdown=[],item.canHideTimeSlot=!0,item._timeSlots=[],item.bookingData?(item.detailUrl=(api.env("lkUrl")||"https://lk.gosuslugi.ru/")+"notifications/details/EQUEUE/"+item.bookingData.bookingId,item.placement="three-quarter"):item.placement="full","available"!==item.epguStatus.value&&"planned"!==item.epguStatus.value||(item.availableClinicResources&&(item.availableClinicResources.length&&item.availableClinicResources.length>1?(item.clinicsDropdown=[],createClinicsDropdown(item,item.id)):createDropDown(item,item.id)),initTimeSlot(item))}),scope.item.loading=!1,callback&&callback()},function(){scope.item.dataError=!0})},scope.openClinicPopup=function(event,medClinic,scrollItemId){event.preventDefault(),event.stopPropagation(),scope.showCard=!0,scope.scrollItemId=scrollItemId,scope.ui.popupInfo={clinicName:medClinic.clinicName,clinicAddress:medClinic.clinicAddress},scope.ui.popupInfo._medMap=[];var fieldMap={className:"FieldMap",name:"FieldMap",visible:!0,label:"",required:!0,value:medClinic.clinicAddress,fullPath:scope.item.fullPath?scope.item.fullPath+"._FieldMap":"._FieldMap"};scope.ui.popupInfo._medMap.push(fieldMap),api.initAttrs(scope.ui.popupInfo._medMap)},scope.bookToRecommended=function(event,medItem){event.preventDefault(),event.stopPropagation();var currentTimeSlot=api.find(scope.item.fullPath+"._TimeSlotExt_"+medItem.id),recommendedSlot=medItem.selectedResource.recommendedSlot;recommendedSlot.slotDateTime=$moment.parseZone(recommendedSlot.slotDateTime);var slot={visitTimeFromIso:$moment(recommendedSlot.slotDateTime).format("HH:mm"),slotId:recommendedSlot.slotId,attributes:[],slotDateTime:$moment(recommendedSlot.slotDateTime).format("YYYY-MM-DDTHH:mm:ssZ")};scope._chosenMedItem=medItem,scope.item.fastBook=!0,PGU.medExamData.medObject=medItem.selectedResource,PGU.medExamData.needMedParams=!0,medItem.clinicsDropdown?(currentTimeSlot.attr("orgName",medItem.selectedClinic.clinicName),currentTimeSlot.attr("address",medItem.selectedClinic.clinicAddress)):(currentTimeSlot.attr("orgName",medItem.availableClinicResources[0].clinic.clinicName),currentTimeSlot.attr("address",medItem.availableClinicResources[0].clinic.clinicAddress)),currentTimeSlot.attr("clinicResourceId",medItem.selectedResource.resourceId),currentTimeSlot.attr("calendarName",medItem.medicalService.serviceName),currentTimeSlot.attr("recommendedSlotDateTime",recommendedSlot.slotDateTime),medItem.timeSlotOpen||currentTimeSlot.attr("clinicFullSlotMode",!1),currentTimeSlot.element.showClinicDialog(slot)},scope.checkEmpty=function(obj){return $.isEmptyObject(obj)},scope.cancelBook=function(medItem){medItem.preCancel=!0;var currentTimeSlot=api.find(scope.item.fullPath+"._TimeSlotExt_"+medItem.id);currentTimeSlot.value(medItem.bookingData.bookingId),currentTimeSlot.element.eqServiceId=scope.item.eqServiceId,currentTimeSlot.attr("clinicFullSlotMode",!1),currentTimeSlot.element.cancelClinicBooking(medItem.id)}}}}]).filter("rusTimeDate",["$moment",function($moment){return function(date){return $moment.parseZone(date).format("HH:mm, DD MMMM YYYY")}}]).factory("ClinicExamExt",["fieldAttrs",function(fieldAttrs){return{attrs:angular.extend({},fieldAttrs.attrs,{dictionary:{default:{type:"remote",refName:"MINZDRAV"},"scope:editor":!1},disabled:{default:[],"scope:editor":!1},immutable:{default:[],"scope:editor":!1},title:{type:"string",default:""},requestBinding:{default:[],"scope:editor":!1},responseBinding:{default:[],"scope:editor":!1},slotAttributes:{default:[],"scope:editor":!1},aggSlotsParams:{default:[],"scope:editor":!1},aggSlotAttributes:{default:[],"scope:editor":!1},aggBookSlotParams:{default:[],"scope:editor":!1},slotParams:{default:[],"scope:editor":!1},eqBindings:{default:[]},eqServiceId:{default:""}})}}]).factory("ClinicExamService",["pguSelectService","api",function(pguSelectService,api){return{getClinicExamInfo:function(item,callback,errorCallback){pguSelectService.loadDataFromServer({refName:item.dictionary.code,filter:item.filter,item:item},function(data){data&&data.error&&0===data.error.code?callback(data):errorCallback()},!0)}}}]),angular.module("serverFormWidgets.general").directive("epguElectronMedicalDocs",["TEMPLATES","api","$rootScope","ElectronMedicalDocsService","apiInner","declineOfUnit","$moment","$timeout",function(TEMPLATES,api,$rootScope,ElectronMedicalDocsService,apiInner,declineOfUnit,$moment,$timeout){return{templateUrl:TEMPLATES.ELECTRON_MEDICAL_DOCS,replace:!0,scope:{item:"=?"},link:function(scope,element,attrs){function setDefaultState(){scope.allPages=void 0,scope.canShowMoreLists=!1,scope.listsCount=0,scope.currentPage=1}function setDefaultFilter(isInit){var dateTo=api.find(ElectronMedicalDocsService.filtersPanelPath+".PanelDateTo.DateTo"),dateFrom=api.find(ElectronMedicalDocsService.filtersPanelPath+".PanelDateFrom.DateFrom");ElectronMedicalDocsService.filtersRequestStructure.forEach(function(codes){var field=api.find(ElectronMedicalDocsService.filtersPanelPath+".Panel"+codes.code+"."+codes.code);"DocumentDate"!==codes.code&&(isInit?field.attr("doNotShowInPdf",!0).attr("doNotSaveDraft",!0):field.value(""))}),isInit?(dateFrom.value($moment(dateTo.value(),"DD.MM.YYYY").subtract(1,"year").format("DD.MM.YYYY")).attr("doNotShowInPdf",!0).attr("doNotSaveDraft",!0),dateTo.attr("doNotShowInPdf",!0).attr("doNotSaveDraft",!0)):(dateTo.value(scope.defaultDateTo),dateFrom.value($moment(scope.defaultDateTo,"DD.MM.YYYY").subtract(1,"year").format("DD.MM.YYYY")))}function toggleDisabledCheckboxes(disable){scope.item.documents.forEach(function(item){item.checkbox.checked||(item.checkbox.disabled=disable)})}function scrollLine(){var scrollTop=$(document).scrollTop(),innerHeight=document.documentElement.clientHeight,footerOffset=$("#footer-wrapper").offset().top;scrollTop+innerHeight>=footerOffset?$(".selected-documents-line-block").css("bottom",scrollTop+innerHeight-footerOffset):$(".selected-documents-line-block").css("bottom",0)}function getListDocuments(isFirstRequest,isForceUpdate,updateData){scope.lineSelect.checkbox.model.checked=!1,scope.lineSelect.checkbox.model.value="false",scope.someoneChecked=!1,ElectronMedicalDocsService.getDocuments(api.env("user"),api.env("orderId"),isFirstRequest,isForceUpdate,updateData).then(function(response){scope.error=!1,scope.errorType="";var data=response.docsData,filteredCount=data.filteredCount;response.defaultFilter&&(scope.lastRequestWithDefaultFilter=!0),(isFirstRequest||isForceUpdate)&&(scope.updated=response.updated||"");var list=data.data.map(function(item){return item.checkbox={checked:!1,value:"false"},item.toggleCheckbox=function(isChecked){var boo=apiInner.toBoolean(isChecked);scope.lineSelect.select.now+=boo?1:-1;var checkedMax=20===scope.lineSelect.select.now;scope.someoneChecked=!!boo||scope.item.documents.some(function(item){return item.checkbox.checked}),checkedMax?(scope.checkboxesDisabled=!0,toggleDisabledCheckboxes(!0)):scope.checkboxesDisabled&&(scope.checkboxesDisabled=!1,toggleDisabledCheckboxes(!1))},item.showMoreInfo=!1,item.DoctorList=item.DoctorList||{},item.DoctorList.Doctor=item.DoctorList.Doctor||[],item.Doctors=[].concat(item.DoctorList.Doctor),item});filteredCount>20?(scope.allPages||(scope.allPages=(filteredCount/20).toFixed(),filteredCount%20>0&&scope.allPages++),scope.currentPage!==scope.allPages?(scope.currentPage++,scope.canShowMoreLists=!0):scope.canShowMoreLists=!1,scope.listsCount=filteredCount):setDefaultState(),updateData&&updateData.pageNum>0?(scope.item.documents=scope.item.documents.concat(list),scope.lineSelect.select.all=20,scope.lineSelect.checkbox.show=!1,20===scope.lineSelect.select.now&&(scope.checkboxesDisabled=!1,toggleDisabledCheckboxes(!1))):(scope.item.documents=list,scope.lineSelect.select.now=0,scope.lineSelect.select.all=data.pagedCount,scope.lineSelect.checkbox.show=!0,api.scrollTo(ElectronMedicalDocsService.filtersStepPath)),scope.listsShowed=scope.item.documents.length,scope.lineSelect.question.show=filteredCount>20,scope.subTitleNumOfDocs=filteredCount+declineOfUnit.get(filteredCount,[" запись"," записи"," записей"]),api.find(ElectronMedicalDocsService.filtersStepPath).title("Уточните запрос").shaded(!1),scope.recountScrollLine()},function(error){scope.error=!0,scope.errorType="error",error.error?scope.errorType="error":error.loadingData?(scope.errorType="loadingData",scope.expired=error.expired,api.find(ElectronMedicalDocsService.filtersStepPath).title("Медицинские документы не загружены")):error.noData?(scope.errorType="noData",scope.updated=error.updated,api.find(ElectronMedicalDocsService.filtersStepPath).title("Медицинские документы не найдены")):error.noFilteredData&&(scope.errorType="noFilteredData",scope.documents=[],setDefaultState()),error.noFilteredData||api.find(ElectronMedicalDocsService.filtersPanelPath).visible(!1),api.find(ElectronMedicalDocsService.filtersStepPath).shaded(!1),api.scrollTo(ElectronMedicalDocsService.filtersStepPath)})}if(!$rootScope.isDesigner){scope.listsShowed=0,scope.isPhone=device.mobile(),scope.item.documents=[],scope.currentPage=1,scope.canShowMoreLists=!1,scope.sort="DESC",scope.changeSortType=function(way){scope.sort=way},scope.defaultDateTo=api.find(ElectronMedicalDocsService.filtersPanelPath+".PanelDateTo.DateTo").value(),scope.lineSelect={},scope.lineSelect.select={},scope.lineSelect.select.now=0,scope.lineSelect.select.all=0,scope.lineSelect.checkbox={},scope.lineSelect.checkbox.show=!1,scope.lineSelect.checkbox.model={checked:!1,value:"false",label:"Выбрать все",labelToLeft:!0},scope.lineSelect.question={},scope.lineSelect.question.item={hasEsiaHint:!1,hintHtml:"В один запрос может входить не более 20 документов. Если вы хотите получить больше документов, сделайте несколько запросов.",ui:{deviceShow:!0}},scope.lineSelect.checkbox.toggleCheckbox=function(isChecked){var boo=apiInner.toBoolean(isChecked);scope.item.documents.forEach(function(item){item.checkbox.checked=boo,item.checkbox.value=isChecked}),scope.someoneChecked=apiInner.toBoolean(isChecked),scope.lineSelect.select.now=boo?scope.lineSelect.select.all:0},scope.lineSelect.sendForm=function(){api.shade(!0),api.find(ElectronMedicalDocsService.filtersStepPath).title("Выбранные медицинские документы"),api.stepList()[0].submit("submit",0,{done:function(data){data&&data.error&&"0"==data.error.code&&api.generateServerPdf().done(function(){api.submit("submit",0,{done:function(){window.location=$rootScope.lkUrl+"notifications/details/ORDER/"+api.env("orderId")}})})},error:function(e){}},void 0,!0)},scope.requestWithFilter=function(){scope.lastRequestWithFilter=!0,scope.lastRequestWithDefaultFilter=!1,setDefaultState(),getListDocuments(!1)},scope.refresh=function(){api.find(ElectronMedicalDocsService.filtersStepPath).shaded(!0),api.scrollTo(ElectronMedicalDocsService.filtersStepPath),scope.lastRequestWithFilter=!1,scope.lastRequestWithDefaultFilter=!1,setDefaultState(),setDefaultFilter(),getListDocuments(!0,!0)},scope.showMoreDocs=function(){getListDocuments(!1,!1,{lastRequestWithFilter:scope.lastRequestWithFilter,lastRequestWithDefaultFilter:scope.lastRequestWithDefaultFilter,pageNum:scope.currentPage})},api.scrollTo(ElectronMedicalDocsService.filtersStepPath),api.find(ElectronMedicalDocsService.filtersStepPath).title("Уточните запрос").shaded(!0),getListDocuments(!0),setDefaultFilter(!0),scope.recountScrollLine=function(){$timeout(scrollLine,0,!1)},$(document).scroll(scrollLine),scope.$on("$destroy",function(){$(document).off(scrollLine)});var watchers;scope.$on("suspend",function(){watchers=scope.$$watchers,scope.$$watchers=[]}),scope.$on("resume",function(){scope.$$watchers=watchers,watchers=null})}}}}]).factory("ElectronMedicalDocsExt",["containerAttrs",function(containerAttrs){return{attrs:angular.extend({},containerAttrs.attrs,{html:{"scope:editor":!1}})}}]).factory("ElectronMedicalDocsService",["$rootScope","sharedExtServices","$q","$moment","api",function($rootScope,sharedExtServices,$q,$moment,api){return{getDocuments:function(userData,orderId,isFirstRequest,isForceUpdate,updateData){var self=this,df=$q.defer();if(isFirstRequest){var params=this.getMarkerRequestStructure(userData,orderId,isForceUpdate);sharedExtServices.markerDictionary("getDocumentList66172",params).then(function(data){data&&"D"===data.state?self.getElectronMedicalDocsAndFilters(orderId,df,isFirstRequest,data.result_ts):data&&"P"===data.state&&df.reject({loadingData:!0,expired:$moment(data.exp).format("DD.MM.YYYY, HH:mm")})},function(){df.reject({error:!0})})}else self.getElectronMedicalDocsAndFilters(orderId,df,isFirstRequest,void 0,updateData);return df.promise},getElectronMedicalDocsAndFilters:function(orderId,mainDf,isFirstRequest,updated,updateData){var self=this,docsDf=$q.defer(),filtersDf=$q.defer(),params=self.getFilteredRequestStructure(isFirstRequest,!1,updateData);sharedExtServices.ElectronMedicalDocsService.getDocs(orderId,params,function(data){if(data&&data.filteredCount>0){var tmp={data:data,defaultFilter:isFirstRequest||updateData&&updateData.lastRequestWithDefaultFilter};updated&&(tmp.updated=$moment(updated).format("DD.MM.YYYY, HH:mm")),docsDf.resolve(tmp)}else if(isFirstRequest&&data&&0===data.filteredCount){api.find(self.filtersPanelPath+".PanelDateFrom.DateFrom").value("");var paramsWithoutFilter=self.getFilteredRequestStructure(!1,!0);sharedExtServices.ElectronMedicalDocsService.getDocs(orderId,paramsWithoutFilter,function(data){data&&data.filteredCount>0?docsDf.resolve({data:data}):(mainDf.reject({noData:!0,updated:$moment(updated).format("DD.MM.YYYY, HH:mm")}),docsDf.reject({noData:!0}))})}else!isFirstRequest&&data&&0===data.filteredCount?(mainDf.reject({noFilteredData:!0}),filtersDf.reject()):docsDf.reject()},function(error){docsDf.reject()}),docsDf.promise.then(function(docsData){var res={docsData:docsData.data,hasFilter:!1,defaultFilter:docsData.defaultFilter};docsData.updated&&(res.updated=docsData.updated),isFirstRequest?sharedExtServices.ElectronMedicalDocsService.getFilters(orderId,self.filtersRequestStructure,function(data){data&&data.length?(res.hasFilter=!1,data.forEach(function(item){item.values&&item.values.length&&(api.find(self.filtersPanelPath+".Panel"+item.code+"."+item.code).setCustomList(item.values),res.hasFilter=!0)}),filtersDf.resolve(res)):(mainDf.reject({noData:!0,updated:$moment(updated).format("DD.MM.YYYY, HH:mm")}),filtersDf.reject())},function(){filtersDf.resolve(res)}):docsData.data.filteredCount>0?(res.hasFilter=!0,filtersDf.resolve(res)):(mainDf.reject({noFilteredData:!0}),filtersDf.reject())},function(e){e&&e.noData||(mainDf.reject({error:!0}),filtersDf.reject())}),filtersDf.promise.then(function(data){api.find(self.filtersPanelPath).visible(data.hasFilter),mainDf.resolve(data)},function(){})},getMarkerRequestStructure:function(userData,orderId,isForceUpdate){var obj={treeFiltering:"ONELEVEL",filter:{union:{unionKind:"AND",subs:[{simple:{attributeName:"FamilyName",condition:"EQUALS",value:{asString:userData.lastName}}},{simple:{attributeName:"FirstName",condition:"EQUALS",value:{asString:userData.firstName}}},{simple:{attributeName:"Patronymic",condition:"EQUALS",value:{asString:userData.middleName}}},{simple:{attributeName:"BirthDate",condition:"EQUALS",value:{asString:$moment(userData.birthDate,"DD.MM.YYYY").format("YYYY-MM-DD")}}},{simple:{attributeName:"Gender",condition:"EQUALS",value:{asString:"M"===userData.gender?"Male":"Female"}}},{simple:{attributeName:"SNILS",condition:"EQUALS",value:{asString:userData.snils&&userData.snils.replace(/-/g,"").replace(/ /g,"")}}}]}},parentRefItemValue:"",selectAttributes:["*"],tx:"EPGU",pid:orderId};return isForceUpdate&&(obj.forceUpdate=!0),obj},getFilteredRequestStructure:function(isFirstRequest,isRetry,updateData){var self=this,defaultFilter={selectElementName:"Document",pageNum:updateData&&updateData.pageNum||1,pageSize:20};if(defaultFilter.sort=[{attributeName:"DocumentDate",direction:"DESC",type:"DATE"}],isFirstRequest||updateData&&updateData.lastRequestWithDefaultFilter)defaultFilter.filter={union:{unionKind:"AND",subs:[{simple:{attributeName:"DocumentDate",condition:"GREATER_THAN_OR_EQUALS",value:{asDate:$moment().subtract(1,"year").toISOString()}}},{simple:{attributeName:"DocumentDate",condition:"LESS_THAN_OR_EQUALS",value:{asDate:$moment().toISOString()}}}]}};else if(!isRetry||updateData&&updateData.lastRequestWithFilter){var dateFrom=api.find(self.filtersPanelPath+".PanelDateFrom.DateFrom").value(),dateTo=api.find(self.filtersPanelPath+".PanelDateTo.DateTo").value(),filterPart=[];(dateFrom||dateTo)&&(dateFrom&&filterPart.push({simple:{attributeName:"DocumentDate",condition:"GREATER_THAN_OR_EQUALS",value:{asDate:$moment(dateFrom,"DD.MM.YYYY").toISOString()}}}),dateTo&&filterPart.push({simple:{attributeName:"DocumentDate",condition:"LESS_THAN_OR_EQUALS",value:{asDate:$moment(dateTo,"DD.MM.YYYY").toISOString()}}})),this.filtersRequestStructure.forEach(function(codes){if("DocumentDate"!==codes.code){var filterValue=api.find(self.filtersPanelPath+".Panel"+codes.code+"."+codes.code).text_value();filterValue&&filterPart.push({simple:{attributeName:codes.code,condition:"EQUALS",value:{asString:filterValue}}})}}),filterPart.length&&filterPart.length>1?defaultFilter.filter={union:{unionKind:"AND",subs:filterPart}}:1===filterPart.length&&(defaultFilter.filter=filterPart[0])}return defaultFilter},filtersRequestStructure:[{code:"DocumentDate"},{code:"MedicalOrganization"},{code:"DocumentType"},{code:"DiseaseDiagnosis"},{code:"MedicalSpecialty"},{code:"DoctorName"}],filtersPanelPath:"form.FormStep_medDocs.PanelFilters",filtersStepPath:"form.FormStep_medDocs"}}]),angular.module("serverFormWidgets.general").directive("epguInformer",["TEMPLATES","api","$compile","informerProperties","sharedExtServices","$timeout",function(TEMPLATES,api,$compile,formProperties,sharedExtServices,$timeout){return{replace:!0,templateUrl:TEMPLATES.INFORMER,scope:{item:"="},controller:["$rootScope","$scope",function($rootScope,$scope){$scope.item.loader=!0;var watchers;$scope.$on("suspend",function(){watchers=$scope.$$watchers,$scope.$$watchers=[]}),$scope.$on("resume",function(){$scope.$$watchers=watchers,watchers=null});var parseFSResponse=function(response){var out={total:0,items:[],request:{},info:{},error:{code:0,message:"Операция выполнена успешно"}},reservedFields=["total","requestParams","requestInfo","personalData"];if(response&&response.error&&0===response.error.code)if(response.form.content.error&&response.form.content.error.code&&"0"!==response.form.content.error.code)out.error=response.form.content.error;else{var c=response.form.content;c.total&&c.total.total&&(out.total=c.total.total),c.requestParams&&(out.request=c.requestParams),c.requestInfo&&(out.info=c.requestInfo),$.each(c,function(k,v){reservedFields.indexOf(k)>=0||out.items.push(v)})}else out.error={code:-1,message:"Сервис временно недоступен"};return out};$rootScope.isDesigner||sharedExtServices.fetchInformer({typeInformer:$scope.item.typeInformer},function(response){$scope.$apply(function(){$scope.item.loader=!1,response&&0==response.error.errorCode?$scope.item.out=parseFSResponse(JSON.parse(response.content)):(response&&5==response.error.errorCode&&($scope.notUseForm=!0),$scope.item.error=!0)})})}],link:function($scope,element,attrs){$scope.item.attrs={},formProperties.init($scope.item.attrs),$scope.$emit($scope.item.fullPath+":ScopeApplied",{scope:$scope,element:element})}}}]).factory("informerProperties",["containerAttrs",function(containerAttrs){return{init:function(m){angular.extend(m,containerAttrs.attrs,this.getAttrs())},getAttrs:function(){return{presetType:{type:"string",default:"sf","scope:editor":!1},typeInformer:{type:"string",enum:["gibdd","fns","fssp"],enumOptions:{gibdd:"ГИБДД",fns:"ФНС",fssp:"ФССП"},default:"fns"},loadingText:{type:"string",default:"Данные обновляются..."},foundText:{type:"string",default:"Сумма задолженностей"},notFoundText:{type:"string",default:"Задолженностей не найдено"},notUseForm:{type:"string",default:"Пожалуйста, заполните форму"},errorText:{type:"string",default:"Произошла ошибка. Попробуйте воспользоваться услугой позже"},height:{type:"string",default:"200"},width:{type:"string",default:"200"}}}}}]),angular.module("serverFormWidgets.general").directive("epguInformerNotify",["$window","TEMPLATES","api","$compile","sharedExtServices","$timeout","epguInformerService","LOC",function($window,TEMPLATES,api,$compile,sharedExtServices,$timeout,epguInformerService,LOC){return{templateUrl:TEMPLATES.INFORMER_NOTIFY,scope:{item:"="},controller:["$rootScope","$scope",function($rootScope,$scope){function goToInformersResult(code,state){
opStatisticData.type="goToForm-"+$scope.item.typeInformer,window.postMessage(JSON.stringify({id:"widget.display",pguData:opStatisticData}),"*"),$window.location.href=epguInformerService.setInformerResultPath(code,state)}var opStatisticData={userId:$rootScope.env.user.userId,view:$rootScope.inOpWidgetIframe?"IFRAME":"INLINE",srcUrl:$rootScope.inOpWidgetIframe?$rootScope.settings.srcUrl:location.href};$scope.versionDesk=$rootScope.device.desktop,$scope.item.informerHandleClick=function(code,state,$event){$scope.item.typeInformer&&(angular.element($event.target).hasClass("js-update-el")?($scope.item.state="U",epguInformerService.initInformer($scope.item.typeInformer,!0,informerCallback),opStatisticData.type="RefreshInformer-"+$scope.item.typeInformer,window.postMessage(JSON.stringify({id:"widget.display",pguData:opStatisticData}),"*")):goToInformersResult(code,state))},$scope.getInformerItemsLength=function(informerData){return epguInformerService.getInformerItemsLength(informerData)},$scope.setInformerCls=function(informer){return epguInformerService.setInformerCls("epgu-informer-notify",informer)};var parseFSResponse=function(response){var out={total:0,items:[],request:{},info:{},error:{code:0,message:"Операция выполнена успешно"}},reservedFields=["total","requestParams","requestInfo","personalData"];if(response&&response.error&&0===response.error.code)if(response.form.content.error&&response.form.content.error.code&&"0"!==response.form.content.error.code)out.error=response.form.content.error;else{var c=response.form.content;c.total&&c.total.total&&(out.total=c.total.total),c.requestParams&&(out.request=c.requestParams),c.requestInfo&&(out.info=c.requestInfo),$.each(c,function(k,v){reservedFields.indexOf(k)>=0||out.items.push(v)})}else out.error={code:-1,message:"Сервис временно недоступен"};return out},informerCallback=function(response){$scope.$apply(function(){if(!response||response&&response.error&&0!=response.error.errorCode){switch(response&&response.error&&response.error.errorCode||!1){case 9:$scope.item.state="D";break;case 8:$scope.item.state="F";break;case 4:$scope.item.state="H";break;default:$scope.item.state="F"}opStatisticData.type="ErrorLoadData-"+$scope.item.typeInformer,window.postMessage(JSON.stringify({id:"widget.display",pguData:opStatisticData}),"*")}else{$scope.item.out=parseFSResponse(JSON.parse(response.content));var errorCode=$scope.item.out.error.code;99==errorCode||100==errorCode?$scope.item.state="F":67==errorCode?$scope.item.state="H":0!=errorCode?$scope.item.state="D":($scope.item.state="E","gibdd"===$scope.item.typeInformer&&($scope.item.withDiscounts=epguInformerService.detectGibddDiscounts($scope.item.out))),opStatisticData.type="SuccessLoadData-"+$scope.item.typeInformer,window.postMessage(JSON.stringify({id:"widget.display",pguData:opStatisticData}),"*")}})};$rootScope.isDesigner||($scope.item.state="U",epguInformerService.initInformer($scope.item.typeInformer,!1,informerCallback))}],link:function(scope,element,attrs){var watchers;scope.$on("suspend",function(){watchers=scope.$$watchers,scope.$$watchers=[]}),scope.$on("resume",function(){scope.$$watchers=watchers,watchers=null}),scope.$emit(scope.item.fullPath+":ScopeApplied",{scope:scope,element:element})}}}]).factory("InformerNotifyExt",["containerAttrs",function(containerAttrs){return{attrs:angular.extend({},containerAttrs.attrs,{presetType:{type:"string",default:"sf","scope:editor":!1},typeInformer:{type:"string",enum:["gibdd","fns","fssp"],enumOptions:{gibdd:"ГИБДД",fns:"ФНС",fssp:"ФССП"},default:"fns"},loadingText:{type:"string",default:"Данные обновляются..."},foundText:{type:"string",default:"Сумма задолженностей"},notFoundText:{type:"string",default:"Задолженностей не найдено"},notUseForm:{type:"string",default:"Пожалуйста, заполните форму"},errorText:{type:"string",default:"Произошла ошибка. Попробуйте воспользоваться услугой позже"},title:{type:"string",default:""},discountMessage:{type:"string",default:""},successMessage:{type:"string",default:"Не найдено"},disabledMessage:{type:"string",default:"Получить услугу"},errorMessage:{type:"string",default:"Ошибка получения данных"},state:{type:"string",default:"U"},height:{type:"string",default:"200"},width:{type:"string",default:"200"}})}}]).factory("epguInformerService",["$rootScope","sharedExtServices","LOC",function($rootScope,sharedExtServices,LOC){return{initInformer:function(code,invalidate,callback){sharedExtServices.fetchInformer({typeInformer:code,invalidate:invalidate},function(response){"function"==typeof callback&&callback(response)})},detectGibddDiscounts:function(out){var withDiscounts=!1;if(out&&out.items)for(var z=0;z<out.items.length;z++){var item=out.items[z];if(item.originalAmount&&"1"!=item.isPaid){withDiscounts=!0;break}}return withDiscounts},setInformerCls:function(cls,informer){if(!informer)return cls;switch(informer.state){case"U":cls+=" informer-update with-fines";break;case"E":this.getInformerItemsLength(informer.out.items)>0&&0!=informer.out.total?cls+=" with-fines":cls+=" without-fines";break;case"D":case"H":cls+=" with-fines informer-disabled";break;case"F":cls+=" with-fines"}return cls},getInformerItemsLength:function(informerData){return Array.isArray(informerData)?informerData.length:Object.keys(informerData).length},setInformerResultPath:function(code,state){var epguUrl=LOC.EPGU_URI,url="";return"gibdd"===code?(url="H"===state||"D"===state||"F"===state?"10001/form":"10001/result/informer",epguUrl+url):"fns"===code?(url="AL10"===$rootScope.assuranceLevel?"10002/1":"D"===state||"F"===state||"H"===state?"10002/form":"10002/result/informer",epguUrl+url):(url="H"===state||"D"===state||"F"===state?"10003/form":"10003/result/informer",epguUrl+url)}}}]),angular.module("serverFormWidgets.general").directive("epguInformers",["TEMPLATES","api","$compile","sharedExtServices","$timeout","$window","epguInformersService","LOC","CONFIG",function(TEMPLATES,api,$compile,sharedExtServices,$timeout,$window,epguInformersService,LOC,CONFIG){return{templateUrl:TEMPLATES.INFORMERS,scope:{item:"="},controller:["$rootScope","$scope",function($rootScope,$scope){if(!$rootScope.isDesigner){$scope.informers=epguInformersService.getInformers();var opStatisticData={type:"informersShow",userId:$rootScope.env.user.userId,view:$rootScope.inOpWidgetIframe?"IFRAME":"INLINE",srcUrl:$rootScope.inOpWidgetIframe?$rootScope.settings.srcUrl:location.href};window.postMessage(JSON.stringify({id:"widget.display",pguData:opStatisticData}),"*")}}],link:function(scope,element,attrs){var watchers;scope.btnLogin={btnColor:"blue",label:"Войти",fullPath:"_btnLogin",buttonSize:"small",visible:!0},scope.btnAuth={btnColor:"white",label:"Зарегистрироваться",fullPath:"_btnAuth",buttonSize:"small",visible:!0,isAbsoluteUrl:!0,href:LOC.ESIA_URI},scope.btnLoginClick=function(clickAttr,evt){var com=$window.com;com&&com.rooxteam&&com.rooxteam.pubsub&&"function"==typeof com.rooxteam.pubsub.trigger&&com.rooxteam.pubsub.trigger("com.rooxteam.events.requestAuthentification")},scope.portalUrl=LOC.EPGU_URI,scope.esiaProfileUrl=CONFIG.ESIA_LK,scope.toggleHint=function(hintShow){scope.hintShow=hintShow},scope.$on("suspend",function(){watchers=scope.$$watchers,scope.$$watchers=[]}),scope.$on("resume",function(){scope.$$watchers=watchers,watchers=null}),scope.$emit(scope.item.fullPath+":ScopeApplied",{scope:scope,element:element})}}}]).factory("InformersExt",["containerAttrs",function(containerAttrs){return{attrs:angular.extend({},containerAttrs.attrs,{presetType:{type:"string",default:"sf","scope:editor":!1},typeInformer:{type:"string",default:"gibdd, fns, fssp"}})}}]).factory("epguInformersService",["EPGU_INFORMERS",function(EPGU_INFORMERS){return{getInformers:function(){return EPGU_INFORMERS}}}]),angular.module("serverFormWidgets.general").directive("epguTableDictionary",["TableDictionaryProperties","TEMPLATES","api","$rootScope","fieldAttrs","$timeout",function(TableDictionaryProperties,TEMPLATES,api,$rootScope,fieldAttrs,$timeout){return{templateUrl:TEMPLATES.TABLEDICTIONARY,replace:!0,scope:{item:"=?",list:"=?"},link:function(scope,element,attrs){function renderTable(data,callback){var checkCallback=callback||{};if(data&&data.items){var responseBindings=scope.item.dictionary.responseBindings||[],item=scope.item,list=scope.item.list;TableDictionaryProperties.render(item,list,responseBindings,scope),checkCallback.done&&checkCallback.done(item.list)}else if(scope.item.content){scope.item.dictionary.responseBindings=JSON.parse(scope.item.mapResponse||"{}");var responseBindings=scope.item.dictionary.responseBindings||[],item=scope.item,list=JSON.parse(scope.item.content);TableDictionaryProperties.render(item,list,responseBindings,scope),checkCallback.done&&checkCallback.done(item.list)}else checkCallback.error&&checkCallback.error(data.code);checkCallback.always&&checkCallback.always(),api.fixedShade(!1)}scope.ui={},scope.list=[],scope.item.navigation=!1,scope.item.isEmpty=!1,scope.isMobile=device.mobile(),scope.showList=!0,scope.$emit(scope.item.fullPath+":ScopeApplied",{scope:scope,element:element}),scope.item.loadAndRenderTable=function(pageNum,callback){scope.item.content?renderTable([],callback):TableDictionaryProperties.loadData({refName:scope.item.dictionary.code,filter:scope.item.filter,item:scope.item,parentRefItemValue:scope.item.parentRefItemValue,pageNum:pageNum||1,pageSize:+scope.item.pageSize},scope.ui,function(data){renderTable(data,callback)})}}}}]).factory("TableDictionaryExt",["containerAttrs",function(containerAttrs){return{attrs:angular.extend({},containerAttrs.attrs,{title:{default:"Название Table"},html:{"scope:editor":!1},saveTable:{type:"boolean",default:!1,"scope:editor":!0},dictionary:{default:{}},colNames:{type:"string",default:""},colWidths:{type:"string",default:""},tableStep:{type:"string",default:""},total:{type:"integer","scope:editor":!1},pageSize:{type:"string",default:"15"},content:{type:"string",default:""},mapResponse:{type:"string",default:""}}),fetch:function(id,callback){this.element.loadAndRenderTable(id,callback)}}}]).factory("TableDictionaryProperties",["$rootScope","containerAttrs","pguSelectService","apiInner","api","$timeout","FieldDropdownExt",function($rootScope,containerAttrs,pguSelectService,apiInner,api,$timeout,FieldDropdownExt){return{loadData:function(opts,ui,callback){var opts=angular.extend({pageSize:opts.pageSize,pageNum:opts.pageNum||1},opts);ui.loading=!0,pguSelectService.loadDataFromServer(opts,function(data){opts.item.list=data.items,opts.item.totalAttr=data.total,ui.loading=!1,callback&&callback(data)})},render:function(itemTable,list,responseBindings,scope){var cols=itemTable.colNames.split(", "),widths=itemTable.colWidths.split(", "),table=[],row={};scope.item.isEmpty=!1,scope.item.columns=cols,scope.item.widths=widths;var respBindHelper={};if(responseBindings.forEach(function(obj){respBindHelper[obj.name]=obj}),list){if(list.forEach(function(item){row={},item.attributes.forEach(function(attr){if(respBindHelper[attr.name]&&attr.name===respBindHelper[attr.name].name){var rowIndex=respBindHelper[attr.name].priority;row[rowIndex]=attr.valueAsOfType}}),table.push(row)}),scope.item.tableStep<table.length&&(scope.item.current=scope.item.currentLabel=table.length,scope.item.navigation=!0),scope.item.primaryKey){var firstRow=table[0],key=Object.keys(firstRow);scope.item.primaryTitle=key.indexOf(scope.item.primaryKey.toString())}else{var firstRow=table[0],key=Object.keys(firstRow)[0];scope.item.primaryKey=firstRow[key],scope.item.primaryTitle=0}scope.item.tableContent=table}else scope.item.isEmpty=!0}}}]),angular.module("serverFormWidgets.general").directive("epguInvitationPanel",["$rootScope","TEMPLATES","api","pguInvitationPanelService","sharedExtServices","apiInner","FORM_ERRORS","pguPaymentSrvc","$window","LOC","$q",function($rootScope,TEMPLATES,api,pguInvitationPanelService,sharedExtServices,apiInner,FORM_ERRORS,pguPaymentSrvc,$window,LOC,$q){return{templateUrl:TEMPLATES.INVITATION_PANEL,link:function(scope,element,attrs){function statusNormalization(status){var state,systemData=$rootScope.env.systemData;if(self.firstEditPayStatus="",systemData&&systemData.signCnt&&+systemData.signCnt>1&&(systemData.isOwner&&"true"===systemData.isOwner?systemData.editAnotherUser&&"true"===systemData.editAnotherUser?state="userBlock":systemData.allSign&&"true"===systemData.allSign?(self.firstEditPayStatus="SUBMIT",state="firstEditPay",$rootScope.disableInvitationSaveDraft=!1):"A"===status?(systemData.editAnotherUser&&"false"===systemData.editAnotherUser&&(self.status="T"),state="userBlock"):state="firstFillBlock":systemData.isOwner&&"false"===systemData.isOwner&&(state=systemData.editAnotherUser&&"false"===systemData.editAnotherUser?"secondFill":"secondBlock")),$rootScope.inOpWidget&&"firstFillBlock"===state&&"NEW"===status)$rootScope.finishPageType="zags_firstTime";else if($rootScope.inOpWidget){var info=$rootScope.env.serviceFormInfo;$window.location=LOC.EPGU_URI.replace(/http:|https:/,"")+info.PASS_CODE+"/"+info.EPGU_CODE+"/form"}return state}function getStatus(){return sharedExtServices.invitationService.getStatus().then(function(response){var status,errors,nextAttemp,data=response.data;if(data&&!data.error){status="NEW";for(var i=0,il=data.length;i<il;i++)status=data[i].status,errors=data[i].errors,nextAttemp=data[i].nextAttemp}else status="RequestError";return"E"===status&&(status="UserDataError"),"L"===status&&(status="A"),{status:status,errors:errors,nextAttemp:nextAttemp}})}function applyStatusState(status){self.curHelperText=self["helperTextStatus"+status],self.curHelperTextMoreInfo=self["helperTextMoreInfoStatus"+status],status&&(self.status=status);var state=statusNormalization(status);states[state]()}function makeServerValidate(){var wasValidated=$q.defer(),isError=!1;return needServerValidate?api.serverValidate({done:function(data){isError=data.error&&4005===data.error.code,self.temporaryHide&&self.temporaryHide.length&&pguInvitationPanelService.formShow(self.temporaryHide)},error:function(error){isError=!0},always:function(){isError?wasValidated.reject():wasValidated.resolve()}}):wasValidated.resolve(),wasValidated.promise}var self=scope.item;self.visibleLazy=!0;var systemData=$rootScope.env.systemData;self.parentStep=pguInvitationPanelService.findParentStep(self),self.curHelperText=self.helperText,self.curHelperTextMoreInfo=self.helperTextMoreInfo,self.curToggleBtnText=self.btnLabelDefault,self.editButton=!1,self.toPayButton=!1,self.repeatInvitation=!1,api.find(self.parentStep).element.title="",api.find(self.pathToSubmitBtnBlock).visible(!1),self.temporaryHide=[],scope.$emit(self.fullPath+":ScopeApplied",{scope:scope,element:element}),scope.item.isScopeAppliedDone={scope:scope,element:element};var needServerValidate=$rootScope.env.formParam.serverValidateInvitationPanel&&"true"===$rootScope.env.formParam.serverValidateInvitationPanel||!1,states={firstFillBlock:function(){var adviceBlock;if("N"===self.status){pguInvitationPanelService.fieldsDisable(self.model,!0);var timeSlotBlock=api.find(self.pathToTimeSlotBlock),timeSlotBlockOrgAndRegion=[timeSlotBlock.pathToRegionField(),timeSlotBlock.pathToOrgField()];self.temporaryHide=pguInvitationPanelService.formHide(timeSlotBlockOrgAndRegion),api.find(self.parentStep).visible(!0),self.curToggleBtnText=self.btnLabelRepeatDisable,self.repeatInvitation=!0}else if("A"===self.status)adviceBlock=api.find(self.pathToAdviceBlock),pguInvitationPanelService.fieldsShowHide(self.model,!0),pguInvitationPanelService.fieldsDisable(self.model,!1),self.curHelperText=self.helperText,self.curHelperTextMoreInfo=self.helperTextMoreInfo,self.curToggleBtnText=self.btnLabelDefault;else if("T"===self.status)self.curHelperText=self.helperTextStatusN,self.curHelperTextMoreInfo=self.helperTextMoreInfoStatusN,pguInvitationPanelService.fieldsDisable(self.model,!0),self.curToggleBtnText=self.btnLabelRepeatDisable,self.repeatInvitation=!0,pguInvitationPanelService.allFieldsDisabled(),self.temporaryHide=pguInvitationPanelService.formHide(),api.find(self.parentStep).visible(!0),self.nextAttemp&&+self.nextAttemp>0&&($rootScope.showTimer=!0);else if("E"===self.status);else if("UserDataError"===self.status){pguInvitationPanelService.allFieldsDisabled(),pguInvitationPanelService.fieldsDisable(self.model,!0),self.curToggleBtnText=self.btnLabelRepeatDisable,self.repeatInvitation=!0;var errorsHtml="";if(self.errors)for(var i=0,il=self.errors.length;i<il;i++)self.errors[i].message&&(errorsHtml=errorsHtml+"<div>"+self.errors[i].message+"</div>");adviceBlock=api.find(self.pathToAdviceBlock),adviceBlock&&(adviceBlock.title(self.adviceBlockTitleUserDataError),adviceBlock.html(self.adviceBlockMsgUserDataError),errorsHtml&&adviceBlock.htmlMoreInfo(errorsHtml),adviceBlock.eventType("not"),adviceBlock.visible(!0));var warningBlock=api.find(self.pathToWarningBlock);warningBlock&&(warningBlock.title(self.warningTitle),warningBlock.html(self.warningTextE),warningBlock.visible(!0))}else pguInvitationPanelService.fieldsShowHide(self.model,!0),pguInvitationPanelService.fieldsDisable(self.model,!1),self.curHelperText=self.helperText,self.curHelperTextMoreInfo=self.helperTextMoreInfo,self.curToggleBtnText=self.btnLabelDefault},secondFill:function(){pguInvitationPanelService.fieldsShowHide(self.model,!1),self.curHelperText="";var paymentWidget=pguInvitationPanelService.findPaymentWidget(self.pathToPaymentBlock);paymentWidget&&paymentWidget.length>1?(self.toPayButton=!0,self.curToggleBtnText="",self.model.helperBox.title(self.helperTextWarningForPayTitle),self.model.helperBox.html(self.helperTextWarningForPayText),self.model.helperBox.visible(!0),$rootScope.$on("paymentBlockShow",function(){pguInvitationPanelService.allFieldsDisabled(),self.toPayButton=!1,api.env("supportSignature")?api.find(self.pathToSubmitBtnBlock).visible(!0):(self.curToggleBtnText=self.btnSignLabel,api.find(self.pathToSubmitBtnBlock).visible(!1))}),pguInvitationPanelService.showPaymentBlock(self,self.pathToPaymentBlock,2,!0)):self.curToggleBtnText=self.btnSignLabel},secondBlock:function(){pguInvitationPanelService.allFieldsDisabled(),pguInvitationPanelService.formHide(),api.find(self.parentStep).visible(!1),api.find(self.pathToSubmitBtnBlock).visible(!1);var adviceBlock=api.find(self.pathToAdviceBlock);adviceBlock&&(adviceBlock.title(self.adviceTitleSecondUserBlocked),adviceBlock.html(self.adviceTextSecondUserBlocked),adviceBlock.htmlMoreInfo(""),adviceBlock.eventType("warn"),adviceBlock.visible(!0),api.find(pguInvitationPanelService.findParentStep(adviceBlock.element)).visible(!0))},firstEditPay:function(){if(self.curHelperText="",self.curToggleBtnText="",self.editButton=!1,self.toPayButton=!1,"N"===self.status)self.curHelperText=self.helperTextStatusE,self.curHelperTextMoreInfo=self.helperTextMoreInfoStatusE,pguInvitationPanelService.allFieldsUnDisabled(api.temporaryDisabled),api.uploadDraft(),self.curToggleBtnText=self.btnLabelEdit,api.find(self.pathToSubmitBtnBlock).visible(!1),self.model.helperBox.visible(!1),api.scrollTo(api.find().element.items[1].fullPath);else if("A"===self.status&&"SUBMIT"!==self.firstEditPayStatus){var adviceBlock=api.find(self.pathToAdviceBlock);pguInvitationPanelService.fieldsShowHide(self.model,!0),pguInvitationPanelService.fieldsDisable(self.model,!1),self.curHelperText=self.helperText,self.curHelperTextMoreInfo=self.helperTextMoreInfo,self.curToggleBtnText=self.btnLabelDefault}else if("T"===self.status){pguInvitationPanelService.formHide(),self.nextAttemp&&+self.nextAttemp>0&&($rootScope.showTimer=!0);var adviceBlock=api.find(self.pathToAdviceBlock);adviceBlock&&(adviceBlock.title(self.adviceBlockTitleBlockAfterReturnToFirst),adviceBlock.html(self.adviceBlockTextBlockAfterReturnToFirst),adviceBlock.htmlMoreInfo(""),adviceBlock.eventType("warn"),adviceBlock.visible(!0),api.find(pguInvitationPanelService.findParentStep(adviceBlock.element)).visible(!0))}else if("ERROR_EDIT"===self.status)pguInvitationPanelService.fieldsShowHide(self.model,!1),self.model.helperBox.title(self.warningTitle),self.model.helperBox.html(self.helperTextPaymentDeleteError),self.model.helperBox.visible(!0),api.find(self.pathToSubmitBtnBlock).visible(!0);else{$rootScope.$on("paymentBlockShow",function(){pguInvitationPanelService.findPaymentWidget(self.pathToPaymentBlock);api.find(self.pathToSubmitBtnBlock).visible(!0),self.toPayButton=!1,self.editButton=!1}),self.curHelperText="Данные второго заявителя успешно добавлены",self.curHelperTextMoreInfo="",pguInvitationPanelService.fieldsShowHide(self.model,!1),api.env("supportSignature");var formOrderPayments=$rootScope.env.formOrderPayments,paymentWidgets=pguInvitationPanelService.findPaymentWidget(self.pathToPaymentBlock);if(paymentWidgets&&paymentWidgets.length){if(self.toPayButton=!0,formOrderPayments&&!apiInner.isEmptyObject(formOrderPayments)){pguInvitationPanelService.showPaymentBlock(self,self.pathToPaymentBlock,1),pguInvitationPanelService.allFieldsDisabled();var submitBtnBlock=self.pathToSubmitBtnBlock?api.find(self.pathToSubmitBtnBlock):null;submitBtnBlock&&submitBtnBlock.visible()&&(submitBtnBlock.disabled(!1),submitBtnBlock.find("__nextStep").disabled(!1))}}else self.toPayButton=!1,api.find(self.pathToSubmitBtnBlock).visible(!0)}},userBlock:function(){if(pguInvitationPanelService.formHide(),api.find(self.parentStep).visible(!0),"A"===self.status){var adviceBlock=api.find(self.pathToAdviceBlock);adviceBlock?(adviceBlock.title(self.titleEditBlock),adviceBlock.html(self["helperTextStatus"+self.status]),adviceBlock.htmlMoreInfo(self["helperTextMoreInfoStatus"+self.status]),adviceBlock.eventType("warn"),adviceBlock.visible(!0),self.curHelperText="",self.curHelperTextMoreInfo="",api.find(pguInvitationPanelService.findParentStep(adviceBlock.element)).visible(!0)):(self.curHelperText=self.helperTextStatusA,self.curHelperTextMoreInfo=self.helperTextMoreInfoStatusA)}else if("T"===self.status){pguInvitationPanelService.formHide();var adviceBlock=api.find(self.pathToAdviceBlock);adviceBlock&&(adviceBlock.title(self.adviceBlockTitleBlockAfterReturnToFirst),adviceBlock.html(self.adviceBlockTextBlockAfterReturnToFirst),adviceBlock.htmlMoreInfo(""),adviceBlock.eventType("warn"),adviceBlock.visible(!0),api.find(pguInvitationPanelService.findParentStep(adviceBlock.element)).visible(!0))}else self.curHelperText=self.helperTextStatusT,self.curHelperTextMoreInfo=self.helperTextMoreInfoStatusT;pguInvitationPanelService.fieldsShowHide(self.model,!1),self.curToggleBtnText=""}};$rootScope.isDesigner||(self.model=pguInvitationPanelService.initInvitationPanelFields(scope.item.fullPath),$rootScope.env.remainingStepsRendered.then(function(){systemData&&systemData.isOwner&&"true"===systemData.isOwner?getStatus().then(function(result){self.status=result.status,self.errors=result.errors,self.nextAttemp=result.nextAttemp,applyStatusState(result.status),self.visibleLazy=!1}):(applyStatusState(),self.visibleLazy=!1)})),self.applyStatusState=applyStatusState,self.btnClick=function(event){if(systemData.isOwner&&"true"===systemData.isOwner)if(self.repeatInvitation)$rootScope.showTimer||(pguInvitationPanelService.fieldsDisable(scope.item.model,!1),self.curToggleBtnText=scope.item.btnLabelRepeat,self.repeatInvitation=!1);else{var isValid=api.validate();if(!isValid)return;scope.item.isLoad=!0,makeServerValidate().then(function(){pguInvitationPanelService.sendInvitation(scope.item.model,scope.item.parentStep)},function(){scope.item.isLoad=!1})}else{if(event.preventDefault(),!api.validate())return;scope.item.isLoad=!0,makeServerValidate().then(function(){api.find(scope.item.parentStep).submit("submit",0,{done:function(){api.shade(!1),api.fixedShade(!0),api.validate()?sharedExtServices.signConfirm(function(){var finalLink=api.env("lkUrl")+"notifications?type=DRAFT";api.link(finalLink)},function(data){api.fixedShade(!0),api.shade(!1),api.shade(!1),api.visible(!1),data.code=data.status&&409===data.status?"1401":"default",api.handleError(data)}):(api.fixedShade(!1),api.validate(),scope.item.isLoad=!1)},error:function(error){api.shade(!1),scope.item.isLoad=!1}},!0)},function(){scope.item.isLoad=!1})}},self.editAction=function(){pguInvitationPanelService.openFormForEdit(self)},self.toPayAction=function(){if(api.validate()){scope.item.isLoad=!0;var oldDISDValue=$rootScope.disableInvitationSaveDraft;$rootScope.disableInvitationSaveDraft=!1,api.uploadDraft(!1,function(){$rootScope.disableInvitationSaveDraft=oldDISDValue,makeServerValidate().then(function(){scope.item.isLoad=!1,systemData.isOwner&&"true"===systemData.isOwner?pguInvitationPanelService.showPaymentBlock(self,self.pathToPaymentBlock):pguInvitationPanelService.showPaymentBlock(self,self.pathToPaymentBlock,2)},function(){scope.item.isLoad=!1})})}},$(document).on("click",".PGU-Link-ScrollToAdvice",function(evt){evt.preventDefault(),api.scrollTo(self.pathToAdviceBlock)})},replace:!0,scope:{item:"="}}}]).factory("InvitationPanelExt",["$rootScope","basePanelAttrs","invitationPanelStructure",function($rootScope,basePanelAttrs,invitationPanelStructure){return{attrs:angular.extend({},basePanelAttrs.attrs,{title:{default:"Название панели","scope:ruleEditor":!0},btnLabel:{default:"Пригласить"},btnLabelDefault:{default:"Пригласить"},btnLabelRepeat:{default:"Отправить повторно"},btnLabelRepeatDisable:{default:"Пригласить повторно"},btnLabelEdit:{default:"Уведомить"},toggleBtnText:{default:"","scope:editor":!1},warningTitle:{default:"Внимание!"},warningText:{default:"Вы&nbsp;изменили поля заявления, поэтому Вам требуется заново отправить приглашение второму заявителю для подтверждения данных."},warningTextE:{default:"Данные второго заявителя не&nbsp;могут быть добавлены в&nbsp;заявление по&nbsp;указанной <a href='#' class='PGU-Link PGU-Link-ScrollToAdvice'>выше</a> причине. Повторите попытку после устранения причины."},helperText:{default:"Впишите ниже СНИЛС и&nbsp;электронную почту второго заявителя и&nbsp;отправьте ему приглашение, чтобы он&nbsp;из&nbsp;своего Личного кабинета добавил в&nbsp;заявление свои данные."},helperTextMoreInfo:{default:"Второй заявитель получит ссылку на&nbsp;Ваше заявление, в&nbsp;которое ему необходимо будет внести свои данные. Напоминаем, что заполненное заявление в&nbsp;ЗАГС отправляете&nbsp;Вы, как инициатор заявления."},helperTextStatusN:{default:"Второй заявитель ещё не&nbsp;переходил по&nbsp;ссылке из&nbsp;Вашего письма. Отправьте ему повторное приглашение, чтобы он&nbsp;из&nbsp;своего Личного кабинета добавил в&nbsp;заявление свои данные."},helperTextMoreInfoStatusN:{default:"Вы&nbsp;можете отправить приглашение повторно или изменить данные второго заявителя, если они были ошибочными. Обратите внимание, что письмо может попасть в&nbsp;папку &laquo;Спам&raquo;."},helperTextStatusT:{default:"Требуется время на обработку формы."},helperTextMoreInfoStatusT:{default:"Заявление будет доступно для редактирования и других действий в ближайшее время — пожалуйста, обновите страницу через несколько минут."},helperTextStatusA:{default:"Второй заявитель получил Ваше приглашение и&nbsp;добавил форму заявления в&nbsp;свой Личный кабинет."},helperTextMoreInfoStatusA:{default:"Заявление будет доступно для редактирования после отправки вторым заявителем своих личных данных."},helperTextStatusE:{default:"Второй заявитель из&nbsp;своего Личного кабинета проверит их&nbsp;и&nbsp;вышлет форму вам. После чего&nbsp;Вы, как инициатор, можете отправить заявление в&nbsp;ЗАГС."},helperTextMoreInfoStatusE:{default:"Второму заявителю будет отправлено электронное письмо со&nbsp;ссылкой на&nbsp;Ваше заявление для подтверждения данных. Напоминаем, что заполненное заявление в&nbsp;ЗАГС отправляете&nbsp;Вы, как инициатор заявления."},helperTextStatusUserDataError:{default:"После устранения причин не&nbsp;соответствия требованиям услуги, Вы&nbsp;можете отправить приглашение повторно."},helperTextMoreInfoStatusUserDataError:{default:"Отправьте повторное приглашение второму заявителю, если причины несоответствия требованиям устранены."},helperTextPaymentDeleteError:{default:"Платеж уже в обработке, редактирование заявления невозможно."},helperTextWarningForPayTitle:{default:"Перед отправкой заявления вам необходимо оплатить пошлину на портале Госуслуг."},helperTextWarningForPayText:{default:"Если вы отправляете заявление, не оплатив пошлину, оно будет возвращено вам, а бронирование даты и времени посещения органа ЗАГС будет аннулировано.<br>После перехода к оплате государственной пошлины изменить выбранный орган ЗАГС и данные заявления будет невозможно."},pathToSubmitBtnBlock:{type:"string",default:""},pathToAdviceBlock:{type:"string",default:""},adviceBlockTitleUserDataError:{default:"Невозможно добавить данные второго заявителя"},adviceBlockMsgUserDataError:{default:"Данные второго заявителя не&nbsp;удовлетворяют требованиям запрашиваемой услуги, а&nbsp;именно:"},adviceBlockTitleBlockAfterReturnToFirst:{default:"Вы не можете редактировать форму"},adviceBlockTextBlockAfterReturnToFirst:{default:"Второй заявитель успешно отправил свои личные данные. Требуется время на обработку формы. Заявление будет доступно для редактирования в ближайшее время – пожалуйста, обновите страницу через несколько минут."},adviceTitleSecondUserBlocked:{default:"Вы не можете редактировать форму"},adviceTextSecondUserBlocked:{default:"Вы не можете редактировать Ваши данные после отправки их инициатору заявления. Заявление в ЗАГС подается только инициатором."},pathToWarningBlock:{type:"string",default:""},pathToPaymentBlock:{type:"string",default:"form.FormStep10"},pathToTimeSlotBlock:{type:"string",default:"form.FormStep_6.Panel.TimeSlotExt"},pathToFieldSNILS:{type:"string",default:"form.FormStep1.Panel2.Panel1_3.PanelGrid.Panel13.Snils"},btnSignLabel:{type:"string",default:"Отправить мои данные"},titleEditBlock:{type:"string",default:"Вы не можете редактировать форму"}})}}]).factory("invitationPanelStructure",[function(){function getStructure(){var structure={className:"Panel",name:"PanelControls",title:"",isGrid:!0,doNotSave:!0,doNotSaveDraft:!0,items:[{className:"HelperBox",name:"warning",title:"",visible:!1},{className:"FieldText",name:"snils",required:!0,label:"СНИЛС",fieldWidth:"50",theMaskValue:"000-000-000 00",saveWithMask:!0,forceXml:!0,validators:[{mnemonic:"snils"}]},{className:"FieldText",name:"birthDate",required:!0,label:"Дата рождения",fieldWidth:"50",theMaskValue:"00.00.0000",saveWithMask:!0,forceXml:!0,validators:[{mnemonic:"date_DD.MM.YYYY"}]},{className:"FieldText",name:"email",required:!0,label:"Адрес электронной почты",fieldWidth:"50",forceXml:!0,validators:[{mnemonic:"email"}]}]};return angular.copy(structure)}return{getStructure:getStructure}}]).factory("pguInvitationPanelService",["api","sharedExtServices","$rootScope","apiInner","PGU","pguPaymentSrvc","$timeout",function(api,sharedExtServices,$rootScope,apiInner,PGU,pguPaymentSrvc,$timeout){return{initInvitationPanelFields:function(panelPath){var model={};return model.helperBox=api.find(panelPath+".warning"),model.snils=api.find(panelPath+".snils"),model.birthDate=api.find(panelPath+".birthDate"),model.email=api.find(panelPath+".email"),model},fieldsDisable:function(fields,flag){fields.snils.disabled(flag),fields.birthDate.disabled(flag),fields.email.disabled(flag)},fieldsShowHide:function(fields,flag){fields.snils.visible(flag),fields.birthDate.visible(flag),fields.email.visible(flag)},sendInvitation:function(fields,parentStep){var request={type:"SNILS",id:fields.snils.value(),email:fields.email.value(),birthDate:fields.birthDate.value()},resultArray=[];resultArray.push(request),api.find(parentStep).submit("submit",0,{done:function(){sharedExtServices.invitationService.sendInvitation(resultArray,function(data){api.link(api.env("lkUrl")+"notifications?type=DRAFT")},function(textError){api.shade(!1)})},error:function(error){api.shade(!1)}})},findParentStep:function(element){function findStep(item){
return item&&item.element&&"FormStep"===item.element.className?item.element.fullPath:item&&item.element&&"FormStep"!==item.element.className&&item.parent()?findStep(item.parent()):void 0}return findStep(element.parent.apiElem)},findPaymentWidget:function(pathToPaymentWidgets){var paymentWidget=!1;return pathToPaymentWidgets&&pathToPaymentWidgets.split(",").forEach(function(pb){var element=api.find(pb);paymentWidget=paymentWidget||[],apiInner.loopThroughTheTree(element,function(items,item){"Payment"===item.className&&paymentWidget.push(item)})}),paymentWidget},findPaymentBlock:function(pathToPaymentBlocks){var paymentBlock=[];return pathToPaymentBlocks&&pathToPaymentBlocks.split(",").forEach(function(pb){paymentBlock=paymentBlock||[],paymentBlock.push(api.find(pb))}),paymentBlock},allFieldsDisabled:function(){var unpreferedClasses=["Form","FormStep","Panel","InvitationPanel"];Object.keys(api._FormHash).forEach(function(key){!api._FormHash[key].disabled||!api._FormHash[key].element.visible||unpreferedClasses.indexOf(api._FormHash[key].element.className)+1||api._FormHash[key].disabled()||(api._FormHash[key].disabled(!0),api.temporaryDisabled.push(api._FormHash[key].element.fullPath))}),$rootScope.disableInvitationSaveDraft=!0},allFieldsUnDisabled:function(temporaryDisabled){temporaryDisabled.forEach(function(item){api.find(item)&&"function"==typeof api.find(item).disabled&&api.find(item).disabled(!1)}),$rootScope.disableInvitationSaveDraft=!1},formHide:function(pathsToBlock){var temporaryHide=[];return Object.keys(api._FormHash).forEach(function(key){"FormStep"===api._FormHash[key].element.className&&api._FormHash[key].visible&&api._FormHash[key].visible()&&(api._FormHash[key].visible(!1),(!pathsToBlock||!pathsToBlock.length||pathsToBlock.indexOf(api._FormHash[key].element.fullPath)<0)&&temporaryHide.push(api._FormHash[key].element.fullPath))}),$rootScope.disableInvitationSaveDraft=!0,temporaryHide},formShow:function(temporaryHide){temporaryHide.forEach(function(item){api.find(item)&&"function"==typeof api.find(item).visible&&api.find(item).visible(!0)}),$rootScope.disableInvitationSaveDraft=!1},showPaymentBlock:function(scope,pathToPaymentBlock,indexShow,ifHave){var uidPayment,paymentBlock=this.findPaymentBlock(pathToPaymentBlock),paymentWidgets=this.findPaymentWidget(pathToPaymentBlock),self=this;indexShow=indexShow||1,paymentWidgets&&paymentWidgets.length&&paymentWidgets.forEach(function(paymentWidget,index){if($rootScope.env.formOrderPayments&&$rootScope.env.formOrderPayments[paymentWidget.paymentCode]){if(paymentWidget.paymentCode===indexShow+""){var systemData=$rootScope.env.systemData;systemData.allSign&&"true"===systemData.allSign&&systemData.isOwner&&"true"===systemData.isOwner?api.find(scope.pathToSubmitBtnBlock).visible(!0):api.find(scope.pathToSubmitBtnBlock).visible(!1),pguPaymentSrvc.checkStatus(indexShow,function(data){if(data.error)api.find(scope.pathToSubmitBtnBlock).visible(!1);else{paymentBlock[index].visible(!0),$rootScope.$emit("paymentBlockShow"),api.env("supportSignature")&&api.find(scope.pathToSubmitBtnBlock).visible(!0);var submitBtnBlock=scope.pathToSubmitBtnBlock?api.find(scope.pathToSubmitBtnBlock):null;submitBtnBlock&&submitBtnBlock.visible()&&(submitBtnBlock.disabled(!1),submitBtnBlock.find("__nextStep").disabled(!1))}})}}else{if(ifHave)return;$timeout(function(){self.getUinFailHandler(paymentWidget.fullPath,scope.pathToSubmitBtnBlock),paymentWidget.getList(function(data){},function(error){})}),paymentWidget.paymentCode===indexShow+""&&(paymentBlock[index].visible(!0),$rootScope.$emit("paymentBlockShow"),uidPayment=angular.isObject(paymentWidget.uidPayment)?JSON.parse(paymentWidget.uidPayment):paymentWidget.uidPayment,apiInner.isEmptyObject(uidPayment)&&(api.find(scope.pathToSubmitBtnBlock).visible(!1),scope.hideAllButton=!0))}})},openFormForEdit:function(element){var timeSlotBlock=api.find(element.pathToTimeSlotBlock);timeSlotBlock.checkInvitation().then(function(data){data.valid||timeSlotBlock.disabled(!1)});var uidPayment,paymentBlock=this.findPaymentBlock(element.pathToPaymentBlock),paymentWidgets=this.findPaymentWidget(element.pathToPaymentBlock);paymentWidgets&&paymentWidgets.length?paymentWidgets.forEach(function(paymentWidget,index){uidPayment=angular.isObject(paymentWidget.uidPayment)?JSON.parse(paymentWidget.uidPayment):paymentWidget.uidPayment,apiInner.isEmptyObject(uidPayment)?sharedExtServices.invitationService.signReset().then(function(data){paymentWidget.uidPayment="",paymentWidget.listPayment=[],paymentBlock[index].visible(!1),element.applyStatusState("N")}):(paymentBlock[index].visible(!0),element.applyStatusState("ERROR_EDIT"))}):element.applyStatusState("N")},getUinFailHandler:function(fullPath,pathToSubmitBtnBlock){PGU.Events.unsubscribe(fullPath+"getUinFail"),PGU.Events.subscribe(fullPath,"getUinFail",function(evt,data){api.find(pathToSubmitBtnBlock).visible(!1)})}}}]),angular.module("serverFormWidgets.general").directive("epguInvitationPanelEuroprotocol",["$rootScope","TEMPLATES","api","pguInvitationPanelEPService",function($rootScope,TEMPLATES,api,pguInvitationPanelEPService){return{templateUrl:TEMPLATES.INVITATION_PANEL_EUROPROTOCOL,link:function($scope,element,attrs){function activateBlockState(errorMessage){$scope.adviceBlock=pguInvitationPanelEPService.initAdvice("Вы не можете редактировать форму",errorMessage,"not",$scope.item.fullPath),parentStep.title(""),parentStep.element.stepNumber="",pguInvitationPanelEPService.formHide(),parentStep.visible(!0),api.find($scope.item.pathToDescriptionPanel).visible(!1)}function applyStatusState(status){systemData&&"true"===systemData.isOwner?states.userA(status):states.userB(status)}var systemData=$rootScope.env.systemData,parentStep=api.find(pguInvitationPanelEPService.findParentStep($scope.item));api.find($scope.item.pathToSubmitBtnBlock).visible(!1),$scope.send=function(){api.validate()&&(systemData&&"true"===systemData.isOwner?($scope.isLoad=!0,pguInvitationPanelEPService.sendInvitation(parentStep).catch(function(error){error&&error.data&&($scope.saveErrorCode=error.data.code,$scope.saveErrorMessage=error.data.message,$scope.adviceBlock=pguInvitationPanelEPService.initAdvice("Ошибка подписания",$scope.saveErrorMessage,"not",$scope.item.fullPath)),$scope.isLoad=!1,$scope.europrotocolError=!0})):pguInvitationPanelEPService.submit(parentStep))},$scope.reset=function(){$scope.isLoad=!0,pguInvitationPanelEPService.resetOrder().catch(function(error){$scope.isLoad=!1,$scope.errorMessage=error&&error.message})};var states={userA:function(status){"a_send_b"===status?activateBlockState($scope.item.error_A_send_B):"b_reject_again"===status?activateBlockState($scope.item.error_B_reject_again):(api.find($scope.item.pathToCircumstancesDescriptionB).visible(!1),$scope.showSendButton=!0)},userB:function(status){if("b_reject"===status)activateBlockState($scope.item.error_B_reject);else if("b_reject_again"===status)activateBlockState($scope.item.error_B_reject_again);else{pguInvitationPanelEPService.allFieldsDisabled();var displayDescriptionAforB=api.find($scope.item.pathToCheckboxDisplayDescriptionAforB);"false"===displayDescriptionAforB.value()&&api.find($scope.item.pathToCircumstancesDescriptionA).visible(!1),displayDescriptionAforB.visible(!1);var descriptionB=api.find($scope.item.pathToCircumstancesDescriptionB);descriptionB.visible(!0),descriptionB.disabled(!1),$scope.showSendButton=!0,$scope.showRejectButton=!0}}};$rootScope.isDesigner||$rootScope.env.remainingStepsRendered.then(function(){pguInvitationPanelEPService.getStatus().then(function(result){$scope.status=result.status,applyStatusState($scope.status)})}),$scope.$emit($scope.item.fullPath+":ScopeApplied",{scope:$scope,element:element}),$scope.item.isScopeAppliedDone={scope:$scope,element:element}},replace:!0,scope:{item:"="}}}]).factory("InvitationPanelEuroprotocolExt",["$rootScope","basePanelAttrs",function($rootScope,basePanelAttrs){return{attrs:angular.extend({},basePanelAttrs.attrs,{title:{default:"Название панели",type:"string"},pathToDescriptionPanel:{default:"form.FormStepDescriptionDTP.PanelDescription",type:"string"},pathToCircumstancesDescriptionA:{default:"form.FormStepDescriptionDTP.PanelDescription.CircumstancesDescriptionA",type:"string"},pathToCheckboxDisplayDescriptionAforB:{default:"form.FormStepDescriptionDTP.PanelDescription.DisplayDescriptionAforB",type:"string"},pathToCircumstancesDescriptionB:{default:"form.FormStepDescriptionDTP.PanelDescription.CircumstancesDescriptionB",type:"string"},error_A_send_B:{default:"Извещение о ДТП передано участнику В. Ему необходимо проверить и подписать его.",type:"string"},error_B_reject_again:{default:"Участник В повторно отклонил извещение о ДТП. Оформление в электронном виде невозможно.",type:"string"},error_B_reject:{default:"Извещение о ДТП возвращено участнику А. Ему необходимо исправить и подписать его.",type:"string"},pathToSubmitBtnBlock:{type:"string",default:"form.NavPanel"}})}}]).factory("pguInvitationPanelEPService",["api","sharedExtServices","$rootScope","apiInner","PGU","$q","FORM_ERRORS",function(api,sharedExtServices,$rootScope,apiInner,PGU,$q,FORM_ERRORS){return{sendInvitation:function(parentStep){var request={type:"DRIVING_LICENSE"},callback={done:function(){sharedExtServices.invitationService.sendInvitation([request],function(data){df.resolve(),device&&window.webkit?device.android()?window.webkit.postMessage&&window.webkit.postMessage("link"):window.webkit.messageHandlers&&window.webkit.messageHandlers.callbackHandler&&window.webkit.messageHandlers.callbackHandler.postMessage&&window.webkit.messageHandlers.callbackHandler.postMessage("link"):api.link(api.env("lkUrl")+"notifications?type=DRAFT")},function(error){device&&window.webkit&&(device.android()?window.webkit.postMessage&&window.webkit.postMessage("exit"):window.webkit.messageHandlers&&window.webkit.messageHandlers.callbackHandler&&window.webkit.messageHandlers.callbackHandler.postMessage&&window.webkit.messageHandlers.callbackHandler.postMessage("exit")),df.reject(error)},"inviteToEuroprotocol")},error:function(error){device&&window.webkit&&(device.android()?window.webkit.postMessage&&window.webkit.postMessage("exit"):window.webkit.messageHandlers&&window.webkit.messageHandlers.callbackHandler&&window.webkit.messageHandlers.callbackHandler.postMessage&&window.webkit.messageHandlers.callbackHandler.postMessage("exit")),df.reject(error)}},df=$q.defer();return parentStep.submit("submit",0,callback),df.promise},resetOrder:function(){var df=$q.defer();return api.uploadDraft(!1,function(){sharedExtServices.invitationService.signReset().then(function(){api.link(api.env("lkUrl")+"notifications?type=DRAFT"),df.resolve()},function(error){df.reject(error)})},function(error){df.reject(error)}),df.promise},submit:function(parentStep){var callback={done:function(){sharedExtServices.signConfirm(function(){var finalLink=api.env("lkUrl")+"notifications/details/ORDER/"+api.env("orderId");api.link(finalLink)},function(){api.fixedShade(!0),api.shade(!1),api.shade(!1),api.visible(!1),api.showAdvice(FORM_ERRORS.default)})},error:function(error){api.shade(!1)}};api.shade(!0),api.uploadDraft(!1,function(){parentStep.submit("submit",0,callback,!0)},function(error){api.shade(!1)})},allFieldsDisabled:function(){var unpreferedClasses=["Form","FormStep","Panel","InvitationPanelEuroprotocol"];Object.keys(api._FormHash).forEach(function(key){var element=api._FormHash[key].element,notForDisable="Panel"===element.className?!(element.clonable||element.isClone):unpreferedClasses.includes(api._FormHash[key].element.className);api._FormHash[key].disabled&&!notForDisable&&(api._FormHash[key].disabled()||(api._FormHash[key].disabled(!0),api.temporaryDisabled.push(element.fullPath),api._FormHash[key].disabledUploadBtn&&(element.disabledUploadBtn=!0,api._FormHash[key].disabledUploadBtn(!0))))})},findParentStep:function(element){function findStep(item){return item&&item.element&&"FormStep"===item.element.className?item.element.fullPath:item&&item.element&&"FormStep"!==item.element.className&&item.parent()?findStep(item.parent()):void 0}return findStep(element.parent.apiElem)},formHide:function(){var temporaryHide=[];return Object.keys(api._FormHash).forEach(function(key){"FormStep"===api._FormHash[key].element.className&&api._FormHash[key].visible&&api._FormHash[key].visible()&&(api._FormHash[key].visible(!1),temporaryHide.push(api._FormHash[key].element.fullPath))}),temporaryHide},getStatus:function(){return sharedExtServices.invitationService.getStatusHistory().then(function(response){return{status:response&&response.data&&response.data.stateOrgStatusCode}})},initAdvice:function(title,html,type,fullPath){var adviceBlock={className:"Advice",name:"Advice",fullPath:fullPath+"._Advice",label:"",title:title,html:html,eventType:type,visible:!0};return api.initAttrs([adviceBlock]),adviceBlock}}}]),angular.module("serverFormWidgets.general").directive("epguAdvice",["TEMPLATES","api","$rootScope","$sce","$timeout",function(TEMPLATES,api,$rootScope,$sce,$timeout){return{templateUrl:TEMPLATES.ADVICE,replace:!0,scope:{item:"="},link:function(scope,element,attrs){scope.$sce=$sce,scope.$root=$rootScope;var watchers;scope.$on("suspend",function(){watchers=scope.$$watchers,scope.$$watchers=[]}),scope.$on("resume",function(){scope.$$watchers=watchers,watchers=null}),scope.$emit(scope.item.fullPath+":ScopeApplied",{scope:scope,element:element}),scope.item.isScopeAppliedDone={scope:scope,element:element}}}}]).factory("AdviceExt",["controlAttrs",function(controlAttrs){return{attrs:angular.extend({},controlAttrs.attrs,{title:{default:"Заголовок"},html:{default:""},htmlMoreInfo:{default:""},eventType:{type:"string",default:"ok",enum:["ok","not","warn","like"],enumOptions:{ok:"Все в порядке",not:"Ошибка",warn:"Предупреждение",like:"Лайк"}}})}}]),angular.module("serverFormWidgets.general").directive("epguEditableDataGrid",["$rootScope","$sce","$compile","$timeout","$q","$filter","TEMPLATES","TEMPLATES_PLAYER","api","apiInner","PGU","sharedExtServices","EditableDataGridService","CONFIG","LOC","EDITABLE_DATA_GRID_UPLOAD_ERRORS_MSG",function($rootScope,$sce,$compile,$timeout,$q,$filter,TEMPLATES,TEMPLATES_PLAYER,api,apiInner,PGU,sharedExtServices,EditableDataGridService,CONFIG,LOC,EDITABLE_DATA_GRID_UPLOAD_ERRORS_MSG){return{templateUrl:TEMPLATES.EDITABlEDATAGRID,replace:!1,scope:{item:"="},link:function(scope,element,attrs){function showGridHeader(val){scope.grid.showHeader=!!val}function checkUploader(){var customUploaderInd=EditableDataGridService.findUploader(scope.item.dialogItems,"FieldUpload");customUploaderInd>-1&&(scope.customUploaderState={customFields:[],fileName:""},scope.ui.btnAddStringState.visible=!1,scope.item.customUploader=scope.item.dialogItems.splice(customUploaderInd,1)[0],scope.item.customUploader.isEditableGridUploader=!0,scope.item.customUploader.multipleUpload=!0,scope.item.customUploader.handleUploaded=function(data){data.file&&(scope.customUploaderState.file=data.file,data.element&&(scope.customUploaderState.element=data.element)),scope.addStringState()},scope.item.customUploader.handleRemoveFileFromParent=function(data){},scope.customUploaderState.customFields.push(scope.item.customUploader))}function fireHandler(){var df=$q.defer();return df.promise.then(function(data){scope.item.handlerFireData=data}),df}scope.isMobile=$rootScope.device.mobile,scope.isTablet=$rootScope.device.tablet,scope.isDesktop=$rootScope.device.desktop,scope.$sce=$sce,scope.invitationType="requestAgreement",scope.parentStep=EditableDataGridService.findParentStep(scope.item),scope.notOverflowText=scope.item.notOverflowText,scope.alignText=scope.item.alignText;var popupTimeout;scope.imgSrc=LOC.STATIC_DOMAIN+"img/icon/all_documents@1x.svg";var paymentBlock=$rootScope.settings.paymentBlocks[scope.item.pathToPaymentBlock],defaultVisibleAddStringButton=scope.item.showAddStringButton,defaultVisibleUploadButton=scope.item.showUploadButton,defaultVisibleClearButton=scope.item.showClearButton;scope.disableEditButtons=function(disabled){scope.disableButton("add",disabled),scope.disableButton("upload",disabled),scope.disableButton("clear",disabled)},scope.$watch("item.disabled",function(val,oldVal){void 0!==val&&val!=oldVal&&scope.disableEditButtons(val)}),scope.$watch("item.rowsMaxLength",function(val,oldVal){if(void 0!==val&&val!==oldVal){var originList=scope.grid.originList;scope.visibleButton("add",!(originList.length>=scope.item.rowsMaxLength))}}),paymentBlock&&paymentBlock.then(function(data){data.uidPayment?scope.item.disabled=!0:api.find("form.NavPanel.__nextStep").disabled(!0)}),scope.item.pathToPaymentBlock&&PGU.Events.subscribe(scope.item.pathToPaymentBlock,"widget-has-payments",function(evt,data){data.uidPayment?scope.item.disabled=!0:api.find("form.NavPanel.__nextStep").disabled(!0)}),scope.ui={btnAddStringState:{balign:"left",floating:"PGU-BtnFloat",label:scope.item.addStringButtonName,fullPath:scope.item.fullPath?scope.item.fullPath+"._btnAddStringState":"_btnAddStringState",buttonSize:"small",visible:scope.item.showAddStringButton,btnIcon:"AddRow"},btnUploadState:{balign:"left",floating:"PGU-BtnFloat",label:scope.item.uploadButtonName,fullPath:scope.item.fullPath?scope.item.fullPath+"._btnUploadState":"_btnUploadState",buttonSize:"small",visible:scope.item.showUploadButton,btnIcon:"AddFile"},btnClear:{balign:"right",floating:"PGU-BtnFloat",label:scope.item.clearButtonName,fullPath:scope.item.fullPath?scope.item.fullPath+"._btnClear":"_btnClear",buttonSize:"small",visible:scope.item.showClearButton},attachmentName:"",detailsDialogShow:!1,activeGridItem:{index:"0"},btnSave:{balign:"right",btnColor:"blue",label:scope.item.popupButtonSaveTitle,fullPath:scope.item.fullPath?scope.item.fullPath+"._btnSave":"_btnSave",floating:"PGU-BtnFloat",buttonSize:"",visible:!0},btnUploadSave:{balign:"right",btnColor:"blue",label:"Сохранить данные",fullPath:scope.item.fullPath?scope.item.fullPath+"_btnUploadSave":"_btnUploadSave",floating:"PGU-BtnFloat",buttonSize:"",visible:!0},btnUploadCancel:{label:"Отменить",fullPath:scope.item.fullPath?scope.item.fullPath+"._btnUploadCancel":"_btnUploadCancel",floating:"PGU-BtnFloat",buttonSize:"",visible:!0},btnCancel:{label:scope.item.popupButtonCancelTitle,fullPath:scope.item.fullPath?scope.item.fullPath+"._btnCancel":"_btnCancel",floating:"PGU-BtnFloat",buttonSize:"",visible:!0},btnReturnToUpload:{label:"Вернуться к загрузке",fullPath:scope.item.fullPath?scope.item.fullPath+"._btnReturnToUpload":"_btnReturnToUpload",floating:"PGU-BtnFloat",buttonSize:"",visible:!0}},scope.item.customEditButtonLabel&&(scope.ui.btnEditRow={label:scope.item.customEditButtonLabel,fullPath:scope.item.fullPath?scope.item.fullPath+"._btnEditRow":"_btnEditRow",floating:"PGU-BtnFloat",buttonSize:"",visible:!0}),scope.disableButton=function(name,value){switch(name){case"add":scope.ui.btnAddStringState.disabled=value;break;case"upload":scope.ui.btnUploadState.disabled=value;break;case"clear":scope.ui.btnClear.disabled=value}},scope.visibleButton=function(name,value){switch(name){case"add":defaultVisibleAddStringButton&&(scope.ui.btnAddStringState.visible=value);break;case"upload":defaultVisibleUploadButton&&(scope.ui.btnUploadState.visible=value);break;case"clear":defaultVisibleClearButton&&(scope.ui.btnClear.visible=value)}},scope.item.popup=scope.popup={tpl:TEMPLATES_PLAYER.MODAL_EDITABLE_DATA_GRID,show:!1,state:""},scope.popupConfirmRemove={tpl:TEMPLATES_PLAYER.MODAL_EDITABLE_DATA_GRID_CONFIRM_REMOVE,show:!1,toggleVisible:function(boo){var pcr=scope.popupConfirmRemove;pcr.show=boo,boo||(pcr.defer.reject(),api.scrollTo(scope.item.fullPath,"",-60))},checkConfirm:function(from){var pcr=scope.popupConfirmRemove;return pcr.defer=$q.defer(),pcr.from=from,_.isEmpty(scope.item.mapEditRowByUUID)?pcr.toggleVisible(!0):pcr.defer.resolve(),pcr.defer.promise},confirmed:function(){var pcr=scope.popupConfirmRemove;pcr.defer.resolve(),pcr.toggleVisible(!1)},getTitle:function(from){return"Вы точно хотите удалить "+("row"===from?"строку":"все строки")+"?"},removeMsg:"Восстановить удаленную информацию будет невозможно.",btnBack:"Назад",btnDelete:"Удалить"},scope.item.getOriginList=function(){return scope.grid.originList},scope.item.savedMapEditRowByUUID?scope.item.mapEditRowByUUID=JSON.parse(scope.item.savedMapEditRowByUUID):scope.item.mapEditRowByUUID={},scope.item.setDataToOtherDG=function(id,action){var otherGrid=api.find(scope.item.pathToOtherDG),findById=EditableDataGridService.findById(scope.grid.originList,id),activeOtherDG="",draftOtherDG=EditableDataGridService.getDraftData(otherGrid.element.fields.hashMap,findById.gridItem);api.setDraft(draftOtherDG),otherGrid.element.updateGridAction(action),otherGrid.element.notScrollToElement=!0,otherGrid.element.mapEditRowByUUID[id]||(otherGrid.element.mapEditRowByUUID[id]="",scope.item.savedMapEditRowByUUID=JSON.stringify(scope.item.mapEditRowByUUID)),"edit"===action&&(otherGrid.element.mapEditRowByUUID[id]?(activeOtherDG=EditableDataGridService.findById(otherGrid.element.getOriginList(),otherGrid.element.mapEditRowByUUID[id]),otherGrid.element.activeItem(activeOtherDG.gridItemIndex),otherGrid.element.activeItemId(activeOtherDG.gridItem.id)):otherGrid.element.updateGridAction("add")),otherGrid.element.saveFormData(id).then(function(){PGU.Events.publish(scope.item.fullPath+":change",{changeCounter:scope.item.changeCounter++,activeItemId:scope.activeItemId()})},function(error){})},scope.addStringState=function(){if(scope.item.consentOfThirdParties&&((scope.item.gridValue="")&&(scope.item.gridValue="Temp"),!api.validate()))return void((scope.item.gridValue="Temp")&&(scope.item.gridValue=""));scope.updateState("form"),scope.updateGridAction("add"),scope.toggleModalVisible(!0),scope.setCurrentRowIndex()},scope.uploadState=function(){scope.updateState("upload"),scope.refreshUploader(),scope.toggleModalVisible(!0)},scope.handleSaveFormData=function(uuid,df){var apiElem=api.find(scope.item.fullPath),firstItem=apiElem.element.items[0],firstItemFullPath=firstItem.fullPath,apiFirstItem=api.find(firstItemFullPath);if(apiElem.validate()){if(scope.ui.btnSave.isLoad)return void df.reject();scope.ui.btnSave.isLoad=!0;var gridItem,mapByRole,mapByRoleForServer,typesHumanity,mapStatusesHumanity,draft=api.saveStepDraft(scope.item.dialogItems),clearedDraft=defaultDraft||EditableDataGridService.getClearDraft(draft),id=scope.activeItemId(),requestData=[],typeData={},roleFrom=scope.item.consentOfThirdPartiesMapByRoleFrom;if(scope.item.consentOfThirdParties){df.reject(),EditableDataGridService.findFieldByName(scope.item,roleFrom,typeData),typesHumanity=EditableDataGridService.getMapForHumanity(scope.item.consentOfThirdPartiesMapTypesHumanity);for(var i in typesHumanity)typesHumanity.hasOwnProperty(i)&&roleFrom&&typeData[roleFrom]&&draft[typeData[roleFrom]]&&draft[typeData[roleFrom]].value===typesHumanity[i]&&(mapStatusesHumanity=EditableDataGridService.getMapForHumanity(scope.item.consentOfThirdPartiesServerDataTypes),draft[typeData[roleFrom]].value=mapStatusesHumanity[i]);mapByRole=EditableDataGridService.getMapByRole(scope.item,scope.item.consentOfThirdPartiesMapByRole,typeData[roleFrom],draft),mapByRoleForServer=EditableDataGridService.getMapForHumanity(scope.item.consentOfThirdPartiesDataTypes),mapByRole.type=draft[typeData[roleFrom]]&&draft[typeData[roleFrom]].value?mapByRoleForServer[draft[typeData[roleFrom]].value]:"SNILS",id&&(mapByRole.recordId=id),requestData.push(mapByRole),EditableDataGridService.sendInvitation(scope.invitationType,requestData,scope.parentStep,api).then(function(data){var gridItemConvertedData=EditableDataGridService.getDataByRole(data[0],scope.fields.rowStructure,scope.item.consentOfThirdPartiesMapByRole,scope.item.consentOfThirdPartiesServerDataTypes,scope.item.consentOfThirdPartiesMapTypesHumanity,scope.item.consentOfThirdPartiesMapStatusesHumanity,scope.item.consentOfThirdPartiesMapByRoleFrom,scope.item.colNameWithStatus);if(gridItem=EditableDataGridService.createGridItemData(scope.gridConfig,scope.fields,gridItemConvertedData,id,!0,scope.item.customUploader,scope.item.colWithStatus,scope.statusMap),data&&data.length&&data[0].recordId&&(gridItem.id=data[0].recordId),"add"===scope.updateGridAction()){var updatedTotal=scope.setTotal()+1,nextPage=EditableDataGridService.getNextPage(scope.setTotal(),updatedTotal,scope.item.pageSize);scope.setTotal(updatedTotal),nextPage>scope.currentPage()&&scope.currentPage(nextPage)}scope.updateOriginalGridList(gridItem,scope.updateGridAction(),scope.activeItem(),!0),clearedDraft&&api.setDraft(clearedDraft),scope.toggleModalVisible(!1),scope.setLoading(!1),PGU.Events.publish(":needDisableForm",{fullPath:scope.item.fullPath}),api.find(scope.item.pathToAdviceClearInfo).visible(!0),scope.item.fileIsCreated||(scope.item.fileIsCreated="1",api.env("autosaveDisabled")||api.uploadDraft(!1,null,null,!1,scope.item))},function(error){scope.setLoading(!1),scope.ui.btnSave.isLoad=!1,error&&error.message&&error.message.indexOf("Couldn't save WaitAuthOrder")>-1&&(scope.consentOfThirdPartiesError=scope.item.consentOfThirdPartiesError)})}else gridItem=EditableDataGridService.createGridItemData(scope.gridConfig,scope.fields,draft,id,!1,scope.item.customUploader,scope.item.colWithStatus,scope.statusMap),scope.updateServerData(gridItem,scope.updateGridAction(),scope.activeItem(),clearedDraft,uuid,df)}else df.reject(),apiFirstItem.scrollToError(apiFirstItem,"popup",scope.item,".PGU-EditableDataGrid-Dialog__Body",api.__setFirstFieldError)},scope.item.saveFormData=scope.saveFormData=function(uuid){var df=$q.defer(),request={orderId:api.env("orderId"),action:"new",mnemonic:scope.item.gridMnemonic};return scope.item.fileIsCreated||scope.item.consentOfThirdParties?scope.handleSaveFormData(uuid,df):sharedExtServices.editableGridUpdateRequest(request).then(function(data){scope.item.fileIsCreated="1",api.env("autosaveDisabled")||api.uploadDraft(!1,null,null,!1,scope.item),scope.handleSaveFormData(uuid,df)},function(error){return $q.reject(error)}),df.promise},scope.toggleModalVisible=function(visible){var draft,clearedDraft,popup=element.find(".PGU-Popup");if(scope.popup.show=void 0!==visible?visible:!scope.popup.show,scope.popup.show){EditableDataGridService.setFieldsDefaultState(scope.fields.hashMap,api);var popupEl=popup.find(".PGU-EditableDataGrid-Dialog__Body");$(popupEl).animate({scrollTop:"0px"},300),popup.on("scroll",function(){popupTimeout&&$timeout.cancel(popupTimeout),popupTimeout=$timeout(function(){PGU.Events.publish(scope.item.fullPath+":modalScroll",{top:popup[0].getBoundingClientRect().top})},200)}),scope.fieldsDate&&scope.fieldsDate.length&&scope.fieldsDate.forEach(function(field){var dp=api.find(field);PGU.Events.publish(dp.fullPath()+":changeSettings",{dateSettings:dp.element.dateSettings,dialog:!0,fullPath:scope.item.fullPath})}),scope.item.error="",scope.setErrorShow(!1),PGU.Events.publish(scope.item.fullPath+":change",{changeCounter:scope.item.changeCounter++,activeItemId:scope.activeItemId()})}else scope.item.customUploader&&"add"===scope.updateGridAction()&&scope.item.customUploader.removeFileFromParent(),scope.revokeErrorAttachmentUrl(),scope.updateState(),scope.updateUploadState("info"),scope.updateGridAction(""),scope.activeItem(""),scope.setCurrentRowIndex(""),scope.activeItemId(""),draft=api.saveStepDraft(scope.item.dialogItems),clearedDraft=defaultDraft||EditableDataGridService.getClearDraft(draft),api.setDraft(clearedDraft),scope.consentOfThirdPartiesError="",scope.toggleDetailsDialog(!1),popup.off("scroll"),scope.item.notScrollToElement?scope.item.notScrollToElement=!1:api.scrollTo(scope.item.fullPath,"",-60),scope.ui.btnSave.isLoad=!1,PGU.Events.publish(scope.item.fullPath+":change",{changeCounter:scope.item.changeCounter++,activeItemId:scope.activeItemId()})},scope.toggleDetailsDialog=function(visible){scope.ui.detailsDialogShow=void 0!==visible?visible:!scope.ui.detailsDialogShow},scope.updateState=function(state){scope.ui.state=state||""},scope.item.updateGridAction=scope.updateGridAction=function(action){if(void 0===action)return scope.grid.action;scope.grid.action=action,scope.grid.action=action||""},scope.item.activeItem=scope.activeItem=function(itemIndex){if(void 0===itemIndex)return scope.grid.activeItem;scope.grid.activeItem=itemIndex},scope.item.setCurrentRowIndex=scope.setCurrentRowIndex=function(value){var globalTotal=scope.setGlobalTotal();scope.grid.currentItem=void 0!==value?value+1+scope.item.pageSize*(scope.paging.currentPage-1):void 0!==globalTotal?globalTotal+1:scope.setTotal()+1},scope.item.activeItemId=scope.activeItemId=function(value){if(void 0===value)return scope.grid.activeItemId;scope.grid.activeItemId=value},scope.uploader={state:"info",errorTitle:"",successTitle:"Данные успешно загружены",initialized:!1,response:null},scope.updateUploadState=function(state){scope.uploader.state=state||""},scope.applyUploaded=function(){var response=scope.uploader.response,list=response.data||[];scope.setTotal(response.total),scope.setGlobalTotal(response.total),list&&list.length?(scope.mapListFromServer(list,scope.updateGridAction()),scope.toggleModalVisible(!1),scope.uploader.response=null):scope.filterFromServer()},scope.handleUploadSuccess=function(response){scope.item.fileIsCreated||(scope.item.fileIsCreated="1",api.env("autosaveDisabled")||api.uploadDraft(!1,null,null,!1,scope.item)),scope.item.fileIsCreated="1",scope.uploader.response=response,scope.applyUploaded(),api.applyScope()},scope.handleUploadError=function(err){var messages=EDITABLE_DATA_GRID_UPLOAD_ERRORS_MSG;scope.item.error="","-600"===err.code?(scope.item.error=err.file.name+" "+err.message+" "+scope.item.fileSize+" Kb.",scope.item.gridValue=""):-601===err.code?scope.item.error=messages[2]:err.code?scope.item.error=messages[404]:scope.item.error=messages.default,scope.uploader.errorTitle=scope.item.error,scope.updateUploadState("error"),scope._uploader.removeFile(err.file),api.applyScope()},scope.revokeErrorAttachmentUrl=function(){if(scope.ui.attachmentErrorReportUrl){(window.URL||window.webkitURL).revokeObjectURL(scope.ui.attachmentErrorReportUrl),scope.ui.attachmentErrorReportUrl=""}},scope.createUploader=function(browse_button,orderId){scope._uploader=new plupload.Uploader({runtimes:"html5, html4, flash",browse_button:browse_button,url:LOC.WIDGET_URI+"api/storage/v1/de/"+orderId+"/"+scope.item.gridMnemonic+"/upload?escaped="+scope.item.escaped+"&separator="+scope.item.separator,flash_swf_url:LOC.WIDGET_URI+"htdocs/common/js/lib/plupload/plupload.flash.swf",headers:{Accept:"application/json; charset=utf-8"},filters:{mime_types:[{title:"CSV file",extensions:"csv"}]},required_features:"send_browser_cookies",file_data_name:"uploadFile",multipart_params:{},multi_selection:!1,init:{Init:function(){},FileFiltered:function(up,files){},FilesAdded:function(up,files){scope.item.error="",scope.revokeErrorAttachmentUrl();var validatorsRegexps,dictionariesForCheckByColumn;scope.item.validatorsRegexps&&(validatorsRegexps=EditableDataGridService.getRequestParamsForUploader(scope.item.validatorsRegexps,scope.item.validatorsMessages,"rre_","rm_"),_.extend(scope._uploader.settings.multipart_params,validatorsRegexps)),scope.item.dictionariesForCheckByColumn&&(dictionariesForCheckByColumn=EditableDataGridService.getRequestParamsForUploader(scope.item.dictionariesForCheckByColumn,scope.item.dictionariesMessagesForCheckByColumn,"rre_","rm_",scope.item.dictionariesCheckBy+":"),_.extend(scope._uploader.settings.multipart_params,dictionariesForCheckByColumn)),scope._uploader.start()},FileUploaded:function(up,file,data){scope.updateGridAction("find");var response=JSON.parse(data.response||{}),nextPage=1;data&&200==data.status?(scope.gridFilter.value&&(scope.gridFilter.emptySet=!0,scope.gridFilter.value=""),nextPage=EditableDataGridService.getNextPage(scope.setGlobalTotal(),response.total,scope.item.pageSize),scope.currentPage(nextPage),scope.handleUploadSuccess({total:response.total})):scope.handleUploadError({file:file,
code:"attachmentError",url:response.url||"//"})},Error:function(up,err){var response=err.response?JSON.parse(err.response):null;if(scope.revokeErrorAttachmentUrl(),response&&response.report&&response.report.length){var total=response.fileTotal||0,errorData=EditableDataGridService.createRowsDataByNames(response.report,total,scope.gridConfig.rowStructure.length,scope.gridConfig.header),exportToCSV=EditableDataGridService.exportToCSVByMap(errorData),convertToUtf16=EditableDataGridService.convertToUtf16(exportToCSV);if(exportToCSV){var URL=window.URL||window.webkitURL,blob=new Blob([convertToUtf16.buffer],{type:"text/csv;charset=utf-16"});scope.ui.attachmentErrorReportName="data.csv",scope.ui.attachmentErrorReportUrl=URL.createObjectURL(blob)}}scope.handleUploadError(err,scope.ui.attachmentUrl)}}})},scope.refreshUploader=function(){if(scope.uploader.initialized)$timeout(function(){scope._uploader.refresh()},400);else{var orderId=api.env("orderId")||null;scope.createUploader(scope.item.fullPath+":upload",orderId),$timeout(function(){scope._uploader.init(),scope.uploader.initialized=!0,scope._uploader.refresh()},400)}},scope.clearAll=function(){scope.popupConfirmRemove.checkConfirm("all").then(function(){scope.updateGridAction("clear");var draft=api.saveStepDraft(scope.item.dialogItems),clearedDraft=defaultDraft||EditableDataGridService.getClearDraft(draft);scope.currentPage(1),scope.item.consentOfThirdParties?scope.deleteAgreements({},scope.updateGridAction(),-1,clearedDraft):scope.item.gridMnemonic&&scope.item.fileIsCreated&&scope.updateServerData({},scope.updateGridAction(),-1,clearedDraft)})},scope.grid={originList:[],list:[],filteredList:[],header:[],action:"",activeItem:"",activeItemId:"",currentPage:1,loading:!1,showHeader:!1,error:{title:"Что-то пошло не так",show:!1}},scope.getRowIndexWithOffset=function(rowIndex){var page=scope.currentPage();return rowIndex+scope.item.pageSize*(page-1)},scope.setLoading=function(value){if(void 0===typeof value)return scope.grid.loading;scope.grid.loading=value},scope.setErrorShow=function(value){if(void 0===typeof value)return scope.grid.error.show;scope.grid.error.show=value},scope.deleteRow=function($evt,rowIndex,id){scope.popupConfirmRemove.checkConfirm("row").then(function(){$evt&&$evt.preventDefault();var findById=EditableDataGridService.findById(scope.grid.originList,id);scope.item.consentOfThirdParties?scope.deleteAgreement(findById.gridItem,"del",findById.gridItemIndex,id):findById.gridItem&&scope.updateServerData(findById.gridItem,"del",findById.gridItemIndex)})},scope.deleteAgreement=function(gridItem,action,itemIndex,id){sharedExtServices.invitationService.deleteAgreement(id).then(function(data){scope.setTotal(scope.setTotal()-1),scope.updateOriginalGridList(gridItem,action,itemIndex,!0),scope.toggleModalVisible(!1),scope.setLoading(!1),scope.setTotal()<=0&&(PGU.Events.publish(":needUnDisableForm",{}),api.find(scope.item.pathToAdviceRejectInfo).visible(!1),api.find(scope.item.pathToAdviceClearInfo).visible(!1))},function(error){scope.setErrorShow(!0),scope.setLoading(!1),scope.toggleModalVisible(!1)})},scope.deleteAgreements=function(gridItem,action,itemIndex,clearDraft){sharedExtServices.invitationService.deleteAgreements(scope.invitationType).then(function(data){clearDraft&&api.setDraft(clearDraft),scope.setTotal(0),scope.updateOriginalGridList(gridItem,action,itemIndex),PGU.Events.publish(":needUnDisableForm",{}),api.find(scope.item.pathToAdviceRejectInfo).visible(!1),api.find(scope.item.pathToAdviceClearInfo).visible(!1)},function(error){scope.setErrorShow(!0),scope.setLoading(!1),scope.toggleModalVisible(!1)})},scope.editRow=function(data){var $evt=data.$event,rowIndex=data.$index,id=data.rowId;$evt&&$evt.preventDefault(),scope.updateGridAction("edit");var findById=EditableDataGridService.findById(scope.grid.originList,id),draft=EditableDataGridService.getDraftData(scope.fields.hashMap,findById.gridItem);scope.activeItem(findById.gridItemIndex),scope.setCurrentRowIndex(rowIndex),scope.activeItemId(id),api.setDraft(draft),scope.updateState("form"),scope.toggleModalVisible(!0)},scope.updateServerData=function(gridItem,action,itemIndex,clearDraft,uuid,defer){scope.setLoading(!0);var gridItemData,orderId=api.env("orderId");"add"!==action&&"edit"!==action||(gridItemData={},gridItem&&gridItem.fields.forEach(function(item,i){gridItemData["r"+(i+1)]=item.value||""}),gridItem.id&&(gridItemData.id=gridItem.id),scope.gridFilter.value&&(scope.gridFilter.value="",scope.gridFilter.emptySet=!0)),sharedExtServices.editableGridUpdateRequest({action:action,orderId:orderId,id:gridItem.id,gridItemData:gridItemData,mnemonic:scope.item.gridMnemonic}).then(function(response){var id,updatedTotal,nextPage=1,handlerDf=fireHandler();if(response&&200==response.status){if(id=response&&response.data&&response.data.id||"",id&&(gridItem.id=id),"add"===action){if(updatedTotal=scope.setTotal()+1,nextPage=EditableDataGridService.getNextPage(scope.setGlobalTotal(),updatedTotal,scope.item.pageSize),scope.customUploaderState&&scope.customUploaderState.file&&(scope.customUploaderState.file.rowUid=id,scope.customUploaderState.element&&(scope.customUploaderState.element.rowUid=id),scope.updateGridAction("")),scope.setTotal(updatedTotal),scope.setGlobalTotal(updatedTotal),nextPage>scope.currentPage())return scope.currentPage(nextPage),void scope.filterFromServer("",handlerDf,{action:action,id:id||gridItem.id});handlerDf.resolve({action:action,id:id||gridItem.id})}else"del"===action?((scope.currentPage()-1)*scope.item.pageSize==scope.setTotal()-1&&scope.setTotal()-1>0&&scope.currentPage(scope.currentPage()-1),scope.filterFromServer("",handlerDf,{action:action,id:id||gridItem.id}),scope.item.customUploader&&scope.item.customUploader.removeFileFromParent(gridItem.id)):"clear"===action?(scope.setTotal(0),scope.setGlobalTotal(0),handlerDf.resolve({action:action,id:id||gridItem.id})):handlerDf.resolve({action:action,id:id||gridItem.id});scope.updateOriginalGridList(gridItem,action,itemIndex),uuid&&(scope.item.mapEditRowByUUID[uuid]=id||gridItem.id,scope.item.savedMapEditRowByUUID=JSON.stringify(scope.item.mapEditRowByUUID),api.env("autosaveDisabled")||api.uploadDraft(!1,null,null,!1,scope.item)),!scope.item.pathToOtherDG||"add"!==action&&"edit"!==action||scope.item.setDataToOtherDG(id||gridItem.id,action,itemIndex),clearDraft&&api.setDraft(clearDraft),scope.toggleModalVisible(!1),scope.setLoading(!1),defer&&defer.resolve()}else defer&&defer.reject()},function(error){scope.setErrorShow(!0),scope.setLoading(!1),scope.toggleModalVisible(!1),defer&&defer.reject()})},scope.updateOriginalGridList=function(item,action,itemIndex,isLocalPaging){var originList=scope.grid.originList,currentPage=scope.currentPage(),pageSize=scope.item.pageSize;switch(action){case"add":originList.push(item);break;case"del":originList.splice(itemIndex,1);break;case"edit":originList.splice(itemIndex,1,item);break;case"clear":scope.grid.originList=[],originList=[];break;case"find":originList=scope.grid.originList=item}action&&(scope.updatePageAndPaging(originList,currentPage,pageSize,scope.paging.maxLength,action,isLocalPaging),scope.visibleButton("add",!(scope.setGlobalTotal()>=scope.item.rowsMaxLength)),scope.visibleButton("upload",!(scope.setGlobalTotal()>=scope.item.rowsMaxLength)),scope.visibleButton("clear",scope.setGlobalTotal()),showGridHeader(originList.length))},scope.setListInfo=function(page,pageSize,listLength,total){var pagingInfo,offset=(page-1)*pageSize,from=offset+1,to=offset+listLength;pagingInfo=total<=pageSize?"":from+"-"+to+" из "+total,scope.paging.info=pagingInfo},scope.updatePageAndPaging=function(originList,currentPage,pageSize,pagingMaxLength,action,isLocalPaging){var filter=scope.gridFilter.value,total=scope.setTotal(),gridList=originList;isLocalPaging&&"del"===action&&(scope.currentPage()-1)*scope.item.pageSize===scope.setTotal()&&scope.setTotal()-1>0&&(scope.currentPage(scope.currentPage()-1),currentPage=scope.currentPage()),scope.grid.list=EditableDataGridService.updateGridList(gridList,currentPage,pageSize,filter,total,action,isLocalPaging),scope.gridFilter.empty=filter&&!gridList.length,scope.setListInfo(currentPage,pageSize,scope.grid.list.length,total||gridList.length),scope.paging.list=EditableDataGridService.getPagingList(total||gridList.length,currentPage,pageSize,pagingMaxLength),scope.paging.pageWidth=scope.isMobile&&scope.paging.list.length>4?"width:"+100/scope.paging.list.length+"%;":"width: 70px;",scope.item.itemValue=JSON.stringify(originList)},scope.paging={currentPage:1,list:[],maxLength:9,minLength:2,show:!1,info:"",pageWidth:"width: 70px;",total:0},scope.currentPage=function(page){return void 0!==page&&(scope.paging.currentPage=page),scope.paging.currentPage},scope.setPage=function(evt,page,isDisabled){evt.preventDefault();Math.ceil(scope.setTotal()/scope.item.pageSize);isDisabled||(scope.currentPage(page),scope.item.consentOfThirdParties?scope.updatePageAndPaging(scope.grid.originList,page,scope.item.pageSize,scope.paging.maxLength,"",!0):scope.filterFromServer(scope.gridFilter.value))},scope.setGlobalTotal=function(value){return void 0!==value&&(scope.paging.globalTotal=value,scope.item.gridValue=0===value?"":value.toString()),scope.paging.globalTotal},scope.setTotal=function(value){return void 0!==value&&(scope.paging.total=value,void 0===scope.paging.globalTotal&&(scope.item.gridValue=0===value?"":value.toString())),scope.paging.total},scope.gridFilter={value:"",isSmall:!1,label:"Поиск по описанию",id:scope.item.fullPath+":filter",empty:!1,emptySet:!1},scope.item.showGridSearch&&scope.$watch("gridFilter.value",function(val,oldVal){void 0!==val&&val!=oldVal&&scope.setGridFilter(val)}),scope.setGridFilter=function(filter){scope.gridFilter.emptySet?scope.gridFilter.emptySet=!1:(scope.currentPage("1"),scope.filterFromServer(filter))},scope.mapListFromServer=function(list,action){for(var mapList=[],i=0,il=list.length;i<il;i++)mapList.push(EditableDataGridService.createGridItemData(scope.gridConfig,scope.fields,list[i],list[i].id,!0,!1,scope.item.colWithStatus,scope.statusMap));scope.updateOriginalGridList(mapList,action,scope.activeItem(),scope.item.consentOfThirdParties)},scope.filterFromServer=function(filter,handlerDf,fireData){scope.setLoading(!0),scope.updateOriginalGridList("","clear");var request={orderId:api.env("orderId"),action:"find",mnemonic:scope.item.gridMnemonic,q:filter||"",pageNum:scope.currentPage(),pageSize:scope.item.pageSize};sharedExtServices.editableGridUpdateRequest(request).then(function(response){var responseData=response.data;responseData&&responseData.data&&(filter||scope.setGlobalTotal(responseData.total),scope.setTotal(responseData.total),scope.mapListFromServer(response.data.data,"find"),scope.setLoading(!1),scope.toggleModalVisible(!1),handlerDf&&handlerDf.resolve(fireData))},function(error){scope.setErrorShow(!0),scope.setLoading(!1)})},scope.item.getGridRows=function(){return scope.grid.list},scope.item.addGridRow=function(){scope.addStringState()},scope.item.removeGridRow=function(rowIndex,id){(id=id||scope.grid.list[rowIndex]&&scope.grid.list[rowIndex].id)&&scope.deleteRow(void 0,rowIndex,id)};var defaultDraft;$rootScope.isDesigner||function(){var statusMap;scope.item.dialogItems=scope.item.items.slice(),scope.item.setDefaultDraftOnOpen&&(defaultDraft=api.saveStepDraft(scope.item.dialogItems)),checkUploader();var hashMapByNames=EditableDataGridService.mapGridColumnNamesToFullPath(scope.item,scope.item.gridColumnNames,scope.item.fieldNames,scope.item.gridColumnLabels,scope.item.gridColumnsWidth);scope.gridConfig=hashMapByNames.grid,scope.columnWidth=Math.floor(20/scope.gridConfig.rowStructure.length),scope.item.customEditButtonLabel&&scope.isDesktop&&(scope.columnWidth=Math.min(10,scope.columnWidth)),scope.isTablet&&(scope.columnWidth=Math.min(5,scope.columnWidth/2)),scope.item.fields=scope.fields=hashMapByNames.fields,scope.fieldsDate=hashMapByNames.fieldsDate,scope.item.statusMap&&(statusMap=scope.item.statusMap.split("|"),scope.statusMap={},statusMap.forEach(function(item){var splitItem=item.split(":");scope.statusMap[splitItem[0]]=splitItem[1]})),"true"===api.env("formParam").isSaveElDraft&&apiInner.loopThroughTheTree(scope.item.items,function(items,item){item.isEDGParent=!0}),scope.item.consentOfThirdParties?scope.item.fileIsCreated?EditableDataGridService.getStatus(scope.invitationType,scope.fields.rowStructure,scope.item.consentOfThirdPartiesMapByRole,scope.item.consentOfThirdPartiesServerDataTypes,scope.item.consentOfThirdPartiesMapTypesHumanity,scope.item.consentOfThirdPartiesMapStatusesHumanity,scope.item.consentOfThirdPartiesMapByRoleFrom,scope.item.colNameWithStatus).then(function(response){if(response&&response.data){if(scope.setTotal(response.total),scope.item.consentOfThirdPartiesEnableByType,response.total>0?(PGU.Events.publish(":needDisableForm",{fullPath:scope.item.fullPath}),api.find(scope.item.pathToAdviceClearInfo).visible(!0),showGridHeader(!0)):(api.find(scope.item.pathToAdviceClearInfo).visible(!1),scope.visibleButton("clear",!1),showGridHeader(!1)),response.allStatusesIsAppoved){for(var pathToPaymentBlockToArray=EditableDataGridService.getListFullNames(scope.item.pathToPaymentBlock),i=0,il=pathToPaymentBlockToArray.length;i<il;i++){var formItem=api.find(pathToPaymentBlockToArray[i]);if("FormStep"===formItem.element.className){formItem.visible(!0);break}}api.find("form.NavPanel.__nextStep").disabled(!1)}response.hasOneCanceled&&api.find(scope.item.pathToAdviceRejectInfo).visible(!0),scope.mapListFromServer(response.data,"find"),scope.setLoading(!1),scope.toggleModalVisible(!1),scope.item.consentOfThirdPartiesStatus=response.allStatusesIsAppoved?"Y":0===response.total?"":"N"}else scope.setErrorShow(!0),scope.setLoading(!1)}):(api.find(scope.item.pathToAdviceClearInfo).visible(!1),scope.visibleButton("clear",!1),showGridHeader(!1)):scope.item.gridMnemonic?scope.item.fileIsCreated&&scope.filterFromServer():(scope.item.gridMnemonic=uuid&&uuid.v4(),scope.visibleButton("clear",!1),showGridHeader(!1))}();var watchers;scope.$on("suspend",function(){watchers=scope.$$watchers,scope.$$watchers=[]}),scope.$on("resume",function(){scope.$$watchers=watchers,watchers=null}),scope.$emit(scope.item.fullPath+":ScopeApplied",{scope:scope,element:element}),scope.item.isScopeAppliedDone={scope:scope,element:element}}}}]).factory("EditableDataGridExt",["$rootScope","fieldAttrs","EditableDataGridService",function($rootScope,fieldAttrs,EditableDataGridService){return{attrs:angular.extend({},fieldAttrs.attrs,{validators:{"scope:editor":!1},gridValue:{type:"string","scope:editor":!1,"scope:sync":!0,default:""},value:{"scope:editor":!1,"scope:sync":!1,default:""},customFields:{"scope:editor":!1,default:[]},mnemonic:{type:"string",default:"","scope:sync":!1,"scope:editor":!1},gridMnemonic:{type:"string",default:"","scope:sync":!0},fileIsCreated:{type:"string",default:"","scope:sync":!0},escaped:{type:"boolean",default:!1},separator:{type:"string",default:","},withCustomUploader:{type:"boolean",default:!1},page:{type:"number",default:1},pageSize:{type:"number",default:10},rowsMaxLength:{type:"number",default:1500},gridUUID:{"scope:editor":!1,type:"number",default:1},addStringButtonName:{type:"string",default:"Добавить строку"},uploadButtonName:{type:"string",default:"Загрузить файл"},clearButtonName:{type:"string",default:"Удалить все строки"},attachmentTemplateUrl:{type:"string",default:"/"},attachmentExampleUrl:{type:"string",default:"/"},attachmentErrorReportUrl:{type:"string",default:""},fileInfoSaveLinkText:{type:"string",default:"Сохранить"},gridColumnLabels:{type:"string",default:"№,Описание товара,Стоимость,Осн. количество,Доп. количество,Доп. ед. измерения"},gridColumnNames:{type:"string",default:"number,description,cost,mainQuantity,additionalQuantity,unit"},fieldNames:{type:"string",default:"number,description,cost,mainQuantity,additionalQuantity,unit"},showAddStringButton:{type:"boolean",default:!1},showUploadButton:{type:"boolean",default:!1},showClearButton:{type:"boolean",default:!1},showGridSearch:{type:"boolean",default:!1},filterByName:{type:"string",default:""},popupTitle:{type:"string",default:""},isNumberFirstInPopupTitle:{type:"boolean",default:!1},popupButtonSaveTitle:{type:"string",default:"Сохранить"},popupButtonCancelTitle:{type:"string",default:"Не сохранять"},instructions:{type:"string",default:"<ul><li>Формат файла с&nbsp;данными: текстовый с&nbsp;разделителями, в&nbsp;кодировке ANSI</li><li>Первая строка&nbsp;&mdash; заголовки столбцов. Разделитель&nbsp;&mdash; символ табуляци.</li><li>Для получения файла в&nbsp;нужном формате при сохранении файла в&nbsp;приложении Excel выберите тип &laquo;Текстовые файлы (с&nbsp;разделителями табуляции)&raquo;.</li></ul><h4>Порядок столбцов:</h4><ol><li>Описание товара&nbsp;&mdash; обязательное</li><li>Стоимость товара&nbsp;&mdash; обязательное</li><li>Количество в&nbsp;основной единице измерения&nbsp;&mdash; обязательное</li><li>Количество в&nbsp;дополнительной единице измерения&nbsp;&mdash; необязательное</li><li>Дополнительная единица измерения&nbsp;&mdash; из&nbsp;справочника, необязательное</li></ol>"},validatorsRegexps:{type:"string",default:""},validatorsMessages:{type:"string",default:""},dictionariesForCheckByColumn:{type:"string",default:""},dictionariesCheckBy:{type:"string",enum:["refCheck","refCheckByCode"],enumOptions:{refCheck:"По значению (title)",refCheckByCode:"По коду (value)"},default:"refCheck"},dictionariesMessagesForCheckByColumn:{type:"string",default:""},colWithStatus:{type:"string",default:""},colNameWithStatus:{type:"string",default:"State"},statusMap:{type:"string",default:""},consentOfThirdParties:{type:"boolean",default:!1},consentOfThirdPartiesMapByRole:{type:"string",default:"PERSON:id=SNILS_FL,birthDate=birthDate_FL,email=Email|LEGAL:id=SNILS_UL,birthDate=birthDate_UL,email=Email,ogrn=OGRN|SOLE_PROPRIETOR:id=SNILS_FL,birthDate=birthDate_FL,email=Email,ogrn=OGRN_IP"},consentOfThirdPartiesDataTypes:{type:"string",default:"PERSON:SNILS|LEGAL:OGRN|SOLE_PROPRIETOR:OGRNIP"},consentOfThirdPartiesServerDataTypes:{type:"string",default:"SNILS:PERSON|OGRN:LEGAL|OGRNIP:SOLE_PROPRIETOR"},consentOfThirdPartiesMapByRoleFrom:{type:"string",default:"Category"},consentOfThirdPartiesMapTypesHumanity:{type:"string",default:"SNILS:Физическое лицо|OGRN:Юридическое лицо|OGRNIP:Индивидуальный предприниматель"},consentOfThirdPartiesMapStatusesHumanity:{type:"string",default:"N:Отправлено|A:В работе|REJECTED:Отказ|APPROVED:Получено согласие"},consentOfThirdPartiesError:{type:"string",default:"Приглашение с указанными данными уже отправлено. Измените данные или удалите предыдущее приглашение."},pathToPaymentBlock:{type:"string",default:"form.FormStepPay.Panel_Pay.Payment"},pathToUserType:{type:"string",default:"form.FormStepInfo.PanelService.userType"},pathToAdviceRejectInfo:{type:"string",default:"form.FormStep201.Panel202.HelperBoxFailure"},pathToAdviceClearInfo:{type:"string",default:"form.FormStep201.Panel202.HelperBox2729"},consentOfThirdPartiesStatus:{type:"string",default:""},consentOfThirdPartiesEnableByType:{type:"boolean",default:"false"},handlerFireData:{type:"string",default:"","scope:editor":!1,"scope:sync":!0},fieldNumName:{type:"string",default:"№"},hasRules:{type:"boolean","scope:editor":!1,default:!0},pathToOtherDG:{type:"string",default:""},customEditButtonLabel:{type:"string",default:""},savedMapEditRowByUUID:{type:"string",default:"","scope:editor":!1,"scope:sync":!0},changeCounter:{type:"number",default:0,"scope:editor":!1},setDefaultDraftOnOpen:{type:"boolean",default:!1},gridColumnsWidth:{type:"string",default:"","scope:editor":$rootScope.isAdminUser},alignText:{type:"string",enum:["left","center"],enumOptions:{left:"По левому",center:"По центру"},default:"left","scope:editor":$rootScope.isAdminUser},notOverflowText:{type:"boolean",default:!1,"scope:editor":$rootScope.isAdminUser}}),fillItems:function(item){return this.fillFullPath(EditableDataGridService.createStructure(this.element.gridColumnNames),this.element.fullPath)},fillFullPath:function(structure,parentPath){if(structure.fullPath=parentPath+"."+structure.name,structure.originalFullPath=parentPath+"."+structure.name,structure.items&&structure.items.length)for(var i=0;i<structure.items.length;i++)structure.items[i]=this.fillFullPath(structure.items[i],structure.fullPath);return structure},getRows:function(num){var arr=this.element.getGridRows()||[],result=arr.map(function(i){var obj={};return Object.keys(i).forEach(function(key){"cells"!==key&&"fields"!==key&&(obj[key]=i[key])}),obj});return void 0!==num?result[num]:result},addRow:function(){this.element.addGridRow()},removeRow:function(rowIndex,id){(id||rowIndex)&&this.element.removeGridRow(rowIndex,id)}}}]).factory("EditableDataGridService",["$rootScope","$filter","$q","sharedExtServices",function($rootScope,$filter,$q,sharedExtServices){return{createStructure:function(gridColumnNames,withCustomUploader){var self=this,dataFromAttribute=gridColumnNames?gridColumnNames.split(","):[],config=[{className:"FieldTextArea",label:"Описание товара",name:"description"},{label:"Стоимость",name:"cost",gridWidth:"one-half"},{label:"Основное количество",name:"mainQuantity",gridWidth:"one-half"},{label:"Дополнительное количество",name:"additionalQuantity",gridWidth:"one-half"},{className:"FieldDropdown",dictionary:"dictory_valyta_minprom_57112",label:"Дополнительная единица измерения",name:"unit",gridWidth:"one-half"}],structure={className:"Panel",name:"PanelControls",title:"",isGrid:!0,doNotSave:!0,doNotSaveDraft:!1,syncRender:!0,visible:!0,items:[]};return dataFromAttribute.forEach(function(item,ind){var itemByName=config.find(function(ii){return ii.name===item});itemByName&&structure.items.push(self.getItem(itemByName))}),withCustomUploader&&structure.push(this.getCustomUploader()),structure},getCustomUploader:function(fullPath){return{className:"FieldUpload",fileType:"",visible:!0,name:"_customUploader",fullPath:fullPath?fullPath+"._customUploader":"_customUploader",multipleUpload:!0}},getItem:function(data){var res={className:"Panel",name:"Panel"+data.name,title:"",isGridItem:!0,doNotSave:!0,doNotSaveDraft:!1,syncRender:!0,items:[{className:data.className||"FieldText",name:data.name,label:data.label,notRequiredText:"",doNotSaveDraft:!1,required:!0,syncRender:!0,doNotShowInPdf:!0}]};return data.gridWidth&&(res.gridWidth=data.gridWidth),data.dictionary&&(res.items[0].dictionary={code:data.dictionary,type:"remote"}),res},findUploader:function(items,className){var result=-1;return items.forEach(function(item,index){item&&item.className===className&&(result=index)}),result},findFieldByName:function(item,name,result,fieldsDate){var self=this;item&&item.name===name&&(result[name]=item.fullPath,fieldsDate&&"FieldTextDate"===item.className&&fieldsDate.push(item.fullPath)),item.items&&item.items.length&&item.items.forEach(function(field){self.findFieldByName(field,name,result,fieldsDate)}),void 0===result[name]&&(result[name]="")},mapGridColumnNamesToFullPath:function(item,gridColumnNames,fieldNames,gridColumnLabels,styles){var self=this,result={grid:{hashMap:{},rowStructure:[],header:[]},fields:{hashMap:{},rowStructure:[]},fieldsDate:[]};if(result.grid.rowStructure=gridColumnNames?gridColumnNames.split(","):[],styles&&styles.length){result.grid.styles=[];var stylesArr=styles.split(",");result.grid.rowStructure.forEach(function(item,ind){var width=stylesArr[ind]?"width:"+stylesArr[ind]+"px;":"width:auto;";result.grid.styles.push(width)})}result.fields.rowStructure=fieldNames?fieldNames.split(","):[];var gridLabelsArr=gridColumnLabels?gridColumnLabels.split(","):[];return result.grid.rowStructure.forEach(function(name,ind){result.grid.header.push({label:gridLabelsArr[ind]||""}),self.findFieldByName(item,name,result.grid.hashMap)}),result.fields.rowStructure.forEach(function(name,ind){self.findFieldByName(item,name,result.fields.hashMap,result.fieldsDate)}),result},getDraftData:function(hashMap,gridItem){var result={};for(var k in hashMap)if(hashMap.hasOwnProperty(k)){result[hashMap[k]]={};var data=function(name){return gridItem.fields.find(function(item){return name===item.name})}(k);for(var j in data)data.hasOwnProperty(j)&&"name"!==j&&(result[hashMap[k]][j]=data[j]||"")}return result},setFieldsDefaultState:function(hashMap,api){var item;for(var k in hashMap)hashMap.hasOwnProperty(k)&&(item=api.find(hashMap[k]))&&item.visible()&&(item.visible(!1),item.validate(!0),item.visible(!0))},getClearDraft:function(draft){var j,result={};for(var k in draft)if(draft.hasOwnProperty(k)){result[k]={};for(j in draft[k])draft[k].hasOwnProperty(j)&&"className"!==j&&(result[k][j]="")}return result},updateGridList:function(originalList,page,pageSize,filter,total,action,isLocalPaging){var pageOffset=0;isLocalPaging&&(pageOffset=(page-1)*pageSize);var sliceEnd,originalLength=originalList.length;return sliceEnd=originalLength<=pageSize?originalLength:isLocalPaging?page*pageSize:pageSize,filter?this.highLightGridData(originalList.slice(pageOffset,sliceEnd),filter):"find"!==action||isLocalPaging?originalList.slice(pageOffset,sliceEnd):originalList},setDraftToField:function(name,data,isUpload){var result={name:name};if(isUpload)return result.value=result.title=data?data.toString():"",result;if(data)for(var k in data)data.hasOwnProperty(k)&&(result[k]=data[k]);return result},createGridItemData:function(gridConfig,fieldsConfig,data,id,isUpload,customUploader,colWithIcon,statusMap){var row={id:id,fields:[]},mapLoadData={};isUpload&&fieldsConfig.rowStructure.forEach(function(item,i){mapLoadData[item]=data["r"+(i+1)]||""});var filesForFields,fileForFieldById,dataValue;for(var k in fieldsConfig.hashMap)fieldsConfig.hashMap.hasOwnProperty(k)&&(customUploader&&fieldsConfig.hashMap[k]===customUploader.fullPath?(filesForFields=customUploader.files,fileForFieldById=filesForFields.find(function(file){return row.id?file.rowUid===row.id:!file.rowUid}),dataValue={value:fileForFieldById.name||""}):dataValue=isUpload?mapLoadData[k]:data[fieldsConfig.hashMap[k]],row.fields.push(this.setDraftToField(k,dataValue,isUpload)));return row.cells=gridConfig.rowStructure.map(function(item,i){var files,fileById,obj,mobileCellLabel=gridConfig.header[i],itemData={name:item,mobileCellLabel:mobileCellLabel?mobileCellLabel.label:""};if(isUpload)return itemData.title=mapLoadData[item]?mapLoadData[item].toString():"",row[item]=itemData.title,i+1==colWithIcon&&statusMap&&(itemData.cellWithIcon=!0,itemData.status=statusMap[itemData.title],"ok"!==itemData.status&&"cancel"!==itemData.status||(row.isDisabled=!0)),itemData;if(gridConfig.hashMap[item]){obj=data[gridConfig.hashMap[item]];for(var k in obj)obj.hasOwnProperty(k)&&(itemData[k]=obj[k])}return customUploader&&gridConfig.hashMap[item]===customUploader.fullPath?(files=customUploader.files,fileById=files.find(function(file){return row.id?file.rowUid===row.id:!file.rowUid}),itemData.title=fileById.name||""):itemData.title=obj?obj.value:"",i+1==colWithIcon&&statusMap&&(itemData.cellWithIcon=!0,itemData.status=statusMap[itemData.title],"ok"!==itemData.status&&"cancel"!==itemData.status||(row.isDisabled=!0)),row[item]=itemData.title,itemData}),row},getPagingList:function(originalListLength,currentPage,pageSize,pagingMaxSize){var position,pagesLength=Math.ceil(originalListLength/pageSize),half=Math.ceil(pagingMaxSize/2),withInterval=!1,firstInterval=!1,lastInterVal=!1;return originalListLength<=pageSize?[]:(pagesLength>pagingMaxSize&&(withInterval=!0),withInterval?(position=currentPage<=half?"start":pagesLength-half<currentPage?"end":"middle","start"!==position&&"middle"!==position||(lastInterVal=!0),"middle"!==position&&"end"!==position||(firstInterval=!0),this.getPagingItemsWithIntervals(pagesLength,currentPage,half,firstInterval,lastInterVal,pagingMaxSize)):this.getPagingItems(pagesLength))},getPagingItems:function(listLength){for(var result=[],i=0,il=listLength;i<il;i++)result.push({value:i+1});return result},getPagingItemsWithIntervals:function(pagesLength,currentPage,half,firstInterval,lastInterval,pagingMaxSize){for(var result=[],i=0,il=pagingMaxSize;i<il;i++)0===i?result.push({value:i+1}):i===pagingMaxSize-1?result.push({value:pagesLength}):1===i&&firstInterval?result.push({disabled:!0,value:"..."}):i===pagingMaxSize-2&&lastInterval?result.push({disabled:!0,value:"..."}):pagesLength-half<currentPage?result.push({value:pagesLength-pagingMaxSize+i+1}):half<currentPage?result.push({value:currentPage-half+i+1}):result.push({value:i+1});return result},findById:function(list,id){var gridItemIndex=-1;return{gridItem:list.find(function(item,i){return item.id===id&&(gridItemIndex=i),item.id==id}),gridItemIndex:gridItemIndex}},filterByName:function(list,searchString,filterByName,filterByStructure){var filterBy={},filteredList=[];filterBy[filterByName||"$"]=searchString;list.filter(function(item,i){var found=!1;return filterByName?item[filterByName]&&item[filterByName].indexOf(searchString)>-1:(filterByStructure.forEach(function(ii,ind){found||(found=item[ii]&&item[ii].indexOf(searchString)>-1)}),found)});return filteredList},highLightGridData:function(list,filter){var wordsArr=filter.split(" "),wordsArrMapReqExp={};return wordsArr.forEach(function(word,i){wordsArrMapReqExp[i+1]=new RegExp("("+word.replace(/([\/|()*+?$^{}\[\].\\])/g,"\\$1")+")","i")}),list.map(function(item,i){var obj={};for(var k in item)item.hasOwnProperty(k)&&"fields"!==k&&"cells"!==k&&(obj[k]=item[k]);return obj.fields=item.fields.map(function(field){var copyField={};for(var j in field)field.hasOwnProperty(j)&&(copyField[j]=item[j]);return copyField}),obj.cells=item.cells.map(function(cell){var copyCell={},cellTitle="";for(var j in cell)cell.hasOwnProperty(j)&&(copyCell[j]=cell[j]);return cellTitle=cell.title||"",wordsArr.forEach(function(word,i){cellTitle=cellTitle.replace(wordsArrMapReqExp[i+1],'<span class="PGU-Highlight PGU-Highlight-Yellow">$1</span>')}),copyCell.title=cellTitle,copyCell}),obj})},getRequestParamsForUploader:function(values,msg,valuesAbbr,msgAbbr,specialAbbr){var valuesArray=values.split("`"),msgArray=msg.split("`"),result={};return valuesArray.forEach(function(item,i){var message=msgArray[i];item&&(result[valuesAbbr+(i+1)]=(specialAbbr||"")+item,message&&(result[msgAbbr+(i+1)]=message))}),result},createRowsDataByNames:function(data,total,cols,header){var result=[],headerValues=[];header&&header.length&&(header.forEach(function(item){headerValues.push(item.label||"")}),headerValues.push("Все ошибки"),result.push(headerValues));for(var rowData,foundedByCol,allMessages="",msg="",i=0,il=total;i<il;i++){var row=function(idx){return data.filter(function(item){return item.row==idx+1})}(i);rowData=[],allMessages="";for(var j=0,jl=cols+1;j<jl;j++)msg="",0===j&&(foundedByCol=function(idx){return row.find(function(item){return item.col==idx})}(j))&&(allMessages+="Неправильное количество колонок в строке"),foundedByCol=function(idx){return row.find(function(item){return item.col==idx+1})}(j),row.length&&foundedByCol?(msg="значение: "+(foundedByCol.value||"отсутствует")+", ошибка: "+(foundedByCol.message||""),allMessages+=allMessages?" & "+headerValues[j]+" - "+msg:headerValues[j]+" - "+msg,rowData[j]=msg):rowData.push(""),j===cols&&(rowData[j]=allMessages);result.push(rowData)}return result},exportToCSV:function(data){var fileData;return data&&(fileData=data.reduce(function(result,row){return result+row.reduce(function(rowResult,cell,i){return rowResult+'"'+cell.replace(/"/g,'""')+'"'+(i<row.length-1?",":"")},"")+"\n"},"")),fileData},exportToCSVByMap:function(data){function escapeValue(val){var result="";return"string"==typeof val?result+='"'+val.replace(/"/g,'""')+'"':val&&(result=val),result}if(data)return data.map(function(item){return item.map(function(cell){return escapeValue(cell)}).join("\t")}).join("\n")+"\n"},convertToUtf16:function(str){var buffer=new ArrayBuffer(2*str.length),bufferView=new Uint16Array(buffer);bufferView[0]=65279
;for(var val,i=0,il=str.length;i<il;i++)val=str.charCodeAt(i),bufferView[i+1]=val;return bufferView},findParentStep:function(element){function findStep(item){return item&&item.element&&"FormStep"===item.element.className?item.element.fullPath:item&&item.element&&"FormStep"!==item.element.className&&item.parent()?findStep(item.parent()):void 0}return findStep(element.parent.apiElem)},sendInvitation:function(type,requestData,parentStep,api){var defer=$q.defer();return api.find(parentStep).submit("submit",0,{done:function(){sharedExtServices.invitationService.sendInvitation(requestData,function(data){defer.resolve(data)},function(error){defer.reject(error),api.shade(!1)},type)},error:function(error){defer.reject(error),api.shade(!1)}}),defer.promise},getStatus:function(invitationType,fields,mapByRole,dataTypes,typesHumanity,statusesHumanity,mapByRoleFrom,colNameWithStatus){var self=this,def=$q.defer();return sharedExtServices.invitationService.getStatus(invitationType).then(function(response){var data=response.data||[],result={};result.total=data.length,result.allStatusesIsAppoved=!0,result.hasOneCanceled=!1,result.data=data.map(function(item){return"Y"!==item.status&&("O"===item.status&&(result.hasOneCanceled=!0),result.allStatusesIsAppoved=!1),self.getDataByRole(item,fields,mapByRole,dataTypes,typesHumanity,statusesHumanity,mapByRoleFrom,colNameWithStatus)}),def.resolve(result)},function(error){def.resolve({error:!0})}),def.promise},getMapByRole:function($item,map,role,draft){var arr=map.split("|"),mapObj={},fullPathMap={},self=this;return arr.forEach(function(item){var itemMap,itemArr=item.split(":");itemArr[0]===draft[role].value&&(itemMap=itemArr[1].split(","),itemMap.forEach(function(elem){var elemArr=elem.split("=");self.findFieldByName($item,elemArr[1],fullPathMap),mapObj[elemArr[0]]=draft[fullPathMap[elemArr[1]]]?draft[fullPathMap[elemArr[1]]].value:""}))}),mapObj},getMapForHumanity:function(str){if(!str)return null;var result={};return str.split("|").forEach(function(item){var arrFromItem;item&&(arrFromItem=item.split(":"),arrFromItem[0]&&(result[arrFromItem[0]]=arrFromItem[1]))}),result},getDataByRole:function(data,fields,typesMap,types,typesHumanity,statusesHumanity,mapByRoleFrom,colNameWithStatus){var arr=typesMap.split("|"),mapObj={},result={},type=data.type,mapTypesHumanity=this.getMapForHumanity(typesHumanity),mapStatusesHumanity=this.getMapForHumanity(statusesHumanity),mapTypes=this.getMapForHumanity(types);type||(type="SNILS");var role=type?mapTypes[type]:"";return arr.forEach(function(item){var itemMap,itemArr=item.split(":");itemArr[0]===role&&(itemMap=itemArr[1].split(","),itemMap.forEach(function(elem){var elemArr=elem.split("=");mapTypesHumanity&&(mapObj[elemArr[1]]=data[elemArr[0]]?data[elemArr[0]]:"")}))}),fields.forEach(function(item,i){result["r"+(i+1)]=item===mapByRoleFrom?mapTypesHumanity[type]||"":item===colNameWithStatus?mapStatusesHumanity[data.status]||"":mapObj[item]?mapObj[item]:""}),result.id=data.recordId||"",result},getNextPage:function(total,newTotal,pageSize){var page=1;void 0===total&&(total=0);var currentPages=Math.ceil(total/pageSize);return page=Math.ceil(newTotal/pageSize)>currentPages?currentPages+1:currentPages,total%pageSize!=0&&(page=currentPages),page},getListFullNames:function(fullName){for(var arr=fullName.split("."),result=[],i=0,il=arr.length;i<il;i++){var arrSlice=arr.slice(0,i+1),str=arrSlice.join(".");result.push(str)}return result}}}]),angular.module("serverFormWidgets.general").directive("epguConfirmPanel",["$rootScope","TEMPLATES","api","sharedExtServices","ConfirmPanelService","FORM_ERRORS",function($rootScope,TEMPLATES,api,sharedExtServices,ConfirmPanelService,FORM_ERRORS){return{templateUrl:TEMPLATES.CONFIRM_PANEL,scope:{item:"="},link:function(scope,element,attrs){scope.item.agreementResult&&($rootScope.env.IS_AGREEMENT_SUBMIT="Y",$rootScope.env.AGREEMENT_RESULT="APPROVE"===scope.item.agreementResult?"Y":"O"),scope.ui={btnCancel:{balign:"left",floating:"PGU-BtnFloat",label:scope.item.cancelButtonName,fullPath:scope.item.fullPath?scope.item.fullPath+"._btnCancel":"_btnCancel",buttonSize:"small",visible:!0},btnApply:{balign:"right",floating:"PGU-BtnFloat",label:scope.item.applyButtonName,fullPath:scope.item.fullPath?scope.item.fullPath+"._btnApply":"_btnApply",buttonSize:"small",btnColor:"blue",visible:!0}},scope.cancelConfirm=function(){scope.sendConfirmRequest("reject")},scope.applyConfirm=function(){scope.sendConfirmRequest("approve")},scope.sendConfirmRequest=function(action){var parentStep=ConfirmPanelService.findParentStep(scope.item),elementParentStep=api.find(parentStep),upperAction=action?action.toUpperCase():"",newResultStatus="approve"===action?"Y":"O";api.validate()&&(scope.item.attrs.agreementResult["scope:sync"]=!0,scope.item.agreementResult=upperAction,$rootScope.env.IS_AGREEMENT_SUBMIT="Y",$rootScope.env.AGREEMENT_RESULT=newResultStatus,elementParentStep.submit("submit",0,{done:function(){elementParentStep.element.excludeFromStepList=!0;var stepList=api.getVisibleSteps(),step=0;api.shade(!0),step=api.env("supportSignature")?stepList.length-2:stepList.length-1,api._currentStep=step,api.step(step),api.triggerNextStep()},error:function(){api.fixedShade(!0),api.shade(!1),api.shade(!1),api.visible(!1),api.showAdvice(FORM_ERRORS.default)}}))};var watchers;scope.$on("suspend",function(){watchers=scope.$$watchers,scope.$$watchers=[]}),scope.$on("resume",function(){scope.$$watchers=watchers,watchers=null}),scope.$emit(scope.item.fullPath+":ScopeApplied",{scope:scope,element:element}),scope.item.isScopeAppliedDone={scope:scope,element:element}}}}]).factory("ConfirmPanelExt",["containerAttrs",function(containerAttrs){return{attrs:angular.extend({},containerAttrs.attrs,{html:{"scope:editor":!1},visible:{type:"boolean",enum:[!0,!1],enumOptions:{true:"Да",false:"Нет"},default:!0},fixName:{type:"boolean",enum:[!0,!1],enumOptions:{true:"Да",false:"Нет"},default:!1,"scope:editor":!1},cancelButtonName:{type:"string",default:"Отказать"},applyButtonName:{type:"string",default:"Отправить согласие"},agreementResult:{type:"string",default:""}})}}]).factory("ConfirmPanelService",["$rootScope","$q","sharedExtServices",function($rootScope,$q,sharedExtServices){return{findParentStep:function(element){function findStep(item){return item&&item.element&&"FormStep"===item.element.className?item.element.fullPath:item&&item.element&&"FormStep"!==item.element.className&&item.parent()?findStep(item.parent()):void 0}return findStep(element.parent.apiElem)}}}]),angular.module("serverFormWidgets.general").directive("epguSMSConfirmDialog",["$rootScope","$timeout","$location","TEMPLATES","TEMPLATES_PLAYER","api","sharedExtServices","SMSConfirmDialogService","PGU",function($rootScope,$timeout,$location,TEMPLATES,TEMPLATES_PLAYER,api,sharedExtServices,SMSConfirmDialogService,PGU){return{templateUrl:TEMPLATES.SMS_CONFIRM_DIALOG,scope:{item:"="},link:function(scope,element,attrs){function clearRejectError(){scope.popup.rejectError=!1,scope.popup.rejectErrorServerData=!1,scope.popup.counterReject=""}function updateCounterData(data){var counter=Math.floor(data/1e3);scope.setDefaultPopupState(),updateCounter(counter),scope.item.visible=!0,scope.item.smsConfCodeExpTime=0}api.env("SMSConfirmDialog",scope.item.fullPath);var smsConfCodeAttempt,secondTitles=["секунду","секунды","секунд"],attemptTitles=["попытка","попытки","попыток"],attemptActions=["осталась","осталось","осталось"],restrictionPerUser=["раза","раз","раз"],restrictionDays=["день","дня","дней"],serviceFormInfo=api.env("serviceFormInfo");scope.popup={orderSmsConfRestrictionPerUser:SMSConfirmDialogService.getCounter($rootScope.settings.orderSmsConfRestrictionPerUser||10,restrictionPerUser),orderSmsConfDaysRestriction:SMSConfirmDialogService.getCounter($rootScope.settings.orderSmsConfDaysRestriction||5,restrictionDays),userPhone:SMSConfirmDialogService.getPhone(api.env("esia")),lcUrl:api.env("siaWebHostEdit")+"?mobile=",tpl:TEMPLATES_PLAYER.SMS_CONFIRM_DIALOG,btnApply:{balign:"center",floating:"PGU-BtnFloat",label:scope.item.applyButtonName,fullPath:scope.item.fullPath?scope.item.fullPath+"._btnApply":"_btnApply",buttonSize:"medium",btnColor:"blue",visible:!0,name:"_btnApply",handleOnEnter:!0},btnChangePhone:{balign:"center",floating:"PGU-BtnFloat",label:"Изменить номер телефона",fullPath:scope.item.fullPath?scope.item.fullPath+"._btnChangePhone":"_btnChangePhone",buttonSize:"medium",btnColor:"blue",visible:!0,name:"_btnChangePhone"}},scope.btnChangePhone=function(){var notifySMU=api.env("notifySMU");notifySMU?notifySMU({eventType:"open_screen",eventParams:[{key:"screen",value:"EditContactInfo"}]}):window.location=scope.popup.lcUrl};var timeoutCounter,timeoutRejectCounter,stackDefer;scope.setDefaultPopupState=function(){scope.popup.errorMessage="",scope.popup.btnApply.label=scope.item.applyButtonName,api.find(scope.item.fullPath).find("SMSConfirmDialogCode").visible(!0),PGU.Events.publish(scope.item.fullPath+".SMSConfirmDialogCode:setFocus",{setFocus:!0}),scope.setBtnLoading(!1)};var updateCounter=function(num){if(timeoutCounter&&$timeout.cancel(timeoutCounter),!num)return void scope.setErrorState();scope.item.smsConfCodeExpTime=num,scope.popup.counter=SMSConfirmDialogService.getCounter(num,secondTitles),timeoutCounter=$timeout(function(){--num,updateCounter(num)},1e3)},updateRejectCounter=function(num){if(timeoutRejectCounter&&$timeout.cancel(timeoutRejectCounter),!(num&&num>=1e3))return clearRejectError(),void scope.setErrorState(!1,!0);scope.popup.counterReject=SMSConfirmDialogService.convertMillisecondsToHumanView(num),timeoutRejectCounter=$timeout(function(){num-=1e3,updateRejectCounter(num)},1e3)};scope.setErrorState=function(isWrongCode,hideErrorMsg){isWrongCode?(--scope.item.smsConfCodeAttempt,api.find(scope.item.fullPath).find("SMSConfirmDialogCode").error(scope.item.wrongCodeError),scope.popup.errorMessage=scope.item.wrongCodeError+" У вас "+SMSConfirmDialogService.getCounter(scope.item.smsConfCodeAttempt,attemptActions,!0)+" "+SMSConfirmDialogService.getCounter(scope.item.smsConfCodeAttempt,attemptTitles)):(scope.popup.counter=0,scope.item.smsConfCodeExpTime=0,scope.item.smsConfCodeAttempt=smsConfCodeAttempt,scope.popup.errorMessage=isWrongCode?scope.item.wrongCodeError:hideErrorMsg?"":scope.item.expiredTimeError,scope.popup.btnApply.label=scope.item.reApplyButtonName,api.find(scope.item.fullPath).find("SMSConfirmDialogCode").visible(!1))},scope.setBtnLoading=function(value){if(void 0===value)return scope.popup.btnApply.isLoad;scope.popup.btnApply.isLoad=value},scope.checkCode=function(){scope.setBtnLoading(!0);var codeField=api.find(scope.item.fullPath).find("SMSConfirmDialogCode");0===scope.popup.counter?scope.getCode():codeField.validate()?(scope.popup.counter=null,scope.popup.errorMessage="",sharedExtServices.smsService.checkCode(codeField.value()).then(function(response){!0!==serviceFormInfo.election||"312414"!==serviceFormInfo.PASS_CODE&&"340139"!==serviceFormInfo.PASS_CODE||api.sendReachGoal("votePopupClick",{okato:$rootScope.userSelectedRegion},24845174),api.env("smsCorrect",!0),scope.item.visible=!1,stackDefer.resolve(),scope.item.smsConfCodeAttempt=0},function(response){if(response){if(408===response.status)scope.setErrorState(),updateCounter(0);else if(409===response.status)scope.setErrorState(!0);else if(403===response.status)return updateCounter(0),scope.setErrorState(!1,!0),void scope.getCode();!0!==serviceFormInfo.election||"312414"!==serviceFormInfo.PASS_CODE&&"340139"!==serviceFormInfo.PASS_CODE||api.sendReachGoal("votePopupClickFalse",{okato:$rootScope.userSelectedRegion},24845174),scope.setBtnLoading(!1)}})):scope.setBtnLoading(!1)},scope.getCode=function(){scope.popup.error500=!1,sharedExtServices.smsService.getCode().then(function(request){scope.item.smsConfCodeAttempt=smsConfCodeAttempt,updateCounterData(request&&request.data||0),api.shade(!1)},function(error){if(429===error.status){if(scope.item.visible=!0,scope.popup.rejectError=!0,error.data){var ms=error.data||432e5;updateRejectCounter(ms),scope.setBtnLoading(!1),scope.popup.rejectErrorServerData=!0}else stackDefer.reject();api.shade(!1)}else 500===error.status?(scope.popup.error500=!0,scope.popup.btnApply.label=scope.item.applyButtonNameError500,scope.popup.counter=0,scope.item.visible=!0,scope.setBtnLoading(!1),api.shade(!1)):stackDefer.reject()})},scope.item.openSMSConfirmDialog=function(defer){stackDefer=defer,scope.popup.userPhone=scope.popup.userPhone||SMSConfirmDialogService.getPhone(api.env("esia")),scope.popup.userPhone&&(scope.item.smsConfCodeExpTime?(updateCounterData(1e3*scope.item.smsConfCodeExpTime),api.shade(!1)):scope.getCode())},scope.item.smsConfCodeExpTime&&updateCounter(Math.floor(scope.item.smsConfCodeExpTime/1e3)),scope.item.smsConfCodeAttempt&&(smsConfCodeAttempt=scope.item.smsConfCodeAttempt),scope.toggleModalVisible=function(val){stackDefer&&stackDefer.reject()};var watchers;scope.$on("suspend",function(){watchers=scope.$$watchers,scope.$$watchers=[]}),scope.$on("resume",function(){scope.$$watchers=watchers,watchers=null}),scope.$emit(scope.item.fullPath+":ScopeApplied",{scope:scope,element:element})}}}]).factory("SMSConfirmDialogExt",["containerAttrs",function(containerAttrs){return{attrs:angular.extend({},containerAttrs.attrs,{html:{"scope:editor":!1},visible:{type:"boolean",enum:[!0,!1],enumOptions:{true:"Да",false:"Нет"},default:!0},applyButtonName:{type:"string",default:"Отправить"},reApplyButtonName:{type:"string",default:"Выслать новый код"},applyButtonNameError500:{type:"string",default:"Выслать код"},expiredTimeError:{type:"string",default:"Срок действия кода подтверждения истек"},wrongCodeError:{type:"string",default:"Неверный код."},smsConfCodeExpTime:{type:"number",default:0},smsConfCodeAttempt:{type:"number",default:0},smsRejectTitle:{type:"string",default:"Подтвердите отправку заявления"},smsRejectMessage:{type:"string",default:""},smsRejectAdvice:{type:"string",default:""},smsRejectAdviceButtonLabel:{type:"string",default:"Изменить номер телефона"}})}}]).factory("SMSConfirmDialogService",["$rootScope","$q","sharedExtServices","declineOfUnit",function($rootScope,$q,sharedExtServices,declineOfUnit){return{getPhone:function(data){var phoneData,contacts=data&&data.contacts||[],result="";return contacts&&contacts.length&&(phoneData=contacts.find(function(item){return"MBT"===item.type})),phoneData&&"VERIFIED"===phoneData.vrfStu&&(result=phoneData.value),result||!$rootScope.settings.user.orgId&&!$rootScope.settings.user.orgOid||(result=$rootScope.originalUserData.personMobilePhone),result},getCounter:function(num,titles,notNum){return notNum?declineOfUnit.get(num,titles):num+" "+declineOfUnit.get(num,titles)},findParentStep:function(element){function findStep(item){return item&&item.element&&"FormStep"===item.element.className?item.element.fullPath:item&&item.element&&"FormStep"!==item.element.className&&item.parent()?findStep(item.parent()):void 0}return findStep(element.parent.apiElem)},convertMillisecondsToHumanView:function(milliseconds){var self=this,result={},units=[{label:"msc",labels:["миллисекунда","миллисекунды","миллисекунд"],mod:1e3},{label:"sec",labels:["секунду","секунды","секунд"],mod:60},{label:"min",labels:["минуту","минуты","минут"],mod:60},{label:"hrs",labels:["час","часа","часов"],mod:24},{label:"day",labels:["день","дня","дней"],mod:31}];return units.forEach(function(item){milliseconds=(milliseconds-(result[item.label]=milliseconds%item.mod))/item.mod}),units.reverse().map(function(item){var label=item.label;if("msc"!==label&&result[label])return result[label]?self.getCounter(result[label],item.labels):""}).join(" ").trim()}}}]),angular.module("serverFormWidgets.general").directive("epguOrderListDC",["TEMPLATES","api","$rootScope","OrderListDCService","$moment","FORM_ERRORS","$location","$timeout",function(TEMPLATES,api,$rootScope,OrderListDCService,$moment,FORM_ERRORS,$location,$timeout){return{templateUrl:TEMPLATES.ORDER_LIST_DC,replace:!0,scope:{item:"=?"},link:function(scope,element,attrs){function sendConfirmResult(answer){var request={oktmo:scope.confirmData.confirmOrder.routingCode||"00000000001",orderId:scope.confirmData.confirmOrder.id,EduOrganizationCode:scope.confirmData.mainDCs[0].code,EduOrganizationAnswer:answer};Object.keys(request).forEach(function(key){api.find("form.FormStep00.Panel1."+key).value(request[key])}),api.env("orderId",request.orderId),api.stepList()[0].submit("submit",0,{done:function(){api.submit("submit",0,{done:function(){api.link($rootScope.settings.lkUrl+"notifications/details/ORDER/"+request.orderId)}})}},void 0,!1)}var parentStepFullPath=function getParentStep(el){return"FormStep"===el.element.className?el.element.fullPath:getParentStep(el.parent())}(scope.item.parent.apiElem),ua=window.navigator.userAgent;scope.msieversion=ua.indexOf("MSIE ")>0||!!ua.match(/Trident.*rv\:11\./),scope.loading=!0,scope.ordersList=[],scope.ordersWithAnswer=[],scope.isQueue="queue"===scope.item.usingType,scope.orderFromUrl=$location.search().order,scope.advice={show:!1,title:"Что-то пошло не так",message:"Попробуйте повторить запрос позднее"},scope.queueInfo={showQueueInfo:!1,queueArr:[],entryDate:"",orderId:"",kidFio:"",age:"",throbber:!1,confirmMessageData:{}},scope.kidDataByOrderId={},scope.throbber={title:"Пожалуйста, подождите",text:"Идет загрузка данных по заявлению"},scope.changeOrderBtn=function(){window.location="/10099/3/form?order="+scope.queueInfo.orderId},scope.confirmDataBtns={},scope.confirmDataBtns.onclickAccess=function(){sendConfirmResult(!0)},scope.confirmDataBtns.onclickCancel=function(){var popup=OrderListDCService.getCancelConfirmPopup(function(data){sendConfirmResult(!1)},scope.confirmData.confirmOrder);api.createPopup(popup)},scope.showPopup=function(queueInfo){var obj=OrderListDCService.getPopupStructure(queueInfo);api.createPopup(obj)},scope.disableButtons=function(disabled,orderId){scope.ordersList.forEach(function(block){block.order!==orderId?(block.button.disabled=disabled,block.button.loading=!1):block.button.loading=!0})},$rootScope.isDesigner||OrderListDCService.getOrdersList({draftView:!1,pageIndex:1,pageSize:250,eserviceCode:scope.item.eserviceId,embed:"INFO_MESSAGE"}).then(function(data){if(data&&!data.isEmpty){var dataForOrderFromUrl={},dataForOrderByInfMessage={};data.orders.forEach(function(order){scope.ordersList.push(createKidData(order));var oim=order.infoMessages;scope.orderFromUrl&&scope.orderFromUrl===order.id.toString()?(dataForOrderFromUrl.order=order,dataForOrderFromUrl.block=scope.ordersList[scope.ordersList.length-1],dataForOrderFromUrl.hasData=!0):oim&&oim.length&&100===oim[oim.length-1].stateOrgMessageId&&(dataForOrderByInfMessage.order=order,dataForOrderByInfMessage.block=scope.ordersList[scope.ordersList.length-1],dataForOrderByInfMessage.hasData=!0)}),dataForOrderFromUrl.hasData?dataForOrderFromUrl.block.button.callback(dataForOrderFromUrl.order):dataForOrderByInfMessage.hasData?dataForOrderByInfMessage.block.button.callback(dataForOrderByInfMessage.order):1===scope.ordersList.length&&scope.ordersList[0].button.callback(data.orders[0]),scope.loading=!1}else api.find()._items[0].title(""),scope.isEmptyOrdersList=!0,scope.loading=!1},function(){api.showAdvice(FORM_ERRORS.default)});var watchers,createKidData=function(order){var kidData={},confirm=!1,oim=order.infoMessages;if(oim&&oim.length&&100===oim[oim.length-1].stateOrgMessageId){$moment(oim[oim.length-1].date)>$moment(order.currentStatusHistory.date)&&(confirm=oim[oim.length-1])}var confirmOrderId=confirm?order.id:void 0;kidData.orderInfo="Заявление №"+order.id+" от "+$moment(order.orderDate).format("DD.MM.YYYY"),kidData.status="Статус: "+(confirm?confirm.title:order.orderStatusName),kidData.order=order,kidData.button={show:!0,title:scope.isQueue?"Проверить очередь":confirm?"Принять решение":"Изменить заявление",callback:function(order){var self=this;if(!self.disabled)if(scope.queueInfo.showQueueInfo=!1,scope.queueInfo.queueArr=[],scope.queueInfo.entryDate="",scope.queueInfo.orderId="",scope.queueInfo.kidFio="",scope.queueInfo.age="",scope.queueInfo.throbber=!0,api.find()._items.forEach(function(step){step.visible(step.fullPath()===parentStepFullPath)}),scope.disableButtons(!0,order),api.scrollTo("form.fakeFullPathForQueueDCThrobber"),scope.isQueue){var isForceUpdate=-1!==scope.ordersWithAnswer.indexOf(order.id);OrderListDCService.getQueue(order,isForceUpdate).then(function(response){var queueData=response.data;if(scope.queueInfo.actualDateTime=$moment(response.result_ts).format("DD.MM.YYYY, HH:mm"),queueData.EduOrganizationQueue&&queueData.EduOrganizationQueue.length){self.title="Обновить очередь",-1===scope.ordersWithAnswer.indexOf(order.id)&&scope.ordersWithAnswer.push(order.id),confirmOrderId===queueData.orderId?(scope.queueInfo.confirmMessageData.title=confirm.title,scope.queueInfo.confirmMessageData.comment=confirm.comment,scope.queueInfo.confirmMessageData.date=$moment(confirm.date).format("DD.MM.YYYY"),scope.queueInfo.confirmMessageData.showLkLink=order.currentStatusHistory&&order.currentStatusHistory.sendMessageAllowed):scope.queueInfo.confirmMessageData={},scope.queueInfo.entryDate=$moment(queueData.EntryDate).format("DD.MM.YYYY"),scope.queueInfo.orderId=queueData.orderId;var kidInfo=scope.kidDataByOrderId[order.id];scope.queueInfo.kidFio=kidInfo&&kidInfo.childFio,scope.queueInfo.age=kidInfo&&kidInfo.birthDate&&OrderListDCService.getAgeByDate(kidInfo.birthDate),scope.queueInfo.groupSpecific=OrderListDCService.getGroupSpecific(queueData.AdaptationGroup),OrderListDCService.getGroupType(queueData.AdaptationGroupType,order.infSysCode).then(function(data){scope.queueInfo.groupType=data}),scope.queueInfo.scheduleType=OrderListDCService.getScheduleType(queueData.ScheduleType);var dcCodes=queueData.EduOrganizationQueue.map(function(q){return q.Code});OrderListDCService.getDCsInfo("KINDERGARTEN_EDUORG",dcCodes,order).then(function(data){queueData.EduOrganizationQueue.forEach(function(item){data.some(function(dataItem){if(dataItem.value===item.Code.toString()){var atrVals=dataItem.attributeValues;return item.address=atrVals.ADDRESS,item.email=atrVals.EMAIL,item.fiasCode=atrVals.FIAS,item.phone=atrVals.PHONE,item.schedule=atrVals.SCHEDULE,item.fullName=dataItem.title,scope.queueInfo.queueArr.push(item),!0}})}),scope.queueInfo.showQueueInfo=!0,api.scrollTo("form.fakeFullPathForQueueDC")})}scope.queueInfo.throbber=!1,scope.disableButtons(!1)},function(error){scope.disableButtons(!1);var currentOrder=scope.ordersList.find(function(order){return order.order.id===error.pid});currentOrder.notAnswer=!0,currentOrder.notAnswerMessage='Запрос отправлен. Вы сможете просмотреть результат позднее в <a href="'+$rootScope.settings.lkUrl+"notifications/details/ORDER/"+error.pid+'">личном кабинете</a>.',error&&error.expiredTime&&(currentOrder.notAnswerMessage+="<br/>Повторный запрос возможен не ранее, чем "+$moment(error.expiredTime).format("DD.MM.YYYY HH:MM")),scope.queueInfo.throbber=!1,api.scrollTo("form")})}else OrderListDCService.getApplication(!!confirm,order).then(function(data){if(confirm&&confirmOrderId&&confirmOrderId===order.id){var mainDCsLength=data.EduOrganizationCode&&data.EduOrganizationCode.length,alterDCsLength=data.EduOrganizationOtherCode&&data.EduOrganizationOtherCode.length;scope.confirmData={mainTitle:1===mainDCsLength?"Детский сад, по которому предложено направление":"Детские сады, по которым предложено направление",alterTitle:1===alterDCsLength?"Альтернативный детский сад":0!==alterDCsLength?"Альтернативные детские сады":"",mainDCs:[],alterDCs:[],title:confirm.title,comment:confirm.comment,date:$moment(confirm.date).format("DD.MM.YYYY"),showLkLink:order.currentStatusHistory&&order.currentStatusHistory.sendMessageAllowed,confirmOrder:order};var dcCodes=data.EduOrganizationCode;alterDCsLength&&(dcCodes=dcCodes.concat(data.EduOrganizationOtherCode)),scope.isConfirmScreenError=!1,OrderListDCService.getDCsInfo("KINDERGARTEN_EDUORG",dcCodes,order).then(function(DCs){DCs.forEach(function(dataItem){var item={},atrVals=dataItem.attributeValues;item.address=atrVals.ADDRESS,item.fullName=dataItem.title,item.code=dataItem.value,-1!==data.EduOrganizationCode.indexOf(dataItem.value)?scope.confirmData.mainDCs.push(item):scope.confirmData.alterDCs.push(item)}),scope.confirmData.mainDCs.length||(scope.isConfirmScreenError=!0,scope.advice.message="Код детского сада отсутствует в справочнике. Обратитесь в техническую поддержку.")}),scope.queueInfo.throbber=!1,scope.isConfirmScreen=!0,$timeout(function(){api.scrollTo("form.fakeFullPathForChooseDC")},0,!1)}else scope.isConfirmScreen=!1,scope.isConfirmScreenError=!1,scope.queueInfo.throbber=!1,api.triggerHandler(scope.item.fullPath,scope.item.fullPath,scope.item.handlers[0],data);scope.disableButtons(!1)})}};try{var dataFromForm=JSON.parse(order.description);kidData.Fio=dataFromForm&&dataFromForm.childFio,kidData.birthDate=dataFromForm&&dataFromForm.birthDate,scope.kidDataByOrderId[order.id]=dataFromForm}catch(e){}return kidData};scope.$on("suspend",function(){watchers=scope.$$watchers,scope.$$watchers=[]}),scope.$on("resume",function(){scope.$$watchers=watchers,watchers=null})}}}]).factory("OrderListDCExt",["containerAttrs",function(containerAttrs){return{attrs:angular.extend({},containerAttrs.attrs,{html:{"scope:editor":!1},usingType:{type:"string",enum:["queue","change_cancel"],enumOptions:{queue:"Проверка очереди",change_cancel:"Изменение/Отмена"},default:"queue"},eserviceId:{type:"string",default:"10000060292"},dictionaryMnemonic:{type:"string",default:""},fullPathToHandlerDC:{type:"string",default:""}})}}]).factory("OrderListDCService",["$rootScope","sharedExtServices","$q","declineOfUnit","$moment","PGU","api",function($rootScope,sharedExtServices,$q,declineOfUnit,$moment,PGU,api){return{getOrdersList:function(params){var df=$q.defer();return sharedExtServices.getOrders(params).then(function(data){var result={orders:[],isEmpty:!0};if(data&&data.order&&data.order.length){var filteredArr=data.order.filter(function(item){var byStatus=-1!==[1,6,7,9,11,12].indexOf(item.orderStatusId),byInfMessage=-1!==[2,17,21,22,24].indexOf(item.orderStatusId)&&item.infoMessages&&item.infoMessages.length;return byStatus||byInfMessage});result.orders=filteredArr,result.isEmpty=!filteredArr.length,df.resolve(result)}else df.resolve(result)},function(error){df.reject(error)}),df.promise},getQueue:function(order,isForceUpdate){var df=$q.defer(),params=this.getMarkerAndApplicationRequestStructure(order.id,order.routingCode,isForceUpdate);return sharedExtServices.markerDictionary("dc_getApplicationQueue_23550",params).then(function(data){if(data&&"D"===data.state){var result_ts=data.result_ts;sharedExtServices.DCService.getKindergartenQueue(order.id).then(function(data){data&&data.FormDataResponse&&data.FormDataResponse.GetApplicationQueueResponse?df.resolve({data:data.FormDataResponse.GetApplicationQueueResponse,result_ts:result_ts}):df.reject({pid:order.id})},function(error){df.reject({pid:order.id})})}else data&&"P"===data.state&&df.reject({expiredTime:data.exp,pid:data.pid})},function(error){df.reject({pid:order.id})}),df.promise},getApplication:function(isConfirm,order){var self=this,df=$q.defer(),params=this.getMarkerAndApplicationRequestStructure(order.id,order.routingCode);return sharedExtServices.DCService.getDCDictionariesInfo("dc_getApplication_23550",params).then(function(data){if(!data||(!data.error||0!==data.error.code&&data.error.code)&&data.error)df.reject();else if(data.items){var result=self.mapGetApplicationResponse(data.items,isConfirm);df.resolve(result)}else df.reject()}),df.promise},getDCsInfo:function(dictionary,codes,order){var df=$q.defer(),params=this.getDCCodesRequestStructure(codes,order.infSysCode);return sharedExtServices.DCService.getDCDictionariesInfo(dictionary,params).then(function(data){!data||(!data.error||0!==data.error.code&&data.error.code)&&data.error?df.reject():data.items?df.resolve(data.items):df.reject()}),df.promise},getAgeByDate:function(date){var diffMonth=$moment().diff($moment(date,"DD.MM.YYYY"),"months",!1),years=Math.floor(diffMonth/12),monthes=diffMonth%12,age="";return years&&(age=years+" "+declineOfUnit.get(years,["год","года","лет"])+" "),monthes&&(age+=monthes+" "+declineOfUnit.get(monthes,["месяц","месяца","месяцев"])),age||"0 месяцев"},getMarkerAndApplicationRequestStructure:function(orderId,oktmo,isForceUpdate){var obj={treeFiltering:"ONELEVEL",pageNum:1,pageSize:10,filter:{union:{unionKind:"AND",subs:[{simple:{attributeName:"orderId",condition:"EQUALS",value:{asString:orderId}}},{simple:{attributeName:"oktmo",condition:"EQUALS",value:{asString:oktmo}}}]}},parentRefItemValue:"",selectAttributes:["*"],tx:"EPGU",pid:orderId};return isForceUpdate&&(obj.forceUpdate=!0),obj},getDCCodesRequestStructure:function(codes,regcode){return{treeFiltering:"ONELEVEL",pageNum:1,pageSize:1e3,filter:{simple:{attributeName:"REGOKATO",condition:"EQUALS",value:{asString:regcode}}},parentRefItemValue:"",selectAttributes:["*"],filterCodes:codes,tx:"EPGU"}},getPopupStructure:function(queueInfo){var queue="Всего человек в очереди - "+queueInfo.AllInQueue+", ваша очередь - "+queueInfo.NumberInQueue,obj={title:queueInfo.fullName,items:[{className:"Panel",label:"",grid:"1/3",items:[{className:"label",value:'<span class="plain-text-bold">Очередь</span>'}]},{className:"Panel",label:"",grid:"2/3",items:[{className:"label",value:'<span class="plain-text">'+queue+"</span>"}]},{className:"Panel",label:"",grid:"1/3",items:[{className:"label",value:'<span class="plain-text-bold">Адрес</span>'}]},{className:"Panel",label:"",grid:"2/3",items:[{className:"label",value:'<span class="plain-text">'+queueInfo.address+"</span>"}]}]};return queueInfo.schedule&&obj.items.push({className:"Panel",label:"",grid:"1/3",items:[{className:"label",value:'<span class="plain-text-bold">Режим работы</span>'}]},{className:"Panel",label:"",grid:"2/3",items:[{className:"label",value:'<span class="plain-text">'+queueInfo.schedule+"</span>"}]}),queueInfo.phone&&obj.items.push({className:"Panel",label:"",grid:"1/3",items:[{className:"label",value:'<span class="plain-text-bold">Телефон</span>'}]},{className:"Panel",label:"",grid:"2/3",items:[{className:"label",value:'<span class="plain-text">'+queueInfo.phone+"</span>"}]}),queueInfo.email&&obj.items.push({className:"Panel",label:"",grid:"1/3",items:[{className:"label",value:'<span class="plain-text-bold">Электронная почта</span>'}]},{className:"Panel",label:"",grid:"2/3",items:[{className:"label",value:'<span class="plain-text">'+queueInfo.email+"</span>"}]}),obj.items.push({className:"map",label:"map",value:queueInfo.address,error:"123",id:Math.random().toString(36).substr(2,9)}),obj},mapGetApplicationResponse:function(items,isConfirm){function copyAttributeValues(attributeValues){var result={};return Object.keys(attributeValues).forEach(function(value){result[value]=attributeValues[value]}),result}var obj={},data=items[0];return isConfirm?Object.keys(data.attributeValues).forEach(function(value){var val="string"==typeof data.attributeValues[value]?[data.attributeValues[value]]:data.attributeValues[value];obj[value]=val}):(obj=copyAttributeValues(data.attributeValues),obj.orderId=data.value,obj.ServicesType=data.title,data.children.forEach(function(item){if("PersonInfo"===item.value)obj.PersonInfo=copyAttributeValues(item.attributeValues),item.children.forEach(function(i){obj.PersonInfo[i.value]=copyAttributeValues(i.attributeValues)});else if("ChildInfo"===item.value)obj.ChildInfo=copyAttributeValues(item.attributeValues),item.children.forEach(function(i){obj.ChildInfo[i.value]=copyAttributeValues(i.attributeValues)});else if("EduOrganization"===item.value){obj.EduOrganizations=copyAttributeValues(item.attributeValues),obj.EduOrganizations.organizations=[];try{var orgData=JSON.parse(item.title);Object.keys(orgData).forEach(function(code){obj.EduOrganizations.organizations.push({code:code,priority:orgData[code]})})}catch(e){}
}else"AdaptationProgram"===item.value?obj.AdaptationProgram=copyAttributeValues(item.attributeValues):"BenefitsInfo"===item.value?(obj.BenefitsInfo=[],item.children.forEach(function(child){obj.BenefitsInfo.push(copyAttributeValues(child.attributeValues))})):"ReadOnlyField"===item.value&&(obj.ReadOnlyFields=item.attributeValues&&item.attributeValues.Field)})),obj},getCancelConfirmPopup:function(accessCancel,order){var args={orderId:order.id};return PGU.Events.subscribe("","DCAccessCancel",function(){accessCancel(args)}),PGU.Events.subscribe("","DCCancelCancel",function(){api.closeApiPopup(),api.scrollTo("form.fakeFullPathForChooseDC")}),PGU.Events.subscribe("form","hidePopup",function(){PGU.Events.unsubscribe("DCAccessCancel"),PGU.Events.unsubscribe("DCCancelCancel")}),{items:[{className:"Custom-Html",html:'<div class="grid-wrap PGU-OrderListDC PGU-OrderListDC-Popup">\n    <div class="grid-wrap__row">\n        <div class="grid-wrap__col-lg-16 grid-wrap__col-md-12 grid-wrap__col-sm-6 lg-offset-bottom-32 md-offset-bottom-32 sm-offset-bottom-32">\n            <h3 class="PGU-Service-h3 PGU-Advice-Type_Warn">\n                <span class="PGU-Icon PGU-Icon-Advice_Icon"></span>\n                <span>При отказе от предоставленного места в дошкольной организации вы исключаетесь из очереди в ней</span>\n            </h3>\n        </div>\n        <div class="grid-wrap__col-lg-16 grid-wrap__col-md-12 grid-wrap__col-sm-6 lg-offset-bottom-32 md-offset-bottom-32 sm-offset-bottom-32">\n            <span class="plain-text">Измененное заявление будет отправлено в ведомство. Очередь в альтернативных дошкольных организациях сохраняется.</span>\n        </div>\n        <div class="grid-wrap__col-lg-16 grid-wrap__col-md-12 grid-wrap__col-sm-6 lg-offset-bottom-8 md-offset-bottom-8 sm-offset-bottom-8">\n            <div class="separator"></div>\n        </div>\n        <div class="grid-wrap__col-lg-3 grid-wrap__col-md-6 grid-wrap__col-sm-6">\n            <div data-ng-click="$root.apiPopupFunctionTrigger(\'DCCancelCancel\')" class="PGU-Button PGU-Btn-Base">Вернуться</div>\n        </div>\n        <div class="grid-wrap__col-lg-3 grid-wrap__col-md-6 grid-wrap__col-sm-6 grid-wrap__col-offset-lg-8 flex-container justify-end">\n            <div data-ng-click="$root.apiPopupFunctionTrigger(\'DCAccessCancel\')" class="PGU-Button PGU-Btn-Base PGU-Btn-Blue">Продолжить</div>\n        </div>\n    </div>\n</div>'}]}},getGroupSpecific:function(type){return void 0===type?"":{1:"Общеразвивающая",2:"Компенсирующая",3:"Оздоровительная",4:"Группы по присмотру и уходу",5:"Семейные дошкольные группы"}[type.toString()]||""},getScheduleType:function(type){return void 0===type?"":{1:"Кратковременное пребывание (до 5 часов в день)",2:"Полный день (8-14 часов пребывания)",3:"Круглосуточное пребывание (24 часа)"}[type.toString()]||""},getGroupType:function(adaptationGroupTypeCode,regcode){var df=$q.defer();if(void 0===adaptationGroupTypeCode)df.resolve("");else{var params=this.getGroupTypeRequestStructure(adaptationGroupTypeCode,regcode);sharedExtServices.DCService.getDCDictionariesInfo("KINDERGARTEN_GROUPTYPE",params).then(function(data){!data||(!data.error||0!==data.error.code&&data.error.code)&&data.error?df.reject():data.items?df.resolve(data.items[0]&&data.items[0].title||""):df.reject()})}return df.promise},getGroupTypeRequestStructure:function(code,regcode){return{treeFiltering:"ONELEVEL",pageNum:1,pageSize:10,filter:{union:{unionKind:"AND",subs:[{simple:{attributeName:"CODE",condition:"EQUALS",value:{asString:code}}},{simple:{attributeName:"REGOKATO",condition:"EQUALS",value:{asString:regcode}}}]}},parentRefItemValue:"",selectAttributes:["*"],tx:"EPGU"}}}}]),function(){var link=function(TEMPLATES,$rootScope,api,pguBundlesSrv,PGU){return{templateUrl:TEMPLATES.BUNDLES,replace:!0,scope:{item:"=?"},link:function(scope,element,attrs){pguBundlesSrv.getWidget(scope.item).then(function(){if(pguBundlesSrv.showWidget(scope.item,["PERSON_RF","PERSON_CONFIRMED","PERSON_LIGHT","PERSON_FOREIGN","BUSINESSMAN"])){var find=pguBundlesSrv.getFindMethods(scope.item.fullPath),userType=pguBundlesSrv.userType,isManual="PersonalDataManual"===scope.item.className,isRecipient="person"===pguBundlesSrv.isDelegateDataItem(scope.item),map={fio:find.element("PersonalData.fio"),lastname:find.element("PersonalData.lastname"),firstname:find.element("PersonalData.firstname"),middlename:find.element("PersonalData.middlename"),birthdate:find.element("PersonalData.birthdate"),gender:find.element("PersonalData.gender"),genderField:find.element("PersonalData.gender.gender"),birthplace:find.element("PersonalData.birthplace"),main:find.element("PersonalData")},showHelperBox=void 0===scope.item.showHelperBox||scope.item.showHelperBox,showItems=function(){map.birthdate.visible=scope.item.showBirthdate,map.gender.visible=scope.item.showGender,map.birthplace.visible=scope.item.showBirthplace;var parentPanel=map.main.parent.fullPath,hb=find.element(parentPanel+".PanelRight.HelperBox");hb.className&&"HelperBox"===hb.className&&(hb.visible=showHelperBox)};showItems();var hasMiddleName=api.env("user").middleName;"PERSON_LIGHT"!==userType||isManual||hasMiddleName?isManual&&(map.fio.visible=!1,map.lastname.visible=!0,map.firstname.visible=!0,map.middlename.visible=!0):map.middlename.visible=!0,isManual||(pguBundlesSrv.setFlagsToItems(scope.item.items),"PERSON_LIGHT"!==userType&&(map.genderField.label="Пол"),map.main.hasEsiaHint=scope.item.hasEsiaHint),(isRecipient||isManual)&&PGU.Events.subscribe("","changeDelegateRadio",function(evt,data){Object.keys(data.map[scope.item.className]).forEach(function(key){scope.item[key]=data.map[scope.item.className][key]}),showItems()})}})}}};angular.module("serverFormWidgets.general").directive("epguPersonalData",["TEMPLATES","$rootScope","api","pguBundlesSrv","PGU",link]).directive("epguPersonalDataManual",["TEMPLATES","$rootScope","api","pguBundlesSrv","PGU",link]).factory("PersonalDataExt",["controlAttrs",function(controlAttrs){return{attrs:angular.extend({},controlAttrs.attrs,{handlers:{default:[],"scope:sync":!1,"scope:editor":!1,"scope:model":!1},originalFrom:{"scope:editor":!1,default:"container"},showBirthdate:{type:"boolean",enum:[!0,!1],enumOptions:{true:"Да",false:"Нет"},default:!0},showGender:{type:"boolean",enum:[!0,!1],enumOptions:{true:"Да",false:"Нет"},default:!0},showBirthplace:{type:"boolean",enum:[!0,!1],enumOptions:{true:"Да",false:"Нет"},default:!0},version:{"scope:editor":!1,default:0}})}}]).factory("PersonalDataAutoExt",["controlAttrs","PersonalDataExt",function(controlAttrs,PersonalDataExt){return{attrs:angular.extend({},controlAttrs.attrs,PersonalDataExt.attrs,{hasEsiaHint:{type:"boolean",default:!0,"scope:editor":!0,"scope:noChanges":!0},showHelperBox:{type:"boolean",default:!0,"scope:editor":!0,"scope:noChanges":!0}})}}])}(),function(){var link=function(TEMPLATES,$rootScope,api,pguBundlesSrv,PGU){return{templateUrl:TEMPLATES.BUNDLES,replace:!0,scope:{item:"=?"},link:function(scope,element,attrs){pguBundlesSrv.getWidget(scope.item).then(function(){if(pguBundlesSrv.showWidget(scope.item,["PERSON_RF","PERSON_CONFIRMED","PERSON_LIGHT","PERSON_FOREIGN"])){var find=pguBundlesSrv.getFindMethods(scope.item.fullPath),isManual="ContactsManual"===scope.item.className,isRecipient="person"===pguBundlesSrv.isDelegateDataItem(scope.item),map={phone:find.element("ContactsData.phone"),email:find.element("ContactsData.email"),main:find.element("ContactsData")},showItems=function(){map.phone.visible=scope.item.showPhone,map.email.visible=scope.item.showEmail};showItems(),isManual||(pguBundlesSrv.setFlagsToItems(scope.item.items),map.main.hasEsiaHint=scope.item.hasEsiaHint),pguBundlesSrv.onChangeDelegateRadio(isRecipient||isManual,scope.item,showItems)}})}}};angular.module("serverFormWidgets.general").directive("epguContacts",["TEMPLATES","$rootScope","api","pguBundlesSrv","PGU",link]).directive("epguContactsManual",["TEMPLATES","$rootScope","api","pguBundlesSrv","PGU",link]).factory("ContactsExt",["controlAttrs",function(controlAttrs){return{attrs:angular.extend({},controlAttrs.attrs,{handlers:{default:[],"scope:sync":!1,"scope:editor":!1,"scope:model":!1},originalFrom:{"scope:editor":!1,default:"container"},showPhone:{type:"boolean",enum:[!0,!1],enumOptions:{true:"Да",false:"Нет"},default:!0},showEmail:{type:"boolean",enum:[!0,!1],enumOptions:{true:"Да",false:"Нет"},default:!0},version:{"scope:editor":!1,default:0}})}}]).factory("ContactsAutoExt",["controlAttrs","ContactsExt",function(controlAttrs,ContactsExt){return{attrs:angular.extend({},controlAttrs.attrs,ContactsExt.attrs,{hasEsiaHint:{type:"boolean",default:!0,"scope:editor":!0,"scope:noChanges":!0}})}}])}(),function(){var link=function(TEMPLATES,$rootScope,api,pguBundlesSrv,PGU){return{templateUrl:TEMPLATES.BUNDLES,replace:!0,scope:{item:"=?"},link:function(scope,element,attrs){function glueSeriesNumber(passportType){map[passportType].series_numberField.isGlueField=!0,map[passportType].series_numberField.value=map[passportType].seriesField.value+" "+map[passportType].numberField.value,map[passportType].seriesField.forceXml=!0,map[passportType].numberField.forceXml=!0}function toggleFields(type,boo){map[type].main.visible=boo;var isZagran="zagran"===type;("PERSON_LIGHT"===userType||isManual)&&(map[type].series_number.visible=isZagran,map[type].series.visible=!isZagran,map[type].number.visible=!isZagran),map[type].main.hasEsiaHint=scope.item.hasEsiaHint}function al10Watchers(czValue){var namedocWatch,handle=function(val,oldVal){val!==oldVal&&("RUS"===val?(map.namedoc.visible=!0,toggleFields("foreign",!1),map.nameDocField.value&&(toggleFields("1"===map.nameDocField.value?"rf":"zagran",!0),toggleFields("1"===map.nameDocField.value?"zagran":"rf",!1)),namedocWatch=scope.$watch(function(){return map.nameDocField.value},function(val,oldVal){val!==oldVal&&(toggleFields("1"===val?"rf":"zagran",!0),toggleFields("1"===val?"zagran":"rf",!1))})):val?(namedocWatch&&namedocWatch(),map.namedoc.visible=!1,toggleFields("rf",!1),toggleFields("zagran",!1),toggleFields("foreign",!0)):(namedocWatch&&namedocWatch(),map.namedoc.visible=!1,toggleFields("rf",!1),toggleFields("zagran",!1),toggleFields("foreign",!1)))};scope.$watch(function(){return map.citizenshipField.value},handle),czValue&&handle(czValue)}var map,userType=pguBundlesSrv.userType,isManual="PassportDataManual"===scope.item.className,isRecipient="person"===pguBundlesSrv.isDelegateDataItem(scope.item);pguBundlesSrv.getWidget(scope.item).then(function(){if(pguBundlesSrv.showWidget(scope.item,["PERSON_RF","PERSON_CONFIRMED","PERSON_LIGHT","PERSON_FOREIGN","BUSINESSMAN"])){var find=pguBundlesSrv.getFindMethods(scope.item.fullPath);if(map={documenttype:find.element("MainDocData.typeDocPerson"),citizenship:find.element("MainDocData.citizenship"),citizenshipField:find.element("MainDocData.citizenship.citizenship"),namedoc:find.element("MainDocData.nameDoc"),nameDocField:find.element("MainDocData.nameDoc.nameDoc"),rf:{main:find.element("PassportRfData"),series_number:find.element("PassportRfData.docPassportRF"),series:find.element("PassportRfData.docseriesPassportRF"),number:find.element("PassportRfData.docnumberPassportRF"),series_numberField:find.element("PassportRfData.docPassportRF.docPassportRF"),seriesField:find.element("PassportRfData.docseriesPassportRF.docseriesPassportRF"),numberField:find.element("PassportRfData.docnumberPassportRF.docnumberPassportRF"),issuedate:find.element("PassportRfData.issuedatePassportRF"),issueid:find.element("PassportRfData.issueidPassportRF"),issueorg:find.element("PassportRfData.issueorgPassportRF")},zagran:{main:find.element("ZagranPassportData"),series_number:find.element("ZagranPassportData.docPassportFRGN"),series:find.element("ZagranPassportData.docseriesPassportFRGN"),number:find.element("ZagranPassportData.docnumberPassportFRGN"),series_numberField:find.element("ZagranPassportData.docPassportFRGN.docPassportFRGN"),seriesField:find.element("ZagranPassportData.docseriesPassportFRGN.docseriesPassportFRGN"),numberField:find.element("ZagranPassportData.docnumberPassportFRGN.docnumberPassportFRGN"),issuedate:find.element("ZagranPassportData.issuedatePassportFRGN"),issueorg:find.element("ZagranPassportData.issueorgPassportFRGN"),issueid:find.element("ZagranPassportData.validatePassportFRGN")},foreign:{main:find.element("ForeignPassportData"),series_number:find.element("ForeignPassportData.docForeign"),series:find.element("ForeignPassportData.docseriesForeign"),number:find.element("ForeignPassportData.docnumberForeign"),series_numberField:find.element("ForeignPassportData.docForeign.docForeign"),seriesField:find.element("ForeignPassportData.docseriesForeign.docseriesForeign"),numberField:find.element("ForeignPassportData.docnumberForeign.docnumberForeign"),issuedate:find.element("ForeignPassportData.issuedateForeign")}},isManual||"PERSON_RF"!==userType&&"PERSON_CONFIRMED"!==userType&&"BUSINESSMAN"!==userType)isManual||"PERSON_FOREIGN"!==userType?("PERSON_LIGHT"===userType||isManual)&&(map.citizenship.visible=!0,al10Watchers(map.citizenshipField.value)):(glueSeriesNumber("foreign"),toggleFields("foreign",!0),map.citizenship.visible=!0);else{var passportType="1"===find.element("MainDocData.typeDocPerson.typeDocPerson").value?"rf":"zagran";glueSeriesNumber(passportType),toggleFields(passportType,!0),map.citizenship.visible=!1}isManual||pguBundlesSrv.setFlagsToItems(scope.item.items);var isManualCitizenshipPrepared=!1;(isRecipient||isManual)&&PGU.Events.subscribe("","changeDelegateRadio",function(evt,data){Object.keys(data.map[scope.item.className]).forEach(function(key){scope.item[key]=data.map[scope.item.className][key]}),isManual&&"EMPLOYEE"===userType&&"2"===data.radioValue&&!isManualCitizenshipPrepared&&(map.citizenshipField.value="RUS",map.citizenshipField.disabled=!0,isManualCitizenshipPrepared=!0)})}})}}};angular.module("serverFormWidgets.general").directive("epguPassportData",["TEMPLATES","$rootScope","api","pguBundlesSrv","PGU",link]).directive("epguPassportDataManual",["TEMPLATES","$rootScope","api","pguBundlesSrv","PGU",link]).factory("PassportDataExt",["controlAttrs",function(controlAttrs){return{attrs:angular.extend({},controlAttrs.attrs,{handlers:{default:[],"scope:sync":!1,"scope:editor":!1,"scope:model":!1},originalFrom:{"scope:editor":!1,default:"container"},version:{"scope:editor":!1,default:0}})}}]).factory("PassportDataAutoExt",["controlAttrs","PassportDataExt",function(controlAttrs,PassportDataExt){return{attrs:angular.extend({},controlAttrs.attrs,PassportDataExt.attrs,{hasEsiaHint:{type:"boolean",default:!0,"scope:editor":!0,"scope:noChanges":!0}})}}])}(),angular.module("serverFormWidgets.general").directive("epguLegalBusinessmanData",["TEMPLATES","$rootScope","api","pguBundlesSrv",function(TEMPLATES,$rootScope,api,pguBundlesSrv){return{templateUrl:TEMPLATES.BUNDLES,replace:!0,scope:{item:"=?"},link:function(scope,element,attrs){pguBundlesSrv.getWidget(scope.item).then(function(){if(pguBundlesSrv.showWidget(scope.item,["EMPLOYEE","BUSINESSMAN"])){var find=pguBundlesSrv.getFindMethods(scope.item.fullPath),userType=pguBundlesSrv.userType,isEmployee="EMPLOYEE"===userType,mainPanel=find.element("LegalBusinessmanData"),contactsPanel=find.element("LegalBusinessmanData.OrgContactsData"),map={EMPLOYEE:{main:find.element("LegalBusinessmanData.LegalData"),ogrn:find.element("LegalBusinessmanData.LegalData.orgOgrn"),inn:find.element("LegalBusinessmanData.LegalData.orgInn"),kpp:find.element("LegalBusinessmanData.LegalData.orgKpp")},BUSINESSMAN:{main:find.element("LegalBusinessmanData.BusinessmanData"),ogrn:find.element("LegalBusinessmanData.BusinessmanData.businessmanOgrn"),inn:find.element("LegalBusinessmanData.BusinessmanData.businessmanInn")},opf:find.element("LegalBusinessmanData.orgLegalform"),orgAddress:find.element("LegalBusinessmanData.orgAddress"),regDate:find.element("LegalBusinessmanData.orgRegistration"),startDate:find.element("LegalBusinessmanData.orgStartWork"),workType:find.element("LegalBusinessmanData.orgTypeWork"),orgPhone:find.element("LegalBusinessmanData.OrgContactsData.orgPhone"),orgFax:find.element("LegalBusinessmanData.OrgContactsData.orgFax"),orgEmail:find.element("LegalBusinessmanData.OrgContactsData.orgEmail"),orgAddressPost:find.element("LegalBusinessmanData.OrgContactsData.orgAddressPost"),chiefData:find.element("LegalBusinessmanData.ChiefData"),isChief:find.element("LegalBusinessmanData.ChiefData.isChief"),employeeData:find.element("LegalBusinessmanData.EmployeeData")};if(mainPanel.title=isEmployee?"Сведения о юридическом лице":"Сведения об индивидуальном предпринимателе",mainPanel.hasEsiaHint=scope.item.hasEsiaHint,map.hasOwnProperty(userType)){map[userType].main.visible=!0,scope.item.showInn&&(map[userType].inn.visible=!0),scope.item.showKpp&&map[userType].hasOwnProperty("kpp")&&(map[userType].kpp.visible=!0),scope.item.showOpf&&(map.opf.visible=!0),scope.item.showOrgAddress&&isEmployee&&(map.orgAddress.visible=!0),scope.item.showRegDate&&(map.regDate.visible=!0),scope.item.showStartDate&&(map.startDate.visible=!0),scope.item.showWorkType&&(map.workType.visible=!0);var visibleContactPanel=!1;scope.item.showOrgPhone&&(map.orgPhone.visible=!0,visibleContactPanel=!0),scope.item.showOrgFax&&(map.orgFax.visible=!0,visibleContactPanel=!0),scope.item.showOrgEmail&&(map.orgEmail.visible=!0,visibleContactPanel=!0),scope.item.showOrgAddressPost&&(map.orgAddressPost.visible=!0,visibleContactPanel=!0),contactsPanel.visible=visibleContactPanel,scope.item.showChiefOrEmployeeData&&(map.chiefData.visible=!0,"true"!==map.isChief.value&&(map.employeeData.visible=!0))}pguBundlesSrv.setFlagsToItems(scope.item.items)}})}}}]).factory("LegalBusinessmanDataExt",["controlAttrs",function(controlAttrs){return{attrs:angular.extend({},controlAttrs.attrs,{handlers:{default:[],"scope:sync":!1,"scope:editor":!1,"scope:model":!1},originalFrom:{"scope:editor":!1,default:"container"},showInn:{type:"boolean",enum:[!0,!1],enumOptions:{true:"Да",false:"Нет"},default:!0},showKpp:{type:"boolean",enum:[!0,!1],enumOptions:{true:"Да",false:"Нет"},default:!0},showOpf:{type:"boolean",enum:[!0,!1],enumOptions:{true:"Да",false:"Нет"},default:!0},showOrgAddress:{type:"boolean",enum:[!0,!1],enumOptions:{true:"Да",false:"Нет"},default:!0},showRegDate:{type:"boolean",enum:[!0,!1],enumOptions:{true:"Да",false:"Нет"},default:!0},showStartDate:{type:"boolean",enum:[!0,!1],enumOptions:{true:"Да",false:"Нет"},default:!0},showWorkType:{type:"boolean",enum:[!0,!1],enumOptions:{true:"Да",false:"Нет"},"scope:editor":!1,default:!1},showOrgPhone:{type:"boolean",enum:[!0,!1],enumOptions:{true:"Да",false:"Нет"},default:!0},showOrgFax:{type:"boolean",enum:[!0,!1],enumOptions:{true:"Да",false:"Нет"},default:!0},showOrgEmail:{type:"boolean",enum:[!0,!1],enumOptions:{true:"Да",false:"Нет"},default:!0},showOrgAddressPost:{type:"boolean",enum:[!0,!1],enumOptions:{true:"Да",false:"Нет"},default:!0},showChiefOrEmployeeData:{type:"boolean",enum:[!0,!1],enumOptions:{true:"Да",false:"Нет"},default:!0},version:{"scope:editor":!1,default:0},hasEsiaHint:{type:"boolean",default:!0,"scope:editor":!0,"scope:noChanges":!0}})}}]),function(){var link=function(TEMPLATES,$rootScope,api,pguBundlesSrv,PGU){return{templateUrl:TEMPLATES.BUNDLES,replace:!0,scope:{item:"=?"},link:function(scope,element,attrs){pguBundlesSrv.getWidget(scope.item).then(function(){if(pguBundlesSrv.showWidget(scope.item,["PERSON_RF","PERSON_CONFIRMED","PERSON_LIGHT","PERSON_FOREIGN"])){var find=pguBundlesSrv.getFindMethods(scope.item.fullPath),isManual="AdditionalDocumentsManual"===scope.item.className,isRecipient="person"===pguBundlesSrv.isDelegateDataItem(scope.item),map={snils:find.element("AdditionalDocsData.snils"),inn:find.element("AdditionalDocsData.inn"),main:find.element("AdditionalDocsData")},showItems=function(){map.snils.visible=scope.item.showSnils,map.inn.visible=scope.item.showInn};isManual||(pguBundlesSrv.setFlagsToItems(scope.item.items),map.main.hasEsiaHint=scope.item.hasEsiaHint),showItems(),pguBundlesSrv.onChangeDelegateRadio(isRecipient||isManual,scope.item,showItems)}})}}};angular.module("serverFormWidgets.general").directive("epguAdditionalDocuments",["TEMPLATES","$rootScope","api","pguBundlesSrv","PGU",link]).directive("epguAdditionalDocumentsManual",["TEMPLATES","$rootScope","api","pguBundlesSrv","PGU",link]).factory("AdditionalDocumentsExt",["controlAttrs",function(controlAttrs){return{attrs:angular.extend({},controlAttrs.attrs,{handlers:{default:[],"scope:sync":!1,"scope:editor":!1,"scope:model":!1},originalFrom:{"scope:editor":!1,default:"container"},showSnils:{type:"boolean",enum:[!0,!1],enumOptions:{true:"Да",false:"Нет"},default:!0},showInn:{type:"boolean",enum:[!0,!1],enumOptions:{true:"Да",false:"Нет"},default:!0},version:{"scope:editor":!1,default:0}})}}]).factory("AdditionalDocumentsAutoExt",["controlAttrs","AdditionalDocumentsExt",function(controlAttrs,AdditionalDocumentsExt){return{attrs:angular.extend({},controlAttrs.attrs,AdditionalDocumentsExt.attrs,{hasEsiaHint:{type:"boolean",default:!0,"scope:editor":!0,"scope:noChanges":!0}})}}])}(),angular.module("serverFormWidgets.general").directive("epguPersonAddressesData",["TEMPLATES","$rootScope","api","pguBundlesSrv",function(TEMPLATES,$rootScope,api,pguBundlesSrv){return{templateUrl:TEMPLATES.BUNDLES,replace:!0,scope:{item:"=?"},link:function(scope,element,attrs){pguBundlesSrv.getWidget(scope.item).then(function(){if(pguBundlesSrv.showWidget(scope.item,["PERSON_RF","PERSON_CONFIRMED","PERSON_LIGHT","PERSON_FOREIGN","BUSINESSMAN"])){var find=pguBundlesSrv.getFindMethods(scope.item.fullPath),map={reg:find.element("Addresses.addressRegFias"),checkbox:find.element("Addresses.addressLiveFiasCheck"),live:find.element("Addresses.addressLiveFias")};map.reg.visible=scope.item.showRegAddress,map.checkbox.visible=scope.item.showRegAddress&&scope.item.showLiveAddress,map.live.visible=scope.item.showLiveAddress,scope.item.showRegAddress&&scope.item.showLiveAddress&&(map.live.visible="false"===map.checkbox.value,scope.$watch(function(){return map.checkbox.value},function(val,oldVal){val!==oldVal&&(map.live.visible="false"===val)})),pguBundlesSrv.setFlagsToItems(scope.item.items)}})}}}]).factory("PersonAddressesDataExt",["controlAttrs",function(controlAttrs){return{attrs:angular.extend({},controlAttrs.attrs,{handlers:{default:[],"scope:sync":!1,"scope:editor":!1,"scope:model":!1},originalFrom:{"scope:editor":!1,default:"container"},showRegAddress:{type:"boolean",enum:[!0,!1],enumOptions:{true:"Да",false:"Нет"},default:!0},showLiveAddress:{type:"boolean",enum:[!0,!1],enumOptions:{true:"Да",false:"Нет"},default:!0},version:{"scope:editor":!1,default:0}})}}]),angular.module("serverFormWidgets.general").directive("epguMedicalPolicy",["TEMPLATES","$rootScope","api","pguBundlesSrv",function(TEMPLATES,$rootScope,api,pguBundlesSrv){return{templateUrl:TEMPLATES.BUNDLES,replace:!0,scope:{item:"=?"},link:function(scope,element,attrs){pguBundlesSrv.getWidget(scope.item).then(function(){if(pguBundlesSrv.showWidget(scope.item,["PERSON_RF","PERSON_CONFIRMED","PERSON_LIGHT","PERSON_FOREIGN"])){var find=pguBundlesSrv.getFindMethods(scope.item.fullPath),map={number:find.element("OMSData.medPolicyNumber"),expiryDate:find.element("OMSData.medPolicyexpiryDate"),main:find.element("OMSData")};find.element("OMSData.medPolicyexpiryDate.medPolicyexpiryDate").value&&(map.expiryDate.visible=!0),map.main.hasEsiaHint=scope.item.hasEsiaHint,pguBundlesSrv.setFlagsToItems(scope.item.items)}})}}}]).factory("MedicalPolicyExt",["controlAttrs",function(controlAttrs){return{attrs:angular.extend({},controlAttrs.attrs,{handlers:{default:[],"scope:sync":!1,"scope:editor":!1,"scope:model":!1},originalFrom:{"scope:editor":!1,default:"container"},version:{"scope:editor":!1,default:0},hasEsiaHint:{type:"boolean",default:!0,"scope:editor":!0,"scope:noChanges":!0}})}}]),angular.module("serverFormWidgets.general").directive("epguKidData",["TEMPLATES","$rootScope","api","pguBundlesSrv","apiInner",function(TEMPLATES,$rootScope,api,pguBundlesSrv,apiInner){return{templateUrl:TEMPLATES.BUNDLES,replace:!0,scope:{item:"=?"},link:function(scope,element,attrs){pguBundlesSrv.getWidget(scope.item).then(function(){if(pguBundlesSrv.showWidget(scope.item,["PERSON_RF","PERSON_FOREIGN"])){var find=pguBundlesSrv.getFindMethods(scope.item.fullPath),clonePanel=find.element("KidData_container.KidData_Clones");api.find(clonePanel.fullPath).clones().forEach(function(clone){var findInClone=pguBundlesSrv.getFindMethods(clone.find("KidData").fullPath()),map={birthdate:findInClone.element("birthdate"),gender:findInClone.element("gender"),sertTitle:findInClone.element("kidBirthSertData"),sertCountry:findInClone.element("sertCountry"),sertSeries:findInClone.element("sertSeries"),sertNumber:findInClone.element("sertNumber"),sertDate:findInClone.element("sertDate"),sertActNumber:findInClone.element("sertActNumber"),sertIssue:findInClone.element("sertIssue")},sertDataCount=0;scope.item.showGender||(map.gender.visible=!1),scope.item.showBirthdate||(map.birthdate.visible=!1),scope.item.showSertSeries||(map.sertSeries.visible=!1,sertDataCount++),scope.item.showSertNumber||(map.sertNumber.visible=!1,sertDataCount++),scope.item.showSertActNumber||(map.sertActNumber.visible=!1,sertDataCount++),scope.item.showSertDate||(map.sertDate.visible=!1,sertDataCount++),scope.item.showSertIssue||(map.sertIssue.visible=!1,sertDataCount++),5===sertDataCount&&(map.sertTitle.visible=!1,map.sertCountry.visible=!1)}),clonePanel._model=angular.toJson(apiInner.createDataToSave([clonePanel])[0])}})}}}]).factory("KidDataExt",["controlAttrs",function(controlAttrs){return{attrs:angular.extend({},controlAttrs.attrs,{handlers:{default:[],"scope:sync":!1,"scope:editor":!1,"scope:model":!1},originalFrom:{"scope:editor":!1,default:"container"},showGender:{type:"boolean",enum:[!0,!1],enumOptions:{true:"Да",false:"Нет"},default:!0},showBirthdate:{type:"boolean",enum:[!0,!1],enumOptions:{true:"Да",false:"Нет"},default:!0},showSertSeries:{type:"boolean",enum:[!0,!1],enumOptions:{true:"Да",false:"Нет"},default:!0},showSertNumber:{type:"boolean",enum:[!0,!1],enumOptions:{true:"Да",false:"Нет"},default:!0},showSertActNumber:{type:"boolean",enum:[!0,!1],enumOptions:{true:"Да",false:"Нет"},default:!0},showSertDate:{type:"boolean",enum:[!0,!1],enumOptions:{true:"Да",false:"Нет"},default:!0},showSertIssue:{type:"boolean",enum:[!0,!1],enumOptions:{true:"Да",false:"Нет"},default:!0},version:{"scope:editor":!1,default:0}})}}]),angular.module("serverFormWidgets.general").directive("epguVehicleData",["TEMPLATES","$rootScope","api","pguBundlesSrv","apiInner",function(TEMPLATES,$rootScope,api,pguBundlesSrv,apiInner){return{templateUrl:TEMPLATES.BUNDLES,replace:!0,scope:{item:"=?"},link:function(scope,element,attrs){pguBundlesSrv.getWidget(scope.item).then(function(){if(pguBundlesSrv.showWidget(scope.item,["PERSON_RF","PERSON_CONFIRMED","PERSON_FOREIGN","EMPLOYEE","BUSINESSMAN"])){var find=pguBundlesSrv.getFindMethods(scope.item.fullPath),clonePanel=find.element("VehicleData_container.VehicleData_Clones");find.apiElement("VehicleData_container.VehicleData_Clones").clones().forEach(function(clone){var findInClone=pguBundlesSrv.getFindMethods(clone.find("VehicleData").fullPath()),map={numberPlate:findInClone.element("number"),serNumber:findInClone.element("serNumber"),name:findInClone.element("vehicleName")};scope.item.showSerNumber||(map.serNumber.visible=!1),scope.item.showVehicleName||(map.name.visible=!1)}),clonePanel._model=angular.toJson(apiInner.createDataToSave([clonePanel])[0])}})}}}]).factory("VehicleDataExt",["controlAttrs",function(controlAttrs){return{attrs:angular.extend({},controlAttrs.attrs,{handlers:{default:[],"scope:sync":!1,"scope:editor":!1,"scope:model":!1},originalFrom:{"scope:editor":!1,default:"container"},showSerNumber:{type:"boolean",enum:[!0,!1],enumOptions:{true:"Да",false:"Нет"},default:!0},showVehicleName:{type:"boolean",enum:[!0,!1],enumOptions:{true:"Да",false:"Нет"},default:!0},version:{"scope:editor":!1,default:0}})}}]),angular.module("serverFormWidgets.general").directive("epguDelegateData",["TEMPLATES","$rootScope","api","pguBundlesSrv","PGU",function(TEMPLATES,$rootScope,api,pguBundlesSrv,PGU){return{templateUrl:TEMPLATES.BUNDLES,replace:!0,scope:{item:"=?"},link:function(scope,element,attrs){if(pguBundlesSrv.showWidget(scope.item,["PERSON_RF","PERSON_CONFIRMED","PERSON_FOREIGN","EMPLOYEE","BUSINESSMAN"])){var find=pguBundlesSrv.getFindMethods(scope.item.fullPath),userType=pguBundlesSrv.userType,typeDelegate=find.element("DelegateInfo.typeDelgate"),typeRecipient=find.element("DelegateInfo.typeRecipient");typeDelegate.visible="2"===typeRecipient.value,"EMPLOYEE"===userType||"BUSINESSMAN"===userType?(typeDelegate.value="2",typeDelegate.textValue="2",typeDelegate.forceXml=!0,typeDelegate.visible=!1):scope.item.showTypeDelegate||"PERSON_RF"!==userType&&"PERSON_CONFIRMED"!==userType||(typeDelegate.value="2",typeDelegate.textValue="2",typeDelegate.visible=!1,typeDelegate.forceXml=!0);var data={person:find.element("RecipientPersonalData"),delegate:find.element("delegatePersonalData")},mapping={},properties={PersonalData:["visible","showBirthdate","showGender"],PersonalDataManual:["visible","showBirthdate","showGender"],Contacts:["visible","showPhone","showEmail"],ContactsManual:["visible","showPhone","showEmail"],AdditionalDocuments:["visible","showSnils","showInn"],AdditionalDocumentsManual:["visible","showSnils","showInn"],PassportData:["visible"],PassportDataManual:["visible"]};Object.keys(data).forEach(function(key){data[key].items.forEach(function(el){el.visibilityByParent="delegate"===key,mapping[el.className]=mapping[el.className]||{},properties[el.className]&&properties[el.className].forEach(function(prop){mapping[el.className][prop]=el[prop]})})}),$rootScope.isDesigner?scope.item.items.forEach(function(it){"DelegatePersonPanel"!==it.className&&"DelegateDelegatePanel"!==it.className&&(it.doNotShow=!0)}):scope.$watch(function(){return typeRecipient.value},function(val,oldVal){val!==oldVal&&((scope.item.showTypeDelegate&&("PERSON_RF"===userType||"PERSON_CONFIRMED"===userType)||"PERSON_FOREIGN"===userType)&&(typeDelegate.visible="2"===val),PGU.Events.publish(":changeDelegateRadio",{radioValue:val,map:mapping}))})}}}}]).directive("epguDelegatePersonPanel",["TEMPLATES",function(TEMPLATES){return{templateUrl:TEMPLATES.BUNDLES,replace:!0,scope:{item:"=?"}}}]).directive("epguDelegateDelegatePanel",["TEMPLATES",function(TEMPLATES){return{templateUrl:TEMPLATES.BUNDLES,replace:!0,scope:{item:"=?"}}}]).factory("DelegateDataExt",["controlAttrs",function(controlAttrs){return{attrs:angular.extend({},controlAttrs.attrs,{handlers:{default:[],"scope:sync":!1,"scope:editor":!1,"scope:model":!1},originalFrom:{"scope:editor":!1,default:"container"},hasRules:{type:"boolean","scope:editor":!1,default:!0},rules:{"scope:editor":!1,default:['(DelgateLegalDocData@visible;)=((DelegateInfo.typeDelgate@value=="1")&&(DelegateInfo.typeRecipient@value=="2"))','(files@visible;)=((DelegateInfo.typeDelgate@value=="2")&&(DelegateInfo.typeRecipient@value=="2"))','(delegatePersonalData@visible)=(DelegateInfo.typeRecipient@value=="2")','(typeDelgateLegal@visible)=((DelegateInfo.typeDelgate@value=="1")&&(DelegateInfo.typeRecipient@value=="2"))','(RecipientPersonalData@title)=(DelegateInfo.typeRecipient@value=="2"?"Ваши данные (представитель)":"Ваши данные (заявитель)")','(files.DelgateLegalDocFileType1@!visible;files.DelgateLegalDocFileType2@visible;files.DelgateLegalDocFileSig@visible;)=((DelegateInfo.userType@value=="EMPLOYEE")||(DelegateInfo.userType@value=="BUSINESSMAN"))']},title:{"scope:editor":!1,type:"string",default:""},showTypeDelegate:{type:"boolean",default:!0}})}}]).factory("DelegateDataSubItemExt",["controlAttrs",function(controlAttrs){return{attrs:angular.extend({},controlAttrs.attrs,{handlers:{default:[],"scope:sync":!1,"scope:editor":!1,"scope:model":!1},originalFrom:{"scope:editor":!1,default:"container"},hasRules:{
type:"boolean","scope:editor":!1,default:!0},rules:{"scope:editor":!1,default:[]},title:{"scope:editor":!1,type:"string",default:""}})}}]),angular.module("serverFormWidgets.general").directive("epguFieldMapWithListFrgu",["TEMPLATES","$rootScope","api","pguBundlesSrv","PGU",function(TEMPLATES,$rootScope,api,pguBundlesSrv,PGU){return{templateUrl:TEMPLATES.BUNDLES,replace:!0,scope:{item:"=?"},link:function(scope,element,attrs){pguBundlesSrv.getWidget(scope.item).then(function(){if(pguBundlesSrv.showWidget(scope.item,["PERSON_RF","PERSON_CONFIRMED","PERSON_LIGHT","PERSON_FOREIGN","EMPLOYEE","BUSINESSMAN"])){var find=pguBundlesSrv.getFindMethods(scope.item.fullPath),map={region:find.element("FieldMapWithListFrgu.region"),regionApi:find.apiElement("FieldMapWithListFrgu.region"),fieldMap:find.element("FieldMapWithListFrgu.Office"),fieldMapApi:find.apiElement("FieldMapWithListFrgu.Office"),orgCode:find.element("FieldMapWithListFrgu.orgCode"),targetId:find.element("FieldMapWithListFrgu.serviceTargetExtId")},bindingMap={regionOkato:map.region.fullPath,organizationCode:map.orgCode.fullPath,serviceTargetExtId:map.targetId.fullPath};map.orgCode.value=scope.item.orgCode,map.fieldMap.dictionary.requestBinding.forEach(function(binding){binding.value=bindingMap[binding.name]}),scope.item.regionCode&&(map.regionApi.value(scope.item.regionCode),map.regionApi.disabled(!0));var oldRegionValue=map.region.value;PGU.fireEvents.formRendered?oldRegionValue&&(map.fieldMap.visible=!0,map.fieldMapApi.fetch()):PGU.Events.subscribe("","formRendered",function(){oldRegionValue&&(map.fieldMap.visible=!0,map.fieldMapApi.fetch())}),PGU.Events.subscribe(map.region.fullPath,"selectItem",function(evt,data){var model=data.scope.model;map.fieldMap.visible=!!model.value,oldRegionValue!==model.value&&(oldRegionValue=model.value,map.fieldMapApi.fetch())})}})}}}]).factory("FieldMapWithListFrguExt",["controlAttrs",function(controlAttrs){return{attrs:angular.extend({},controlAttrs.attrs,{handlers:{default:[],"scope:sync":!1,"scope:editor":!1,"scope:model":!1},originalFrom:{"scope:editor":!1,default:"container"},orgCode:{type:"string",default:""},regionCode:{type:"string",default:""},version:{"scope:editor":!1,default:0}})}}]),angular.module("serverFormWidgets.general").directive("epguMfcDelivery",["TEMPLATES","$rootScope","api","pguBundlesSrv","$q","MfcDeliverySrv","PGU",function(TEMPLATES,$rootScope,api,pguBundlesSrv,$q,MfcDeliverySrv,PGU){return{templateUrl:TEMPLATES.BUNDLES,replace:!0,scope:{item:"=?"},link:function(scope,element,attrs){pguBundlesSrv.getWidget(scope.item).then(function(){function _getItem(path){return thisEl.find(path).getElement()}function _getApiElem(item){return thisEl.find(item.fullPath)}function hasAttrValue(attrs,name){return attrs.hasOwnProperty(name)&&"true"===attrs[name]}function setAvailabilityByRegion(newRegion){scope.correctRegion=availableRegionsList.includes(newRegion),map.incorrectRegionHelper.visible=!scope.correctRegion,map.fieldMap.visible=scope.correctRegion,map.needDelivery.visible=scope.correctRegion&&scope.selectedMfc&&hasAttrValue(scope.selectedMfc.attrs,"deliveryAllowed"),map.costInfoPanel.visible=scope.correctRegion&&scope.selectedMfc&&"yes"===map.needDelivery.value,map.deliveryPanel.visible=scope.correctRegion&&scope.selectedMfc&&"yes"===map.needDelivery.value,scope.correctRegion&&(map.okato.value=newRegion,PGU.fireEvents.formRendered?_getApiElem(map.fieldMap).fetch():PGU.Events.subscribe("","formRendered",function(){_getApiElem(map.fieldMap).fetch()}))}function checkRadio(){if(scope.correctRegion&&map.needDelivery.visible&&scope.selectedMfc){var mfcAttrs=scope.selectedMfc.attrs,hasDelivery=hasAttrValue(mfcAttrs,"deliveryAllowed");map.deliveryPanel.visible=hasDelivery&&"yes"===map.needDelivery.value,hasDelivery&&(mfcAttrs.generalCost||mfcAttrs.privilegeCost)?(MfcDeliverySrv.setCostInfo(map.costInfo,mfcAttrs.generalCost,mfcAttrs.privilegeCost),MfcDeliverySrv.setCheckboxLabelLink(map.agreement,mfcAttrs.link),map.costInfoPanel.visible=!0):map.costInfoPanel.visible=!1}else map.deliveryPanel.visible=!1}if(pguBundlesSrv.showWidget(scope.item,["PERSON_RF","PERSON_FOREIGN"])){if($rootScope.isDesigner)return;var thisEl=api.find(scope.item.fullPath),map={selectMfc:_getItem("getResultInMfc.mfcRegion"),availableRegions:_getItem("getResultInMfc.correctRegions"),incorrectRegionHelper:_getItem("getResultInMfc.noMfcInRegionMsg"),fieldMap:_getItem("getResultInMfc.mfcMap"),okato:_getItem("getResultInMfc.okato_in"),targetId:_getItem("getResultInMfc.targetId_in"),routeCode:_getItem("getResultInMfc.routeCode"),foreignId:_getItem("getResultInMfc.foreignId"),needDelivery:_getItem("getResultInMfc.needDelivery"),deliveryPanel:_getItem("getResultInMfc.hasMfcInRegion"),costInfoPanel:_getItem("getResultInMfc.hasMfcInRegion.costInfo"),costInfo:_getItem("getResultInMfc.hasMfcInRegion.costInfo.costInfo"),deliveryAddress:_getItem("getResultInMfc.hasMfcInRegion.DeliveryAddress.DeliveryAddress"),incorrectDeliveryAddressHelper:_getItem("getResultInMfc.hasMfcInRegion.DeliveryAddress.incorrectAddress"),agreement:_getItem("getResultInMfc.hasMfcInRegion.agreements.agreement"),phone:_getItem("getResultInMfc.hasMfcInRegion.phone.phone"),comment:_getItem("getResultInMfc.hasMfcInRegion.comment.comment")};$rootScope.env.systemData&&$rootScope.env.systemData.targetId&&(map.targetId.value=$rootScope.env.systemData.targetId);var bindingMap={request:{okato:map.okato.fullPath,serviceTargetId_in:map.targetId.fullPath},response:{routeCode:map.routeCode.fullPath,foreignId:map.foreignId.fullPath}};map.fieldMap.dictionary.requestBinding.forEach(function(binding){binding.value=bindingMap.request[binding.name]||binding.value}),map.fieldMap.dictionary.responseBindings.forEach(function(binding){binding.field=bindingMap.response[binding.name]}),map.selectMfc.value=MfcDeliverySrv.getRegionNumbers($rootScope.settings.userSelectedRegion);var availableRegionsList=[];map.availableRegions.promiseLoadDate=map.availableRegions.promiseLoadDate||$q.defer(),map.availableRegions.promiseLoadDate.promise.then(function(){availableRegionsList=map.availableRegions.listOriginal.map(function(item){return item.value}),setAvailabilityByRegion(map.selectMfc.value)}),PGU.Events.subscribe(map.selectMfc.fullPath,"selectItem",function(evt,data){setAvailabilityByRegion(data.scope.model.value)}),scope.$watch(function(){return map.needDelivery.value},checkRadio),PGU.Events.subscribe(map.fieldMap.fullPath,"click",function(evt,data){if(scope.correctRegion){scope.selectedMfc=data;var hasDelivery=hasAttrValue(data.attrs,"deliveryAllowed");map.needDelivery.visible=hasDelivery,map.deliveryPanel.visible=hasDelivery&&"yes"===map.needDelivery.value,checkRadio()}}),PGU.Events.subscribe("saveFormData",map.deliveryAddress.fullPath,function(evt,data){data.okato&&(map.incorrectDeliveryAddressHelper.visible=MfcDeliverySrv.getRegionNumbers(data.okato)!==map.selectMfc.value)}),PGU.Events.subscribe("","saveDraft",function(){if(scope.correctRegion&&scope.selectedMfc){var params={mfcCode:scope.selectedMfc.attrs.stateStructureExtId,mfcName:scope.selectedMfc.title,mfcOfficeId:scope.selectedMfc.attrs.foreignId,mfcRegion:map.selectMfc.value};["MFC","MFC_RESEND"].includes($rootScope.env.systemData.orderType)?params.orderIdMfc=$rootScope.env.orderId:params.serviceOrderId=$rootScope.env.orderId,map.needDelivery.value&&(params.withDelivery="yes"===map.needDelivery.value),params.deliveryAddress=MfcDeliverySrv.getFiasDataToSave(map.deliveryAddress,!params.withDelivery),params.userContactPhone=params.withDelivery&&map.phone.value?map.phone.value:"",params.deliveryComment=params.withDelivery&&map.comment.value?map.comment.value:"",MfcDeliverySrv.setMfcOrderData(params)}}),MfcDeliverySrv.getMfcOrderData().then(function(draft){draft&&Object.keys(draft).forEach(function(key){draft[key]&&("deliveryAddress"!==key?map[key].value=draft[key]:MfcDeliverySrv.setFiasData(map[key],draft[key]))})})}})}}}]).factory("MfcDeliveryExt",["controlAttrs",function(controlAttrs){return{attrs:angular.extend({},controlAttrs.attrs,{handlers:{default:[],"scope:sync":!1,"scope:editor":!1,"scope:model":!1},originalFrom:{"scope:editor":!1,default:"container"},version:{"scope:editor":!1,default:0}})}}]).factory("MfcDeliverySrv",["$rootScope","LOC","$q","sharedExtServices",function($rootScope,LOC,$q,sharedExtServices){function getEmptyFiasStructure(){return{fullAddress:"",index:"",region:"",regionCode:"",area:"",areaCode:"",city:"",cityCode:"",place:"",placeCode:"",street:"",streetCode:"",additionalArea:"",additionalAreaCode:"",additionalStreet:"",additionalStreetCode:"",house:"",houseCode:"",building1:"",building2:"",apartment:""}}var mapFias={fullAddress:"value",index:"post_index",regionCode:"regionFias",areaCode:"areaFias",cityCode:"cityFias",placeCode:"placeFias",streetCode:"streetFias",additionalAreaCode:"additionalAreaFias",additionalStreetCode:"additionalStreetFias",houseCode:"houseFias"};return{getRegionNumbers:function(region){if(region){var startNumbers=region.substring(0,4);if(["7111","7112","7113","7118"].includes(startNumbers))return"71100000000";if(["7114","7115","7116","7117"].includes(startNumbers))return"71140000000";return"111"===region.substring(0,3)?"11100000000":region.substring(0,2)+"000000000"}return"00000000000"},setCostInfo:function(field,generalCost,privelegeCost){field.text="Стоимость доставки справки курьером устанавливается МФЦ:<br>\n"+(privelegeCost?"- Для льготных категорий граждан — "+privelegeCost+".<br>\n":"")+(generalCost?"- Для всех граждан — "+generalCost+".\n<br>\n":"")+"<br>\nПосле получения результата оказания услуги вы получите уведомление о готовности справки и стоимости доставки, сможете оплатить доставку. За дополнительной информацией обращайтесь по телефонам МФЦ"},setCheckboxLabelLink:function(checkbox,link){var catalogUrl=LOC.WIDGET_URI+"api/catalog/v3/";checkbox.label='Я ознакомился и согласен с <a href="'+catalogUrl+link+'" target="_blank">Условиями выездного обслуживания МФЦ</a>'},getMfcOrderData:function(){var df=$q.defer();return sharedExtServices.mfcDelivery.getData($rootScope.env.orderId).then(function(response){var data=response.data;if(data){var res={needDelivery:data.withDelivery?"yes":"no",phone:data.userContactPhone,comment:data.deliveryComment};data.deliveryAddress&&data.deliveryAddress.fullAddress&&(res.deliveryAddress=data.deliveryAddress),df.resolve(res)}else df.resolve()},function(){df.resolve()}),df.promise},setMfcOrderData:function(data){var self=this,asString=JSON.stringify(data);asString!==self.lastSavedData&&sharedExtServices.mfcDelivery.setData(data).then(function(){self.lastSavedData=asString})},getFiasDataToSave:function(fias,getEmpty){var structure=getEmptyFiasStructure();return!fias.value||getEmpty?structure:(Object.keys(structure).forEach(function(key){structure[key]=fias[mapFias[key]||key]||""}),structure)},setFiasData:function(fias,data){var structure=getEmptyFiasStructure();Object.keys(structure).forEach(function(key){fias[mapFias[key]||key]=data[key]||""})}}}]),angular.module("serverFormWidgets.general").directive("epguCaptcha",["TEMPLATES","api","$rootScope","LOC",function(TEMPLATES,api,$rootScope,LOC){return{templateUrl:TEMPLATES.CAPTCHA,replace:!0,scope:{item:"="},link:function(scope,element,attrs){function initCaptcha(){var config={captchaSimpleAttemptsCount:scope.item.captchaSimpleAttemptsCount,captchaBaseTime:scope.item.captchaBaseTime,captchaIncrementTime:scope.item.captchaIncrementTime,labelText:"Введите цифры",errorText:"Введите цифры с картинки",widgetUri:LOC.ESIA_BASE};$rootScope.captchaPlugin=new CaptchaPlugin(config),$rootScope.captchaPlugin.init("captcha-plugin",function(response){switch(response.typeCaptcha){case"recaptcha":scope.title="Подтвердите действие";break;default:scope.title="Введите цифры с картинки"}})}"false"===$rootScope.env.formParam.defaultVisibleCaptcha&&(scope.item.visible=!1);var url=$rootScope.env.formParam&&$rootScope.env.formParam.EsiaCaptchaPath||LOC.ESIA_BASE+"captcha/static/captcha-plugin-min.js";(function(uri){return new Promise(function(resolve,reject){var tag=document.createElement("script");tag.src=uri,tag.async=!0,tag.onload=function(){resolve()};var firstScriptTag=document.getElementsByTagName("script")[0];firstScriptTag.parentNode.insertBefore(tag,firstScriptTag)})})(url).then(function(){initCaptcha()})}}}]).factory("CaptchaExt",["$rootScope","controlAttrs",function($rootScope,controlAttrs){return{attrs:angular.extend({},controlAttrs.attrs,{})}}]),angular.module("serverFormWidgets.general").directive("epguListKids",["TEMPLATES","api","$rootScope","$sce","sharedExtServices","$timeout","LOC","PGU","FORM_ERRORS","declineOfUnit","ListKidsSrv",function(TEMPLATES,api,$rootScope,$sce,sharedExtServices,$timeout,LOC,PGU,FORM_ERRORS,declineOfUnit,ListKidsSrv){return{templateUrl:TEMPLATES.LIST_KIDS,replace:!0,scope:{item:"="},link:function(scope,element,attrs){var watchers,oldValue="";scope.profileChild=(api.env("lkUrl")||"https://lk.gosuslugi.ru/")+"profile/family/child/docs";var esia=api.env("esia"),itemDataBinding=ListKidsSrv.getBinding(scope.item.dataBinding),itemDataBindingOwner=ListKidsSrv.getBinding(scope.item.dataBindingOwner),kids=esia.kids&&esia.kids.length?esia.kids:[];scope.item.list=[];var previousVisible="form.FormStep2.Panel1.PanelForMe";scope.item.setDataBinding=function(item,binding,clearData){for(var k in binding)binding.hasOwnProperty(k)&&("visible"===k?(previousVisible&&api.find(previousVisible)[k](!1),previousVisible=binding[k],api.find(binding[k])[k](!0)):clearData?api.find(binding[k]).value(item[k]||""):api.find(binding[k]).value(item[k]))},scope.item.chooseSelf=function(){scope.item.setDataBinding({},itemDataBindingOwner),api.find(scope.item.userRecord).value("1"),scope.item.setCurrent(-1),scope.item.isChooseSelf=!1},scope.item.chooseOtherUser=function(){scope.item.setDataBinding({},itemDataBinding,!0),api.find(scope.item.userRecord).value("3"),scope.item.setCurrent(-1),scope.item.list.length||(scope.item.isChooseSelf=!0)},scope.item.goToProfileChild=function(){var notifySMU=api.env("notifySMU");"function"==typeof notifySMU?notifySMU({eventType:"open_screen",eventParams:[{key:"screen",value:"Child"}]}):window.location.href=scope.profileChild},scope.item.setCurrent=function(ind){scope.item.list.forEach(function(li,i){if(ind===i){if(!li.current){oldValue=scope.item.value;var type=li.isOwner?"1":"2";api.find(scope.item.userRecord).value(type),scope.item.setDataBinding(li,li.isOwner?itemDataBindingOwner:itemDataBinding,!0),scope.item.value=JSON.stringify(li),api.find(scope.item.fullPath).afterSetValue(scope.item.value,oldValue),li.current=!0}}else li.current=!1})},kids.length&&(scope.item.list=kids.filter(ListKidsSrv.isLowerThan18Age).map(ListKidsSrv.getElementData),scope.item.list.sort(ListKidsSrv.sortByAttr("birthDateNumber",!0)),scope.item.showUserData||(scope.item.list.unshift(ListKidsSrv.getElementData(esia.person,esia.docs)),scope.item.list[0].isOwner=!0,scope.item.setCurrent(0))),scope.isMobile=$rootScope.device.mobile,scope.$on("suspend",function(){watchers=scope.$$watchers,scope.$$watchers=[]}),scope.$on("resume",function(){scope.$$watchers=watchers,watchers=null})}}}]).factory("ListKidsExt",["$rootScope","fieldAttrs",function($rootScope,fieldAttrs){return{attrs:angular.extend({},fieldAttrs.attrs,{validators:{"scope:editor":!1},readonly:{"scope:editor":!1},immutable:{"scope:editor":!1},isAnswer:{"scope:editor":!1},dataBinding:{type:"string",default:"visible|form.FormStep2.Panel1.PanelForOther,lastName|form.FormStep2.Panel1.PanelForOther.Panel1.Last_name,firstName|form.FormStep2.Panel1.PanelForOther.Panel2.First_name,middleName|form.FormStep2.Panel1.PanelForOther.Panel3.Middle_name,birthDate|form.FormStep2.Panel1.PanelForOther.Panel4.Birth_Date,gender|form.FormStep2.Panel1.PanelForOther.Panel5.Sex,snils|form.FormStep2.Panel1.PanelForOther.Panel6.SNILS,omsNumber|form.FormStep2.Panel1.PanelForOther.Panel10.OMS_Number","scope:editor":$rootScope.isAdminUser},dataBindingOwner:{type:"string",default:"visible|form.FormStep2.Panel1.PanelForMe,lastName|form.FormStep2.Panel1.PanelForMe.Panel1.User_Last_name,firstName|form.FormStep2.Panel1.PanelForMe.Panel2.User_First_name,middleName|form.FormStep2.Panel1.PanelForMe.Panel3.User_Middle_name,birthDate|form.FormStep2.Panel1.PanelForMe.Panel4.User_Birth_Date,gender|form.FormStep2.Panel1.PanelForMe.Panel5.User_Sex,snils|form.FormStep2.Panel1.PanelForMe.Panel6.userSnils,omsNumber|form.FormStep2.Panel1.PanelForMe.User_Panel10.User_OMS_Number","scope:editor":$rootScope.isAdminUser},showUserData:{type:"boolean",default:!1,"scope:editor":$rootScope.isAdminUser},showLinks:{type:"boolean",default:!1,"scope:editor":$rootScope.isAdminUser},showOms:{type:"boolean",default:!0,"scope:editor":$rootScope.isAdminUser},userRecord:{type:"string",default:"form.FormStepService.PanelService.isUserRecord","scope:editor":$rootScope.isAdminUser}})}}]).factory("ListKidsSrv",["$rootScope","fieldAttrs",function($rootScope,fieldAttrs){var today=new Date;return{sortByAttr:function(attrName,isDesk){return isDesk?function(a,b){return b[attrName]>a[attrName]?1:-1}:function(a,b){return a[attrName]>b[attrName]?1:-1}},getElementData:function(item,docs){var itemDocs,result={current:!1,birthDate:item.birthDate,birthDateNumber:0,lastName:item.lastName,firstName:item.firstName,middleName:item.middleName,snils:item.snils,gender:"M"===item.gender?"1":"2",id:item.id,inn:item.inn};if(docs&&docs.length?itemDocs=docs:item.documents&&item.documents.docs&&item.documents.docs.length&&(itemDocs=item.documents.docs),itemDocs){var omsDoc=itemDocs.find(function(doc){return"MDCL_PLCY"===doc.type});omsDoc&&(result.omsNumber=omsDoc.number||"",result.omsDate=omsDoc.expDate||"");var brthCert=itemDocs.find(function(doc){return"RF_BRTH_CERT"===doc.type||"FID_BRTH_CERT"===doc.type});brthCert&&(result.birthDocType=brthCert.type,result.birthDocSeries=brthCert.series,result.birthDocNumber=brthCert.number,result.birthDocIssueDate=brthCert.issueDate,result.birthDocIssuedBy=brthCert.issuedBy,result.birthDocActNo=brthCert.actNo,result.birthDocActDate=brthCert.actDate)}if(item.birthDate){var birthDateArr=item.birthDate.split(".");result.birthDateNumber=Number(birthDateArr[2]+birthDateArr[1]+birthDateArr[0])}return result},getBinding:function(binding){var result={};return binding.split(",").forEach(function(li){var row=li.split("|"),name=row[0]?row[0]:"",field=row[1]?row[1]:"";name&&(result[name]=field)}),result},isLowerThan18Age:function(kid){var bdReversed=kid.birthDate.split(".").reverse().join("-"),birthDate=new Date(bdReversed),age=today.getFullYear()-birthDate.getFullYear(),m=today.getMonth()-birthDate.getMonth();return(m<0||0===m&&today.getDate()<birthDate.getDate())&&age--,age<18}}}]),angular.module("serverFormWidgets.general").directive("epguListReferral",["TEMPLATES","api","$rootScope","$sce","sharedExtServices","$timeout","LOC","PGU","FORM_ERRORS","declineOfUnit","ListReferralSrv","pguEqueueService",function(TEMPLATES,api,$rootScope,$sce,sharedExtServices,$timeout,LOC,PGU,FORM_ERRORS,declineOfUnit,ListReferralSrv,pguEqueueService){return{templateUrl:TEMPLATES.LIST_REFERRAL,replace:!0,scope:{item:"="},link:function(scope,element,attrs){var watchers,oldValue="",searchValue="";scope.item.isOpenSearch=!1;var globalParams,requestDB=ListReferralSrv.getRequestBinding(scope.item.requestBinding),requestDBOwner=ListReferralSrv.getRequestBinding(scope.item.requestBindingOwner),requestDBSearch=ListReferralSrv.getRequestBinding(scope.item.requestBindingSearch),responseDB=ListReferralSrv.getRequestBinding(scope.item.responseBinding),validateListItems=[];scope.item.getList=function(cb,emptySearch,isInnerCall){if(scope.item.clearData(),api.find(scope.item.pathToParentStep).shaded()||api.find(scope.item.pathToParentStep).shaded(!0),isInnerCall||(scope.item.isOpenSearch=!1),scope.item.clearResponseBinding(),scope.buttons.btnBook.isNotActive=!1,scope.item.showSearchReferral=3==api.find(scope.item.pathToReferralRegion).value(),scope.search.error="",!emptySearch){var filter,userRecord=api.find(scope.item.userRecord).value(),userType=api.find(scope.item.userType).value(),params={eserviceId:api.find("form.FormStepService.PanelService.eserviceId").value(),parentRefItemValue:null,treeFiltering:"ONELEVEL"};if(scope.item.isOpenSearch&&searchValue?(params.refName="Referral",filter=pguEqueueService.buildFilterWithDateAggSlot(requestDBSearch)):(params.refName="getValidatePatient",filter=pguEqueueService.buildFilterWithDateAggSlot("1"==userRecord?requestDBOwner:requestDB)),filter&&(filter.union||filter.simple)&&(params.filter=filter),angular.equals(globalParams,params))return scope.item.list=validateListItems,scope.searchThrobber=!1,api.find(scope.item.pathToParentStep).shaded(!1),void(scope.item.list.length||scope.item.isOpenSearch||api.find(scope.item.pathToStepBook).visible(!0));scope.buttons.btnBookByReferral.isNotActive=!0,scope.search.isResponseEmpty="",scope.serverErrorItem=null,globalParams=Object.assign({},params),sharedExtServices.equeueService.getAggRefItems(params,function(data){var showServerError=!1;if(scope.serverErrorItem=null,scope.search.isResponseEmpty="",scope.item.value="",data){var emptyObj={title:"Внимание!",html:"",fullPath:scope.item.pathToStepBook+":responseEmpty",type:"important",visible:!0};data.items&&data.items.length?("1"===userRecord&&"PERSON_RF"!==userType?scope.item.isOpenSearch?(scope.item.list=data.items.map(ListReferralSrv.getElementData),searchValue||(validateListItems=scope.item.list),api.find(scope.item.pathToStepBook).visible(!1),"function"==typeof cb&&cb(),cb&&"function"==typeof cb.done&&cb.done(data.items)):(emptyObj.html=scope.item.emptyResponseOwnerNotAL20WithoutONLYWord,scope.search.isResponseEmpty=emptyObj,api.find(scope.item.pathToStepBook).visible(!0)):(scope.item.list=data.items.map(ListReferralSrv.getElementData),searchValue||(validateListItems=scope.item.list),"function"==typeof cb&&cb(),cb&&"function"==typeof cb.done&&cb.done(data.items)),scope.item.isOpenSearch=!1):(data.error&&data.error.errorDetail&&data.error.errorDetail.errorCode&&(showServerError=scope.item.handleServerError(data.error,!0)),showServerError?(api.find(scope.item.pathToParentStep).visible(!1),scope.item.list=[]):(searchValue&&"getValidatePatient"!==params.refName||(validateListItems=scope.item.list=[]),scope.item.isOpenSearch&&searchValue?(emptyObj.html=scope.item.emptyResponseSearch,scope.search.isResponseEmpty=emptyObj):(api.find(scope.item.pathToStepBook).visible(!0),"1"===userRecord?"PERSON_RF"===userType?(emptyObj.html=scope.item.emptyResponseOwner,scope.search.isResponseEmpty=emptyObj,scope.item.isOpenSearch=!0):(emptyObj.html=scope.item.emptyResponseOwnerNotAL20,scope.search.isResponseEmpty=emptyObj):"PERSON_RF"===userType?(emptyObj.html=scope.item.emptyResponseOther,scope.search.isResponseEmpty=emptyObj):(emptyObj.html=scope.item.emptyResponseOwnerNotAL20,scope.search.isResponseEmpty=emptyObj))))}else scope.search.error="При обработке данных произошла непредвиденная ошибка. Пожалуйста, обновите страницу и попробуйте снова.";api.find(scope.item.pathToParentStep).shaded(!1),cb&&"function"==typeof cb.always&&cb.always(),scope.searchThrobber=!1},function(error){api.find(scope.item.pathToParentStep).shaded(!1),scope.search.error="При обработке данных произошла непредвиденная ошибка. Пожалуйста, обновите страницу и попробуйте снова.","function"==typeof cb&&cb(),cb&&cb.error,cb&&"function"==typeof cb.always&&cb.always(),scope.searchThrobber=!1})}},scope.item.setCurrent=function(ind){scope.item.list.forEach(function(li,i){ind===i?li.current||(scope.item.clearResponseBinding(),oldValue=scope.item.value,ListReferralSrv.setResponseBinding(responseDB,li),scope.item.value=li.toMoOid,scope.item.itemValue=JSON.stringify(li),scope.item.MO_OID=li.toMoOid,scope.item.Referral_Id=li.referralId,api.find(scope.item.ServiceSpec_Id).value(li.toSpecsId),api.find(scope.item.Resource_Id).value(li.resourceId||""),api.find(scope.item.Service_Id).value(li.toServiceId),api.find(scope.item.ReferralNumberPath).value(li.referralNumber),api.find(scope.item.fullPath).afterSetValue(scope.item.value,oldValue),li.current=!0,scope.buttons.btnBookByReferral.isNotActive=!1):li.current=!1})},scope.item.toggleDetails=function(ind){scope.item.list.forEach(function(li,i){ind===i&&(li.isOpenDetails=!li.isOpenDetails,li.openDetailsText=li.isOpenDetails?"Скрыть":"Подробнее")})},scope.item.toggleSearch=function(){scope.search.error="",scope.item.isOpenSearch=!scope.item.isOpenSearch,scope.item.isOpenSearch||scope.item.getList(null,!1,!0)},scope.buttons={btnBook:{btnColor:"white",label:scope.item.btnBookText,fullPath:scope.item.fullPath?scope.item.fullPath+"._btnBook":"_btnBook",floating:"PGU-BtnFloat",buttonSize:"small",visible:!0},btnBookByReferral:{btnColor:"blue",label:scope.item.btnBookByReferralText,fullPath:scope.item.fullPath?scope.item.fullPath+"._btnBookByReferral":"_btnBookByReferral",floating:"PGU-BtnFloat",buttonSize:"small",visible:!0,isNotActive:!0,isNotSubmit:!0},btnSearchReferral:{btnColor:"blue",label:scope.item.btnSearchReferralText,fullPath:scope.item.fullPath?scope.item.fullPath+"._btnSearchReferral":"_btnSearchReferral",floating:"PGU-BtnFloat",buttonSize:"small",visible:!0}},scope.search={error:"",items:[]};var searchInput={className:"FieldText",name:"_searchReferral",label:"Номер направления",notRequiredText:"",fieldWidth:"",required:!0,fullPath:scope.item.fullPath?scope.item.fullPath+"._searchReferral":"._searchReferral"};scope.search.items.push(searchInput),api.initAttrs(scope.search.items),$rootScope.$on(scope.item.fullPath+"."+searchInput.name+":inputChange",function(evt,data){searchValue=data.newV}),scope.item.clearData=function(){scope.item.MO_OID="",scope.item.Referral_Id="",api.find(scope.item.Service_Id).value(""),api.find(scope.item.ReferralNumberPath).value(""),scope.item.value="",api.find(scope.item.ServiceSpec_Id).value(""),api.find(scope.item.Resource_Id).value(""),scope.buttons.btnBookByReferral.isNotActive=!0,scope.buttons.btnBookByReferral.isLoad=!1,scope.item.list&&scope.item.list.length&&scope.item.list.forEach(function(li,i){li.current&&(scope.item.value=li.toMoOid,scope.item.itemValue=JSON.stringify(li),scope.item.MO_OID=li.toMoOid,scope.item.Referral_Id=li.referralId,api.find(scope.item.ServiceSpec_Id).value(li.toSpecsId),api.find(scope.item.Resource_Id).value(li.resourceId||""),api.find(scope.item.Service_Id).value(li.toServiceId),api.find(scope.item.ReferralNumberPath).value(li.referralNumber),api.find(scope.item.fullPath).afterSetValue(scope.item.value,oldValue),scope.buttons.btnBookByReferral.isNotActive=!1)})},scope.item.clearResponseBinding=function(){var chooseDoctor=api.find(scope.item.pathToChooseDoctor);scope.item.toHideSteps.split(",").forEach(function(item){api.find(item).visible(!1)}),ListReferralSrv.setResponseBinding(responseDB,{}),chooseDoctor.element.clearResponseBinding()},scope.item.btnBook=function(){scope.item.clearData(),api.find(scope.item.pathToStepBook).visible(!0),api.find(scope.item.pathToStepChooseDoctor).visible(!1),api.find("form.FormStep6").visible(!1)},scope.item.handleServerError=function(error,actionByCondition){var errorMsgToArr,hBI,hBVI,isErrorNeedToShow=!1,text="При обработке данных произошла непредвиденная ошибка. Пожалуйста, обновите страницу и попробуйте снова.",errorText="",isRedType=!0,errorTypeYellow=["NO_DATA"],errorTypeRed=["FAILURE","UNKNOWN_REQUEST_DESCRIPTION"],errorStep=api.find(scope.item.pathToStepError);return error&&(error.errorDetail&&3==error.errorDetail.errorCode&&(isErrorNeedToShow=!0),error.errorDetail&&error.errorDetail.errorMessage&&(errorMsgToArr=error.errorDetail.errorMessage.split(":"))&&errorMsgToArr.length&&(~errorTypeYellow.indexOf(errorMsgToArr[0])?(isRedType=!1,errorText=errorMsgToArr[1]):~errorTypeRed.indexOf(errorMsgToArr[0])&&(errorText=errorMsgToArr[1]),errorText&&(isErrorNeedToShow=!0,text=errorText))),6===error.errorDetail.errorCode&&(actionByCondition=!1),(!actionByCondition||actionByCondition&&isErrorNeedToShow)&&(actionByCondition?scope.serverErrorItem={title:"Внимание!",html:text,fullPath:scope.item.pathToStepError,type:isRedType?"veryImportant":"important",visible:!0}:(errorStep.visible(!0),hBI=errorStep.find(scope.item.pathToHBI),hBVI=errorStep.find(scope.item.pathToHBVI),hBI.visible(!isRedType),hBI.html(isRedType?"":text),hBVI.visible(isRedType),hBVI.html(isRedType?text:""))),isErrorNeedToShow},scope.item.btnBookByReferral=function(){if(scope.item.value){scope.item.toHideSteps.split(",").forEach(function(step){api.find(step).visible(!1)}),scope.buttons.btnBookByReferral.isLoad=!0,api.find(scope.item.pathToElement).visible(!0);var chooseDoctor=api.find(scope.item.pathToChooseDoctor),step=api.find(scope.item.pathToStepChooseDoctor);step.visible(!0),step.shaded(!0),step.scrollTo(),chooseDoctor.fetch(1,{done:function(){scope.buttons.btnBookByReferral.isLoad=!1,step.shaded(!1)},error:function(error){scope.buttons.btnBookByReferral.isLoad=!1,step.visible(!1),step.shaded(!1),scope.item.handleServerError(error)}})}},scope.item.btnSearchReferral=function(){var numberRef=api.find(scope.item.fullPath?scope.item.fullPath+"._searchReferral":"._searchReferral");api.find(scope.item.searchFieldPath).value(searchValue),scope.item.Referral_Number=searchValue,searchValue?(numberRef.validate(!0),scope.searchThrobber=!0,scope.item.getList(null,!1,!0)):scope.item.isOpenSearch?numberRef.validate():scope.item.getList(null,!0,!0)},scope.isMobile=$rootScope.device.mobile,scope.$on("suspend",function(){watchers=scope.$$watchers,scope.$$watchers=[]}),scope.$on("resume",function(){scope.$$watchers=watchers,watchers=null})}}}]).factory("ListReferralExt",["$rootScope","fieldAttrs",function($rootScope,fieldAttrs){return{attrs:angular.extend({},fieldAttrs.attrs,{dataBinding:{type:"string",default:"lastName|form.FormStep2.Panel1.PanelForOther.Panel1.Last_name,firstName|form.FormStep2.Panel1.PanelForOther.Panel2.First_name,middleName|form.FormStep2.Panel1.PanelForOther.Panel3.Middle_name,birthDate|form.FormStep2.Panel1.PanelForOther.Panel4.Birth_Date,gender|form.FormStep2.Panel1.PanelForOther.Panel5.Sex,snils|form.FormStep2.Panel1.PanelForOther.Panel6.SNILS,omsNumber|form.FormStep2.Panel1.PanelForOther.Panel10.OMS_Number","scope:editor":$rootScope.isAdminUser},showUserData:{type:"boolean",default:!1,"scope:editor":$rootScope.isAdminUser},btnBookText:{type:"string",default:"Записаться без направления","scope:editor":$rootScope.isAdminUser},btnBookByReferralText:{type:"string",default:"Записаться по направлению","scope:editor":$rootScope.isAdminUser},btnSearchReferralText:{type:"string",default:"Найти направление","scope:editor":$rootScope.isAdminUser},pathToElement:{type:"string",default:"","scope:editor":$rootScope.isAdminUser},searchFieldPath:{type:"string",default:"","scope:editor":$rootScope.isAdminUser},timeSlotPath:{type:"string",default:"form.FormStep6.Panel1.TimeSlotExt","scope:editor":$rootScope.isAdminUser},eQueueTypePath:{type:"string",default:"","scope:editor":$rootScope.isAdminUser},pathToStepBook:{type:"string",default:"form.FormStepMO","scope:editor":$rootScope.isAdminUser},pathToChooseDoctor:{type:"string",default:"form.__FormStepCapthca1.PanelCapthca3.ListSpecialists","scope:editor":$rootScope.isAdminUser},pathToStepChooseDoctor:{type:"string",default:"form.FormStep_ChooseDoctor","scope:editor":$rootScope.isAdminUser},itemValue:{type:"string",default:"","scope:editor":$rootScope.isAdminUser},Referral_Id:{type:"string",default:"","scope:editor":$rootScope.isAdminUser},MO_OID:{type:"string",default:"","scope:editor":$rootScope.isAdminUser},Service_Id:{type:"string",default:"","scope:editor":$rootScope.isAdminUser},Referral_Number:{type:"string",default:"","scope:editor":$rootScope.isAdminUser},ReferralNumberPath:{type:"string",default:"form.FormStepService.PanelService.Referral_Id","scope:editor":$rootScope.isAdminUser},ServiceSpec_Id:{type:"string",default:"form.FormStepService.PanelService.ServiceSpec_Id","scope:editor":$rootScope.isAdminUser},Resource_Id:{
type:"string",default:"form.FormStepService.PanelService.Resource_Id","scope:editor":$rootScope.isAdminUser},userRecord:{type:"string",default:"form.FormStepService.PanelService.isUserRecord","scope:editor":$rootScope.isAdminUser},userType:{type:"string",default:"form.FormStepService.PanelService.userType","scope:editor":$rootScope.isAdminUser},requestBinding:{type:"string",default:"name:userType|attr:value|value:form.FormStepService.PanelService.userType,name:esiaId|attr:value|value:form.FormStepService.PanelService.esiaId,name:userSnils|attr:value|value:form.FormStepService.PanelService.userSnils,name:isUserRecord|attr:value|value:form.FormStepService.PanelService.isUserRecord,name:lastName|attr:value|value:form.FormStep2.Panel1.PanelForOther.Panel1.Last_name,name:firstName|attr:value|value:form.FormStep2.Panel1.PanelForOther.Panel2.First_name,name:middleName|attr:value|value:form.FormStep2.Panel1.PanelForOther.Panel3.Middle_name,name:birthdate|attr:value|value:form.FormStep2.Panel1.PanelForOther.Panel4.Birth_Date,name:OMS_Number|attr:value|value:form.FormStep2.Panel1.PanelForOther.Panel10.OMS_Number,name:patientSnils|attr:value|value:form.FormStep2.Panel1.PanelForOther.Panel6.SNILS,name:regionCode|attr:value|value:form.FormStep1.Panel1.Regions,name:Session_Id|attr:value|value:form.FormStepService.PanelService.Session_Id,name:sex|attr:value|value:form.FormStep2.Panel1.PanelForOther.Panel5.Sex","scope:editor":$rootScope.isAdminUser},requestBindingOwner:{type:"string",default:"name:userType|attr:value|value:form.FormStepService.PanelService.userType,name:esiaId|attr:value|value:form.FormStepService.PanelService.esiaId,name:userSnils|attr:value|value:form.FormStepService.PanelService.userSnils,name:isUserRecord|attr:value|value:form.FormStepService.PanelService.isUserRecord,name:lastName|attr:value|value:form.FormStep2.Panel1.PanelForMe.Panel_lastName.lastName,name:firstName|attr:value|value:form.FormStep2.Panel1.PanelForMe.Panel_firstName.firstName,name:middleName|attr:value|value:form.FormStep2.Panel1.PanelForMe.Panel3.User_Middle_name,name:birthdate|attr:value|value:form.FormStep2.Panel1.PanelForMe.Panel_birthdate.birthdate,name:OMS_Number|attr:value|value:form.FormStep2.Panel1.PanelForMe.Panel_OMS_Number.OMS_Number,name:patientSnils|attr:value|value:form.FormStep2.Panel1.PanelForMe.Panel_patientSnils.patientSnils,name:regionCode|attr:value|value:form.FormStep1.Panel1.Regions,name:Session_Id|attr:value|value:form.FormStepService.PanelService.Session_Id,name:sex|attr:value|value:form.FormStep2.Panel1.PanelForMe.Panel_sex.sex","scope:editor":$rootScope.isAdminUser},requestBindingSearch:{type:"string",default:"name:Referral_Number|attr:Referral_Number|value:form.FormStep_Referral.Panel_Grid.Panel_Referral.ListReferral,name:Session_Id|attr:value|value:form.FormStepService.PanelService.Session_Id","scope:editor":$rootScope.isAdminUser},emptyResponseOwner:{type:"string",default:"Направление пациента с указанным номером не найдено. Пожалуйста, проверьте корректность введенных ваших данных.","scope:editor":$rootScope.isAdminUser},emptyResponseOwnerNotAL20WithoutONLYWord:{type:"string",default:"Доступна информация о Ваших направлениях в случае наличия подтверждённой учётной записи ЕСИА. Информацию о способах получения статуса учётной записи «Подтверждённая» Вы можете узнать на странице «Частые вопросы» в разделе <a href='/help/faq/c-1/2003'>«Регистрация»</a>","scope:editor":$rootScope.isAdminUser},emptyResponseOwnerNotAL20:{type:"string",default:"Доступна информация только о Ваших направлениях в случае наличия подтверждённой учётной записи ЕСИА. Информацию о способах получения статуса учётной записи «Подтверждённая» Вы можете узнать на странице «Частые вопросы» в разделе <a href='/help/faq/c-1/2003'>«Регистрация»</a>","scope:editor":$rootScope.isAdminUser},emptyResponseOther:{type:"string",default:"Доступна информация только о Ваших направлениях","scope:editor":$rootScope.isAdminUser},emptyResponseSearch:{type:"string",default:"Направление по номеру не найдено","scope:editor":$rootScope.isAdminUser},pathToParentStep:{type:"string",default:"form.FormStep_Referral","scope:editor":$rootScope.isAdminUser},pathToReferralRegion:{type:"string",default:"form.FormStep1.PanelService.Referral","scope:editor":$rootScope.isAdminUser},pathToStepError:{type:"string",default:"form.FormStepError","scope:editor":$rootScope.isAdminUser},pathToHBI:{type:"string",default:"Panel.HelperBox_Important","scope:editor":$rootScope.isAdminUser},pathToHBVI:{type:"string",default:"Panel.HelperBox_veryImportant","scope:editor":$rootScope.isAdminUser},responseBinding:{type:"string",default:"name:toSpecsName|attr:value|field:form.FormStepService.PanelService.Resource_Value","scope:editor":$rootScope.isAdminUser},toHideSteps:{type:"string",default:"form.FormStep_ChooseDoctor,form.FormStepSpecialty3,form.FormStepExpert4,form.FormStepMO,form.FormStepSpecialty4,form.FormStepExpert5,form.FormStep6,form.FormStepError","scope:editor":$rootScope.isAdminUser}})}}]).factory("ListReferralSrv",["$rootScope","fieldAttrs","api","apiInner",function($rootScope,fieldAttrs,api,apiInner){var typeIdMap={4:"Направлен на процедуру",6:"Направлен на консультацию к врачу",8:"Направлен"};return{sortByAttr:function(attrName){return function(a,b){return a[attrName]>b[attrName]?1:-1}},getElementData:function(itemData){var result={current:!1,isOpenDetails:!1,openDetailsText:"Подробнее"};return itemData.attributes.forEach(function(li){"referralStartDate"===li.name&&(result.referralStartDateFormatted=(li.value||"").split("-").reverse().join(".")),"referralEndDate"===li.name&&(result.referralEndDateFormatted=(li.value||"").split("-").reverse().join(".")),result[li.name]=li.value}),result.typeIdText=typeIdMap[result.referralTypeId],result},getBinding:function(binding){var result={};return binding.split(",").forEach(function(li){var row=li.split("|"),name=row[0]?row[0]:"",field=row[1]?row[1]:"";name&&(result[name]=field)}),result},getRequestBinding:function(binding){var result=[];return binding.split(",").forEach(function(li){var bindingElement={};li.split("|").forEach(function(item){var parts=item.split(":");bindingElement[parts[0]]=parts[1]}),result.push(bindingElement)}),result},leadingZero:function(num){return num<10?"0"+num:num},setResponseBinding:function(responseBindings,item){for(var i=0,il=responseBindings.length;i<il;i++){var v=responseBindings[i],valueToBind=item[v.name]||"",field=api.find(v.value||v.field);field&&!apiInner.isEmptyObject(field)&&field.attr(v.attr,valueToBind)}}}}]),angular.module("serverFormWidgets.general").directive("epguListSpecialists",["TEMPLATES","api","$rootScope","$sce","sharedExtServices","$timeout","LOC","PGU","FORM_ERRORS","declineOfUnit","ListSpecialistsSrv","pguEqueueService",function(TEMPLATES,api,$rootScope,$sce,sharedExtServices,$timeout,LOC,PGU,FORM_ERRORS,declineOfUnit,ListSpecialistsSrv,pguEqueueService){return{templateUrl:TEMPLATES.LIST_SPECIALISTS,replace:!0,scope:{item:"="},link:function(scope,element,attrs){function clearSelectedDate(list){if(list&&list.length)for(var i=0;i<list.length;i++)if(list[i].doctors&&list[i].doctors.length)for(var k=0;k<list[i].doctors.length;k++){var doc=list[i].doctors[k];if(doc.selectedDateStr="",doc.listDates&&doc.listDates.length)for(var j=0;j<doc.listDates.length;j++)doc.listDates[j].selected=!1;if(doc.originalDates&&doc.originalDates.length)for(var l=0;l<doc.originalDates.length;l++)doc.originalDates[l].selected=!1}}function showItem(){scope.item.visible=!!scope.item.list.length}var watchers,oldValue="";scope.item.list=[];var responseDB=ListSpecialistsSrv.getRequestBinding(scope.item.responseBinding);scope.item.setDate=function(date,resource){var val=date.value,dateDDMMYYYY=(ListSpecialistsSrv.parseStringDate(val),moment(new Date).format("DD.MM.YYYY")),maxDateDDMMYYYY=ListSpecialistsSrv.getMaxAvailableDate(resource.originalDates);val&&(clearSelectedDate(scope.item.list),oldValue=scope.item.value,scope.item.value=val,resource.isOpenDates=!1,resource.selectedDateStr=date.dateLeadingZero+"."+date.monthLeadingZero+", "+date.dayName,ListSpecialistsSrv.setResponseBinding(responseDB,resource),api.find(scope.item.MO_Id).value(resource.MO_Id),api.find(scope.item.Resource_Id).value(resource.Resource_Id),api.find(scope.item.Startdate).value(dateDDMMYYYY),api.find(scope.item.Enddate).value(maxDateDDMMYYYY),api.find(scope.item.Starttime).value("00:00"),api.find(scope.item.Endtime).value("23:59"),api.find(scope.item.fullPath).afterSetValue(scope.item.value,oldValue),scope.buttons.btnBookByDate.isNotActive=!1,date.selected=!0)};var requestDB=ListSpecialistsSrv.getRequestBinding(scope.item.requestBinding),previousVisible="";scope.item.setCurrent=function(ind){scope.item.list.forEach(function(li,i){ind===i?li.current||(li.current=!0):li.current=!1})},scope.item.setDataBinding=function(item,binding){for(var k in binding)binding.hasOwnProperty(k)&&("visible"===k?(previousVisible&&api.find(previousVisible)[k](!1),previousVisible=binding[k],api.find(binding[k])[k](!0)):api.find(binding[k]).value(item[k]||""))},scope.item.clearResponseBinding=function(){scope.item.value="",api.find(scope.item.MO_Id).value(""),api.find(scope.item.Resource_Id).value(""),api.find(scope.item.Startdate).value(""),api.find(scope.item.Enddate).value(""),ListSpecialistsSrv.setResponseBinding(responseDB,{})},scope.item.getList=function(cb){scope.item.value="",scope.buttons.btnBookByDate.isNotActive=!0,scope.buttons.btnBookByDate.isLoad=!1,scope.item.list=[];var params={eserviceId:api.find("form.FormStepService.PanelService.eserviceId").value(),refName:"Resource",parentRefItemValue:null,treeFiltering:"ONELEVEL"},filter=pguEqueueService.buildFilterWithDateAggSlot(requestDB);filter&&(filter.union||filter.simple)&&(params.filter=filter),scope.item.clearResponseBinding(),sharedExtServices.equeueService.getAggRefItems(params,function(data){data&&data.items&&data.items.length?(scope.item.list=ListSpecialistsSrv.createResourcesList(data.items,1,7),"function"==typeof cb&&cb(data.items),cb&&"function"==typeof cb.done&&cb.done(data.items),showItem()):(showItem(),"function"==typeof cb&&cb(data.error),cb&&"function"==typeof cb.error&&cb.error(data.error))},function(error){"function"==typeof cb&&cb(error),cb&&"function"==typeof cb.error&&cb.error(error)})},scope.nextWeek=function(ind,indRow){var resources=scope.item.list,page=void 0!==indRow?resources[ind].doctors[indRow].page:resources[ind].page,pageSize=resources[ind].pageSize;resources[ind].daysLength-(page+1)*pageSize<0||(page++,void 0!==indRow?(resources[ind].doctors[indRow].page=page,resources[ind].doctors[indRow].listDates=resources[ind].doctors[indRow].originalDates.slice((page-1)*pageSize,pageSize*page)):(resources[ind].page=page,resources[ind].doctors.forEach(function(li,i){li.listDates=li.originalDates.slice((page-1)*pageSize,pageSize*page)})))},scope.prevWeek=function(ind,indRow){var resources=scope.item.list,page=void 0!==indRow?resources[ind].doctors[indRow].page:resources[ind].page,pageSize=resources[ind].pageSize;page-1!=0&&(page--,void 0!==indRow?(resources[ind].doctors[indRow].page=page,resources[ind].doctors[indRow].listDates=resources[ind].doctors[indRow].originalDates.slice((page-1)*pageSize,pageSize*page)):(resources[ind].page=page,resources[ind].doctors.forEach(function(li,i){li.listDates=li.originalDates.slice((page-1)*pageSize,pageSize*page)})))},scope.toggleDates=function(rowInd,ind){var resources=scope.item.list;resources[rowInd].doctors[ind].isOpenDates=!resources[rowInd].doctors[ind].isOpenDates},scope.buttons={btnBookByDate:{btnColor:"blue",label:scope.item.btnBookByDateText,fullPath:scope.item.fullPath?scope.item.fullPath+"._btnBookByDate":"_btnBookByDate",floating:"PGU-BtnFloat",buttonSize:"small",visible:!0,isNotActive:!0,isNotSubmit:!0}},scope.item.btnBookByDate=function(){if(scope.item.value){var stepTS=api.find(scope.item.pathToStepTimeSlot),tS=api.find(scope.item.timeSlotPath);stepTS.visible(!0),scope.buttons.btnBookByDate.isLoad=!0,stepTS.shaded(!0),stepTS.scrollTo(),tS.visible(!0),api.find(scope.item.timeSlotPath).fetch(1,{done:function(){scope.buttons.btnBookByDate.isLoad=!1,stepTS.shaded(!1),tS.scrollTo()},error:function(){scope.buttons.btnBookByDate.isLoad=!1,tS.scrollTo(),stepTS.shaded(!1)},always:function(){scope.buttons.btnBookByDate.isLoad=!1,tS.scrollTo(),stepTS.shaded(!1)}})}},scope.isDesktop=$rootScope.device.desktop,scope.isMobile=$rootScope.device.mobile,scope.isTablet=$rootScope.device.tablet,scope.$on("suspend",function(){watchers=scope.$$watchers,scope.$$watchers=[]}),scope.$on("resume",function(){scope.$$watchers=watchers,watchers=null}),showItem()}}}]).factory("ListSpecialistsExt",["$rootScope","fieldAttrs",function($rootScope,fieldAttrs){return{attrs:angular.extend({},fieldAttrs.attrs,{showUserData:{type:"boolean",default:!1,"scope:editor":$rootScope.isAdminUser},infoText:{type:"string",default:"Для врача указаны доступные дни для записи. Полное расписание отображается после выбора врача.","scope:editor":$rootScope.isAdminUser},btnBookByDateText:{type:"string",default:"Выбрать время","scope:editor":$rootScope.isAdminUser},timeSlotPath:{type:"string",default:"form.FormStep6.Panel1.TimeSlotExt","scope:editor":$rootScope.isAdminUser},pathToStepTimeSlot:{type:"string",default:"form.FormStep6","scope:editor":$rootScope.isAdminUser},pathToStepChooseDoctor:{type:"string",default:"form.FormStep_ChooseDoctor","scope:editor":$rootScope.isAdminUser},requestBinding:{type:"string",default:"name:Service_Id|attr:value|value:form.FormStepService.PanelService.ServiceSpec_Id,name:Referral_Id|attr:Referral_Id|value:form.FormStep_Referral.Panel_Grid.Panel_Referral.ListReferral,name:MO_OID|attr:MO_OID|value:form.FormStep_Referral.Panel_Grid.Panel_Referral.ListReferral,name:Session_Id|attr:value|value:form.FormStepService.PanelService.Session_Id","scope:editor":$rootScope.isAdminUser},responseBinding:{type:"string",default:"name:Address_MO|attr:value|field:form.FormStepService.PanelService.Address_MO,name:Organization_Name|attr:value|field:form.FormStepService.PanelService.Organization_Name,name:Resource_Name|attr:value|field:form.FormStepService.PanelService.DoctorName","scope:editor":$rootScope.isAdminUser},MO_Id:{type:"string",default:"","scope:editor":$rootScope.isAdminUser},Resource_Id:{type:"string",default:"","scope:editor":$rootScope.isAdminUser},ServiceSpec_Id:{type:"string",default:"","scope:editor":$rootScope.isAdminUser},Startdate:{type:"string",default:"","scope:editor":$rootScope.isAdminUser},Enddate:{type:"string",default:"","scope:editor":$rootScope.isAdminUser},Starttime:{type:"string",default:"","scope:editor":$rootScope.isAdminUser},Endtime:{type:"string",default:"","scope:editor":$rootScope.isAdminUser}})}}]).factory("ListSpecialistsSrv",["$rootScope","fieldAttrs","api","apiInner",function($rootScope,fieldAttrs,api,apiInner){return{sortByAttr:function(attrName){return function(a,b){return a[attrName]>b[attrName]?1:-1}},parseStringDate:function(string,separator,format){var arrFromStr=string.split("-"),parts=["year","month","date"],result={};return arrFromStr.forEach(function(li,i){result[parts[i]]=li}),result},getDayName:function(num){return["пн","вт","ср","чт","пт","сб","вс"][num-1]},createDates:function(str,doctors){var minGetTime,maxGetTime,parsedStr,getDay,self=this,min=0,max=0,result={list:[],hash:{}};return doctors&&doctors.length&&(doctors.forEach(function(doctor,di){var str=doctor.Availability_Date||"",arr=str.split("#");if(arr.length)for(var i=0,il=arr.length;i<il;i++)arr[i]&&(min||max?(parsedStr=self.parseStringDate(arr[i]),min.setFullYear(parsedStr.year,parsedStr.month-1,parsedStr.date),max.setFullYear(parsedStr.year,parsedStr.month-1,parsedStr.date),min.getTime()-minGetTime<0&&(minGetTime=min.getTime()),max.getTime()-maxGetTime>0&&(maxGetTime=max.getTime())):(min=new Date(arr[i]),max=new Date(arr[i]),minGetTime=min.getTime(),maxGetTime=min.getTime()),getDay=0===min.getDay()?7:min.getDay(),result.list.push({day:getDay,dayName:self.getDayName(getDay),value:arr[i],year:min.getFullYear(),month:min.getMonth(),date:min.getDate()}),result.hash[di+"__"+arr[i]]=arr[i]);else doctor.emptyDates=!0}),result.list.length&&(1!==result.list[0].day&&(min.setFullYear(result.list[0].year,result.list[0].month,result.list[0].date),min.setDate(min.getDate()-(min.getDay()-1)),getDay=0===min.getDay()?7:min.getDay(),result.list.unshift({day:getDay,dayName:self.getDayName(getDay),value:"",year:min.getFullYear(),month:min.getMonth(),date:min.getDate()}),minGetTime=min.getTime()),0!==result.list[result.list.length-1]&&(max.setFullYear(result.list[result.list.length-1].year,result.list[result.list.length-1].month,result.list[result.list.length-1].date),max.setDate(max.getDate()+(7-max.getDay())),getDay=0===max.getDay()?7:max.getDay(),result.list.push({day:getDay,dayName:self.getDayName(getDay),value:"",year:max.getFullYear(),month:max.getMonth(),date:max.getDate()}),maxGetTime=max.getTime())),result.daysLength=(maxGetTime-minGetTime)/864e5),result},getDaysInMonth:function(year,month){return 32-new Date(year,month,32).getDate()},createWeeks:function(data,ind,message){for(var self=this,prefix=ind+"__",firstDay=data.list[0],currentDay=firstDay.day,currentYear=firstDay.year,currentMonth=firstDay.month,currentDate=firstDay.date,daysLength=data.daysLength,daysInMonth=self.getDaysInMonth(firstDay.year,firstDay.month),result=[],value="",title="",i=0,il=daysLength;i<=il;i++)currentDate>daysInMonth&&(currentDate=1,currentYear=11===currentMonth?currentYear+1:currentYear,currentMonth=(currentMonth+1)%12,daysInMonth=self.getDaysInMonth(currentYear,currentMonth)),value=data.hash[prefix+currentYear+"-"+self.leadingZero(currentMonth+1)+"-"+self.leadingZero(currentDate)]?data.hash[prefix+currentYear+"-"+self.leadingZero(currentMonth+1)+"-"+self.leadingZero(currentDate)]:"",message||(title=value?"Есть свободное время для записи":"Нет свободного времени для записи"),result.push({day:currentDay,dayName:self.getDayName(currentDay),year:currentYear,month:currentMonth,monthLeadingZero:self.leadingZero(currentMonth+1),date:currentDate,dateLeadingZero:self.leadingZero(currentDate),value:value,title:title}),currentDay=7===currentDay?1:currentDay+1,currentDate++;return result},getElementData:function(itemData){var result={pageSize:7,page:1,current:!1};return itemData.attributes.forEach(function(li){"Resource_Name"===li.name?result.fio=li.value:"Availability_Date"===li.name&&(result.Availability_Date=li.value),result[li.name]=li.value}),result},getBinding:function(binding){var result={};return binding.split(",").forEach(function(li){var row=li.split("|"),name=row[0]?row[0]:"",field=row[1]?row[1]:"";name&&(result[name]=field)}),result},leadingZero:function(num){return num<10?"0"+num:num},getRequestBinding:function(binding){var result=[];return binding.split(",").forEach(function(li){var bindingElement={};li.split("|").forEach(function(item){var parts=item.split(":");bindingElement[parts[0]]=parts[1]}),result.push(bindingElement)}),result},createResourcesList:function(list,page,pageSize){var self=this,result=[],uniqueId={};list.forEach(function(item){var elem,idElem=item.attributes.find(function(li){return"MO_Id"===li.name}),id=idElem?idElem.value:"__";uniqueId[id]||(uniqueId[id]={pageSize:7,page:1,current:!1,doctors:[]},item.attributes.forEach(function(li){uniqueId[id][li.name]=li.value})),elem=self.getElementData(item),uniqueId[id].doctors.push(elem)});for(var k in uniqueId)uniqueId.hasOwnProperty(k)&&result.push(uniqueId[k]);return result.forEach(function(item,itemI){item.ind=itemI;var dates=self.createDates("2018-11-17#2018-12-17#2018-12-18#2018-12-25#2019-01-02",item.doctors);item.doctors.forEach(function(li,i){li.originalDates=self.createWeeks(dates,i,li.Availability_Date_Message),item.daysLength=li.originalDates.length,li.rowTitle=li.Availability_Date_Message,li.listDates=li.originalDates.slice((page-1)*pageSize,pageSize)})}),result},setResponseBinding:function(responseBindings,item){for(var i=0,il=responseBindings.length;i<il;i++){var v=responseBindings[i],valueToBind=item[v.name]||"",field=api.find(v.value||v.field);field&&!apiInner.isEmptyObject(field)&&field.attr(v.attr,valueToBind)}},getMaxAvailableDate:function(list){var maxDateInd=-1,dateDDMMYYYY="";return list.forEach(function(li,i){li.value&&(maxDateInd=i)}),maxDateInd>-1&&(dateDDMMYYYY=list[maxDateInd].dateLeadingZero+"."+list[maxDateInd].monthLeadingZero+"."+list[maxDateInd].year),dateDDMMYYYY}}}]),angular.module("serverFormWidgets.general").directive("epguFieldUploadFileSign",["TEMPLATES","$rootScope","api","pguBundlesSrv","checkSignStatusSrv","$q",function(TEMPLATES,$rootScope,api,pguBundlesSrv,checkSignStatusSrv,$q){return{templateUrl:TEMPLATES.BUNDLES,replace:!0,scope:{item:"=?"},link:function(scope,element,attrs){pguBundlesSrv.getWidget(scope.item).then(function(){var isAvailable=pguBundlesSrv.showWidget(scope.item,"all"),dfPreloadedFile=$q.defer();if(isAvailable){var panel=scope.item.items[0],map={main:panel.items[0],sign:panel.items[1]};if(panel.title=scope.item.label,map.main.required=map.sign.required=scope.item.required,map.main.notRequiredText=map.sign.notRequiredText=scope.item.notRequiredText,map.main.fileType=scope.item.mainFileType,map.main.fileSize=scope.item.mainFileSize,map.main.label=scope.item.mainFileLabel,map.main.hint=scope.item.mainFileHint,map.sign.fileType=scope.item.signFileType,map.sign.fileSize=scope.item.signFileSize,map.sign.label=scope.item.signFileLabel,map.sign.hint=scope.item.signFileHint,map.sign.countFiles=scope.item.signFileCount,map.sign.minCountFiles=+scope.item.signFileCount,"true"===$rootScope.env.formParam.disabledFileSignUploader)return;if(scope.item.preloadedFile){var elemId=api.getGepsId(scope.item.pathToGEPSId);elemId?(api.getLocalFeedGepsById(elemId),api.localFeedGeps.promise.then(function(response){if(response&&response.localFeedGeps){var mnemonic=api.getMnemonicFromLocalFeedGeps(elemId,response.localFeedGeps);map.main.preloadedFile=!0,map.main.files=[{mnemonic:mnemonic,size:0,name:mnemonic}],map.main.disabled=!0,dfPreloadedFile.resolve()}},function(){dfPreloadedFile.resolve()})):dfPreloadedFile.resolve()}else dfPreloadedFile.resolve();map.main.updateSignData=function(){var signedFiles=getSignedFiles();if(signedFiles&&signedFiles.length){var signedFilesMnemonics=signedFiles.map(function(file){return file.mnemonic});checkSignStatusSrv.updateSignedMnemonics(map.sign.getSignedData(),signedFilesMnemonics,map.sign.fullPath)}},map.sign.getSignedData=function(){return map.main.files&&map.main.files[0]&&map.main.files[0].mnemonic},map.sign.getMainFileTitle=function(){return map.main.label};var getSignedFiles=function(){return map.sign.files||[]},stop=scope.$on(map.sign.fullPath+":ScopeApplied",function(evt,data){map.sign.getSignedData()&&getSignedFiles().length&&dfPreloadedFile.promise.then(function(){checkSignStatusSrv.getCheckSingStatus(map.sign.fullPath)}),stop()})}})}}}]).factory("FieldUploadFileSignExt",["controlAttrs",function(controlAttrs){return{attrs:angular.extend({},controlAttrs.attrs,{handlers:{default:[],"scope:sync":!1,"scope:editor":!1,"scope:model":!1},originalFrom:{"scope:editor":!1,default:"container"},required:{type:"boolean",enum:[!0,!1],enumOptions:{true:"Да",false:"Нет"},default:!0},notRequiredText:{type:"string",default:"необязательно"},label:{type:"string",default:"Подпись"},mainFileType:{type:"string",default:""},mainFileSize:{type:"integer",default:5120},mainFileLabel:{type:"string",default:"Подпись"},mainFileHint:{type:"string",default:""},signFileType:{type:"string",default:"sig"},signFileSize:{type:"integer",default:5120},signFileLabel:{type:"string",default:"Подпись"},signFileHint:{type:"string",default:""},signFileCount:{type:"integer",default:1},preloadedFile:{type:"boolean",default:!1},pathToGEPSId:{type:"string",default:"form.FormStep_service.Panel198.gepsId"},version:{"scope:editor":!1,default:0}})}}]),angular.module("serverFormWidgets.general").directive("epguUploadFileFromDigitalProfile",["TEMPLATES","$rootScope","api","pguBundlesSrv","UFFDPService","apiInner",function(TEMPLATES,$rootScope,api,pguBundlesSrv,UFFDPService,apiInner){return{templateUrl:TEMPLATES.BUNDLES,replace:!0,scope:{item:"=?"},link:function(scope,element,attrs){if(pguBundlesSrv.showWidget(scope.item,"all")){var find=pguBundlesSrv.getFindMethods(scope.item.fullPath),dd=find.element("fileFromDigitalProfile"),checkbox=api.find(scope.item.pathToCheckbox),otherCase=api.find(scope.item.pathToOtherCase),fileTypes=scope.item.fileType.toLowerCase().replace(/[\s\.\*]/g,"").split(","),checkItems=function(items){if(items=items||[],items.length){if(scope.item.pathToOtherCase){var hasFile=UFFDPService.checkOtherCaseHasFile(otherCase.getElement());if(scope.item.pathToCheckbox){var manageOtherCase=function(val,old){val!==old&&otherCase.visible(apiInner.toBoolean(val))};manageOtherCase(checkbox.value()),scope.$watch(function(){return checkbox.value()},manageOtherCase)}else hasFile&&otherCase.visible(hasFile)}}else scope.item.pathToOtherCase?(dd.visible=!1,otherCase.visible(!0),scope.item.pathToCheckbox&&checkbox.visible(!1)):dd.emptyDocsList=!0};$rootScope.isDesigner||UFFDPService.getDocuments(fileTypes).then(function(data){var items=data&&data.items;scope.item.handlers[0]&&api.triggerHandler(scope.item.fullPath,scope.item.fullPath,scope.item.handlers[0],{items:items||[],hasItems:!!items.length}),checkItems(items)}),scope.item.items.forEach(function(it){"FieldDropdownHierarchicMultiple"===it.className&&(it.isDigitalProfileUploader=!0,it.fileTypes=fileTypes,it.doNotShow=!0)})}}}}]).factory("UploadFileFromDigitalProfileExt",["controlAttrs","$rootScope",function(controlAttrs,$rootScope){return{attrs:angular.extend({},controlAttrs.attrs,{handlers:{default:[],"scope:sync":!1,"scope:editor":$rootScope.isAdminUser,"scope:model":!1},originalFrom:{"scope:editor":!1,default:"container"},hasRules:{type:"boolean","scope:editor":!1,default:!0},fileType:{type:"string",default:"","scope:editor":!0},pathToCheckbox:{type:"string",default:"","scope:editor":!0},pathToOtherCase:{type:"string",default:"","scope:editor":!0}})}}]).factory("UFFDPService",["$rootScope","sharedExtServices","$q","LOC","apiInner",function($rootScope,sharedExtServices,$q,LOC,apiInner){var cachedDocs={},stack={},createLink=function(objectId,objectTypeId,mnemonic){return LOC.WIDGET_URI+"api/storage/v1/files/"+objectId+"/"+objectTypeId+"/download?mnemonic="+mnemonic};return{getDocuments:function(fileTypes){var key=fileTypes||"all";return cachedDocs[key]?$q.when({items:cachedDocs[key]}):stack[key]?stack[key].promise:(stack[key]=$q.defer(),sharedExtServices.digitalProfile.getDocuments().then(function(response){cachedDocs[key]=response.data.map(function(doc){return Object.assign({title:doc.fileName,value:doc.mnemonic+"_"+doc.objectId,link:createLink(doc.objectId,doc.objectTypeId,doc.mnemonic),isUploader:!0,hasSign:doc.hasSign},doc)});var result={items:cachedDocs[key]};return stack[key].resolve(result),result},function(){return stack[key].resolve({}),{}}))},attachDocumentsToOrder:function(docs){var mappedDocs=docs.map(function(doc){return{attached:doc.checkbox&&doc.checkbox.checked||!1,mnemonic:doc.mnemonic,objectId:doc.objectId,objectTypeId:doc.objectTypeId}});return sharedExtServices.digitalProfile.attachDocumentsToOrder(mappedDocs,$rootScope.env.orderId)},checkOtherCaseHasFile:function(otherCase){var hasFiles=!1;return apiInner.loopThroughTheTree([otherCase],function(items,item){"FieldUpload"===item.className&&item.files&&item.files.length&&(hasFiles=!0)}),hasFiles}}}]),angular.module("serverFormWidgets.general").directive("epguPreviewGEPSMail",["$rootScope","$sce","TEMPLATES","api","sharedExtServices","$timeout","LOC",function($rootScope,$sce,TEMPLATES,api,sharedExtServices,$timeout,LOC){return{templateUrl:TEMPLATES.PREVIEW_GEPS_MAIL,replace:!0,scope:{item:"="},link:function(scope,element,attrs){function showError(){scope.item.loadError=!0,scope.item.loading=!1}$rootScope.isDesigner&&$rootScope.isAdminUser,scope.generateUrl=LOC.WIDGET_URI+"api/lk/v1/geps/pdf/generate?threadId=",scope.item.loading=!0,scope.isNotification=!scope.item.isSignOfDocs;var elemId="",mnemonic="";elemId=api.getGepsId(scope.item.pathToGEPSId),scope.elemId=elemId,elemId?(scope.item.error=!1,api.getLocalFeedGepsById(elemId),api.localFeedGeps.promise.then(function(response){response&&response.localFeedGeps?(scope.item.message=response.localFeedGeps,scope.item.value=elemId,mnemonic=api.getMnemonicFromLocalFeedGeps(elemId,response.localFeedGeps),scope.storageUrl=LOC.WIDGET_URI+"api/storage/v1/files/"+api.env("orderId")+"/2/"+mnemonic+"/download",scope.item.loading=!1):showError()},function(error){showError()})):showError();var watchers;scope.$on("suspend",function(){watchers=scope.$$watchers,scope.$$watchers=[]}),scope.$on("resume",function(){scope.$$watchers=watchers,watchers=null}),scope.$emit(scope.item.fullPath+":ScopeApplied",{scope:scope,element:element}),scope.item.isScopeAppliedDone={scope:scope,element:element}}}}]).factory("PreviewGEPSMailExt",["$rootScope","fieldAttrs",function($rootScope,fieldAttrs){return{_changedByUser:!1,attrs:angular.extend({},fieldAttrs.attrs,{pathToGEPSId:{type:"string",default:"form.FormStep_service.Panel198.gepsId","scope:editor":$rootScope.isAdminUser},isSignOfDocs:{type:"boolean",default:!1,"scope:editor":$rootScope.isAdminUser}})}}]),angular.module("serverForm").run(["$templateCache",function($templateCache){"use strict";$templateCache.put("js/components/Advice/Advice.html",'<div ng-show=(!!item.visible) class="PGU-Advice PGU-Advice-type-{{item.eventType}}" full-path={{::item.fullPath}}><h3 class="PGU-Service-h3 PGU-Service-h3-advice"><span class=PGU-Advice-icon></span> <span class=PGU-Advice-title ng-bind-html="item.title | to_trusted"></span></h3><div class=PGU-Advice-html ng-bind-html="item.html | to_trusted"></div><div class=PGU-Advice-html-more-info ng-bind-html="item.htmlMoreInfo | to_trusted"></div></div>'),
$templateCache.put("js/components/AutomotiveAxles/AutomotiveAxles.html","<div ng-show=(!!item.visible) id={{::id}} full-path={{::item.fullPath}}><div class=\"PGU-{{::item.className}} PGU-LabelWidth-{{::item.labelWidth}} PGU-Labelalign-{{::item.labelAlign}} {{item.disabled ? 'PGU-Disabled' : ''}} {{item.required ? 'PGU-Required' : ''}} {{item.error ? 'PGU-Error' : ''}}\"><div class=PGU-AutomotiveAxles-Item><h3 class=PGU-Service-h3>Параметры тягача</h3><ul class=PGU-AutomotiveAxles-Item__Trailer-Mass__List><li class=\"PGU-AutomotiveAxles-Item__Trailer-Mass__List-Item flex-container align-items-center\"><div class=PGU-AutomotiveAxles-Item__Trailer-Mass__Input-Wrap><div class=\"PGU-FieldTextInput PGU-FieldBody\" data-ng-class=\"{'PGU-FieldText-Small-Placeholder': (cabListActiveItem.mass || cabListActiveItem.massIsSmall)}\"><label class=\"PGU-FieldLabel PGU-FieldLabel-Input x-label\" for={{::item.fullPath}}-{{cabListActiveItem.mass}}>Масса тягача (тонн)</label> <input class=\"PGU-FieldTextInputBasic x-text\" id={{::item.fullPath}}-{{cabListActiveItem.mass}} data-ng-model=cabListActiveItem.mass data-ng-click=\"onClickInputText('massCab')\" data-ng-blur=\"onBlurInputText('massCab')\"></div></div></li></ul><div full-path={{::item.fullPath}}-truck data-ng-class=\"{\n            'PGU-AutomotiveAxles-Item__Truck' : true,\n            'PGU-AutomotiveAxles-Item__Truck_Active' : activeItemByType === 'truck',\n            'PGU-AutomotiveAxles-Item__Truck_Axle-Only' : !truckListArrows,\n            'PGU-AutomotiveAxles-Item__Truck-Axle_Arrows_Show' : truckListArrows,\n            'PGU-AutomotiveAxles-Item__Truck-Axle_Remove_Show' : truckList.length > 2 && truckListActiveItem && truckListActiveItem.number > 1,\n            'PGU-AutomotiveAxles-Item__Truck-Axle_Add-Truck-Axle_Show' : truckListValid\n            }\"><div class=PGU-AutomotiveAxles-Item__Wrap-Truck-Axle><div class=\"flex-inline-container align-items-end\"><div data-ng-repeat=\"axleItem in truckList track by $index\" data-ng-click=\"onClick_truckListNext(axleItem.number, axleItem.withArrows);\" data-ng-class=\"{\n                        'PGU-AutomotiveAxles-Item__Truck-Axle' : true,\n                        'PGU-AutomotiveAxles-Item__Truck-Axle_IsTruckAxle' : axleItem.isTruckAxle,\n                        'PGU-AutomotiveAxles-Item__Truck-Axle_IsTrailerAxle' : axleItem.isTrailerTruckAxle,\n                        'PGU-AutomotiveAxles-Item__Truck-Axle_IsLastAxle' : axleItem.last,\n                        'PGU-AutomotiveAxles-Item__Truck-Axle_IsLastTruckAxle' : axleItem.lastTruck,\n                        'PGU-AutomotiveAxles-Item__Truck-Axle_Active' : axleItem.isTruckAxleActive,\n                        'PGU-AutomotiveAxles-Item__Truck-Axle_Valid' : axleItem.isTruckAxleValid,\n                        'PGU-AutomotiveAxles-Item__Truck-Axle_Invalid' : axleItem.isTruckAxleInvalid,\n                        'PGU-AutomotiveAxles-Item__Truck-Axle_Distance-Invalid' : axleItem.isDistanceValid,\n                        'PGU-AutomotiveAxles-Item__Truck-Axle_Distance-Valid' : axleItem.isDistanceInvalid\n"+'                     }"><div data-ng-if=axleItem.isCab class=PGU-AutomotiveAxles-Item__Truck-Cab><div class=js-PGU-AutomotiveAxles-Item__AxleIcon_Axle><svg xmlns=http://www.w3.org/2000/svg width=86 height=83 viewBox="0 0 86 83"><g fill=none fill-rule=evenodd><path class=PGU-AutomotiveAxles-Item__Truck-Body__Icon fill=none d="M86,66 L66.2829892,65.9958841 C65.0114898,65.9958841 60.6812865,66.001681 56.1692469,66.0040557 C56.2262237,65.3452567 56.2553029,64.6785202 56.2553029,64.0050227 C56.2553029,51.3022873 45.9109063,43.00063 33.1504463,43.00063 C22.475516,43.00063 13.4914383,50.2072816 10.8399238,59.9998719 C10.7422605,59.9994934 9.80777646,59.9998291 8.03647184,60.0008791 C1.7871315,59.9934359 0,56.1128928 0,52.753928 C0,52.753928 0.0168597311,49.1773905 0.0309095071,40.2360467 C0.0365294175,36.7131573 2.11870621,35.3034055 21.6197952,7.64484888 C23.8761892,4.44384783 28.0855021,0 31.8592719,0 L59.4727016,0 C63.2464714,0 66.3008927,3.24272732 66.3008927,7.24248841 L66.3008927,57.0008644 C66.3008927,58.1054339 67.1963232,59.0008644 68.3008927,59.0008644 L86,59.0008644 L86,66 Z M58.6592196,27.9976811 C60.2552741,27.9976811 61.5478535,26.6058487 61.5478535,24.8909664 L61.5478535,9.10680262 C61.5478535,7.38890109 60.2552741,6.00008791 58.6592196,6.00008791 L39.1778002,6.00008791 L39.1778002,27.9976811 L58.6592196,27.9976811 Z M19.1194545,26.1650515 C19.1194545,27.046646 20.3835571,27.9976811 21.9404281,27.9976811 L33.1504463,27.9976811 L33.1504463,6.00008791 L32.2584605,6.00008791 C30.7015895,6.00008791 28.9641325,7.9051773 28.0365766,9.27889469 C19.9977595,21.1381516 19.0866206,22.7926508 19.0866206,24.5135715 C19.0866206,25.5702772 19.1194545,26.1650515 19.1194545,26.1650515 Z"></path><path class=PGU-AutomotiveAxles-Item__Truck-Axle__Icon fill=none fill-rule=nonzero d="M33,76.1891892 C39.1796186,76.1891892 44.1891892,71.1796186 44.1891892,65 C44.1891892,58.8203814 39.1796186,53.8108108 33,53.8108108 C26.8203814,53.8108108 21.8108108,58.8203814 21.8108108,65 C21.8108108,71.1796186 26.8203814,76.1891892 33,76.1891892 Z M33,83 C23.0588745,83 15,74.9411255 15,65 C15,55.0588745 23.0588745,47 33,47 C42.9411255,47 51,55.0588745 51,65 C51,74.9411255 42.9411255,83 33,83 Z"></path><text class="PGU-AutomotiveAxles-Item__Truck-Body__Icon PGU-AutomotiveAxles-Item__Truck-Axle__Text" fill=none font-family="Helvetica, Arial, sans-serif" font-size=14><tspan data-ng-if="axleItem.wheelType !== \'8\'" x=29.107 y=70>{{axleItem.wheelType}}</tspan><tspan data-ng-if="axleItem.wheelType == \'8\'" x=26.107 y=70>{{axleItem.wheelType}}+</tspan></text></g></svg></div><div class="PGU-AutomotiveAxles-Item__Arrows PGU-AutomotiveAxles-Item__Arrows_Cab flex-container align-items-center"><div data-ng-click="onClick_activeDistance(axleItem, 1)" class="PGU-AutomotiveAxles-Item__Arrow-Item PGU-AutomotiveAxles-Item__Arrow-Item_Left-Long"><svg xmlns=http://www.w3.org/2000/svg width=53 height=15 viewBox="0 0 53 15"><path class=PGU-AutomotiveAxles-Item__Truck-Arrow__Icon fill=none fill-rule=evenodd d="M5.03969493,5.96488205 L53,6 L53,9 L5.03969493,9.03511795 L8.36684417,12.3793897 C8.9632756,12.9788906 8.9632756,13.9508735 8.36684417,14.5503744 C7.77041275,15.1498752 6.80340634,15.1498752 6.20697492,14.5503744 L0.447323569,8.76108204 C0.104601359,8.41659608 -0.041185364,7.94912038 0.00996340009,7.5 C-0.041185364,7.05087962 0.104601359,6.58340392 0.447323569,6.23891796 L6.20697492,0.449625637 C6.80340634,-0.149875212 7.77041275,-0.149875212 8.36684417,0.449625637 C8.9632756,1.04912649 8.9632756,2.02110941 8.36684417,2.62061026 L5.03969493,5.96488205 Z"></path></svg></div><div data-ng-click="onClick_activeDistance(axleItem, -1)" class="PGU-AutomotiveAxles-Item__Arrow-Item PGU-AutomotiveAxles-Item__Arrow-Item_Right-Long"><svg xmlns=http://www.w3.org/2000/svg width=53 height=15 viewBox="0 0 53 15"><path class=PGU-AutomotiveAxles-Item__Truck-Arrow__Icon fill=none fill-rule=evenodd d="M5.03969493,5.96488205 L53,6 L53,9 L5.03969493,9.03511795 L8.36684417,12.3793897 C8.9632756,12.9788906 8.9632756,13.9508735 8.36684417,14.5503744 C7.77041275,15.1498752 6.80340634,15.1498752 6.20697492,14.5503744 L0.447323569,8.76108204 C0.104601359,8.41659608 -0.041185364,7.94912038 0.00996340009,7.5 C-0.041185364,7.05087962 0.104601359,6.58340392 0.447323569,6.23891796 L6.20697492,0.449625637 C6.80340634,-0.149875212 7.77041275,-0.149875212 8.36684417,0.449625637 C8.9632756,1.04912649 8.9632756,2.02110941 8.36684417,2.62061026 L5.03969493,5.96488205 Z"></path></svg></div><div class=PGU-AutomotiveAxles-Item__Arrow-Line></div></div></div><div data-ng-if=!axleItem.isCab><div class="PGU-AutomotiveAxles-Item__Axle flex-container align-items-top"><div class="PGU-AutomotiveAxles-Item__AxleIcon PGU-AutomotiveAxles-Item__AxleIcon_Connector"><svg xmlns=http://www.w3.org/2000/svg width=22 height=93 viewBox="0 0 22 93"><polygon class=PGU-AutomotiveAxles-Item__Truck-Body__Icon fill=none fill-rule=evenodd points="14 87 14 0 22 0 22 93 0 93 0 87"></polygon></svg></div><div class="PGU-AutomotiveAxles-Item__AxleIcon PGU-AutomotiveAxles-Item__AxleIcon_Axle js-PGU-AutomotiveAxles-Item__AxleIcon_Axle"><svg xmlns=http://www.w3.org/2000/svg width=54 height=109 viewBox="0 0 54 109"><g fill=none fill-rule=evenodd><path class=PGU-AutomotiveAxles-Item__Truck-Axle__Icon fill=none fill-rule=nonzero d="M27,102.189189 C33.1796186,102.189189 38.1891892,97.1796186 38.1891892,91 C38.1891892,84.8203814 33.1796186,79.8108108 27,79.8108108 C20.8203814,79.8108108 15.8108108,84.8203814 15.8108108,91 C15.8108108,97.1796186 20.8203814,102.189189 27,102.189189 Z M27,109 C17.0588745,109 9,100.941125 9,91 C9,81.0588745 17.0588745,73 27,73 C36.9411255,73 45,81.0588745 45,91 C45,100.941125 36.9411255,109 27,109 Z"></path><text class="PGU-AutomotiveAxles-Item__Truck-Body__Icon PGU-AutomotiveAxles-Item__Truck-Axle__Text" fill=none font-family="Helvetica, Arial, sans-serif" font-size=14><tspan data-ng-if="axleItem.wheelType !== \'8\'" x=23.019 y=96>{{axleItem.wheelType}}</tspan><tspan data-ng-if="axleItem.wheelType == \'8\'" x=19.019 y=96>{{axleItem.wheelType}}+</tspan></text><path class=PGU-AutomotiveAxles-Item__Truck-Body__Icon fill=none d="M49,91.9934657 C48.983426,91.4944406 49,90.9910005 49,90.9869313 C49,77.9760588 40,68.8431756 27,68.8431756 C14,68.8431756 5,77.9760588 5,90.9869313 C5,90.9910005 5.01657403,91.4944406 5,91.9934657 L0,91.9934657 L0,0 L54,0 L54,91.9934657 L49,91.9934657 Z"></path></g></svg></div><div class="PGU-AutomotiveAxles-Item__AxleIcon PGU-AutomotiveAxles-Item__AxleIcon_AxleTruck"><div class="PGU-AutomotiveAxles-Item__AxleIcon PGU-AutomotiveAxles-Item__AxleIcon_SemiLong"><svg xmlns=http://www.w3.org/2000/svg width=108 height=62 viewBox="0 0 108 62"><path class=PGU-AutomotiveAxles-Item__Truck-Body__Icon fill=none fill-rule=evenodd d="M108,3.99642766 C108,1.78926161 106.215566,-7.10542736e-15 103.995819,-7.10542736e-15 L0,-7.10542736e-15 L0,62 L103.995819,62 C106.207267,62 108,60.2113247 108,58.0035723 L108,3.99642766 Z" transform="matrix(-1 0 0 1 108 0)"></path></svg></div><div class="PGU-AutomotiveAxles-Item__AxleIcon PGU-AutomotiveAxles-Item__AxleIcon_Semi"><svg xmlns=http://www.w3.org/2000/svg width=54 height=62 viewBox="0 0 54 62"><path class=PGU-AutomotiveAxles-Item__Truck-Body__Icon fill=none fill-rule=evenodd d="M54,3.99642766 C54,1.78926161 52.2033234,-1.42108547e-14 50.0073214,-1.42108547e-14 L0,-1.42108547e-14 L0,62 L50.0073214,62 C52.2124169,62 54,60.2113247 54,58.0035723 L54,3.99642766 Z" transform="matrix(-1 0 0 1 54 0)"></path></svg></div><div class="PGU-AutomotiveAxles-Item__AxleIcon PGU-AutomotiveAxles-Item__AxleIcon_SemiSquare"><svg xmlns=http://www.w3.org/2000/svg width=54 height=62 viewBox="0 0 54 62"><rect class=PGU-AutomotiveAxles-Item__Truck-Body__Icon width=54 height=62 fill=none></rect></svg></div><div class="PGU-AutomotiveAxles-Item__AxleIcon PGU-AutomotiveAxles-Item__AxleIcon_Wheel js-PGU-AutomotiveAxles-Item__AxleIcon_Axle"><svg xmlns=http://www.w3.org/2000/svg width=54 height=45 viewBox="0 0 54 45"><g fill=none fill-rule=evenodd><path class=PGU-AutomotiveAxles-Item__Truck-Body__Icon fill=none d="M49,26 C49,13.8497355 39.1502645,4 27,4 C14.8497355,4 5,13.8497355 5,26 C5,26.672456 5.03017038,27.3378652 5,28 L0,28 C0.0544507576,25.3664063 0.0544507576,22.3664063 0,19 L0,12.6568542 C-1.2991861e-16,11.5959883 0.421427361,10.5785726 1.17157288,9.82842712 L9.82842712,1.17157288 C10.5785726,0.421427361 11.5959883,3.03929442e-14 12.6568542,3.01980663e-14 L43.1044835,3.01980663e-14 C44.304216,3.2108832e-14 45.4405967,0.538507107 46.2003127,1.46704884 L53.0958292,9.89490235 C53.6805416,10.6095509 54,11.5044841 54,12.4278535 L54,28 L49,28 C48.9697014,27.34069 49,26.6738833 49,26 Z"></path><path class=PGU-AutomotiveAxles-Item__Truck-Axle__Icon fill=none fill-rule=nonzero d="M27,38.1891892 C33.1796186,38.1891892 38.1891892,33.1796186 38.1891892,27 C38.1891892,20.8203814 33.1796186,15.8108108 27,15.8108108 C20.8203814,15.8108108 15.8108108,20.8203814 15.8108108,27 C15.8108108,33.1796186 20.8203814,38.1891892 27,38.1891892 Z M27,45 C17.0588745,45 9,36.9411255 9,27 C9,17.0588745 17.0588745,9 27,9 C36.9411255,9 45,17.0588745 45,27 C45,36.9411255 36.9411255,45 27,45 Z"></path><text class="PGU-AutomotiveAxles-Item__Truck-Body__Icon PGU-AutomotiveAxles-Item__Truck-Axle__Text" fill=none font-family="Helvetica, Arial, sans-serif" font-size=14><tspan data-ng-if="axleItem.wheelType !== \'8\'" x=23.019 y=32>{{axleItem.wheelType}}</tspan><tspan data-ng-if="axleItem.wheelType == \'8\'" x=19.019 y=32>{{axleItem.wheelType}}+</tspan></text></g></svg></div></div><div class="PGU-AutomotiveAxles-Item__AxleIcon PGU-AutomotiveAxles-Item__AxleIcon_Middle"><svg xmlns=http://www.w3.org/2000/svg width=54 height=92 viewBox="0 0 54 92"><polygon class=PGU-AutomotiveAxles-Item__Truck-Body__Icon fill=none fill-rule=evenodd points="0 92 0 82.093 0 0 54 0 54 92"></polygon></svg></div><div class="PGU-AutomotiveAxles-Item__AxleIcon PGU-AutomotiveAxles-Item__AxleIcon_Middle"><svg xmlns=http://www.w3.org/2000/svg width=54 height=92 viewBox="0 0 54 92"><polygon class=PGU-AutomotiveAxles-Item__Truck-Body__Icon fill=none fill-rule=evenodd points="0 92 0 82.093 0 0 54 0 54 92"></polygon></svg></div><div class="PGU-AutomotiveAxles-Item__AxleIcon PGU-AutomotiveAxles-Item__AxleIcon-Back"><svg xmlns=http://www.w3.org/2000/svg width=8 height=92 viewBox="0 0 8 92"><path class=PGU-AutomotiveAxles-Item__Truck-Body__Icon fill=none fill-rule=evenodd d="M0,92 L0,0 L-1.46957616e-15,0 C4.418278,-8.11624501e-16 8,3.581722 8,8 L8,84 C8,88.418278 4.418278,92 4.8985872e-16,92 Z"></path></svg></div></div><div class="PGU-AutomotiveAxles-Item__Arrows flex-container align-items-center"><div data-ng-click="onClick_activeDistance(axleItem, -1)" class="PGU-AutomotiveAxles-Item__Arrow-Item PGU-AutomotiveAxles-Item__Arrow-Item_Right"><svg xmlns=http://www.w3.org/2000/svg width=27 height=15 viewBox="0 0 27 15"><path class=PGU-AutomotiveAxles-Item__Truck-Arrow__Icon fill=none fill-rule=evenodd d="M5.03969493,5.96488205 L27,6 L27,9 L5.03969493,9.03511795 L8.36684417,12.3793897 C8.9632756,12.9788906 8.9632756,13.9508735 8.36684417,14.5503744 C7.77041275,15.1498752 6.80340634,15.1498752 6.20697492,14.5503744 L0.447323569,8.76108204 C0.104601359,8.41659608 -0.041185364,7.94912038 0.00996340009,7.5 C-0.041185364,7.05087962 0.104601359,6.58340392 0.447323569,6.23891796 L6.20697492,0.449625637 C6.80340634,-0.149875212 7.77041275,-0.149875212 8.36684417,0.449625637 C8.9632756,1.04912649 8.9632756,2.02110941 8.36684417,2.62061026 L5.03969493,5.96488205 Z" transform="matrix(-1 0 0 1 27 0)"></path></svg></div><div data-ng-click="onClick_activeDistance(axleItem, -1)" class="PGU-AutomotiveAxles-Item__Arrow-Item PGU-AutomotiveAxles-Item__Arrow-Item_Right-Long"><svg xmlns=http://www.w3.org/2000/svg width=53 height=15 viewBox="0 0 53 15"><path class=PGU-AutomotiveAxles-Item__Truck-Arrow__Icon fill=none fill-rule=evenodd d="M5.03969493,5.96488205 L53,6 L53,9 L5.03969493,9.03511795 L8.36684417,12.3793897 C8.9632756,12.9788906 8.9632756,13.9508735 8.36684417,14.5503744 C7.77041275,15.1498752 6.80340634,15.1498752 6.20697492,14.5503744 L0.447323569,8.76108204 C0.104601359,8.41659608 -0.041185364,7.94912038 0.00996340009,7.5 C-0.041185364,7.05087962 0.104601359,6.58340392 0.447323569,6.23891796 L6.20697492,0.449625637 C6.80340634,-0.149875212 7.77041275,-0.149875212 8.36684417,0.449625637 C8.9632756,1.04912649 8.9632756,2.02110941 8.36684417,2.62061026 L5.03969493,5.96488205 Z" transform="matrix(-1 0 0 1 53 0)"></path></svg></div><div data-ng-click="onClick_activeDistance(axleItem, 1)" class="PGU-AutomotiveAxles-Item__Arrow-Item PGU-AutomotiveAxles-Item__Arrow-Item_Left"><svg xmlns=http://www.w3.org/2000/svg width=27 height=15 viewBox="0 0 27 15"><path class=PGU-AutomotiveAxles-Item__Truck-Arrow__Icon fill=none fill-rule=evenodd d="M5.03969493,5.96488205 L27,6 L27,9 L5.03969493,9.03511795 L8.36684417,12.3793897 C8.9632756,12.9788906 8.9632756,13.9508735 8.36684417,14.5503744 C7.77041275,15.1498752 6.80340634,15.1498752 6.20697492,14.5503744 L0.447323569,8.76108204 C0.104601359,8.41659608 -0.041185364,7.94912038 0.00996340009,7.5 C-0.041185364,7.05087962 0.104601359,6.58340392 0.447323569,6.23891796 L6.20697492,0.449625637 C6.80340634,-0.149875212 7.77041275,-0.149875212 8.36684417,0.449625637 C8.9632756,1.04912649 8.9632756,2.02110941 8.36684417,2.62061026 L5.03969493,5.96488205 Z"></path></svg></div><div data-ng-click="onClick_activeDistance(axleItem, 1)" class="PGU-AutomotiveAxles-Item__Arrow-Item PGU-AutomotiveAxles-Item__Arrow-Item_Left-Long"><svg xmlns=http://www.w3.org/2000/svg width=53 height=15 viewBox="0 0 53 15"><path class=PGU-AutomotiveAxles-Item__Truck-Arrow__Icon fill=none fill-rule=evenodd d="M5.03969493,5.96488205 L53,6 L53,9 L5.03969493,9.03511795 L8.36684417,12.3793897 C8.9632756,12.9788906 8.9632756,13.9508735 8.36684417,14.5503744 C7.77041275,15.1498752 6.80340634,15.1498752 6.20697492,14.5503744 L0.447323569,8.76108204 C0.104601359,8.41659608 -0.041185364,7.94912038 0.00996340009,7.5 C-0.041185364,7.05087962 0.104601359,6.58340392 0.447323569,6.23891796 L6.20697492,0.449625637 C6.80340634,-0.149875212 7.77041275,-0.149875212 8.36684417,0.449625637 C8.9632756,1.04912649 8.9632756,2.02110941 8.36684417,2.62061026 L5.03969493,5.96488205 Z"></path></svg></div><div class=PGU-AutomotiveAxles-Item__Arrow-Line></div></div></div></div></div></div><div class="PGU-AutomotiveAxles-Item__Add-Truck-Axle flex-container align-items-center"><div><a data-ng-href="" class="PGU-Button PGU-Btn-Base PGU-Btn-White" data-ng-click=addTruckAxle()>Добавить ось тягача</a></div></div><div class=PGU-AutomotiveAxles-Item__Data><div class=PGU-AutomotiveAxles-Item__Data__Arrow></div><h3 class=PGU-Service-H3>{{truckListActiveItem.humanityNumber}}</h3><div class="PGU-FieldTextInput PGU-FieldText PGU-FieldBody" data-ng-class="{\n                \'PGU-FieldText-Small-Placeholder\': (truckListActiveItem.load || truckListActiveItem.loadIsSmall),\n                \'PGU-Error\' : truckListActiveItem.error && truckListActiveItem.error.text\n                }"><label class="PGU-FieldLabel PGU-FieldLabel-Input x-label" for={{::item.fullPath}}-loadTruck>Нагрузка на ось (тонн)</label> <input class="PGU-FieldTextInputBasic x-text load" id={{::item.fullPath}}-loadTruck data-ng-model=truckListActiveItem.load data-ng-change="truckListActiveItem.error = \'\'" data-ng-click="onClickInputText(\'loadTruck\')" data-ng-blur="onBlurInputText(\'loadTruck\')"><pgu-error-hint class=PGU-ErrorHint model=truckListActiveItem></pgu-error-hint></div><ul class=PGU-AutomotiveAxles-Item__Data__Radio-List><li data-ng-show="truckListActiveItem[\'need\' + radio.value + \'Wheel\']" data-ng-repeat="radio in item.radioList" class=PGU-AutomotiveAxles-Item__Data__Radio-Item><div class=flex-container><div class=PGU-AutomotiveAxles-Item__Data__Radio__Icon data-ng-class="{\n                                        \'PGU-AutomotiveAxles-Item__Data__Radio__Icon\': true,\n                                        \'PGU-AutomotiveAxles-Item__Data__Radio__Icon_Active\': truckListActiveItem.wheelType == radio.value\n                                        }" data-ng-click=onClick_countWheel(radio.value)></div><div class=PGU-AutomotiveAxles-Item__Data__Radio__Label data-ng-click="onClick_countWheel(radio.value, \'truck\')">{{radio.label}}</div></div></li></ul><div class="PGU-AutomotiveAxles-Item__Data__Actions flex-container align-items-center"><div><a data-ng-href="" data-ng-click=removeTruckAxle() class="PGU-Button PGU-Btn-Base PGU-Btn-White PGU-Btn-Base-mode-link PGU-Button-Axle-Remove">Удалить ось</a></div><div><a data-ng-href="" class="PGU-Button PGU-Btn-Base PGU-Btn-Blue" data-ng-click=onClick_truckListNext()>Далее</a></div></div></div></div><div full-path={{::item.fullPath}}-trailer data-ng-class="{\n            \'PGU-AutomotiveAxles-Item__Truck\' : true,\n            \'PGU-AutomotiveAxles-Item__Truck_Active\' : activeItemByType === \'trailer\',\n            \'PGU-AutomotiveAxles-Item__Truck-Axle_Arrows_Show\' : truckTrailerArrows,\n            \'PGU-AutomotiveAxles-Item__Truck-Axle_List_Show\' : trailerList.length,\n            \'PGU-AutomotiveAxles-Item__Truck_Axle-Only\' : !trailerList.length || !firstSemiTrailer,\n            \'PGU-AutomotiveAxles-Item__Truck-Axle_Remove_Show\' : trailerListActiveItem && trailerListActiveItem.willRemoveFromTrailer,\n            \'PGU-AutomotiveAxles-Item__Trailer-Action_Item-Data_Show\' : truckListValid && !trailerListValid && trailerList.length,\n            \'PGU-AutomotiveAxles-Item__Trailer-Action_Add-Axle_Show\' : truckListValid && trailerListValid && trailerList.length,\n            \'PGU-AutomotiveAxles-Item__Trailer-Action_Add-Trailer_Hide\' : !truckListValid || (truckListValid && !trailerListValid && trailerList.length)\n            }"><h3 class=PGU-Service-h3>Параметры всех прицепов (полуприцепов)</h3><div class=PGU-AutomotiveAxles-Item__Wrap-Truck-Axle><div class="flex-inline-container align-items-end"><div data-ng-repeat="axleItem in distanceAxleList track by $index" data-ng-click="onClick_truckListNext(axleItem.number, \'trailer\');" data-ng-class="{\n                        \'PGU-AutomotiveAxles-Item__Truck-Axle\' : true,\n                        \'PGU-AutomotiveAxles-Item__Truck-Axle_IsTruckAxle\' : axleItem.isTruckAxle,\n                        \'PGU-AutomotiveAxles-Item__Truck-Axle_IsFirstTruckAxleWithSemi\' : axleItem.isTruckFirstWithSemi,\n                        \'PGU-AutomotiveAxles-Item__Truck-Axle_IsTrailerAxle\' : axleItem.isTrailerTruckAxle,\n                        \'PGU-AutomotiveAxles-Item__Truck-Axle_IsLastAxle\' : axleItem.last,\n                        \'PGU-AutomotiveAxles-Item__Truck-Axle_IsLastTruckAxle\' : axleItem.lastTruck,\n                        \'PGU-AutomotiveAxles-Item__Truck-Axle_Active\' : axleItem.isTruckAxleActive,\n                        \'PGU-AutomotiveAxles-Item__Truck-Axle_Valid\' : axleItem.isTruckAxleValid,\n                        \'PGU-AutomotiveAxles-Item__Truck-Axle_Invalid\' : axleItem.isTruckAxleInvalid,\n                        \'PGU-AutomotiveAxles-Item__Truck-Axle_Distance_Active_Left\' : axleItem.isDistanceAxleActiveLeft,\n                        \'PGU-AutomotiveAxles-Item__Truck-Axle_Distance_Active_Right\' : axleItem.isDistanceAxleActiveRight,\n                        \'PGU-AutomotiveAxles-Item__Truck-Axle_Distance-Invalid\' : axleItem.isDistanceValid,\n                        \'PGU-AutomotiveAxles-Item__Truck-Axle_Distance-Valid\' : axleItem.isDistanceInvalid\n                     }"><div data-ng-if=axleItem.isCab class=PGU-AutomotiveAxles-Item__Truck-Cab><div class=js-PGU-AutomotiveAxles-Item__AxleIcon_Axle><svg xmlns=http://www.w3.org/2000/svg width=86 height=83 viewBox="0 0 86 83"><g fill=none fill-rule=evenodd><path class=PGU-AutomotiveAxles-Item__Truck-Body__Icon fill=none d="M86,66 L66.2829892,65.9958841 C65.0114898,65.9958841 60.6812865,66.001681 56.1692469,66.0040557 C56.2262237,65.3452567 56.2553029,64.6785202 56.2553029,64.0050227 C56.2553029,51.3022873 45.9109063,43.00063 33.1504463,43.00063 C22.475516,43.00063 13.4914383,50.2072816 10.8399238,59.9998719 C10.7422605,59.9994934 9.80777646,59.9998291 8.03647184,60.0008791 C1.7871315,59.9934359 0,56.1128928 0,52.753928 C0,52.753928 0.0168597311,49.1773905 0.0309095071,40.2360467 C0.0365294175,36.7131573 2.11870621,35.3034055 21.6197952,7.64484888 C23.8761892,4.44384783 28.0855021,0 31.8592719,0 L59.4727016,0 C63.2464714,0 66.3008927,3.24272732 66.3008927,7.24248841 L66.3008927,57.0008644 C66.3008927,58.1054339 67.1963232,59.0008644 68.3008927,59.0008644 L86,59.0008644 L86,66 Z M58.6592196,27.9976811 C60.2552741,27.9976811 61.5478535,26.6058487 61.5478535,24.8909664 L61.5478535,9.10680262 C61.5478535,7.38890109 60.2552741,6.00008791 58.6592196,6.00008791 L39.1778002,6.00008791 L39.1778002,27.9976811 L58.6592196,27.9976811 Z M19.1194545,26.1650515 C19.1194545,27.046646 20.3835571,27.9976811 21.9404281,27.9976811 L33.1504463,27.9976811 L33.1504463,6.00008791 L32.2584605,6.00008791 C30.7015895,6.00008791 28.9641325,7.9051773 28.0365766,9.27889469 C19.9977595,21.1381516 19.0866206,22.7926508 19.0866206,24.5135715 C19.0866206,25.5702772 19.1194545,26.1650515 19.1194545,26.1650515 Z"></path><path class=PGU-AutomotiveAxles-Item__Truck-Axle__Icon fill=none fill-rule=nonzero d="M33,76.1891892 C39.1796186,76.1891892 44.1891892,71.1796186 44.1891892,65 C44.1891892,58.8203814 39.1796186,53.8108108 33,53.8108108 C26.8203814,53.8108108 21.8108108,58.8203814 21.8108108,65 C21.8108108,71.1796186 26.8203814,76.1891892 33,76.1891892 Z M33,83 C23.0588745,83 15,74.9411255 15,65 C15,55.0588745 23.0588745,47 33,47 C42.9411255,47 51,55.0588745 51,65 C51,74.9411255 42.9411255,83 33,83 Z"></path><text class="PGU-AutomotiveAxles-Item__Truck-Axle__Icon PGU-AutomotiveAxles-Item__Truck-Axle__Text" fill=none font-family="Helvetica, Arial, sans-serif" font-size=14><tspan data-ng-if="axleItem.wheelType !== \'8\'" x=29.107 y=70>{{axleItem.wheelType}}</tspan><tspan data-ng-if="axleItem.wheelType == \'8\'" x=26.107 y=70>{{axleItem.wheelType}}+</tspan></text></g></svg></div><div class="PGU-AutomotiveAxles-Item__Arrows PGU-AutomotiveAxles-Item__Arrows_Cab flex-container align-items-center"><div data-ng-click="onClick_activeDistance(axleItem, 1)" class="PGU-AutomotiveAxles-Item__Arrow-Item PGU-AutomotiveAxles-Item__Arrow-Item_Left-Long"><svg xmlns=http://www.w3.org/2000/svg width=53 height=15 viewBox="0 0 53 15"><path class=PGU-AutomotiveAxles-Item__Truck-Arrow__Icon fill=none fill-rule=evenodd d="M5.03969493,5.96488205 L53,6 L53,9 L5.03969493,9.03511795 L8.36684417,12.3793897 C8.9632756,12.9788906 8.9632756,13.9508735 8.36684417,14.5503744 C7.77041275,15.1498752 6.80340634,15.1498752 6.20697492,14.5503744 L0.447323569,8.76108204 C0.104601359,8.41659608 -0.041185364,7.94912038 0.00996340009,7.5 C-0.041185364,7.05087962 0.104601359,6.58340392 0.447323569,6.23891796 L6.20697492,0.449625637 C6.80340634,-0.149875212 7.77041275,-0.149875212 8.36684417,0.449625637 C8.9632756,1.04912649 8.9632756,2.02110941 8.36684417,2.62061026 L5.03969493,5.96488205 Z"></path></svg></div><div data-ng-click="onClick_activeDistance(axleItem, -1)" class="PGU-AutomotiveAxles-Item__Arrow-Item PGU-AutomotiveAxles-Item__Arrow-Item_Right-Long"><svg xmlns=http://www.w3.org/2000/svg width=53 height=15 viewBox="0 0 53 15"><path class=PGU-AutomotiveAxles-Item__Truck-Arrow__Icon fill=none fill-rule=evenodd d="M5.03969493,5.96488205 L53,6 L53,9 L5.03969493,9.03511795 L8.36684417,12.3793897 C8.9632756,12.9788906 8.9632756,13.9508735 8.36684417,14.5503744 C7.77041275,15.1498752 6.80340634,15.1498752 6.20697492,14.5503744 L0.447323569,8.76108204 C0.104601359,8.41659608 -0.041185364,7.94912038 0.00996340009,7.5 C-0.041185364,7.05087962 0.104601359,6.58340392 0.447323569,6.23891796 L6.20697492,0.449625637 C6.80340634,-0.149875212 7.77041275,-0.149875212 8.36684417,0.449625637 C8.9632756,1.04912649 8.9632756,2.02110941 8.36684417,2.62061026 L5.03969493,5.96488205 Z"></path></svg></div><div class=PGU-AutomotiveAxles-Item__Arrow-Line></div></div></div><div data-ng-if=!axleItem.isCab><div class="PGU-AutomotiveAxles-Item__Axle flex-container align-items-top"><div class="PGU-AutomotiveAxles-Item__AxleIcon PGU-AutomotiveAxles-Item__AxleIcon_Connector"><svg xmlns=http://www.w3.org/2000/svg width=22 height=93 viewBox="0 0 22 93"><polygon class=PGU-AutomotiveAxles-Item__Truck-Body__Icon fill=none fill-rule=evenodd points="14 87 14 0 22 0 22 93 0 93 0 87"></polygon></svg></div><div class="PGU-AutomotiveAxles-Item__AxleIcon PGU-AutomotiveAxles-Item__AxleIcon_Axle js-PGU-AutomotiveAxles-Item__AxleIcon_Axle"><svg xmlns=http://www.w3.org/2000/svg width=54 height=109 viewBox="0 0 54 109"><g fill=none fill-rule=evenodd><path class=PGU-AutomotiveAxles-Item__Truck-Axle__Icon fill=none fill-rule=nonzero d="M27,102.189189 C33.1796186,102.189189 38.1891892,97.1796186 38.1891892,91 C38.1891892,84.8203814 33.1796186,79.8108108 27,79.8108108 C20.8203814,79.8108108 15.8108108,84.8203814 15.8108108,91 C15.8108108,97.1796186 20.8203814,102.189189 27,102.189189 Z M27,109 C17.0588745,109 9,100.941125 9,91 C9,81.0588745 17.0588745,73 27,73 C36.9411255,73 45,81.0588745 45,91 C45,100.941125 36.9411255,109 27,109 Z"></path><text class="PGU-AutomotiveAxles-Item__Truck-Axle__Icon PGU-AutomotiveAxles-Item__Truck-Axle__Text" fill=none font-family="Helvetica, Arial, sans-serif" font-size=14><tspan data-ng-if="axleItem.wheelType !== \'8\'" x=23.019 y=96>{{axleItem.wheelType}}</tspan><tspan data-ng-if="axleItem.wheelType == \'8\'" x=19.019 y=96>{{axleItem.wheelType}}+</tspan></text><path class=PGU-AutomotiveAxles-Item__Truck-Body__Icon fill=none d="M49,91.9934657 C48.983426,91.4944406 49,90.9910005 49,90.9869313 C49,77.9760588 40,68.8431756 27,68.8431756 C14,68.8431756 5,77.9760588 5,90.9869313 C5,90.9910005 5.01657403,91.4944406 5,91.9934657 L0,91.9934657 L0,0 L54,0 L54,91.9934657 L49,91.9934657 Z"></path></g></svg></div><div class="PGU-AutomotiveAxles-Item__AxleIcon PGU-AutomotiveAxles-Item__AxleIcon_AxleTruck"><div class="PGU-AutomotiveAxles-Item__AxleIcon PGU-AutomotiveAxles-Item__AxleIcon_SemiLong"><svg xmlns=http://www.w3.org/2000/svg width=108 height=62 viewBox="0 0 108 62"><path class=PGU-AutomotiveAxles-Item__Truck-Body__Icon fill=none fill-rule=evenodd d="M108,3.99642766 C108,1.78926161 106.215566,-7.10542736e-15 103.995819,-7.10542736e-15 L0,-7.10542736e-15 L0,62 L103.995819,62 C106.207267,62 108,60.2113247 108,58.0035723 L108,3.99642766 Z" transform="matrix(-1 0 0 1 108 0)"></path></svg></div><div class="PGU-AutomotiveAxles-Item__AxleIcon PGU-AutomotiveAxles-Item__AxleIcon_Semi"><svg xmlns=http://www.w3.org/2000/svg width=54 height=62 viewBox="0 0 54 62"><path class=PGU-AutomotiveAxles-Item__Truck-Body__Icon fill=none fill-rule=evenodd d="M54,3.99642766 C54,1.78926161 52.2033234,-1.42108547e-14 50.0073214,-1.42108547e-14 L0,-1.42108547e-14 L0,62 L50.0073214,62 C52.2124169,62 54,60.2113247 54,58.0035723 L54,3.99642766 Z" transform="matrix(-1 0 0 1 54 0)"></path></svg></div><div class="PGU-AutomotiveAxles-Item__AxleIcon PGU-AutomotiveAxles-Item__AxleIcon_SemiSquare"><svg xmlns=http://www.w3.org/2000/svg width=54 height=62 viewBox="0 0 54 62"><rect class=PGU-AutomotiveAxles-Item__Truck-Body__Icon width=54 height=62 fill=none></rect></svg></div><div class="PGU-AutomotiveAxles-Item__AxleIcon PGU-AutomotiveAxles-Item__AxleIcon_Wheel js-PGU-AutomotiveAxles-Item__AxleIcon_Axle"><svg xmlns=http://www.w3.org/2000/svg width=54 height=45 viewBox="0 0 54 45"><g fill=none fill-rule=evenodd><path class=PGU-AutomotiveAxles-Item__Truck-Body__Icon fill=none d="M49,26 C49,13.8497355 39.1502645,4 27,4 C14.8497355,4 5,13.8497355 5,26 C5,26.672456 5.03017038,27.3378652 5,28 L0,28 C0.0544507576,25.3664063 0.0544507576,22.3664063 0,19 L0,12.6568542 C-1.2991861e-16,11.5959883 0.421427361,10.5785726 1.17157288,9.82842712 L9.82842712,1.17157288 C10.5785726,0.421427361 11.5959883,3.03929442e-14 12.6568542,3.01980663e-14 L43.1044835,3.01980663e-14 C44.304216,3.2108832e-14 45.4405967,0.538507107 46.2003127,1.46704884 L53.0958292,9.89490235 C53.6805416,10.6095509 54,11.5044841 54,12.4278535 L54,28 L49,28 C48.9697014,27.34069 49,26.6738833 49,26 Z"></path><path class=PGU-AutomotiveAxles-Item__Truck-Axle__Icon fill=none fill-rule=nonzero d="M27,38.1891892 C33.1796186,38.1891892 38.1891892,33.1796186 38.1891892,27 C38.1891892,20.8203814 33.1796186,15.8108108 27,15.8108108 C20.8203814,15.8108108 15.8108108,20.8203814 15.8108108,27 C15.8108108,33.1796186 20.8203814,38.1891892 27,38.1891892 Z M27,45 C17.0588745,45 9,36.9411255 9,27 C9,17.0588745 17.0588745,9 27,9 C36.9411255,9 45,17.0588745 45,27 C45,36.9411255 36.9411255,45 27,45 Z"></path><text class="PGU-AutomotiveAxles-Item__Truck-Axle__Icon PGU-AutomotiveAxles-Item__Truck-Axle__Text" fill=none font-family="Helvetica, Arial, sans-serif" font-size=14><tspan data-ng-if="axleItem.wheelType !== \'8\'" x=23.019 y=32>{{axleItem.wheelType}}</tspan><tspan data-ng-if="axleItem.wheelType == \'8\'" x=19.019 y=32>{{axleItem.wheelType}}+</tspan></text></g></svg></div></div><div class="PGU-AutomotiveAxles-Item__AxleIcon PGU-AutomotiveAxles-Item__AxleIcon_Middle"><svg xmlns=http://www.w3.org/2000/svg width=54 height=92 viewBox="0 0 54 92"><polygon class=PGU-AutomotiveAxles-Item__Truck-Body__Icon fill=none fill-rule=evenodd points="0 92 0 82.093 0 0 54 0 54 92"></polygon></svg></div><div class="PGU-AutomotiveAxles-Item__AxleIcon PGU-AutomotiveAxles-Item__AxleIcon_Middle"><svg xmlns=http://www.w3.org/2000/svg width=54 height=92 viewBox="0 0 54 92"><polygon class=PGU-AutomotiveAxles-Item__Truck-Body__Icon fill=none fill-rule=evenodd points="0 92 0 82.093 0 0 54 0 54 92"></polygon></svg></div><div class="PGU-AutomotiveAxles-Item__AxleIcon PGU-AutomotiveAxles-Item__AxleIcon-Back"><svg xmlns=http://www.w3.org/2000/svg width=8 height=92 viewBox="0 0 8 92"><path class=PGU-AutomotiveAxles-Item__Truck-Body__Icon fill=none fill-rule=evenodd d="M0,92 L0,0 L-1.46957616e-15,0 C4.418278,-8.11624501e-16 8,3.581722 8,8 L8,84 C8,88.418278 4.418278,92 4.8985872e-16,92 Z"></path></svg></div></div><div class="PGU-AutomotiveAxles-Item__Arrows flex-container align-items-center"><div data-ng-click="onClick_activeDistance(axleItem, -1)" class="PGU-AutomotiveAxles-Item__Arrow-Item PGU-AutomotiveAxles-Item__Arrow-Item_Right"><svg xmlns=http://www.w3.org/2000/svg width=27 height=15 viewBox="0 0 27 15"><path class=PGU-AutomotiveAxles-Item__Truck-Arrow__Icon fill=none fill-rule=evenodd d="M5.03969493,5.96488205 L27,6 L27,9 L5.03969493,9.03511795 L8.36684417,12.3793897 C8.9632756,12.9788906 8.9632756,13.9508735 8.36684417,14.5503744 C7.77041275,15.1498752 6.80340634,15.1498752 6.20697492,14.5503744 L0.447323569,8.76108204 C0.104601359,8.41659608 -0.041185364,7.94912038 0.00996340009,7.5 C-0.041185364,7.05087962 0.104601359,6.58340392 0.447323569,6.23891796 L6.20697492,0.449625637 C6.80340634,-0.149875212 7.77041275,-0.149875212 8.36684417,0.449625637 C8.9632756,1.04912649 8.9632756,2.02110941 8.36684417,2.62061026 L5.03969493,5.96488205 Z" transform="matrix(-1 0 0 1 27 0)"></path></svg></div><div data-ng-click="onClick_activeDistance(axleItem, -1)" class="PGU-AutomotiveAxles-Item__Arrow-Item PGU-AutomotiveAxles-Item__Arrow-Item_Right-Long"><svg xmlns=http://www.w3.org/2000/svg width=53 height=15 viewBox="0 0 53 15"><path class=PGU-AutomotiveAxles-Item__Truck-Arrow__Icon fill=none fill-rule=evenodd d="M5.03969493,5.96488205 L53,6 L53,9 L5.03969493,9.03511795 L8.36684417,12.3793897 C8.9632756,12.9788906 8.9632756,13.9508735 8.36684417,14.5503744 C7.77041275,15.1498752 6.80340634,15.1498752 6.20697492,14.5503744 L0.447323569,8.76108204 C0.104601359,8.41659608 -0.041185364,7.94912038 0.00996340009,7.5 C-0.041185364,7.05087962 0.104601359,6.58340392 0.447323569,6.23891796 L6.20697492,0.449625637 C6.80340634,-0.149875212 7.77041275,-0.149875212 8.36684417,0.449625637 C8.9632756,1.04912649 8.9632756,2.02110941 8.36684417,2.62061026 L5.03969493,5.96488205 Z" transform="matrix(-1 0 0 1 53 0)"></path></svg></div><div data-ng-click="onClick_activeDistance(axleItem, 1)" class="PGU-AutomotiveAxles-Item__Arrow-Item PGU-AutomotiveAxles-Item__Arrow-Item_Left"><svg xmlns=http://www.w3.org/2000/svg width=27 height=15 viewBox="0 0 27 15"><path class=PGU-AutomotiveAxles-Item__Truck-Arrow__Icon fill=none fill-rule=evenodd d="M5.03969493,5.96488205 L27,6 L27,9 L5.03969493,9.03511795 L8.36684417,12.3793897 C8.9632756,12.9788906 8.9632756,13.9508735 8.36684417,14.5503744 C7.77041275,15.1498752 6.80340634,15.1498752 6.20697492,14.5503744 L0.447323569,8.76108204 C0.104601359,8.41659608 -0.041185364,7.94912038 0.00996340009,7.5 C-0.041185364,7.05087962 0.104601359,6.58340392 0.447323569,6.23891796 L6.20697492,0.449625637 C6.80340634,-0.149875212 7.77041275,-0.149875212 8.36684417,0.449625637 C8.9632756,1.04912649 8.9632756,2.02110941 8.36684417,2.62061026 L5.03969493,5.96488205 Z"></path></svg></div><div data-ng-click="onClick_activeDistance(axleItem, 1)" class="PGU-AutomotiveAxles-Item__Arrow-Item PGU-AutomotiveAxles-Item__Arrow-Item_Left-Long"><svg xmlns=http://www.w3.org/2000/svg width=53 height=15 viewBox="0 0 53 15"><path class=PGU-AutomotiveAxles-Item__Truck-Arrow__Icon fill=none fill-rule=evenodd d="M5.03969493,5.96488205 L53,6 L53,9 L5.03969493,9.03511795 L8.36684417,12.3793897 C8.9632756,12.9788906 8.9632756,13.9508735 8.36684417,14.5503744 C7.77041275,15.1498752 6.80340634,15.1498752 6.20697492,14.5503744 L0.447323569,8.76108204 C0.104601359,8.41659608 -0.041185364,7.94912038 0.00996340009,7.5 C-0.041185364,7.05087962 0.104601359,6.58340392 0.447323569,6.23891796 L6.20697492,0.449625637 C6.80340634,-0.149875212 7.77041275,-0.149875212 8.36684417,0.449625637 C8.9632756,1.04912649 8.9632756,2.02110941 8.36684417,2.62061026 L5.03969493,5.96488205 Z"></path></svg></div><div class=PGU-AutomotiveAxles-Item__Arrow-Line></div></div></div></div></div></div><div class="PGU-AutomotiveAxles-Item__Data PGU-AutomotiveAxles-Item__Data_Trailer"><div class=PGU-AutomotiveAxles-Item__Data__Arrow></div><h3 class=PGU-Service-h3>{{trailerListActiveItem.humanityNumber}}</h3><div class="PGU-FieldTextInput PGU-FieldText PGU-FieldBody" data-ng-class="{\n                \'PGU-FieldText-Small-Placeholder\': (trailerListActiveItem.load || trailerListActiveItem.loadIsSmall),\n                \'PGU-Error\' : trailerListActiveItem.error && trailerListActiveItem.error.text\n                }"><label class="PGU-FieldLabel PGU-FieldLabel-Input x-label" for={{::item.fullPath}}-load>Нагрузка на ось (тонн)</label> <input class="PGU-FieldTextInputBasic x-text load" id={{::item.fullPath}}-load data-ng-model=trailerListActiveItem.load data-ng-change="trailerListActiveItem.error = \'\'" data-ng-click="onClickInputText(\'load\')" data-ng-blur="onBlurInputText(\'load\')"><pgu-error-hint class=PGU-ErrorHint model=trailerListActiveItem></pgu-error-hint></div><ul class=PGU-AutomotiveAxles-Item__Data__Radio-List><li data-ng-show="truckListActiveItem[\'need\' + radio.value + \'Wheel\']" data-ng-repeat="radio in item.radioList" class=PGU-AutomotiveAxles-Item__Data__Radio-Item><div class=flex-container><div class=PGU-AutomotiveAxles-Item__Data__Radio__Icon data-ng-class="{\n                                        \'PGU-AutomotiveAxles-Item__Data__Radio__Icon\': true,\n                                        \'PGU-AutomotiveAxles-Item__Data__Radio__Icon_Active\': trailerListActiveItem.wheelType == radio.value\n                                        }" data-ng-click=onClick_countWheel(radio.value)></div><div class=PGU-AutomotiveAxles-Item__Data__Radio__Label data-ng-click="onClick_countWheel(radio.value, \'trailer\')">{{radio.label}}</div></div></li></ul><div class="PGU-AutomotiveAxles-Item__Data__Actions flex-container"><div><a data-ng-href="" data-ng-click=removeTrailerAxle() class="PGU-Button PGU-Btn-Base PGU-Btn-White PGU-Btn-Base-mode-link PGU-Button_TrailerAxle_Remove">Удалить ось</a></div><div><a data-ng-href="" class="PGU-Button PGU-Btn-Base PGU-Btn-Blue" data-ng-click="onClick_truckListNext(\'\', \'trailer\')">Далее</a></div></div></div><div class=PGU-AutomotiveAxles-Item__Trailer-Mass><ul class=PGU-AutomotiveAxles-Item__Trailer-Mass__List><li data-ng-repeat="trailer in trailerList track by $index" data-ng-class="{\n                                \'PGU-AutomotiveAxles-Item__Trailer-Mass__List-Item\': true,\n                                \'PGU-AutomotiveAxles-Item__Trailer-Mass__Input-Error\': trailer.massError\n                                }"><div class="flex-container align-items-center"><div class=PGU-AutomotiveAxles-Item__Trailer-Mass__Input-Wrap><div class="PGU-FieldTextInput PGU-FieldBody" data-ng-class="{\'PGU-FieldText-Small-Placeholder\': (trailer.mass || trailerListActiveItem.massIsSmall)}"><label class="PGU-FieldLabel PGU-FieldLabel-Input x-label" for={{::item.fullPath}}-{{trailer.number}}>Масса прицепа/полуприцепа (тонн)</label> <input class="PGU-FieldTextInputBasic x-text" id={{::item.fullPath}}-{{trailer.number}} data-ng-model=trailer.mass data-ng-click="onClickInputText(\'mass\')" data-ng-blur="onBlurInputText(\'mass\')"></div></div><div><a data-ng-href="" class="PGU-Button PGU-Btn-Base PGU-Btn-White PGU-Btn-Base-mode-link" data-ng-click=removeTrailer(trailer.number)>Удалить прицеп</a></div></div><div data-ng-show="trailer.massError && trailer.massError.text" class=PGU-AutomotiveAxles-Item-Error>{{trailer.massError.text}}</div></li></ul></div><div class="PGU-AutomotiveAxles-Item__Trailer-Actions flex-container align-items-center"><div class="PGU-AutomotiveAxles-Item__Trailer-Action PGU-AutomotiveAxles-Item__Trailer-Action_Add-Axle"><a data-ng-href="" class="PGU-Button PGU-Btn-Base PGU-Btn-White" data-ng-click=addTrailerAxle();>Добавить ось</a></div><div class="PGU-AutomotiveAxles-Item__Trailer-Action PGU-AutomotiveAxles-Item__Trailer-Action_Add-Trailer"><a data-ng-href="" class="PGU-Button PGU-Btn-Base PGU-Btn-White" data-ng-click=toggleModalVisible(true);>Добавить прицеп (полуприцеп)</a></div></div></div><div data-ng-class="{\n            \'PGU-AutomotiveAxles-Item__Truck\' : true,\n            \'PGU-AutomotiveAxles-Item__Truck_Active\' : activeItemByType === \'distance\',\n            \'PGU-AutomotiveAxles-Item__Truck-Axle_Arrows_Show\' : truckDistanceArrows,\n            \'PGU-AutomotiveAxles-Item__Truck_Axle-Only\' : !trailerList.length || !firstSemiTrailer,\n            \'PGU-AutomotiveAxles-Item__Truck-Axle_Add-Distance-Axle_Show\': !distanceListValid\n\n            }"><div class=PGU-AutomotiveAxles-Item__Wrap-Truck-Axle><div class="flex-inline-container align-items-end"><div data-ng-repeat="axleItem in distanceAxleList track by $index" data-ng-click="onClick_truckListNext(axleItem.number, truckDistanceArrows);" data-ng-class="{\n                        \'PGU-AutomotiveAxles-Item__Truck-Axle\' : true,\n                        \'PGU-AutomotiveAxles-Item__Truck-Axle_IsTruckAxle\' : axleItem.isTruckAxle,\n                        \'PGU-AutomotiveAxles-Item__Truck-Axle_IsFirstTruckAxleWithSemi\' : axleItem.isTruckFirstWithSemi,\n                        \'PGU-AutomotiveAxles-Item__Truck-Axle_IsTrailerAxle\' : axleItem.isTrailerTruckAxle,\n                        \'PGU-AutomotiveAxles-Item__Truck-Axle_IsLastAxle\' : axleItem.last,\n                        \'PGU-AutomotiveAxles-Item__Truck-Axle_IsLastTruckAxle\' : axleItem.lastTruck,\n                        \'PGU-AutomotiveAxles-Item__Truck-Axle_Active\' : axleItem.isTruckAxleActive,\n                        \'PGU-AutomotiveAxles-Item__Truck-Axle_Valid\' : axleItem.isTruckAxleValid,\n                        \'PGU-AutomotiveAxles-Item__Truck-Axle_Invalid\' : axleItem.isTruckAxleInvalid,\n                        \'PGU-AutomotiveAxles-Item__Truck-Axle_Distance_Active_Left\' : axleItem.isDistanceAxleActiveLeft,\n                        \'PGU-AutomotiveAxles-Item__Truck-Axle_Distance_Active_Right\' : axleItem.isDistanceAxleActiveRight,\n                        \'PGU-AutomotiveAxles-Item__Truck-Axle_Distance-Invalid\' : axleItem.distanceError,\n                        \'PGU-AutomotiveAxles-Item__Truck-Axle_Distance-Valid\' : axleItem.distanceError === false,\n                        \'PGU-AutomotiveAxles-Item__Truck-Axle_Distance_Valid-Right\' : axleItem.distanceInvalidRight === false,\n                        \'PGU-AutomotiveAxles-Item__Truck-Axle_Distance_Valid-Left\' : axleItem.distanceInvalidLeft === false,\n                        \'PGU-AutomotiveAxles-Item__Truck-Axle_Distance_Invalid-Right\' : axleItem.distanceInvalidRight,\n                        \'PGU-AutomotiveAxles-Item__Truck-Axle_Distance_Invalid-Left\' : axleItem.distanceInvalidLeft\n                        }"><div data-ng-if=axleItem.isCab class=PGU-AutomotiveAxles-Item__Truck-Cab><div class=js-PGU-AutomotiveAxles-Item__AxleIcon_Axle><svg xmlns=http://www.w3.org/2000/svg width=86 height=83 viewBox="0 0 86 83"><g fill=none fill-rule=evenodd><path class=PGU-AutomotiveAxles-Item__Truck-Body__Icon fill=none d="M86,66 L66.2829892,65.9958841 C65.0114898,65.9958841 60.6812865,66.001681 56.1692469,66.0040557 C56.2262237,65.3452567 56.2553029,64.6785202 56.2553029,64.0050227 C56.2553029,51.3022873 45.9109063,43.00063 33.1504463,43.00063 C22.475516,43.00063 13.4914383,50.2072816 10.8399238,59.9998719 C10.7422605,59.9994934 9.80777646,59.9998291 8.03647184,60.0008791 C1.7871315,59.9934359 0,56.1128928 0,52.753928 C0,52.753928 0.0168597311,49.1773905 0.0309095071,40.2360467 C0.0365294175,36.7131573 2.11870621,35.3034055 21.6197952,7.64484888 C23.8761892,4.44384783 28.0855021,0 31.8592719,0 L59.4727016,0 C63.2464714,0 66.3008927,3.24272732 66.3008927,7.24248841 L66.3008927,57.0008644 C66.3008927,58.1054339 67.1963232,59.0008644 68.3008927,59.0008644 L86,59.0008644 L86,66 Z M58.6592196,27.9976811 C60.2552741,27.9976811 61.5478535,26.6058487 61.5478535,24.8909664 L61.5478535,9.10680262 C61.5478535,7.38890109 60.2552741,6.00008791 58.6592196,6.00008791 L39.1778002,6.00008791 L39.1778002,27.9976811 L58.6592196,27.9976811 Z M19.1194545,26.1650515 C19.1194545,27.046646 20.3835571,27.9976811 21.9404281,27.9976811 L33.1504463,27.9976811 L33.1504463,6.00008791 L32.2584605,6.00008791 C30.7015895,6.00008791 28.9641325,7.9051773 28.0365766,9.27889469 C19.9977595,21.1381516 19.0866206,22.7926508 19.0866206,24.5135715 C19.0866206,25.5702772 19.1194545,26.1650515 19.1194545,26.1650515 Z"></path><path class=PGU-AutomotiveAxles-Item__Truck-Axle__Icon fill=none fill-rule=nonzero d="M33,76.1891892 C39.1796186,76.1891892 44.1891892,71.1796186 44.1891892,65 C44.1891892,58.8203814 39.1796186,53.8108108 33,53.8108108 C26.8203814,53.8108108 21.8108108,58.8203814 21.8108108,65 C21.8108108,71.1796186 26.8203814,76.1891892 33,76.1891892 Z M33,83 C23.0588745,83 15,74.9411255 15,65 C15,55.0588745 23.0588745,47 33,47 C42.9411255,47 51,55.0588745 51,65 C51,74.9411255 42.9411255,83 33,83 Z"></path><text class="PGU-AutomotiveAxles-Item__Truck-Axle__Icon PGU-AutomotiveAxles-Item__Truck-Axle__Text" fill=none font-family="Helvetica, Arial, sans-serif" font-size=14><tspan data-ng-if="axleItem.wheelType !== \'8\'" x=29.107 y=70>{{axleItem.wheelType}}</tspan><tspan data-ng-if="axleItem.wheelType == \'8\'" x=26.107 y=70>{{axleItem.wheelType}}+</tspan></text></g></svg></div><div class="PGU-AutomotiveAxles-Item__Arrows PGU-AutomotiveAxles-Item__Arrows_Cab flex-container align-items-center"><div data-ng-click="onClick_activeDistance(axleItem, 1)" class="PGU-AutomotiveAxles-Item__Arrow-Item PGU-AutomotiveAxles-Item__Arrow-Item_Left-Long"><svg xmlns=http://www.w3.org/2000/svg width=53 height=15 viewBox="0 0 53 15"><path class=PGU-AutomotiveAxles-Item__Truck-Arrow__Icon fill=none fill-rule=evenodd d="M5.03969493,5.96488205 L53,6 L53,9 L5.03969493,9.03511795 L8.36684417,12.3793897 C8.9632756,12.9788906 8.9632756,13.9508735 8.36684417,14.5503744 C7.77041275,15.1498752 6.80340634,15.1498752 6.20697492,14.5503744 L0.447323569,8.76108204 C0.104601359,8.41659608 -0.041185364,7.94912038 0.00996340009,7.5 C-0.041185364,7.05087962 0.104601359,6.58340392 0.447323569,6.23891796 L6.20697492,0.449625637 C6.80340634,-0.149875212 7.77041275,-0.149875212 8.36684417,0.449625637 C8.9632756,1.04912649 8.9632756,2.02110941 8.36684417,2.62061026 L5.03969493,5.96488205 Z"></path></svg></div><div data-ng-click="onClick_activeDistance(axleItem, -1)" class="PGU-AutomotiveAxles-Item__Arrow-Item PGU-AutomotiveAxles-Item__Arrow-Item_Right-Long"><svg xmlns=http://www.w3.org/2000/svg width=53 height=15 viewBox="0 0 53 15"><path class=PGU-AutomotiveAxles-Item__Truck-Arrow__Icon fill=none fill-rule=evenodd d="M5.03969493,5.96488205 L53,6 L53,9 L5.03969493,9.03511795 L8.36684417,12.3793897 C8.9632756,12.9788906 8.9632756,13.9508735 8.36684417,14.5503744 C7.77041275,15.1498752 6.80340634,15.1498752 6.20697492,14.5503744 L0.447323569,8.76108204 C0.104601359,8.41659608 -0.041185364,7.94912038 0.00996340009,7.5 C-0.041185364,7.05087962 0.104601359,6.58340392 0.447323569,6.23891796 L6.20697492,0.449625637 C6.80340634,-0.149875212 7.77041275,-0.149875212 8.36684417,0.449625637 C8.9632756,1.04912649 8.9632756,2.02110941 8.36684417,2.62061026 L5.03969493,5.96488205 Z"></path></svg></div><div class=PGU-AutomotiveAxles-Item__Arrow-Line></div></div></div><div data-ng-if=!axleItem.isCab><div class="PGU-AutomotiveAxles-Item__Axle flex-container align-items-top"><div class="PGU-AutomotiveAxles-Item__AxleIcon PGU-AutomotiveAxles-Item__AxleIcon_Connector"><svg xmlns=http://www.w3.org/2000/svg width=22 height=93 viewBox="0 0 22 93"><polygon class=PGU-AutomotiveAxles-Item__Truck-Body__Icon fill=none fill-rule=evenodd points="14 87 14 0 22 0 22 93 0 93 0 87"></polygon></svg></div><div class="PGU-AutomotiveAxles-Item__AxleIcon PGU-AutomotiveAxles-Item__AxleIcon_Axle js-PGU-AutomotiveAxles-Item__AxleIcon_Axle"><svg xmlns=http://www.w3.org/2000/svg width=54 height=109 viewBox="0 0 54 109"><g fill=none fill-rule=evenodd><path class=PGU-AutomotiveAxles-Item__Truck-Axle__Icon fill=none fill-rule=nonzero d="M27,102.189189 C33.1796186,102.189189 38.1891892,97.1796186 38.1891892,91 C38.1891892,84.8203814 33.1796186,79.8108108 27,79.8108108 C20.8203814,79.8108108 15.8108108,84.8203814 15.8108108,91 C15.8108108,97.1796186 20.8203814,102.189189 27,102.189189 Z M27,109 C17.0588745,109 9,100.941125 9,91 C9,81.0588745 17.0588745,73 27,73 C36.9411255,73 45,81.0588745 45,91 C45,100.941125 36.9411255,109 27,109 Z"></path><text class="PGU-AutomotiveAxles-Item__Truck-Axle__Icon PGU-AutomotiveAxles-Item__Truck-Axle__Text" fill=none font-family="Helvetica, Arial, sans-serif" font-size=14><tspan data-ng-if="axleItem.wheelType !== \'8\'" x=23.019 y=96>{{axleItem.wheelType}}</tspan><tspan data-ng-if="axleItem.wheelType == \'8\'" x=19.019 y=96>{{axleItem.wheelType}}+</tspan></text><path class=PGU-AutomotiveAxles-Item__Truck-Body__Icon fill=none d="M49,91.9934657 C48.983426,91.4944406 49,90.9910005 49,90.9869313 C49,77.9760588 40,68.8431756 27,68.8431756 C14,68.8431756 5,77.9760588 5,90.9869313 C5,90.9910005 5.01657403,91.4944406 5,91.9934657 L0,91.9934657 L0,0 L54,0 L54,91.9934657 L49,91.9934657 Z"></path></g></svg></div><div class="PGU-AutomotiveAxles-Item__AxleIcon PGU-AutomotiveAxles-Item__AxleIcon_AxleTruck"><div class="PGU-AutomotiveAxles-Item__AxleIcon PGU-AutomotiveAxles-Item__AxleIcon_SemiLong"><svg xmlns=http://www.w3.org/2000/svg width=108 height=62 viewBox="0 0 108 62"><path class=PGU-AutomotiveAxles-Item__Truck-Body__Icon fill=none fill-rule=evenodd d="M108,3.99642766 C108,1.78926161 106.215566,-7.10542736e-15 103.995819,-7.10542736e-15 L0,-7.10542736e-15 L0,62 L103.995819,62 C106.207267,62 108,60.2113247 108,58.0035723 L108,3.99642766 Z" transform="matrix(-1 0 0 1 108 0)"></path></svg></div><div class="PGU-AutomotiveAxles-Item__AxleIcon PGU-AutomotiveAxles-Item__AxleIcon_Semi"><svg xmlns=http://www.w3.org/2000/svg width=54 height=62 viewBox="0 0 54 62"><path class=PGU-AutomotiveAxles-Item__Truck-Body__Icon fill=none fill-rule=evenodd d="M54,3.99642766 C54,1.78926161 52.2033234,-1.42108547e-14 50.0073214,-1.42108547e-14 L0,-1.42108547e-14 L0,62 L50.0073214,62 C52.2124169,62 54,60.2113247 54,58.0035723 L54,3.99642766 Z" transform="matrix(-1 0 0 1 54 0)"></path></svg></div><div class="PGU-AutomotiveAxles-Item__AxleIcon PGU-AutomotiveAxles-Item__AxleIcon_SemiSquare"><svg xmlns=http://www.w3.org/2000/svg width=54 height=62 viewBox="0 0 54 62"><rect class=PGU-AutomotiveAxles-Item__Truck-Body__Icon width=54 height=62 fill=none></rect></svg></div><div class="PGU-AutomotiveAxles-Item__AxleIcon PGU-AutomotiveAxles-Item__AxleIcon_Wheel js-PGU-AutomotiveAxles-Item__AxleIcon_Axle"><svg xmlns=http://www.w3.org/2000/svg width=54 height=45 viewBox="0 0 54 45"><g fill=none fill-rule=evenodd><path class=PGU-AutomotiveAxles-Item__Truck-Body__Icon fill=none d="M49,26 C49,13.8497355 39.1502645,4 27,4 C14.8497355,4 5,13.8497355 5,26 C5,26.672456 5.03017038,27.3378652 5,28 L0,28 C0.0544507576,25.3664063 0.0544507576,22.3664063 0,19 L0,12.6568542 C-1.2991861e-16,11.5959883 0.421427361,10.5785726 1.17157288,9.82842712 L9.82842712,1.17157288 C10.5785726,0.421427361 11.5959883,3.03929442e-14 12.6568542,3.01980663e-14 L43.1044835,3.01980663e-14 C44.304216,3.2108832e-14 45.4405967,0.538507107 46.2003127,1.46704884 L53.0958292,9.89490235 C53.6805416,10.6095509 54,11.5044841 54,12.4278535 L54,28 L49,28 C48.9697014,27.34069 49,26.6738833 49,26 Z"></path><path class=PGU-AutomotiveAxles-Item__Truck-Axle__Icon fill=none fill-rule=nonzero d="M27,38.1891892 C33.1796186,38.1891892 38.1891892,33.1796186 38.1891892,27 C38.1891892,20.8203814 33.1796186,15.8108108 27,15.8108108 C20.8203814,15.8108108 15.8108108,20.8203814 15.8108108,27 C15.8108108,33.1796186 20.8203814,38.1891892 27,38.1891892 Z M27,45 C17.0588745,45 9,36.9411255 9,27 C9,17.0588745 17.0588745,9 27,9 C36.9411255,9 45,17.0588745 45,27 C45,36.9411255 36.9411255,45 27,45 Z"></path><text class="PGU-AutomotiveAxles-Item__Truck-Axle__Icon PGU-AutomotiveAxles-Item__Truck-Axle__Text" fill=none font-family="Helvetica, Arial, sans-serif" font-size=14><tspan data-ng-if="axleItem.wheelType !== \'8\'" x=23.019 y=32>{{axleItem.wheelType}}</tspan><tspan data-ng-if="axleItem.wheelType == \'8\'" x=19.019 y=32>{{axleItem.wheelType}}+</tspan></text></g></svg></div></div><div class="PGU-AutomotiveAxles-Item__AxleIcon PGU-AutomotiveAxles-Item__AxleIcon_Middle"><svg xmlns=http://www.w3.org/2000/svg width=54 height=92 viewBox="0 0 54 92"><polygon class=PGU-AutomotiveAxles-Item__Truck-Body__Icon fill=none fill-rule=evenodd points="0 92 0 82.093 0 0 54 0 54 92"></polygon></svg></div><div class="PGU-AutomotiveAxles-Item__AxleIcon PGU-AutomotiveAxles-Item__AxleIcon_Middle"><svg xmlns=http://www.w3.org/2000/svg width=54 height=92 viewBox="0 0 54 92"><polygon class=PGU-AutomotiveAxles-Item__Truck-Body__Icon fill=none fill-rule=evenodd points="0 92 0 82.093 0 0 54 0 54 92"></polygon></svg></div><div class="PGU-AutomotiveAxles-Item__AxleIcon PGU-AutomotiveAxles-Item__AxleIcon-Back"><svg xmlns=http://www.w3.org/2000/svg width=8 height=92 viewBox="0 0 8 92"><path class=PGU-AutomotiveAxles-Item__Truck-Body__Icon fill=none fill-rule=evenodd d="M0,92 L0,0 L-1.46957616e-15,0 C4.418278,-8.11624501e-16 8,3.581722 8,8 L8,84 C8,88.418278 4.418278,92 4.8985872e-16,92 Z"></path></svg></div></div><div class="PGU-AutomotiveAxles-Item__Arrows flex-container align-items-center"><div data-ng-click="onClick_activeDistance(axleItem, -1)" class="PGU-AutomotiveAxles-Item__Arrow-Line PGU-AutomotiveAxles-Item__Arrow-Line_Right"><div class=PGU-AutomotiveAxles-Item__Arrow-Line__Item><div class=PGU-AutomotiveAxles-Item__Arrow-Line__Item-Content></div></div></div><div data-ng-click="onClick_activeDistance(axleItem, -1)" class="PGU-AutomotiveAxles-Item__Arrow-Item PGU-AutomotiveAxles-Item__Arrow-Item_Right"><svg xmlns=http://www.w3.org/2000/svg width=27 height=15 viewBox="0 0 27 15"><path class=PGU-AutomotiveAxles-Item__Truck-Arrow__Icon fill=none fill-rule=evenodd d="M5.03969493,5.96488205 L27,6 L27,9 L5.03969493,9.03511795 L8.36684417,12.3793897 C8.9632756,12.9788906 8.9632756,13.9508735 8.36684417,14.5503744 C7.77041275,15.1498752 6.80340634,15.1498752 6.20697492,14.5503744 L0.447323569,8.76108204 C0.104601359,8.41659608 -0.041185364,7.94912038 0.00996340009,7.5 C-0.041185364,7.05087962 0.104601359,6.58340392 0.447323569,6.23891796 L6.20697492,0.449625637 C6.80340634,-0.149875212 7.77041275,-0.149875212 8.36684417,0.449625637 C8.9632756,1.04912649 8.9632756,2.02110941 8.36684417,2.62061026 L5.03969493,5.96488205 Z" transform="matrix(-1 0 0 1 27 0)"></path></svg></div><div data-ng-click="onClick_activeDistance(axleItem, -1)" class="PGU-AutomotiveAxles-Item__Arrow-Item PGU-AutomotiveAxles-Item__Arrow-Item_Right-Long"><svg xmlns=http://www.w3.org/2000/svg width=53 height=15 viewBox="0 0 53 15"><path class=PGU-AutomotiveAxles-Item__Truck-Arrow__Icon fill=none fill-rule=evenodd d="M5.03969493,5.96488205 L53,6 L53,9 L5.03969493,9.03511795 L8.36684417,12.3793897 C8.9632756,12.9788906 8.9632756,13.9508735 8.36684417,14.5503744 C7.77041275,15.1498752 6.80340634,15.1498752 6.20697492,14.5503744 L0.447323569,8.76108204 C0.104601359,8.41659608 -0.041185364,7.94912038 0.00996340009,7.5 C-0.041185364,7.05087962 0.104601359,6.58340392 0.447323569,6.23891796 L6.20697492,0.449625637 C6.80340634,-0.149875212 7.77041275,-0.149875212 8.36684417,0.449625637 C8.9632756,1.04912649 8.9632756,2.02110941 8.36684417,2.62061026 L5.03969493,5.96488205 Z" transform="matrix(-1 0 0 1 53 0)"></path></svg></div><div data-ng-click="onClick_activeDistance(axleItem, 1)" class="PGU-AutomotiveAxles-Item__Arrow-Item PGU-AutomotiveAxles-Item__Arrow-Item_Left"><svg xmlns=http://www.w3.org/2000/svg width=27 height=15 viewBox="0 0 27 15"><path class=PGU-AutomotiveAxles-Item__Truck-Arrow__Icon fill=none fill-rule=evenodd d="M5.03969493,5.96488205 L27,6 L27,9 L5.03969493,9.03511795 L8.36684417,12.3793897 C8.9632756,12.9788906 8.9632756,13.9508735 8.36684417,14.5503744 C7.77041275,15.1498752 6.80340634,15.1498752 6.20697492,14.5503744 L0.447323569,8.76108204 C0.104601359,8.41659608 -0.041185364,7.94912038 0.00996340009,7.5 C-0.041185364,7.05087962 0.104601359,6.58340392 0.447323569,6.23891796 L6.20697492,0.449625637 C6.80340634,-0.149875212 7.77041275,-0.149875212 8.36684417,0.449625637 C8.9632756,1.04912649 8.9632756,2.02110941 8.36684417,2.62061026 L5.03969493,5.96488205 Z"></path></svg></div><div data-ng-click="onClick_activeDistance(axleItem, 1)" class="PGU-AutomotiveAxles-Item__Arrow-Item PGU-AutomotiveAxles-Item__Arrow-Item_Left-Long"><svg xmlns=http://www.w3.org/2000/svg width=53 height=15 viewBox="0 0 53 15"><path class=PGU-AutomotiveAxles-Item__Truck-Arrow__Icon fill=none fill-rule=evenodd d="M5.03969493,5.96488205 L53,6 L53,9 L5.03969493,9.03511795 L8.36684417,12.3793897 C8.9632756,12.9788906 8.9632756,13.9508735 8.36684417,14.5503744 C7.77041275,15.1498752 6.80340634,15.1498752 6.20697492,14.5503744 L0.447323569,8.76108204 C0.104601359,8.41659608 -0.041185364,7.94912038 0.00996340009,7.5 C-0.041185364,7.05087962 0.104601359,6.58340392 0.447323569,6.23891796 L6.20697492,0.449625637 C6.80340634,-0.149875212 7.77041275,-0.149875212 8.36684417,0.449625637 C8.9632756,1.04912649 8.9632756,2.02110941 8.36684417,2.62061026 L5.03969493,5.96488205 Z"></path></svg></div><div data-ng-click="onClick_activeDistance(axleItem, 1)" class="PGU-AutomotiveAxles-Item__Arrow-Line PGU-AutomotiveAxles-Item__Arrow-Line_Left"><div class=PGU-AutomotiveAxles-Item__Arrow-Line__Item><div class=PGU-AutomotiveAxles-Item__Arrow-Line__Item-Content></div></div></div></div></div></div></div></div><div class="PGU-AutomotiveAxles-Item__Data PGU-AutomotiveAxles-Item__Data_Add-Distance"><div class=PGU-AutomotiveAxles-Item__Data__Arrow></div><div class="PGU-FieldTextInput PGU-FieldText PGU-FieldBody" data-ng-class="{\n                \'PGU-FieldText-Small-Placeholder\': (distanceListActiveItem.distance || distanceListActiveItem.distanceIsSmall),\n                \'PGU-Error\' : distanceListActiveItem.error && distanceListActiveItem.error.text\n                }"><label class="PGU-FieldLabel PGU-FieldLabel-Input x-label" for={{::item.fullPath}}-distance>Расстояние (метров)</label> <input class="PGU-FieldTextInputBasic x-text load" id={{::item.fullPath}}-distance data-ng-model=distanceListActiveItem.distance data-ng-change="distanceListActiveItem.error = \'\'" data-ng-click="onClickInputText(\'distance\')" data-ng-blur="onBlurInputText(\'distance\')"><pgu-error-hint class=PGU-ErrorHint model=distanceListActiveItem></pgu-error-hint></div><div class="PGU-AutomotiveAxles-Item__Data__Actions flex-container"><div><a data-ng-href="" class="PGU-Button PGU-Btn-Base PGU-Btn-Blue" data-ng-click="onClick_activeDistance(-1, 1);">Далее</a></div></div></div></div><div data-ng-class="{\n            \'PGU-AutomotiveAxles-Item__Truck-Axle_Add-Truck-Axle_Show\' : truckListValid,\n            \'PGU-AutomotiveAxles-Item__Trailer-Action_Add-Axle_Show\' : truckListValid && trailerListValid && trailerList.length,\n            \'PGU-AutomotiveAxles-Item__Trailer-Action_Add-Trailer_Hide\' : !truckListValid || (truckListValid && !trailerListValid && trailerList.length)\n        }"><div class="PGU-AutomotiveAxles-Item__Counter flex-container align-items-center"><div class=PGU-AutomotiveAxles-Item__Counter__Title><h3 class=PGU-Service-h3>Всего прицепов: {{trailerList.length}}</h3></div><div class="PGU-AutomotiveAxles-Item__Counter__Actions PGU-AutomotiveAxles-Item__Trailer-Action_Add-Trailer"><a data-ng-href="" class="PGU-Button PGU-Btn-Base PGU-Btn-White" data-ng-click="scrollToWidgetPart(\'trailer\');">Добавить прицеп (полуприцеп)</a></div></div><div class="PGU-AutomotiveAxles-Item__Counter flex-container align-items-center"><div class=PGU-AutomotiveAxles-Item__Counter__Title><h3 class=PGU-Service-h3>Всего осей: {{item.axlesList.length}}</h3></div><div class="PGU-AutomotiveAxles-Item__Counter__Actions PGU-AutomotiveAxles-Item__Trailer-Action_Add-Axle"><a data-ng-href="" class="PGU-Button PGU-Btn-Base PGU-Btn-White" data-ng-click="scrollToWidgetPart(\'axle\');">Добавить ось</a></div><div class="PGU-AutomotiveAxles-Item__Counter__Actions PGU-AutomotiveAxles-Item__Add-Truck-Axle"><a data-ng-href="" class="PGU-Button PGU-Btn-Base PGU-Btn-White" data-ng-click="scrollToWidgetPart(\'truckAxle\');">Добавить ось тягача</a></div></div></div></div><modal-dialog show=modalShow hide-modal=toggleModalVisible(false)><div><h3 class=PGU-Service-h3>Выберите тип прицепа (полуприцепа)</h3><p>В зависимости от конфигурации вашего прицепа будут добавлены соответствующие оси</p><div class="flex-container justify-between"><div><h4>Одноосный</h4><div data-ng-click=addTrailer(1)><div class="PGU-AutomotiveAxles-Item__Truck flex-container align-items-end"><div data-ng-class="{\n                                \'PGU-AutomotiveAxles-Item__Truck-Axle\' : true,\n                                \'PGU-AutomotiveAxles-Item__Semi-Trailer-Truck-Axle\' : true,\n                                \'PGU-AutomotiveAxles-Item__Truck-Axle_IsTruckAxle\' : true,\n                                \'PGU-AutomotiveAxles-Item__Truck-Axle_IsLastTruckAxle\': true,\n                                \'PGU-AutomotiveAxles-Item__Truck-Axle_IsFirstTruckAxleWithSemi\': true\n\n                                }"><div><div class="PGU-AutomotiveAxles-Item__Axle flex-container align-items-top"><div class="PGU-AutomotiveAxles-Item__AxleIcon PGU-AutomotiveAxles-Item__AxleIcon_Axle"><svg xmlns=http://www.w3.org/2000/svg width=54 height=109 viewBox="0 0 54 109"><g fill=none fill-rule=evenodd><path class=PGU-AutomotiveAxles-Item__Truck-Axle__Icon fill=none fill-rule=nonzero d="M27,102.189189 C33.1796186,102.189189 38.1891892,97.1796186 38.1891892,91 C38.1891892,84.8203814 33.1796186,79.8108108 27,79.8108108 C20.8203814,79.8108108 15.8108108,84.8203814 15.8108108,91 C15.8108108,97.1796186 20.8203814,102.189189 27,102.189189 Z M27,109 C17.0588745,109 9,100.941125 9,91 C9,81.0588745 17.0588745,73 27,73 C36.9411255,73 45,81.0588745 45,91 C45,100.941125 36.9411255,109 27,109 Z"></path><text class="PGU-AutomotiveAxles-Item__Truck-Body__Icon PGU-AutomotiveAxles-Item__Truck-Axle__Text" fill=none font-family="Helvetica, Arial, sans-serif" font-size=14><tspan x=19.019 y=96></tspan></text><path class=PGU-AutomotiveAxles-Item__Truck-Body__Icon fill=none d="M49,91.9934657 C48.983426,91.4944406 49,90.9910005 49,90.9869313 C49,77.9760588 40,68.8431756 27,68.8431756 C14,68.8431756 5,77.9760588 5,90.9869313 C5,90.9910005 5.01657403,91.4944406 5,91.9934657 L0,91.9934657 L0,0 L54,0 L54,91.9934657 L49,91.9934657 Z"></path></g></svg></div><div class="PGU-AutomotiveAxles-Item__AxleIcon PGU-AutomotiveAxles-Item__AxleIcon_AxleTruck"><div class="PGU-AutomotiveAxles-Item__AxleIcon PGU-AutomotiveAxles-Item__AxleIcon_SemiLong"><svg xmlns=http://www.w3.org/2000/svg width=108 height=62 viewBox="0 0 108 62"><path class=PGU-AutomotiveAxles-Item__Truck-Body__Icon fill=none fill-rule=evenodd d="M108,3.99642766 C108,1.78926161 106.215566,-7.10542736e-15 103.995819,-7.10542736e-15 L0,-7.10542736e-15 L0,62 L103.995819,62 C106.207267,62 108,60.2113247 108,58.0035723 L108,3.99642766 Z" transform="matrix(-1 0 0 1 108 0)"></path></svg></div><div class="PGU-AutomotiveAxles-Item__AxleIcon PGU-AutomotiveAxles-Item__AxleIcon_Semi"><svg xmlns=http://www.w3.org/2000/svg width=54 height=62 viewBox="0 0 54 62"><path class=PGU-AutomotiveAxles-Item__Truck-Body__Icon fill=none fill-rule=evenodd d="M54,3.99642766 C54,1.78926161 52.2033234,-1.42108547e-14 50.0073214,-1.42108547e-14 L0,-1.42108547e-14 L0,62 L50.0073214,62 C52.2124169,62 54,60.2113247 54,58.0035723 L54,3.99642766 Z" transform="matrix(-1 0 0 1 54 0)"></path></svg></div><div class="PGU-AutomotiveAxles-Item__AxleIcon PGU-AutomotiveAxles-Item__AxleIcon_SemiSquare"><svg xmlns=http://www.w3.org/2000/svg width=54 height=62 viewBox="0 0 54 62"><rect class=PGU-AutomotiveAxles-Item__Truck-Body__Icon width=54 height=62 fill=none></rect></svg></div><div class="PGU-AutomotiveAxles-Item__AxleIcon PGU-AutomotiveAxles-Item__AxleIcon_Wheel"><svg xmlns=http://www.w3.org/2000/svg width=54 height=45 viewBox="0 0 54 45"><g fill=none fill-rule=evenodd><path class=PGU-AutomotiveAxles-Item__Truck-Body__Icon fill=none d="M49,26 C49,13.8497355 39.1502645,4 27,4 C14.8497355,4 5,13.8497355 5,26 C5,26.672456 5.03017038,27.3378652 5,28 L0,28 C0.0544507576,25.3664063 0.0544507576,22.3664063 0,19 L0,12.6568542 C-1.2991861e-16,11.5959883 0.421427361,10.5785726 1.17157288,9.82842712 L9.82842712,1.17157288 C10.5785726,0.421427361 11.5959883,3.03929442e-14 12.6568542,3.01980663e-14 L43.1044835,3.01980663e-14 C44.304216,3.2108832e-14 45.4405967,0.538507107 46.2003127,1.46704884 L53.0958292,9.89490235 C53.6805416,10.6095509 54,11.5044841 54,12.4278535 L54,28 L49,28 C48.9697014,27.34069 49,26.6738833 49,26 Z"></path><path class=PGU-AutomotiveAxles-Item__Truck-Axle__Icon fill=none fill-rule=nonzero d="M27,38.1891892 C33.1796186,38.1891892 38.1891892,33.1796186 38.1891892,27 C38.1891892,20.8203814 33.1796186,15.8108108 27,15.8108108 C20.8203814,15.8108108 15.8108108,20.8203814 15.8108108,27 C15.8108108,33.1796186 20.8203814,38.1891892 27,38.1891892 Z M27,45 C17.0588745,45 9,36.9411255 9,27 C9,17.0588745 17.0588745,9 27,9 C36.9411255,9 45,17.0588745 45,27 C45,36.9411255 36.9411255,45 27,45 Z"></path><text class="PGU-AutomotiveAxles-Item__Truck-Body__Icon PGU-AutomotiveAxles-Item__Truck-Axle__Text" fill=none font-family="Helvetica, Arial, sans-serif" font-size=14><tspan x=19.019 y=32></tspan></text></g></svg></div></div><div class="PGU-AutomotiveAxles-Item__AxleIcon PGU-AutomotiveAxles-Item__AxleIcon_Middle"><svg xmlns=http://www.w3.org/2000/svg width=54 height=92 viewBox="0 0 54 92"><polygon class=PGU-AutomotiveAxles-Item__Truck-Body__Icon fill=none fill-rule=evenodd points="0 92 0 82.093 0 0 54 0 54 92"></polygon></svg></div><div class="PGU-AutomotiveAxles-Item__AxleIcon PGU-AutomotiveAxles-Item__AxleIcon_Middle"><svg xmlns=http://www.w3.org/2000/svg width=54 height=92 viewBox="0 0 54 92"><polygon class=PGU-AutomotiveAxles-Item__Truck-Body__Icon fill=none fill-rule=evenodd points="0 92 0 82.093 0 0 54 0 54 92"></polygon></svg></div><div class="PGU-AutomotiveAxles-Item__AxleIcon PGU-AutomotiveAxles-Item__AxleIcon-Back"><svg xmlns=http://www.w3.org/2000/svg width=8 height=92 viewBox="0 0 8 92"><path class=PGU-AutomotiveAxles-Item__Truck-Body__Icon fill=none fill-rule=evenodd d="M0,92 L0,0 L-1.46957616e-15,0 C4.418278,-8.11624501e-16 8,3.581722 8,8 L8,84 C8,88.418278 4.418278,92 4.8985872e-16,92 Z"></path></svg></div></div><div class="PGU-AutomotiveAxles-Item__Arrows flex-container align-items-center"><div data-ng-click="onClick_activeDistance(axleItem, -1)" class="PGU-AutomotiveAxles-Item__Arrow-Item PGU-AutomotiveAxles-Item__Arrow-Item_Right"><svg xmlns=http://www.w3.org/2000/svg width=27 height=15 viewBox="0 0 27 15"><path class=PGU-AutomotiveAxles-Item__Truck-Arrow__Icon fill=none fill-rule=evenodd d="M5.03969493,5.96488205 L27,6 L27,9 L5.03969493,9.03511795 L8.36684417,12.3793897 C8.9632756,12.9788906 8.9632756,13.9508735 8.36684417,14.5503744 C7.77041275,15.1498752 6.80340634,15.1498752 6.20697492,14.5503744 L0.447323569,8.76108204 C0.104601359,8.41659608 -0.041185364,7.94912038 0.00996340009,7.5 C-0.041185364,7.05087962 0.104601359,6.58340392 0.447323569,6.23891796 L6.20697492,0.449625637 C6.80340634,-0.149875212 7.77041275,-0.149875212 8.36684417,0.449625637 C8.9632756,1.04912649 8.9632756,2.02110941 8.36684417,2.62061026 L5.03969493,5.96488205 Z" transform="matrix(-1 0 0 1 27 0)"></path></svg></div><div data-ng-click="onClick_activeDistance(axleItem, -1)" class="PGU-AutomotiveAxles-Item__Arrow-Item PGU-AutomotiveAxles-Item__Arrow-Item_Right-Long"><svg xmlns=http://www.w3.org/2000/svg width=53 height=15 viewBox="0 0 53 15"><path class=PGU-AutomotiveAxles-Item__Truck-Arrow__Icon fill=none fill-rule=evenodd d="M5.03969493,5.96488205 L53,6 L53,9 L5.03969493,9.03511795 L8.36684417,12.3793897 C8.9632756,12.9788906 8.9632756,13.9508735 8.36684417,14.5503744 C7.77041275,15.1498752 6.80340634,15.1498752 6.20697492,14.5503744 L0.447323569,8.76108204 C0.104601359,8.41659608 -0.041185364,7.94912038 0.00996340009,7.5 C-0.041185364,7.05087962 0.104601359,6.58340392 0.447323569,6.23891796 L6.20697492,0.449625637 C6.80340634,-0.149875212 7.77041275,-0.149875212 8.36684417,0.449625637 C8.9632756,1.04912649 8.9632756,2.02110941 8.36684417,2.62061026 L5.03969493,5.96488205 Z" transform="matrix(-1 0 0 1 53 0)"></path></svg></div><div data-ng-click="onClick_activeDistance(axleItem, 1)" class="PGU-AutomotiveAxles-Item__Arrow-Item PGU-AutomotiveAxles-Item__Arrow-Item_Left"><svg xmlns=http://www.w3.org/2000/svg width=27 height=15 viewBox="0 0 27 15"><path class=PGU-AutomotiveAxles-Item__Truck-Arrow__Icon fill=none fill-rule=evenodd d="M5.03969493,5.96488205 L27,6 L27,9 L5.03969493,9.03511795 L8.36684417,12.3793897 C8.9632756,12.9788906 8.9632756,13.9508735 8.36684417,14.5503744 C7.77041275,15.1498752 6.80340634,15.1498752 6.20697492,14.5503744 L0.447323569,8.76108204 C0.104601359,8.41659608 -0.041185364,7.94912038 0.00996340009,7.5 C-0.041185364,7.05087962 0.104601359,6.58340392 0.447323569,6.23891796 L6.20697492,0.449625637 C6.80340634,-0.149875212 7.77041275,-0.149875212 8.36684417,0.449625637 C8.9632756,1.04912649 8.9632756,2.02110941 8.36684417,2.62061026 L5.03969493,5.96488205 Z"></path></svg></div><div data-ng-click="onClick_activeDistance(axleItem, 1)" class="PGU-AutomotiveAxles-Item__Arrow-Item PGU-AutomotiveAxles-Item__Arrow-Item_Left-Long"><svg xmlns=http://www.w3.org/2000/svg width=53 height=15 viewBox="0 0 53 15"><path class=PGU-AutomotiveAxles-Item__Truck-Arrow__Icon fill=none fill-rule=evenodd d="M5.03969493,5.96488205 L53,6 L53,9 L5.03969493,9.03511795 L8.36684417,12.3793897 C8.9632756,12.9788906 8.9632756,13.9508735 8.36684417,14.5503744 C7.77041275,15.1498752 6.80340634,15.1498752 6.20697492,14.5503744 L0.447323569,8.76108204 C0.104601359,8.41659608 -0.041185364,7.94912038 0.00996340009,7.5 C-0.041185364,7.05087962 0.104601359,6.58340392 0.447323569,6.23891796 L6.20697492,0.449625637 C6.80340634,-0.149875212 7.77041275,-0.149875212 8.36684417,0.449625637 C8.9632756,1.04912649 8.9632756,2.02110941 8.36684417,2.62061026 L5.03969493,5.96488205 Z"></path></svg></div><div class=PGU-AutomotiveAxles-Item__Arrow-Line></div></div></div></div><div data-ng-class="{\n                                \'PGU-AutomotiveAxles-Item__Truck-Axle_IsLastAxle\' : true\n                             }"><div><div class="PGU-AutomotiveAxles-Item__Axle flex-container align-items-top"><div class="PGU-AutomotiveAxles-Item__AxleIcon PGU-AutomotiveAxles-Item__AxleIcon_Axle"><svg xmlns=http://www.w3.org/2000/svg width=54 height=109 viewBox="0 0 54 109"><g fill=none fill-rule=evenodd><path class=PGU-AutomotiveAxles-Item__Truck-Axle__Icon fill=none fill-rule=nonzero d="M27,102.189189 C33.1796186,102.189189 38.1891892,97.1796186 38.1891892,91 C38.1891892,84.8203814 33.1796186,79.8108108 27,79.8108108 C20.8203814,79.8108108 15.8108108,84.8203814 15.8108108,91 C15.8108108,97.1796186 20.8203814,102.189189 27,102.189189 Z M27,109 C17.0588745,109 9,100.941125 9,91 C9,81.0588745 17.0588745,73 27,73 C36.9411255,73 45,81.0588745 45,91 C45,100.941125 36.9411255,109 27,109 Z"></path><text class="PGU-AutomotiveAxles-Item__Truck-Body__Icon PGU-AutomotiveAxles-Item__Truck-Axle__Text" fill=none font-family="Helvetica, Arial, sans-serif" font-size=14><tspan x=19.019 y=96></tspan></text><path class=PGU-AutomotiveAxles-Item__Truck-Body__Icon fill=none d="M49,91.9934657 C48.983426,91.4944406 49,90.9910005 49,90.9869313 C49,77.9760588 40,68.8431756 27,68.8431756 C14,68.8431756 5,77.9760588 5,90.9869313 C5,90.9910005 5.01657403,91.4944406 5,91.9934657 L0,91.9934657 L0,0 L54,0 L54,91.9934657 L49,91.9934657 Z"></path></g></svg></div><div class="PGU-AutomotiveAxles-Item__AxleIcon PGU-AutomotiveAxles-Item__AxleIcon_AxleTruck"><div class="PGU-AutomotiveAxles-Item__AxleIcon PGU-AutomotiveAxles-Item__AxleIcon_SemiLong"><svg xmlns=http://www.w3.org/2000/svg width=108 height=62 viewBox="0 0 108 62"><path class=PGU-AutomotiveAxles-Item__Truck-Body__Icon fill=none fill-rule=evenodd d="M108,3.99642766 C108,1.78926161 106.215566,-7.10542736e-15 103.995819,-7.10542736e-15 L0,-7.10542736e-15 L0,62 L103.995819,62 C106.207267,62 108,60.2113247 108,58.0035723 L108,3.99642766 Z" transform="matrix(-1 0 0 1 108 0)"></path></svg></div><div class="PGU-AutomotiveAxles-Item__AxleIcon PGU-AutomotiveAxles-Item__AxleIcon_Semi"><svg xmlns=http://www.w3.org/2000/svg width=54 height=62 viewBox="0 0 54 62"><path class=PGU-AutomotiveAxles-Item__Truck-Body__Icon fill=none fill-rule=evenodd d="M54,3.99642766 C54,1.78926161 52.2033234,-1.42108547e-14 50.0073214,-1.42108547e-14 L0,-1.42108547e-14 L0,62 L50.0073214,62 C52.2124169,62 54,60.2113247 54,58.0035723 L54,3.99642766 Z" transform="matrix(-1 0 0 1 54 0)"></path></svg></div><div class="PGU-AutomotiveAxles-Item__AxleIcon PGU-AutomotiveAxles-Item__AxleIcon_Wheel"><svg xmlns=http://www.w3.org/2000/svg width=54 height=45 viewBox="0 0 54 45"><g fill=none fill-rule=evenodd><path class=PGU-AutomotiveAxles-Item__Truck-Body__Icon fill=none d="M49,26 C49,13.8497355 39.1502645,4 27,4 C14.8497355,4 5,13.8497355 5,26 C5,26.672456 5.03017038,27.3378652 5,28 L0,28 C0.0544507576,25.3664063 0.0544507576,22.3664063 0,19 L0,12.6568542 C-1.2991861e-16,11.5959883 0.421427361,10.5785726 1.17157288,9.82842712 L9.82842712,1.17157288 C10.5785726,0.421427361 11.5959883,3.03929442e-14 12.6568542,3.01980663e-14 L43.1044835,3.01980663e-14 C44.304216,3.2108832e-14 45.4405967,0.538507107 46.2003127,1.46704884 L53.0958292,9.89490235 C53.6805416,10.6095509 54,11.5044841 54,12.4278535 L54,28 L49,28 C48.9697014,27.34069 49,26.6738833 49,26 Z"></path><path class=PGU-AutomotiveAxles-Item__Truck-Axle__Icon fill=none fill-rule=nonzero d="M27,38.1891892 C33.1796186,38.1891892 38.1891892,33.1796186 38.1891892,27 C38.1891892,20.8203814 33.1796186,15.8108108 27,15.8108108 C20.8203814,15.8108108 15.8108108,20.8203814 15.8108108,27 C15.8108108,33.1796186 20.8203814,38.1891892 27,38.1891892 Z M27,45 C17.0588745,45 9,36.9411255 9,27 C9,17.0588745 17.0588745,9 27,9 C36.9411255,9 45,17.0588745 45,27 C45,36.9411255 36.9411255,45 27,45 Z"></path><text class="PGU-AutomotiveAxles-Item__Truck-Body__Icon PGU-AutomotiveAxles-Item__Truck-Axle__Text" fill=none font-family="Helvetica, Arial, sans-serif" font-size=14><tspan x=19.019 y=32></tspan></text></g></svg></div></div><div class="PGU-AutomotiveAxles-Item__AxleIcon PGU-AutomotiveAxles-Item__AxleIcon_Middle"><svg xmlns=http://www.w3.org/2000/svg width=54 height=92 viewBox="0 0 54 92"><polygon class=PGU-AutomotiveAxles-Item__Truck-Body__Icon fill=none fill-rule=evenodd points="0 92 0 82.093 0 0 54 0 54 92"></polygon></svg></div><div class="PGU-AutomotiveAxles-Item__AxleIcon PGU-AutomotiveAxles-Item__AxleIcon_Middle"><svg xmlns=http://www.w3.org/2000/svg width=54 height=92 viewBox="0 0 54 92"><polygon class=PGU-AutomotiveAxles-Item__Truck-Body__Icon fill=none fill-rule=evenodd points="0 92 0 82.093 0 0 54 0 54 92"></polygon></svg></div><div class="PGU-AutomotiveAxles-Item__AxleIcon PGU-AutomotiveAxles-Item__AxleIcon-Back"><svg xmlns=http://www.w3.org/2000/svg width=8 height=92 viewBox="0 0 8 92"><path class=PGU-AutomotiveAxles-Item__Truck-Body__Icon fill=none fill-rule=evenodd d="M0,92 L0,0 L-1.46957616e-15,0 C4.418278,-8.11624501e-16 8,3.581722 8,8 L8,84 C8,88.418278 4.418278,92 4.8985872e-16,92 Z"></path></svg></div></div><div class="PGU-AutomotiveAxles-Item__Arrows flex-container align-items-center"><div data-ng-click="onClick_activeDistance(axleItem, -1)" class="PGU-AutomotiveAxles-Item__Arrow-Item PGU-AutomotiveAxles-Item__Arrow-Item_Right"><svg xmlns=http://www.w3.org/2000/svg width=27 height=15 viewBox="0 0 27 15"><path class=PGU-AutomotiveAxles-Item__Truck-Arrow__Icon fill=none fill-rule=evenodd d="M5.03969493,5.96488205 L27,6 L27,9 L5.03969493,9.03511795 L8.36684417,12.3793897 C8.9632756,12.9788906 8.9632756,13.9508735 8.36684417,14.5503744 C7.77041275,15.1498752 6.80340634,15.1498752 6.20697492,14.5503744 L0.447323569,8.76108204 C0.104601359,8.41659608 -0.041185364,7.94912038 0.00996340009,7.5 C-0.041185364,7.05087962 0.104601359,6.58340392 0.447323569,6.23891796 L6.20697492,0.449625637 C6.80340634,-0.149875212 7.77041275,-0.149875212 8.36684417,0.449625637 C8.9632756,1.04912649 8.9632756,2.02110941 8.36684417,2.62061026 L5.03969493,5.96488205 Z" transform="matrix(-1 0 0 1 27 0)"></path></svg></div><div data-ng-click="onClick_activeDistance(axleItem, -1)" class="PGU-AutomotiveAxles-Item__Arrow-Item PGU-AutomotiveAxles-Item__Arrow-Item_Right-Long"><svg xmlns=http://www.w3.org/2000/svg width=53 height=15 viewBox="0 0 53 15"><path class=PGU-AutomotiveAxles-Item__Truck-Arrow__Icon fill=none fill-rule=evenodd d="M5.03969493,5.96488205 L53,6 L53,9 L5.03969493,9.03511795 L8.36684417,12.3793897 C8.9632756,12.9788906 8.9632756,13.9508735 8.36684417,14.5503744 C7.77041275,15.1498752 6.80340634,15.1498752 6.20697492,14.5503744 L0.447323569,8.76108204 C0.104601359,8.41659608 -0.041185364,7.94912038 0.00996340009,7.5 C-0.041185364,7.05087962 0.104601359,6.58340392 0.447323569,6.23891796 L6.20697492,0.449625637 C6.80340634,-0.149875212 7.77041275,-0.149875212 8.36684417,0.449625637 C8.9632756,1.04912649 8.9632756,2.02110941 8.36684417,2.62061026 L5.03969493,5.96488205 Z" transform="matrix(-1 0 0 1 53 0)"></path></svg></div><div data-ng-click="onClick_activeDistance(axleItem, 1)" class="PGU-AutomotiveAxles-Item__Arrow-Item PGU-AutomotiveAxles-Item__Arrow-Item_Left"><svg xmlns=http://www.w3.org/2000/svg width=27 height=15 viewBox="0 0 27 15"><path class=PGU-AutomotiveAxles-Item__Truck-Arrow__Icon fill=none fill-rule=evenodd d="M5.03969493,5.96488205 L27,6 L27,9 L5.03969493,9.03511795 L8.36684417,12.3793897 C8.9632756,12.9788906 8.9632756,13.9508735 8.36684417,14.5503744 C7.77041275,15.1498752 6.80340634,15.1498752 6.20697492,14.5503744 L0.447323569,8.76108204 C0.104601359,8.41659608 -0.041185364,7.94912038 0.00996340009,7.5 C-0.041185364,7.05087962 0.104601359,6.58340392 0.447323569,6.23891796 L6.20697492,0.449625637 C6.80340634,-0.149875212 7.77041275,-0.149875212 8.36684417,0.449625637 C8.9632756,1.04912649 8.9632756,2.02110941 8.36684417,2.62061026 L5.03969493,5.96488205 Z"></path></svg></div><div data-ng-click="onClick_activeDistance(axleItem, 1)" class="PGU-AutomotiveAxles-Item__Arrow-Item PGU-AutomotiveAxles-Item__Arrow-Item_Left-Long"><svg xmlns=http://www.w3.org/2000/svg width=53 height=15 viewBox="0 0 53 15"><path class=PGU-AutomotiveAxles-Item__Truck-Arrow__Icon fill=none fill-rule=evenodd d="M5.03969493,5.96488205 L53,6 L53,9 L5.03969493,9.03511795 L8.36684417,12.3793897 C8.9632756,12.9788906 8.9632756,13.9508735 8.36684417,14.5503744 C7.77041275,15.1498752 6.80340634,15.1498752 6.20697492,14.5503744 L0.447323569,8.76108204 C0.104601359,8.41659608 -0.041185364,7.94912038 0.00996340009,7.5 C-0.041185364,7.05087962 0.104601359,6.58340392 0.447323569,6.23891796 L6.20697492,0.449625637 C6.80340634,-0.149875212 7.77041275,-0.149875212 8.36684417,0.449625637 C8.9632756,1.04912649 8.9632756,2.02110941 8.36684417,2.62061026 L5.03969493,5.96488205 Z"></path></svg></div><div class=PGU-AutomotiveAxles-Item__Arrow-Line></div></div></div></div></div></div></div><div><h4>Двух и более осные</h4><div data-ng-click=addTrailer(2)><div class="PGU-AutomotiveAxles-Item__Truck flex-container align-items-end"><div data-ng-class="{\n                                \'PGU-AutomotiveAxles-Item__Truck-Axle\' : true,\n                                \'PGU-AutomotiveAxles-Item__Truck-Axle_IsTrailerAxle\' : true\n\n                                }"><div><div class="PGU-AutomotiveAxles-Item__Axle flex-container align-items-top"><div class="PGU-AutomotiveAxles-Item__AxleIcon PGU-AutomotiveAxles-Item__AxleIcon_Connector"><svg xmlns=http://www.w3.org/2000/svg width=22 height=93 viewBox="0 0 22 93"><polygon class=PGU-AutomotiveAxles-Item__Truck-Body__Icon fill=none fill-rule=evenodd points="14 87 14 0 22 0 22 93 0 93 0 87"></polygon></svg></div><div class="PGU-AutomotiveAxles-Item__AxleIcon PGU-AutomotiveAxles-Item__AxleIcon_Axle"><svg xmlns=http://www.w3.org/2000/svg width=54 height=109 viewBox="0 0 54 109"><g fill=none fill-rule=evenodd><path class=PGU-AutomotiveAxles-Item__Truck-Axle__Icon fill=none fill-rule=nonzero d="M27,102.189189 C33.1796186,102.189189 38.1891892,97.1796186 38.1891892,91 C38.1891892,84.8203814 33.1796186,79.8108108 27,79.8108108 C20.8203814,79.8108108 15.8108108,84.8203814 15.8108108,91 C15.8108108,97.1796186 20.8203814,102.189189 27,102.189189 Z M27,109 C17.0588745,109 9,100.941125 9,91 C9,81.0588745 17.0588745,73 27,73 C36.9411255,73 45,81.0588745 45,91 C45,100.941125 36.9411255,109 27,109 Z"></path><text class=PGU-AutomotiveAxles-Item__Truck-Body__Icon fill=none font-family="Helvetica, Arial, sans-serif" font-size=14><tspan x=19.019 y=96></tspan></text><path class=PGU-AutomotiveAxles-Item__Truck-Body__Icon fill=none d="M49,91.9934657 C48.983426,91.4944406 49,90.9910005 49,90.9869313 C49,77.9760588 40,68.8431756 27,68.8431756 C14,68.8431756 5,77.9760588 5,90.9869313 C5,90.9910005 5.01657403,91.4944406 5,91.9934657 L0,91.9934657 L0,0 L54,0 L54,91.9934657 L49,91.9934657 Z"></path></g></svg></div><div class="PGU-AutomotiveAxles-Item__AxleIcon PGU-AutomotiveAxles-Item__AxleIcon_AxleTruck"><div class="PGU-AutomotiveAxles-Item__AxleIcon PGU-AutomotiveAxles-Item__AxleIcon_SemiLong"><svg xmlns=http://www.w3.org/2000/svg width=108 height=62 viewBox="0 0 108 62"><path class=PGU-AutomotiveAxles-Item__Truck-Body__Icon fill=none fill-rule=evenodd d="M108,3.99642766 C108,1.78926161 106.215566,-7.10542736e-15 103.995819,-7.10542736e-15 L0,-7.10542736e-15 L0,62 L103.995819,62 C106.207267,62 108,60.2113247 108,58.0035723 L108,3.99642766 Z" transform="matrix(-1 0 0 1 108 0)"></path></svg></div><div class="PGU-AutomotiveAxles-Item__AxleIcon PGU-AutomotiveAxles-Item__AxleIcon_Semi"><svg xmlns=http://www.w3.org/2000/svg width=54 height=62 viewBox="0 0 54 62"><path class=PGU-AutomotiveAxles-Item__Truck-Body__Icon fill=none fill-rule=evenodd d="M54,3.99642766 C54,1.78926161 52.2033234,-1.42108547e-14 50.0073214,-1.42108547e-14 L0,-1.42108547e-14 L0,62 L50.0073214,62 C52.2124169,62 54,60.2113247 54,58.0035723 L54,3.99642766 Z" transform="matrix(-1 0 0 1 54 0)"></path></svg></div><div class="PGU-AutomotiveAxles-Item__AxleIcon PGU-AutomotiveAxles-Item__AxleIcon_Wheel"><svg xmlns=http://www.w3.org/2000/svg width=54 height=45 viewBox="0 0 54 45"><g fill=none fill-rule=evenodd><path class=PGU-AutomotiveAxles-Item__Truck-Body__Icon fill=none d="M49,26 C49,13.8497355 39.1502645,4 27,4 C14.8497355,4 5,13.8497355 5,26 C5,26.672456 5.03017038,27.3378652 5,28 L0,28 C0.0544507576,25.3664063 0.0544507576,22.3664063 0,19 L0,12.6568542 C-1.2991861e-16,11.5959883 0.421427361,10.5785726 1.17157288,9.82842712 L9.82842712,1.17157288 C10.5785726,0.421427361 11.5959883,3.03929442e-14 12.6568542,3.01980663e-14 L43.1044835,3.01980663e-14 C44.304216,3.2108832e-14 45.4405967,0.538507107 46.2003127,1.46704884 L53.0958292,9.89490235 C53.6805416,10.6095509 54,11.5044841 54,12.4278535 L54,28 L49,28 C48.9697014,27.34069 49,26.6738833 49,26 Z"></path><path class=PGU-AutomotiveAxles-Item__Truck-Axle__Icon fill=none fill-rule=nonzero d="M27,38.1891892 C33.1796186,38.1891892 38.1891892,33.1796186 38.1891892,27 C38.1891892,20.8203814 33.1796186,15.8108108 27,15.8108108 C20.8203814,15.8108108 15.8108108,20.8203814 15.8108108,27 C15.8108108,33.1796186 20.8203814,38.1891892 27,38.1891892 Z M27,45 C17.0588745,45 9,36.9411255 9,27 C9,17.0588745 17.0588745,9 27,9 C36.9411255,9 45,17.0588745 45,27 C45,36.9411255 36.9411255,45 27,45 Z"></path><text class=PGU-AutomotiveAxles-Item__Truck-Body__Icon fill=none font-family="Helvetica, Arial, sans-serif" font-size=14><tspan x=19.019 y=32></tspan></text></g></svg></div></div><div class="PGU-AutomotiveAxles-Item__AxleIcon PGU-AutomotiveAxles-Item__AxleIcon_Middle"><svg xmlns=http://www.w3.org/2000/svg width=54 height=92 viewBox="0 0 54 92"><polygon class=PGU-AutomotiveAxles-Item__Truck-Body__Icon fill=none fill-rule=evenodd points="0 92 0 82.093 0 0 54 0 54 92"></polygon></svg></div><div class="PGU-AutomotiveAxles-Item__AxleIcon PGU-AutomotiveAxles-Item__AxleIcon_Middle"><svg xmlns=http://www.w3.org/2000/svg width=54 height=92 viewBox="0 0 54 92"><polygon class=PGU-AutomotiveAxles-Item__Truck-Body__Icon fill=none fill-rule=evenodd points="0 92 0 82.093 0 0 54 0 54 92"></polygon></svg></div><div class="PGU-AutomotiveAxles-Item__AxleIcon PGU-AutomotiveAxles-Item__AxleIcon-Back"><svg xmlns=http://www.w3.org/2000/svg width=8 height=92 viewBox="0 0 8 92"><path class=PGU-AutomotiveAxles-Item__Truck-Body__Icon fill=none fill-rule=evenodd d="M0,92 L0,0 L-1.46957616e-15,0 C4.418278,-8.11624501e-16 8,3.581722 8,8 L8,84 C8,88.418278 4.418278,92 4.8985872e-16,92 Z"></path></svg></div></div><div class="PGU-AutomotiveAxles-Item__Arrows flex-container align-items-center"><div data-ng-click="onClick_activeDistance(axleItem, -1)" class="PGU-AutomotiveAxles-Item__Arrow-Item PGU-AutomotiveAxles-Item__Arrow-Item_Right"><svg xmlns=http://www.w3.org/2000/svg width=27 height=15 viewBox="0 0 27 15"><path class=PGU-AutomotiveAxles-Item__Truck-Arrow__Icon fill=none fill-rule=evenodd d="M5.03969493,5.96488205 L27,6 L27,9 L5.03969493,9.03511795 L8.36684417,12.3793897 C8.9632756,12.9788906 8.9632756,13.9508735 8.36684417,14.5503744 C7.77041275,15.1498752 6.80340634,15.1498752 6.20697492,14.5503744 L0.447323569,8.76108204 C0.104601359,8.41659608 -0.041185364,7.94912038 0.00996340009,7.5 C-0.041185364,7.05087962 0.104601359,6.58340392 0.447323569,6.23891796 L6.20697492,0.449625637 C6.80340634,-0.149875212 7.77041275,-0.149875212 8.36684417,0.449625637 C8.9632756,1.04912649 8.9632756,2.02110941 8.36684417,2.62061026 L5.03969493,5.96488205 Z" transform="matrix(-1 0 0 1 27 0)"></path></svg></div><div data-ng-click="onClick_activeDistance(axleItem, -1)" class="PGU-AutomotiveAxles-Item__Arrow-Item PGU-AutomotiveAxles-Item__Arrow-Item_Right-Long"><svg xmlns=http://www.w3.org/2000/svg width=53 height=15 viewBox="0 0 53 15"><path class=PGU-AutomotiveAxles-Item__Truck-Arrow__Icon fill=none fill-rule=evenodd d="M5.03969493,5.96488205 L53,6 L53,9 L5.03969493,9.03511795 L8.36684417,12.3793897 C8.9632756,12.9788906 8.9632756,13.9508735 8.36684417,14.5503744 C7.77041275,15.1498752 6.80340634,15.1498752 6.20697492,14.5503744 L0.447323569,8.76108204 C0.104601359,8.41659608 -0.041185364,7.94912038 0.00996340009,7.5 C-0.041185364,7.05087962 0.104601359,6.58340392 0.447323569,6.23891796 L6.20697492,0.449625637 C6.80340634,-0.149875212 7.77041275,-0.149875212 8.36684417,0.449625637 C8.9632756,1.04912649 8.9632756,2.02110941 8.36684417,2.62061026 L5.03969493,5.96488205 Z" transform="matrix(-1 0 0 1 53 0)"></path></svg></div><div data-ng-click="onClick_activeDistance(axleItem, 1)" class="PGU-AutomotiveAxles-Item__Arrow-Item PGU-AutomotiveAxles-Item__Arrow-Item_Left"><svg xmlns=http://www.w3.org/2000/svg width=27 height=15 viewBox="0 0 27 15"><path class=PGU-AutomotiveAxles-Item__Truck-Arrow__Icon fill=none fill-rule=evenodd d="M5.03969493,5.96488205 L27,6 L27,9 L5.03969493,9.03511795 L8.36684417,12.3793897 C8.9632756,12.9788906 8.9632756,13.9508735 8.36684417,14.5503744 C7.77041275,15.1498752 6.80340634,15.1498752 6.20697492,14.5503744 L0.447323569,8.76108204 C0.104601359,8.41659608 -0.041185364,7.94912038 0.00996340009,7.5 C-0.041185364,7.05087962 0.104601359,6.58340392 0.447323569,6.23891796 L6.20697492,0.449625637 C6.80340634,-0.149875212 7.77041275,-0.149875212 8.36684417,0.449625637 C8.9632756,1.04912649 8.9632756,2.02110941 8.36684417,2.62061026 L5.03969493,5.96488205 Z"></path></svg></div><div data-ng-click="onClick_activeDistance(axleItem, 1)" class="PGU-AutomotiveAxles-Item__Arrow-Item PGU-AutomotiveAxles-Item__Arrow-Item_Left-Long"><svg xmlns=http://www.w3.org/2000/svg width=53 height=15 viewBox="0 0 53 15"><path class=PGU-AutomotiveAxles-Item__Truck-Arrow__Icon fill=none fill-rule=evenodd d="M5.03969493,5.96488205 L53,6 L53,9 L5.03969493,9.03511795 L8.36684417,12.3793897 C8.9632756,12.9788906 8.9632756,13.9508735 8.36684417,14.5503744 C7.77041275,15.1498752 6.80340634,15.1498752 6.20697492,14.5503744 L0.447323569,8.76108204 C0.104601359,8.41659608 -0.041185364,7.94912038 0.00996340009,7.5 C-0.041185364,7.05087962 0.104601359,6.58340392 0.447323569,6.23891796 L6.20697492,0.449625637 C6.80340634,-0.149875212 7.77041275,-0.149875212 8.36684417,0.449625637 C8.9632756,1.04912649 8.9632756,2.02110941 8.36684417,2.62061026 L5.03969493,5.96488205 Z"></path></svg></div><div class=PGU-AutomotiveAxles-Item__Arrow-Line></div></div></div></div><div><div><div class="PGU-AutomotiveAxles-Item__Axle flex-container align-items-top"><div class="PGU-AutomotiveAxles-Item__AxleIcon PGU-AutomotiveAxles-Item__AxleIcon_Axle"><svg xmlns=http://www.w3.org/2000/svg width=54 height=109 viewBox="0 0 54 109"><g fill=none fill-rule=evenodd><path class=PGU-AutomotiveAxles-Item__Truck-Axle__Icon fill=none fill-rule=nonzero d="M27,102.189189 C33.1796186,102.189189 38.1891892,97.1796186 38.1891892,91 C38.1891892,84.8203814 33.1796186,79.8108108 27,79.8108108 C20.8203814,79.8108108 15.8108108,84.8203814 15.8108108,91 C15.8108108,97.1796186 20.8203814,102.189189 27,102.189189 Z M27,109 C17.0588745,109 9,100.941125 9,91 C9,81.0588745 17.0588745,73 27,73 C36.9411255,73 45,81.0588745 45,91 C45,100.941125 36.9411255,109 27,109 Z"></path><text class=PGU-AutomotiveAxles-Item__Truck-Body__Icon fill=none font-family="Helvetica, Arial, sans-serif" font-size=14><tspan x=19.019 y=96></tspan></text><path class=PGU-AutomotiveAxles-Item__Truck-Body__Icon fill=none d="M49,91.9934657 C48.983426,91.4944406 49,90.9910005 49,90.9869313 C49,77.9760588 40,68.8431756 27,68.8431756 C14,68.8431756 5,77.9760588 5,90.9869313 C5,90.9910005 5.01657403,91.4944406 5,91.9934657 L0,91.9934657 L0,0 L54,0 L54,91.9934657 L49,91.9934657 Z"></path></g></svg></div><div class="PGU-AutomotiveAxles-Item__AxleIcon PGU-AutomotiveAxles-Item__AxleIcon_AxleTruck"><div class="PGU-AutomotiveAxles-Item__AxleIcon PGU-AutomotiveAxles-Item__AxleIcon_SemiLong"><svg xmlns=http://www.w3.org/2000/svg width=108 height=62 viewBox="0 0 108 62"><path class=PGU-AutomotiveAxles-Item__Truck-Body__Icon fill=none fill-rule=evenodd d="M108,3.99642766 C108,1.78926161 106.215566,-7.10542736e-15 103.995819,-7.10542736e-15 L0,-7.10542736e-15 L0,62 L103.995819,62 C106.207267,62 108,60.2113247 108,58.0035723 L108,3.99642766 Z" transform="matrix(-1 0 0 1 108 0)"></path></svg></div><div class="PGU-AutomotiveAxles-Item__AxleIcon PGU-AutomotiveAxles-Item__AxleIcon_Semi"><svg xmlns=http://www.w3.org/2000/svg width=54 height=62 viewBox="0 0 54 62"><path class=PGU-AutomotiveAxles-Item__Truck-Body__Icon fill=none fill-rule=evenodd d="M54,3.99642766 C54,1.78926161 52.2033234,-1.42108547e-14 50.0073214,-1.42108547e-14 L0,-1.42108547e-14 L0,62 L50.0073214,62 C52.2124169,62 54,60.2113247 54,58.0035723 L54,3.99642766 Z" transform="matrix(-1 0 0 1 54 0)"></path></svg></div><div class="PGU-AutomotiveAxles-Item__AxleIcon PGU-AutomotiveAxles-Item__AxleIcon_Wheel"><svg xmlns=http://www.w3.org/2000/svg width=54 height=45 viewBox="0 0 54 45"><g fill=none fill-rule=evenodd><path class=PGU-AutomotiveAxles-Item__Truck-Body__Icon fill=none d="M49,26 C49,13.8497355 39.1502645,4 27,4 C14.8497355,4 5,13.8497355 5,26 C5,26.672456 5.03017038,27.3378652 5,28 L0,28 C0.0544507576,25.3664063 0.0544507576,22.3664063 0,19 L0,12.6568542 C-1.2991861e-16,11.5959883 0.421427361,10.5785726 1.17157288,9.82842712 L9.82842712,1.17157288 C10.5785726,0.421427361 11.5959883,3.03929442e-14 12.6568542,3.01980663e-14 L43.1044835,3.01980663e-14 C44.304216,3.2108832e-14 45.4405967,0.538507107 46.2003127,1.46704884 L53.0958292,9.89490235 C53.6805416,10.6095509 54,11.5044841 54,12.4278535 L54,28 L49,28 C48.9697014,27.34069 49,26.6738833 49,26 Z"></path><path class=PGU-AutomotiveAxles-Item__Truck-Axle__Icon fill=none fill-rule=nonzero d="M27,38.1891892 C33.1796186,38.1891892 38.1891892,33.1796186 38.1891892,27 C38.1891892,20.8203814 33.1796186,15.8108108 27,15.8108108 C20.8203814,15.8108108 15.8108108,20.8203814 15.8108108,27 C15.8108108,33.1796186 20.8203814,38.1891892 27,38.1891892 Z M27,45 C17.0588745,45 9,36.9411255 9,27 C9,17.0588745 17.0588745,9 27,9 C36.9411255,9 45,17.0588745 45,27 C45,36.9411255 36.9411255,45 27,45 Z"></path><text class=PGU-AutomotiveAxles-Item__Truck-Body__Icon fill=none font-family="Helvetica, Arial, sans-serif" font-size=14><tspan x=19.019 y=32></tspan></text></g></svg></div></div><div class="PGU-AutomotiveAxles-Item__AxleIcon PGU-AutomotiveAxles-Item__AxleIcon_Middle"><svg xmlns=http://www.w3.org/2000/svg width=54 height=92 viewBox="0 0 54 92"><polygon class=PGU-AutomotiveAxles-Item__Truck-Body__Icon fill=none fill-rule=evenodd points="0 92 0 82.093 0 0 54 0 54 92"></polygon></svg></div><div class="PGU-AutomotiveAxles-Item__AxleIcon PGU-AutomotiveAxles-Item__AxleIcon_Middle"><svg xmlns=http://www.w3.org/2000/svg width=54 height=92 viewBox="0 0 54 92"><polygon class=PGU-AutomotiveAxles-Item__Truck-Body__Icon fill=none fill-rule=evenodd points="0 92 0 82.093 0 0 54 0 54 92"></polygon></svg></div><div class="PGU-AutomotiveAxles-Item__AxleIcon PGU-AutomotiveAxles-Item__AxleIcon-Back"><svg xmlns=http://www.w3.org/2000/svg width=8 height=92 viewBox="0 0 8 92"><path class=PGU-AutomotiveAxles-Item__Truck-Body__Icon fill=none fill-rule=evenodd d="M0,92 L0,0 L-1.46957616e-15,0 C4.418278,-8.11624501e-16 8,3.581722 8,8 L8,84 C8,88.418278 4.418278,92 4.8985872e-16,92 Z"></path></svg></div></div><div class="PGU-AutomotiveAxles-Item__Arrows flex-container align-items-center"><div data-ng-click="onClick_activeDistance(axleItem, -1)" class="PGU-AutomotiveAxles-Item__Arrow-Item PGU-AutomotiveAxles-Item__Arrow-Item_Right"><svg xmlns=http://www.w3.org/2000/svg width=27 height=15 viewBox="0 0 27 15"><path class=PGU-AutomotiveAxles-Item__Truck-Arrow__Icon fill=none fill-rule=evenodd d="M5.03969493,5.96488205 L27,6 L27,9 L5.03969493,9.03511795 L8.36684417,12.3793897 C8.9632756,12.9788906 8.9632756,13.9508735 8.36684417,14.5503744 C7.77041275,15.1498752 6.80340634,15.1498752 6.20697492,14.5503744 L0.447323569,8.76108204 C0.104601359,8.41659608 -0.041185364,7.94912038 0.00996340009,7.5 C-0.041185364,7.05087962 0.104601359,6.58340392 0.447323569,6.23891796 L6.20697492,0.449625637 C6.80340634,-0.149875212 7.77041275,-0.149875212 8.36684417,0.449625637 C8.9632756,1.04912649 8.9632756,2.02110941 8.36684417,2.62061026 L5.03969493,5.96488205 Z" transform="matrix(-1 0 0 1 27 0)"></path></svg></div><div data-ng-click="onClick_activeDistance(axleItem, -1)" class="PGU-AutomotiveAxles-Item__Arrow-Item PGU-AutomotiveAxles-Item__Arrow-Item_Right-Long"><svg xmlns=http://www.w3.org/2000/svg width=53 height=15 viewBox="0 0 53 15"><path class=PGU-AutomotiveAxles-Item__Truck-Arrow__Icon fill=none fill-rule=evenodd d="M5.03969493,5.96488205 L53,6 L53,9 L5.03969493,9.03511795 L8.36684417,12.3793897 C8.9632756,12.9788906 8.9632756,13.9508735 8.36684417,14.5503744 C7.77041275,15.1498752 6.80340634,15.1498752 6.20697492,14.5503744 L0.447323569,8.76108204 C0.104601359,8.41659608 -0.041185364,7.94912038 0.00996340009,7.5 C-0.041185364,7.05087962 0.104601359,6.58340392 0.447323569,6.23891796 L6.20697492,0.449625637 C6.80340634,-0.149875212 7.77041275,-0.149875212 8.36684417,0.449625637 C8.9632756,1.04912649 8.9632756,2.02110941 8.36684417,2.62061026 L5.03969493,5.96488205 Z" transform="matrix(-1 0 0 1 53 0)"></path></svg></div><div data-ng-click="onClick_activeDistance(axleItem, 1)" class="PGU-AutomotiveAxles-Item__Arrow-Item PGU-AutomotiveAxles-Item__Arrow-Item_Left"><svg xmlns=http://www.w3.org/2000/svg width=27 height=15 viewBox="0 0 27 15"><path class=PGU-AutomotiveAxles-Item__Truck-Arrow__Icon fill=none fill-rule=evenodd d="M5.03969493,5.96488205 L27,6 L27,9 L5.03969493,9.03511795 L8.36684417,12.3793897 C8.9632756,12.9788906 8.9632756,13.9508735 8.36684417,14.5503744 C7.77041275,15.1498752 6.80340634,15.1498752 6.20697492,14.5503744 L0.447323569,8.76108204 C0.104601359,8.41659608 -0.041185364,7.94912038 0.00996340009,7.5 C-0.041185364,7.05087962 0.104601359,6.58340392 0.447323569,6.23891796 L6.20697492,0.449625637 C6.80340634,-0.149875212 7.77041275,-0.149875212 8.36684417,0.449625637 C8.9632756,1.04912649 8.9632756,2.02110941 8.36684417,2.62061026 L5.03969493,5.96488205 Z"></path></svg></div><div data-ng-click="onClick_activeDistance(axleItem, 1)" class="PGU-AutomotiveAxles-Item__Arrow-Item PGU-AutomotiveAxles-Item__Arrow-Item_Left-Long"><svg xmlns=http://www.w3.org/2000/svg width=53 height=15 viewBox="0 0 53 15"><path class=PGU-AutomotiveAxles-Item__Truck-Arrow__Icon fill=none fill-rule=evenodd d="M5.03969493,5.96488205 L53,6 L53,9 L5.03969493,9.03511795 L8.36684417,12.3793897 C8.9632756,12.9788906 8.9632756,13.9508735 8.36684417,14.5503744 C7.77041275,15.1498752 6.80340634,15.1498752 6.20697492,14.5503744 L0.447323569,8.76108204 C0.104601359,8.41659608 -0.041185364,7.94912038 0.00996340009,7.5 C-0.041185364,7.05087962 0.104601359,6.58340392 0.447323569,6.23891796 L6.20697492,0.449625637 C6.80340634,-0.149875212 7.77041275,-0.149875212 8.36684417,0.449625637 C8.9632756,1.04912649 8.9632756,2.02110941 8.36684417,2.62061026 L5.03969493,5.96488205 Z"></path></svg></div><div class=PGU-AutomotiveAxles-Item__Arrow-Line></div></div></div></div></div></div></div></div><div class=flex-container><div><a data-ng-href="" class="PGU-Button PGU-Btn-Base PGU-Btn-White" data-ng-click=toggleModalVisible(false);>Отменить</a></div></div></div></modal-dialog></div></div>'),
$templateCache.put("js/components/Bundles/Bundles.html",'<div ng-show=!!item.visible id={{::$id}} full-path={{::item.fullPath}} class=PGU-Bundles ng-class="{\'editor-item-selected\': item.currentItem, \'editor-item-hovered\': item.hoverItem}"><div ng-if=item.title class="PGU-FormStepTitleWrap sm-offset-top-16"><h3 class="PGU-title PGU-title_form-step"><span>{{item.title}}</span></h3></div><form-tree data-ng-if="!$root.isDesigner && item.items && item.items.length" data-ng-repeat="el in item.items track by $index" item=el></form-tree><div data-ng-if=$root.isDesigner style="padding: 20px 0;"><span style="font-weight: bold;">{{item.classNameRu}}</span></div></div>'),$templateCache.put("js/components/Captcha/Captcha.html",'<div class=PGU-Captcha ng-show=(!!item.visible) full-path={{::item.fullPath}}><h3 class="PGU-title PGU-title_form-step">{{title}}</h3><div class=captcha-plugin id=captcha-plugin></div></div>'),$templateCache.put("js/components/ClinicExam/ClinicExam.html",'<div class=PGU-ClinicExam full-path={{::item.fullPath}} ng-show=!!item.visible><epgu-throbber data-ng-if="item.loading && !item.dataError" data-throbber-type=PGU-throbber-big data-show-heading=true></epgu-throbber><div data-ng-if=item.dataError class="PGU-ClinicExam-EmptyResponseMsg PGU-Advice-InForm PGU-Advice-type-warn"><h3 class=PGU-Title-H3><span class="PGU-Icon PGU-Advice-icon"></span> <span>Ошибка получения данных</span></h3><p>Не удалось получить данные, попробуйте повторить попытку позже</p></div><div><div data-ng-if="!item.loading && !item.dataError" data-ng-class="{\'PGU-ClinicExam-item\': true, \'PGU-ClinicExam-item-blur\': medItem.preCancel}" data-id=ClinicExam{{medItem.id}} data-ng-repeat="medItem in item.medicalData"><div class="PGU-ClinicExam-item-service-name bold">{{medItem.medicalService.serviceName}}</div><div class=PGU-ClinicExam-info-container><div class=PGU-ClinicExam-info-book><div class="PGU-ClinicExam-status dark" data-ng-if=medItem.epguStatus.title><span class="status {{medItem.epguStatus.value}}">{{medItem.epguStatus.title}}</span></div><div class="PGU-ClinicExam-item-wrapper {{medItem.placement}}"><div data-ng-if=medItem.bookingData><div><div class=PGU-ClinicExam-time><span class=dark>Дата и время записи: </span><span class="bold black next-line">{{medItem.bookingData.bookingDateTime | rusTimeDate}}</span></div><div class="PGU-ClinicExam-hint gray">(в часовом поясе медицинской организации)</div></div><div class="PGU-ClinicExam-hint black bold"><div data-ng-if=isPhone><question item=questionHelper></question></div><span class=PGU-ClinicExam-hint-resource>{{medItem.bookingData.resource.resourceName}}, кабинет {{medItem.bookingData.resource.room}}</span><div class=question-helper-wrapper data-ng-if=!isPhone><question item=questionHelper></question></div></div><div data-ng-if=isPhone class="PGU-BtnHolder PGU-BtnContainer-column"><div class=PGU-ClinicExam-map-button-wrapper><a class="PGU-Button PGU-Btn-Base PGU-Btn-Small PGU-Btn-White PGU-ClinicExam-map-button" data-ng-click="openClinicPopup($event, medItem.bookingData.clinic, medItem.id)">Место приема</a></div></div><div data-ng-show=medItem.preCancel><form-tree ng-repeat="item_i in medItem._timeSlots" item=item_i></form-tree></div></div><div data-ng-if="!medItem.bookingData && medItem.epguStatus.value === \'unavailable\'"><span class=PGU-ClinicExam-unavailable-reason>{{medItem.unavailableReason}}</span></div><div data-ng-if="medItem.epguStatus.value === \'available\'"><div data-ng-if=!medItem.clinicsDropdown><div data-ng-if=!isPhone class=PGU-ClinicExam-Place-Info-avail><div class=PGU-ClinicExam-Place-Info-header>Место приема</div><div class=PGU-ClinicExam-Place-Info-clinic-name>{{medItem.availableClinicResources[0].clinic.clinicName}}</div><div data-ng-click="openClinicPopup($event,medItem.availableClinicResources[0].clinic, medItem.id)" class=PGU-ClinicExam-Place-Info-clinic-address-wrap><div class=PGU-ClinicExam-Place-Info-clinic-address>{{medItem.availableClinicResources[0].clinic.clinicAddress}}</div></div></div><div data-ng-if=isPhone class="PGU-BtnHolder PGU-BtnContainer-column"><div class=PGU-ClinicExam-map-button-wrapper><a class="PGU-Button PGU-Btn-Base PGU-Btn-Small PGU-Btn-White PGU-ClinicExam-map-button" data-ng-click="openClinicPopup($event, medItem.availableClinicResources[0].clinic, medItem.id)">Место приема</a></div></div></div><div data-ng-if="medItem.clinicsDropdown && medItem.clinicsDropdown.length" class=PGU-ClinicExam-resource-container ng-repeat="resource in medItem.clinicsDropdown"><epgu-field-dropdown item=resource></epgu-field-dropdown></div><div class="PGU-ClinicExam-Place-Info With-clinics-list" data-ng-if="medItem.clinicData && medItem.clinicsDropdown"><div data-ng-if=!isPhone><div class=PGU-ClinicExam-Place-Info-clinic-address-wrap data-ng-click="openClinicPopup($event, medItem.clinicData.clinic, medItem.id)"><span class=PGU-ClinicExam-Place-Info-clinic-address>{{medItem.clinicData.clinic.clinicAddress}}</span></div></div><div data-ng-if=isPhone class="PGU-BtnHolder PGU-BtnContainer-column"><div class=PGU-ClinicExam-map-button-wrapper><a class="PGU-Button PGU-Btn-Base PGU-Btn-Small PGU-Btn-White PGU-ClinicExam-map-button" data-ng-click="openClinicPopup($event, medItem.clinicData.clinic, medItem.id)">На карте</a></div></div></div><div class=PGU-ClinicExam-resource-container><form-tree ng-repeat="item_i in medItem.resourceDropdown" item=item_i></form-tree></div><div data-ng-if=medItem.selectedResource class=PGU-ClinicExam-agg-container><div class="PGU-ClinicExam-agg-recommended three-quarter" data-ng-if=medItem.selectedResource.recommendedSlot><div class=PGU-ClinicExam-recommended-time><span class="PGU-ClinicExam-hint black bold">Рекомендуемое время:</span><br data-ng-if="$root.version !== \'dk\'"><span>{{medItem.selectedResource.recommendedSlot.slotDateTime | rusTimeDate}}</span></div><div class="PGU-BtnHolder PGU-BtnContainer-column agg"><div><a class="PGU-Button PGU-Btn-Base PGU-Btn-Small PGU-Btn-Blue PGU-ClinicExam-agg-button" data-ng-click="bookToRecommended($event, medItem)">Записаться</a></div></div></div><div data-ng-if=!medItem.hideSlotSelectLink data-ng-class="{\n                                \'one-quarter\': medItem.selectedResource.recommendedSlot && !medItem.clinicsDropdown && $root.version !== \'pad\',\n                                \'full\': !medItem.selectedResource.recommendedSlot || (medItem.clinicsDropdown && $root.version === \'pad\'),\n                                \'PGU-ClinicExam-agg-another-time\': true}"><a data-ng-click="ui.openSlots($event, medItem)" data-ng-class="{\'open\': medItem.timeSlotOpen, \'PGU-ClinicExam-timeslot-switcher\': true, \'disabled\': !medItem.canHideTimeSlot}"><span>{{!medItem.timeSlotOpen ? (medItem.selectedResource.recommendedSlot ? \'Выбрать другое время\' : \'Выбрать время для записи\') : \'Скрыть\'}}</span></a></div></div><div data-ng-show="medItem.timeSlotOpen || item.fastBook"><form-tree ng-repeat="item_i in medItem._timeSlots" item=item_i></form-tree></div></div></div></div><div class=PGU-ClinicExam-actions data-ng-if="medItem.bookingData && medItem.bookingData.bookingId"><div class=PGU-ClinicExam-details><a target=_blank data-ng-href={{medItem.detailUrl}}>Информация о записи</a></div><div class=PGU-ClinicExam-cancel-book data-ng-click=cancelBook(medItem)><span class=cancel-text>Отменить запись</span></div></div><div class=PGU-ClinicExam-throbber><epgu-throbber data-ng-show=medItem.preCancel data-throbber-type=PGU-throbber-big></epgu-throbber></div></div><div class=PGU-ClinicExam-Place-Info data-ng-if="medItem.bookingData && !isPhone && !medItem.clinicsDropdown"><div class=PGU-ClinicExam-Place-Info-header>Место приема</div><div class=PGU-ClinicExam-Place-Info-clinic-name>{{medItem.bookingData.clinic.clinicName}}</div><div class=PGU-ClinicExam-Place-Info-clinic-address-wrap data-ng-click="openClinicPopup($event, medItem.bookingData.clinic, medItem.id)"><span class=PGU-ClinicExam-Place-Info-clinic-address>{{medItem.bookingData.clinic.clinicAddress}}</span></div></div><div class="PGU-ClinicExam-ErrorMsg PGU-Error" data-ng-if=medItem.errorText>{{medItem.errorText}}</div></div></div><modal-dialog back-btn-name=true hide-outside-click=false show=showCard><div class=PGU-ClinicExam-PopupWrapper data-ng-if=showCard><div data-ng-if="($root.version === \'mob\')" class=PGU-ClinicExam-WrapContentBtn><a class=PGU-ClinicExam-back-button data-ng-click=ui.closePopup($event)></a></div><div class=PGU-ClinicExam-Popup-Header>Место приема</div><div class=PGU-ClinicExam-Popup-ClinicName>{{ui.popupInfo.clinicName}}</div><div class=PGU-ClinicExam-Popup-ClinicAddress>{{ui.popupInfo.clinicAddress}}</div><div style="height: 300px"><epgu-field-map item=ui.popupInfo._medMap[0]></epgu-field-map></div><a class="PGU-ClinicExam-PopupCloseIcon close_popup_x" data-ng-if="($root.version !== \'mob\')" data-ng-click=ui.closePopup($event)></a></div></modal-dialog></div>'),$templateCache.put("js/components/ConfirmPanel/ConfirmPanel.html",'<div id={{::$id}} data-ng-show=!!item.visible class=PGU-{{::item.className}} full-path={{::item.fullPath}}><div class="PGU-ConfirmPanelWrapButtons cf"><epgu-form-button item=ui.btnCancel click-handler-btn=cancelConfirm click-attr=(true)></epgu-form-button><epgu-form-button item=ui.btnApply click-handler-btn=applyConfirm click-attr=(true)></epgu-form-button></div></div>'),$templateCache.put("js/components/DataGrid/DataGrid.html",'<div ng-show=(!!item.visible) full-path={{item.fullPath}}><script type=text/ng-template id=include/to-ten-pages.html><li ng-repeat="page in [] | range:item.paging.totalPages track by $index"\n            ng-click="setPage($event, page + 1);"\n            ng-class="{\'active\': item.paging.currentPage == page}">\n            {{page+1}}\n        </li><\/script><script type=text/ng-template id=include/more-ten-pages.html><li ng-click="setPage($event, 1);"\n            ng-class="{\'active\': item.paging.currentPage == 0}">\n            1\n        </li><li class="more" data-ng-if="item.paging.currentPage > 3">\n            ...\n        </li><li\n                ng-repeat="page in [] | range:item.paging.totalPages - 2 track by $index"\n                ng-click="setPage($event, page + 1);"\n                ng-class="{\'active\': item.paging.currentPage == page}"\n                ng-if="(page > 0 && page < item.paging.totalPages - 1)\n                    && ((item.paging.currentPage > 3 && item.paging.currentPage < item.paging.totalPages - 4 && page > item.paging.currentPage - 3 && page < item.paging.currentPage + 3)\n                    || (item.paging.currentPage < 4 && page < 7)\n                    || (item.paging.currentPage >  item.paging.totalPages - 6 && page > item.paging.totalPages - 8))"\n            >\n            {{page+1}}\n        </li><li class="more" data-ng-if="item.paging.currentPage < item.paging.totalPages - 5">\n            ...\n        </li><li ng-click="setPage($event, item.paging.totalPages);"\n            ng-class="{\'active\': item.paging.currentPage == item.paging.totalPages - 1}">\n            {{item.paging.totalPages - 1}}\n        </li><\/script><div class="PGU-Panel PGU-LabelWidth-{{item.labelWidth}} PGU-Panel-Width-{{item.width}}"><div class=PGU-Panel-inner><div class="ITEMS_CONTAINER datagridparent" ng-if=item.items><div ng-repeat="listItem in list track by $index"><form-tree ng-repeat="item_i in listItem.items track by $index" item=item_i></form-tree></div></div></div></div><div class="CLONES_CONTAINER datagrid_container"><div ng-repeat="clone in item.clones track by $index" ng-show="($index >= item.paging.currentPage*item.paging.pageSize) && ($index < (item.paging.currentPage+1)*item.paging.pageSize)"><form-tree ng-repeat="item_g in clone.items track by $index" item=item_g></form-tree></div></div><div class=x-clear></div><div class=PGU-DataGrid-paging ng-if=true><ul data-ng-if="item.paging.totalPages <= 10 && item.paging.totalPages > 1" ng-include="\'include/to-ten-pages.html\'"></ul><ul data-ng-if="item.paging.totalPages > 10" ng-include="\'include/more-ten-pages.html\'"></ul></div></div>'),$templateCache.put("js/components/EditableDataGrid/EditableDataGrid.html",'<div data-ng-show=!!item.visible data-ng-attr-style={{::item.inlineCSS}} data-ng-class="{\n        \'PGU-Disabled\': item.disabled\n    }" id={{::$id}} full-path={{::item.fullPath}}><div class=PGU-EditableDataGrid><div class="PGU-EditableDataGridWrapButtons cf"><epgu-form-button data-ng-if=!isMobile item=ui.btnClear click-handler-btn=clearAll click-attr=(true)></epgu-form-button><epgu-form-button item=ui.btnAddStringState click-handler-btn=addStringState click-attr=(true)></epgu-form-button><epgu-form-button item=ui.btnUploadState click-handler-btn=uploadState click-attr=(true)></epgu-form-button><form-tree ng-repeat="item_i in ::customUploaderState.customFields track by $index" item=item_i></form-tree><epgu-form-button data-ng-if=isMobile item=ui.btnClear click-handler-btn=clearAll click-attr=(true)></epgu-form-button></div><div class=PGU-EditableDataGridListWrap><div data-ng-show=grid.loading class=PGU-EditableDataGridLoader><div class=PGU-EditableDataGridLoaderShadow></div><div class=PGU-EditableDataGridLoader><div class=PGU-throbber-svg><div class=PGU-throbber-svg-header><h3 class=PGU-Service-h3>Идет загрузка</h3><p class=PGU-Service-PlainText>Это может занять некоторое время</p></div><div class=PGU-throbber-medium> <?xml version="1.0" encoding="utf-8"?> <svg version=1.1 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink x=0px y=0px width=104px height=104px viewBox="0 0 92 100" enable-background="new 0 0 92 100" xml:space=preserve><path fill=#00aadd class=PGU-throbber-path d="M81.765,82.649L56.607,97.19c-6.479,3.744-14.462,3.746-20.942,0.01L10.493,82.682\n                                    C4.012,78.944,0.017,72.032,0.014,64.549L0,35.493c-0.003-7.482,3.985-14.398,10.463-18.141L35.621,2.811\n                                    c6.478-3.744,14.46-3.748,20.943-0.011l25.171,14.519c6.481,3.738,10.476,10.648,10.479,18.131l0.014,29.059\n                                    C92.231,71.989,88.244,78.905,81.765,82.649"></path></svg></div></div></div></div><div class=PGU-Fluid-Row data-ng-if=::item.showGridSearch><div class=PGU-Col-20><div data-ng-class="{\n                            \'PGU-FieldText\': true,\n                            \'PGU-FieldText-Filter\': true,\n                            \'PGU-FieldText-Small-Placeholder\': (gridFilter.value && (gridFilter.value != \'\')),\n                         }"><label for={{::gridFilter.id}} class=PGU-longLabel data-ng-if="gridFilter.label && gridFilter.label.length > 85">{{gridFilter.label}}</label><div class="PGU-FieldTextInput PGU-FieldBody"><label class="PGU-FieldLabel PGU-FieldLabel-Input" data-ng-if="gridFilter.label && gridFilter.label.length <= 85" for={{::gridFilter.id}}>{{gridFilter.label}}</label><div class=PGU-Input-Wrap><input class="PGU-FieldTextInputBasic PGU-Icon-Filter field-padded -metrika-nokeys" data-ng-model=gridFilter.value id={{::gridFilter.id}}></div></div></div></div></div><div data-ng-show=gridFilter.empty>Ничего не найдено</div><div data-ng-show=!gridFilter.empty data-ng-class="{\'PGU-EditableDataGridList\': true, \'PGU-EditableDataGridList-Mobile\': isMobile, \'PGU-EditableDataGridList_withButton\': item.customEditButtonLabel,}"><div data-ng-show="grid.showHeader && !isMobile" class="PGU-Fluid-Row PGU-EditableDataGridList-Header"><div class="PGU-Col-2 PGU-EditableDataGridList-Header-Col-2 PGU-Col-FlexGrow-1"><strong>{{::item.fieldNumName}}</strong></div><div data-ng-class="{\'PGU-Col-{{::columnWidth}}\': columnWidth, \'PGU-Col-FlexGrow-1\': true}" data-ng-repeat="cell in gridConfig.header track by $index" data-ng-attr-style={{gridConfig.styles[$index]}}><strong>{{(item.fullPath + \'.gridColumnLabels\' | translate:cell.label:$index) || cell.label}}</strong></div><div class=PGU-Col-Actions></div></div><div class="PGU-Fluid-Row PGU-EditableDataGridList-Row" data-ng-repeat="row in grid.list track by $index"><div data-ng-if=::isMobile class="PGU-Col-2 PGU-EditableDataGridList-Cell PGU-Col-FlexGrow-1"><div class=PGU-EditableDataGridList-Cell-Header><strong>{{::item.fieldNumName}}</strong></div><div class=PGU-EditableDataGridList-Cell-Content>{{$index + 1 + item.pageSize * (paging.currentPage - 1)}}</div></div><div data-ng-if=::!isMobile class="PGU-Col-2 PGU-EditableDataGridList-Header-Col-2 PGU-EditableDataGridList-Cell PGU-Col-FlexGrow-1">{{$index + 1 + item.pageSize * (paging.currentPage - 1)}}</div><div data-ng-class="{\'PGU-Col-{{::columnWidth}}\': columnWidth, \'PGU-EditableDataGridList-Cell\': true, \'PGU-Col-FlexGrow-1\': true}" data-ng-repeat="item in row.cells track by $index" data-ng-attr-style={{gridConfig.styles[$index]}}><div class=PGU-EditableDataGridList-Cell-Header><strong>{{item.mobileCellLabel}}</strong></div><div class=PGU-EditableDataGridList-Cell-Content data-ng-class="{\n                                \'PGU-EditableDataGridList-Cell-Content-WitIcon\': item.cellWithIcon,\n                                \'PGU-EditableDataGridList-Cell-Content-Status-ok\': item.status === \'ok\',\n                                \'PGU-EditableDataGridList-Cell-Content-Status-cancel\': item.status === \'cancel\',\n                                \'PGU-EditableDataGridList-Cell-Content-Status-wait\': item.status === \'wait\',\n                                \'PGU-EditableDataGridList-Cell-Content-Status-receive\': item.status === \'receive\',\n                                \'PGU-EditableDataGridList-Cell-Content-Text-full\': notOverflowText,\n                                \'PGU-EditableDataGridList-Cell-Content-Text-center\': alignText === \'center\',\n                                }" data-ng-bind-html=item.title></div></div><div data-ng-class="{\n                        \'PGU-Col-Actions\': true,\n                        \'PGU-EditableDataGridList-Cell\': true,\n                        \'PGU-Col-Actions-Disabled\': row.isDisabled}" class="PGU-Col-Actions PGU-EditableDataGridList-Cell"><a data-ng-if=::!item.customEditButtonLabel class=PGU-EditableDataGridList-Row-Action data-ng-href="" data-ng-click="deleteRow($event, $index, row.id)"><span class="PGU-Icon PGU-Icon-Delete-Row"></span> <span title=Удалить class="PGU-EditableDataGridList-Row-Action__title PGU-EditableDataGridList-Row-Action__title_color_red">Удалить</span> </a><a data-ng-if=::!item.customEditButtonLabel class=PGU-EditableDataGridList-Row-Action data-ng-href="" data-ng-click="editRow({$event: $event, $index: $index, rowId:row.id})"><span class="PGU-Icon PGU-Icon-Edit-Row"></span> <span title=Редактировать class=PGU-EditableDataGridList-Row-Action__title>Редактировать</span></a><epgu-form-button data-ng-if=::item.customEditButtonLabel item=ui.btnEditRow click-handler-btn=editRow click-attr="{$event: $event, $index: $index, rowId:row.id}"></epgu-form-button></div></div></div><div class=PGU-Paging><div class=PGU-Paging-Info>{{paging.info}}</div><ul class=PGU-Paging-List><li class=PGU-Paging-List-Item data-ng-attr-style={{paging.pageWidth}} data-ng-repeat="page in paging.list track by $index"><a data-ng-click="setPage($event, page.value, page.disabled)" data-ng-href=# data-ng-class="{\n                                \'PGU-Paging-List-Item-Link\': true,\n                                \'PGU-Paging-List-Item-Link-Current\': paging.currentPage == page.value,\n                                \'PGU-Paging-List-Item-Link-Disabled\': page.disabled\n                            }"><span>{{page.value}}</span></a></li></ul></div></div><div class=PGU-EditableDataGridResponseError><advice-simple-sf data-ng-if=grid.error.show title={{grid.error.title}} type=PGU-Advice-Type_Not></advice-simple-sf></div><div class=PGU-FieldBody><div class=PGU-FieldNotRequired data-ng-if="item.notRequiredText && !item.consentOfThirdParties">{{item.notRequiredText}}</div><div class=PGU-FieldHint data-ng-if=item.hint>{{item.hint}}</div><div class=PGU-FieldError data-ng-if=item.error>{{(item.error.mnemonic + \'.validator\' | translate:item.error.text) || (item.error.text || item.error)}}</div></div><modal-dialog class=PGU-EditableDataGrid-Popup show=popup.show hide-modal=toggleModalVisible(false)><div data-ng-include src=popup.tpl></div></modal-dialog><modal-dialog show=popupConfirmRemove.show hide-modal=popupConfirmRemove.toggleVisible(false) optimization-for-mobile=true><div data-ng-include src=popupConfirmRemove.tpl></div></modal-dialog></div></div>'),$templateCache.put("js/components/ElectronMedicalDocs/ElectronMedicalDocs.html",'<div ng-show=!!item.visible full-path={{::item.fullPath}} class=PGU-ElectronMedicalDocs><epgu-throbber data-ng-show=loading data-throbber-type=PGU-throbber-big data-show-heading=true></epgu-throbber><div data-ng-show="(!loading && !error) || (error && errorType === \'noFilteredData\')"><div class="grid-wrap lg-offset-bottom-32"><div class=grid-wrap__row><div class="grid-wrap__col-lg-5 grid-wrap__col-md-4 grid-wrap__col-sm-6 grid-wrap__col-offset-lg-12 grid-wrap__col-offset-md-8" data-ng-class="{\'flex-container justify-end\': !isPhone}"><div><a class="PGU-Button PGU-Btn-Base PGU-Btn-Blue" data-ng-click=requestWithFilter()><span class=PGU-Btn-Text>Применить фильтр</span></a></div></div></div></div><div data-ng-show="!loading && !error"><div class="lg-offset-bottom-32 md-offset-bottom-32 sm-offset-bottom-24"><h3 class="PGU-title PGU-title_form-step">Найденные медицинские документы</h3><div data-ng-show=subTitleNumOfDocs>{{subTitleNumOfDocs}}<span data-ng-if=updated>. Данные актуальны на {{updated}}.</span> <span class="Sort-Field PGU-Link PGU-ElectronMedicalDocs-Refresh lg-offset-left-24 md-offset-left-24 sm-offset-left-24" data-ng-click=refresh()>Обновить</span></div></div><div class=grid-wrap><div class=grid-wrap__row><div class="grid-wrap__col-lg-17 grid-wrap__col-md-12 grid-wrap__col-sm-6"><div class="Document-Block with-border-top"><span data-ng-if=::!isPhone>Сортировать</span><div data-ng-if=::isPhone class=sm-offset-bottom-16>Сортировать</div><span class="Sort-Field lg-offset-left-16 md-offset-left-16" data-ng-click="sort = \'DESC\'" data-ng-class="{\'PGU-Link\': sort !== \'DESC\'}">сначала новые</span> <span class="Sort-Field lg-offset-left-8 md-offset-left-8 sm-offset-left-8" data-ng-click="sort = \'ASC\'" data-ng-class="{\'PGU-Link\': sort !== \'ASC\'}">сначала старые</span></div></div></div></div><div class=Document-Block data-ng-repeat="doc in item.documents | orderBy:DocumentDate:sort === \'ASC\'" data-ng-class="{\'checked\': doc.checkbox.checked}"><div class=grid-wrap><div class=grid-wrap__row><div class="grid-wrap__col-lg-16 grid-wrap__col-md-11 grid-wrap__col-sm-5"><div class=grid-wrap><div class=grid-wrap__row><div class="grid-wrap__col-lg-4 grid-wrap__col-md-4 grid-wrap__col-sm-6 title-offset-left"><b>{{doc.DocumentDate | convertDate:\'YYYY-MM-DD\':\'DD.MM.YYYY\'}}</b></div><div class="grid-wrap__col-lg-12 grid-wrap__col-md-7 grid-wrap__col-sm-6 sm-offset-top-10"><b>{{doc.DocumentType}}</b></div></div><div data-ng-show="!doc.showMoreInfo && (doc.DiseaseDiagnosis || doc.Description) && isPhone" class="grid-wrap__row sm-offset-top-20"><div class=grid-wrap__col-sm-6><span class="Sort-Field PGU-Link" data-ng-click="doc.showMoreInfo = true">Показать подробности</span> <span class=PGU-Link-with-toggle-arrow></span></div></div><div data-ng-show="!isPhone || (doc.showMoreInfo && isPhone)"><div class="grid-wrap__row lg-offset-top-10 md-offset-top-10 sm-offset-top-10"><div class="grid-wrap__col-lg-4 grid-wrap__col-md-4 grid-wrap__col-sm-6 title-offset-left"><b>Организация</b></div><div class="grid-wrap__col-lg-12 grid-wrap__col-md-7 grid-wrap__col-sm-6">{{doc.MedicalOrganization}}</div></div><div class="grid-wrap__row lg-offset-top-10 md-offset-top-10 sm-offset-top-10" data-ng-if=doc.Doctors.length><div class="grid-wrap__col-lg-4 grid-wrap__col-md-4 grid-wrap__col-sm-6 title-offset-left"><b>Врач</b></div><div class="grid-wrap__col-lg-12 grid-wrap__col-md-7 grid-wrap__col-sm-6" data-ng-repeat="doctor in doc.Doctors track by $index" data-ng-class="{\'grid-wrap__col-offset-lg-4 grid-wrap__col-offset-md-4\': !$first}" data-ng-if="doctor.DoctorName || doctor.MedicalSpecialty"><span data-ng-if=doctor.DoctorName>{{doctor.DoctorName}}<span data-ng-if=doctor.MedicalSpecialty>, </span></span><span data-ng-if=doctor.MedicalSpecialty>{{doctor.MedicalSpecialty}}</span></div></div></div><div data-ng-show="!doc.showMoreInfo && (doc.DiseaseDiagnosis || doc.Description) && !isPhone" class="grid-wrap__row lg-offset-top-10 md-offset-top-20"><div class="grid-wrap__col-lg-17 grid-wrap__col-md-4 title-offset-left"><span class="Sort-Field PGU-Link" data-ng-click="doc.showMoreInfo = true; recountScrollLine()">Показать подробности</span> <span class=PGU-Link-with-toggle-arrow></span></div></div><div data-ng-show=doc.showMoreInfo><div data-ng-if=doc.DiseaseDiagnosis class="grid-wrap__row lg-offset-top-10 md-offset-top-10 sm-offset-top-10"><div class="grid-wrap__col-lg-4 grid-wrap__col-md-4 grid-wrap__col-sm-6 title-offset-left"><b>Диагноз</b></div><div class="grid-wrap__col-lg-12 grid-wrap__col-md-7 grid-wrap__col-sm-6">{{doc.DiseaseDiagnosis}}</div></div><div data-ng-if=doc.Description class="grid-wrap__row lg-offset-top-10 md-offset-top-10 sm-offset-top-10"><div class="grid-wrap__col-lg-4 grid-wrap__col-md-4 grid-wrap__col-sm-6 title-offset-left"><b>Описание</b></div><div class="grid-wrap__col-lg-12 grid-wrap__col-md-7 grid-wrap__col-sm-6">{{doc.Description}}</div></div></div><div data-ng-show=doc.showMoreInfo class="grid-wrap__row lg-offset-top-10 md-offset-top-20 sm-offset-top-20"><div class="grid-wrap__col-lg-17 grid-wrap__col-md-4 grid-wrap__col-sm-6 title-offset-left"><span class="Sort-Field PGU-Link" data-ng-click="doc.showMoreInfo = false; recountScrollLine()">Скрыть подробности</span> <span class="PGU-Link-with-toggle-arrow PGU-Link-with-toggle-arrow-up"></span></div></div></div></div><div class="grid-wrap__col-lg-1 grid-wrap__col-md-1 grid-wrap__col-sm-1 check-document"><pgu-checkbox el=doc.checkbox toggle=doc.toggleCheckbox></pgu-checkbox></div></div></div></div><div data-ng-if="canShowMoreLists || listsCount" class="grid-wrap lg-offset-top-24 md-offset-top-24 sm-offset-top-24"><div class=grid-wrap__row><div data-ng-if=listsCount class="grid-wrap__col-lg-13 grid-wrap__col-md-8 grid-wrap__col-sm-6 gray">Показано {{listsShowed}} из {{listsCount}}</div><div data-ng-if=canShowMoreLists class="grid-wrap__col-lg-4 grid-wrap__col-md-4 grid-wrap__col-sm-6 sm-offset-top-16" data-ng-class="{\'flex-container justify-end\': !isPhone, \'grid-wrap__col-offset-lg-13 grid-wrap__col-offset-md-8\': !listsCount}"><div><a class="PGU-Button PGU-Btn-Base" data-ng-click=showMoreDocs()><span class=PGU-Btn-Text>Показать еще</span></a></div></div></div></div><div data-ng-if=::!$root.isDesigner class=selected-documents-line-block><div class=grid-wrap><div class="grid-wrap__row flex-container align-items-center"><div class="grid-wrap__col-lg-7 grid-wrap__col-md-4 grid-wrap__col-sm-3 flex-container align-items-center"><div class="selected-documents-title dk-pad-land">Выбрано {{lineSelect.select.now}} из {{lineSelect.select.all}}</div><div class="selected-documents-title mob-pad-portrait">Выбрано<br>{{lineSelect.select.now}} из {{lineSelect.select.all}}</div><div data-ng-if=lineSelect.question.show class=PGU-ElectronDocs-hint><div class=question-helper-wrapper><question item=lineSelect.question.item></question></div></div></div><div class="grid-wrap__col-lg-4 grid-wrap__col-md-3 PGU-ElectronDocsCheckbox"><pgu-checkbox data-ng-if="!isPhone && lineSelect.checkbox.show" el=lineSelect.checkbox.model toggle=lineSelect.checkbox.toggleCheckbox></pgu-checkbox></div><div class="grid-wrap__col-lg-5 grid-wrap__col-md-5 grid-wrap__col-sm-3 grid-wrap__col-offset-lg-2" data-ng-class="{\'flex-container justify-end\': !isPhone}"><div><a data-ng-show=someoneChecked class="PGU-Button PGU-Btn-Base" data-ng-click=lineSelect.sendForm()><span class=PGU-Btn-Text>Запросить{{!isPhone ? \' документы\' : \'\'}}</span></a></div></div><div class=grid-wrap__col-lg-6></div></div></div></div></div></div><div data-ng-if="error && errorType === \'error\'"><advice-simple-sf title="Что-то пошло не так" type=PGU-Advice-Type_Not>К сожалению, при обработке запроса произошла ошибка</advice-simple-sf></div><div data-ng-if="error && errorType === \'loadingData\'"><advice-simple-sf title="Загрузка происходит дольше обычного" type=PGU-Advice-Type_Not_yellow><div>Попробуйте зайти на страницу позже.</div><div data-ng-if=expired>Повторный запрос возможен не ранее {{expired}}</div></advice-simple-sf></div><div data-ng-if="error && errorType === \'noData\'"><div class="lg-offset-bottom-24 md-offset-bottom-24 sm-offset-bottom-16"><span>Данные актуальны на {{updated}}.</span> <span class="Sort-Field PGU-Link PGU-ElectronMedicalDocs-Refresh lg-offset-left-24 md-offset-left-24 sm-offset-left-24" data-ng-click=refresh()>Обновить</span></div><div><b>Почему может не хватать записей</b></div><div>- Медицинская организация не подключена к услуге,</div><div>- Идет процесс загрузки ваших документов на портал,</div><div>- Срок хранения электронного медицинского документа в организации истек,</div><div>- Посещений врача не зарегистрировано</div></div><div data-ng-if="error && errorType === \'noFilteredData\'"><advice-simple-sf title="Медицинских документов не найдено" type=PGU-Advice-Type_Not_yellow>Задайте другие параметры фильтров</advice-simple-sf></div></div>'),$templateCache.put("js/components/Fias/Fias.html","<div ng-show=(!!item.visible) id={{::id}} full-path={{::item.fullPath}}><div class=\"PGU-{{::item.className}} PGU-LabelWidth-{{::item.labelWidth}} PGU-Labelalign-{{::item.labelAlign}} {{item.disabled ? 'PGU-Disabled' : ''}} {{item.required ? 'PGU-Required' : ''}} {{item.error ? 'PGU-Error' : ''}}\"><label class=PGU-FieldLabel>{{item.label}}</label><div class=\"PGU-KladrWrap PGU-FiasWrap PGU-FieldBody\"><div><div class=address-in-one></div></div><div class=\"PGU-Fias-Fields-Container-V2 js-PGU-Fias-Fields-Container-V2\"><form-tree ng-repeat=\"item_i in item.items track by $index\" item=item_i></form-tree></div><div class=PGU-FieldNotRequired ng-if=item.notRequiredText>{{::item.notRequiredText}}</div><div class=PGU-FieldHint ng-if=item.hint>{{::item.hint}}</div><div class=PGU-FieldError data-ng-if=item.error>{{(item.error.mnemonic + '.validator' | translate:item.error.text) || (item.error.text || item.error)}}</div></div></div></div>"),
$templateCache.put("js/components/FieldAddress/FieldAddress.html","<div ng-show=(!!item.visible) id={{id}} full-path={{item.fullPath}}><div class=\"PGU-FieldAddress PGU-{{item.className}} PGU-LabelWidth-{{item.labelWidth}} PGU-Labelalign-{{item.labelAlign}} {{item.disabled ? 'PGU-Disabled' : ''}} {{item.required ? 'PGU-Required' : ''}} {{item.error ? 'PGU-Error' : ''}}\"><label class=PGU-FieldLabel>{{item.label}}</label><div class=\"PGU-KladrWrap PGU-FiasWrap PGU-FieldBody\"><div><div class=address-in-one></div></div><div class=\"PGU-Fias-Fields-Container-V2 js-PGU-Fias-Fields-Container-V2\"><form-tree ng-repeat=\"item_i in item.items track by $index\" item=item_i></form-tree></div><div class=PGU-FieldNotRequired ng-if=item.notRequiredText>{{item.notRequiredText}}</div><div class=PGU-FieldHint ng-if=item.hint>{{item.hint}}</div><div class=PGU-FieldError data-ng-if=item.error>{{(item.error.mnemonic + '.validator' | translate:item.error.text) || (item.error.text || item.error)}}</div></div><modal-dialog show=ui.showESIAPopup><div class=b-ESIAPopup><h3>Хотите ли вы изменить данные о месте жительства в Личном кабинете?</h3><h4>Адрес места проживания</h4><div class=b-line_esia-address><div class=x-title>Текущий вариант:</div><div class=x-value>{{model.strategyAddress.value}}</div></div><div class=b-line_esia-address><div class=x-title>Новый вариант:</div><div class=x-value>{{item.value}}</div></div><div class=x-clear></div></div><div class=b-ESIAPopup__border></div><a ng-click=noChangeEsiaData() class=\"PGU-Button PGU-Button-color-white PGU-Button-align-left\" tabindex=\"{{item.disabled ? -1 : 1}}\"><span class=PGU-ButtonText>Не изменять</span> <span class=PGU-ButtonRight></span> </a><a ng-click=changeEsiaData() class=\"PGU-Button PGU-Button-align-right\"><span class=PGU-ButtonText>Изменить</span> <span class=PGU-ButtonRight></span></a></modal-dialog></div></div>"),$templateCache.put("js/components/FieldBirthPlace/FieldBirthPlace.html","<div ng-show=(!!item.visible) id={{$id}} full-path={{item.fullPath}}><div ng-attr-style={{::item.inlineCSS}} class=\"PGU-{{item.className}} PGU-LabelWidth-{{item.labelWidth}} PGU-FieldWidth-{{item.fieldWidth}} PGU-LabelAlign-{{item.labelAlign}} {{item.disabled ? 'PGU-Disabled' : ''}} {{((item.value && (item.value != '')) || (item.isSmall && (item.isSmall != ''))) ? 'PGU-FieldText-Small-Placeholder' : ''}} {{item.required ? 'PGU-Required' : ''}} {{item.withCheckbox ? 'PGU-FieldWithCheckbox' : ''}} {{item.error ? 'PGU-Error' : ''}}\"><div class=\"PGU-FieldTextInput PGU-FieldBody\"><label class=\"PGU-FieldLabel PGU-FieldLabel-Input\" for=\"\">{{item.label}}</label><pgu-input class=\"PGU-FieldTextInputBasic field-padded -metrika-nokeys\" change=changeByUser() model=item ng-disabled=item.disabled ng-attr-maxlength={{item.maxlength}}></pgu-input><span class=PGU-PopupHint ng-if=\"item.mnemonicHint && item.mnemonicHintShow\"><i class=questionIcon><span class=PGU-PopupHintOuterArrow></span> <span class=PGU-PopupHintOuter><span class=PGU-PopupHintContent ng-bind-html=\"item.hintHtml | to_trusted\"></span></span></i></span><div class=PGU-FieldNotRequired ng-if=item.notRequiredText>{{item.notRequiredText}}</div><div class=PGU-FieldHint ng-if=item.hint>{{item.hint}}</div><div class=PGU-FieldError data-ng-if=item.error>{{(item.error.mnemonic + '.validator' | translate:item.error.text) || (item.error.text || item.error)}}</div></div><div class=PGU-FieldTextInputCheckbox ng-if=item.withCheckbox><pgu-checkbox el=models toggle=toggleValue></pgu-checkbox></div></div></div>"),$templateCache.put("js/components/FieldCheckbox/FieldCheckbox.html","<div ng-show=(!!item.visible) full-path={{::item.fullPath}}><div class=PGU-FieldCheckBox-container ng-class=\"{\n            'PGU-Error' : item.error,\n            'editor-item-selected': item.currentItem,\n            'editor-item-hovered': item.hoverItem\n        }\"><pgu-checkbox el=item pgu-disabled=item.disabled hook-checkbox=item.disabled toggle=toggleValue></pgu-checkbox><div class=PGU-FieldHint ng-if=item.hint>{{(item.fullPath + '.hint' | translate:item.hint) || item.hint}}</div><div class=PGU-FieldError data-ng-if=item.error>{{(item.error.mnemonic + '.validator' | translate:item.error.text) || (item.error.text || item.error)}}</div></div></div>"),$templateCache.put("js/components/FieldDrivingLicense/FieldDrivingLicense.html","<div id={{::id}} full-path={{::item.fullPath}}><div class=\"PGU-{{::item.className}} PGU-LabelWidth-{{::item.labelWidth}} PGU-Labelalign-{{::item.labelAlign}} {{item.disabled ? 'PGU-Disabled' : ''}} {{item.required ? 'PGU-Required' : ''}} {{item.error ? 'PGU-Error' : ''}}\" ng-class=\"{\n            'PGU-Disabled'                      : item.disabled,\n            'PGU-Required'                      : item.required,\n            'PGU-Error'                         : item.error\n"+'        }"><label class=PGU-FieldLabel>{{::item.label}}</label><div><form-tree ng-repeat="item_i in item.items track by $index" item=item_i></form-tree></div><modal-dialog show=ui.popupShowDefer><div class=b-ESIAPopup><h3>Данные вашего водительского удостоверения будут сохранены в Личном кабинете</h3><h4>Серия и номер водителького удостоверения</h4><span>{{item.driver_license_series}} {{item.driver_license_number}}</span> <span>Для сохранения и использования заполните следующие поля:</span><div class=b-input__esia-dl><input class=PGU-FieldTextInputBasic ng-model=item.driver_license_issue_date></div><div class=b-input__esia-dl><input class=PGU-FieldTextInputBasic ng-model=item.driver_license_valid_till></div><div class=x-clear></div></div><div class=b-ESIAPopup__border></div><a ng-if=ui.needChange tabindex="{{item.disabled ? -1 : 1}}" ng-click=noChange() class="PGU-Button PGU-Button-align-left PGU-Button-color-white"><span class=PGU-ButtonText>Не изменять</span> <span class=PGU-ButtonRight></span> </a><a ng-click=setData() class="PGU-Button PGU-Button-align-right"><span ng-if=!ui.needChange class=PGU-ButtonText>Продолжить</span> <span ng-if=ui.needChange class=PGU-ButtonText>Изменить</span> <span class=PGU-ButtonRight></span></a></modal-dialog></div></div>'),$templateCache.put("js/components/FieldDropdown/FieldDropdown.html",'<div ng-show="(!item.availableForHide ? (!!item.visible) : (item.list && item.list.length))" full-path={{::item.fullPath}} data-ng-class="{\'PGU-FD_withCheckbox\': item.withCheckbox}"><div class=PGU-{{::item.className}}InputWrap><div data-ng-if=::!item.isComplete ng-attr-style={{::item.inlineCSS}} class="PGU-{{::item.className}}Input PGU-LabelWidth-{{::item.labelWidth}} PGU-LabelAlign-{{::item.labelAlign}} PGU-FieldWidth-{{::item.fieldWidth}} {{item.error || item.responseError ? \'PGU-Error\' : \'PGU-No-Error\'}}"><pgu-select model=item options=models.options></pgu-select><div ng-if=::item.isMultiple class=PGU-FieldBody><div class=PGU-FieldNotRequired ng-if="item.notRequiredText && !item.required">{{(item.fullPath + \'.notRequiredText\' | translate:item.notRequiredText) || item.notRequiredText}}</div><div class=PGU-FieldHint ng-if=::item.hint>{{(item.fullPath + \'.hint\' | translate:item.hint) || item.hint}}</div><div class=PGU-FieldError data-ng-if=item.error>{{(item.error.mnemonic + \'.validator\' | translate:item.error.text) || (item.error.text || item.error)}}</div><advice-simple-sf ng-if="item.responseError && !item.error" type=PGU-Advice-Type_Warn>{{::item.responseErrorText}}</advice-simple-sf></div></div><div ng-if=::item.isMultiple class=PGU-dropdown-tags><div ng-repeat="el in item.selectedMultiple" ng-if=item.selectedMultiple class="PGU-dropdown-tag {{item.disabled ? \'disabled\' : \'\'}}"><div class=close ng-mousedown=deleteMultiClone($index)></div><p class=PGU-dropdown-tag-text>{{ ::el.text_value }}</p><p></p></div></div><div class="PGU-FieldNotRequired PGU-FieldNotRequired-FiasDaData" ng-if="item.isFiasDaData && item.notRequiredText && !item.required">{{(item.fullPath + \'.notRequiredText\' | translate:item.notRequiredText) || item.notRequiredText}}</div><div class=PGU-FieldBody-ToggleFiasFields ng-class="{\'PGU-FieldBody-ToggleFiasFields-Open\': item.fiasFieldsShow}" ng-if="item.isFiasDaData && (item.value || item.filter && item.filter.length >=1 || item.isToggleAll) && !item.disabled"><a ng-href="" class=PGU-Link-pseudo ng-click=item.toggleFiasFields($evt)>{{item.toggleLabel}}</a></div><div ng-if="::(!item.isMultiple && item.selectType !== \'DropdownForFias\' && !item.isFiasDaData)" class=PGU-FieldBody><div class=PGU-FieldNotRequired ng-if="item.notRequiredText && !item.required"><span data-ng-if=::item.emptyRequiredText>{{(\'requiredConstant\' | translate:item.notRequiredText) || item.notRequiredText}} </span><span data-ng-if=::!item.emptyRequiredText>{{(item.fullPath + \'.notRequiredText\' | translate:item.notRequiredText) || item.notRequiredText}}</span></div><div class=PGU-FieldHint ng-if="item.hint && item.hint.length">{{(item.fullPath + \'.hint\' | translate:item.hint) || item.hint}}</div><div class=PGU-FieldError data-ng-if=item.error>{{(item.error.mnemonic + \'.validator\' | translate:item.error.text) || (item.error.text || item.error)}}</div><advice-simple-sf ng-if="item.responseError && !item.error" type=PGU-Advice-Type_Warn>{{::item.responseErrorText}}</advice-simple-sf></div><div ng-repeat="clone in item.clones" ng-if="item.clones && item.isHierarchic"><epgu-field-dropdown item=clone></epgu-field-dropdown></div></div><div data-ng-if=::item.isComplete><span data-ng-if=item.label>{{::item.label}}: </span><span>{{::item.text_value}}</span></div><div class=x-clear></div><div class=PGU-FieldTextInputCheckbox data-ng-if=::item.withCheckbox><pgu-checkbox el=item.cbInField set-checkbox=item.statusCheckbox toggle=toggleValue></pgu-checkbox></div></div>'),$templateCache.put("js/components/FieldDropdown/select.html","<div data-ng-class=\"{\n        'PGU-dropdown-container': true,\n        'PGU-FieldText-Small-Placeholder': ui.isMini,\n        'open': ui.isOpen,\n        'PGU-Disabled': model.disabled || model.readonly || model.immutable,\n        'search': ui.search || ui.searchFromServer,\n        'onlySearchIcon': model.geoSearchDropdown || model.isFiasDaData,\n        'PGU-dropdown-container-GeoSearchDropdown': model.geoSearchDropdown,\n        'isOnlySearch': options.isOnlySearch,\n        'PGU-Dadata': model.isFiasDaData\n     }\n"+'        " tabindex="{{model.disabled ? -1 : 1}}" data-ng-focus=focusLogEl($event) data-ng-blur=blurLogEl($event)><div class=PGU-longLabel ng-if="(model.label && model.label.length > maxLengthOfLabel) || model.longLabel">{{((model.fullPath + \'.longLabel\' | translate:model.longLabel) || model.longLabel) || ((model.fullPath + \'.label\' | translate:model.label) || model.label)}}</div><div class=PGU-Wrap-Dropdown-relative><label class="PGU-FieldLabel PGU-FieldLabel-Input" ng-if="!model.geoSearchDropdown && !model.isFiasDaData && model.label && model.label.length > maxLengthOfLabel && !model.disabled">{{(\'DropdownLongDefault\' | translate) || \'Выберите значение\'}}</label> <label class="PGU-FieldLabel PGU-FieldLabel-Input" ng-if="model.label && model.label.length <= maxLengthOfLabel">{{(model.fullPath + \'.label\' | translate:model.label) || model.label}}</label> <label class="PGU-FieldLabel PGU-FieldLabel-Input" ng-if="!model.label && !model.geoSearchDropdown && !model.isFiasDaData && !model.disabled">Выберите значение</label><div class=PGU-dropdown-el><span class=label-model ng-if="::(!options.isOkato && !model.isMultiple && !model.isFias && !model.isFiasDaData)" ng-show=!ui.isFocus>{{ model.text_value}}</span> <span class=label-model ng-if=::model.isMultiple ng-show=!ui.isFocus></span> <span class=label-model ng-if=::options.isOkato ng-show=!ui.isFocus>{{ model.shortTitle}}</span> <input class=mySuperInput tabindex="{{model.disabled ? -1 : 1}}" ng-if=ui.search ng-model=model.filter ng-change=changeHandlerWithDebounce() ng-focus=focusHandler($event) ng-blur=blurHandler($event) ng-disabled=model.disabled numbers-only={{options.isOnlyNumbers}} maxlength="{{options.maxlength || false}}"><div ng-if=::!model.isFiasDaData data-ng-class="{\'icon\': true, \'PGU-throbber-small\': ui.isLoad && options.isOnlySearch}"></div><div ng-if="model.isFiasDaData && model.filter && model.filter.length >= 3" data-ng-class="{\'icon\': true, \'PGU-throbber-small\': ui.isLoad && options.isOnlySearch}"></div></div></div><div class=x-clear></div><div class=PGU-dropdown-body data-ng-style=model.endOfPage><div data-ng-if=::model.isFiasDaData class=PGU-FiasDaData-Wrap-List-Items data-ng-show="filteredList && filteredList.length"><div class=PGU-dropdown-Caption-Option data-ng-if=model.caption>{{model.caption}}</div><ul class="PGU-FiasDaData-Wrap-List PGU-Dropdown-List"><li data-ng-repeat="l in filteredList track by $index" data-ng-click="selectElement(l.value, l.level); $event.stopPropagation();" data-hover=mouseenterElement($index) data-ng-if=l.htmlTitle data-ng-class="{\'selected\': model.value == l.value, \'active\': ui.currentItem == $index, \'PGU-FiasDaData-List-Item\': true}" data-ng-bind-html=l.htmlTitle><div class=PGU-dropdown-Toggle-Option data-ng-if="$root.settings.mobOptimize && (filteredList && filteredList.length) || ui.searchIsEmpty">Не нашли нужный вариант? <a data-ng-href="" data-ng-click="toggleFiasFields($evt, true, false, true)">Укажите адрес вручную</a></div></li></ul><div class=PGU-dropdown-Toggle-Option data-ng-if="!$root.settings.mobOptimize && (filteredList && filteredList.length) || ui.searchIsEmpty">Не нашли нужный вариант? <a data-ng-href="" data-ng-click="toggleFiasFields($evt, true, false, true)">Укажите адрес вручную</a></div></div><div class=PGU-dropdown-List-Wrap data-ng-if=::!model.isFiasDaData><ul class=PGU-Dropdown-List data-when-scrolled="options.loadMore(updateList); options.cacheDataLoad()"><li ng-if="!options.noEmptyField && !options.isOnlySearch && !model.isFias && !model.isFiasDaData" ng-click="selectElement(undefined); $event.stopPropagation();" hover=mouseenterElement(-1) ng-class="{\'selected\': !model.value, \'active\': ui.currentItem == -1}">{{(\'emptyFieldConstant\' | translate:\'[Не выбрано]\') || model.emptyField}}</li><li data-ng-if="model.isKladr && model.message && model.message.length" data-ng-click="onCloseKLadrByEmptySearch($event); $event.stopPropagation();"><strong>{{model.message}}</strong></li><li ng-if="!model.isKladr && model.message && model.message.length"><strong>{{model.message}}</strong></li><li ng-repeat="l in $parent.filtered = (cachList | filter:{\'title\':  model.filter}) track by $index" ng-click="selectElement(l.value); $event.stopPropagation();" hover=mouseenterElement($index) ng-if="::l.htmlTitle && !model.isFias" ng-class="{\'selected\': model.value == l.value, \'active\': ui.currentItem == $index}" ng-bind-html=l.htmlTitle></li><li ng-repeat="l in $parent.filtered = (cachList) track by $index" ng-click="selectElement(l.value, l.level); $event.stopPropagation();" hover=mouseenterElement($index) ng-if="::l.htmlTitle && model.isFias" ng-class="{\'selected\': model.value == l.value, \'active\': ui.currentItem == $index}" ng-bind-html=l.htmlTitle></li><li ng-repeat="l in filteredList track by $index" ng-click="selectElement(l.value); $event.stopPropagation();" hover=mouseenterElement($index) ng-if="!l.htmlTitle && !model.isFias && !model.isKladr && !(model.message || model.message.length)" ng-class="{\'selected\': model.value == l.value && !model.isMultiple, \'active\': ui.currentItem == $index}">{{l.title}}</li><li ng-repeat="l in cachList track by $index" ng-click="selectElement(l.value); $event.stopPropagation();" hover=mouseenterElement($index) ng-if="::model.isKladr && !(model.message || model.message.length)" ng-class="{\'selected\': model.value == l.value && !model.isMultiple, \'active\': ui.currentItem == $index}" ng-bind-html=l.title></li></ul><div class=PGU-Dropdown-List-Bottom-Loader><epgu-throbber data-throbber-type=PGU-throbber-small></epgu-throbber></div></div></div></div>'),$templateCache.put("js/components/FieldDropdownHierarchicMultiple/FieldDropdownHierarchicMultiple.html",'<div full-path={{::item.fullPath}} ng-show=!!item.visible><div class="cf PGU-FieldDropdownHierarchicMultiple PGU-LabelWidth-{{::item.labelWidth}} PGU-LabelAlign-{{::item.labelAlign}} PGU-FieldWidth-{{::item.fieldWidth}} {{item.hint ? \'PGU-Hint\' : \'\'}} {{item.disabled ? \'PGU-disabled\' : \'\'}} {{item.error ? \'PGU-error\' : \'\'}}"><label class=PGU-Panel-title><b class=PGU-LabelRequired>*</b> <b>{{::item.label}}</b></label><div class=PGU-FieldBody ng-if="(!item.isDigitalProfileUploader || (item.isDigitalProfileUploader && !item.emptyDocsList))"><a ng-if="!item.listResult || !item.listResult.length" class="PGU-Button PGU-Btn-Small PGU-Btn-Base PGU-Btn-Add" ng-click=ui.openPopup() tabindex="{{item.disabled ? -1 : 1}}"><span class=PGU-ButtonText>{{::item.selectButtonTitle}}</span> <span class=PGU-ButtonRight></span></a><div class=PGU-FieldHint>{{::item.hint}}</div></div><div class="Empty-Docs-List all-offset-top-20" ng-if="item.isDigitalProfileUploader && item.emptyDocsList"><span class=PGU-PlainText>У вас нет прикрепленных документов в Цифровом профиле</span></div><modal-dialog show=ui.showPopup><div class="service-h4 bold"><b>{{::(item.popupTitle || item.label)}}</b></div><div class=PGU-FDHM-popup-body flex-height><list-hierarchic openz=openCallback list=item.children toggle-value=ui.toggleValue loading=ui.loading hide-empty-children=false disabled-tree=false dictionary-full-loaded=item.dictionaryFullLoaded></list-hierarchic></div><div class=PGU-FDHM-popup-footer><div class=PGU-FHDM-cancel-btns><a class="PGU-Button PGU-float-left PGU-Btn-Base" ng-click="ui.cancel(false, true)"><span class=PGU-ButtonText>Отмена</span> <span class=PGU-ButtonRight></span> </a><a class="PGU-Button PGU-float-left PGU-Btn-Base" ng-click=ui.clear()><span class=PGU-ButtonText>Очистить</span> <span class=PGU-ButtonRight></span></a></div><a class="PGU-Button PGU-float-right PGU-Btn-Base PGU-Btn-Blue" ng-click=ui.save()><span class=PGU-ButtonText>Сохранить</span> <span class=PGU-ButtonRight></span></a></div></modal-dialog><div class=PGU-FDHM-result ng-if="item.listResult && item.listResult.length"><list-hierarchic openz=openCallback list=item.listResult disabled-tree=!ui.showPopup open toggle-value=ui.toggleValue hide-empty-children=true dictionary-full-loaded=item.dictionaryFullLoaded></list-hierarchic></div><div class="PGU-FieldBody flex-container sm-flex-column"><a ng-if="item.listResult && item.listResult.length" class="PGU-Button PGU-Btn-Small PGU-Btn-Base" ng-click=ui.openPopup() tabindex="{{item.disabled ? -1 : 1}}"><span class=PGU-ButtonText>Изменить выбор</span> <span class=PGU-ButtonRight></span></a><update-check-sign-status data-ng-if="item.isDigitalProfileUploader && hasFileWithSign" data-uploader=item is-digital-profile-uploader=true class="lg-offset-left-20 md-offset-left-20 sm-offset-top-16"></update-check-sign-status><div class=PGU-FieldError data-ng-if=item.error>{{(item.error.mnemonic + \'.validator\' | translate:item.error.text) || (item.error.text || item.error)}}</div></div></div></div>'),$templateCache.put("js/components/FieldInn/FieldInn.html","<div ng-show=!!item.visible id={{::$id}} full-path={{::item.fullPath}}><div ng-attr-style={{::item.inlineCSS}} class=\"PGU-{{::item.className}} PGU-LabelWidth-{{::item.labelWidth}} PGU-FieldWidth-{{::item.fieldWidth}} PGU-LabelAlign-{{::item.labelAlign}} {{item.disabled ? 'PGU-Disabled' : ''}} {{((item.value && (item.value != '')) || (item.isSmall && (item.isSmall != ''))) ? 'PGU-FieldText-Small-Placeholder' : ''}} {{item.required ? 'PGU-Required' : ''}} {{item.withCheckbox ? 'PGU-FieldWithCheckbox' : ''}} {{item.error ? 'PGU-Error' : ''}}\"><div class=\"PGU-FieldTextInput PGU-FieldBody\"><label class=\"PGU-FieldLabel PGU-FieldLabel-Input\" for=\"\">{{item.label}}</label><pgu-input class=\"PGU-FieldTextInputBasic field-padded -metrika-nokeys\" change=changeByUser() model=item ng-disabled=item.disabled ng-attr-maxlength={{::item.maxlength}}></pgu-input><span class=PGU-PopupHint ng-if=\"item.mnemonicHint && item.mnemonicHintShow\"><i class=questionIcon><span class=PGU-PopupHintOuterArrow></span> <span class=PGU-PopupHintOuter><span class=PGU-PopupHintContent ng-bind-html=\"item.hintHtml | to_trusted\"></span></span></i></span><div class=PGU-FieldNotRequired ng-if=::item.notRequiredText>{{::item.notRequiredText}}</div><div class=PGU-FieldHint ng-if=::item.hint>{{::item.hint}}</div><div class=PGU-FieldError data-ng-if=item.error>{{(item.error.mnemonic + '.validator' | translate:item.error.text) || (item.error.text || item.error)}}</div></div><div class=PGU-FieldTextInputCheckbox ng-if=item.withCheckbox><pgu-checkbox el=models toggle=toggleValue></pgu-checkbox></div></div></div>"),
$templateCache.put("js/components/FieldMap/FieldMap.html",'<div ng-show=(!!item.visible) full-path={{::item.fullPath}}><div ng-if=(item.isFieldMap) class="PGU-FieldMap PGU-LabelWidth-{{::item.labelWidth}} PGU-FieldWidth-{{::item.fieldWidth}} PGU-LabelAlign-{{::item.labelAlign}} {{item.required ? \'PGU-Required\' : \'\'}} {{item.error ? \'PGU-Error\' : \'\'}}" full-path={{::item.fullPath}}><label class=PGU-FieldLabel>{{::item.label}}</label><div class=PGU-FieldMapErrorMessage data-ng-if=item.errorCoordinatesText>{{item.errorCoordinatesText}}</div><div class="PGU-FieldMapContainer PGU-FieldBody" data-ng-if=!item.errorCoordinatesText><yandex-map yvalue=item.value yid="{{::item.fullPath + \'_map\'}}" item=item error=item.error baloon=item.baloon></yandex-map></div><div class=PGU-FieldBody><div class=PGU-FieldNotRequired ng-if=::item.notRequiredText>{{::item.notRequiredText}}</div><div class=PGU-FieldHint ng-if=::item.hint>{{::item.hint}}</div><div class=PGU-FieldError data-ng-if=item.error>{{(item.error.mnemonic + \'.validator\' | translate:item.error.text) || (item.error.text || item.error)}}</div></div></div><div ng-if="(item.isFieldMapWithList || item.isFieldMapWithListDC)" class="PGU-Panel PGU-Panel-FieldMapWithList PGU-LabelWidth-{{item.labelWidth}} PGU-Panel-Width-{{item.width}} {{item.required ? \'PGU-Required\' : \'\'}} {{item.error ? \'PGU-Error\' : \'\'}} {{item.isFieldMapWithListDC ? \'PGU-Panel-FieldMapWithList-DC\' : \'\'}}" full-path={{item.fullPath}}><div class=PGU-Panel-inner><div class=PGU-Panel-Map-Wrap><div class="PGU-HelperBox PGU-HelperBox-Type-veryImportant uncorrected-region-helperbox-desk" data-ng-if="item.uncorrectedHelperBox && item.uncorrectedRegionText">{{item.uncorrectedRegionText}}</div><div data-ng-if=::item.withGeoCoderSearch style="margin-bottom: 30px;"><form-tree ng-repeat="item_i in item._geoItems" item=item_i></form-tree></div><div class="PGU-FieldMapContainer PGU-FieldBody {{item.needChangeColorBtn ? \'Disabled-Button\' : \'\'}}" ng-class="{\'with-max-error\': item.isFieldMapWithListDC && (item.selectedItems.length >= (item.limitNumberOfEntries || 3))}"><div data-ng-if=::!item.withGeoCoderSearch class="PGU-List-sidebar {{model.originList && model.originList.length ? \'isFull\' : \'isEmpty\'}}"><h2 class=PGU-List-sidebar-title ng-show="model.originList.length <= 3">Доступные подразделения:</h2><div class=PGU-List-sidebar-search ng-class="{loading: searchFieldLoading}" ng-show="model.originList && model.originList.length > 3"><epgu-field-text model=model.searchDivision item=model.mapInput></epgu-field-text><epgu-throbber ng-show=searchFieldLoading data-throbber-type=PGU-throbber-small data-show-heading=false></epgu-throbber><div class=max-error data-ng-show="item.isFieldMapWithListDC && (item.selectedItems.length >= (item.limitNumberOfEntries || 3))">Вы выбрали максимальное количество организаций. Удалите уже выбранные организации, если хотите выбрать другие.</div></div><div class="{{item.isFieldMapWithListDC ? \'PGU-List-sidebar-error-DC\' : \'PGU-List-sidebar-error\'}}" data-ng-if="(!model.originList || !model.originList.length) && !model.loading && item.isFieldMapWithListDC">Запрос не дал результатов<div class=PGU-List-sidebar-error-text ng-if=item.isFieldMapWithListDC>Адрес места пребывания и адрес проживания ребенка не выбран или список детских садов недоступен.</div></div><div class=PGU-Panel-FieldMapWithList-error data-ng-show="(!item.isFieldMapWithListDC && model.originList && model.originList.length && (!model.list || !model.list.length))">Запрос не дал результатов</div><div class=PGU-Panel-FieldMapWithList-error ng-if="(!model.originList || !model.originList.length) && !model.loading && !item.isFieldMapWithListDC">Запрос не дал результатов<div class=PGU-Panel-FieldMapWithList-error-text>Не выбран адрес для поиска или список подразделений для получения услуги недоступен в указанном регионе.</div></div><div class=PGU-List-sidebar-body scroll-to-active={{model.activeValue}}><ul class=PGU-List-sidebar-items ng-if="model.list && model.list.length"><li it-value={{it.value}} ng-class="{\'active\': it.value == model.activeValue, hovered: $index === hoveredItem}" data-ng-repeat="it in model.list track by $index" ng-click=openBaloon(it) ng-mouseenter=mouseenterElement($index) ng-mouseleave=mouseleaveElement()><pgu-checkbox el=it.checkbox toggle=toggleDC item=it ng-if=item.isFieldMapWithListDC tab-exclude="$index !== hoveredItem"></pgu-checkbox><span class=item-title ng-bind-html=it.title></span><div class=PGU-FieldMapWithList-Item-main-attrs><div class=PGU-FieldMapWithList-Item-Attrs ng-repeat="attr in it.attrsList"><span class=PGU-AttrsLabel ng-bind-html=attr.label>:</span> <span class=PGU-AttrsValue ng-bind-html=attr.value></span></div></div></li></ul></div></div><div data-ng-show=model.showAcceptWithoutPin class=PGU-Map-error-content><div class=error-icon></div><div class=error-text>Не удалось показать<br>объект на карте</div><div data-ng-show=!model.showAcceptWithoutPinSelected class="PGU-FieldMapWithList-confirm-buttons cf"><div class="PGU-BtnHolder PGU-Btn-margin-lr-0 PGU-BtnContainer-column"><div><a class="PGU-Button PGU-Btn-Base PGU-Btn-Small PGU-Btn-Blue pin-not-selected" data-ng-click=confirmSelect() tabindex=1>Выбрать</a></div></div></div><div data-ng-if=::!item.isFieldMapWithListDC data-ng-show=model.showAcceptWithoutPinSelected><p>У вас есть уже выбранный пункт.<br>Заменить его?</p><div class="PGU-FieldMapWithList-confirm-buttons cf"><div class="PGU-BtnHolder PGU-Btn-margin-lr-0 PGU-BtnContainer-column"><div><a data-ng-href="" class="PGU-Button PGU-Btn-Base PGU-Btn-Small PGU-Btn-Blue" data-ng-click=confirmSelect() tabindex=1>Да, заменить</a></div></div><div class="PGU-BtnHolder PGU-Btn-margin-lr-0 PGU-Button-align-right PGU-BtnContainer-column"><div><a data-ng-href="" class="PGU-Button PGU-Btn-Base PGU-Btn-Small PGU-Btn-White" data-ng-click=cancelSelect() tabindex=1>Отмена</a></div></div></div></div><div data-ng-if=::item.isFieldMapWithListDC data-ng-show=model.showAcceptWithoutPinSelected class="PGU-FieldMapWithList-confirm-buttons cf"><div class="PGU-BtnHolder PGU-Btn-margin-lr-0 PGU-BtnContainer-column"><div><a href=# class="PGU-Button PGU-Btn-Base PGU-Btn-Small PGU-Btn-Blue" data-ng-click="deleteDC({value: model.activeValue})" tabindex=1>Удалить</a></div></div></div></div><div class=PGU-FieldMapWithList-shadow ng-if=model.loading></div><yandex-map yvalue=model.coords yid="{{item.fullPath + \'_map\'}}" item=item error=item.error baloon=item.baloon opened=model.openedVal options=model.options list=model.mapList home-fias-path="item.isNewView && item.isFieldMapWithListDC && item.addressPath"></yandex-map></div></div><div class=PGU-FieldBody><div class=PGU-FieldNotRequired ng-if=item.notRequiredText>{{item.notRequiredText}}</div><div class=PGU-FieldHint ng-if=item.hint>{{item.hint}}</div><div class=PGU-FieldError data-ng-if=item.error>{{(item.error.mnemonic + \'.validator\' | translate:item.error.text) || (item.error.text || item.error)}}</div></div><div class=PGU-FieldMapWithList-SelectedItem ng-if=model.selectedElement.underMapInfo data-ng-class="{\'withGeoCoderSearch\': item.withGeoCoderSearch}" scroll-to-fm={{model.selectedElement.underMapInfo}}><div class=SelectedItem-Info-AttrLine ng-repeat="info in model.selectedElement.underMapInfo" ng-show=info.value><div class=SelectedItem-Attr-Label>{{info.label}}</div><div class=SelectedItem-Attr-Value ng-bind-html=info.value|to_trusted></div></div></div><section data-ng-if="item.isFieldMapWithListDC && item.selectedItems.length"><div class="PGU-FieldMapWithList-SelectedItem PGU-FieldRadio" data-ng-if=!item.isNewView><ul class="PGU-FieldRadioList PGU-FieldBody"><li class=PGU-FieldRadioItem ng-class="{ \'PGU-FieldRadioItem-active\' : (model.importantDC == radio.value)}" ng-repeat="radio in item.selectedItems"><span class=delete data-ng-click="deleteDC(radio, false, true)">Удалить</span> <a class=PGU-FieldRadioInput ng-click=setImportantDC(radio)><input type=radio name=dc ng-value=radio.value> <i class=PGU-LabelIcon><i></i></i> <span class=PGU-FieldLabel-List>{{radio.title}}</span></a></li></ul></div><div class=important-list data-ng-if=item.isNewView><div class="all-offset-top-40 all-offset-bottom-24"><b>Выбранные дошкольные организации в порядке приоритета</b> (вы можете выбрать до {{item.currentLimitNumberOfEntries}} {{item.currentLimitNumberOfEntriesText}})</div><div class="PGU-HelperBox PGU-HelperBox-Type-important"><h4 class=PGU-HelperBox-Title>Как правильно выбрать дошкольную организацию</h4><div class="PGU-HelperBox-Content PGU-HelperBox-Content"><div class=all-offset-top-16>Найдите дошкольные организации рядом с домом. Дошкольные организации предоставляют по месту жительства ребёнка. Это можно подтвердить свидетельством о регистрации, договором найма или купли-продажи жилого помещения.</div><div class="PGU-Link all-offset-top-16" data-ng-show=!showMoreInfo data-ng-click="showMoreInfo = true"><span class=dc-more-info>Показать подробности</span></div><div ng-show=showMoreInfo><div class=all-offset-top-16>Выберите дошкольные организации, где есть группы подходящей направленности, например, компенсирующие или оздоровительные.</div><div class=all-offset-top-16>Проверьте, что в выбранные дошкольные организации берут детей с нужного вам возраста. Не во всех дошкольных организациях есть ясельные группы.</div><div class=all-offset-top-16>Проверьте, что вам подходит режим работы дошкольной организации.</div><div class=all-offset-top-16>Узнайте больше о выбранных дошкольных организациях — на сайтах, в местном органе управления образованием.</div><div class=all-offset-top-16>Расставьте выбранные дошкольные организации в порядке приоритета. Можно выбрать несколько. Максимальное количество зависит от того, где вы живёте.</div><div class=all-offset-top-16>Поставьте первой в списке дошкольную организацию, которая больше всего вам подходит. Если у вас уже есть ребенок, который получает дошкольное образование, выберите в качестве приоритетной дошкольную организацию, который он посещает.</div><div class="PGU-Link all-offset-top-16" data-ng-click="showMoreInfo = false"><span class=dc-more-info>Скрыть подробности</span></div></div></div></div><div class="important-list-item all-offset-bottom-30" ng-repeat="si in item.selectedItems track by si.priorityNumber"><div class=grid-wrap__row><div class=position><div class=circle><span ng-class="{\'two\': si.priorityNumber.toString().length > 1}" class=number>{{si.priorityNumber}}</span></div></div><div class="grid-wrap__col-lg-13 grid-wrap__col-md-9"><div class=org-title>{{si.title}}</div></div><div class="grid-wrap__col-lg-3 grid-wrap__col-md-3"><div class="flex-container justify-between"><div class=offset data-ng-if="si.priorityNumber <= 1"></div><div class=offset data-ng-if="si.priorityNumber >= item.selectedItems.length"></div><div class="move up" data-ng-click="moveImportantDC(si.priorityNumber, -1)" data-ng-if="si.priorityNumber > 1"></div><div class="move down" data-ng-click="moveImportantDC(si.priorityNumber, 1)" data-ng-if="si.priorityNumber < item.selectedItems.length"></div><div class=remove data-ng-click="deleteDC(si, false, true)"><div class=remove-icon></div></div></div></div></div></div></div></section><div class=PGU-FieldMapWithList-confirm ng-show="model.showConfirm && showConfirmAfterRemove" adjust-margin={{model.showConfirm}}>У вас есть уже выбранный пункт.<br>Заменить его?<div class="PGU-FieldMapWithList-confirm-buttons cf"><div class="PGU-BtnHolder PGU-Btn-margin-lr-0 PGU-BtnContainer-column"><div><a data-ng-href="" class="PGU-Button PGU-Btn-Base PGU-Btn-Small PGU-Btn-Blue" ng-click=confirmSelect() tabindex=1>Да, заменить</a></div></div><div class="PGU-BtnHolder PGU-Btn-margin-lr-0 PGU-Button-align-right PGU-BtnContainer-column"><div><a data-ng-href="" class="PGU-Button PGU-Btn-Base PGU-Btn-Small PGU-Btn-White" ng-click=cancelSelect() tabindex=1>Отмена</a></div></div></div></div></div></div></div>'),
$templateCache.put("js/components/FieldMap/FieldMapWithList-Mobile.html","<div ng-show=(!!item.visible) full-path={{::item.fullPath}}><div ng-if=\"(item.isFieldMapWithList || item.isFieldMapWithListDC)\" data-ng-class=\"{\n                'PGU-Panel': true,\n                'PGU-Panel-FieldMapWithList': true,\n                'PGU-Panel-FieldMapWithListPhone': true,\n                'PGU-LabelWidth-{{::item.labelWidth}}': true,\n                'PGU-Panel-Width-{{::item.width}}': true,\n                'PGU-FMWLPhone-show-map': mobile.currentState == 'map',\n                'PGU-FMWLPhone-show-search': (mobile.currentState == 'list' && $root.settings.mobOptimizeEqueue) || mobile.showSearch,\n                'PGU-FMWLPhone-show-list': mobile.currentState == 'list',\n                'PGU-FMWLPhone-show-details': mobile.currentState == 'details',\n                'PGU-FMWLPhone-show-content': mobile.currentState !== 'form',\n                'PGU-Required': item.required,\n                'PGU-Error': item.error,\n                'PGU-Panel-FieldMapWithList-DC': item.isFieldMapWithListDC,\n                'PGU-FieldMapWithList_mob-optimize': $root.settings.mobOptimizeEqueue\n"+'            }" full-path={{::item.fullPath}}><div data-ng-if=!$root.settings.mobOptimizeEqueue data-ng-class="{\'PGU-Panel-inner\': true, \'PGU-FMWLPhone-HideMapInMobile\': item.hideMapInMobile, \'PGU-Panel-List-Loading\': model.loading}"><div class="PGU-HelperBox PGU-HelperBox-Type-veryImportant" data-ng-if="item.uncorrectedHelperBox && item.uncorrectedRegionText">{{item.uncorrectedRegionText}}</div><div class=PGU-FMWLPhone-Header data-ng-if=!item.uncorrectedHelperBox><div class=PGU-FMWLPhone-mainDetails><div class="PGU-FMWLPhone-mainDetails-Content js-PGU-FMWLPhone-mainDetails-Content"><div class=PGU-FMWLPhoneDetails ng-if=model.selectedElement><h3 class=PGU-FieldMapWithList-Item-title-text>{{model.selectedElement.title}}</h3><div class=PGU-FieldMapWithList-Item-main-attrs ng-if="model.selectedElement.attrs && model.selectedElement.attrs.length"><div class=PGU-FieldMapWithList-Item-Attrs ng-repeat="attr in model.selectedElement.attrs track by $index" ng-if=attr><span class=PGU-AttrsValue ng-bind-html="attr.value | to_trusted"></span></div></div><a class="PGU-FMWLPhone-showDetails PGU-FMWLPhone-showDetails js-PGU-FMWLPhone-showDetails" ng-click="mobile.showDetails(model.selectedElement, \'form\')">Подробная информация</a></div></div></div><div data-ng-if=!item.withGeoCoderSearch class=PGU-FMWLPhone-WrapBtn><div class="PGU-BtnHolder PGU-Button-align-right"><div class="PGU-Btn-margin-0 PGU-Button-align-right {{item.disabled ? \'PGU-Disabled\' : \'\'}}"><a data-ng-if=::!item.hideMapInMobile class="js-PGU-FMWLPhone-toggleWidetState PGU-Btn-Base PGU-Btn-without_icon PGU-Btn-Small PGU-Btn-Blue" data-ng-click="mobile.toggleState(\'form\', (mobile.prevState == \'list\' || (!model.mapList || !model.mapList.length)) ? \'list\' : \'map\')">{{model.selectedElement ? item.selectedDepartmentNameButton : item.departmentNameButton}} </a><a data-ng-if=::item.hideMapInMobile class="js-PGU-FMWLPhone-toggleWidetState PGU-Btn-Base PGU-Btn-without_icon PGU-Btn-Small PGU-Btn-Blue" data-ng-click="mobile.toggleState(\'form\', \'list\')">{{model.selectedElement ? item.selectedDepartmentNameButton : item.departmentNameButton}}</a></div></div></div><div data-ng-if=item.withGeoCoderSearch class=PGU-FMWLPhone-WrapBtn><div class="PGU-BtnHolder PGU-Button-align-right"><div class="PGU-Btn-margin-0 PGU-Button-align-right {{item.disabled ? \'PGU-Disabled\' : \'\'}}"><a data-ng-if="::!item.hideMapInMobile && !item.withGeoCoderSearch" class="js-PGU-FMWLPhone-toggleWidetState PGU-Btn-Base PGU-Btn-without_icon PGU-Btn-Blue" data-ng-click="mobile.toggleState(\'form\', ((!model.originList || !model.originList.length) && !model.loading) ? \'list\' : \'map\')">{{model.selectedElement ? item.selectedDepartmentNameButton : item.departmentNameButton}} </a><a data-ng-if="::item.hideMapInMobile && !item.withGeoCoderSearch" class="js-PGU-FMWLPhone-toggleWidetState PGU-Btn-Base PGU-Btn-without_icon PGU-Btn-Blue" data-ng-click="mobile.toggleState(\'form\', \'list\')">{{model.selectedElement ? item.selectedDepartmentNameButton : item.departmentNameButton}} </a><a data-ng-if=item.withGeoCoderSearch class="js-PGU-FMWLPhone-toggleWidetState PGU-Btn-Base PGU-Btn-without_icon PGU-Btn-Blue" data-ng-click="mobile.toggleState(\'form\', \'map\')">{{model.selectedElement ? item.selectedDepartmentNameButton : item.departmentNameButton}}</a></div></div></div></div><div class="PGU-FMWLPhone-Content js-PGU-FMWLPhone-Content" data-ng-class="{\'PGU-FMWLPhone-WrapContentBtn-withGeoCoderSearch\': item.withGeoCoderSearch}"><div class=PGU-FMWLPhone-WrapContentBtn data-ng-if=item.withGeoCoderSearch data-ng-class="{\'PGU-FMWLPhone-WrapContentBtn-withGeoCoderSearch\': item.withGeoCoderSearch}"><a ng-if="!item.withGeoCoderSearch && mobile.currentState == \'map\'" class=PGU-Link ng-click="mobile.toggleState(\'map\', \'list\');">Показать списком</a> <a ng-if="!item.withGeoCoderSearch && mobile.currentState == \'list\'" class=PGU-Link ng-click="mobile.toggleState(\'list\', \'map\');">Показать на карте</a> <a class="PGU-FMWLPhone-Link-back js-PGU-FMWLPhone-toggleWidetState" data-content-id=btn ng-click="mobile.toggleState(mobile.currentState, \'form\')"></a><div data-ng-if=item.withGeoCoderSearch class=PGU-FMWLPhone-WrapContentBtn-withGeoCoderSearchDropdownWrap><form-tree ng-repeat="item_i in item._geoItems" item=item_i></form-tree></div></div><div class=PGU-FMWLPhone-WrapContentBtn data-ng-if=::!item.withGeoCoderSearch><a class="PGU-FMWLPhone-Link-back js-PGU-FMWLPhone-toggleWidetState" data-content-id=btn ng-click="mobile.toggleState(mobile.currentState, \'form\')">Назад</a><div class="PGU-FieldMapWithListSearch js-PGU-FieldMapWithListSearch" data-ng-show=!model.loading><div class="PGU-FieldTextInput PGU-FieldTextInput-Search PGU-FieldBody"><input class="PGU-FieldTextInputBasic js-PGU-PGU-FMWLPhone-SearchInput field-bordered field-padded" name="" placeholder=Поиск ng-model=mobile.searchValue><div class=PGU-FieldHint ng-bind-html="item.hint | to_trusted"></div><div class=PGU-FieldError></div><span data-ng-if=::!item.hideMapInMobile class="PGU-FieldTextInput-SearchClose js-PGU-FMWLPhone-toggleSearch" ng-click=mobile.toggleSearch()></span> <span data-ng-if=::item.hideMapInMobile class="PGU-FieldTextInput-SearchClose js-PGU-FMWLPhone-toggleSearch"></span> <span class="PGU-FieldTextInput-SearchClear js-PGU-FieldTextInput-SearchClear" ng-click=mobile.clearSearchField()></span></div></div></div><div data-ng-if="item.withGeoCoderSearch || !item.hideMapInMobile" class="PGU-Panel-Map-Wrap js-PGU-Panel-Map-Wrap PGU-FMWLPhone-show-map PGU-GeoCoderMap" data-ng-class="{\'PGU-Panel-Map-Wrap-Cluster-Carousel-Open\': model.options.clusterBalloon.show, \'Disabled-Button\': item.needChangeColorBtn}"><div class=PGU-FieldMapWithList-shadow ng-if=model.loading></div><yandex-map class=PGU-Panel-Map yvalue=model.coords yid="{{item.fullPath + \'_map\'}}" item=item error=item.error baloon=item.baloon opened=model.openedVal options=model.options mobilestate=mobile fieldmodel=model filterchange=model.filterChange list=model.mapList></yandex-map><div class="js-PGU-FMWLPhone-Balloon-Wrap PGU-FMWLPhone-Balloon-Wrap"><div class="PGU-FMWLPhone-Balloon-Inner js-PGU-FMWLPhone-Balloon-Inner"></div></div><div class="PGU-Panel-Map-error-bg js-PGU-Panel-Map-error-bg"></div><div class="PGU-Panel-Map-error-shadow js-PGU-Panel-Map-error-shadow"></div><div class="PGU-Map-error-content js-PGU-Map-error-content"><div class=error-icon></div><div class=error-text>Не удалось показать<br>объект на карте</div></div></div><div class="PGU-Panel-List-Wrap js-PGU-Panel-ListWrap PGU-FMWLPhone-show-list"><div class=PGU-Panel-FieldMapWithList-error data-ng-show="(!model.mapList || !model.mapList.length) && !model.loading">Запрос не дал результатов<div class=PGU-Panel-FieldMapWithList-error-text>К сожалению, список подразделений для получения услуги недоступен в указанном регионе</div></div><div data-ng-if=::item.hideMapInMobile class="js-PGU-FieldMapWithList-List-Wrap PGU-FieldMapWithList-List-Wrap" data-when-scrolled=loadMore();><div class=PGU-FieldMapList-Items data-ng-show=!model.loading><div class=PGU-FieldMapWithListItemWrap data-ng-repeat="oneItem in model.mapList track by $index"><div class="PGU-FieldMapWithList-Item js-PGU-FMWL-Item-Phone" data-ng-click="mobile.showDetails(oneItem, \'list\', true)"><h3 class=PGU-FieldMapWithList-Item-title-text>{{oneItem.title}}</h3><div class=PGU-FieldMapWithList-Item-main-attrs data-ng-if="oneItem.attrs && oneItem.attrs.length"><div class=PGU-FieldMapWithList-Item-Attrs data-ng-repeat="attr in oneItem.attrs" data-ng-if=attr.value><span class=PGU-AttrsLabel>{{attr.label}}:&nbsp;</span><span class=PGU-AttrsValue data-ng-bind-html=attr.value></span></div></div></div></div></div><div class=PGU-List-Loader data-ng-show="model.loading && item.hideMapInMobile"><epgu-throbber data-throbber-type=PGU-throbber-medium data-show-heading=true></epgu-throbber></div></div><div data-ng-if=::!item.hideMapInMobile class="js-PGU-FieldMapWithList-List-Wrap PGU-FieldMapWithList-List-Wrap"><div class=PGU-FieldMapList-Items data-ng-show=!model.loading><div class=PGU-FieldMapWithListItemWrap ng-repeat="oneItem in model.mapList | filter: (mobile.showSearch || \'\') && {title: mobile.searchValue}"><div class="PGU-FieldMapWithList-Item js-PGU-FMWL-Item-Phone" ng-click="mobile.showDetails(oneItem, \'list\')"><h3 class=PGU-FieldMapWithList-Item-title-text>{{oneItem.title}}</h3><div class=PGU-FieldMapWithList-Item-main-attrs ng-if="oneItem.attrs && oneItem.attrs.length"><div class=PGU-FieldMapWithList-Item-Attrs ng-repeat="attr in oneItem.attrs" ng-if=attr.value><span class=PGU-AttrsLabel>{{attr.label}}:&nbsp;</span><span class=PGU-AttrsValue ng-bind-html=attr.value></span></div></div></div></div></div><div class=PGU-List-Loader data-ng-show=model.loading><epgu-throbber data-throbber-type=PGU-throbber-medium data-show-heading=true></epgu-throbber></div></div></div><div class="PGU-FieldMapWithList-WidgetError js-PGU-FieldMapWithList-WidgetError"></div><div data-ng-if=::!item.hideMapInMobile class=PGU-FMWLPhone-WrapMenu><nav class="PGU-FMWLPhone-Menu js-PGU-FMWLPhone-Menu"><a class="PGU-FMWLPhone-Menu-Item PGU-FMWLPhone-Menu-Link js-PGU-FMWLPhone-Menu-Link PGU-FMWLPhone-Menu-Item-list {{mobile.currentState == \'list\' ? \'PGU-FMWLPhone-Menu-Item-active\':\'\'}}" ng-click="mobile.toggleState(\'form\', \'list\');"></a> <a class="PGU-FMWLPhone-Menu-Item PGU-FMWLPhone-Menu-Link js-PGU-FMWLPhone-Menu-Link PGU-FMWLPhone-Menu-Item-map {{mobile.currentState == \'map\' ? \'PGU-FMWLPhone-Menu-Item-active\':\'\'}}" ng-click="mobile.toggleState(\'form\', \'map\')"></a> <a class="PGU-FMWLPhone-Menu-Item PGU-FMWLPhone-Menu-Link js-PGU-FMWLPhone-toggleSearch PGU-FMWLPhone-Menu-Item-search {{mobile.showSearch ? \'PGU-FMWLPhone-Menu-Item-active\' : \'\'}}" ng-click=mobile.toggleSearch()></a></nav></div></div><div class="PGU-FMWLPhone-Details js-PGU-FMWLPhone-Details"><div class=PGU-FMWLPhone-WrapContentBtn data-ng-class="{\'PGU-FMWLPhone-WrapContentBtn-withGeoCoderSearch\': item.withGeoCoderSearch}"><a data-ng-if=!item.withGeoCoderSearch class="PGU-FMWLPhone-Link-back js-PGU-FMWLPhone-toggleWidetState" data-content-id=btn ng-click="mobile.toggleState(mobile.currentState, \'form\')">Назад</a> <a data-ng-if=item.withGeoCoderSearch class="PGU-FMWLPhone-Link-back js-PGU-FMWLPhone-toggleWidetState" data-content-id=content ng-click="mobile.toggleState(mobile.currentState, mobile.prevState)"></a></div><div class="PGU-FMWLPhone-Details-Content js-PGU-FMWLPhone-Details-Content"><div class=PGU-FMWLPhoneDetails><div data-ng-if="mobile.itemDetails.slots.value !== \'\'" class=slot-block><span class="slot-box {{mobile.itemDetails.slots.className}}"></span><span class=slot-message>{{mobile.itemDetails.slots.message}}</span></div><h3 class=PGU-FMWLPhoneDetails-Title>{{mobile.itemDetails.title}}</h3><h4 class=PGU-FMWLPhoneDetails-subTitle ng-if="mobile.itemDetails.attributeValues && mobile.itemDetails.attributeValues.PARENTNAME">В составе {{mobile.itemDetails.attributeValues.PARENTNAME}}</h4><div class="PGU-BtnHolder PGU-Button-align-right"><div class="PGU-Btn-margin-0 PGU-Button-align-right"><div ng-if="!item.value || mobile.itemDetails.value !== item.value"><a class="js-PGU-FMWLPhone-toggleWidetState PGU-Btn-Base PGU-Btn-without_icon PGU-Btn-Small PGU-Btn-Blue" ng-click=mobile.setCurrentItem(mobile.itemDetails.value)>{{::item.departmentNameButton}}</a></div></div></div><div class=PGU-FieldMapWithList-Item-main-attrs ng-if="mobile.itemDetails.attrs && mobile.itemDetails.attrs.length"><div class=PGU-FieldMapWithList-Item-Attrs ng-repeat="attr in mobile.itemDetails.attrs track by $index" ng-if="attr.value && attr.value !== \'В составе\'"><span class=PGU-AttrsLabel>{{attr.label}}</span> <span class="PGU-AttrsValue {{attr.label === \'Телефон\' ? \'PGU-AttrsValue-Color-blue\' : \'\'}}" ng-bind-html=attr.value></span></div></div><div class=PGU-FieldMapWithList-Item-details-attrs ng-if="mobile.itemDetails.details && mobile.itemDetails.details.length"><div class=PGU-FieldMapWithList-Item-Attrs ng-repeat="attr in mobile.itemDetails.details track by $index" ng-if="attr.value && attr.value !== \'В состае\'"><span data-ng-if=attr.label class=PGU-AttrsLabel>{{attr.label}}</span> <span class=PGU-AttrsValue ng-bind-html=attr.value></span></div><div class="PGU-FMWLPhoneDetailsMap js-PGU-FMWLPhoneDetailsMap"><yandex-map yid="{{item.fullPath + \'_map_details\'}}" item=item yvalue=mobile.itemDetails.center error=item.error opened=model.openedVal baloon=null></yandex-map></div></div></div></div></div></div><div data-ng-if="item.withGeoCoderSearch && $root.settings.mobOptimizeEqueue" data-ng-class="{\'PGU-Panel-inner\': true, \'PGU-FMWLPhone-HideMapInMobile\': item.hideMapInMobile, \'PGU-Panel-List-Loading\': model.loading}"><div class="PGU-HelperBox PGU-HelperBox-Type-veryImportant" data-ng-if="item.uncorrectedHelperBox && item.uncorrectedRegionText">{{item.uncorrectedRegionText}}</div><div class=PGU-FMWLPhone-Header data-ng-if=!item.uncorrectedHelperBox><div class=PGU-FMWLPhone-mainDetails><div class="PGU-FMWLPhone-mainDetails-Content js-PGU-FMWLPhone-mainDetails-Content"><div class=PGU-FMWLPhoneDetails ng-if=model.selectedElement><h3 class=PGU-FieldMapWithList-Item-title-text>{{model.selectedElement.title}}</h3><div class=PGU-FieldMapWithList-Item-main-attrs ng-if="model.selectedElement.attrs && model.selectedElement.attrs.length"><div class=PGU-FieldMapWithList-Item-Attrs ng-repeat="attr in model.selectedElement.attrs track by $index" ng-if=attr><span class=PGU-AttrsValue ng-bind-html="attr.value | to_trusted"></span></div></div><a class="PGU-FMWLPhone-showDetails PGU-FMWLPhone-showDetails js-PGU-FMWLPhone-showDetails" ng-click="mobile.showDetails(model.selectedElement, \'form\')">Подробная информация</a></div></div></div><div data-ng-if=!item.withGeoCoderSearch class=PGU-FMWLPhone-WrapBtn><div class="PGU-BtnHolder PGU-Button-align-right"><div class="PGU-Btn-margin-0 PGU-Button-align-right {{item.disabled ? \'PGU-Disabled\' : \'\'}}"><a data-ng-if=::!item.hideMapInMobile class="js-PGU-FMWLPhone-toggleWidetState PGU-Btn-Base PGU-Btn-without_icon PGU-Btn-Small PGU-Btn-Blue" data-ng-click="mobile.toggleState(\'form\', ((!model.originList || !model.originList.length) && !model.loading) ? \'list\' : \'map\')">{{model.selectedElement ? item.selectedDepartmentNameButton : item.departmentNameButton}} </a><a data-ng-if=::item.hideMapInMobile class="js-PGU-FMWLPhone-toggleWidetState PGU-Btn-Base PGU-Btn-without_icon PGU-Btn-Small PGU-Btn-Blue" data-ng-click="mobile.toggleState(\'form\', \'list\')">{{model.selectedElement ? item.selectedDepartmentNameButton : item.departmentNameButton}}</a></div></div></div><div data-ng-if=item.withGeoCoderSearch class=PGU-FMWLPhone-WrapBtn><div class="PGU-BtnHolder PGU-Button-align-right"><div class="PGU-Btn-margin-0 PGU-Button-align-right {{item.disabled ? \'PGU-Disabled\' : \'\'}}"><a data-ng-if="::!item.hideMapInMobile && !item.withGeoCoderSearch" class="js-PGU-FMWLPhone-toggleWidetState PGU-Btn-Base PGU-Btn-without_icon PGU-Btn-Blue" data-ng-click="mobile.toggleState(\'form\', ((!model.originList || !model.originList.length) && !model.loading) ? \'list\' : \'map\')">{{model.selectedElement ? item.selectedDepartmentNameButton : item.departmentNameButton}} </a><a data-ng-if="::item.hideMapInMobile && !item.withGeoCoderSearch" class="js-PGU-FMWLPhone-toggleWidetState PGU-Btn-Base PGU-Btn-without_icon PGU-Btn-Blue" data-ng-click="mobile.toggleState(\'form\', \'list\')">{{model.selectedElement ? item.selectedDepartmentNameButton : item.departmentNameButton}} </a><a data-ng-if=item.withGeoCoderSearch class="js-PGU-FMWLPhone-toggleWidetState PGU-Btn-Base PGU-Btn-without_icon PGU-Btn-Blue" data-ng-click="mobile.toggleState(\'form\', \'map\')">{{model.selectedElement ? item.selectedDepartmentNameButton : item.departmentNameButton}}</a></div></div></div></div><div class="PGU-FMWLPhone-Content js-PGU-FMWLPhone-Content" data-ng-class="{\'PGU-FMWLPhone-WrapContentBtn-withGeoCoderSearch\': item.withGeoCoderSearch}"><div class=PGU-FMWLPhone-WrapContentBtn data-ng-class="{\'PGU-FMWLPhone-WrapContentBtn-withGeoCoderSearch\': item.withGeoCoderSearch}" data-ng-if=item.withGeoCoderSearch><a ng-if="!item.withGeoCoderSearch && mobile.currentState == \'map\'" class=PGU-Link ng-click="mobile.toggleState(\'map\', \'list\');">Показать списком</a> <a ng-if="!item.withGeoCoderSearch && mobile.currentState == \'list\'" class=PGU-Link ng-click="mobile.toggleState(\'list\', \'map\');">Показать на карте</a> <a class="PGU-FMWLPhone-Link-back js-PGU-FMWLPhone-toggleWidetState" data-content-id=btn ng-click="mobile.toggleState(mobile.currentState, \'form\')"></a><div data-ng-if=item.withGeoCoderSearch class=PGU-FMWLPhone-WrapContentBtn-withGeoCoderSearchDropdownWrap><form-tree ng-repeat="item_i in item._geoItems" item=item_i></form-tree></div></div><div class=PGU-FMWLPhone-WrapContentBtn data-ng-if=!item.withGeoCoderSearch><a class="PGU-FMWLPhone-Link-back js-PGU-FMWLPhone-toggleWidetState" data-content-id=btn ng-click="mobile.toggleState(mobile.currentState, \'form\')">Назад</a><div class="PGU-FieldMapWithListSearch js-PGU-FieldMapWithListSearch" data-ng-show=!model.loading><div class="PGU-FieldTextInput PGU-FieldTextInput-Search PGU-FieldBody"><input class="PGU-FieldTextInputBasic js-PGU-PGU-FMWLPhone-SearchInput field-bordered field-padded" name="" placeholder=Поиск ng-model=mobile.searchValue><div class=PGU-FieldHint ng-bind-html="item.hint | to_trusted"></div><div class=PGU-FieldError></div><span data-ng-if=::!item.hideMapInMobile class="PGU-FieldTextInput-SearchClose js-PGU-FMWLPhone-toggleSearch" ng-click=mobile.toggleSearch()></span> <span data-ng-if=::item.hideMapInMobile class="PGU-FieldTextInput-SearchClose js-PGU-FMWLPhone-toggleSearch"></span> <span class="PGU-FieldTextInput-SearchClear js-PGU-FieldTextInput-SearchClear" ng-click=mobile.clearSearchField()></span></div></div></div><div data-ng-if="item.withGeoCoderSearch || !item.hideMapInMobile" class="PGU-Panel-Map-Wrap js-PGU-Panel-Map-Wrap PGU-FMWLPhone-show-map" data-ng-class="{\'PGU-Panel-Map-Wrap-Cluster-Carousel-Open\': model.options.clusterBalloon.show}"><div class=PGU-FieldMapWithList-shadow ng-if=model.loading></div><yandex-map class=PGU-Panel-Map yvalue=model.coords yid="{{item.fullPath + \'_map\'}}" item=item error=item.error baloon=item.baloon opened=model.openedVal options=model.options mobilestate=mobile fieldmodel=model filterchange=model.filterChange list=model.mapList></yandex-map><div class="js-PGU-FMWLPhone-Balloon-Wrap PGU-FMWLPhone-Balloon-Wrap"><div class="PGU-FMWLPhone-Balloon-Inner js-PGU-FMWLPhone-Balloon-Inner"></div></div><div class="PGU-Panel-Map-error-bg js-PGU-Panel-Map-error-bg"></div><div class="PGU-Panel-Map-error-shadow js-PGU-Panel-Map-error-shadow"></div><div class="PGU-Map-error-content js-PGU-Map-error-content"><div class=error-icon></div><div class=error-text>Не удалось показать<br>объект на карте</div></div></div><div class="PGU-Panel-List-Wrap js-PGU-Panel-ListWrap PGU-FMWLPhone-show-list"><div data-ng-if=item.hideMapInMobile class="js-PGU-FieldMapWithList-List-Wrap PGU-FieldMapWithList-List-Wrap" data-when-scrolled=loadMore();><div class=PGU-FieldMapList-Items data-ng-show=!model.loading><div class="PGU-FieldMapWithListSearch js-PGU-FieldMapWithListSearch" data-ng-show=!model.loading><div class="PGU-FieldTextInput PGU-FieldTextInput-Search PGU-FieldBody"><input class="PGU-FieldTextInputBasic js-PGU-PGU-FMWLPhone-SearchInput field-bordered field-padded" name="" placeholder=Поиск ng-model=mobile.searchValue><div class=PGU-FieldHint ng-bind-html="item.hint | to_trusted"></div><div class=PGU-FieldError></div></div></div><div class=PGU-FieldMapWithListItemWrap data-ng-repeat="oneItem in model.mapList track by $index"><div class="PGU-FieldMapWithList-Item js-PGU-FMWL-Item-Phone" data-ng-click="mobile.showDetails(oneItem, \'list\', true)"><h3 class=PGU-FieldMapWithList-Item-title-text>{{oneItem.title}}</h3><div class=PGU-FieldMapWithList-Item-main-attrs data-ng-if="oneItem.attrs && oneItem.attrs.length"><div class=PGU-FieldMapWithList-Item-Attrs data-ng-repeat="attr in oneItem.attrs" data-ng-if=attr.value><span class=PGU-AttrsLabel>{{attr.label}}:&nbsp;</span><span class=PGU-AttrsValue data-ng-bind-html=attr.value></span></div></div></div></div></div><div class=PGU-Panel-FieldMapWithList-error data-ng-show="(!model.mapList || !model.mapList.length) && !model.loading">Запрос не дал результатов<div class=PGU-Panel-FieldMapWithList-error-text>К сожалению, список подразделений для получения услуги недоступен в указанном регионе</div></div><div class=PGU-List-Loader data-ng-show="model.loading && item.hideMapInMobile"><epgu-throbber data-throbber-type=PGU-throbber-medium data-show-heading=true></epgu-throbber></div></div><div data-ng-if=::!item.hideMapInMobile class="js-PGU-FieldMapWithList-List-Wrap PGU-FieldMapWithList-List-Wrap"><div class=PGU-FieldMapList-Items><div class="PGU-FieldMapWithListSearch js-PGU-FieldMapWithListSearch" data-ng-show="model.originList && model.originList.length && !model.loading"><div class="PGU-FieldTextInput PGU-FieldTextInput-Search PGU-FieldBody"><input class="PGU-FieldTextInputBasic js-PGU-PGU-FMWLPhone-SearchInput field-bordered field-padded" name="" placeholder=Поиск ng-model=mobile.searchValue><div class=PGU-FieldHint ng-bind-html="item.hint | to_trusted"></div><div class=PGU-FieldError></div></div></div><div class=PGU-FieldMapWithListItemWrap ng-repeat="oneItem in model.mapList | filter: (mobile.showSearch || \'\') && {title: mobile.searchValue}" ng-click="mobile.showDetails(oneItem, \'list\')"><div class="PGU-FieldMapWithList-Item js-PGU-FMWL-Item-Phone"><h3 class=PGU-FieldMapWithList-Item-title-text>{{oneItem.title}}</h3><div class=PGU-FieldMapWithList-Item-main-attrs ng-if="oneItem.attrs && oneItem.attrs.length"><div class=PGU-FieldMapWithList-Item-Attrs ng-repeat="attr in oneItem.attrs" ng-if=attr.value><span class=PGU-AttrsLabel>{{attr.label}}:&nbsp;</span><span class=PGU-AttrsValue ng-bind-html=attr.value></span></div></div></div></div></div><div class=PGU-List-Loader data-ng-show=model.loading><epgu-throbber data-throbber-type=PGU-throbber-medium data-show-heading=true></epgu-throbber></div></div></div><div class="PGU-FieldMapWithList-WidgetError js-PGU-FieldMapWithList-WidgetError"></div></div><div class="PGU-FMWLPhone-Details js-PGU-FMWLPhone-Details"><div class=PGU-FMWLPhone-WrapContentBtn data-ng-class="{\'PGU-FMWLPhone-WrapContentBtn-withGeoCoderSearch\': item.withGeoCoderSearch}"><a data-ng-if=!item.withGeoCoderSearch class="PGU-FMWLPhone-Link-back js-PGU-FMWLPhone-toggleWidetState" data-content-id=btn ng-click="mobile.toggleState(mobile.currentState, \'form\')">Назад</a> <a data-ng-if=item.withGeoCoderSearch class="PGU-FMWLPhone-Link-back js-PGU-FMWLPhone-toggleWidetState" data-content-id=content ng-click="mobile.toggleState(mobile.currentState, mobile.prevState)"></a></div><div class="PGU-FMWLPhone-Details-Content js-PGU-FMWLPhone-Details-Content"><div class=PGU-FMWLPhoneDetails><h3 class=PGU-FMWLPhoneDetails-Title>{{mobile.itemDetails.title}}</h3><h4 class=PGU-FMWLPhoneDetails-subTitle ng-if="mobile.itemDetails.attributeValues && mobile.itemDetails.attributeValues.PARENTNAME">В составе {{mobile.itemDetails.attributeValues.PARENTNAME}}</h4><div class="PGU-BtnHolder PGU-Button-align-right"><div class="PGU-Btn-margin-0 PGU-Button-align-right"><a class="js-PGU-FMWLPhone-toggleWidetState PGU-Btn-Base PGU-Btn-without_icon PGU-Btn-Blue" ng-if="!item.value || mobile.itemDetails.value !== item.value" ng-click=mobile.setCurrentItem(mobile.itemDetails.value)>{{::item.departmentNameButton}}</a></div></div><div class=PGU-FieldMapWithList-Item-details-attrs ng-if="mobile.itemDetails.details && mobile.itemDetails.details.length"><div class=PGU-FieldMapWithList-Item-Attrs ng-repeat="attr in mobile.itemDetails.details track by $index" ng-if="attr.value && attr.value !== \'В состае\'"><span data-ng-if=attr.label class=PGU-AttrsLabel>{{attr.label}}:</span> <span class=PGU-AttrsValue ng-bind-html=attr.value></span> <a href=# ng-if="!item.hideMapInMobile && attr.label.toLowerCase() == \'адрес\'" class=pin ng-click="mobile.selectPlacemark(mobile.itemDetails, \'detail\', true)"></a></div><div data-ng-if="item.withGeoCoderSearch || !item.hideMapInMobile" class="PGU-FMWLPhoneDetailsMap js-PGU-FMWLPhoneDetailsMap"><yandex-map yid="{{item.fullPath + \'_map_details\'}}" item=item yvalue=mobile.itemDetails.center error=item.error opened=model.openedVal baloon=null></yandex-map></div></div></div></div></div></div><div data-ng-if="!item.withGeoCoderSearch && $root.settings.mobOptimizeEqueue" data-ng-class="{\'PGU-Panel-inner\': true, \'PGU-FMWLPhone-HideMapInMobile\': item.hideMapInMobile, \'PGU-Panel-List-Loading\': model.loading}"><div class="PGU-HelperBox PGU-HelperBox-Type-veryImportant" data-ng-if="item.uncorrectedHelperBox && item.uncorrectedRegionText">{{item.uncorrectedRegionText}}</div><div class=PGU-FMWLPhone-Header data-ng-if=!item.uncorrectedHelperBox><div class=PGU-FMWLPhone-mainDetails><div class="PGU-FMWLPhone-mainDetails-Content js-PGU-FMWLPhone-mainDetails-Content"><div class=PGU-FMWLPhoneDetails ng-if=model.selectedElement><h3 class=PGU-FieldMapWithList-Item-title-text>{{model.selectedElement.title}}</h3><div class=PGU-FieldMapWithList-Item-main-attrs ng-if="model.selectedElement.attrs && model.selectedElement.attrs.length"><div class=PGU-FieldMapWithList-Item-Attrs ng-repeat="attr in model.selectedElement.attrs track by $index" ng-if=attr><span class=PGU-AttrsValue ng-bind-html="attr.value | to_trusted"></span></div></div><a class="PGU-FMWLPhone-showDetails PGU-FMWLPhone-showDetails js-PGU-FMWLPhone-showDetails" ng-click="mobile.showDetails(model.selectedElement, \'form\')">Подробная информация</a></div></div></div><div class=PGU-FMWLPhone-WrapBtn><div class="PGU-BtnHolder PGU-Button-align-right"><div class="PGU-Btn-margin-0 PGU-Button-align-right {{item.disabled ? \'PGU-Disabled\' : \'\'}}"><a data-ng-if=::!item.hideMapInMobile class="js-PGU-FMWLPhone-toggleWidetState PGU-Btn-Base PGU-Btn-without_icon PGU-Btn-Blue" data-ng-click="mobile.toggleState(\'form\', ((!model.originList || !model.originList.length) && !model.loading) ? \'list\' : \'map\')">{{model.selectedElement ? item.selectedDepartmentNameButton : item.departmentNameButton}} </a><a data-ng-if=::item.hideMapInMobile class="js-PGU-FMWLPhone-toggleWidetState PGU-Btn-Base PGU-Btn-without_icon PGU-Btn-Blue" data-ng-click="mobile.toggleState(\'form\', \'list\')">{{model.selectedElement ? item.selectedDepartmentNameButton : item.departmentNameButton}}</a></div></div></div></div><div class="PGU-FMWLPhone-Content js-PGU-FMWLPhone-Content"><div class=PGU-FMWLPhone-WrapContentBtn><a ng-if="mobile.currentState == \'map\'" class=PGU-Link ng-click="mobile.toggleState(\'map\', \'list\');">Показать списком</a> <a ng-if="!item.hideMapInMobile && mobile.currentState == \'list\'" class=PGU-Link ng-click="mobile.toggleState(\'list\', \'map\');">Показать на карте</a> <a class="PGU-FMWLPhone-Link-back js-PGU-FMWLPhone-toggleWidetState" data-content-id=btn ng-click="mobile.toggleState(mobile.currentState, \'form\')"></a></div><div data-ng-if=::!item.hideMapInMobile class="PGU-Panel-Map-Wrap js-PGU-Panel-Map-Wrap PGU-FMWLPhone-show-map"><div class=PGU-FieldMapWithList-shadow ng-if=model.loading></div><yandex-map class=PGU-Panel-Map yvalue=model.coords yid="{{item.fullPath + \'_map\'}}" item=item error=item.error baloon=item.baloon opened=model.openedVal options=model.options mobilestate=mobile fieldmodel=model list=model.mapList></yandex-map><div class="js-PGU-FMWLPhone-Balloon-Wrap PGU-FMWLPhone-Balloon-Wrap"><div class="PGU-FMWLPhone-Balloon-Inner js-PGU-FMWLPhone-Balloon-Inner"></div></div><div class="PGU-Panel-Map-error-bg js-PGU-Panel-Map-error-bg"></div><div class="PGU-Panel-Map-error-shadow js-PGU-Panel-Map-error-shadow"></div><div class="PGU-Map-error-content js-PGU-Map-error-content"><div class=error-icon></div><div class=error-text>Не удалось показать<br>объект на карте</div></div></div><div class="PGU-Panel-List-Wrap js-PGU-Panel-ListWrap PGU-FMWLPhone-show-list"><div data-ng-if=::item.hideMapInMobile class="js-PGU-FieldMapWithList-List-Wrap PGU-FieldMapWithList-List-Wrap" data-when-scrolled=loadMore();><div class=PGU-FieldMapList-Items data-ng-show=!model.loading><div class="PGU-FieldMapWithListSearch js-PGU-FieldMapWithListSearch" data-ng-show=!model.loading><div class="PGU-FieldTextInput PGU-FieldTextInput-Search PGU-FieldBody"><input class="PGU-FieldTextInputBasic js-PGU-PGU-FMWLPhone-SearchInput field-bordered field-padded" name="" placeholder=Поиск ng-model=mobile.searchValue><div class=PGU-FieldHint ng-bind-html="item.hint | to_trusted"></div><div class=PGU-FieldError></div></div></div><div class=PGU-FieldMapWithListItemWrap data-ng-repeat="oneItem in model.mapList track by $index"><div class="PGU-FieldMapWithList-Item js-PGU-FMWL-Item-Phone" data-ng-click="mobile.showDetails(oneItem, \'list\', true)"><h3 class=PGU-FieldMapWithList-Item-title-text>{{oneItem.title}}</h3><div class=PGU-FieldMapWithList-Item-main-attrs data-ng-if="oneItem.attrs && oneItem.attrs.length"><div class=PGU-FieldMapWithList-Item-Attrs data-ng-repeat="attr in oneItem.attrs" data-ng-if=attr.value><span class=PGU-AttrsLabel>{{attr.label}}:&nbsp;</span><span class=PGU-AttrsValue data-ng-bind-html=attr.value></span></div></div></div></div></div><div class=PGU-Panel-FieldMapWithList-error data-ng-show="(!model.mapList || !model.mapList.length) && !model.loading">Запрос не дал результатов<div class=PGU-Panel-FieldMapWithList-error-text>К сожалению, список подразделений для получения услуги недоступен в указанном регионе</div></div><div class=PGU-List-Loader data-ng-show="model.loading && item.hideMapInMobile"><epgu-throbber data-throbber-type=PGU-throbber-medium data-show-heading=true></epgu-throbber></div></div><div data-ng-if=::!item.hideMapInMobile class="js-PGU-FieldMapWithList-List-Wrap PGU-FieldMapWithList-List-Wrap"><div class=PGU-FieldMapList-Items><div class="PGU-FieldMapWithListSearch js-PGU-FieldMapWithListSearch" data-ng-show="model.originList && model.originList.length && !model.loading"><div class="PGU-FieldTextInput PGU-FieldTextInput-Search PGU-FieldBody"><input class="PGU-FieldTextInputBasic js-PGU-PGU-FMWLPhone-SearchInput field-bordered field-padded" name="" placeholder=Поиск ng-model=mobile.searchValue><div class=PGU-FieldHint ng-bind-html="item.hint | to_trusted"></div><div class=PGU-FieldError></div></div></div><div class=PGU-FieldMapWithListItemWrap ng-repeat="oneItem in model.mapList | filter: (mobile.showSearch || \'\') && {title: mobile.searchValue}" ng-click="mobile.showDetails(oneItem, \'list\')"><div class="PGU-FieldMapWithList-Item js-PGU-FMWL-Item-Phone"><h3 class=PGU-FieldMapWithList-Item-title-text>{{oneItem.title}}</h3><div class=PGU-FieldMapWithList-Item-main-attrs ng-if="oneItem.attrs && oneItem.attrs.length"><div class=PGU-FieldMapWithList-Item-Attrs ng-repeat="attr in oneItem.attrs" ng-if=attr.value><span class=PGU-AttrsLabel>{{attr.label}}:&nbsp;</span><span class=PGU-AttrsValue ng-bind-html=attr.value></span></div></div></div></div><div class=PGU-Panel-FieldMapWithList-error data-ng-if="(!model.originList || !model.originList.length) && !model.loading">Запрос не дал результатов<div class=PGU-Panel-FieldMapWithList-error-text>К сожалению, список подразделений для получения услуги недоступен в указанном регионе</div></div><div class=PGU-List-Loader data-ng-show=model.loading><epgu-throbber data-throbber-type=PGU-throbber-medium data-show-heading=true></epgu-throbber></div></div></div></div><div class="PGU-FieldMapWithList-WidgetError js-PGU-FieldMapWithList-WidgetError"></div></div><div class="PGU-FMWLPhone-Details js-PGU-FMWLPhone-Details"><div class=PGU-FMWLPhone-WrapContentBtn><a ng-if="mobile.currentState == \'map\'" class=PGU-Link ng-click="mobile.toggleState(\'map\', \'list\');">Показать списком</a> <a ng-if="!item.hideMapInMobile && mobile.currentState == \'list\'" class=PGU-Link ng-click="mobile.toggleState(\'list\', \'map\');">Показать на карте</a> <a class="PGU-FMWLPhone-Link-back js-PGU-FMWLPhone-toggleWidetState" data-content-id=content ng-click="mobile.toggleState(mobile.currentState, mobile.prevState)"></a></div><div class="PGU-FMWLPhone-Details-Content js-PGU-FMWLPhone-Details-Content"><div class=PGU-FMWLPhoneDetails><h3 class=PGU-FMWLPhoneDetails-Title>{{mobile.itemDetails.title}}</h3><h4 class=PGU-FMWLPhoneDetails-subTitle ng-if="mobile.itemDetails.attributeValues && mobile.itemDetails.attributeValues.PARENTNAME">В составе {{mobile.itemDetails.attributeValues.PARENTNAME}}</h4><div class="PGU-BtnHolder PGU-Button-align-right"><div class="PGU-Btn-margin-0 PGU-Button-align-right"><a class="js-PGU-FMWLPhone-toggleWidetState PGU-Btn-Base PGU-Btn-without_icon PGU-Btn-Blue" ng-if="!item.value || mobile.itemDetails.value !== item.value" ng-click=mobile.setCurrentItem(mobile.itemDetails.value)>{{::item.departmentNameButton}}</a></div></div><div class=PGU-FieldMapWithList-Item-details-attrs ng-if="mobile.itemDetails.details && mobile.itemDetails.details.length"><div class=PGU-FieldMapWithList-Item-Attrs ng-repeat="attr in mobile.itemDetails.details track by $index" ng-if="attr.value && attr.value !== \'В составе\'"><span data-ng-if=attr.label class=PGU-AttrsLabel>{{attr.label}}:</span><div data-ng-if="!item.hideMapInMobile && attr.label.toLowerCase() == \'адрес\'" data-ng-click="mobile.selectPlacemark(mobile.itemDetails, \'detail\', true)" class=flex-container><span data-ng-bind-html=attr.value class="PGU-AttrsValue PGU-AttrsValue-mode-link"></span><div class=PGU-Icon__wrap-map-pin><span class="PGU-Icon PGU-Icon__map-pin"></span></div></div><span data-ng-if="!item.hideMapInMobile && attr.label.toLowerCase() !== \'адрес\'" data-ng-bind-html=attr.value class=PGU-AttrsValue></span> <span data-ng-if=item.hideMapInMobile data-ng-bind-html=attr.value class=PGU-AttrsValue></span></div><div data-ng-if=::item.hideMapInMobile class="PGU-FMWLPhoneDetailsMap js-PGU-FMWLPhoneDetailsMap"><yandex-map yid="{{item.fullPath + \'_map_details\'}}" item=item yvalue=mobile.itemDetails.center error=item.error opened=model.openedVal baloon=null></yandex-map></div></div></div></div></div></div><div class=PGU-FieldBody><div class=PGU-FieldNotRequired ng-if=item.notRequiredText>{{item.notRequiredText}}</div><div class=PGU-FieldHint ng-if=item.hint>{{item.hint}}</div><div class=PGU-FieldError data-ng-if=item.error>{{(item.error.mnemonic + \'.validator\' | translate:item.error.text) || (item.error.text || item.error)}}</div></div></div></div>'),
$templateCache.put("js/components/FieldMap/FieldMapWithListDC-Mobile.html",'<div ng-show=(!!item.visible) full-path={{::item.fullPath}}><div ng-if="(item.isFieldMapWithList || item.isFieldMapWithListDC)" class="PGU-Panel PGU-Panel-FieldMapWithList PGU-LabelWidth-{{item.labelWidth}} PGU-Panel-Width-{{item.width}} {{item.required ? \'PGU-Required\' : \'\'}} {{item.error ? \'PGU-Error\' : \'\'}} {{item.isFieldMapWithListDC ? \'PGU-Panel-FieldMapWithList-DC\' : \'\'}}" full-path={{item.fullPath}}><div class=PGU-Panel-inner><div class="FieldMapWithListDC-Mobile PGU-FieldMapContainer {{item.needChangeColorBtn ? \'Disabled-Button\' : \'\'}}"><div class="MapDC-Step1 js-PGU-MapDC-mob-step1" ng-show="mobile.currentState == \'form\'"><a class="js-PGU-FMWLPhone-toggleWidetState PGU-Btn-Base PGU-Btn-without_icon PGU-Btn-Small PGU-Btn-Blue" ng-click="mobile.toggleState(\'form\', mobile.prevState ? mobile.prevState : \'map\')">Выбрать детский сад</a><div class="MapDC-SelectedList-Wrap js-MapDC-SelectedList-Wrap" data-ng-if=!item.isNewView><div class="PGU-Panel-title PGU-QuestionHint {{item.selectedItems && item.selectedItems.length ? \'\':\'MapDC-Hint-Priority-Hidden\'}}">Какой из выбранных детсадов сделать предпочтительным? <span class="PGU-PopupHint MapDC-Hint-Priority"><i class=questionIcon click-hint=1><span class=PGU-PopupHintOuterArrow></span> </i></span><span data-ng-if=$root.device.device class="PGU-PopupHintOuter mobile MapDC-Hint-Priority-Content {{item.deviceShow ? \'PGU-showHint\' : \'\'}}"><span class=PGU-PopupHintContent>В данный детcкий сад зачисление ребенка будет рассматриваться в первую очередь</span></span></div><ul class="PGU-FieldRadioList PGU-FieldBody"><li class=PGU-FieldRadioItem ng-class="{ \'PGU-FieldRadioItem-active\' : (model.importantDC == radio.value)}" ng-repeat="radio in item.selectedItems"><a class=PGU-FieldRadioInput ng-click=setImportantDC(radio)><input type=radio name=dc ng-value=radio.value> <i class=PGU-LabelIcon><i></i></i> <span class=PGU-FieldLabel-List></span></a><div class=MapDC-SelectedListItem-Wrap><div class="js-PGU-FieldRadioInput MapDC-SelectedListItem-Title">{{radio.title}}</div><a ng-click=deleteDC(radio) class="removeSelectedItem js-removeSelectedItem"><i class=removeSelectedItem-Icon></i></a></div></li></ul></div><div class=important-list data-ng-if="item.isNewView && item.selectedItems && item.selectedItems.length"><div class="all-offset-top-40 all-offset-bottom-24"><b>Выбранные дошкольные организации в порядке приоритета</b> (вы можете выбрать до {{item.currentLimitNumberOfEntries}} {{item.currentLimitNumberOfEntriesText}})</div><div class="PGU-HelperBox PGU-HelperBox-Type-important"><h4 class=PGU-HelperBox-Title>Как правильно выбрать дошкольную организацию</h4><div class="PGU-HelperBox-Content PGU-HelperBox-Content"><div class=all-offset-top-16>Найдите дошкольные организации рядом с домом. Дошкольные организации предоставляют по месту жительства ребёнка. Это можно подтвердить свидетельством о регистрации, договором найма или купли-продажи жилого помещения.</div><div class="PGU-Link all-offset-top-16" data-ng-show=!showMoreInfo data-ng-click="showMoreInfo = true"><span class=dc-more-info>Показать подробности</span></div><div ng-show=showMoreInfo><div class=all-offset-top-16>Выберите дошкольные организации, где есть группы подходящей направленности, например, компенсирующие или оздоровительные.</div><div class=all-offset-top-16>Проверьте, что в выбранные дошкольные организации берут детей с нужного вам возраста. Не во всех дошкольных организациях есть ясельные группы.</div><div class=all-offset-top-16>Проверьте, что вам подходит режим работы дошкольной организации.</div><div class=all-offset-top-16>Узнайте больше о выбранных дошкольных организациях — на сайтах, в местном органе управления образованием.</div><div class=all-offset-top-16>Расставьте выбранные дошкольные организации в порядке приоритета. Можно выбрать несколько. Максимальное количество зависит от того, где вы живёте.</div><div class=all-offset-top-16>Поставьте первой в списке дошкольную организацию, которая больше всего вам подходит. Если у вас уже есть ребенок, который получает дошкольное образование, выберите в качестве приоритетной дошкольную организацию, который он посещает.</div><div class="PGU-Link all-offset-top-16" data-ng-click="showMoreInfo = false"><span class=dc-more-info>Скрыть подробности</span></div></div></div></div><div class=important-list-item ng-repeat="si in item.selectedItems track by si.priorityNumber"><div class=important-list-wrap ng-class="{\'last\': $last}"><div class=grid-wrap__row><div class=grid-wrap__col-sm-1><div class=position><div class=circle><span ng-class="{\'two\': si.priorityNumber.toString().length > 1}" class=number>{{si.priorityNumber}}</span></div></div></div><div class=grid-wrap__col-sm-4><div class=org-title>{{si.title}}</div></div><div class=grid-wrap__col-sm-1><div class="flex-container flex-column align-items-center"><div class="move up sm-offset-bottom-24" data-ng-click="moveImportantDC(si.priorityNumber, -1)" data-ng-if="si.priorityNumber > 1"></div><div class="move down sm-offset-bottom-24" data-ng-click="moveImportantDC(si.priorityNumber, 1)" data-ng-if="si.priorityNumber < item.selectedItems.length"></div><div class="remove sm-offset-bottom-24" data-ng-click="deleteDC(si, false, true)"><div class=remove-icon></div></div></div></div></div></div></div></div></div><div class="MapDC-Step2 MapDC-Popup-List-Map js-PGU-MapDC-mob-step2" ng-show="mobile.currentState == \'list\' || mobile.currentState == \'map\'"><div class=MapDC-Btn-View-Select-Wrap><div class=MapDC-Btn-View-Select><div class="MapDC-Btn-View MapDC-Btn-View-List {{mobile.currentState == \'list\'?\'MapDC-Btn-View-Active\':\'\'}} js-MapDC-Btn-View-List" ng-click="mobile.toggleState(\'form\', \'list\')">Списком</div><div class="MapDC-Btn-View MapDC-Btn-View-Map {{mobile.currentState == \'map\'?\'MapDC-Btn-View-Active\':\'\'}} js-MapDC-Btn-View-Map" ng-click="mobile.toggleState(\'form\', \'map\')">На карте</div></div></div><div class="MapDC-List-Wrap js-MapDC-List-Wrap" ng-show="mobile.currentState == \'list\'"><div ng-if="model.originList && model.originList.length"><div class=MapDC-List-Search-Wrap data-ng-show="model.originList && model.originList.length > 3"><div class="MapDC-List-Search js-PGU-FieldMapWithListSearch"><div class=MapDC-Search-Placeholder>Введите наименование детского сада или адрес</div><div class="PGU-FieldTextInput PGU-FieldBody"><input class="PGU-FieldTextInputBasic field-bordered field-padded" name="" ng-model=mobile.searchValue><div class=PGU-FieldHint ng-if=item.hint>{{item.hint}}</div><div class=PGU-FieldError></div><div class=max-error data-ng-show="item.isFieldMapWithListDC && (item.selectedItems.length >= (item.limitNumberOfEntries || 3))">Вы выбрали максимальное количество организаций. Удалите уже выбранные организации, если хотите выбрать другие.</div></div></div></div><div class=MapDC-List-Hint-Limit>Вы можете выбрать не более {{item.currentLimitNumberOfEntries}} {{item.currentLimitNumberOfEntriesText}}.<br>По умолчанию показаны близлежащие к месту проживания детские сады.</div><div class="js-MapDC-List-Items-Wrap MapDC-List-Items-Wrap"><div class=PGU-FieldMapList-Items><div class="MapDC-List-Item {{mobile.isDetailsClosed ? \'PGU-FieldMapWithList-Item-isDetailsClosed\' : \'\'}}" ng-repeat="it in model.list| filter:mobile.searchValue"><pgu-checkbox el=it.checkbox toggle=toggleDC item=it ng-if=item.isFieldMapWithListDC pgu-disabled="!!(item.selectedItems && item.selectedItems.length > item.currentLimitNumberOfEntries && it.checkbox && it.checkbox.checked !== true)"></pgu-checkbox><div class="js-MapDC-ListItem-Warn MapDC-ListItem-Warn" ng-show=it.showWarnMsg><div class=MapDC-ListItem-Warn-Arrow></div>Вы можете выбрать не более {{item.currentLimitNumberOfEntries}} {{item.currentLimitNumberOfEntriesText}}. Для выбора этого детского сада отмените выбор одного из детских садов, выбранных ранее.</div><div class="js-MapDC-Mobile-Open-ItemInfo MapDC-List-Item-Info-Wrap" ng-click="mobile.showDetails(it, \'list\')"><a class="PGU-FieldMapWithList-Item-title js-PGU-FieldMapWithList-Item-title"><h3 class=PGU-FieldMapWithList-Item-title-text>{{it.title}}</h3></a><div class=PGU-FieldMapWithList-Item-main-attrs ng-if=model.mapList[$index].coordsValue><div class=PGU-FieldMapWithList-Item-Attrs><span class=PGU-AttrsValue>{{model.mapList[$index].coordsValue}}</span></div></div><div class=PGU-FieldMapWithList-Item-main-attrs ng-if="model.mapList[$index].attrs && model.mapList[$index].attrs.length"><div class=PGU-FieldMapWithList-Item-Attrs ng-repeat="attr in model.mapList[$index].attrs" ng-if=attr.value><span class=PGU-AttrsLabel>{{it.title + \':&nbsp\'}}</span> <span class=PGU-AttrsValue ng-bind-html=attr.value|to_trusted></span></div></div><div class=PGU-FieldMapWithList-Item-details-attrs ng-if="model.mapList[$index].details && model.mapList[$index].details.length"><div class=PGU-FieldMapWithList-Item-Attrs ng-repeat="attr in model.mapList[$index].details" ng-if=attr.value><span class=PGU-AttrsLabel>{{attr.label + \':&nbsp;\'}}</span> <span class=PGU-AttrsValue ng-bind-html=attr.value|to_trusted></span></div></div></div></div></div></div></div><div class=PGU-List-sidebar-error-DC ng-if="(!model.list || !model.list.length) && !model.loading">Запрос не дал результатов<div class=PGU-List-sidebar-error-text>Адрес места пребывания и адрес проживания ребенка не выбран или список детских садов недоступен.</div></div></div><div class="MapDC-Map-Wrap js-MapDC-Map-Wrap" ng-show="mobile.currentState == \'map\'"><div class="MapDC-Map js-MapDC-Map"><yandex-map class=PGU-Panel-Map yvalue=model.coords yid="{{item.fullPath + \'_map\'}}" item=item error=item.error baloon=item.baloon opened=model.openedVal options=model.options mobilestate=mobile fieldmodel=model list=model.mapList home-fias-path="item.isNewView && item.isFieldMapWithListDC && item.addressPath"></yandex-map></div><div class="js-MapDC-Balloon MapDC-Balloon-Wrap"></div></div><div class="MapDC-Btn-Prev js-PGU-MapDC-mob-step2-prev">Вернуться назад</div></div><div class="MapDC-Step3 MapDC-ItemInfo-Wrap js-PGU-MapDC-mob-step3" ng-show="mobile.currentState == \'details\'"><div class=MapDC-ItemInfo><div class=MapDC-ItemInfo-Warn ng-show="!mobile.isSelectedDC(mobile.itemDetails) && item.selectedItems && item.selectedItems.length && item.selectedItems.length > 3"><div class=MapDC-ItemInfo-Warn-Content><div class=MapDC-ItemInfo-Warn-Icon></div><div class=MapDC-ItemInfo-Warn-Title>Важно!</div><div class=MapDC-ItemInfo-Warn-Text>Вы можете выбрать не более {{item.currentLimitNumberOfEntries}} {{item.currentLimitNumberOfEntriesText}}. Для выбора этого детского сада отмените выбор одного из детских садов, выбранных ранее.</div></div></div><h3 class=MapDC-ItemInfo-Title>{{mobile.itemDetails.title}}</h3><div class=max-error data-ng-show="item.isFieldMapWithListDC && (item.selectedItems.length >= (item.limitNumberOfEntries || 3)) && !mobile.isSelectedDC(mobile.itemDetails)">Вы выбрали максимальное количество организаций.</div><a class="js-PGU-FMWLPhone-toggleWidetState PGU-Btn-Base PGU-Btn-without_icon PGU-Btn-Small {{mobile.isSelectedDC(mobile.itemDetails) ? \'\':\'PGU-Btn-Blue\'}}" ng-click="mobile.isSelectedDC(mobile.itemDetails) ? deleteDC(mobile.itemDetails) : addDC(mobile.itemDetails)">{{mobile.isSelectedDC(mobile.itemDetails) ? \'Отменить выбор\':\'Выбрать детский сад\'}}</a><div ng-if=mobile.getItemFromMapList(mobile.itemDetails.value).coordsValue><div class=MapDC-ItemInfo-Attr-Title>Адрес</div><div class=MapDC-ItemInfo-Attr-Value>{{mobile.getItemFromMapList(mobile.itemDetails.value).coordsValue}}</div></div><div ng-repeat="attr in mobile.getItemFromMapList(mobile.itemDetails.value).attrs" ng-if=attr.value><div class=MapDC-ItemInfo-Attr-Title ng-if="attr.name == \'shedule_type\'">Режим работы</div><div class=MapDC-ItemInfo-Attr-Value ng-if="attr.name == \'shedule_type\'">{{attr.value}}</div><div class=MapDC-ItemInfo-Attr-Title ng-if="attr.name == \'contact_email\'">Email</div><div class=MapDC-ItemInfo-Attr-Value ng-if="attr.name == \'contact_email\'">{{attr.value}}</div><div class=MapDC-ItemInfo-Attr-Title ng-if="attr.name == \'contact_phone\'">Телефон</div><div class=MapDC-ItemInfo-Attr-Value ng-if="attr.name == \'contact_phone\'">{{attr.value}}</div></div><div class="js-MapDC-ItemInfo-Map-Wrap MapDC-ItemInfo-Map-Wrap"><div data-ng-show="!model.showAcceptWithoutPin && mobile.itemDetails && mobile.itemDetails.value"><yandex-map yid="{{item.fullPath + \'_map_details\'}}" item=item yvalue=mobile.getItemFromMapList(mobile.itemDetails.value).coordsValue error=item.error opened=model.openedVal baloon=null></yandex-map></div><div data-ng-show=model.showAcceptWithoutPin class=MapDC-ItemInfo-Attr-Title><div class=MapDC-ItemInfo-Attr-Value>Не удалось показать объект на карте</div></div></div></div></div><div class="js-MapDC-Btn-Prev MapDC-Btn-Prev-Fixed-Wrap" ng-show="mobile.currentState != \'form\'"><div class=MapDC-Btn-Prev-Fixed ng-click="mobile.toggleState(mobile.currentState== \'details\' ? \'form\' : mobile.currentState, mobile.prevState)">Вернуться назад</div></div></div></div><div class=PGU-FieldBody><div class=PGU-FieldNotRequired ng-if=item.notRequiredText>{{item.notRequiredText}}</div><div class=PGU-FieldHint ng-if=item.hint>{{item.hint}}</div><div class=PGU-FieldError data-ng-if=item.error>{{(item.error.mnemonic + \'.validator\' | translate:item.error.text) || (item.error.text || item.error)}}</div></div></div></div>'),$templateCache.put("js/components/FieldRadio/FieldRadio.html","<div ng-show=(!!item.visible) id={{::$id}} full-path={{::item.fullPath}}><div data-ng-if=::!item.isComplete data-ng-attr-style={{::item.inlineCSS}} data-ng-class=\"{\n            'PGU-{{::item.className}}': true,\n            'PGU-FieldRadio-mode-{{::item.listMode}}': true,\n            'PGU-LabelWidth-{{::item.labelWidth}}': true,\n            'PGU-FieldWidth-80' : true,\n            'PGU-LabelAlign-{{::item.labelAlign}}': true,\n            'PGU-Disabled': item.disabled,\n            'PGU-Required': item.required,\n            'PGU-Error': item.error,\n            'editor-item-selected': item.currentItem,\n            'editor-item-hovered': item.hoverItem,\n            'PGU-isText': item.isText\n         }\"><label class=PGU-FieldLabel ng-if=item.label for=\"\">{{(item.fullPath + '.label' | translate:item.label) || item.label}}</label><div class=PGU-FieldHint ng-if=::item.hint>{{(item.fullPath + '.hint' | translate:item.hint) || item.hint}}</div><ul class=\"PGU-FieldRadioList PGU-FieldBody\" ng-if=\"::(item.list && item.list.length)\"><li class=PGU-FieldRadioItem ng-class=\"{\n                    'PGU-FieldRadioItem-Type-Sex': item.sex,\n                    'PGU-FieldRadioItem-active' : (item.value === radio.value)\n"+'                }" ng-repeat="radio in item.list track by $index"><a class="PGU-FieldRadioInput PGU-draft-radio-input" ng-class="{\n                        \'PGU-FieldRadioInput-SexIcons\': item.sex\n                    }" data-itemvalue={{::radio.value}} tabindex="{{item.disabled ? -1 : 1}}" ng-keypress="setActiveRadioKeyPress($event, radio.value, radio.label)"><input type=radio value={{radio.value}}> <i class=PGU-LabelIcon><i></i></i> <i class=PGU-SexIcon ng-if=::item.sex><i></i></i> <span class="PGU-Icon-List-Item PGU-Icon-{{::radio.icon}}" ng-if=::item.withIcons></span> <span class=PGU-FieldLabel-List for="">{{(item.fullPath + \'.list\' | translate:radio.label:$index) || radio.label}}</span></a></li></ul><div class=PGU-FieldBody><div class=PGU-FieldError data-ng-if=item.error>{{(item.error.mnemonic + \'.validator\' | translate:item.error.text) || (item.error.text || item.error)}}</div></div></div><div data-ng-if=::item.isComplete class=sm-offset-bottom-8><span data-ng-if=item.label>{{::item.label}}: </span><span>{{::item.textValue}}</span></div></div>'),$templateCache.put("js/components/FieldText/FieldText.html","<div ng-show=\"(!!item.visible && item.showClone !== true)\" id={{::$id}} full-path={{::item.fullPath}}><div data-ng-if=::!item.isComplete ng-attr-style={{::item.inlineCSS}} ng-class=\"{\n        'PGU-{{::item.className}}': true,\n        'PGU-LabelWidth-{{::item.labelWidth}}': true,\n        'PGU-FieldWidth-{{::item.fieldWidth}}': true,\n        'PGU-LabelAlign-{{::item.labelAlign}}': true,\n        'editor-item-selected': item.currentItem,\n        'editor-item-hovered': item.hoverItem,\n        'PGU-Disabled': item.disabled,\n        'PGU-FieldText-Small-Placeholder': (item.value && (item.value != '')) || (item.isSmall && (item.isSmall != '')),\n        'PGU-Required': item.required,\n        'PGU-FieldWithCheckbox': item.withCheckbox,\n        'PGU-Error': item.error,\n        'PGU-HintShadow': item.needShadow,\n        'PGU-IsQuestion' : (item.hint || (item.mnemonicHint && item.mnemonicHint.length)) && !(item.disabled && isMobile && item.isText)\n"+'     }"><div data-ng-if=::withCaptchaId class=PGU-FieldCaptcha><img data-ng-if=!captchaSetting.showTimeout data-ng-src={{captchaId}} alt=Капча><div data-ng-if=captchaSetting.showTimeout>Повторный ввод будет возможен через {{captchaSetting.counter}}</div></div><label for={{::item.fullPath}} class=PGU-longLabel ng-if=::item.longLabel ng-bind-html="(item.fullPath + \'.longLabel\' | translate:item.longLabel) || item.longLabel"></label> <label translate="{{item.fullPath + \'.label\'}}" class=PGU-longLabel data-ng-if="item.label && item.label.length > 85" for={{::item.fullPath}}>{{(item.fullPath + \'.label\' | translate:item.label) || item.label}}</label><div class=PGU-FieldTextInputCheckbox ng-if="::(!isMobile && item.withCheckbox)"><pgu-checkbox el=models set-checkbox=item.statusCheckbox toggle=toggleValue pgu-disabled=item.disabled hook-checkbox=item.hookCheckbox></pgu-checkbox></div><div class="PGU-FieldTextInput PGU-FieldBody"><label class="PGU-FieldLabel PGU-FieldLabel-Input" data-ng-class="{\'PGU-FieldLabel-WithHint\': (item.hint || (item.mnemonicHint && item.mnemonicHint.length))}" data-ng-if="item.label && item.label.length <= 85" for={{::item.fullPath}}>{{(item.fullPath + \'.label\') | translate:item.label || item.label}}</label><div class=PGU-Input-Wrap ng-hide="isMobile && item.isText"><div ng-show="!item.disabled || (item.disabled && (!item.disabledViewType || item.disabledViewType === \'\'))"><pgu-input class="PGU-FieldTextInputBasic field-padded -metrika-nokeys" change=changeByUser() model=item ng-disabled=item.disabled ng-attr-maxlength={{::item.maxlength}} idinp={{::item.fullPath}}></pgu-input></div><div class="PGU-FieldTextAreaWrap PGU-FieldBody disabledInDiv" ng-show="item.disabledViewType === \'inDiv\' && item.disabled"><div>{{item.value}}</div></div><pgu-error-hint data-ng-if=item.error class=PGU-ErrorHint model=item></pgu-error-hint><ul class=PGU-SuggestList data-ng-cloak ng-if="item.suggest.values.length > 0" data-ng-show="ui.suggest.hasValues && ui.suggest.show"><li ng-repeat="(valueId, value) in item.suggest.values" ng-if=value.field.value ng-mousedown="models.suggest.prepareSuggest(valueId, item.fullPath)"><span class=current-field>{{value.field.value}}</span> <span ng-repeat="(key, keyVal) in value.keyFields" ng-if="keyVal.value != value.field.value">{{keyVal.value}}&nbsp;</span><div ng-mousedown="models.suggest.removeSuggest(value.id, $event)" class=PGU-SuggestList-remove-item title="Удалить подсказку"></div></li></ul><question ng-if="(item.hint || (item.mnemonicHint && item.mnemonicHint.length)) && !(item.disabled && isMobile && item.isText)" item=item></question><div class="PGU-FieldHint {{!item.required ? \'PGU-HintNotRequired\' : \'\'}}" ng-if="item.hint && item.mnemonicHint && item.mnemonicHint.length" ng-bind-html="(item.fullPath + \'.hint\' | translate:item.hint) || item.hint"></div><div class=x-clear></div></div><div data-ng-if="::isMobile && item.isText"><p class=PGU-FieldTextIsTextContent data-ng-bind-html="item.value | to_trusted"></p></div><div class=PGU-FieldError data-ng-if="isMobile && item.isText && item.isTextSingle && item.error">{{(item.error.mnemonic + \'.validator\' | translate:item.error.text) || (item.error.text || item.error)}}</div><div data-ng-hide="::isMobile && item.isText" data-ng-if=!item.required><div class=PGU-FieldNotRequired ng-if="item.notRequiredText && item.hint">{{(item.fullPath + \'.notRequiredText\' | translate:item.notRequiredText) || item.notRequiredText}}</div><div class=PGU-FieldNotRequired ng-if="item.notRequiredText && !item.hint && !(item.isText && isMobile && item.disabled)"><span data-ng-if=::item.emptyRequiredText>{{(\'requiredConstant\' | translate:item.notRequiredText) || item.notRequiredText}} </span><span data-ng-if=::!item.emptyRequiredText>{{(item.fullPath + \'.notRequiredText\' | translate:item.notRequiredText) || item.notRequiredText}}</span></div></div></div><div class=PGU-FieldCheckBox-container ng-if="::(isMobile && item.withCheckbox)"><pgu-checkbox el=models set-checkbox=item.statusCheckbox toggle=toggleValue pgu-disabled=item.disabled hook-checkbox=item.hookCheckbox></pgu-checkbox></div></div><div data-ng-if=::item.isComplete class=sm-offset-bottom-8><span data-ng-if=::item.label>{{::item.label}}: </span><span>{{::item.value}}</span></div></div>'),$templateCache.put("js/components/FieldTextArea/FieldTextArea.html","<div ng-show=(!!item.visible) id={{::$id}} full-path={{::item.fullPath}}><div ng-attr-style={{::item.inlineCSS}} class=\"PGU-{{::item.className}} PGU-LabelWidth-{{::item.labelWidth}} PGU-FieldWidth-{{::item.fieldWidth}} PGU-LabelAlign-{{::item.labelAlign}} {{item.disabled ? 'PGU-Disabled' : ''}} {{((item.value && (item.value != '')) || (isSmall && (isSmall != ''))) ? 'PGU-FieldText-Small-Placeholder' : ''}} {{item.required ? 'PGU-Required' : ''}} {{(inFocus && !item.disabled) ? 'PGU-FieldTextarea-focus-yes' : ''}} {{item.error ? 'PGU-Error' : ''}} {{isMobile && item.isText && !item.value ? 'PGU-FieldTextArea_Empty-Value' : ''}}\" data-ng-class=\"{\n            'editor-item-selected': item.currentItem,\n            'editor-item-hovered': item.hoverItem\n"+'        }"><div class="PGU-FieldLabel-Long-Input longLabel" ng-if="item.longLabel && !(isMobile && item.isText)">{{(item.fullPath + \'.longLabel\' | translate:item.longLabel) || item.longLabel}}</div><div class="PGU-FieldLabel-Long-Input longLabel" ng-if="item.label && (item.label.length > 85  || isPhone) && !(isMobile && item.isText)">{{(item.fullPath + \'.label\' | translate:item.label) || item.label}}</div><div class=PGU-Input-Wrap data-ng-hide="isMobile && item.isText"><label class="PGU-FieldLabel PGU-FieldLabel-Input" ng-if="item.label && item.label.length <= 85 && !isPhone" for={{::item.fullPath}}>{{(item.fullPath + \'.label\' | translate:item.label) || item.label}}</label><div class="PGU-FieldTextAreaWrap PGU-FieldBody" ng-show="!item.disabled || (item.disabled && (!item.disabledViewType || item.disabledViewType === \'\'))"><textarea ng-model=item.value ng-model-options="{updateOn: \'default blur\', debounce: { \'default\': 500, \'blur\': 0 }}" ng-disabled=item.disabled ng-change=changeByUser() data-ng-class="{\'PGU-FieldTextAreaInputBasic\':true, \'-metrika-nokeys\': true, \'PGU-FieldTextAreaInputBasicWithRows\': item.rows}" ng-blur=onBlurHandler() ng-focus="!$root.isDesigner && onFocusHandler()" id={{::item.fullPath}} rows={{::item.rows}} tabindex="{{item.disabled ? -1 : 1}}" ng-readonly=$root.isDesigner msd-elastic msd-elastic-disable="{{($root.version != \'mob\')}}">\n                    </textarea></div><div class="PGU-FieldTextAreaWrap PGU-FieldBody disabledInDiv" ng-show="item.disabledViewType === \'inDiv\' && item.disabled"><div>{{item.value}}</div></div><div class=PGU-FieldNotRequired data-ng-if="item.notRequiredText && !(item.isText && isMobile && item.disabled)"><span data-ng-if=item.emptyRequiredText>{{(\'requiredConstant\' | translate:item.notRequiredText) || item.notRequiredText}} </span><span data-ng-if=!item.emptyRequiredText>{{(item.fullPath + \'.notRequiredText\' | translate:item.notRequiredText) || item.notRequiredText}}</span></div><pgu-error-hint data-ng-if=item.error class=PGU-ErrorHint model=item></pgu-error-hint></div><div data-ng-if="isMobile && item.isText"><p class=PGU-FieldTextIsTextContent data-ng-bind-html=item.trustedHtmlValue></p></div><div class=PGU-FieldError data-ng-if="isMobile && item.isText && item.isTextSingle && item.error"></div><div class=PGU-FieldHint data-ng-if=item.hint>{{(item.fullPath + \'.hint\' | translate:item.hint) || item.hint}}</div><div class=x-clear></div></div></div>'),$templateCache.put("js/components/FieldTextDate/FieldTextDate.html","<div ng-show=\"(!!item.visible && item.showClone !== true)\" id={{::$id}} ng-mouseover=setPicker() full-path={{::item.fullPath}}><div data-ng-show=::!item.isComplete ng-attr-style={{::item.inlineCSS}} ng-class=\"{\n            'PGU-{{::item.className}}': true,\n            'PGU-LabelWidth-{{::item.labelWidth}}': true,\n            'PGU-FieldWidth-{{::item.fieldWidth}}': true,\n            'PGU-LabelAlign-{{::item.labelAlign}}': true,\n            'editor-item-selected': item.currentItem,\n            'editor-item-hovered': item.hoverItem,\n            'PGU-Disabled': item.disabled,\n            'PGU-FieldText-Small-Placeholder': (item.value && (item.value != '')) || (item.isSmall && (item.isSmall != '')),\n            'PGU-FieldText-Small-Placeholder_out': item.isSmall,\n            'PGU-Required': item.required,\n            'PGU-Error': item.error\n"+'            }"><div class="PGU-FieldTextInput PGU-FieldTextDate PGU-FieldBody"><label for={{::item.fullPath}} class=PGU-longLabel ng-if=item.longLabel>{{item.longLabel}}</label> <label for={{::item.fullPath}} class=PGU-longLabel ng-if="item.label && item.label.length > 25">{{item.label}}</label> <label class="PGU-FieldLabel PGU-FieldLabel-Input" for={{::item.fullPath}} ng-if="item.label && item.label.length <= 25">{{item.label}}</label><div class=PGU-Input-Wrap data-ng-hide="isMobile && item.isText"><pgu-input class="PGU-FieldTextInputBasic {{((item.value && (item.value != \'\')) || (item.isSmall && (item.isSmall != \'\'))) ? \'PGU-FieldTextDateInputBasicWithValue \' : \'PGU-FieldTextDateInputBasic \'}} field-padded -metrika-nokeys" change=changeByUser model=item ng-disabled=item.disabled ng-attr-maxlength={{::item.maxlength}} idinp={{::item.fullPath}}></pgu-input><pgu-error-hint data-ng-if=item.error class=PGU-ErrorHint model=item hover=hidePicker></pgu-error-hint></div><div class=PGU-FieldNotRequired ng-if="item.notRequiredText && !(item.isText && isMobile && item.disabled)">{{::item.notRequiredText}}</div><div class=PGU-FieldHint ng-if=::item.hint>{{::item.hint}}</div><p ng-show="isMobile && item.isText" data-ng-bind-html=item.value></p></div></div><div data-ng-if=::item.isComplete class=sm-offset-bottom-8><span data-ng-if=item.label>{{::item.label}}: </span><span>{{::item.value}}</span></div></div>'),
$templateCache.put("js/components/FieldUpload/FieldUpload.html","<div id={{::item._uid}} full-path={{::item.fullPath}} data-ng-show=(!!item.visible)><div class=\"PGU-FieldUpload PGU-FieldUpload-Multiple PGU-LabelWidth-{{::item.labelWidth}} PGU-LabelAlign-{{::item.labelAlign}} {{item.disabled ? 'PGU-disabled' : ''}} {{item.required ? 'PGU-Required' : ''}} {{item.error ? 'PGU-Error' : ''}} {{item.multipleUpload ? 'PGU-FieldUpload-Multiple-more' : 'PGU-FieldUpload-Multiple-one'}} {{item.label ? 'PGU-WithLabel' : ''}} {{item.uploading ? 'PGU-FieldUpload-uploading' : ''}}\"><label class=PGU-FieldLabel>{{item.label}}</label><div class=PGU-FieldUploadDnD-Disabled data-ng-if=item.disabled></div><div data-ng-if=item.isEditableGridUploader class=\"cf PGU-FieldUploadDnD PGU-FieldUploadDnD-WithoutArea\"><div data-ng-show=!item.disabled class=\"PGU-BtnHolder PGU-Button-align-left PGU-BtnContainer-column\"><div class=\"PGU-Btn-margin- PGU-Button-align-left\"><a data-ng-href=\"\" class=\"button-upload js-manual-upload-mobile PGU-Button PGU-Btn-Base PGU-Btn-AddRow PGU-Btn-Small ng-click-active\"><span class=PGU-Btn-Text>{{::item.editableGridUploaderBtnText}}</span></a></div></div></div><div data-ng-show=!item.isEditableGridUploader class=\"PGU-FieldUploadDnD {{item.disabled ? 'disabled' : ''}}\" data-ng-class=\"{\n            'hover' : item.hover,\n            'drop'  : item.drop\n"+'            }"><div ng-hide="item.files.length && !item.multipleUpload" class="PGU-FieldUploadDnD_annotation js-PGU-FieldUploadDnD_annotation noMobile PGU-FieldUpload-Fixed">Перетащите {{!item.multipleUpload ? \'файл\' : \'файлы\' }} сюда или&nbsp; <span ng-if=item.disabled>загрузите вручную</span><div class=upload-link><label class="manual-upload button-upload" id={{::item._uid}}:uploadDnD ng-show=!item.disabled>загрузите вручную</label></div></div><div class="PGU-FieldUploadDnD_annotation PGU-FieldUploadWithoutDnD_annotation js-PGU-FieldUploadWithoutDnD_annotation"><label class=manual-upload id={{::item._uid}}:uploadDnD ng-show=!item.disabled>Загрузить</label></div><div class="PGU-FieldUploadDnD__upload-row err"><div ng-if="!ui.isMobile && !ui.isTablet" class=rowFile ng-repeat="file in item.files" ng-class="{\'uploaded\' : file.percent === 100 }"><div class="rowFile__item removeFileDnD" ng-click="removeFile($index, file)" ng-show="!item.disabled && !loading"></div><div class="plupload_file_thumb {{file.percent === 100 && !loading ? \'upload-done\' : \'\'}}" ng-if=ui.isTablet></div><div class=rowFile__item-info><div data-ng-if=!item.preloadedFile class="rowFile__item name">{{file.name}}<div class="rowFile__item size">{{file.size | filterFileSize}}</div></div><div data-ng-if=item.preloadedFile class="rowFile__item name">{{file.name}}</div><div class="rowFile__item err" ng-if=file.error>{{file.error}}</div><check-sign-status data-ng-if="item.getSignedData && item.getSignedData() && item.files.length === item.minCountFiles" data-file=file data-main-file-title=item.getMainFileTitle() data-button-path=item.fullPath></check-sign-status></div></div><div class=rowFile ng-if="ui.isMobile || ui.isTablet" ng-repeat="file in item.files"><div class="rowFile__item-info multi" ng-if=item.multipleUpload><div class="plupload_file_thumb__err-hint multi" ng-class="{\'x-show_hint\' : file.xShowHint}" ng-if=file.error>{{file.error}}</div><div class="rowFile__item name">{{file.name}}</div><div data-ng-if=!item.preloadedFile class="rowFile__item size">{{file.sizeToSting}}</div><div class="rowFile__item err multi"></div><check-sign-status data-ng-if="item.getSignedData && item.getSignedData() && item.files.length === item.minCountFiles" data-file=file data-main-file-title=item.getMainFileTitle() data-button-path=item.fullPath></check-sign-status></div><div class="plupload_file_thumb {{!loading ? \'upload-done multi\' : \'\'}}" ng-click=showHint(file) ng-class="{\'plupload_file_thumb__err multi\' : file.error}" ng-if=item.multipleUpload></div><div class="rowFile__item removeFileDnD multi" ng-show="!loading && !item.disabled" ng-click="removeFile($index, file)" ng-if=item.multipleUpload></div><div class=mobile-rowFile-item-wrap ng-if=!item.multipleUpload><div class=rowFile__item-info><div class="rowFile__item name">{{file.name}}</div><div class="rowFile__item size">{{file.sizeToSting}}</div></div><div class="rowFile__item err"></div></div><div class=rowIcons__wrap ng-if=!item.multipleUpload><div class="plupload_file_thumb {{!loading ? \'upload-done\' : \'\'}}{{file.error}}" ng-click=showHint(file) ng-class="{\'plupload_file_thumb__err\' : file.error}"></div><div class=plupload_file_thumb__err-hint ng-class="{\'x-show_hint\' : file.xShowHint}" ng-if=file.error>{{file.error}}</div><div class="rowFile__item removeFileDnD" ng-show="!loading && !item.disabled" ng-click="removeFile($index, file)"></div></div></div><update-check-sign-status data-ng-if="item.getSignedData && item.getSignedData() && item.files && item.files.length" data-uploader=item></update-check-sign-status></div><div data-ng-class="{\'disabled\' : item.disabled}" class="PGU-FieldUploadDnD_annotation mobile js-PGU-FieldUploadDnD_annotation" data-ng-hide="item.files.length && !item.multipleUpload"><div class="js-manual-upload-mobile PGU-FieldUpload-mobile-manual-wrapper align-items-center" id={{::item._uid}}:uploadDnDMobile><div class="PGU-FieldUpload-mobile-manual-wrapper__item PGU-FieldUpload-mobile-manual-wrapper__item-offset-left-16"><span class=PGU-FieldUpload-mobile-manual-wrapper__icon></span></div><div class=PGU-FieldUpload-mobile-manual-wrapper__item><span class=PGU-FieldUpload-mobile-manual-wrapper__text>Прикрепить {{!item.multipleUpload ? \'файл\' : \'файлы\' }}</span></div></div><div class=can-loaded ng-if="item.notRequiredText && !item.required || ui.isMobile || ui.isTablet">{{ui.notRequiredTextForMobile}}</div></div><div class=errorUpload></div><div class="PGU-FieldNotRequired notMobile" ng-if="item.notRequiredText && !item.required">{{::item.notRequiredText}}</div><div class=cover-disabled ng-if=(loading)><div class=file-throbber></div></div></div><div class=PGU-FieldBody><div class=PGU-FieldHint ng-if=::item.mergeHint ng-bind-html=item.mergeHint>{{::item.mergeHint}}</div><div class=PGU-FieldError ng-if="item.errorMessage || item.error || item.validateError || fileErrorMessage">{{item.validateError||item.errorMessage || (item.error.mnemonic + \'.validator\' | translate:item.error.text) || (item.error.text || item.error) || fileErrorMessage}}</div><div class=PGU-FieldNotRequired ng-if="item.notRequiredText && !item.required && !item.multipleUpload && item.multipleUpload && !ui.isMobile && !ui.isTablet">{{::item.notRequiredText}}</div></div></div></div>'),$templateCache.put("js/components/FieldVehicle/FieldVehicle.html","<div id={{::id}} full-path={{::item.fullPath}} ng-show=(!!item.visible)><div class=\"PGU-{{::item.className}} PGU-LabelWidth-{{::item.labelWidth}} PGU-Labelalign-{{::item.labelAlign}} {{item.disabled ? 'PGU-Disabled' : ''}} {{item.required ? 'PGU-Required' : ''}} {{item.error ? 'PGU-Error' : ''}}\" ng-class=\"{\n            'PGU-Disabled'                      : item.disabled,\n            'PGU-Required'                      : item.required,\n            'PGU-Error'                         : item.error\n"+'        }"><label class=PGU-FieldLabel>{{::item.label}}</label><div><form-tree ng-repeat="item_i in item.items track by $index" item=item_i></form-tree></div><modal-dialog show=ui.popupShowDefer><div class=b-ESIAPopup><h3>Данные о транспортном средстве будут сохранены в Личном кабинете</h3><h4>Государственный регистрационный знак</h4><span>{{item.vehicleId}}</span> <span>Для сохранения и использования заполните следующие поля:</span><div class="b-input__esia-tc tc-name PGU-FieldTextInput PGU-FieldBody {{(item.nameVehicle || item.isSmall) ? \'PGU-FieldText-Small-Placeholder\' : \'\'}}"><label class="PGU-FieldLabel PGU-FieldLabel-Input ng-binding" for="">Название</label> <input ng-focus=onFocusHandler() class=PGU-FieldTextInputBasic ng-model=item.nameVehicle></div><div class="b-input__esia-tc tc-number-and-series PGU-FieldTextInput PGU-FieldBody {{(item.numberAndSeries || item.isSmall) ? \'PGU-FieldText-Small-Placeholder\' : \'\'}}"><label class="PGU-FieldLabel PGU-FieldLabel-Input ng-binding" for="">Серия и номер свидетельства о регистрации</label> <input ng-focus=onFocusHandler() class=PGU-FieldTextInputBasic ng-model=item.numberAndSeries></div><div class=x-clear></div></div><div class=b-ESIAPopup__border></div><a ng-click=setData() class="PGU-Button PGU-Button-align-right"><span class=PGU-ButtonText>Продолжить</span> <span class=PGU-ButtonRight></span></a></modal-dialog></div></div>'),$templateCache.put("js/components/Form/Form.html",'<div ng-show=!!item.visible id={{::$id}} full-path={{::item.fullPath}}><div class="{{::$root.device.class}} PGU-{{::item.className}} EngineVer-{{::(item.engineVersion ? item.engineVersion : \'1\')}} {{::item.showAllSteps ? \'PGU-Form-Show-All-Steps\' : \'\'}}"><div data-ng-if="!$root.isDesigner || ($root.isDesigner && !$root.reloadingDesigner)" class=PGU-FormBody><div data-ng-if="item.progressBar && isDesktop" class="PGU-FormContent grid-wrap"><div class=grid-wrap__row><div class="grid-wrap__col-lg-17 grid-wrap__col-md-12 grid-wrap__col-sm-6"><div class=PGU-FormContentBody><h1 data-ng-show=!item.finishPage class=PGU-FormTitle ng-class="::{\'PGU-FormTitle-noSubTitle\' : item.isPhone && !item.subTitle}"><img data-ng-show=item.icons.length data-ng-src="{{item.getCatalogIcon(item.icons, \'small\', defaultImgSrc)}}" data-failback-img={{defaultImgSrc}} class="PGU-Icon PGU-Icon-main-title"> <span data-ng-show=!item.icons.length class="PGU-Icon PGU-Icon-main-title PGU-Icon-main-default"></span> <span class=PGU-Form-Subtitle ng-if="::item.isPhone && item.subTitle"><span class=PGU-Form-Subtitle-valignMiddle ng-bind-html=$sce.trustAsHtml(item.subTitle)></span> </span><span class=PGU-FormTitleText ng-if=item.isPhone><span ng-if=!item.subTitle class=PGU-FormTitleText-valignMiddle ng-bind-html="$sce.trustAsHtml(item.titleNew || item.title)"></span> </span><span class=PGU-FormTitleText ng-if=::!item.isPhone ng-bind-html="item.titleNew || item.title"></span> <span class=PGU-Form-Subtitle ng-if="::!item.isPhone && item.subTitle" ng-bind-html=item.subTitle></span><lang data-ng-show=!item.finishPage></lang></h1><div data-ng-show=!item.finishPage class=pgu-draft-message ng-if=item.draftUpdatedMsg>Черновик заявления сохранен {{item.draftUpdatedMsg}}</div><finish-page finish-page-data=$root.finishPageData ng-if="item.finishPage && !$root.settings.serviceFormInfo.election"></finish-page><finish-election-page ng-if="item.finishPage && $root.settings.serviceFormInfo.election"></finish-election-page><epgu-helper-box ng-if=item.integrationModuleMode item=item.integrationModuleDisclaimer></epgu-helper-box><div class="ITEMS_CONTAINER main_form_container" ng-if="::(!$root.isDesigner && item.items)" data-ng-show=!item.finishPage><form-tree ng-repeat="item_i in item.items track by $index" item=item_i step-index=$index></form-tree></div><div class="ITEMS_CONTAINER main_form_container" ng-if="$root.isDesigner && item.items" data-ng-show=!item.finishPage><form-tree ng-repeat="item_i in item.items track by $index" item=item_i step-index=$index></form-tree></div></div></div><div class="grid-wrap__col-lg-6 grid-wrap__col-offset-lg-1 EPGU-progress-bar-column"><div class=EPGU-progress-bars-Wrap><epgu-svg-circle-progress props=item.progressBar></epgu-svg-circle-progress></div></div></div></div><div data-ng-if="!item.progressBar || (item.progressBar && !isDesktop)" class=PGU-FormContent><div data-ng-if=item.progressBar class=EPGU-progress-bars-Wrap><epgu-svg-circle-progress props=item.progressBar></epgu-svg-circle-progress></div><div class=PGU-FormContentTop></div><div class=PGU-FormContentBody data-ng-class="{\'PGU-FormContentBody-hide\': isIframe && (item.popupIsOpen || item.showEsiaModal)}"><h1 data-ng-show=!item.finishPage class=PGU-FormTitle ng-class="::{\'PGU-FormTitle-noSubTitle\' : item.isPhone && !item.subTitle}"><img data-ng-show=item.icons.length data-ng-src="{{item.getCatalogIcon(item.icons, \'small\', defaultImgSrc)}}" data-failback-img={{defaultImgSrc}} class="PGU-Icon PGU-Icon-main-title"> <span data-ng-show=!item.icons.length class="PGU-Icon PGU-Icon-main-title PGU-Icon-main-default"></span> <span class=PGU-Form-Subtitle ng-if="::item.isPhone && item.subTitle"><span class=PGU-Form-Subtitle-valignMiddle ng-bind-html="item.subTitle | to_trusted"></span> </span><span class=PGU-FormTitleText ng-if=::item.isPhone><span ng-if=::!item.subTitle class=PGU-FormTitleText-valignMiddle ng-bind-html="(item.titleNew || item.title) | to_trusted"></span> </span><span class=PGU-FormTitleText ng-if=::!item.isPhone ng-bind-html="item.titleNew || item.title"></span> <span class=PGU-Form-Subtitle ng-if="::!item.isPhone && item.subTitle" ng-bind-html=item.subTitle></span><lang data-ng-show=!item.finishPage></lang></h1><div data-ng-show=!item.finishPage class=pgu-draft-message ng-if=item.draftUpdatedMsg>Черновик заявления сохранен {{item.draftUpdatedMsg}}</div><finish-page finish-page-data=$root.finishPageData ng-if="item.finishPage && !$root.settings.serviceFormInfo.election"></finish-page><finish-election-page ng-if="item.finishPage && $root.settings.serviceFormInfo.election"></finish-election-page><epgu-helper-box ng-if=::item.integrationModuleMode item=item.integrationModuleDisclaimer></epgu-helper-box><div class="ITEMS_CONTAINER main_form_container" ng-if="::(!$root.isDesigner && item.items)" data-ng-show=!item.finishPage><form-tree ng-repeat="item_i in item.items track by $index" item=item_i step-index=$index></form-tree></div><div class="ITEMS_CONTAINER main_form_container" ng-if="$root.isDesigner && item.items" data-ng-show=!item.finishPage><form-tree ng-repeat="item_i in item.items track by $index" item=item_i step-index=$index></form-tree></div></div><div class=PGU-FormContentBottom></div></div><div class=PGU-Error data-ng-if="item.error && item.error.length">{{item.error}}</div><modal-dialog class=modal-dialog-esia-scroll hide-modal=hideEsiaDialog() back-btn-name="isMobile ? \'Назад\' : \'\'" show=item.showEsiaModal><modal-dialog-esia item=item hide-from-outside=toggleModalVisible()></modal-dialog-esia></modal-dialog><modal-dialog show=item.popupIsOpen class=PGU-Generation-popup back-btn-name=item.popupContent.backBtnName hide-outside-click=true><pop-up item=item.popupContent></pop-up></modal-dialog></div></div></div>'),$templateCache.put("js/components/FormButton/FormButton_old.html",'<div ng-show="item.currentItem || ((!!item.visible))" id={{::$id}} full-path={{::item.fullPath}}><div ng-show="item.currentItem || ((!!item.visible))" class="PGU-BtnHolder {{item.floating}} PGU-BtnHolder-action_{{::item.action}} PGU-Button-align-{{::item.balign}} PGU-BtnHolder-MarginLeft-{{::btnMargin}} cf {{item.withoutMarginTop ? \'PGU-BtnHolder-MarginTop-0\' : \'\'}} {{item.isBackButton ? \'PGU-BtnHolder-isBackButton\' : \'\'}}"><a ng-if=item.href ng-href="{{::(item.isAbsoluteUrl ? item.href : context_uri + item.href)}}" ng-click=handleClick() class="PGU-Button PGU-Button-whereIcon-{{::item.whereIcon}} PGU-Button_{{::item.action}} PGU-Button-color-{{::item.btnColor}} PGU-Button-{{::item.btnIcon}} PGU-Button-size-{{::item.buttonSize}}" id={{::item.fullPath}} action={{::item.action}} tabindex="{{item.disabled ? -1 : 1}}"><span class="PGU-Icon PGU-Icon-button PGU-Icon-beforeText" ng-if="item.whereIcon == \'before\'"></span><span class=PGU-ButtonText>{{::item.label}}</span><span class="PGU-Icon PGU-Icon-afterText" ng-if="item.whereIcon == \'after\'"></span> <span class=PGU-ButtonRight></span> </a><a ng-if=!item.href ng-click=handleClick() class="PGU-Button PGU-Button-whereIcon-{{::item.whereIcon}} PGU-Button_{{::item.action}} PGU-Button-align-{{::item.balign}} PGU-Button-color-{{::item.btnColor}} PGU-Button-{{::item.btnIcon}} PGU-Button-size-{{::item.buttonSize}}" id={{item.fullPath}} action={{::item.action}} tabindex="{{item.disabled ? -1 : 1}}"><span class="PGU-Icon PGU-Icon-button PGU-Icon-beforeText" ng-if="::(item.whereIcon == \'before\')"></span><span class=PGU-ButtonText>{{::item.label}}</span><span class="PGU-Icon PGU-Icon-afterText" ng-if="::(item.whereIcon == \'after\')"></span> <span class=PGU-ButtonRight></span></a></div></div>'),$templateCache.put("js/components/FormButton/FormButton.html","<div ng-show=!!item.visible full-path={{::item.fullPath}} class=\"PGU-BtnHolder {{item.balign ? 'PGU-Button-align-' + item.balign : ''}}\" ng-class=\"{\n         'PGU-BtnContainer-column' : item.floating && item.floating == 'PGU-BtnFloat',\n\n     }\"><div class=\"PGU-Btn-margin-{{::item.btnMargin}} {{item.action ? 'PGU-BtnHolder-action_' + item.action : ''}} {{item.isBackButton ? 'PGU-BtnHolder-isBackButton' : ''}} {{item.balign ? 'PGU-Button-align-' + item.balign : ''}} {{item.disabled ? 'PGU-Disabled' : ''}}\"><a data-ng-if=item.href ng-href=\"{{(item.href ? (item.isAbsoluteUrl ? item.href : context_uri + item.href) : '')}}\" class=\"PGU-Button PGU-Btn-Base {{ item.btnIcon ? 'PGU-Btn-' + item.btnIcon : ''}} {{item.action ? 'PGU-Button_' + item.action : ''}} {{item.buttonSize && item.buttonSize == 'small' ? 'PGU-Btn-Small' : ''}} {{item.buttonSize && item.buttonSize == 'larger' ? 'PGU-Btn-Large' : ''}} {{item.btnColor && item.btnColor == 'blue' ? 'PGU-Btn-Blue' : ''}} {{item.isNotActive ? 'PGU-Button_isNotActive' : ''}} {{item.isLoad ? 'PGU-Btn-Load': ''}}\" tabindex=\"{{item.disabled ? -1 : 1}}\" action={{::item.action}} id={{::item.fullPath}} target=\"{{item.linkTarget || '_self'}}\" ng-click=handleClick($event)><span class=PGU-Btn-Text>{{(item.fullPath + '.label' | translate:item.label) || item.label}}</span><div class=PGU-Btn-Throbber data-ng-class=\"{'PGU-Btn-Throbber-with-message': item.throbberMsg}\" data-ng-if=item.isLoad><epgu-throbber data-throbber-type=PGU-throbber-small data-show-heading=!!item.throbberMsg data-small-with-message=!!item.throbberMsg data-msg={{item.throbberMsg}}></epgu-throbber></div></a><button data-ng-if=!item.href type=button class=\"PGU-Button PGU-Btn-Base {{ item.btnIcon ? 'PGU-Btn-' + item.btnIcon : ''}} {{item.action ? 'PGU-Button_' + item.action : ''}} {{item.buttonSize && item.buttonSize == 'small' ? 'PGU-Btn-Small' : ''}} {{item.buttonSize && item.buttonSize == 'larger' ? 'PGU-Btn-Large' : ''}} {{item.btnColor && item.btnColor == 'blue' ? 'PGU-Btn-Blue' : ''}} {{item.isNotActive ? 'PGU-Button_isNotActive' : ''}} {{item.isLoad ? 'PGU-Btn-Load': ''}}\" tabindex=\"{{item.disabled ? -1 : 1}}\" action={{::item.action}} id={{::item.fullPath}} ng-click=handleClick($event)><span class=PGU-Btn-Text>{{(item.fullPath + '.label' | translate:item.label) || item.label}}</span><div class=PGU-Btn-Throbber data-ng-class=\"{'PGU-Btn-Throbber-with-message': item.throbberMsg}\" data-ng-if=item.isLoad><epgu-throbber data-throbber-type=PGU-throbber-small data-show-heading=!!item.throbberMsg data-small-with-message=!!item.throbberMsg data-msg={{item.throbberMsg}}></epgu-throbber></div></button></div></div>"),$templateCache.put("js/components/FormPreview/FormPreview.html","<div class=PGU-FormStep-Preview ng-show=item.visibleStep><preview-container elements=item.elements></preview-container></div>"),$templateCache.put("js/components/FormStep/FormStep.html",'<div ng-show="(item.visibleStep && (!!item.visible))" full-path="{{::(item.UUIDFullPath || item.fullPath)}}" id={{::$id}}><div class=PGU-FormStep ng-class="{\n        \'PGU-FormStepDisabled\' : item.disabled\n   }"><div data-ng-if=::$root.device.desktop><div class="PGU-FormStep-Title-Wrap js-PGU-FormStep-Title-Wrap {{::$root.device.desktop ? \'desktop\' : \'\'}} {{($root.isDesigner ? item.label : item.stepNumber).length == 2 ? \'PGU-FormStep-Title-largeLength\' : \'PGU-FormStep-Title-smallLength\'}}" ng-if="item.title || item.label || item.stepNumber"><span class="PGU-FormStep__number js-PGU-FormStep__number">{{$root.isDesigner ? item.label : item.stepNumber}}</span><div ng-if="item.title !== \'Заголовок шага\'" class=PGU-FormStepTitleWrap><h3 class="PGU-title PGU-title_form-step js-PGU-title_form-step"><span>{{(item.fullPath + \'.title\' | translate:item.title) || item.title}}</span><span class="PGU-Icon PGU-Icon-FormStepDone"></span></h3></div><question ng-if="::(item.mnemonicHint || item.hasEsiaHint)" item=item></question><div class=x-clear></div><div class=PGU-FormStepInfoSide ng-if="::(ui.isDesktop && item.isAccordionMode)"><a class="PGU-Link PGU-Link-esia" ng-click=item.openStepForEdit() ng-if=item.disabled tabindex=1>Изменить данные шага</a><div class="PGU-HelperBox PGU-HelperBox-FormStep PGU-HelperBox-Type-important" ng-if=item.editableMode><h4 class=PGU-HelperBox-Title>Шаг {{item.stepNumber}} редактируется</h4><div class=PGU-HelperBox-Content>При внесении изменений может поменяться состав следующих шагов, уже введенные данные сохраняются</div></div></div></div><div class=PGU-FormStep-Html ng-bind-html="item.html | to_trusted"></div><div class=x-clear></div><div class="ITEMS_CONTAINER PGU-FormStep-ITEMS_CONTAINER" ng-if="::(!$root.isDesigner && item.items)" data-ng-show=!item.shaded><form-tree ng-repeat="item_i in ::item.items track by $index" item=item_i></form-tree><epgu-form-button class=btnStepEdit ng-if="::(!ui.isDesktop && item.isAccordionMode) && item.disabled" item=ui.btnStepEdit click-handler-btn=item.openStepForEdit></epgu-form-button></div><div class="ITEMS_CONTAINER PGU-FormStep-ITEMS_CONTAINER" ng-if="$root.isDesigner && item.items" data-ng-show=!item.shaded><form-tree ng-repeat="item_i in item.items track by $index" item=item_i></form-tree><epgu-form-button class=btnStepEdit ng-if="(!ui.isDesktop && item.isAccordionMode) && item.disabled" item=ui.btnStepEdit click-handler-btn=item.openStepForEdit></epgu-form-button></div></div><div data-ng-if=::$root.device.mobile><div class="PGU-FormStep-Title-Wrap js-PGU-FormStep-Title-Wrap device mobile"><span class="PGU-FormStep__number js-PGU-FormStep__number">{{item.stepNumber}}</span><div ng-if="item.title !== \'Заголовок шага\'" class=PGU-FormStepTitleWrap><h3 class="PGU-title PGU-title_form-step js-PGU-title_form-step"><span>{{item.title}}</span><span class="PGU-Icon PGU-Icon-FormStepDone"></span></h3><div class=x-clear></div></div></div><div class="PGU-HelperBox PGU-HelperBox-FormStep PGU-HelperBox-Type-important" ng-if="::(!ui.isDesktop && item.isAccordionMode) && item.editableMode"><h4 class=PGU-HelperBox-Title>Шаг {{item.stepNumber}} редактируется</h4><div class=PGU-HelperBox-Content>При внесении изменений может поменяться состав следующих шагов, уже введенные данные сохраняются</div></div><div class=PGU-FormStep-Html ng-bind-html="item.html | to_trusted"></div><div class=x-clear></div><div class="ITEMS_CONTAINER PGU-FormStep-ITEMS_CONTAINER" ng-if=::item.items data-ng-show=!item.shaded><form-tree ng-repeat="item_i in ::item.items track by $index" item=item_i></form-tree><epgu-form-button class=btnStepEdit ng-if="!ui.isDesktop && item.isAccordionMode && item.disabled" item=ui.btnStepEdit click-handler-btn=item.openStepForEdit></epgu-form-button></div><question ng-if="::(item.mnemonicHint || item.hasEsiaHint)" item=item></question><div class=x-clear></div></div><div data-ng-if=::$root.device.tablet class=tablet><div class="PGU-FormStep-Title-Wrap js-PGU-FormStep-Title-Wrap device tablet {{item.mnemonicHint || item.hasEsiaHint ? \'PGU-FormStep-Title-Wrap-Tablet\' : \'\'}}"><span class="PGU-FormStep__number js-PGU-FormStep__number">{{item.stepNumber}}</span><div ng-show="item.title !== \'Заголовок шага\'" class=PGU-FormStepTitleWrap><h3 class="PGU-title PGU-title_form-step js-PGU-title_form-step"><span>{{item.title}}</span><span class="PGU-Icon PGU-Icon-FormStepDone"></span></h3></div><question ng-if="item.mnemonicHint || item.hasEsiaHint" item=item></question></div><div class="PGU-HelperBox PGU-HelperBox-FormStep PGU-HelperBox-Type-important" ng-if="::(!ui.isDesktop && item.isAccordionMode) && item.editableMode"><h4 class=PGU-HelperBox-Title>Шаг {{item.stepNumber}} редактируется</h4><div class=PGU-HelperBox-Content>При внесении изменений может поменяться состав следующих шагов, уже введенные данные сохраняются</div></div><div class=PGU-FormStep-Html ng-bind-html="item.html | to_trusted"></div><div class=x-clear></div><div class="ITEMS_CONTAINER PGU-FormStep-ITEMS_CONTAINER" ng-if=::item.items data-ng-show=!item.shaded><form-tree ng-repeat="item_i in ::item.items track by $index" item=item_i></form-tree><epgu-form-button class=btnStepEdit ng-if="!ui.isDesktop && item.isAccordionMode && item.disabled" item=ui.btnStepEdit click-handler-btn=item.openStepForEdit></epgu-form-button></div><div class=x-clear></div></div><div class=PGU-FormStepEditActions ng-if=item.editableMode><epgu-form-button item=ui.btnCancelEdit click-handler-btn=item.cancelEdit></epgu-form-button><epgu-form-button item=ui.btnSaveEdit click-handler-btn=item.saveEdit></epgu-form-button></div><div data-ng-cloak class="ITEMS_CONTAINER PGU-FormStep-ITEMS_CONTAINER" data-ng-if=item.shaded><div class="flex-container align-items-center PGU-throbber_FormStep"><div><epgu-throbber data-throbber-type=PGU-throbber-small></epgu-throbber></div><div class=PGU-throbber-FormStep__Text><h4 data-ng-cloak data-ng-bind=$root.mainLoader.title class=PGU-line-1></h4></div><div class=PGU-throbber-FormStep__Text><div data-ng-cloak class=PGU-line-2 data-ng-bind=$root.mainLoader.msg></div></div></div></div></div></div>'),$templateCache.put("js/components/HelperBox/HelperBox.html","<div ng-show=!!item.visible full-path={{::item.fullPath}}><div class=\"PGU-{{item.mode}}HelperBox PGU-{{item.mode}}HelperBox-Type-{{::item.type}} {{item.currentItem ? 'editor-item-selected' : ''}} {{item.hoverItem ? 'editor-item-hovered' : ''}}\" ng-attr-style=\"width:  {{item.width ? item.width + 'px' : 'auto'}}; height: {{item.height ? item.height + 'px' : 'auto'}}\"><h4 class=PGU-{{item.mode}}HelperBox-Title data-ng-show=item.title ng-bind-html=\"(item.fullPath + '.title' | translate:item.title) || item.title\"></h4><div class=\"PGU-{{item.mode}}HelperBox-Content PGU-HelperBox-Content\" ng-if=\"!$root.env.formParam['translationForm']\" ng-bind-html=\"((item.extTextResource | textResource ) || item.html) | to_trusted\"></div><div class=\"PGU-{{item.mode}}HelperBox-Content PGU-HelperBox-Content\" ng-if=\"$root.env.formParam['translationForm']\" ng-bind-html=\"((item.fullPath + '.html' | translate:item.html) || item.html) | to_trusted\"></div></div></div>"),
$templateCache.put("js/components/ImageEditor/ImageEditor.html","<div ng-show=(!!item.visible) id={{::$id}} full-path={{::item.fullPath}}><div class=\"PGU-{{::item.className}} imageEditorWrap {{ui.customClassName ? ui.customClassName : ''}}\" ng-attr-style={{::item.inlineCSS}} ng-class=\"{\n        'PGU-Disabled'                      : item.disabled,\n        'PGU-Required'                      : item.required,\n        'PGU-Error'                         : item.error,\n        'PGU-imageEditorAreaFemale'         : item.gender,\n        'PGU-ImageEditor-loading'           : ui.loading,\n        'PGU-Image-SelectedStart'           : ui.selectedStart,\n        'PGU-Details-show'                  : ui.isDetailsShow,\n        'PGU-ImageEditorPhone'              : isPhone,\n        'PGU-ImageEditorFileReader'         : ui.fileReaderMode,\n        'PGU-ImageEditor_mob-optimize': $root.settings.mobOptimizeImageEditor,\n        'PGU-ImageEditor-Custom-Sized': item.isCustomSized\n"+'    }"><div class=PGU-ImageEditorInner><h3 ng-if=!ui.fileReaderMode class=PGU-image-editor__descr__title>{{::item.descrTitle}}</h3><div ng-if=!ui.fileReaderMode class="PGU-image-editor__descr__content pgu-panel-html" ng-bind-html="item.html | to_trusted"></div><a ng-if=!ui.fileReaderMode class="PGU-Link PGU-Link-showDetails js-showDetails" ng-click=toggleDetails(true)>Все требования</a><div ng-if=!ui.fileReaderMode class=imageEditorPreview ng-bind-html="item.instructions | to_trusted"></div><div class=PGU-ImageEditor><div class=imageEditorUploadButtonWrap></div><div id=imageEditorImageView><div class="imageEditor PGU-ImageViewContainer cf" style="{{(item.isCustomSized && ui.customStyles) ? \'width:auto\': \'\'}}"><div class=PGU-ImageEditorLines ng-if="ui.fileReaderMode && !item.isCustomSized"><svg version=1.1 id=Слой_3 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink x=0px y=0px width=365px height=236px viewBox="0 0 365 236" style="enable-background:new 0 0 365 236;" xml:space=preserve class=PGU-ImageEditor-LineSVG><style>.PGU-ImageEditor-st0 {\n                                    fill: #535B63;\n                                }\n                                .PGU-ImageEditor-st1 {\n                                    font-family: \'Helvetica\', \'Arial\', sans-serif;\n                                }\n                                .PGU-ImageEditor-st2 {\n                                    font-size: 12px;\n                                }\n\n                                .PGU-ImageEditor-st3 {\n                                    opacity: 0.3;\n                                }\n                                .PGU-ImageEditor-st5 {\n                                    fill: none;\n                                    stroke: #000000;\n                                    stroke-miterlimit: 10;\n                                    stroke-dasharray: 5, 5;\n                                }</style><text data-ng-repeat="item in ::customText" ng-attr-transform=matrix{{::item.matrix}} class="PGU-ImageEditor-st0 PGU-ImageEditor-st1 PGU-ImageEditor-st2">{{::item.text}}</text><g class=PGU-ImageEditor-st3 data-ng-repeat="line in ::customLines"><g><line class=PGU-ImageEditor-st5 x1=0 ng-attr-y1={{line.y}} ng-attr-y2={{line.y}} x2=360 /></g></g></svg> <svg xmlns=http://www.w3.org/2000/svg width=232 height=208 viewBox="0 0 232 208" class=PGU-ImageEditor-LineSVG__mob-optimize><g fill=none fill-rule=evenodd><rect width=1 height=206 x=227 y=2 fill=#666 fill-rule=nonzero /><path stroke=#666 stroke-linecap=square d="M.5.5L227.729996.5M.5 207.5L227.729996 207.5"/><polygon fill=#666 fill-rule=nonzero points="227.5 2.608 224.281 6.837 223.5 6.118 227.5 1 231.5 6.118 230.719 6.923"/><polygon fill=#666 fill-rule=nonzero points="227.5 203.608 224.281 207.837 223.5 207.118 227.5 202 231.5 207.118 230.719 207.923" transform="matrix(1 0 0 -1 0 409.923)"/></g></svg></div><div class=imageEditorAreaWrapper ng-style=ui.customStyles><div ng-if=!ui.fileReaderMode class="PGU-image-editor-area__line PGU-image-editor-area__line_top"><div class=PGU-image-editor-area__line__inner><span class=PGU-image-editor-area__line__text ng-bind-html="ui.linesText.top | to_trusted"></span></div></div><div ng-if=!ui.fileReaderMode class="PGU-image-editor-area__line PGU-image-editor-area__line_middle"><div class=PGU-image-editor-area__line__inner><span class=PGU-image-editor-area__line__text ng-bind-html="ui.linesText.middle | to_trusted"></span></div></div><div ng-if=!ui.fileReaderMode class="PGU-image-editor-area__line PGU-image-editor-area__line_bottom"><div class=PGU-image-editor-area__line__inner><span class=PGU-image-editor-area__line__text ng-bind-html="ui.linesText.bottom | to_trusted"></span></div></div><div class=imageEditorAreaBackground ng-style=ui.customStyles></div><div ng-class="{\'imageEditorAreaWrapTable\': true, \'horizontalMargin\': ui.horizontalMargin, \'verticalMargin\': ui.verticalMargin}"><div class="imageEditorArea imageEditorArea-on-form" ng-class="{\'horizontalMargin\': ui.horizontalMargin, \'verticalMargin\': ui.verticalMargin}" ng-style=ui.customStyles></div></div><div ng-if=!ui.fileReaderMode class=PGU-FieldUpload><div class=PGU-FieldUploadButtonWrap><a class="PGU-FieldUploadButton js-PGU-FieldUploadButton" id={{::item.fullPath}}:upload>{{item.btnName}}</a><div class=PGU-FieldUploadFileName></div></div></div></div><div class=PGU-FieldUploadButtonWrap data-ng-if=ui.fileReaderMode><epgu-form-button item=ui.btnShowDialog click-handler-btn=ui.toggleModalVisible click-attr=(true) data-ng-if="!item.isCustomSized || (item.isCustomSized && !item.disabledUploadBtn)"></epgu-form-button></div><div ng-if=!ui.fileReaderMode class=imageEditorControls><div class=PGU-image-editor__control-wrapper><a class="imageEditorControl imageRotateLeft buttonIcon biRotateOn" ng-click="ui.uploadEdit(ui.actions.imageRotateLeftEnabled, \'rotate\', \'right\')" ng-class="{\'disabled\': !ui.actions.imageRotateLeftEnabled}"><div class=PGU-icon_cell><span class="PGU-Icon PGU-icon_image-editor-button"></span></div><div class=PGU-icon_cell><span class=buttonIconText>{{::item.rotateLeftButton}}</span></div></a></div><div class=PGU-image-editor__control-wrapper><a class="imageEditorControl imageRotateRight buttonIcon line2 biRotateAgain" ng-click="ui.uploadEdit(ui.actions.imageRotateRightEnabled, \'rotate\', \'left\')" ng-class="{\'disabled\': !ui.actions.imageRotateRightEnabled}"><div class=PGU-icon_cell><span class="PGU-Icon PGU-icon_image-editor-button"></span></div><div class=PGU-icon_cell><span class=buttonIconText>{{::item.rotateRightButton}}</span></div></a></div><div class=PGU-image-editor__control-wrapper><a class="imageEditorControl imageCrop buttonIcon biCrop" ng-click="ui.uploadEdit(ui.actions.imageCropEnabled,\'crop\')" ng-class="{\'disabled\': !ui.actions.imageCropEnabled, \'PGU-ImageEditor-Active-Btn\': ui.imageCropActive}"><div class=PGU-icon_cell><span class="PGU-Icon PGU-icon_image-editor-button"></span></div><div class=PGU-icon_cell><span class=buttonIconText>{{::item.cropButton}}</span></div></a></div><div class=PGU-image-editor__control-wrapper><a class="imageEditorControl imageUndo buttonIcon biUndo" ng-click="ui.uploadEdit(ui.actions.previousImageEnabled, \'previousImage\')" ng-class="{\'disabled\': !ui.actions.previousImageEnabled}"><div class=PGU-icon_cell><span class="PGU-Icon PGU-icon_image-editor-button"></span></div><div class=PGU-icon_cell><span class=buttonIconText>{{::item.cancelButton}}</span></div></a></div><div class=PGU-image-editor__control-wrapper><a class="imageEditorControl imageDelete buttonIcon biDel" ng-click=ui.removeImage() ng-class="{\'disabled\': !ui.actions.deleteImageEnabled}"><div class=PGU-icon_cell><span class="PGU-Icon PGU-icon_image-editor-button"></span></div><div class=PGU-icon_cell><span class=buttonIconText>{{::item.deleteButton}}</span></div></a></div></div><div class=PGU-FieldError data-ng-if="item.error && ui.fileReaderMode">{{(item.error.mnemonic + \'.validator\' | translate:item.error.text) || (item.error.text || item.error)}}</div></div><modal-dialog show=ui.modalShow hide-modal=ui.toggleModalVisible(false)><div ng-include src=modalTmpl ng-if=ui.fileReaderMode></div></modal-dialog><div class=imageEditorPreviewErr ng-show="ui.stateShow && !ui.fileReaderMode"><span class="PGU-Icon PGU-Icon-ImageEditorPreviewState" ng-class="{\'PGU-Icon-ImageEditorPreviewStateError\': ui.errorCode}"></span><span class="red PGU-ImageEditorStateMsg js-PGU-ImageEditorStateMsg" ng-bind-html="(item.error || \'\') | to_trusted"></span></div></div></div></div><div class="PGU-Details js-PGU-Details"><a class="PGU-Link PGU-Link-closeDetails js-closeDetails" ng-click=toggleDetails(false)><span class="PGU-Icon PGU-Icon-close"></span></a><h3 class=PGU-Details-Title>Технические требования к фотографии</h3><div class=PGU-DetailsContent ng-bind-html="item.allDescription | to_trusted"></div></div></div></div>'),$templateCache.put("js/components/Informer/Informer.html",'<div class=PGU-Informer ng-attr-style="width: {{::item.width}}px; height: {{::item.height}}px; " full-path={{::item.fullPath}}><div class=PGU-Informer-loaderText ng-if=item.loader>{{::item.loadingText}}</div><div class=PGU-Informer-loader ng-if=item.loader></div><div class=PGU-Informer-foundText ng-if=item.out.total>{{::item.foundText}} <b class=PGU-Informer-Total>{{::item.out.total}}</b> <span class=PGU-Informer-foundText-rub>P</span></div><div class=PGU-Informer-notFoundText ng-if="item.out.total === 0">{{item.notFoundText}}</div><div class=PGU-Informer-errorText ng-if=item.error>{{item.errorText}}</div><div class=PGU-Informer-notUseForm ng-if=notUseForm>{{item.notUseForm}}</div></div>'),$templateCache.put("js/components/InformerNotify/InformerNotify.html","<div class=PGU-Informer full-path={{::item.fullPath}} ng-click=\"item.informerHandleClick(item.typeInformer, item.state, $event)\" ng-class=setInformerCls(item)><div class=PGU-InformerWrapper><h4 ng-if=item.title>{{item.title}}</h4><div class=loading-block ng-if=\"item.state === 'U'\">{{item.updateMessage}}</div><div class=PGU-InformerNotify-loader ng-if=\"item.state === 'U'\"></div><div class=result-block ng-if=\"item.state === 'F'\">{{item.errorMessage}}</div><div data-ng-if=\"item.state === 'E' && (getInformerItemsLength(item.out.items) > 0 && item.out.total != 0)\" class=result-block>{{item.out.total.replace('.00', '').replace(' ', '&nbsp;')}}&nbsp;<nobr class=PGU-rouble>p</nobr></div><div data-ng-if=\"item.state == 'E' && (getInformerItemsLength(item.out.items) > 0 && item.out.total != 0) && item.withDiscounts\" class=result-block-discounts>{{item.discountMessage}}</div><div data-ng-if=\"item.state == 'E' && (getInformerItemsLength(item.out.items) == 0 || item.out.total == 0)\">{{item.successMessage}}</div><div data-ng-if=\"item.state === 'H'\" class=PGU-PlainText>{{item.disabledMessage}}</div><div data-ng-if=\"item.state === 'D'\" class=PGU-PlainText>{{item.disabledMessage}}</div></div><span class=\"informer-update js-update-el\" data-ng-if=\"item.state !== 'D' && item.state !== 'H' && item.state !== 'U'\"></span></div>"),$templateCache.put("js/components/InformersAll/Informers.html",'<div class=PGU-Informers full-path={{::item.fullPath}} data-ng-switch=$root.env.logined><div class=index-slider-banner-unauth data-ng-switch-when=false><div class=PGU-Informer-Logo></div><h3 class="PGU-Title-H3 PGU-Text-Centered">Получите доступ к&nbsp;штрафам ГИБДД, налоговым и&nbsp;судебным задолженностям</h3><div class=PGU-Text-Centered><epgu-form-button item=btnLogin click-handler-btn=btnLoginClick></epgu-form-button><epgu-form-button item=btnAuth></epgu-form-button></div></div><div data-ng-class="{\'PGU-Informers-Hint-Show\': hintShow, \'index-slider-banner-auth\': true}" data-ng-switch-default data-ng-if="informers.length && $root.env.orgTypeParam != \'L\' && $root.env.orgTypeParam != \'B\' && $root.env.user.personCitizenship == \'RUS\'"><div class=main-block><div data-ng-show=!hintShow class="{{$root.version == \'mob\' ? \'advice-mobile-informers-wrapper\' : \'advice-informers-wrapper\'}}" data-touch-scroll-container><div class=PGU-Informers-Auth-Header><div class="PGU-Title-H3 PGU-Title-H3--Informers-Auth informers-flex-row"><span class=PGU-Title-H3-Inner-Text>Ваши задолженности</span> <span class=PGU-PopupHint><span class=questionIcon data-ng-click=toggleHint(true)></span></span></div></div><div class=advice-mobile-informers-row><div class=informers-flex-wrap><epgu-informer-notify data-ng-repeat="informer in informers" item=informer></epgu-informer-notify></div></div></div><div data-ng-show=hintShow class=PGU-Informers-Auth-Hint><span class=PGU-Informers-Auth-Hint-Close data-ng-click=toggleHint(false)></span><p class="PGU-PlainText PGU-Informers-Auth-Hint-Text">Портал <a data-ng-href={{::portalUrl}} target=_blank>Госуслуг</a> предоставляет возможность следить за&nbsp;штрафами по&nbsp;вашему водительскому удостоверению и&nbsp;транспортному средству, налоговыми и&nbsp;судебными задолженностями.</p><p class="PGU-PlainText PGU-Informers-Auth-Hint-Text">Заполните данные прямо в&nbsp;форме для поиска или <a data-ng-href={{::esiaProfileUrl}} target=_blank>в&nbsp;вашем профиле</a>, чтобы всегда оставаться в&nbsp;курсе расчетов с&nbsp;государством!</p></div></div><div class="PGU-Informers-Auth-Footer cf"><div class=PGU-Informers-Logo></div></div></div></div>'),$templateCache.put("js/components/InitialImpact/InitialImpact.html",'<div id={{::id}} full-path={{::item.fullPath}} ng-show=(!!item.visible)><div class="initialImpactWrap PGU-{{::item.className}} PGU-LabelWidth-{{::item.labelWidth}} PGU-LabelAlign-{{::item.labelAlign}} {{item.disabled ? \'PGU-Disabled\' : \'\'}} {{item.required ? \'PGU-Required\' : \'\'}} {{item.error ? \'PGU-Error\' : \'\'}}"><epgu-field-dropdown data-ng-if=typesTSDropdown item=typesTSDropdown></epgu-field-dropdown><div data-ng-if="curTypeTS && curTypeTS.typeName" class=all-offset-top-24><label class=PGU-FieldLabel>Укажите место первоначального удара</label><div class="sectors-container type-{{curTypeTS.typeName}}"><div data-ng-repeat="sector in sectors" class="arrow-button arrow-button{{$index + 1}}" data-ng-click="selectSector($index, sector)" data-ng-class="{selected: sector.isSelected, disabled: sector.isDisabled}"></div></div></div><div class=PGU-FieldBody ng-if=item.error><div class=PGU-FieldError>{{item.error}}</div></div></div></div>'),$templateCache.put("js/components/InnerStep/InnerStep.html","<div ng-show=!!item.visible id={{::$id}} full-path={{::item.fullPath}}><div ng-attr-style={{item.inlineCSS}} class=\"PGU-{{::item.className}} PGU-LabelWidth-{{::item.labelWidth}} PGU-Panel-GridWidth-{{::item.gridWidth}} PGU-Panel-GridWidth_palm-{{::item.gridWidthMobile}} PGU-Panel-GridWidth_lap-{{::item.gridWidthTablet}} PGU-Panel-Width-{{::item.width}} PGU-InnerStep-color-{{::item.innerStepColor}} PGU-InnerStep-{{::item.innerStepCode}} {{::item.hideOnMobile ? 'PGU-Control-HideOnMobile' : ''}} {{::item.hideOnDesktop ? 'PGU-Control-HideOnDesktop' : ''}} {{::item.isGrid ? 'PGU-Panel-Grid' : ''}} {{::item.isGridItem ? 'PGU-Panel-Grid-Item' : ''}} {{::item.withRadioButton ? 'PGU-Panel-WithRadioBtn' : ''}} {{::item.inRightPlace ? 'PGU-Panel-inRightPlace' : ''}}\"><div class=PGU-Panel-inner><span class=\"PGU-InnerStepIcon js-PGU-InnerStepNumber\">{{ ::item.innerStepNumber }}</span><div class=PGU-InnerStep-inner><h2 class=PGU-InnerStep-title ng-if=item.title ng-bind-html=\"item.title | to_trusted\"></h2><div class=pgu-panel-html ng-bind-html=\"item.html | to_trusted\"></div><div class=ITEMS_CONTAINER ng-if=item.items><form-tree ng-repeat=\"item_i in item.items track by item_i.fullPath track by $index\" item=item_i></form-tree></div></div></div><div class=PGU-Panel-Error></div></div></div>"),$templateCache.put("js/components/InvitationPanel/InvitationPanel.html",'<div data-ng-show="(!item.visibleLazy && (!!item.visible))" id={{::id}} full-path={{::item.fullPath}}><div class=PGU-InvitaionPanel><div class=PGU-Info-Block data-ng-if=item.curHelperText><div ng-bind-html=item.curHelperText class=PGU-Panel-Text-Block></div><a class="PGU-Link PGU-Link-td-none PGU-Link-with-toggle-arrow {{show ? \'PGU-Link-with-toggle-arrow-up\' : \'\'}}" href="" id=showLabelInvitation data-ng-click="show = !show" data-ng-show=item.curHelperTextMoreInfo>{{show ? \'Скрыть\' : \'Подробнее\'}}</a><div ng-if=show ng-bind-html=item.curHelperTextMoreInfo class="PGU-Panel-Info-Hint PGU-Panel-Text-Block"></div></div><form-tree ng-repeat="item_i in item.items" item=item_i></form-tree><div class="PGU-Panel-Actions-Toggle PGU-BtnHolder" data-ng-class="{\'PGU-Button-Hide\' : hideAllButton}"><span data-ng-if=$root.showTimer class=timer-block><simple-timer time=item.nextAttemp string1="Вы сможете повторно отправить приглашение через" string2=минут></simple-timer></span><br><a ng-click=item.btnClick($event) class="PGU-btn-base PGU-btn-medium PGU-Button-align-right" data-ng-class="{\'disabled-button\': $root.showTimer || !item.isValid,\'PGU-Btn-White\': item.curToggleBtnText == item.btnLabelRepeat}" target=_blank data-ng-if="item.curToggleBtnText && !item.isLoad"><span class=PGU-btn-text>{{item.curToggleBtnText}}</span></a><epgu-throbber data-ng-if=item.isLoad data-throbber-type="PGU-throbber-small throbber-block" data-show-heading=false></epgu-throbber></div><div class=PGU-Panel-Actions-AllSigned data-ng-class="{\'PGU-Button-Hide\' : item.hideAllButton}"><a ng-click=item.editAction() class="PGU-btn-base PGU-btn-medium PGU-Btn-White PGU-Button-align-left" target=_blank data-ng-if=item.editButton>Изменить заявление </a><a ng-click=item.toPayAction() class="PGU-btn-base PGU-btn-medium PGU-Btn-White PGU-Button-align-right" target=_blank data-ng-if="item.toPayButton && !item.isLoad">Перейти к оплате</a></div></div></div>'),$templateCache.put("js/components/InvitationPanelEuroprotocol/InvitationPanelEuroprotocol.html",'<div data-ng-show=!!item.visible id={{::id}} full-path={{::item.fullPath}}><div class=PGU-InvitaionPanelEP><epgu-advice data-ng-if=adviceBlock item=adviceBlock></epgu-advice><div><a data-ng-click=send() class="PGU-Button PGU-Btn-Base PGU-Btn-medium PGU-Btn-Blue PGU-Button-align-right" data-ng-if="showSendButton && !isLoad"><span class=PGU-btn-text>Подписать</span> </a><a data-ng-click=reset() class="PGU-Button PGU-Btn-Base PGU-Btn-medium PGU-Button-align-right" data-ng-if="showRejectButton && !isLoad"><span class=PGU-btn-text>Отклонить</span></a><epgu-throbber data-ng-if=isLoad data-throbber-type="PGU-throbber-small throbber-block" data-show-heading=false></epgu-throbber><div class=PGU-FieldError>{{errorMessage}}</div></div></div></div>'),$templateCache.put("js/components/Kladr/Kladr.html","<div ng-show=!!item.visible id={{::id}} full-path={{::item.fullPath}}><div class=\"PGU-Kladr PGU-LabelWidth-{{::labelWidth}} PGU-LabelAlign-{{::labelAlign}} {{item.disabled ? 'PGU-Disabled' : ''}} {{item.required ? 'PGU-Required' : ''}} {{item.error ? 'PGU-Error' : ''}}\"><label class=PGU-FieldLabel ng-if=item.label>{{item.label}}</label><div class=\"PGU-KladrWrap PGU-FieldBody\"><div class=\"address form-text form-text-common\">{{item.value}}<div class=change-address-container><epgu-form-button ng-if=ui.btnOpenDialog item=ui.btnOpenDialog click-handler-btn=ui.showDialog></epgu-form-button><epgu-form-button ng-if=ui.btnClearModel item=ui.btnClearModel click-handler-btn=ui.clearModel></epgu-form-button></div></div><modal-dialog data-ng-if=ui.showPopup show=ui.showPopup><div class=PGU-popup-body><div class=shadow ng-show=ui.loading></div><div class=PGU-Kladr-FormManual ng-if=\"item.items && item.items.length\"><form-tree ng-repeat=\"item in item.items track by $index\" item=item data-ng-if=\"$index < $parent.item.items.length\"></form-tree></div></div><div class=PGU-popup-footer><div class=PGU-Kladr-WrapButton><epgu-form-button ng-if=ui.btnCancel item=ui.btnCancel click-handler-btn=ui.cancel></epgu-form-button><epgu-form-button ng-if=ui.btnSaveData item=ui.btnSaveData click-handler-btn=models.saveData></epgu-form-button><epgu-form-button ng-if=\"item.dictionaryOnly && (ui.formState !== 'manual')\" item=ui.btnShowPanelManual click-handler-btn=ui.showPanelManual></epgu-form-button><epgu-form-button ng-if=\"item.dictionaryOnly && item.className === 'KladrRusStat' && (ui.formState !== 'mixed')\" item=ui.btnShowPanelMixed click-handler-btn=ui.showPanelMixed></epgu-form-button></div></div></modal-dialog></div><div class=PGU-FieldBody><div class=PGU-FieldNotRequired ng-if=::item.notRequiredText>{{::item.notRequiredText}}</div><div class=PGU-FieldHint ng-if=::item.hint>{{::item.hint}}</div><div class=PGU-FieldError data-ng-if=item.error>{{(item.error.mnemonic + '.validator' | translate:item.error.text) || (item.error.text || item.error)}}</div></div></div></div>"),$templateCache.put("js/components/Label/Label.html","<div id={{::$id}} ng-show=!!item.visible full-path={{::item.fullPath}}><div class=\"PGU-Label PGU-LabelWidth- PGU-LabelAlign-\" ng-class=\"::{'device cf' : $root.device.device,\n               'mobile' : $root.device.mobile,\n               'tablet' : $root.device.tablet}\" ng-attr-style={{::item.inlineCSS}}>{{ item.value }}<div class=PGU-Label__html ng-if=\"::!$root.env.formParam['translationForm']\" ng-class=\"::{'version-device': $root.device.device}\" ng-bind-html=\"((item.extTextResource | textResource ) || item.text || '') | to_trusted\"></div><div class=PGU-Label__html ng-if=\"::$root.env.formParam['translationForm']\" ng-class=\"::{'version-device': $root.device.device}\" ng-bind-html=\"((item.fullPath + '.text' | translate:item.text) || item.text || '') | to_trusted\"></div><span class=\"PGU-PopupHint {{::$root.device.mobile ? 'mobile' : ''}} {{::$root.device.tablet ? 'tablet' : ''}}\" ng-if=\"item.mnemonicHint && item.mnemonicHintShow\"><i class=\"questionIcon {{item.deviceShow ? 'PGU-showHintTriangle' : ''}}\" click-hint=1><span class=PGU-PopupHintOuterArrow></span> <span data-ng-if=::$root.device.desktop class=PGU-PopupHintOuter><span class=PGU-PopupHintContent ng-bind-html=\"item.hintHtml | to_trusted\"></span> </span></i></span><span data-ng-if=\"::($root.device.device && item.hintHtml)\" class=\"PGU-PopupHintOuter {{::item.deviceShow ? ' PGU-showHint' : ''}} {{::$root.device.mobile ? 'mobile' : ''}} {{::$root.device.tablet ? 'tablet' : ''}}\"><span class=PGU-PopupHintContent ng-bind-html=\"item.hintHtml | to_trusted\"></span></span></div></div>"),$templateCache.put("js/components/ListKids/ListKids.html",'<div data-ng-show=(!!item.visible) id={{::$id}} full-path={{::item.fullPath}}><div data-ng-if=::!item.isComplete data-ng-attr-style={{::item.inlineCSS}} data-ng-class="{\n            \'PGU-{{::item.className}}\': true,\n        }"><div class=grid-wrap><div class=grid-wrap__row><div data-ng-repeat="kid in item.list track by $index" class="grid-wrap__col-lg-5 lg-offset-top-16 md-offset-top-16 sm-offset-top-16 grid-wrap__col-md-6 grid-wrap__col-sm-6"><div data-ng-class="{\n                            \'ListKid-Item\': true,\n                            \'PGU-PlainText\': true,\n                            \'ListKid-Item_isOwner\': kid.isOwner,\n                            \'ListKid-Item_current\': kid.current\n                        }" data-ng-click=item.setCurrent($index)><h4 class="ListKid-Item__Title lg-offset-top-8 lg-offset-bottom-8 md-offset-top-8 md-offset-bottom-8 sm-offset-top-8 sm-offset-bottom-8">{{kid.lastName}} {{kid.firstName}} {{kid.middleName}}</h4><p class="lg-offset-top-8 md-offset-top-8 sm-offset-top-8 lg-offset-bottom-8 md-offset-bottom-8 sm-offset-bottom-8">{{kid.birthDate}}</p><p data-ng-if=::item.showOms class="lg-offset-top-8 md-offset-top-8 sm-offset-top-8 lg-offset-bottom-8 md-offset-bottom-8 sm-offset-bottom-8">ОМС: {{kid.omsNumber}}</p></div></div></div><div class="grid-wrap__row lg-offset-top-32 md-offset-top-32 sm-offset-top-24" data-ng-if=::item.showLinks><div class="grid-wrap__col-lg-5 grid-wrap__col-md-6 grid-wrap__col-sm-6"><a data-ng-href="" data-ng-if=!item.isChooseSelf data-ng-click=item.chooseOtherUser() class=PGU-Link>Записать другого человека</a> <a data-ng-href="" data-ng-if=item.isChooseSelf data-ng-click=item.chooseSelf() class=PGU-Link>Записать себя</a></div><div class="grid-wrap__col-lg-5 grid-wrap__col-md-6 grid-wrap__col-sm-6 sm-offset-top-16"><a data-ng-click=item.goToProfileChild(); data-ng-href="" class=PGU-Link>Добавить сведения о детях</a></div></div></div></div></div>'),$templateCache.put("js/components/ListReferral/ListReferral.html",'<div data-ng-show=(!!item.visible) id={{::$id}} full-path={{::item.fullPath}}><div data-ng-if=::!item.isComplete data-ng-attr-style={{::item.inlineCSS}} data-ng-class="{\n            \'PGU-{{::item.className}}\': true,\n        }"><div class=ListReferral__Toggle><div data-ng-if=item.showSearchReferral class=ListReferral__Toggle-Wrap data-ng-class="{\'ListReferral__Toggle-Wrap_up\': item.isOpenSearch}"><a data-ng-href="" data-ng-click=item.toggleSearch() class=PGU-Link-pseudo><span class=ListReferral__Toggle-Title>Найти направление по номеру</span> <span class=ListReferral__Toggle-Title_up>Скрыть поиск направления</span></a></div><epgu-throbber ng-if=searchThrobber data-throbber-type=PGU-throbber-small></epgu-throbber></div><div data-ng-show="!item.isOpenSearch && !search.error" class=ListReferral__Data><div class=ListReferral__List><div data-ng-repeat="referral in item.list track by $index" data-ng-click=item.setCurrent($index) data-ng-class="{\n                        \'ListReferral-Item\': true,\n                        \'PGU-PlainText\': true,\n                        \'ListReferral-Item_current\': referral.current\n                    }"><div class="flex-container align-items-center sm-align-items-start"><div class="sm-offset-top-8 ListReferral__Radio"><span class=ListReferral__Radio-Icon></span></div><div class=ListReferral__ItemData><div class="ListReferral__Data-Title lg-flex-container justify-between"><h3 class="ListReferral__Data-Title-Number lg-offset-top-8 lg-offset-bottom-16 sm-offset-bottom-16">Направление № {{referral.referralNumber}} от {{referral.referralStartDateFormatted}}</h3><div class="ListReferral__Data-Title-EndDate lg-offset-top-8 lg-offset-bottom-8" data-ng-class="{\'ListReferral__Data-Title-EndDate_open\': referral.isOpenDetails}" data-ng-if=referral.referralEndDate>Запись возможна до: {{referral.referralEndDateFormatted}}</div></div><div class="ListReferral__Data-Details lg-flex-container" data-ng-class="{\'ListReferral__Data-Details_open\': referral.isOpenDetails}"><div class=ListReferral__Data-Details-Item><h5 class="ListReferral__Data-Details-Item-Title lg-offset-bottom-8 sm-offset-top-24 sm-offset-bottom-16" data-ng-if=referral.typeIdText>{{referral.typeIdText}}</h5><p class="ListReferral__Data-Details-Item-Text lg-offset-top-8 sm-offset-top-16 lg-offset-bottom-8">{{referral.toSpecsName}}<span data-ng-if=referral.toResourceName> </span>{{referral.toResourceName}}</p><p class="ListReferral__Data-Details-Item-Text lg-offset-top-8 sm-offset-top-16 lg-offset-bottom-8">{{referral.toServiceName}}</p><p class="ListReferral__Data-Details-Item-Text lg-offset-top-8 sm-offset-top-16 lg-offset-bottom-8" data-ng-bind-html=referral.toMoName></p></div><div class=ListReferral__Data-Details-Item><h5 class="ListReferral__Data-Details-Item-Title lg-offset-bottom-8 sm-offset-top-24 sm-offset-bottom-16">Выдано направление</h5><p class="ListReferral__Data-Details-Item-Text sm-offset-top-16 lg-offset-top-8 lg-offset-bottom-8">{{referral.fromSpecsName}} {{referral.fromResourceName}}</p><p class="ListReferral__Data-Details-Item-Text sm-offset-top-16 lg-offset-top-8 lg-offset-bottom-8" data-ng-bind-html=referral.fromMoName></p></div></div><div data-ng-if=isMobile class="ListReferral__Toggle-Wrap ListReferral__Toggle-Wrap_Details" data-ng-class="{\'ListReferral__Toggle-Wrap_up\': referral.isOpenDetails}"><a data-ng-href="" data-ng-click=item.toggleDetails($index) class=PGU-Link-pseudo>{{referral.openDetailsText}}</a></div></div></div><div class=ListReferral__BottomLine><div class=ListReferral__BottomLine-bg></div></div></div></div><epgu-helper-box data-ng-if=search.isResponseEmpty item=search.isResponseEmpty></epgu-helper-box><div class="ListReferral__Buttons-Wrap flex-container justify-end" data-ng-if="(item.list && item.list.length) || (search.isResponseEmpty && item.isOpenSearch)"><div><epgu-form-button item=buttons.btnBook click-handler-btn=item.btnBook></epgu-form-button><epgu-form-button item=buttons.btnBookByReferral click-handler-btn=item.btnBookByReferral></epgu-form-button></div></div></div><div data-ng-show="item.isOpenSearch && !search.error" class=ListReferral-Search><form-tree ng-repeat="item_i in search.items" item=item_i></form-tree><div class="ListReferral__Buttons-Wrap flex-container justify-end"><div><epgu-form-button item=buttons.btnSearchReferral click-handler-btn=item.btnSearchReferral></epgu-form-button></div></div></div><div data-ng-show=search.error><p>{{search.error}}</p></div><epgu-helper-box data-ng-if=serverErrorItem item=serverErrorItem></epgu-helper-box></div></div>'),
$templateCache.put("js/components/ListSpecialists/ListSpecialists.html",'<div data-ng-show=(!!item.visible) id={{::$id}} full-path={{::item.fullPath}}><div data-ng-if=::!item.isComplete data-ng-attr-style={{::item.inlineCSS}} data-ng-class="{\n            \'PGU-{{::item.className}}\': true,\n        }"><div class=grid-wrap><div class=grid-wrap__row><div class="grid-wrap__col-lg-17 grid-wrap__col-md-12 grid-wrap__col-sm-6 lg-offset-top-24 md-offset-top-24 sm-offset-top-24">{{item.infoText}}</div><div data-ng-repeat="resource in item.list track by $index" class="grid-wrap__col-lg-17 grid-wrap__col-md-12 lg-offset-top-16 md-offset-top-24 sm-offset-top-16 grid-wrap__col-sm-6"><div data-ng-class="{\n                            \'ListOrganization-Item\': true,\n                            \'PGU-PlainText\': true,\n                            \'ListOrganization-Item_isOwner\': resource.isOwner,\n                            \'ListOrganization-Item_current\': resource.current\n                        }"><h4 class="ListOrganization-Item__Title lg-offset-top-16 lg-offset-bottom-16 md-offset-top-8 md-offset-bottom-16 sm-offset-top-8 sm-offset-bottom-8">{{resource.Organization_Name}}</h4><div class=ListOrganization-Item__Details><p class="lg-offset-top-8 md-offset-top-8 sm-offset-top-8 lg-offset-bottom-8 md-offset-bottom-8 sm-offset-bottom-8"><strong>Адрес:</strong> {{resource.Address_MO}}</p><p class="lg-offset-top-4 md-offset-top-8 sm-offset-top-8 lg-offset-bottom-8 md-offset-bottom-8 sm-offset-bottom-8"><strong>Телефон:</strong> {{resource.Reg_Phone}}</p></div><div class="grid-wrap lg-offset-top-16 md-offset-top-16 sm-offset-top-16"><div class="ListOrganization-Specialists grid-wrap__row justify-between"><div class="grid-wrap__col-lg-5 grid-wrap__col-md-12 grid-wrap__col-sm-6"><ul class=ListOrganization-ItemDoctors><li class="ListOrganization-ItemDoctor lg-offset-top-8 md-offset-top-8 sm-offset-top-8" data-ng-repeat="doctor in resource.doctors track by $index"><div data-ng-attr-title={{doctor.fio}} class="ListOrganization-ItemDoctor__FIO sm-offset-top-24 sm-offset-bottom-8 md-offset-top-24 md-offset-bottom-12">{{doctor.fio}}</div><div data-ng-if=isMobile><div class=ListOrganization-ItemDoctor-Message data-ng-if=doctor.rowTitle>{{doctor.rowTitle}}</div><div data-ng-if=!doctor.rowTitle data-ng-class="{\'ListOrganization-Item__Date-Toggle_isOpen\': doctor.isOpenDates}"><div class="ListOrganization-Item__Date-Toggle align-items-center flex-container justify-between" data-ng-click="toggleDates(resource.ind, $index)"><span class=ListOrganization-Item__Date-Toggle-Title>{{doctor.selectedDateStr ? doctor.selectedDateStr : \'Выберите дату\'}} </span><span class=ListOrganization-Item__Date-Toggle-Icon></span></div><ul data-ng-show=doctor.isOpenDates class=ListOrganization-Item__Dates><li class=ListOrganization-Item__Date-Wrap data-ng-repeat="date in doctor.originalDates track by $index"><div data-ng-class="{\n                                                            \'ListOrganization-Item__Date_HasValue\': date.value,\n                                                            \'ListOrganization-Item__Date_Selected\' : date.selected }" class="ListOrganization-Item__Date flex-container align-items-center justify-center" data-ng-click="item.setDate(date, doctor)"><span>{{date.dateLeadingZero}}.{{date.monthLeadingZero}}, {{date.dayName}}</span></div></li></ul></div></div><div data-ng-if=isTablet><div class=ListOrganization-ItemDoctor-Message data-ng-if=doctor.rowTitle>{{doctor.rowTitle}}</div><div class=flex-container data-ng-if=!doctor.rowTitle><div class="ListOrganization-Item__DatesAction ListOrganization-Item__DatesAction_prev flex-container justify-center align-items-center" data-ng-click="prevWeek(resource.ind, $index)"><span class=ListOrganization-Item__DatesAction-Arrow></span></div><div><ul class="ListOrganization-Item__Dates flex-container"><li class=ListOrganization-Item__Date-Wrap data-ng-repeat="date in doctor.listDates track by $index"><div data-ng-class="{\n                                                                            \'ListOrganization-Item__Date_HasValue\': date.value,\n                                                                            \'ListOrganization-Item__Date_Selected\' : date.selected }" class="ListOrganization-Item__Date flex-container align-items-center justify-center" data-ng-click="item.setDate(date, doctor)"><span>{{date.dateLeadingZero}}.{{date.monthLeadingZero}}, {{date.dayName}}</span></div></li></ul></div><div class="ListOrganization-Item__DatesAction ListOrganization-Item__DatesAction_next flex-container justify-center align-items-center" data-ng-click="nextWeek(resource.ind, $index)"><span class=ListOrganization-Item__DatesAction-Arrow></span></div></div></div></li></ul></div><div class=ListOrganization-Item__Doctors-Weeks data-ng-if=isDesktop><div class=flex-container><div class="ListOrganization-Item__DatesAction ListOrganization-Item__DatesAction_prev flex-container justify-center align-items-center" data-ng-click=prevWeek(resource.ind)><span class=ListOrganization-Item__DatesAction-Arrow></span></div><div class=ListOrganization-Item__Doctors-Week-Wrap><div class="lg-offset-top-8 ListOrganization-Item__Doctors-Week" data-ng-repeat="doctor in resource.doctors track by $index"><ul data-ng-if=doctor.rowTitle class="ListOrganization-Item__Dates flex-container" data-ng-attr-title={{doctor.rowTitle}}><li class=ListOrganization-Item__Date-Wrap data-ng-repeat="date in doctor.listDates track by $index"><div data-ng-class="{\n                                                        \'ListOrganization-Item__Date_HasValue\': date.value,\n                                                        \'ListOrganization-Item__Date_Selected\' : date.selected }" class=ListOrganization-Item__Date data-ng-click="item.setDate(date, doctor)">{{date.dateLeadingZero}}.{{date.monthLeadingZero}}, {{date.dayName}}</div></li></ul><ul data-ng-if=!doctor.rowTitle class="ListOrganization-Item__Dates flex-container" data-ng-attr-title={{doctor.rowTitle}}><li class=ListOrganization-Item__Date-Wrap data-ng-repeat="date in doctor.listDates track by $index"><div data-ng-attr-title={{date.title}} data-ng-class="{\n                                                             \'ListOrganization-Item__Date_HasValue\': date.value,\n                                                             \'ListOrganization-Item__Date_Selected\' : date.selected }" class=ListOrganization-Item__Date data-ng-click="item.setDate(date, doctor)">{{date.dateLeadingZero}}.{{date.monthLeadingZero}}, {{date.dayName}}</div></li></ul></div></div><div class="ListOrganization-Item__DatesAction ListOrganization-Item__DatesAction_next flex-container justify-center align-items-center" data-ng-click=nextWeek(resource.ind)><span class=ListOrganization-Item__DatesAction-Arrow></span></div></div></div></div></div></div></div></div></div><div class="ListSpecialist__Buttons-Wrap flex-container justify-end"><epgu-form-button item=buttons.btnBookByDate click-handler-btn=item.btnBookByDate></epgu-form-button></div></div></div>'),$templateCache.put("js/components/NalogList/NalogList.html",'<div full-path={{::item.fullPath}}><epgu-throbber data-ng-if=item.throbber data-throbber-type=PGU-throbber-big data-show-heading=true data-title={{::item.throbberTitle}} data-msg={{::item.throbberText}}></epgu-throbber><div ng-show="!item.throbber && !!item.visible" class="PGU-{{::item.className}} PGU-LabelWidth-{{::item.labelWidth}} PGU-FieldWidth-{{::item.fieldWidth}} PGU-LabelAlign-{{::item.labelAlign}} {{item.disabled ? \'PGU-Disabled\' : \'\'}} {{item.required ? \'PGU-Required\' : \'\'}} {{item.error ? \'PGU-Error\' : \'\'}} {{item.value ? \'PGU-FieldText-Small-Placeholder\' : \'\'}}" id={{::$id}} ng-attr-style={{::item.inlineCSS}}><advice-like-sf ng-show="!(models.fines && models.fines.length)" title="Задолженностей не найдено" last-updated="{{item.value.requestParams.lastUpdated | convertDate:\'DD.MM.YYYY HH.mm.SS\':\'DD MMMM YYYY, HH:mm\'}}"></advice-like-sf><div class="PGU-FieldTextInput PGU-FieldBody" ng-if="models.fines && models.fines.length"><div class=PGU-FieldBody-outercolumn><div class="PGU-HelperBox PGU-HelperBox-Type-{{::box.type}}" ng-repeat="box in item.helperBox"><h4 class=PGU-HelperBox-Title>{{::box.title}}</h4><div class=PGU-HelperBox-Content ng-bind-html="box.html | to_trusted"></div></div></div><div class=PGU-total-fine-wrap><div class=PGU-total-fine><span>Cумма задолженностей</span> <span><b>{{::models.total}}</b>&nbsp;<nobr class=PGU-rouble>p</nobr></span></div><div class=PGU-last-update ng-if=item.value.requestParams.lastUpdated><span class=PGU-last-update-clock></span> <span class=PGU-last-update-text>Информация актуальна <span class=PGU-nobr>на {{::item.value.requestParams.lastUpdated | convertDate:\'DD.MM.YYYY HH.mm.SS\':\'DD MMMM YYYY, HH:mm\'}}</span></span></div></div><div class=PGU-ticket ng-repeat="fine in models.fines  track by $index | orderBy:\'id\'"><div class=PGU-limiter><div data-ng-if="fine.billSource != \'FK\'"><div class="PGU-sub_title PGU-clear"><span class=PGU-sub-title-text><span class=PGU-float-left>{{ ::(fine.typplat === \'ПЕ\' ? (\'Пени на \' + (fine.vidnalog | decapitalize)) : fine.vidnalog)}} {{ ::(fine.typplat === \'ПЕ\' && fine.srok ? (\' на \' + (fine.srok)) : \'\') }} </span></span><span class="PGU-float-right PGU-money"><span class=PGU-price>{{::fine.summa}}&nbsp;<nobr class=PGU-rouble>p</nobr> </span></span><span data-ng-if="fine.isPaid == 0 && fine.fkNumber" class=PGU-btn_cover_r><a tabindex="{{item.disabled ? -1 : 1}}" ng-href="{{betaUrl + \'payment/\' + fine.fkNumber}}" class="PGU-btn-base PGU-small" target=_blank>Оплатить </a></span><span data-ng-if="fine.isPaid == 1" class="PGU-status PGU-pd">Оплачено</span> <span data-ng-if="fine.isProcessing == 1" class="PGU-status PGU-processing">В обработке</span> <span data-ng-if=!fine.fkNumber class="PGU-status PGU-processing">Оплата<br>невозможна</span></div><dl class=PGU-clear><dd>{{::fine.naim}}</dd></dl><div class=PGU-des-wrap_helper data-ng-if="fine.isPaid == 1"><div><p>Это начисление оплачено. ФНС России обработает ваш платеж в течение 14 дней.</p></div></div><div class=PGU-des-wrap_helper data-ng-if=!fine.fkNumber><div><p>Для оплаты этого начисления недостаточно сведений. Для уточнения данных и оплаты обратитесь в ФНС России (<a href=http://www.nalog.ru/ tabindex=1 target=_blank>www.nalog.ru</a>)</p></div></div></div><div data-ng-if="fine.billSource == \'FK\'"><div class="PGU-sub_title PGU-clear"><span class=PGU-sub-title-text><span>{{::fine.billName}} </span></span><span class="PGU-float-right PGU-money"><span class=PGU-price><b>{{::fine.violationSum}}&nbsp;</b> <nobr class=PGU-rouble>p</nobr> </span></span><span data-ng-if="fine.isPaid == 0 && fine.fkNumber" class=PGU-btn_cover_r><a ng-href="{{betaUrl + \'payment/\' + fine.fkNumber}}" class="PGU-btn-base PGU-small" target=_blank>Оплатить </a></span><span data-ng-if="fine.isPaid == 1" class="PGU-status PGU-pd">Оплачено</span> <span data-ng-if="fine.isProcessing == 1" class="PGU-status PGU-processing">В обработке</span> <span data-ng-if=!fine.fkNumber class="PGU-status PGU-processing">Оплата<br>невозможна</span></div><div class=PGU-clear><dl><dt>Дата выставления счета</dt><dd>{{::fine.billDate}}</dd><dd>{{::fine.billDate}}</dd></dl></div><div class=PGU-des-wrap_helper data-ng-if="fine.isPaid == 1"><p>Это начисление оплачено. ФНС России обработает ваш платеж в течение 14 дней.</p></div><div class=PGU-des-wrap_helper data-ng-if=!fine.fkNumber><p>Для оплаты этого начисления недостаточно сведений. Для уточнения данных и оплаты обратитесь в ФНС России (<a href=http://www.nalog.ru/ tabindex=1 target=_blank>www.nalog.ru</a>)</p></div></div></div></div></div></div></div>'),$templateCache.put("js/components/NavPanel/NavPanel.html",'<div id={{::$id}} ng-show=!!item.visible class=PGU-{{::item.className}} data-ng-class="{\'with-captcha\': $root.env.isNeedCaptcha}" full-path={{::item.fullPath}}><epgu-helper-box ng-if=item.helper item=item.helper></epgu-helper-box><form-tree ng-repeat="item_i in item.items track by $index" item=item_i></form-tree></div>'),$templateCache.put("js/components/OrderListDC/OrderListDC.html",'<div ng-show=!!item.visible full-path={{::item.fullPath}} class=PGU-OrderListDC><div data-ng-show=loading data-ng-include="\'include/throbber.html\'"></div><div data-ng-show="!loading && !isEmptyOrdersList"><h3 class="PGU-title PGU-title_form-step lg-offset-bottom-32 md-offset-bottom-32 sm-offset-bottom-24">Выберите заявление</h3><div data-ng-repeat="order in ordersList"><div class=grid-wrap><div class="grid-wrap__row align-items-center" data-ng-class="{\'lg-offset-top-24 md-offset-top-24\': !$first}"><div class="grid-wrap__col-md-8 grid-wrap__col-sm-6" data-ng-class="{\'grid-wrap__col-lg-13\': !order.notAnswer, \'grid-wrap__col-lg-11\': order.notAnswer}"><div><b>{{order.orderInfo}}</b></div><div>{{order.status}}</div><div data-ng-if=order.Fio>Ф.И.О. ребенка: {{order.Fio}}</div><div data-ng-if=order.birthDate>Дата рождения: {{order.birthDate}}</div></div><div data-ng-show=!order.notAnswer class="grid-wrap__col-lg-4 grid-wrap__col-md-4 grid-wrap__col-sm-6 sm-offset-top-16 sm-offset-bottom-24"><div class=PGU-OrderListDC-CheckBtn-wrap><a class="PGU-Button PGU-Btn-Base PGU-Btn-Small" data-ng-click=order.button.callback(order.order) data-ng-class="{\'DC-Disabled-Button\': order.button.disabled}" data-ng-show=!order.button.loading><span class=PGU-Btn-Text>{{order.button.title}}</span></a><div class=PGU-Btn-Throbber data-ng-show=order.button.loading><epgu-throbber data-throbber-type=PGU-throbber-small></epgu-throbber></div></div></div><div data-ng-show=order.notAnswer class="grid-wrap__col-lg-6 grid-wrap__col-md-4 grid-wrap__col-sm-6 sm-offset-top-16 sm-offset-bottom-24"><div data-sf-compile-html=order.notAnswerMessage></div></div></div></div></div><div data-ng-show=queueInfo.throbber class=PGU-OrderListDC-Result-Block full-path=form.fakeFullPathForQueueDCThrobber><div data-ng-include="\'include/throbber.html\'"></div></div><div data-ng-show=queueInfo.showQueueInfo class="PGU-OrderListDC-Result-Block with-bottom-border" full-path=form.fakeFullPathForQueueDC><h3 class="PGU-title PGU-title_form-step">Информация об очереди</h3><div class=grid-wrap><div class=grid-wrap__row><div class="grid-wrap__col-lg-13 grid-wrap__col-md-12 grid-wrap__col-sm-6 lg-offset-top-32 md-offset-top-16 sm-offset-top-16"><div>Заявление №{{queueInfo.orderId}}.</div><div data-ng-show="!(queueInfo.confirmMessageData && queueInfo.confirmMessageData.title) && queueInfo.actualDateTime">Информация актуальна на {{queueInfo.actualDateTime}}. Вы можете обновить информацию.</div></div><div data-ng-show="queueInfo.confirmMessageData && queueInfo.confirmMessageData.title" class="grid-wrap__col-lg-17 grid-wrap__col-md-12 grid-wrap__col-sm-6 lg-offset-top-16 md-offset-top-16 sm-offset-top-16"><div class=PGU-OrderListDC-Confirm-Info><div><b>{{queueInfo.confirmMessageData.title}}</b></div><div class="lg-offset-top-8 md-offset-top-8 sm-offset-top-8">{{queueInfo.confirmMessageData.comment}}</div><div class="lg-offset-top-8 md-offset-top-8 sm-offset-top-8">Дата получения уведомления: {{queueInfo.confirmMessageData.date}}</div><div data-ng-if=queueInfo.confirmMessageData.showLkLink class="lg-offset-top-8 md-offset-top-8 sm-offset-top-8">За дополнительной информацией вы можете обратиться, отправив сообщение <a data-ng-href="{{$root.lkUrl + \'notifications/details/ORDER/\' + queueInfo.orderId}}">в личном кабинете</a>.</div><div class="lg-offset-top-8 md-offset-top-8 sm-offset-top-16 flex-container justify-end PGU-OrderListDC-CheckBtn-wrap"><a class="PGU-Button PGU-Btn-Base PGU-Btn-Small PGU-Btn-Blue" data-ng-click=changeOrderBtn()><span class=PGU-Btn-Text>Отправить решение</span></a></div></div></div></div><div data-ng-if=queueInfo.kidFio class="grid-wrap__row lg-offset-top-24 md-offset-top-16 sm-offset-top-16"><div class="grid-wrap__col-lg-5 grid-wrap__col-md-4 grid-wrap__col-sm-6"><b>Ф.И.О.</b></div><div class="grid-wrap__col-lg-8 grid-wrap__col-md-8 grid-wrap__col-sm-6 grid-wrap__col-offset-lg-1"><span>{{queueInfo.kidFio}}</span></div></div><div data-ng-if=queueInfo.age class="grid-wrap__row lg-offset-top-16 md-offset-top-16 sm-offset-top-16"><div class="grid-wrap__col-lg-5 grid-wrap__col-md-4 grid-wrap__col-sm-6"><b>Возраст</b></div><div class="grid-wrap__col-lg-8 grid-wrap__col-md-8 grid-wrap__col-sm-6 grid-wrap__col-offset-lg-1"><span>{{queueInfo.age}}</span></div></div><div class="grid-wrap__row lg-offset-top-16 md-offset-top-16 sm-offset-top-16"><div class="grid-wrap__col-lg-5 grid-wrap__col-md-4 grid-wrap__col-sm-6"><b>Желаемая дата зачисления</b></div><div class="grid-wrap__col-lg-8 grid-wrap__col-md-8 grid-wrap__col-sm-6 grid-wrap__col-offset-lg-1"><span>{{queueInfo.entryDate}}</span></div></div><div data-ng-if=queueInfo.groupSpecific class="grid-wrap__row lg-offset-top-16 md-offset-top-16 sm-offset-top-16"><div class="grid-wrap__col-lg-5 grid-wrap__col-md-4 grid-wrap__col-sm-6"><b>Специфика группы</b></div><div class="grid-wrap__col-lg-8 grid-wrap__col-md-8 grid-wrap__col-sm-6 grid-wrap__col-offset-lg-1"><span>{{queueInfo.groupSpecific}}</span></div></div><div data-ng-if=queueInfo.groupType class="grid-wrap__row lg-offset-top-16 md-offset-top-16 sm-offset-top-16"><div class="grid-wrap__col-lg-5 grid-wrap__col-md-4 grid-wrap__col-sm-6"><b>Тип группы</b></div><div class="grid-wrap__col-lg-8 grid-wrap__col-md-8 grid-wrap__col-sm-6 grid-wrap__col-offset-lg-1"><span>{{queueInfo.groupType}}</span></div></div><div data-ng-if=queueInfo.scheduleType class="grid-wrap__row lg-offset-top-16 md-offset-top-16 sm-offset-top-16"><div class="grid-wrap__col-lg-5 grid-wrap__col-md-4 grid-wrap__col-sm-6"><b>Желаемый режим пребывания</b></div><div class="grid-wrap__col-lg-8 grid-wrap__col-md-8 grid-wrap__col-sm-6 grid-wrap__col-offset-lg-1"><span>{{queueInfo.scheduleType}}</span></div></div></div><div data-ng-repeat="queue in queueInfo.queueArr" class="lg-offset-top-32 md-offset-top-24 sm-offset-top-24"><div class=grid-wrap><div class=grid-wrap__row><div class="grid-wrap__col-lg-17 grid-wrap__col-md-12 grid-wrap__col-sm-6"><div>Вы {{queue.NumberInQueue}} в очереди.&nbsp; <span data-ng-if=queue.fullName>{{queue.fullName}}, </span><span data-ng-if=queue.address>{{queue.address}}</span></div><div class=lg-offset-top-8><a href=# class=PGU-OrderListDC-Show-Map data-ng-click=showPopup(queue)>Посмотреть на карте</a></div></div></div></div></div></div><div data-ng-show=queueInfo.showQueueInfo><div class=grid-wrap><div class=grid-wrap__row><div class="grid-wrap__col-lg-4 grid-wrap__col-md-4 grid-wrap__col-sm-6 grid-wrap__col-offset-lg-13 grid-wrap__col-offset-md-8 PGU-OrderListDC-CheckBtn-wrap"><a class="PGU-Button PGU-Btn-Base PGU-Btn-Small" data-ng-click=changeOrderBtn()><span class=PGU-Btn-Text>Изменить заявление</span></a></div></div></div></div></div><div data-ng-if="!loading && isEmptyOrdersList"><div class=grid-wrap><div class=grid-wrap__row><div class="grid-wrap__col-lg-17 grid-wrap__col-md-12 grid-wrap__col-sm-6"><h3 class="PGU-title PGU-title_form-step">Заявлений не найдено</h3><div>Если вы подавали заявление, а сейчас оно не отображается - <a data-ng-href="{{isQueue ? \'/10999/2/form\' : \'/10999/3/form\'}}">проверьте его на предыдущей версии формы</a></div></div></div></div></div><div data-ng-show="!loading && isConfirmScreen && !isConfirmScreenError" class=PGU-OrderListDC-Result-Block full-path=form.fakeFullPathForChooseDC><h3 class="PGU-title PGU-title_form-step">Выбранные детские сады</h3><div class=grid-wrap><div class=grid-wrap__row><div class="grid-wrap__col-lg-13 grid-wrap__col-md-12 grid-wrap__col-sm-6 lg-offset-top-32 md-offset-top-16 sm-offset-top-16"><div><b>{{confirmData.mainTitle}}</b></div><div class="lg-offset-top-16 md-offset-top-16 sm-offset-top-16" data-ng-repeat="main in confirmData.mainDCs"><div>{{main.fullName}}, {{main.address}}</div></div></div><div class="grid-wrap__col-lg-17 grid-wrap__col-md-12 grid-wrap__col-sm-6 lg-offset-top-16 md-offset-top-16 sm-offset-top-16"><div class=PGU-OrderListDC-Confirm-Info><div><b>{{confirmData.title}}</b></div><div class="lg-offset-top-8 md-offset-top-8 sm-offset-top-8">{{confirmData.comment}}</div><div class="lg-offset-top-8 md-offset-top-8 sm-offset-top-8">Дата получения уведомления: {{confirmData.date}}</div><div data-ng-if=confirmData.showLkLink class="lg-offset-top-8 md-offset-top-8 sm-offset-top-8">За дополнительной информацией вы можете обратиться, отправив сообщение <a data-ng-href="{{$root.lkUrl + \'notifications/details/ORDER/\' + confirmData.confirmOrder.id}}">в личном кабинете</a>.</div><div class="lg-offset-top-8 md-offset-top-8 sm-offset-top-16 lg-flex-container md-flex-container"><div><a class="PGU-Button PGU-Btn-Base PGU-Btn-Small PGU-Btn-Blue" data-ng-click=confirmDataBtns.onclickAccess()><span class=PGU-Btn-Text>Согласиться</span></a></div><div class="lg-offset-left-24 md-offset-left-24"><a class="PGU-Button PGU-Btn-Base PGU-Btn-Small" data-ng-click=confirmDataBtns.onclickCancel()><span class=PGU-Btn-Text>Отказаться</span></a></div></div></div></div><div data-ng-if=confirmData.alterTitle class="grid-wrap__col-lg-13 grid-wrap__col-md-12 grid-wrap__col-sm-6 lg-offset-top-32 md-offset-top-16 sm-offset-top-16"><div><b>{{confirmData.alterTitle}}</b></div><div class="lg-offset-top-16 md-offset-top-16 sm-offset-top-16" data-ng-repeat="alt in confirmData.alterDCs"><div>{{alt.fullName}}, {{alt.address}}</div></div></div></div></div></div><advice-simple-sf data-ng-if="!loading && isConfirmScreenError" title={{advice.title}} type=PGU-Advice-Type_Not>{{advice.message}}</advice-simple-sf><script type=text/ng-template id=include/throbber.html><epgu-throbber\n                data-throbber-type="PGU-throbber-big"\n                data-show-heading="true"\n                data-title="{{throbber.title}}"\n                data-msg="{{throbber.text}}"></epgu-throbber><\/script></div>'),$templateCache.put("js/components/Panel/Panel.html",'<div ng-show=!!item.visible ng-attr-style={{::item.inlineCSS}} class={{::panelClass}} id={{::$id}} full-path={{::item.fullPath}}><div class=PGU-Panel-inner data-ng-class="{\'closed\': (item.isAccordionMode && !opened),\n                                                 \'PGU-Panel-Accordion-Error\': (item.isAccordionMode && accordionError),\n                                                 \'PGU-Panel-Accordion-First\': (item.isAccordionMode && item.clonable)}"><div class=PGU-Panel-actions ng-if="!item.disabled && !item.removeBtnHidden && item.isClone"><a ng-click=removeClone() class="PGU-Link PGU-Link-pseudo PGU-Panel-action-remove js-PGU-Panel-action-remove"><span class="PGU-Icon PGU-Icon-remove"></span> <span class=PGU-Link-Text>{{(item.fullPath + \'.cloneButtonNameRemove\' | translate:\'Удалить данные\') || \'Удалить данные\'}}</span></a></div><div class="PGU-Panel-Title-box flex-container justify-between {{::titleBoxClass}}" data-ng-if="::(item.title || item.mnemonicHint || item.hasEsiaHint)" data-ng-click=openBlock($event)><div data-ng-if=item.title class=PGU-Panel-title-Wrap><h4 class=PGU-Panel-title ng-bind-html="((item.fullPath + \'.title\' | translate:item.title) | to_trusted) || item.title | to_trusted"></h4></div><div data-ng-if="!item.title && item.html && (item.mnemonicHint || item.hasEsiaHint)" class=PGU-Panel-html_With-Hint-Wrap><div class=pgu-panel-html ng-bind-html="((item.fullPath + \'.title\' | translate:item.title) | to_trusted) || item.title | to_trusted"></div></div><div data-ng-if=::item.isAccordionMode class=PGU-Panel-Accordion-Toggle><div class=PGU-Panel-Accordion-Toggle-Wrap><span class="Sort-Field PGU-Link" data-ng-if=::!$root.device.mobile>{{!opened ? ((item.fullPath + \'.openAccordionTitle\' | translate:item.openAccordionTitle) || item.openAccordionTitle) : ((item.fullPath + \'.closeAccordionTitle\' | translate:item.closeAccordionTitle) || item.closeAccordionTitle)}} </span><span class="PGU-Link-with-toggle-arrow {{::($root.device.mobile ? \'Arrow-Gray\' : \'\')}}" data-ng-class="{\'PGU-Link-with-toggle-arrow-up\': opened}"></span></div></div><question ng-if="::((!$root.device.mobile && item.hasEsiaHint) || item.mnemonicHint)" item=item></question></div><div data-ng-if="item.html && !item.mnemonicHint && !item.hasEsiaHint" class=pgu-panel-html ng-bind-html="item.html | to_trusted"></div><div class="ITEMS_CONTAINER cf" ng-if="::(!$root.isDesigner && item.items)"><div data-ng-if=::rendered><div data-ng-show="(!item.shaded && !accordionShade) && (!item.isAccordionMode || (item.isAccordionMode && opened))"><form-tree ng-if=::item.isCloneContainer ng-repeat="item_i in item.items" item=item_i></form-tree><form-tree ng-if=::!item.isCloneContainer ng-repeat="item_i in ::item.items" item=item_i></form-tree></div></div><div class=ITEMS_CONTAINER data-ng-if="(item.shaded && !item.clonable && !item.isClone) || accordionShade"><epgu-throbber data-throbber-type=PGU-throbber-big></epgu-throbber></div></div><div class="ITEMS_CONTAINER cf" ng-if="$root.isDesigner && item.items"><div data-ng-show=!item.shaded><form-tree ng-repeat="item_i in item.items" item=item_i></form-tree></div><div class=ITEMS_CONTAINER data-ng-show="item.shaded && !item.clonable && !item.isClone"><div class="throbber-svg PGU-throbber-window"><div class=PGU-throbber-big> <?xml version="1.0" encoding="utf-8"?> <svg version=1.1 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink x=0px y=0px width=104px height=104px viewBox="0 0 92 100" enable-background="new 0 0 92 100" xml:space=preserve><path fill=#00aadd class=throbber-path d="M81.765,82.649L56.607,97.19c-6.479,3.744-14.462,3.746-20.942,0.01L10.493,82.682\n                        C4.012,78.944,0.017,72.032,0.014,64.549L0,35.493c-0.003-7.482,3.985-14.398,10.463-18.141L35.621,2.811\n                        c6.478-3.744,14.46-3.748,20.943-0.011l25.171,14.519c6.481,3.738,10.476,10.648,10.479,18.131l0.014,29.059\n                        C92.231,71.989,88.244,78.905,81.765,82.649"></path></svg></div></div></div></div></div><div ng-if="item.isLastClone && !item.addBtnHidden && !item.isMaxClone && item.visible !== false" class="PGU-Panel-cloneButton cf"><div class="PGU-BtnHolder PGU-BtnContainer-column"><div class=PGU-Btn-margin><a ng-click=addClone() tabindex=1 ng-if=item.cloneButtonName ng-href="" class="PGU-Button PGU-Panel-action-clone PGU-Btn-Base PGU-Btn-Add PGU-Btn-Small PGU-Btn-White" action="">{{(item.fullPath + \'.cloneButtonName\' | translate:item.cloneButtonName) || item.cloneButtonName}} </a><a ng-click=addClone() tabindex=1 ng-if=!item.cloneButtonName ng-href="" class="PGU-Button PGU-Panel-action-clone PGU-Btn-Base PGU-Btn-Small PGU-Btn-Add PGU-Btn-White" action=""><span>{{!item.title && $root.device.mobile ? ((item.fullPath + \'.cloneButtonName\' | translate:"Добавить") || "Добавить") : ((item.fullPath + \'.cloneButtonName\' | translate:item.title) || item.title)}}</span></a></div></div></div><question ng-if="::($root.device.mobile && item.hasEsiaHint)" item=item></question></div>'),
$templateCache.put("js/components/PanelWorkActivity/PanelWorkActivity.html",'<div ng-show=!!item.visible full-path={{::item.fullPath}}><div class="PGU-Panel PGU-PanelWorkActivity PGU-LabelWidth-{{::item.labelWidth}} PGU-Panel-GridWidth-{{::item.gridWidth}} PGU-Panel-GridWidth_palm-{{::item.gridWidthMobile}} PGU-Panel-GridWidth_lap-{{::item.gridWidthTablet}} PGU-Panel-Width-{{::item.width}} {{item.hideOnMobile ? \'PGU-Control-HideOnMobile\' : \'\'}} {{item.hideOnDesktop ? \'PGU-Control-HideOnDesktop\' : \'\'}} {{item.isGrid ? \'PGU-Panel-Grid\' : \'\'}} {{item.isGridItem ? \'PGU-Panel-Grid-Item\' : \'\'}} {{item.withRadioButton ? \'PGU-Panel-WithRadioBtn\' : \'\'}} {{item.inRightPlace ? \'PGU-Panel-inRightPlace\' : \'\'}} {{$root.settings.mobOptimizeWorkActivity ? \'PGU-PanelWorkActivity_mob-optimize\' : \'\'}}"><div class=PGU-Additional-Wrap><div class="PGU-InformBanner PGU-InformBanner-Warn"><span class="PGU-Icon PGU-Icon-Banner"></span><h4 class=PGU-InformBanner-Title>Внимание!</h4><div class=PGU-InformBanner-Content><p>Трудовая деятельность заполняется в&nbsp;соответствии с&nbsp;записями в&nbsp;трудовой книжке, а&nbsp;также включая учебу в&nbsp;учебных заведениях и&nbsp;военную службу, без сокращений. Юридические адреса работ указываются полностью.</p></div></div><div class=PGU-Additional><div class="PGU-Additional-Info js-PGU-Additional-Info" interval-scroll-to=item.scrollTo><div class=PGU-Chart-Wrap><div class="PGU-Chart-Area js-PGU-Chart-Area"><circular-progress filled="item.chartIntervals | intervalFilled:\'month\'" all=item.validPeriod*12></circular-progress></div></div><div class=PGU-Additional-Info-Progress-Wrap><div class=PGU-Additional-Info-Progress><span class="PGU-Icon PGU-Icon-Info-Progress PGU-Icon-done"></span> <strong class=PGU-Status-text>Вы заполнили: </strong><span class="PGU-Additional-Info-Done js-PGU-Additional-Info-Done">{{ item.chartIntervals | intervalFilled}}</span></div><div class=PGU-Additional-Info-Progress><span class="PGU-Icon PGU-Icon-Info-Progress PGU-Icon-inprogress"></span> <strong class=PGU-Status-text>Осталось заполнить: </strong><span class="PGU-Additional-Info-InProgress js-PGU-Additional-Info-InProgress">{{ item.chartIntervals | intervalNotFilled}}</span></div></div><div class=PGU-Additional-Info-Text ng-if="item.chartIntervals.invalid && item.chartIntervals.invalid.length"><h4 class=PGU-Additional-Info-Text-Title>Дополнительная информация</h4><div class="PGU-Additional-Info-Messages js-PGU-Additional-Info-Messages"><div class=PGU-Additional-Info-Message ng-repeat="period in item.chartIntervals.invalid">Вы не заполнили промежуток:<br>с {{period.start | intervalDate:\'start\'}} по {{period.end | intervalDate:\'end\'}}</div></div></div></div></div></div><div class=PGU-Panel-inner><div ng-if="!ui.isMobile || !$root.settings.mobOptimizeWorkActivity && ui.isMobile"><h4 class=PGU-Panel-title ng-if=item.title ng-bind-html="item.title | to_trusted"></h4><div class=PGU-PanelWorkActivity-Legend><ul class=PGU-PanelWorkActivity-Legend-List><li class=PGU-PanelWorkActivity-Legeng-Item><span class="PGU-Icon PGU-Icon-PanelWorkActivity PGU-Icon-work"></span> <span class=PGU-PanelWorkActivity-Legeng-Item-Text>Работа</span></li><li class=PGU-PanelWorkActivity-Legeng-Item><span class="PGU-Icon PGU-Icon-PanelWorkActivity PGU-Icon-edu"></span> <span data-ng-if=!$root.settings.mobOptimizeWorkActivity class=PGU-PanelWorkActivity-Legeng-Item-Text>Учеба (в&nbsp;строке &laquo;Ваша должность/статус/звание&raquo; нужно писать&nbsp;&mdash; &laquo;студент&raquo;)</span> <span data-ng-if=$root.settings.mobOptimizeWorkActivity class=PGU-PanelWorkActivity-Legeng-Item-Text>Учеба</span></li><li class=PGU-PanelWorkActivity-Legeng-Item><span class="PGU-Icon PGU-Icon-PanelWorkActivity PGU-Icon-military"></span> <span class=PGU-PanelWorkActivity-Legeng-Item-Text>Военная служба</span></li><li class=PGU-PanelWorkActivity-Legeng-Item><span class="PGU-Icon PGU-Icon-PanelWorkActivity PGU-Icon-other"></span> <span data-ng-if=!$root.settings.mobOptimizeWorkActivity class=PGU-PanelWorkActivity-Legeng-Item-Text>Иное (в&nbsp;случае, если по&nbsp;каким-либо причинам вы&nbsp;не&nbsp;работали более 1&nbsp;месяца, необходимо указать данную информацию отдельной записью, при этом в&nbsp;поле &laquo;Адрес&raquo; указать адрес постоянного места жительства за&nbsp;указанный период, а&nbsp;в&nbsp;поле &laquo;Ваша должность/статус/звание&raquo;&nbsp;&mdash; значение &laquo;Не&nbsp;работал(а)&raquo;)</span> <span data-ng-if=$root.settings.mobOptimizeWorkActivity class=PGU-PanelWorkActivity-Legeng-Item-Text>Не работающий (иное)<br>{{ui.isNotSelf ? \'Такой вид деятельности указывается, если по каким-либо причинам человек не работал более 1 месяца\' : \'Такой вид деятельности указывается, если по каким-либо причинам вы не работали более 1 месяца\'}}</span></li></ul></div><div class=pgu-panel-html ng-bind-html="item.html | to_trusted"></div><div class="ITEMS_CONTAINER PGU-PanelWorkActivity-ITEMS_CONTAINER" ng-if=item.items><form-tree ng-repeat="item_i in item.items track by $index" item=item_i></form-tree></div><div class=PGU-Additional-Info-Text-notDesktop ng-if="item.chartIntervals.invalid && item.chartIntervals.invalid.length"><h4 class=PGU-Additional-Info-Text-Title>Дополнительная информация</h4><div class="PGU-Additional-Info-Messages js-PGU-Additional-Info-Messages"><div class=PGU-Additional-Info-Message ng-repeat="period in item.chartIntervals.invalid">Вы не заполнили промежуток:<br>с {{period.start | intervalDate:\'start\'}} по {{period.end | intervalDate:\'end\'}}</div></div></div></div><div ng-if="$root.settings.mobOptimizeWorkActivity && ui.isMobile"><div class=PGU-PanelWorkActivity-Legend ng-if=!item.chartIntervals.status><h4 class=PGU-Panel-title ng-if=item.title ng-bind-html="item.title | to_trusted"></h4><p>Добавляйте записи о{{ui.isNotSelf ? \' \' : \' вашей \'}}деятельности в любом порядке согласно трудовой книжке. Используйте следующие виды деятельности:</p><ul class=PGU-PanelWorkActivity-Legend-List><li class=PGU-PanelWorkActivity-Legeng-Item><span class="PGU-Icon PGU-Icon-PanelWorkActivity PGU-Icon-work"></span> <span class=PGU-PanelWorkActivity-Legeng-Item-Text>Работа</span></li><li class=PGU-PanelWorkActivity-Legeng-Item><span class="PGU-Icon PGU-Icon-PanelWorkActivity PGU-Icon-edu"></span> <span class=PGU-PanelWorkActivity-Legeng-Item-Text>Учеба</span></li><li class=PGU-PanelWorkActivity-Legeng-Item><span class="PGU-Icon PGU-Icon-PanelWorkActivity PGU-Icon-military"></span> <span class=PGU-PanelWorkActivity-Legeng-Item-Text>Военная служба</span></li><li class=PGU-PanelWorkActivity-Legeng-Item><span class="PGU-Icon PGU-Icon-PanelWorkActivity PGU-Icon-other"></span> <span class=PGU-PanelWorkActivity-Legeng-Item-Text>Не работающий (иное)<p ng-if=!ui.isNotSelf>Такой вид деятельности указывается, если по каким-либо причинам вы не работали более 1 месяца</p><p ng-if=ui.isNotSelf>Такой вид деятельности указывается, если по каким-либо причинам человек не работал более 1 месяца</p></span></li></ul></div><div class=PGU-Additional-Info-Text-notDesktop ng-if=item.chartIntervals.status ng-class="{\n                                    \'PGU-PanelWorkActivity-expect\': item.chartIntervals.status == \'expect\',\n                                    \'PGU-PanelWorkActivity-full\': item.chartIntervals.status == \'full\'\n                                }"><div class="PGU-Additional-Info-Messages flex-container"><div class=PGU-Additional-Info-Messages__icon-wrap><span class=PGU-Additional-Info-Messages__icon></span></div><div class=PGU-Additional-Info-Messages__text-wrap><div ng-if="item.chartIntervals.status == \'full\'">Трудовая деятельность успешно заполнена</div><div ng-if="item.chartIntervals.status == \'expect\'">Осталось заполнить:<div class=PGU-Additional-Info-Message ng-repeat="period in item.chartIntervals.invalid">с {{period.start | intervalDate:\'start\'}} по {{period.end | intervalDate:\'end\'}}</div></div></div></div></div><div class=pgu-panel-html ng-bind-html="item.html | to_trusted"></div><epgu-form-button item=ui.btnShowDialog click-handler-btn=ui.toggleModalVisible click-attr=(true)></epgu-form-button><div class=PGU-FieldError data-ng-if=item.chartIntervals.error>Поле обязательно для заполнения</div><div data-ng-class="{\'stateClear\': ui.state == \'clear\'}"><modal-dialog show=ui.modalShow hide-modal=ui.toggleModalVisible(false) optimization-for-mobile=ui.isMobile><div class="flex-container flex-column PGU-PanelWorkActivity-Dialog_version_flex"><div class=PGU-PanelWorkActivity-Dialog__Header><div data-ng-class="{\n                                        \'flex-container \': true,\n                                        \'PGU-PanelWorkActivity-Dialog__Header-Actions\': true,\n                                        \'PGU-PanelWorkActivity-Dialog__Header-Actions_action_show-list\': ui.state == \'input\' && item.list && item.list.length\n                                    }"><div class=PGU-Popup-ShowList data-ng-click=ui.showList()><a data-ng-href="" class=PGU-Link>Посмотреть список</a></div><b class=PGU-Popup-Button-Close data-ng-click="ui.toggleModalVisible(false); $event.stopPropagation(); $event.preventDefault();"></b></div><div class=PGU-Chart-Area data-ng-click=ui.showList()><line-progress intervals=item.chartIntervals all=item.validPeriod></line-progress></div></div><div class=PGU-PanelWorkActivity-Dialog__Body><div data-ng-class="{\n                                        \'PGU-Popup-PanelWorkActivity\': true,\n                                        \'grid-wrap\': true,\n                                        \'grid-wrap_width_default\': ui.state != \'input\',\n                                        \'PGU-Popup-PanelWorkActivityContent-mode-fixed\': !item.chartIntervals.status &&  ui.state == \'input\'\n                                    }"><div data-ng-class="\n                                    {\n                                        \'PGU-Popup-PanelWorkActivityContent\': true,\n                                        \'grid-wrap__row\': true\n\n                                    }\n                                "><div ng-show="ui.state == \'input\'" data-ng-class="\n                                        {\n                                            \'grid-wrap__col-sm-6\': true,\n                                            \'PGU-Popup-PanelWorkActivityInputs\': true,\n\n                                        }\n                                    "><div class="ITEMS_CONTAINER PGU-PanelWorkActivity-ITEMS_CONTAINER PGU-PanelWorkActivity_sm-width-full" data-ng-if=item.items><form-tree ng-repeat="item_i in item.items track by $index" item=item_i></form-tree></div></div><div ng-show="ui.state != \'input\'" class="PGU-Popup-PanelWorkActivityList grid-wrap__col-sm-6"><h3 class=PGU-Service-h3>Список записей о трудовой деятельности</h3><ul class=PanelWorkActivityList-items><li class=PanelWorkActivityList-Item ng-repeat="listItem in item.list track by $index"><div>{{listItem.startMonth.text_value}} {{listItem.startYear.text_value}} — {{listItem.endMonth.text_value}} {{listItem.endYear.text_value}}</div><div class=PanelWorkActivityList-ItemType><span class="PGU-Icon PGU-Icon-PanelWorkActivity PGU-Icon-{{listItem.activity.icon}}"></span> <span class=PGU-PanelWorkActivity-Legeng-Item-Text>{{listItem.activity.text}}</span></div><div class=PanelWorkActivityList-ItemType_last>{{listItem.pos}}</div><a data-ng-href="" class=deleteWorkActivity data-ng-click=ui.deleteFromList($index)><span class=PGU-deleteWorkActivity__text>Удалить запись</span></a></li></ul></div><div class="PGU-Popup-PanelWorkActivityClean grid-wrap__col-sm-6"><div class=modal-clear-confirm><p class=plain-text-bold>Подтверите удаление всех записей о трудовой деятельности</p><p>Данное действие невозможно будет отменить.</p><a data-ng-href="" class="PGU-Button PGU-Btn-Base PGU-Btn-Blue" data-ng-click=ui.btnConfirmClearAll.clickHandler()>{{ui.btnConfirmClearAll.label}}</a> <a data-ng-href="" class="PGU-Button PGU-Btn-Base PGU-Btn-White" data-ng-click=ui.btnCancelClearAll.clickHandler()>{{ui.btnCancelClearAll.label}}</a></div></div><div data-ng-if="item.chartIntervals.status && ui.state !== \'clear\'" data-ng-class="{\n                                    \'grid-wrap__col-sm-6\': true,\n                                    \'PGU-Additional-Info-Text-notDesktop\': true,\n'+"                                    'PGU-Additional-Info-Text-notDesktop-mode-fixed': ui.btnAddWork.show && ui.state !== 'input',\n                                    'PGU-PanelWorkActivity-expect': item.chartIntervals.status == 'expect',\n                                    'PGU-PanelWorkActivity-full': item.chartIntervals.status == 'full'\n                                }\"><div class=\"PGU-Additional-Info-Messages flex-container\"><div class=PGU-Additional-Info-Messages__icon-wrap><span class=PGU-Additional-Info-Messages__icon></span></div><div class=PGU-Additional-Info-Messages__text-wrap><div ng-if=\"item.chartIntervals.status == 'full'\">Трудовая деятельность успешно заполнена</div><div ng-if=\"item.chartIntervals.status == 'expect'\">Осталось заполнить:<div class=PGU-Additional-Info-Message ng-repeat=\"period in item.chartIntervals.invalid\">с {{period.start | intervalDate:'start'}} по {{period.end | intervalDate:'end'}}</div></div></div></div></div></div></div></div><div class=PGU-PanelWorkActivity-Dialog__Footer><div ng-if=\"ui.state !== 'clear'\"><div class=PGU-Popup-AddBtn data-ng-class=\"{\n                                        'fixed' : ui.state == 'input',\n                                        'PGU-Popup-AddBtn-mode-fixed' : ui.btnAddWork.show,\n                                        'list': ui.state == 'list',\n                                        'full': item.chartIntervals.full\n                                        }\"><div data-ng-if=\"ui.state == 'list'\" class=\"flex-container grid-wrap grid-wrap_width_default align-items-center justify-between\"><div><a data-ng-href=\"\" ng-if=!item.chartIntervals.full class=\"PGU-Button PGU-Btn-Base PGU-Btn-White PGU-Btn-Base-mode-link\" ng-click=ui.btnClearPopup.clickHandler()>{{ui.btnClearPopup.label}}</a></div><div><a data-ng-href=\"\" class=\"PGU-Button PGU-Btn-Base PGU-Btn-Blue\" data-ng-click=ui.btnAddWork.clickHandler() ng-show=ui.btnAddWork.show>{{ui.btnAddWork.label}}</a></div></div><div data-ng-if=\"ui.state == 'input'\" class=\"grid-wrap grid-wrap_width_default\"><div data-ng-if=\"ui.state == 'input'\" class=grid-wrap__row><div class=grid-wrap__col-sm-6><a data-ng-href=\"\" class=\"PGU-Button PGU-Btn-Base PGU-Btn-Blue\" data-ng-click=ui.btnAddWork.clickHandler() ng-show=ui.btnAddWork.show>{{ui.btnAddWork.label}}</a></div></div></div></div></div></div></div></modal-dialog></div></div></div></div></div>"),$templateCache.put("js/components/Payment/Payment.html",'<div class=PGU-Payment full-path={{::item.fullPath}} ng-show=!!item.visible data-ng-class="{\'error\': item.errorLoad}"><div class=b-error><div><p>При получении реквизитов оплаты пошлины произошла ошибка.</p><p>Попробуйте обновить страницу или обратитесь в службу поддержки. Ваш черновик автоматически сохранен.</p></div></div><div data-ng-if=!item.fetched><div class=x-not-fetch><p>При получении реквизитов оплаты пошлины произошла ошибка.</p><p>Попробуйте обновить страницу или обратитесь в службу поддержки. Ваш черновик автоматически сохранен.</p></div></div><div data-ng-if=item.fetched class=b-list-payment data-ng-class="{\'x-loading-pay\': !item.loading}"><div class=b-list-payment__item data-ng-show=item.loading><div class="b-list-payment__item-title e-span">{{uiPaymentModel.attr.recipientTitle}}<span data-ng-if=uiPaymentModel.attr.recipientPaymentAccount>&nbsp;(л/с: {{uiPaymentModel.attr.recipientPaymentAccount}} )</span></div><div class="b-list-payment__item-target e-span">{{uiPaymentModel.attr.paymentPurpose}}</div><div class="b-list-payment__item-sum e-span" data-ng-if=uiPaymentModel.attr.sum><br>{{(uiPaymentModel.attr.sum) | floor}}<nobr class=rouble>p</nobr><br><span class=x-old-price data-ng-if=uiPaymentModel.attr.originalSum>{{(uiPaymentModel.attr.originalSum) | floor}}<nobr class=rouble>p</nobr><div class=line-through></div></span></div><div class="b-list-payment__item-status e-span" data-ng-class="{\'x-loading-check-status\': !item.checked, \'done\': uiPaymentModel.attr.status}"><span data-ng-if=uiPaymentModel.attr.status>платеж принят</span> <span data-ng-if=!uiPaymentModel.attr.status>не оплачено</span></div><a data-ng-if="!uiPaymentModel.attr.status && item.checked" data-ng-click=initPayment() class="b-list-payment__item-button e-span" data-ng-if=uiPaymentModel.attr.status>Перейти к оплате</a></div></div><div data-ng-if="discountEnabled && item.fetched" class="PGU-HelperBox PGU-HelperBox-FormStep PGU-HelperBox-Type-{{item.sale.class}}"><h4 class=PGU-HelperBox-Title>{{item.sale.title}}</h4><div class=PGU-HelperBox-Content ng-bind-html=item.sale.text></div></div></div>'),$templateCache.put("js/components/PreviewGEPSMail/PreviewGEPSMail.html","<div data-ng-show=\"(!!item.visible && item.showClone !== true)\" id={{::$id}} full-path={{::item.fullPath}}><div data-ng-if=::!item.isComplete data-ng-attr-style={{::item.inlineCSS}} data-ng-class=\"{\n            'PGU-{{::item.className}}': true,\n            'editor-item-selected': item.currentItem,\n            'editor-item-hovered': item.hoverItem,\n            'PGU-Disabled': item.disabled,\n            'PGU-Required': item.required,\n            'PGU-Error': item.error\n"+'        }"><div data-ng-if=item.loading><epgu-throbber data-throbber-type=PGU-throbber-small></epgu-throbber></div><div data-ng-if="!item.loadError && !item.loading"><div class="flex-container md-grid-wrap__row sm-grid-wrap__row sm-align-items-start"><span data-ng-if=item.message.isLegal class="EPGU-PreviewGEPSMail__flag EPGU-PreviewGEPSMail__flag_red EPGU-PreviewGEPSMail__flag_geps-message"></span><div class="statuses-list__geps-message-header grid-wrap__col-md-11 grid-wrap__col-md-land-17 grid-wrap__col-sm-5"><h4 class="EPGU-PreviewGEPSMail__InnerSubtitle sm-offset-bottom-4">{{item.message.addParams.inner_subtitle}}</h4><div class=EPGU-PreviewGEPSMail__InnerTitle>{{item.message.sendDateMilliseconds | date:\'dd.MM.yyyy\'}}, {{item.message.sendDateMilliseconds | date:\'HH:mm\'}} от: {{item.message.addParams.inner_title}}</div></div></div><div class=EPGU-PreviewGEPSMail__Text ng-bind-html=item.message.text></div><div data-ng-if="!isNotification && item.message.attachments && item.message.attachments.length"><div class="EPGU-PreviewGEPSMail__attach flex-container align-items-center" data-ng-repeat="attach in item.message.attachments"><div class=EPGU-PreviewGEPSMail__attach-icon></div><div class=EPGU-PreviewGEPSMail__attach-name>{{attach.fileName}}</div><div class=EPGU-PreviewGEPSMail__attach-size>{{attach.fileSize | filterFileSize}}</div></div><a class="PGU-Button PGU-Button-Choose PGU-Btn-Base PGU-Btn-Small PGU-Btn-Blue" data-ng-href={{storageUrl}} target=_blank download>Скачать все файлы</a></div><div data-ng-if=isNotification><a class="PGU-Button PGU-Button-Choose PGU-Btn-Base PGU-Btn-Small PGU-Btn-Blue" data-ng-href={{storageUrl}} target=_blank download>Скачать уведомление</a></div><div data-ng-if=isNotification><div class="PGU-HelperBox PGU-HelperBox-Type-important" ng-attr-style="width:  {{item.width ? item.width + \'px\' : \'auto\'}}; height: {{item.height ? item.height + \'px\' : \'auto\'}}"><h4 class=PGU-HelperBox-Title>Внимание</h4><div class="PGU-HelperBox-Content PGU-HelperBox-Content">Скачайте уведомление, подпишите его и загрузите поле «Электронные документы». Сформированный файл подписи загрузите в поле «Электронная подпись».</div></div></div><div data-ng-if=!isNotification><div class="PGU-HelperBox PGU-HelperBox-Type-important" ng-attr-style="width:  {{item.width ? item.width + \'px\' : \'auto\'}}; height: {{item.height ? item.height + \'px\' : \'auto\'}}"><h4 class=PGU-HelperBox-Title>Внимание</h4><div class="PGU-HelperBox-Content PGU-HelperBox-Content">Скачайте вложенные файлы, подпишите каждый файл отдельно, все подписанные файлы и файл с подписью добавьте в архив, подпишите архив и загрузите в поле «Электронные документы». Сформированный файл подписи архива загрузите в поле «Электронная подпись».</div></div></div></div><div data-ng-if="item.loadError && !item.loading">Ошибка получения данных</div></div></div>'),$templateCache.put("js/components/SMSConfirmDialog/SMSConfirmDialog.html","<div id={{::$id}} data-ng-show=!!item.visible class=PGU-{{::item.className}} full-path={{::item.fullPath}}><modal-dialog show=item.visible hide-modal=toggleModalVisible(false) hide-close-popup-btn=true><div data-ng-include src=popup.tpl></div></modal-dialog></div>"),$templateCache.put("js/components/StateStructure/StateStructure.html",'<div ng-show=!!item.visible id={{::$id}} full-path={{::item.fullPath}}><div class=PGU-StateStructure><div class=PGU-StateStructure-Img-Wrap ng-if=item.imgSrc><img class="PGU-StateStructure-Img js-PGU-StateStructure-Img" ng-src={{::item.imgSrc}} alt="{{ ::item.altText }}"></div><h4 class="PGU-StateStructure-Title js-PGU-StateStructure-Title">{{ ::item.title }}</h4><div class="PGU-StateStructure-Text js-PGU-StateStructure-Text" ng-bind-html="::item.text | to_trusted"></div></div></div>'),$templateCache.put("js/components/Table/Table.html",'<div ng-show=!!item.visible class=PGU-Table full-path={{item.fullPath}}><div ng-if=!isMobile><div class=PGU-Table-Header ng-if="item.titles && item.titles.length"><div class="PGU-Table-Cell plain-text-bold" ng-repeat="title in item.titles" ng-bind-html=title.obj></div></div><div class="PGU-Table-Row plain-text" ng-repeat="row in item.rows" ng-if="row && row.length"><div ng-repeat="item in row track by $index"><form-tree item=item></form-tree></div></div></div><div ng-if=isMobile class=mobile><div ng-if="row && row.length" class=PGU-Table-Row ng-repeat="row in item.rows"><div ng-repeat="element in row track by $index" ng-show="element && element.text"><div ng-if="item.titles && item.titles[$index].obj" class="PGU-Table-Header plain-text-bold" ng-bind-html=item.titles[$index].obj></div><form-tree item=element></form-tree></div></div></div></div>'),$templateCache.put("js/components/TableDictionary/TableDictionary.html",'<div ng-show=(!!item.visible) class="PGU-TableDictionary PGU-TableDictionary-Container" full-path={{item.fullPath}}><div ng-if=!isMobile><div ng-if="item.columns && item.columns.length" class=PGU-TableDictionary-Titles-Container><div class="PGU-TableDictionary-Titles PGU-TableDictionary-Col-Width-{{item.widths[$index]}}" ng-repeat="col in item.columns" ng-bind-html=col></div></div><div ng-if="item.tableContent && item.tableContent.length && !item.isEmpty" class=PGU-TableDictionary-Content><a class="PGU-TableDictionary-Item-Show-More PGU-TableDictionary-Col-Width-100" ng-if="item.navigation && item.currentLabel > item.tableStep" ng-click="item.current = item.currentLabel = (item.current - item.tableStep) > 0 ? item.current - item.tableStep : 0">Посмотреть еще {{(item.currentLabel - (item.tableStep * 2)) > 0 ? item.tableStep : item.currentLabel - item.tableStep}} из {{item.currentLabel - item.tableStep}}</a><div ng-repeat="row in item.tableContent" ng-show="($index >= (item.current - item.tableStep)) || !item.navigation" class=PGU-TableDictionary-Items-Container><div class="PGU-TableDictionary-Item PGU-TableDictionary-Col-Width-{{item.widths[$index]}}" ng-repeat="it in row">{{it}}</div></div></div></div><div ng-if=isMobile class=PGU-TableDictionary-Mobile><div ng-if="item.tableContent && item.tableContent.length && !item.isEmpty" class=PGU-TableDictionary-Content><div ng-repeat="row in item.tableContent" ng-show="($index >= (item.current - item.tableStep)) || !item.navigation" class=PGU-TableDictionary-Items-Container><div data-ng-click="showList = !showList" ng-init="$last ? showList = false : showList = true" data-ng-class="{\'opened\' : !showList, \'closed\' : showList}" class=tabs><span class=PGU-TableDictionary-Titles>{{item.columns[item.primaryTitle]}} {{row[item.primaryKey]}}</span></div><div ng-show=!showList data-ng-click="showList = !showList" data-ng-class="{\'first-of-type\' : $first,  \'last-of-type\' : $last}" class=tabs><div ng-repeat="it in row"><div class="PGU-TableDictionary-Titles PGU-TableDictionary-Col-Width-100" ng-if="item.columns[$index] != item.columns[item.primaryTitle]">{{item.columns[$index]}}</div><div class="PGU-TableDictionary-Item PGU-TableDictionary-Col-Width-100" ng-if="it != row[item.primaryKey]">{{it}}</div></div></div></div></div></div><div ng-if=item.isEmpty class=PGU-TableDictionary-Empty><strong>Запрос не дал результатов</strong></div></div>'),
$templateCache.put("js/components/TimeSlotExt/TimeSlotExt.html","<div id={{::$id}} ng-show=(!!item.visible) full-path={{::item.fullPath}}><div ng-attr-style={{::item.inlineCSS}} class=\"PGU-{{::item.className}} cf PGU-TimeSlotExtState{{ui.saveBookIdMode.actionsState}}\" ng-class=\"{\n        'PGU-Disabled'                      : item.disabled,\n        'PGU-Required'                      : item.required,\n        'PGU-Error'                         : item.error,\n        'PGU-TimeSlotExtEmptySlotsResponse' : models.isEmpty,\n        'PGU-Panel-TimeSlotExt-loading'     : models.isLoading,\n        'PGU-TimeSlotExtShowShowChart'      : ui.saveBookIdMode.showChart,\n        'TimeSlotWithDatePicker': item.datePickerMode,\n        'PGU-TimeSlotExtStateWithPayment' : ui.hasPayment,\n        'PGU-TimeSlotExt_mob-optimize' : $root.settings.mobOptimizeEqueue,\n        'PGU-OP-TimeSlot': !!$root.iframeDeviceHeight,\n        'PGU-TimeSlotExt-ClinicMode': item.clinicExamMode\n    }\"><h3 ng-if=item.title class=\"PGU-TimeSlotExtMainTitle js-PGU-TimeSlotExtMainTitle\">{{::item.title}}</h3><div data-ng-if=!item.clinicExamMode data-ng-class=\"{'PGU-TimeSlotExtTopSideWrap' : ui.fetched || !item.datePickerMode,  'PGU-TimeSlotExtTopWithTimer' : item.saveBookIdToDraft}\"><div data-ng-if=item.datePickerMode class=PGU-TimeSlotExt-DatePickerMode><div data-ng-show=!item.isSlotChosen><div class=PGU-TimeSlotExtTopSideWrapWithDatePicker><form-tree ng-repeat=\"item_i in item.items track by $index\" item=item_i></form-tree></div><div data-ng-if=item.datePickerMode data-ng-class=\"{'PGU-TimeSlotExtBookingActions': true, 'PGU-TimeSlotExtBookingActionsBorder': ui.fetched}\"><form-tree ng-repeat=\"item_i in item._gibddItems\" item=item_i></form-tree></div><div class=\"PGU-TimeSlotExtPreReservationCanceledMsg js-PGU-TimeSlotExtPreReservationCanceledMsg\"></div><div data-ng-class=\"{'PGU-FieldError': item.error,\n            'PGU-TimeSlot-Error-offset': true\n            }\">{{(item.error.mnemonic + '.validator' | translate:item.error.text) || (item.error.text || item.error)}}</div><div ng-class=\"{\n                'PGU-SlotsViewWithInterVal': item.intervalBinding,\n                'PGU-DaysView' : true\n"+'            }" class=js-PGU-ButtonScrollContainer data-ng-show="!models.isLoading && ui.fetched"><div class=DateWithSlotsContainer ng-repeat="day in item.slotsCollection"><div class=PGU-DateWithSlotsViewWrap><h4 class="PGU-DateWithSlotsViewTitle js-PGU-DateWithSlotsViewTitle" ng-bind-html="day.title | to_trusted"></h4><span data-ng-class="{\'PGU-DateWithSlotsViewTitle-opened\': day.opened}" data-ng-click=openSlots(day) class=PGU-DateWithSlotsViewTitle-closed></span><div class=PGU-DateWithSlotsViewContent><div class=PGU-DateWithSlotsViewContentInner><div class="PGU-DateWithSlotsViewSlots js-PGU-DateWithSlotsViewSlots"><div class=PGU-TimeSlot ng-repeat="slot in day.slots"><a ng-click=ui.showDialog(slot) data-ng-class="{\'PGU-SlotViewWithInterVal\' : slot.slotViewWithInterVal, \'PGU-EQSlot\': true, \'js-PGU-EQSlot\': true}">{{slot.visitTimeFromIso}}</a></div></div></div></div></div></div></div></div><div data-ng-show="item.isSlotChosen && !ui.popup.isLoading"><div data-ng-if=ui.slotInfo class="PGU-TimeSlotExtStartDate PGU-TimeslotExtSlotsLegendText cf"><strong class=PGU-TimeslotExtSlotsLegendLabel>Выбранное время</strong><span class="PGU-TimeSlotExtPlainText js-PGU-TimeSlotExtStartDateText" ng-bind-html="ui.slotInfo | to_trusted"></span></div><div data-ng-if=isPhone><div data-ng-if=item.orgName class="PGU-TimeSlotExtOrg PGU-TimeslotExtSlotsLegendText js-PGU-TimeSlotExtOrg cf"><strong class=PGU-TimeslotExtSlotsLegendLabel>Подразделение</strong><span class="PGU-TimeSlotExtPlainText js-PGU-TimeSlotExtOrgName">{{item.orgName}}</span></div><div data-ng-if=item.orgAddress class="PGU-TimeSlotExtOrgAddress PGU-TimeslotExtSlotsLegendText js-PGU-TimeSlotExtOrgAddress cf"><strong class=PGU-TimeslotExtSlotsLegendLabel>{{item.isAreaZagsType ? \'Адрес помещения\' : \'Адрес подразделения\'}}</strong> <span class="PGU-TimeSlotExtPlainText js-PGU-TimeSlotExtOrgAddressText">{{item.orgAddress}}</span></div></div><form-tree ng-repeat="item_i in item._gibddItems" item=item_i></form-tree><div class=PGU-TimeSlotExtPhone-Button-Container><epgu-form-button item=ui.buttons.btnBookingChange click-handler-btn=ui.bookingChange></epgu-form-button></div></div></div><div data-ng-if=!item.datePickerMode><div class=PGU-TimeSlotExtHeader data-ng-show=ui.needShowHeader><div data-ng-if=isPhone class=PGU-Panel-TimeSlotExt-throbber-container><div data-ng-show=ui.showInfo class=PGU-TimeSlotExtChartWrap><div class=PGU-TimeSlotExtChart><h4 class="PGU-TimeSlotExtTitle PGU-TimeSlotExtTitleTextCenter">{{item.chartTitle}}</h4><div class=PGU-TSE-Chart-Wrap><div id={{::item.fullPath}}:canvas class="PGU-TSE-Chart-Area js-PGU-Chart-Area-Phone"></div></div></div></div></div><div ng-if=item.saveBookIdToDraft class=PGU-TimeSlotExtBookingActions><epgu-form-button item=ui.buttons.btnShowFullStep click-handler-btn=ui.showFullStep></epgu-form-button><epgu-form-button item=ui.buttons.btnBookingChange click-handler-btn=ui.bookingChange></epgu-form-button><div class=PGU-Button-BookingCancel ng-if=!ui.popup.isLoading><epgu-form-button item=ui.buttons.btnCancelBooking click-handler-btn=ui.cancelBooking></epgu-form-button></div><epgu-form-button item=ui.buttons.btnCancelChanges click-handler-btn=ui.cancelChanges></epgu-form-button></div><div ng-if="ui.slotInfo && ui.showInfo" class="PGU-TimeSlotExtStartDate PGU-TimeslotExtSlotsLegendText cf"><strong class=PGU-TimeslotExtSlotsLegendLabel>Выбранное время</strong><span class="PGU-TimeSlotExtPlainText js-PGU-TimeSlotExtStartDateText" ng-bind-html="ui.slotInfo | to_trusted"></span></div><div ng-if="item.selectedHallTitle && ((!item.hasOneHall && ui.showInfo) || (item.hasOneHall && $root.env.formParam.ShowOneArea))" class="PGU-TimeSlotExtHall PGU-TimeslotExtSlotsLegendText js-PGU-TimeSlotExtHall cf"><strong class=PGU-TimeslotExtSlotsLegendLabel>Место, помещение</strong><span class="PGU-TimeSlotExtPlainText js-PGU-TimeSlotExtHallName">{{item.selectedHallTitle}}</span></div><div ng-if="item.orgAddress && item.isAreaZagsType" class="PGU-TimeSlotExtOrgAddress PGU-TimeslotExtSlotsLegendText js-PGU-TimeSlotExtOrgAddress cf"><strong class=PGU-TimeslotExtSlotsLegendLabel>Адрес места, помещения</strong> <span class="PGU-TimeSlotExtPlainText js-PGU-TimeSlotExtOrgAddressText">{{item.orgAddress}}</span></div><div ng-if=item.orgName class="PGU-TimeSlotExtOrg PGU-TimeslotExtSlotsLegendText js-PGU-TimeSlotExtOrg cf"><strong class=PGU-TimeslotExtSlotsLegendLabel>Подразделение</strong><span class="PGU-TimeSlotExtPlainText js-PGU-TimeSlotExtOrgName">{{item.orgName}}</span></div><div ng-if=item.window class="PGU-TimeSlotExtOrg PGU-TimeslotExtSlotsLegendText js-PGU-TimeSlotExtOrg cf"><strong class=PGU-TimeslotExtSlotsLegendLabel>Окно</strong><span class="PGU-TimeSlotExtPlainText js-PGU-TimeSlotExtOrgName">{{item.window}}</span></div><div ng-if=item.pincode class="PGU-TimeSlotExtOrg PGU-TimeslotExtSlotsLegendText js-PGU-TimeSlotExtOrg cf"><strong class=PGU-TimeslotExtSlotsLegendLabel>Пин-код</strong><span class="PGU-TimeSlotExtPlainText js-PGU-TimeSlotExtOrgName">{{item.pincode}}</span></div><div ng-if="item.orgAddress && !item.isAreaZagsType" class="PGU-TimeSlotExtOrgAddress PGU-TimeslotExtSlotsLegendText js-PGU-TimeSlotExtOrgAddress cf"><strong class=PGU-TimeslotExtSlotsLegendLabel>Адрес подразделения</strong> <span class="PGU-TimeSlotExtPlainText js-PGU-TimeSlotExtOrgAddressText">{{item.orgAddress}}</span></div><div ng-if="item.isAreaZagsType && item.orgAddressZags" class="PGU-TimeSlotExtOrgAddress PGU-TimeslotExtSlotsLegendText js-PGU-TimeSlotExtOrgAddress cf"><strong class=PGU-TimeslotExtSlotsLegendLabel>Адрес подразделения</strong> <span class="PGU-TimeSlotExtPlainText js-PGU-TimeSlotExtOrgAddressText">{{item.orgAddressZags}}</span></div><div ng-if=item.comment class="PGU-TimeSlotExtComment PGU-TimeslotExtSlotsLegendText js-PGU-TimeSlotExtComment cf"><strong class=PGU-TimeslotExtSlotsLegendLabel>Комментарий</strong><span class="PGU-TimeSlotExtPlainText js-PGU-TimeSlotExtCommentText">{{item.comment}}</span></div><div data-ng-if=item.filterByHall><div data-ng-show="(!ui.showInfo && (isPhone || isTablet) && !needHideHeader) || (!ui.showInfo && item.hallList.length > 3 && !needHideHeader)" class="PGU-TimeSlotExtHalls PGU-TimeslotExtSlotsLegendText cf"><strong class=PGU-TimeslotExtSlotsLegendLabel>{{item.headHallLabel}}</strong><div class="PGU-TimeSlotExtHallDropDown PGU-TimeSlotExtPlainText"><form-tree ng-repeat="item_i in item._hallItems" item=item_i></form-tree></div></div><div class=PGU-HallSelector data-ng-if="!ui.showInfo && isDesktop"><ul data-ng-if="item.hallList.length > 1 && item.hallList.length <= 3"><li data-ng-class="{\n                            \'PGU-HallSelector-item\': true,\n                            \'PGU-HallSelector-first-item\': $index == 0,\n                            \'PGU-HallSelector-last-item\' : $index == item.hallList.length - 1,\n                            \'PGU-HallSelector-item-active\' : item.activeHall == list.value\n                            }" data-ng-repeat="list in item.hallList" data-value={{list.value}} data-ng-click=item.changeActiveHall(list.value)>{{list.title}}</li></ul><ul data-ng-if="item.hallList.length == 1"><li class="PGU-HallSelector-item PGU-HallSelector-item-active PGU-HallSelector-first-last-item" data-ng-repeat="list in item.hallList" data-value={{list.value}}>{{list.title}}</li></ul></div></div><div class="PGU-TimeSlotExtPreReservationCanceledMsg js-PGU-TimeSlotExtPreReservationCanceledMsg"></div></div></div><div data-ng-if=!isPhone><div data-ng-show=ui.saveBookIdMode.showChart class=PGU-TimeSlotExtChartWrap><div class=PGU-TimeSlotExtChart><h4 class="PGU-TimeSlotExtTitle PGU-TimeSlotExtTitleTextCenter">{{item.chartTitle}}</h4><div class=PGU-TSE-Chart-Wrap><div id={{::item.fullPath}}:canvas class="PGU-TSE-Chart-Area js-PGU-Chart-Area"></div></div></div></div></div></div><div data-ng-if="!item.datePickerMode && !item.clinicExamMode"><div ng-if=isPhone class=PGU-TSE-WrapPhone><div class=PGU-Panel-TimeSlotExt-throbber-container><div class="PGU-Panel-TimeSlotExt-shadow js-PGU-Panel-FieldMapWithList-shadow"><epgu-throbber data-throbber-type=PGU-throbber-big data-show-heading=true></epgu-throbber></div></div><div class="PGU-TimeSlotExtEmptySlotsResponseMsg PGU-Advice-InForm PGU-Advice-type-warn"><h3 class=PGU-Title-H3><span class="PGU-Icon PGU-Advice-icon"></span> <span>{{item.errorMessageHeader}}</span></h3><p>{{item.errorMessageBody}}</p></div><div data-ng-show=ui.showCalendar class=PGU-TimeSlotExtPhone-Content><div data-ng-if=!$root.settings.mobOptimizeEqueue class=PGU-TimeSlotExtPhone-WrapContentBtn><a class="PGU-Link PGU-TimeSlotExtPhone-Link PGU-FMWLPhone-Link-back PGU-TimeSlotExtPhone-Link-back js-PGU-TimeSlotExtPhone-toggleWidetState" data-content-id=btn href=# data-ng-click=ui.closeCalendar($event)>Назад</a> <a class="PGU-Link PGU-TimeSlotExtPhone-Link PGU-TimeSlotExtPhone-Link-toggleFilter js-PGU-TimeSlotExtPhone-toggleFilter" href=# data-ng-click="ui.toggleCalendarMode = !ui.toggleCalendarMode; $event.preventDefault()"><span data-ng-show=ui.toggleCalendarMode class=PGU-TimeSlotExtPhone-Link-toggleFilterOn>Свернуть фильтр</span><span data-ng-show=!ui.toggleCalendarMode class=PGU-TimeSlotExtPhone-Link-toggleFilterOff>Фильтр по датам</span></a></div><div data-ng-if=$root.settings.mobOptimizeEqueue class=PGU-TimeSlotExtPhone-WrapContentBtn><a class="PGU-Link PGU-TimeSlotExtPhone-Link" href=# data-ng-click=ui.scrollToTop($event) data-ng-show=ui.scrollToTopBtn>Показать доступные даты</a> <a class="PGU-Link PGU-TimeSlotExtPhone-Link PGU-FMWLPhone-Link-back PGU-TimeSlotExtPhone-Link-back js-PGU-TimeSlotExtPhone-toggleWidetState" data-content-id=btn href=# data-ng-click=ui.closeCalendar($event)></a></div><div class=PGU-TimeSlotExt-CalendarWrap><div class=PGU-TimeSlotExt-ScrollContainer><div class=PGU-TimeSlotExt-CalendarInner><div class="PGU-TimeSlotExt-Calendar js-PGU-TimeSlotExt-CalendarContainer" ng-class="{\'PGU-TimeSlotExt-CalendarSticky\': ui.isSticky}"><div class="PGU-TimeSlotExt-Filter js-PGU-TimeSlotExt-Filter"></div><div class=js-PGU-TimeSlotExt-Calendar><span class=HelperText>Выберите удобное время для записи</span><div data-ng-if="$root.settings.mobOptimizeEqueue && $root.version == \'mob\'" class=hintBlock><question ng-if=item.hintHtml item=item></question></div></div><div class="PGU-TimeSlotExt-CalendarInner js-PGU-TimeSlotExt-Calendar"><div class=PGU-EQMonthContainerWrap ng-repeat="month in item.calendarMonths"><div class=PGU-EQMonthContainer><div class=EQMonth-header><span data-ng-class="{\n                                            \'PGU-month-selector-prev\': true,\n                                            \'js-PGU-month-prev\' : true,\n                                            \'PGU-month-selector-disabled\' : item.firstMonth\n                                            }" data-ng-click=item.showPrevMonth()></span><h3 class=PGU-EQMonth-title>{{month.title}}</h3><span data-ng-class="{\n                                            \'PGU-month-selector-next\': true,\n                                            \'js-PGU-month-next\' : true,\n                                            \'PGU-month-selector-disabled\' : item.lastMonth\n                                            }" data-ng-click=item.showNextMonth()></span></div><div class=EQMonth-wrap><table class=PGU-EQMonth><thead><tr><th class="PGU-EQMonth-days PGU-EQMonth-days-first">Пн</th><th class=PGU-EQMonth-days>Вт</th><th class=PGU-EQMonth-days>Ср</th><th class=PGU-EQMonth-days>Чт</th><th class=PGU-EQMonth-days>Пт</th><th class="PGU-EQMonth-days PGU-EQMonth-holiday">Сб</th><th class="PGU-EQMonth-days PGU-EQMonth-holiday PGU-EQMonth-days-last">Вс</th></tr></thead><tbody><tr ng-repeat="week in month.weeks" class=PGU-EQWeek><td class=DayCell ng-class="{\n                                                        \'DayCellEmpty\':             !day.day,\n                                                        \'PGU-DayCellBrdRightWhite\': day.rightBorderWhite,\n                                                        \'PGU-DayCellBrdBottomWhite\': day.bottomBorderWhite,\n                                                        \'PGU-EQDateCellBusy\':       !day.slots.length && day.day,\n                                                    }" ng-repeat="day in week.days"><a ng-if=day.day ng-click="$event.stopPropagation(); (item.filterByHall && item.hasSlotsThisDay(day.slots) && item.scrollToDayWithSlots($event, day)) || item.scrollToDayWithSlots($event, day)" ng-class="{\n                                                            \'PGU-EQDateBusy\'    : !day.slots.length || (item.filterByHall && !item.hasSlotsThisDay(day.slots)),\n                                                            \'PGU-EQDateIsToday\' : day.isToday,\n                                                            \'PGU-EQDateActive\'  : day.active\n                                                        }" class=PGU-EQDate>{{day.day}}</a></td></tr></tbody></table></div></div></div><div class=PGU-TimeSlotExt-CalendarInfoWrap><div class=PGU-TimeSlotExt-MessageAboutService>{{item.messageAboutService}}</div><div class=PGU-TimeSlotExt-CalendarLegend><div class=PGU-TimeSlotExt-CalendarLegend__item><span class=PGU-TimeSlotExt-CalendarLegend__day>5</span><span class=PGU-TimeSlotExt-CalendarLegend__text>День, доступный для записи</span></div><div class=PGU-TimeSlotExt-CalendarLegend__item><span class="PGU-TimeSlotExt-CalendarLegend__day PGU-TimeSlotExt-CalendarLegend__day_busy">5</span><span class=PGU-TimeSlotExt-CalendarLegend__text>День, недоступный для записи</span></div></div></div></div></div></div></div></div><div ng-class="{\n                \'PGU-SlotsViewWithInterVal\': item.intervalBinding,\n                \'PGU-DaysView\' : true,\n                \'js-PGU-ButtonScrollContainer\': true\n                }"><div class=DateWithSlotsContainer data-ng-show="((!item.filterByHall || item.hasSlotsThisDay(day.slots)) && $root.version != \'mob\') || ((!item.filterByHall || item.hasSlotsThisDay(day.slots)) && $root.version == \'mob\' && !day.hide)" ng-repeat="day in item.slotsCollection track by $index" data-ng-click="item.showActiveDayInCalendar($event, day.dayId)" id={{day.dayId}}><div data-ng-class="{\n                    \'PGU-DateWithSlotsViewWrap-active\': day.active,\n                    \'PGU-DateWithSlotsViewWrapPhone\': true\n                    }"><h4 class="PGU-DateWithSlotsViewTitle js-PGU-DateWithSlotsViewTitle" ng-bind-html="day.title | to_trusted"></h4><div class=PGU-DateWithSlotsViewContent><div class=PGU-DateWithSlotsViewContentInner><div class="PGU-DateWithSlotsViewSlots js-PGU-DateWithSlotsViewSlots"><div class=PGU-TimeSlot ng-repeat="slot in day.slots" data-ng-show="!item.filterByHall || slot.areaId == item.activeHall"><a ng-click=ui.showDialog(slot) data-ng-class="{\'PGU-SlotViewWithInterVal\' : slot.slotViewWithInterVal, \'PGU-EQSlot\': true, \'js-PGU-EQSlot\': true}">{{slot.visitTimeFromIso}}</a></div></div></div></div></div></div><div class=addMoreSlots data-ng-if="$root.settings.mobOptimizeEqueue && $root.version == \'mob\'" data-ng-hide="item.slotsCollection.length < 10 || ui.hideAddSlots"><a href=# class="PGU-Btn-Base PGU-Btn-White" ng-click=ui.addMoreSlots()>Показать еще</a></div></div></div><div data-ng-show=ui.popup.isPhoneHelpers><div class="PGU-TimeSlotExt-CalendarHelperBox js-PGU-TimeSlotExt-CalendarHelperBox"><form-tree ng-repeat="item_i in item._items" item=item_i></form-tree></div><div class=PGU-TimeSlotExtPhone-WrapBtn><epgu-form-button item=ui.buttons.btnToggleState click-handler-btn=ui.toggleState click-attr=ui.state></epgu-form-button></div></div></div><div data-ng-hide=ui.showInfo data-ng-if=!isPhone class="PGU-TimeSlotExtSlots js-PGU-TimeSlotExtSlotsWrap"><div class="PGU-TimeSlotExtSlotsWrap js-PGU-TimeSlotExtSlots"><h4 class="PGU-TimeSlotExtSlotsToday PGU-TimeSlotExtTitle">Сегодня: <span class="PGU-TimeSlotExtSlotsTodayInner js-PGU-TimeSlotExtSlotsTodayInner">{{models.today}}</span></h4><div class="PGU-TimeSlotExt-CalendarWrap js-PGU-TimeSlotExt-CalendarWrap"><div data-ng-if=isTablet class="DateFilterContainer js-DateFilterContainer" data-ng-class="{\n                \'DateFilterButton-clicked\' : isTablet && !item.dayIsClicked}"><strong>Фильтр по датам</strong><div class="DateFilterContainerInner js-DateFilterContainerInner"><span class="DateFilterButton js-DateFilterButton" data-ng-click=item.returnToCalendarOnPad()>Развернуть</span> <span class=DateFilterButtonIcon></span></div></div><div class=PGU-TimeSlotExt-CalendarInner><div class="PGU-TimeSlotExt-Calendar js-PGU-TimeSlotExt-CalendarContainer" ng-class="{\'PGU-TimeSlotExt-CalendarSticky\': ui.isSticky,\n                         \'DateFilterButton-clicked\': isTablet && item.dayIsClicked}"><div class="PGU-TimeSlotExt-Filter js-PGU-TimeSlotExt-Filter"></div><div class="PGU-TimeSlotExt-CalendarInner js-PGU-TimeSlotExt-Calendar"><div class=PGU-EQMonthContainerWrap ng-repeat="month in item.calendarMonths"><div class=PGU-EQMonthContainer><div class=EQMonth-header><span data-ng-class="{\n                                        \'PGU-month-selector-prev\': true,\n                                        \'js-PGU-month-prev\' : true,\n                                        \'PGU-month-selector-disabled\' : item.firstMonth\n                                        }" data-ng-click=item.showPrevMonth()></span><h3 class=PGU-EQMonth-title>{{month.title}}</h3><span data-ng-class="{\n                                        \'PGU-month-selector-next\': true,\n                                        \'js-PGU-month-next\' : true,\n                                        \'PGU-month-selector-disabled\' : item.lastMonth\n                                        }" data-ng-click=item.showNextMonth()></span></div><div class=EQMonth-wrap><table class=PGU-EQMonth><thead><tr><th class="PGU-EQMonth-days PGU-EQMonth-days-first">Пн</th><th class=PGU-EQMonth-days>Вт</th><th class=PGU-EQMonth-days>Ср</th><th class=PGU-EQMonth-days>Чт</th><th class=PGU-EQMonth-days>Пт</th><th class="PGU-EQMonth-days PGU-EQMonth-holiday">Сб</th><th class="PGU-EQMonth-days PGU-EQMonth-holiday PGU-EQMonth-days-last">Вс</th></tr></thead><tbody><tr ng-repeat="week in month.weeks" class=PGU-EQWeek><td class=DayCell ng-class="{\n                                                    \'DayCellEmpty\':             !day.day,\n                                                    \'PGU-DayCellBrdRightWhite\': day.rightBorderWhite,\n                                                    \'PGU-DayCellBrdBottomWhite\': day.bottomBorderWhite,\n                                                    \'PGU-EQDateCellBusy\':       !day.slots.length && day.day,\n                                                }" ng-repeat="day in week.days"><a ng-if=day.day ng-click="$event.stopPropagation(); (item.filterByHall && item.hasSlotsThisDay(day.slots) && item.scrollToDayWithSlots($event, day)) || item.scrollToDayWithSlots($event, day)" ng-class="{\n                                                        \'PGU-EQDateBusy\'    : !day.slots.length || (item.filterByHall && !item.hasSlotsThisDay(day.slots)),\n                                                        \'PGU-EQDateIsToday\' : day.isToday,\n                                                        \'PGU-EQDateActive\'  : day.active || (day.hover && !isTablet)\n                                                    }" class=PGU-EQDate>{{day.day}}</a></td></tr></tbody></table></div></div></div></div><div class=PGU-TimeSlotExt-CalendarInfoWrap><div class=PGU-TimeSlotExt-MessageAboutService>{{item.messageAboutService}}</div><div class=PGU-TimeSlotExt-CalendarLegend><div class=PGU-TimeSlotExt-CalendarLegend__item><span class=PGU-TimeSlotExt-CalendarLegend__day>5</span><span class=PGU-TimeSlotExt-CalendarLegend__text>День, доступный для записи</span></div><div class=PGU-TimeSlotExt-CalendarLegend__item><span class="PGU-TimeSlotExt-CalendarLegend__day PGU-TimeSlotExt-CalendarLegend__day_busy">5</span><span class=PGU-TimeSlotExt-CalendarLegend__text>День, недоступный для записи</span></div></div><div class="PGU-TimeSlotExt-CalendarHelperBox js-PGU-TimeSlotExt-CalendarHelperBox"><form-tree ng-repeat="item_i in item._items" item=item_i></form-tree></div></div></div></div><div ng-class="{\n            \'PGU-SlotsViewWithInterVal\': item.intervalBinding,\n            \'PGU-DaysView\' : true\n        }" class=js-PGU-ButtonScrollContainer><div class=DateWithSlotsContainer data-ng-show="!item.filterByHall || item.hasSlotsThisDay(day.slots)" ng-repeat="day in item.slotsCollection" data-ng-click="item.showActiveDayInCalendar($event, day.dayId)" ng-mouseleave="!isTablet && item.showActiveDayInCalendar($event, day.dayId, true)" ng-mousemove="!isTablet && item.showActiveDayInCalendar($event, day.dayId)" id={{day.dayId}}><div data-ng-class="{\n                    \'PGU-DateWithSlotsViewWrap-active\': day.active && isTablet,\n                    \'PGU-DateWithSlotsViewWrap\' : !isTablet,\n                    \'PGU-DateWithSlotsViewWrapTablet\' : isTablet\n                    }"><h4 class="PGU-DateWithSlotsViewTitle js-PGU-DateWithSlotsViewTitle" ng-bind-html="day.title | to_trusted"></h4><span data-ng-class="{\'PGU-DateWithSlotsViewTitle-opened\': day.opened}" data-ng-click=openSlots(day) class=PGU-DateWithSlotsViewTitle-closed></span><div data-ng-show="day.opened || isDesktop || isTablet " class=PGU-DateWithSlotsViewContent><div class=PGU-DateWithSlotsViewContentInner><div class="PGU-DateWithSlotsViewSlots js-PGU-DateWithSlotsViewSlots"><div class=PGU-TimeSlot ng-repeat="slot in day.slots" data-ng-show="!item.filterByHall || slot.areaId == item.activeHall"><a ng-click=ui.showDialog(slot) data-ng-class="{\'PGU-SlotViewWithInterVal\' : slot.slotViewWithInterVal, \'PGU-EQSlot\': true, \'js-PGU-EQSlot\': true}">{{slot.visitTimeFromIso}}</a></div></div></div></div></div></div></div><div data-ng-if=isDesktop class="PGU-TimeSlotExt-DaysWrap js-PGU-TimeSlotExt-DaysWrap"><div class="PGU-TimeSlotExtButtonUp js-PGU-TimeSlotExtButtonUpWrap"><div class="PGU-TimeSlotExt-ButtonUpContainer js-PGU-TimeSlotExt-ButtonUpContainer" data-ng-click=item.gotToCalendar() style="display: none"><span class=PGU-TimeSlotExt-ButtonUp></span> <span>К календарю</span></div></div></div></div></div></div><div data-ng-class="{\'PGU-FieldError\': item.error}">{{(item.error.mnemonic + \'.validator\' | translate:item.error.text) || (item.error.text || item.error)}}</div></div><div data-ng-if=item.clinicExamMode><div data-ng-show=item.clinicFullSlotMode ng-if=isPhone class=PGU-TSE-WrapPhone><div class=PGU-Panel-TimeSlotExt-throbber-container><div class="PGU-Panel-TimeSlotExt-shadow js-PGU-Panel-FieldMapWithList-shadow"><epgu-throbber data-throbber-type=PGU-throbber-big data-show-heading=true></epgu-throbber></div></div><div class="PGU-TimeSlotExtEmptySlotsResponseMsg PGU-Advice-InForm PGU-Advice-type-warn"><h3 class=PGU-Title-H3><span class="PGU-Icon PGU-Advice-icon"></span> <span>{{item.errorMessageHeader}}</span></h3><p>{{item.errorMessageBody}}</p></div><div class=PGU-TimeSlotExt-ClinicExam-Content><div class=PGU-TimeSlotExt-CalendarWrap><div class=PGU-TimeSlotExt-ScrollContainer><div class=PGU-TimeSlotExt-CalendarInner><div class="PGU-TimeSlotExt-Calendar js-PGU-TimeSlotExt-CalendarContainer" ng-class="{\'PGU-TimeSlotExt-CalendarSticky\': ui.isSticky}"><div class="PGU-TimeSlotExt-Filter js-PGU-TimeSlotExt-Filter"></div><div class="PGU-TimeSlotExt-CalendarInner js-PGU-TimeSlotExt-Calendar"><div class=PGU-EQMonthContainerWrap ng-repeat="month in item.calendarMonths"><div class=PGU-EQMonthContainer><div class=EQMonth-header><span data-ng-class="{\n                                            \'PGU-month-selector-prev\': true,\n                                            \'js-PGU-month-prev\' : true,\n                                            \'PGU-month-selector-disabled\' : item.firstMonth\n                                            }" data-ng-click=item.showPrevMonth()></span><h3 class=PGU-EQMonth-title>{{month.title}}</h3><span data-ng-class="{\n                                            \'PGU-month-selector-next\': true,\n                                            \'js-PGU-month-next\' : true,\n                                            \'PGU-month-selector-disabled\' : item.lastMonth\n                                            }" data-ng-click=item.showNextMonth()></span></div><div class=EQMonth-wrap><table class=PGU-EQMonth><thead><tr><th class="PGU-EQMonth-days PGU-EQMonth-days-first">Пн</th><th class=PGU-EQMonth-days>Вт</th><th class=PGU-EQMonth-days>Ср</th><th class=PGU-EQMonth-days>Чт</th><th class=PGU-EQMonth-days>Пт</th><th class="PGU-EQMonth-days PGU-EQMonth-holiday">Сб</th><th class="PGU-EQMonth-days PGU-EQMonth-holiday PGU-EQMonth-days-last">Вс</th></tr></thead><tbody><tr ng-repeat="week in month.weeks" class=PGU-EQWeek><td class=DayCell ng-class="{\n                                                        \'DayCellEmpty\':             !day.day,\n                                                        \'PGU-DayCellBrdRightWhite\': day.rightBorderWhite,\n                                                        \'PGU-DayCellBrdBottomWhite\': day.bottomBorderWhite,\n                                                        \'PGU-EQDateCellBusy\':       !day.slots.length && day.day,\n                                                    }" ng-repeat="day in week.days"><a ng-if=day.day ng-click="$event.stopPropagation(); $event.preventDefault(); (item.filterByHall && item.hasSlotsThisDay(day.slots) && item.scrollToDayWithSlots($event, day)) || item.scrollToDayWithSlots($event, day)" ng-class="{\n                                                            \'PGU-EQDateBusy\'    : !day.slots.length || (item.filterByHall && !item.hasSlotsThisDay(day.slots)),\n                                                            \'PGU-EQDateIsToday\' : day.isToday,\n                                                            \'PGU-EQDateActive\'  : day.active\n                                                        }" class=PGU-EQDate>{{day.day}}</a></td></tr></tbody></table></div></div></div></div></div></div></div></div><div ng-class="{\n            \'PGU-SlotsViewWithInterVal\': item.intervalBinding,\n            \'PGU-DaysView\' : true\n        }" class=js-PGU-ButtonScrollContainer><div class=DateWithSlotsContainer data-ng-show="!item.filterByHall || item.hasSlotsThisDay(item.clinicExamDay.slots)" data-ng-click="item.showActiveDayInCalendar($event, item.clinicExamDay.dayId)" id={{item.clinicExamDay.dayId}}><div data-ng-class="{\n                    \'PGU-DateWithSlotsViewWrap-active\': item.clinicExamDay.active,\n                    \'PGU-DateWithSlotsViewWrapPhone\': true\n                    }"><h4 class="PGU-DateWithSlotsViewTitle js-PGU-DateWithSlotsViewTitle" ng-bind-html="item.clinicExamDay.title | to_trusted"></h4><div class=PGU-DateWithSlotsViewContent><div class=PGU-DateWithSlotsViewContentInner><div class="PGU-DateWithSlotsViewSlots js-PGU-DateWithSlotsViewSlots"><div class=PGU-TimeSlot ng-repeat="slot in item.clinicExamDay.slots" data-ng-show="!item.filterByHall || slot.areaId == item.activeHall"><a ng-click=ui.showDialog(slot) data-ng-class="{\'PGU-SlotViewWithInterVal\' : slot.slotViewWithInterVal, \'PGU-EQSlot\': true, \'js-PGU-EQSlot\': true}">{{slot.visitTimeFromIso}}</a></div><div class="PGU-TimeSlot virtual" ng-repeat="slot in item.clinicExamDay.slots" data-ng-show="!item.filterByHall || slot.areaId == item.activeHall"></div></div></div></div></div></div></div></div></div><div data-ng-show=item.clinicFullSlotMode data-ng-if=!isPhone class="PGU-TimeSlotExtSlots js-PGU-TimeSlotExtSlotsWrap"><div class="PGU-TimeSlotExtSlotsWrap js-PGU-TimeSlotExtSlots"><div class="PGU-TimeSlotExt-CalendarWrap js-PGU-TimeSlotExt-CalendarWrap"><div class=PGU-TimeSlotExt-CalendarInner><div class="PGU-TimeSlotExt-Calendar js-PGU-TimeSlotExt-CalendarContainer" ng-class="{\'PGU-TimeSlotExt-CalendarSticky\': ui.isSticky,\n                         \'DateFilterButton-clicked\': isTablet && item.dayIsClicked}"><h4 class="PGU-TimeSlotExtSlotsToday PGU-TimeSlotExtTitle">Сегодня: <span class="PGU-TimeSlotExtSlotsTodayInner js-PGU-TimeSlotExtSlotsTodayInner">{{models.today}}</span></h4><div class="PGU-TimeSlotExt-CalendarInner js-PGU-TimeSlotExt-Calendar"><div class=PGU-EQMonthContainerWrap ng-repeat="month in item.calendarMonths"><div class=PGU-EQMonthContainer><div class=EQMonth-header><span data-ng-class="{\n                                        \'PGU-month-selector-prev\': true,\n                                        \'js-PGU-month-prev\' : true,\n                                        \'PGU-month-selector-disabled\' : item.firstMonth\n                                        }" data-ng-click=item.showPrevMonth()></span><h3 class=PGU-EQMonth-title>{{month.title}}</h3><span data-ng-class="{\n                                        \'PGU-month-selector-next\': true,\n                                        \'js-PGU-month-next\' : true,\n                                        \'PGU-month-selector-disabled\' : item.lastMonth\n                                        }" data-ng-click=item.showNextMonth()></span></div><div class=EQMonth-wrap><table class=PGU-EQMonth><thead><tr><th class="PGU-EQMonth-days PGU-EQMonth-days-first">Пн</th><th class=PGU-EQMonth-days>Вт</th><th class=PGU-EQMonth-days>Ср</th><th class=PGU-EQMonth-days>Чт</th><th class=PGU-EQMonth-days>Пт</th><th class="PGU-EQMonth-days PGU-EQMonth-holiday">Сб</th><th class="PGU-EQMonth-days PGU-EQMonth-holiday PGU-EQMonth-days-last">Вс</th></tr></thead><tbody><tr ng-repeat="week in month.weeks" class=PGU-EQWeek><td class=DayCell ng-class="{\n                                                    \'DayCellEmpty\':             !day.day,\n                                                    \'PGU-DayCellBrdRightWhite\': day.rightBorderWhite,\n                                                    \'PGU-DayCellBrdBottomWhite\': day.bottomBorderWhite,\n                                                    \'PGU-EQDateCellBusy\':       !day.slots.length && day.day,\n                                                }" ng-repeat="day in week.days"><a ng-if=day.day ng-click="$event.stopPropagation(); (item.filterByHall && item.hasSlotsThisDay(day.slots) && item.scrollToDayWithSlots($event, day)) || item.scrollToDayWithSlots($event, day)" ng-class="{\n                                                        \'PGU-EQDateBusy\'    : !day.slots.length || (item.filterByHall && !item.hasSlotsThisDay(day.slots)),\n                                                        \'PGU-EQDateIsToday\' : day.isToday,\n                                                        \'PGU-EQDateActive\'  : day.active || (day.hover && !isTablet)\n                                                    }" class=PGU-EQDate>{{day.day}}</a></td></tr></tbody></table></div></div></div></div></div></div><div ng-class="{\n                        \'PGU-SlotsViewWithInterVal\': item.intervalBinding,\n                        \'PGU-DaysView\' : true\n                    }" class=js-PGU-ButtonScrollContainer><div class=DateWithSlotsContainer data-ng-show="!item.filterByHall || item.hasSlotsThisDay(item.clinicExamDay.slots)" data-ng-click="item.showActiveDayInCalendar($event, item.clinicExamDay.dayId)" id={{item.clinicExamDay.dayId}}><div data-ng-class="{\n                    \'PGU-DateWithSlotsViewWrap-active\': item.clinicExamDay.active && isTablet,\n                    \'PGU-DateWithSlotsViewWrap\' : !isTablet,\n                    \'PGU-DateWithSlotsViewWrapTablet\' : isTablet\n                    }"><h4 class="PGU-TimeSlotExtSlotsToday PGU-TimeSlotExtTitle PGU-TimeSlotExt-ClinicExam-Title">Выбранный день: <span class="PGU-TimeSlotExtSlotsTodayInner js-PGU-TimeSlotExtSlotsTodayInner" data-ng-bind-html=item.clinicExamDay.title></span></h4><div data-ng-show="item.clinicExamDay.opened || isDesktop || isTablet " class=PGU-DateWithSlotsViewContent><div class=PGU-DateWithSlotsViewContentInner><div class="PGU-DateWithSlotsViewSlots js-PGU-DateWithSlotsViewSlots"><div class=PGU-TimeSlot ng-repeat="slot in item.clinicExamDay.slots" data-ng-show="!item.filterByHall || slot.areaId == item.activeHall"><a ng-click=ui.showDialog(slot) data-ng-class="{\'PGU-SlotViewWithInterVal\' : slot.slotViewWithInterVal, \'PGU-EQSlot\': true, \'js-PGU-EQSlot\': true}">{{slot.visitTimeFromIso}}</a></div></div></div></div></div></div></div></div></div></div><div data-ng-class="{\'PGU-FieldError\': item.error}">{{(item.error.mnemonic + \'.validator\' | translate:item.error.text) || (item.error.text || item.error)}}</div></div><div data-ng-if="!isPhone || item.datePickerMode" class=PGU-Panel-TimeSlotExt-throbber-container><div class="PGU-Panel-TimeSlotExt-shadow js-PGU-Panel-FieldMapWithList-shadow"><epgu-throbber data-throbber-type=PGU-throbber-big data-show-heading=true></epgu-throbber></div><div class="PGU-TimeSlotExtEmptySlotsResponseMsg PGU-Advice-InForm PGU-Advice-type-warn"><h3 class=PGU-Title-H3><span class="PGU-Icon PGU-Advice-icon"></span> <span>{{item.errorMessageHeader}}</span></h3><p>{{item.errorMessageBody}}</p></div></div><modal-dialog back-btn-name="item.clinicExamMode && $root.version !== \'mob\'" hide-modal=ui.closeDialog() show=ui.isDialogShow data-ng-class="{\'uiError\' : ui.popup.error}" data-hide-close-popup-btn=ui.popup.isLoading><div class=PGU-TimeSlotExtPopup ng-class="{\n            \'PGU-TimeSlotExtPopupShowError\':           ui.popup.error,\n            \'PGU-TimeSlotExtPopupShowBookLoadingText\': ui.popup.isLoading\n            }"><div class=PGU-TimeSlotExtPopupWrap><a ng-if="$root.settings.mobOptimizeEqueue && $root.version == \'mob\' && !ui.popup.isLoading" class=PGU-FMWLPhone-Link-back ng-click="ui.closeDialog($event); $event.stopPropagation();"></a><div class=PGU-TimeSlotExtPopupContent><span class=PGU-TimeSlotExtPopupContent-title>Вы выбрали дату для записи:</span> <span class="PGU-TimeSlotExtPopupDate js-PGU-TimeSlotExtPopupDate" ng-bind-html="ui.slotInfo | to_trusted"></span><div data-ng-if="$root.settings.mnemonic === \'10000104378\' || $root.settings.mnemonic === \'10000053124\'" class=PGU-TimeSlotExtPopup_MoreInfo><span class=red-more-info>Возьмите с собой СНИЛС и паспорт.</span> В прививочном пункте обратите внимание сотрудников, что ваш СНИЛС и паспортные данные нужно внести в регистр вакцинированных Минздрава. Это важно для получения сертификата вакцинированного на Госуслугах</div></div><div class=PGU-TimeSlotExtPopupBtns data-ng-if=!$root.settings.mobOptimizeEqueue><a class="PGU-TimeSlotExtPopupClose PGU-Btn-Base js-PGU-TimeSlotExtPopupClose" ng-click="ui.closeDialog($event); $event.stopPropagation();"><span class=PGU-ButtonText>Отменить</span> </a><a ng-click=item.aggBook($event) class="PGU-Btn-Base PGU-Btn-Blue js-Booking"><span class=PGU-ButtonText>Да, подтверждаю</span></a></div><div class=PGU-TimeSlotExtPopupBtns data-ng-if=$root.settings.mobOptimizeEqueue><a ng-if="$root.version != \'mob\'" class="PGU-TimeSlotExtPopupClose PGU-Btn-Base js-PGU-TimeSlotExtPopupClose" ng-click="ui.closeDialog($event); $event.stopPropagation();"><span class=PGU-ButtonText>Отменить</span> </a><a ng-click=item.aggBook($event) class="PGU-Btn-Base PGU-Btn-Blue js-Booking"><span data-ng-if="$root.version !== \'mob\'" class=PGU-ButtonText>Да, подтверждаю</span> <span data-ng-if="$root.version == \'mob\'" class=PGU-ButtonText>Подтвердить</span></a></div><div class=PGU-TimeSlotExtPopupError><div class=PGU-TimeSlotExtPopupError-wrap><h3 class=PGU-TimeSlotExtPopupErrorTitle>{{ui.popup.errorTitle}}</h3><div class=js-PGU-TimeSlotExtPopupErrorText>{{ui.popup.error}}</div></div><div class=PGU-TimeSlotExt-close_popup_mob data-ng-if="!$root.settings.mobOptimizeEqueue && $root.version == \'mob\' && ui.popup.error" ng-click="ui.closeDialog($event); $event.stopPropagation();"><a>Назад</a></div></div><div class=PGU-TimeSlotExtPopupLoadingText>Выполняется отправка данных в ведомство...</div></div><a class="PGU-TimeSlotExtPopupCloseIcon js-PGU-TimeSlotExtPopupClose" data-ng-class="{\'close_popup_x\': item.clinicExamMode}" data-ng-if="($root.version !== \'mob\')" ng-click="ui.closeDialog($event); $event.stopPropagation();"></a></div></modal-dialog></div></div>'),
$templateCache.put("js/player/tmpl/epgu-widget.html",'<div id=PGU-widgets class="ng-form PGU-widgets-container {{isSMU ? \'is-smu\':\'\'}} {{isSMU ? \'smu-\' + __platform : \'\'}}" health><div ng-class="{\'PGU-IsFrame\' : isIframe}"><div class={{specifiedDevice}}><epgu-throbber data-ng-show="$root.mainLoader.show || (formStructure && formStructure[0] && formStructure[0].shaded)" data-throbber-type=PGU-throbber-big data-show-heading=true data-title={{$root.mainLoader.title}} data-msg={{$root.mainLoader.msg}}></epgu-throbber><advice-simple-bind-sf ng-if=$root.mainLoader.errorMsg title={{$root.mainLoader.errorTitle}} text={{$root.mainLoader.errorMsg}} type=PGU-Advice-Type_{{$root.mainLoader.iconType}} rulemessage={{$root.mainLoader.ruleMessage}}></advice-simple-bind-sf><div ng-if="::formStructure && $root.mainLoader.startRenderForm" ng-cloak ng-show="(!$root.mainLoader.show && !$root.mainLoader.errorMsg) && !(formStructure && formStructure[0] && formStructure[0].shaded)"><form-tree ng-repeat="item in ::formStructure track by $index" item=item></form-tree></div><div data-ng-show="$root.lazyloader.show && !$root.mainLoader.show"><div class=PGU-StepLoader><div class=grid-wrap><div class="grid-wrap__row lg-offset-top-40 lg-offset-bottom-40 md-offset-top-40 md-offset-bottom-40 sm-offset-top-24 md-offset-bottom-24"><div class="grid-wrap__col-lg-1 grid-wrap__col-md-1 grid-wrap__col-sm-1"><div class="PGU-StepLoader__Content PGU-StepLoader__Content_Title"></div></div><div class="grid-wrap__col-lg-21 grid-wrap__col-md-9 grid-wrap__col-sm-5"><div class="PGU-StepLoader__Content PGU-StepLoader__Content_Title"></div></div></div><div class="grid-wrap__row lg-offset-top-16 md-offset-top-16"><div class="grid-wrap__col-lg-1 grid-wrap__col-md-1"></div><div class="grid-wrap__col-lg-7 grid-wrap__col-md-3 grid-wrap__col-sm-6 sm-offset-top-8"><div class=PGU-StepLoader__Content></div></div><div class="grid-wrap__col-lg-7 grid-wrap__col-md-3 grid-wrap__col-sm-6 sm-offset-top-8"><div class=PGU-StepLoader__Content></div></div></div><div class="grid-wrap__row lg-offset-top-16 md-offset-top-16 sm-offset-top-8"><div class="grid-wrap__col-lg-1 grid-wrap__col-md-1"></div><div class="grid-wrap__col-lg-21 grid-wrap__col-md-9 grid-wrap__col-sm-6"><div class=PGU-StepLoader__Content></div></div></div><div class="grid-wrap__row lg-offset-top-16 md-offset-top-16"><div class="grid-wrap__col-lg-1 grid-wrap__col-md-1"></div><div class="grid-wrap__col-lg-7 grid-wrap__col-md-3 grid-wrap__col-sm-6 sm-offset-top-8"><div class=PGU-StepLoader__Content></div></div><div class="grid-wrap__col-lg-7 grid-wrap__col-md-3 grid-wrap__col-sm-6 sm-offset-top-8"><div class=PGU-StepLoader__Content></div></div><div class="grid-wrap__col-lg-7 grid-wrap__col-md-3 grid-wrap__col-sm-6 sm-offset-top-8"><div class=PGU-StepLoader__Content></div></div></div></div></div></div><modal-dialog data-ng-if=modalShow show=modalShow hide-modal=hideModal() hide-outside-click=outsideHide><div ng-include src=modalTmpl class=PGU-Draft-Modal ng-if=modalShow></div></modal-dialog><modal-dialog data-ng-if=$root.esep.show data-show=$root.esep.show hide-modal=hideEsepPopupByCloseIcon() hide-outside-click=outsideHide><div ng-include src=esepResultTmpl ng-if=$root.esep.show></div></modal-dialog><modal-dialog data-ng-if=needEsep show=needEsep hide-outside-click=hideEsepInfoOutsideClick><div ng-include src=modalEsepTmpl ng-if=needEsep></div></modal-dialog></div></div></div>'),$templateCache.put("js/player/tmpl/finish-election-page.html",'<div class=PGU-Finish-Page><div class=grid-wrap><div class=grid-wrap__row><div class="grid-wrap__col-lg-17 grid-wrap__col-md-12 grid-wrap__col-sm-6"><div class=PGU-Finish-Page-Brdr></div></div></div><div class="grid-wrap__row PGU-Finish-Page-Advice align-self-center"><div class="grid-wrap__col-lg-2 grid-wrap__col-md-2 grid-wrap__col-sm-1"><span class="PGU-Icon PGU-Icon-Advice_Icon"></span></div><div class="grid-wrap__col-lg-15 grid-wrap__col-md-10 grid-wrap__col-sm-5"><h3 class=PGU-Service-h3 data-ng-bind-html=content.title></h3></div></div><div class=grid-wrap__row><div class="grid-wrap__col-offset-lg-2 grid-wrap__col-lg-15 grid-wrap__col-offset-md-2 grid-wrap__col-md-10 grid-wrap__col-offset-sm-1 grid-wrap__col-sm-5"><p class="PGU-Service-PlainText PGU-Finish-Page-Text" data-ng-bind-html=content.subTitle></p></div></div><div class="grid-wrap__row PGU-Finish-Page-Controls"><div class="grid-wrap__col-offset-lg-2 grid-wrap__col-lg-15 grid-wrap__col-offset-md-2 grid-wrap__col-md-10 grid-wrap__col-sm-6"><a data-ng-href={{content.orderLkLink}} class="PGU-Button PGU-Btn-Base PGU-Btn-Blue PGU-Button-whereIcon-after PGU-Btn-arrow-white-east PGU-Button-VA-BaseLine goto-lk-btn">Перейти в личный кабинет</a></div></div><div class=grid-wrap__row><div class="grid-wrap__col-lg-17 grid-wrap__col-md-12 grid-wrap__col-sm-6"><div class=PGU-Finish-Page-Brdr></div></div></div><epgu-throbber data-ng-if=electionData.loading data-throbber-type=PGU-throbber-big data-show-heading=true></epgu-throbber><div data-ng-if="!electionData.loading && !electionData.error"><div class="grid-wrap__row PGU-Finish-Page-Advice PGU-Icon-Vote_Icon"><div class="grid-wrap__col-lg-2 grid-wrap__col-md-2 grid-wrap__col-sm-1"><span class="PGU-Icon PGU-Icon-Advice_Icon"></span></div><div class="grid-wrap__col-lg-15 grid-wrap__col-md-10 grid-wrap__col-sm-5"><h3 class=PGU-Service-h3 data-ng-bind-html=electionData.title></h3></div></div><div class=grid-wrap__row><div class="grid-wrap__col-offset-lg-2 grid-wrap__col-lg-15 grid-wrap__col-offset-md-2 grid-wrap__col-md-10 grid-wrap__col-offset-sm-1 grid-wrap__col-sm-5"><p class="PGU-Service-PlainText PGU-Finish-Page-Text" data-ng-if=electionData.subTitle>{{electionData.subTitle}}</p><p class="PGU-Service-PlainText PGU-Finish-Page-Text" data-ng-if=electionData.sign>{{electionData.sign}}</p></div></div><div class="grid-wrap__row PGU-Finish-Page-Controls"><div class="grid-wrap__col-offset-lg-2 grid-wrap__col-lg-15 grid-wrap__col-offset-md-2 grid-wrap__col-md-10 grid-wrap__col-sm-6"><a data-ng-click=electionData.orderLink() class="PGU-Button PGU-Btn-Base PGU-Btn-Blue PGU-Button-whereIcon-after PGU-Btn-arrow-white-east PGU-Button-VA-BaseLine goto-lk-btn">Подать заявление</a></div></div></div></div></div>'),$templateCache.put("js/player/tmpl/finish-page.html",'<div class=PGU-Finish-Page><div class=grid-wrap><div class=grid-wrap__row><div class="grid-wrap__col-lg-17 grid-wrap__col-md-12 grid-wrap__col-sm-6"><div class=PGU-Finish-Page-Brdr></div></div></div><div class="grid-wrap__row PGU-Finish-Page-Advice"><div class="grid-wrap__col-lg-2 grid-wrap__col-md-2 grid-wrap__col-sm-1"><span class="PGU-Icon PGU-Icon-Advice_Icon"></span></div><div class="grid-wrap__col-lg-15 grid-wrap__col-md-10 grid-wrap__col-sm-5"><h3 class=PGU-Service-h3 data-ng-bind-html=content.title></h3></div></div><div class=grid-wrap__row><div class="grid-wrap__col-offset-lg-2 grid-wrap__col-lg-15 grid-wrap__col-offset-md-2 grid-wrap__col-md-10 grid-wrap__col-offset-sm-1 grid-wrap__col-sm-5"><p class="PGU-Service-PlainText PGU-Finish-Page-Text" data-ng-bind-html=content.subTitle></p></div></div><div class="grid-wrap__row PGU-Finish-Page-Contacts" data-ng-if=contact.show data-ng-repeat="contact in contacts"><div class="PGU-Finish-Page-Contact-Name grid-wrap__col-offset-lg-2 grid-wrap__col-lg-4 grid-wrap__col-offset-md-2 grid-wrap__col-md-4 grid-wrap__col-offset-sm-1 grid-wrap__col-sm-5"><span class="PGU-PlainText PGU-PlainText-Bold">{{contact.label}}</span></div><div class="grid-wrap__col-lg-9 grid-wrap__col-md-6 grid-wrap__col-offset-sm-1 grid-wrap__col-sm-5"><span class=PGU-PlainText data-ng-if=contact.value>{{contact.value}}</span> <a data-ng-if=!contact.value target=_blank data-ng-href={{esiaUrlProfile}}>{{contact.linkLabel}}</a></div></div><div class="grid-wrap__row PGU-Finish-Page-Controls"><div class="grid-wrap__col-offset-lg-2 grid-wrap__col-lg-15 grid-wrap__col-offset-md-2 grid-wrap__col-md-10 grid-wrap__col-sm-6"><a data-ng-href={{content.orderLkLink}} class="PGU-Button PGU-Btn-Base PGU-Btn-Blue PGU-Button-whereIcon-after PGU-Btn-arrow-white-east PGU-Button-VA-BaseLine goto-lk-btn">Перейти в личный кабинет</a> <a data-ng-if=showNotificationsChange data-ng-href={{content.lkLink}} class=PGU-Finish-Page-Notification>Изменить настройки уведомлений</a></div></div><div class=grid-wrap__row><div class="grid-wrap__col-lg-17 grid-wrap__col-md-12 grid-wrap__col-sm-6"><div class=PGU-Finish-Page-Brdr></div></div></div><banner-place data-banners=typ_op_banner></banner-place><div class=grid-wrap__row><div class="grid-wrap__col-lg-17 grid-wrap__col-md-12 grid-wrap__col-sm-6"><div class=PGU-Finish-Page-Brdr></div></div></div><div class="grid-wrap__row PGU-Finish-Page-More"><div class="grid-wrap__col-lg-8 grid-wrap__col-md-6 grid-wrap__col-sm-6 about-service"><a data-ng-href={{serviceCardUrl}}>Подробнее об услуге на портале gosuslugi.ru</a></div><div class="grid-wrap__col-lg-9 grid-wrap__col-md-6 grid-wrap__col-sm-6"><div class=PGU-Finish-Page-Logo></div></div></div></div></div>'),$templateCache.put("js/player/tmpl/modal-draft.html",'<div class=draft><div ng-if="listMode !== \'L\' && !hubMode"><h3 class=PGU-Service-h3>У вас есть сохраненный черновик</h3><h4>{{::date}} г. вы уже начали заполнять заявление на получение услуги.</h4><h4>Все введенные данные были сохранены.</h4><div class=x-wrapper__button style="padding-top: 10px; margin-left: 22%; padding-bottom: 10px;"><span class="PGU-btn-base PGU-continue-draft" ng-click=continueDraft()>Продолжить заполнять</span> <span style="padding: 15px;" class=or>или</span> <a class=PGU-new-draft ng-click=newDraft()>Начать заново</a></div></div><div ng-if="listMode && (!hubMode || (hubMode && listMode === \'L\'))" class=PGU-draft-list-mode><h3 class=PGU-Service-h3>Выберите существующий черновик заявления или начните оформление заявления заново</h3><p class=PGU-modal-draft-subtitle><strong>Услуга:</strong>&nbsp;<span class=PGU-draft-service-name> {{::serviceName}}</span></p><div class=PGU-DraftContainerListWrap><div ng-repeat="draft in drafts" class=PGU-DraftListFlexRow ng-click="selectDraft(evt, $index)" ng-class="{\'PGU-DraftListFlexRowActive\': draftCurrentItem === $index}"><div class=PGU-DraftItemName ng-if=!hubMode><strong style=color:#000;>Заявление №{{::draft.id}}</strong> <span ng-if=draft.description>{{::draft.description}}</span></div><div class=PGU-DraftItemName ng-if=hubMode><strong style=color:#000;>Заявление №{{::draft.id}}</strong> <span data-ng-show="draft.draftRegionName && draft.draftRegionName !== \'notFound\'">({{draft.draftRegionName}})</span><br><span ng-if=draft.description>{{::draft.description}}</span></div><div class=PGU-DraftItemDate>{{::draft.date}}</div></div></div><epgu-field-radio item=radioItem></epgu-field-radio><div class="PGU-Panel-WithRadioBtn PGU-Panel-WithRadioBtnDraft" ng-show="(currentOrderId === \'\')"><epgu-field-text item=textItem></epgu-field-text></div><div class="x-wrapper__button PGU-continue-draft-wrap"><span class="PGU-Button PGU-Btn-Base PGU-Btn-Blue PGU-continue-draft" ng-click=continueDraft()>Продолжить</span></div></div><div class=b-hubMode ng-if="hubMode && listMode !== \'L\'"><div data-ng-if=!emptyDruft><h3 class=PGU-Service-h3>Выберите существующий черновик заявления или начните оформление заявления заново</h3><div class="b-hubMode-radio fake-button"><label><input data-ng-change="hubData.selectRegion = false" name=gender ng-model=hubData.selected data-ng-value="\'Old\'" class=real-button type=radio><div class="radio-action item-radio"></div><div class=b-hubMode-radio__item><div>Заявление №{{hubDate.number}}</div><span class=x-mobile-block><div>&nbsp;(</div><div data-ng-show=hubDate.region class=b-hubMode-radio__item-region>{{hubDate.region}}</div><div>)</div><div class=b-hubMode-radio__item-time>{{hubDate.time}}</div></span></div></label> <label><input data-ng-change="hubData.selectRegion = false" name=gender ng-model=hubData.selected data-ng-value="\'New\'" class=real-button type=radio><div class="radio-action item-radio"></div><div class=b-hubMode-radio__item><div>Оформить новое заявление</div><span class=x-mobile-block><div data-ng-show=currentRegion>&nbsp;(</div><div data-ng-show=currentRegion class=b-hubMode-radio__item-region>{{currentRegion}}</div><div data-ng-show=currentRegion>)</div></span></div></label></div><pgu-simple-button attr-label="\'Продолжить\'" attr-visible="hubData.selected && hubData.selected === \'Old\'" attr-action-click=continueDraft(hubDate.regionSelected)></pgu-simple-button><pgu-simple-button attr-label="\'Продолжить\'" attr-visible="hubData.selected && hubData.selected !== \'Old\'" attr-disabled="(hubData.selected === \'New\' && hubData.selectRegion && !hubDate.regionSelected)" attr-action-click=newDraft(hubDate.regionSelected)></pgu-simple-button><label ng-show="hubData.selected && hubData.selected !== \'Old\'" class="x-pseudo-link dashed x-show-select-place"><input class=x-hide type=checkbox ng-model=hubData.selectRegion> <span>Изменить местоположение</span></label><pgu-region-selected ng-show="hubData.selected === \'New\' && hubData.selectRegion"></pgu-region-selected></div></div></div>'),$templateCache.put("js/player/tmpl/modal-editable-data-grid-confirm-remove.html",'<div class=PGU-EditableDataGrid-PopupConfirmRemove><div class=grid-wrap><div class="grid-wrap__row PGU-EditableDataGrid-PopupConfirmRemove-Advice PGU-Advice-Type_Warn align-items-center"><div class="grid-wrap__col-lg-2 grid-wrap__col-md-2 grid-wrap__col-sm-1"><span class="PGU-Icon PGU-Icon-Advice_Icon"></span></div><div class="grid-wrap__col-lg-12 grid-wrap__col-md-10 grid-wrap__col-sm-5"><h3 class=PGU-Service-h3>{{(item.fullPath + \'.ReestrPopupDelete\' | translate:popupConfirmRemove.getTitle(popupConfirmRemove.from):\'Title\') || popupConfirmRemove.getTitle(popupConfirmRemove.from)}}</h3></div></div><div class=grid-wrap__row><div class="grid-wrap__col-offset-lg-2 grid-wrap__col-lg-12 grid-wrap__col-offset-md-2 grid-wrap__col-md-10 grid-wrap__col-offset-sm-1 grid-wrap__col-sm-5 pipira"><p class=PGU-PlainText>{{(item.fullPath + \'.ReestrPopupDelete\' | translate:popupConfirmRemove.removeMsg:\'Text\') || popupConfirmRemove.removeMsg}}</p></div></div><div class=grid-wrap__row><div class="grid-wrap__col-lg-17 grid-wrap__col-md-12 grid-wrap__col-sm-6 lg-offset-top-16 md-offset-top-16 sm-offset-top-16"><div class=PGU-EditableDataGrid-PopupConfirmRemove-Brdr></div></div></div><div class=grid-wrap__row><div class="grid-wrap__col-lg-17 grid-wrap__col-md-12 grid-wrap__col-sm-6 lg-offset-top-8 md-offset-top-8 sm-offset-top-16 flex-container justify-between sm-flex-column-reverse"><div><a class="PGU-Button PGU-Btn-Base" data-ng-click=popupConfirmRemove.toggleVisible(false)><span class=PGU-Btn-Text>{{(item.fullPath + \'.ReestrPopupDelete\' | translate:popupConfirmRemove.btnBack:\'BtnBack\') || popupConfirmRemove.btnBack}}</span></a></div><div><a class="PGU-Button PGU-Btn-Base PGU-Btn-Blue" data-ng-click=popupConfirmRemove.confirmed()><span class=PGU-Btn-Text>{{(item.fullPath + \'.ReestrPopupDelete\' | translate:popupConfirmRemove.btnDelete:\'BtnDelete\') || popupConfirmRemove.btnDelete}}</span></a></div></div></div></div></div>'),$templateCache.put("js/player/tmpl/modal-editable-data-grid.html",'<div class="PGU-EditableDataGrid-PopupContent PGU-EditableDataGrid-Dialog_version_flex flex-container flex-column"><div class=PGU-EditableDataGrid-Dialog__Body data-ng-show="ui.state === \'form\'"><div class=PGU-Modal-Step><div><h3 data-ng-show=::!item.popupTitle class=PGU-Service-h3>Строка приложения № {{grid.currentItem}}</h3><h3 data-ng-show=::item.popupTitle class=PGU-Service-h3><span data-ng-if=::!item.isNumberFirstInPopupTitle>{{(item.fullPath + \'.popupTitle\' | translate:item.popupTitle) || item.popupTitle}} № {{grid.currentItem}} </span><span data-ng-if=::item.isNumberFirstInPopupTitle>№ {{grid.currentItem}} {{(item.fullPath + \'.popupTitle\' | translate:item.popupTitle) || item.popupTitle}}</span></h3><div>{{item.customUploaderState.fileName}}</div><form-tree data-ng-repeat="item_i in item.dialogItems track by $index" item=item_i></form-tree><div data-ng-show=consentOfThirdPartiesError class=PGU-EditableDataGrid-ConsentOfThirdPartiesError>{{consentOfThirdPartiesError}}</div></div></div></div><div class=PGU-EditableDataGrid-Dialog__Footer data-ng-show="ui.state === \'form\'"><div class=PGU-EditableDataGrid-Dialog__Footer-Buttons><epgu-form-button item=ui.btnCancel click-handler-btn=toggleModalVisible click-attr=(false)></epgu-form-button><epgu-form-button item=ui.btnSave click-handler-btn=saveFormData click-attr=(false)></epgu-form-button></div></div><div class=PGU-EditableDataGrid-Dialog__Body data-ng-show="ui.state === \'upload\' && (uploader.state === \'info\' || uploader.state === \'error\')"><h3 data-ng-show="uploader.state === \'info\'" class=PGU-Service-h3>Загрузка приложений из файла</h3><div><div class=PGU-DetailsDialog data-ng-if="uploader.state === \'error\'"><advice-simple-sf data-ng-if="uploader.state === \'error\'" title={{uploader.errorTitle}} type=PGU-Advice-Type_Warn></advice-simple-sf><p data-ng-show=ui.attachmentErrorReportUrl>Вы&nbsp;можете исправить файл на основании отчета об ошибках</p><div class=PGU-DownloadFile data-ng-show=ui.attachmentErrorReportUrl><div class=PGU-DownloadFile-Icon><img data-ng-src={{::imgSrc}} alt="Иконка приложения"></div><div class=PGU-DownloadFile-Description><span class="PGU-DownloadFile-Name PGU-PlainText">Отчет об ошибках </span><a class=PGU-Link download={{ui.attachmentErrorReportName}} data-ng-href={{ui.attachmentErrorReportUrl}}>{{::item.fileInfoSaveLinkText}}</a></div></div></div><p data-ng-if="uploader.state === \'info\'">Вы&nbsp;можете заполнить приложение к&nbsp;заявлению путем загрузки текстового файла</p><a class="PGU-Link PGU-Link-showDetails PGU-Link-with-toggle-arrow" data-ng-click=toggleDetailsDialog() data-ng-class="{\'PGU-Link-with-toggle-arrow-up\': ui.detailsDialogShow}"><span class=PGU-LinkText>Требования к файлу</span></a><div class=PGU-DetailsDialog data-ng-show=ui.detailsDialogShow><div class=PGU-EditableDataGrid-DetailsContent ng-bind-html="item.instructions | to_trusted"></div><div class="PGU-Fluid-Row PGU-EditableDataGrid-PGU-DownloadFiles"><div class=PGU-Col-12><div class=PGU-DownloadFile data-ng-show=item.attachmentTemplateUrl><div class=PGU-DownloadFile-Icon><img data-ng-src={{::imgSrc}} alt="Иконка приложения"></div><div class=PGU-DownloadFile-Description><span class="PGU-DownloadFile-Name PGU-PlainText">Шаблон заполнения приложения</span> <a class=PGU-Link target=_blank download data-ng-href={{::item.attachmentTemplateUrl}}>{{::item.fileInfoSaveLinkText}}</a></div></div></div><div class=PGU-Col-12><div class=PGU-DownloadFile data-ng-show=item.attachmentExampleUrl><div class=PGU-DownloadFile-Icon><img data-ng-src={{::imgSrc}} alt="Иконка приложения"></div><div class=PGU-DownloadFile-Description><span class="PGU-DownloadFile-Name PGU-PlainText">Пример заполнения</span> <a class=PGU-Link target=_blank download data-ng-href={{::item.attachmentExampleUrl}}>{{::item.fileInfoSaveLinkText}}</a></div></div></div></div></div></div></div><div data-ng-show="ui.state === \'upload\' && (uploader.state === \'info\' || uploader.state === \'error\')"><div class=PGU-EditableDataGrid-Dialog__Footer><div class=PGU-Separator></div><div class="x-wrapper__button cf PGU-EditableDataGrid-Dialog__Footer-Buttons-Upload"><epgu-form-button item=ui.btnUploadCancel click-handler-btn=toggleModalVisible click-attr=(false)></epgu-form-button><div class=PGU-EditableDataGrid-UploadBtn-Wrap><div id={{::item.fullPath}}:upload class=PGU-BtnHolder><div class=PGU-Btn-margin-PGU-Button-align-right><a data-ng-href=# class="PGU-Button PGU-Btn-Base PGU-Btn-Blue">{{item.uploadButtonName}}</a></div></div></div></div></div></div><div class=PGU-EditableDataGrid-Dialog__Body data-ng-if="uploader.state === \'success\'"><advice-simple-sf data-ng-if="uploader.state === \'success\'" title={{uploader.successTitle}} type=""></advice-simple-sf><p>Вы&nbsp;можете отредактировать или удалить строки приложения после добавления на&nbsp;форму</p></div><div data-ng-if="uploader.state === \'success\'"><div class=PGU-Separator></div><div class="x-wrapper__button cf PGU-EditableDataGrid-Dialog__Footer-Buttons-Upload"><epgu-form-button item=ui.btnReturnToUpload click-handler-btn=cancelUploaded click-attr=(false)></epgu-form-button><epgu-form-button item=ui.btnUploadSave click-handler-btn=applyUploaded click-attr=(false)></epgu-form-button></div></div></div>'),$templateCache.put("js/player/tmpl/modal-esep.html",'<div ng-class="{\n        \'PGU-ESEPError\': $root.esep.errorMsg\n     }"><div class=PGU-PopupESEPTitle><h3 class=PGU-Service-h3>Заявление было заверено электронной подписью и&nbsp;готово к&nbsp;отправке в&nbsp;ведомство.</h3><p>Что вы&nbsp;хотите сделать дальше?</p></div><advice-simple-sf ng-if=$root.esep.errorMsg title="Что-то пошло не так" type=PGU-Advice-Type_Not>{{$root.esep.errorMsg}}</advice-simple-sf><div class="PGU-FormStepEditActions button-modifier-esep"><div class=PGU-PopupESEPButton><epgu-form-button item=$root.esep.btnFormEdit click-handler-btn=formEdit></epgu-form-button><epgu-form-button ng-if=!$root.esep.errorMsg item=$root.esep.btnSubmitForm click-handler-btn=submitForm></epgu-form-button><epgu-form-button ng-if="$root.esep.errorMsg && !$root.env.isNeedCaptcha && !$root.esep.esepPreviewError" item=$root.esep.btnSubmitFormSign click-handler-btn=submitForm></epgu-form-button></div></div></div>'),$templateCache.put("js/player/tmpl/modal-fias-dadata.html",'<div class=draft><h3 class=PGU-Service-h3>Подтвердите адрес</h3><p>Невозможно сохранить введенный адрес:<br>{{model.popup.userAddress}}</p><p>Скорее всего, такого адреса нет <a target=_blank href=http://fias.nalog.ru/ class=PGU-Link>в системе учета адресов РФ</a>.<br>Возможно, вы имели ввиду:<br><strong>{{model.popup.normalizeAddress}}</strong></p><p>Сохранить этот адрес?</p><div class=x-wrapper__button style="margin: 20px 0;"><span class="PGU-Button PGU-Btn-Base PGU-Btn-White" style="margin:0 20px 20px 0;" ng-click=editAddress()>Нет, вернуться к редактированию</span> <span class="PGU-Button PGU-Btn-Base PGU-Btn-Blue" ng-click=saveAddress()>Да, сохранить предложенный</span></div></div>'),$templateCache.put("js/player/tmpl/modal-image-editor.html",'<div class=PGU-ImageEditor-popup-content ng-class="{\'custom-sized\': item.isCustomSized}"><div ng-if="isPhone && !$root.settings.mobOptimizeImageEditor" class=PGU-ImageEditor-TopBar><a class="PGU-Link PGU-ImageEditor-Link-back" ng-click="ui.toggleModalVisible(false, $event)">Назад</a></div><div ng-if="isPhone && $root.settings.mobOptimizeImageEditor" class=PGU-ImageEditor-TopBar><a class=PGU-ImageEditor-Link-back ng-click="ui.toggleModalVisible(false, $event)"></a></div><h3 class=PGU-Service-h3 ng-show="(!isPhone || item.isCustomSized) && ui.fileState !== \'uploaded\' && !ui.clientEditError">Загрузка фотографии</h3><h3 class=PGU-Service-h3 ng-show="(!isPhone || item.isCustomSized) && ui.fileState === \'uploaded\'">Обрезка фотографии</h3><div class=PGU-ModalStep data-ng-class="{showDetails: ui.isDetailsDialogShow}"><div class=PGU-ModalStep-Inner ng-show="ui.modalState === \'info\'"><advice-simple-sf ng-if=ui.clientEditError title={{ui.clientEditError}} type=PGU-Advice-Type_Warn></advice-simple-sf><div data-ng-show=!ui.totalFileSizeError><div class="PGU-image-editor__descr__content pgu-panel-html" ng-bind-html="item.html | to_trusted"></div><a data-ng-if=!item.isCustomSized class="PGU-Link PGU-Link-showDetails PGU-Link-with-toggle-arrow" ng-click=toggleDetailsDialog() ng-class="{\'PGU-Link-with-toggle-arrow-up\': ui.isDetailsDialogShow}"><span class=PGU-LinkText>Все требования</span></a><div class=PGU-DetailsDialog ng-show=ui.isDetailsDialogShow><div class=PGU-DetailsContent ng-bind-html="item.instructions | to_trusted"></div></div></div></div><div class=PGU-ModalStep-Inner ng-show="ui.modalState === \'upload\'"><div class="PGU-ImageEditor PGU-ImageEditorDialog"><div id=imageEditorImageView><div class=imageEditor><div class=PGU-ImageEditorInfoMove ng-if="!isPhone || item.isCustomSized"><span class="PGU-Icon PGU-Icon-move"></span> <span class=PGU-ImageEditorInfoMoveText>Перетащите, чтобы изменить положение</span></div><div ng-if=!item.isCustomSized class=PGU-ImageEditorLines><svg version=1.1 id=Слой_3 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink x=0px y=0px width=365px height=236px viewBox="0 0 365 236" style="enable-background:new 0 0 365 236;" xml:space=preserve class=PGU-ImageEditor-LineSVG><style>.PGU-ImageEditor-st0 {\n                                    fill: #535B63;\n                                }\n                                .PGU-ImageEditor-st1 {\n                                    font-family: \'Helvetica\', \'Arial\', sans-serif;\n                                }\n                                .PGU-ImageEditor-st2 {\n                                    font-size: 12px;\n                                }\n\n                                .PGU-ImageEditor-st3 {\n                                    opacity: 0.3;\n                                }\n                                .PGU-ImageEditor-st5 {\n                                    fill: none;\n                                    stroke: #000000;\n                                    stroke-miterlimit: 10;\n                                    stroke-dasharray: 5, 5;\n                                }</style><text data-ng-repeat="item in ::customText" ng-attr-transform=matrix{{::item.matrix}} class="PGU-ImageEditor-st0 PGU-ImageEditor-st1 PGU-ImageEditor-st2">{{::item.text}}</text><g class=PGU-ImageEditor-st3 data-ng-repeat="line in ::customLines"><g><line class=PGU-ImageEditor-st5 x1=0 ng-attr-y1={{line.y}} ng-attr-y2={{line.y}} x2=360 /></g></g></svg> <svg width=232px height=178px viewBox="0 0 232 178" version=1.1 xmlns=http://www.w3.org/2000/svg class=PGU-ImageEditor-LineSVG__mob-optimize xmlns:xlink=http://www.w3.org/1999/xlink><title>foto_guides</title><desc>Created with Sketch.</desc><defs></defs><g id=Fotoredaktor stroke=none stroke-width=1 fill=none fill-rule=evenodd><g id=Photoredaktor/iPhone-SE-Copy-3 transform="translate(-53.000000, -116.000000)"><g id=foto_guides transform="translate(53.000000, 115.000000)"><path d="M0.5,1.5 L227.729996,1.5" id=Line stroke=#666666 stroke-linecap=square></path><path d="M0.5,178.5 L227.729996,178.5" id=Line-Copy stroke=#666666 stroke-linecap=square></path><g id=Group-6 transform="translate(223.000000, 2.000000)" fill=#666666><polygon id=Combined-Shape points="4.5 1.60800171 1.28104858 5.83718872 0.5 5.11825562 4.5 0 8.5 5.11825562 7.71895142 5.92306519"></polygon><polygon id=Combined-Shape-Copy-2 transform="translate(4.500000, 173.961533) scale(1, -1) translate(-4.500000, -173.961533) " points="4.5 172.608002 1.28104858 176.837189 0.5 176.118256 4.5 171 8.5 176.118256 7.71895142 176.923065"></polygon><rect id=Rectangle-7 x=4 y=1 width=1 height=175></rect></g></g></g></g></svg></div><div class=imageEditorAreaOuterWrapper><div class=imageEditorAreaWrapper ng-style=ui.customStyles><div class=imageEditorAreaBackground ng-style=ui.customStyles></div><div class=imageEditorProgressBox ng-show=ui.showProgressBar><h6 class=imageEditorProgressBoxTitle>Идет загрузка...</h6><div class=imageEditorProgressBoxContent><a class="imageEditorCancelUpload js-imageEditorCancelUpload" href=#></a><span class=imageEditorProgressBoxLine> <span class="imageEditorProgressBoxBar js-imageEditorProgressBoxBar" ng-style="{\'width\' : ui.progressBarPercent}"></span></span></div><span class="imageEditorPercents js-imageEditorPercents">{{ui.progressBarPercent}}</span></div><div class=PGU-ImageEditorAreaInner id=guide ng-style=ui.customStyles><div class="imageEditorArea imageEditorAreaPopup" ng-class="{\'imageEditorAreaWithProgress\': ui.showProgressBar}" id=guide_frame ng-style=ui.customStyles></div><div class=PGU-ImageEditorDnDContainer></div></div></div></div><div class=PGU-ImageEditorCanvasWrap></div><div class="imageEditorControlsDialog cf" data-ng-class="{\'customSized\' : item.isCustomSized}"><a class="imageEditorControl imageRotateRight buttonIcon biRotateAgain" ng-click="ui.clientEdit(ui.actions.imageRotateRightEnabled, \'rotate\', \'right\')" ng-class="{\'disabled\': !ui.actions.imageRotateRightEnabled}" title={{::item.rotateRightButton}}><span class="PGU-Icon PGU-icon_image-editor-button"></span> </a><a ng-if=!isPhone class="imageEditorControl imageZoomMinus buttonIcon" ng-click="ui.clientEdit(ui.actions.imageZoomEnabled, \'zoom\', \'minus\')" ng-class="{\'disabled\': !ui.actions.imageZoomEnabled}" title={{::item.imageZoomMinus}}><span class="PGU-Icon PGU-icon_image-editor-button"></span></a><div ng-if=isDesktop class=PGU-ImageEditor-Slider><span class=PGU-ImageEdtior-Slider-line></span> <span class=PGU-ImageEditor-Slider-Icon></span></div><a ng-if=!isPhone class="imageEditorControl imageZoomPlus buttonIcon" ng-click="ui.clientEdit(ui.actions.imageZoomEnabled, \'zoom\', \'plus\')" ng-class="{\'disabled\': !ui.actions.imageZoomEnabled}" title={{::item.imageZoomPlus}}><span class="PGU-Icon PGU-icon_image-editor-button"></span></a></div><div data-ng-show=ui.isNotMoreAction class="PGU-FieldError PGU-Text-Centered lg-offset-top-16 md-offset-top-16">Параметры фотографии не позволяют редактирования</div></div><canvas id=canvas></canvas><div class=imageEditorPreviewErr ng-show="ui.stateShow && !ui.fileReaderMode"><span class="PGU-Icon PGU-Icon-ImageEditorPreviewState" ng-class="{\'PGU-Icon-ImageEditorPreviewStateError\': ui.errorCode}"></span><span class="red PGU-ImageEditorStateMsg js-PGU-ImageEditorStateMsg" ng-bind-html="(item.error || \'\') | to_trusted"></span></div></div></div></div></div><div data-ng-if=!$root.settings.mobOptimizeImageEditor class="x-wrapper__button cf"><epgu-form-button item=ui.btnSave click-handler-btn=ui.saveChanges ng-if="(ui.modalState === \'upload\' && !ui.showProgressBar)"></epgu-form-button><epgu-form-button item=ui.btnCancel click-handler-btn=ui.toggleModalVisible click-attr=(false) ng-if="(isDesktop || isTablet || ui.modalState === \'upload\')"></epgu-form-button><div class=PGU-ImageEditor-UploadBtn-Wrap ng-show="(ui.modalState === \'info\')"><div id={{::item.fullPath}}:upload class="PGU-BtnHolder PGU-Button-align-right PGU-BtnContainer-column"><div class=PGU-Btn-margin-PGU-Button-align-right><a ng-href=# class="PGU-Button PGU-Btn-Base PGU-Btn-Blue" action="">{{item.btnName}}</a></div></div></div></div><div data-ng-if=$root.settings.mobOptimizeImageEditor class=x-wrapper__button ng-class="{\'uploaded\':(ui.modalState === \'upload\')}"><div class=PGU-ImageEditor-UploadBtn-Wrap id={{::item.fullPath}}:upload><div class="PGU-BtnHolder PGU-BtnHolder-Image-Editor"><div><a data-ng-href="" data-ng-class="{\n                            \'PGU-Button\': true,\n                            \'PGU-Btn-Base\': true,\n                            \'PGU-Btn-Small\': true,\n'+"                            'PGU-Btn-Blue':(ui.modalState === 'info'),\n                            'PGU-Btn-White':(ui.modalState === 'upload'),\n                            'PGU-Btn-Base-mode-link': (ui.modalState === 'upload')\n                        }\"><span data-ng-show=\"(ui.modalState === 'info')\" data-ng-bind=item.btnName></span> <span data-ng-show=\"(ui.modalState === 'upload' && !ui.showProgressBar)\" data-ng-bind-html=item.btnLoadAgain></span></a></div></div></div><div class=imageEditorLoad><epgu-form-button item=ui.btnSave click-handler-btn=ui.saveChanges ng-if=\"(ui.modalState === 'upload' && !ui.showProgressBar)\"></epgu-form-button></div></div></div>"),
$templateCache.put("js/player/tmpl/modal-need-esep.html",'<div class=esep-warn><div class=cf data-ng-if="$root.version != \'pad\' && $root.version != \'mob\'"><div class=row><header class="span_12 offset_span_2"><h3 class="PGU-Service-h3 PGU-Advice-Type_Warn"><span class="PGU-Icon PGU-Icon-Advice_Icon"></span> <span>Заявление необходимо будет подписать квалифицированной электронной подписью</span></h3></header></div><div class=row><section class=span_14><span class=PGU-PlainText>{{showedTitle}} <a ng-href={{faqUrl}} target=_blank>квалифицированной электронной подписью гражданина</a>.</span></section></div><div class=row><section class=span_14><div class=x-wrapper__button><span class="PGU-Button PGU-Btn-Base PGU-Btn-White" ng-click=backToCard()>Вернуться</span> <span class="PGU-Button PGU-Btn-Base PGU-Btn-Blue" ng-click=confirmEsepInfo()>Продолжить</span></div></section></div></div><div class=cf data-ng-if="$root.version == \'pad\'"><div class=row><header class="col-10 col-offset-2"><h3 class="PGU-Service-h3 PGU-Advice-Type_Warn"><span class="PGU-Icon PGU-Icon-Advice_Icon"></span> <span>Заявление необходимо будет подписать квалифицированной электронной подписью</span></h3></header></div><div class=row><section class=col-12><span class=PGU-PlainText>{{showedTitle}} <a ng-href={{faqUrl}} target=_blank>квалифицированной электронной подписью гражданина</a>.</span></section></div><div class=row><section class=col-12><div class=x-wrapper__button><span class="PGU-Button PGU-Btn-Base PGU-Btn-White" ng-click=backToCard()>Вернуться</span> <span class="PGU-Button PGU-Btn-Base PGU-Btn-Blue" ng-click=confirmEsepInfo()>Продолжить</span></div></section></div></div><div class=cf data-ng-if="$root.version == \'mob\'"><div class=PGU-FMWLPhone-Link-back ng-click=backToCard()><span>Назад</span></div><div class=fluid-row><header class="col-5 col-offset-1"><h3 class="PGU-Service-h3 PGU-Advice-Type_Warn"><span class="PGU-Icon PGU-Icon-Advice_Icon"></span> <span>Заявление необходимо будет подписать квалифицированной электронной подписью</span></h3></header></div><div class=fluid-row><section class=col-6><span class=PGU-PlainText>{{showedTitle}} <a ng-href={{faqUrl}} target=_blank>квалифицированной электронной подписью гражданина</a>.</span></section></div><div class=fluid-row><section class=col-6><div class=x-wrapper__button><span class="PGU-Button PGU-Btn-Base PGU-Btn-White" ng-click=backToCard()>Вернуться</span> <span class="PGU-Button PGU-Btn-Base PGU-Btn-Blue" ng-click=confirmEsepInfo()>Продолжить</span></div></section></div></div></div>'),$templateCache.put("js/player/tmpl/modal-sms-confirm.html",'<div class="PGU-SMSConfirmDialogPopupContent grid-wrap"><div class="grid-wrap__row justify-center"><div class="grid-wrap__col-lg-12 grid-wrap__col-md-12 grid-wrap__col-sm-6"><h3 data-ng-if=!popup.rejectError class="PGU-Service-h3 PGU-lg-Text-Centered PGU-md-Text-Centered">Подтвердите отправку заявления</h3><h3 data-ng-if="popup.rejectError && !popup.rejectErrorServerData" class="PGU-Service-h3 PGU-lg-Text-Centered PGU-md-Text-Centered">Вы ввели неверный код больше {{::popup.orderSmsConfRestrictionPerUser}} и исчерпали все попытки</h3><div data-ng-if="popup.rejectError && !popup.rejectErrorServerData" class="PGU-lg-Text-Centered PGU-md-Text-Centered"><p class="PGU-PlainText lg-offset-top-24 md-offset-top-24 sm-offset-top-24 lg-offset-bottom-4 md-offset-bottom-4 sm-offset-bottom-4">Мы заблокировали отправку кода на {{::popup.orderSmsConfDaysRestriction}} для номера <strong>{{::popup.userPhone}}</strong>.</p><p class="PGU-PlainText lg-offset-top-24 md-offset-top-24 sm-offset-top-24 lg-offset-bottom-4 md-offset-bottom-4 sm-offset-bottom-4">Подайте заявление после разблокировки. Или запросите код сейчас на другой номер телефона, если он у вас есть. Для этого измените действующий номер в <a href data-ng-click=btnChangePhone()>вашем профиле</a>.</p><div class="PGU-SMSConfirmDialogWrapButtons cf"><epgu-form-button item=popup.btnChangePhone click-handler-btn=btnChangePhone click-attr=(true)></epgu-form-button></div></div><div data-ng-if="(!popup.rejectError || popup.rejectError && popup.rejectErrorServerData) && !popup.error500"><p class="PGU-PlainText lg-offset-top-24 md-offset-top-24 sm-offset-top-24 lg-offset-bottom-4 md-offset-bottom-4 sm-offset-bottom-4">Введите код подтверждения из SMS-сообщения, отправленного на номер</p><div class="lg-offset-top-4 md-offset-top-4 sm-offset-top-4"><strong>{{popup.userPhone}}</strong></div></div><div data-ng-if="popup.rejectError && popup.rejectErrorServerData"><p class="PGU-FieldError PGU-PlainText lg-offset-top-24 md-offset-top-24 sm-offset-top-24 lg-offset-bottom-4 md-offset-bottom-4 sm-offset-bottom-4">Превышено количество попыток отправки кода. Вы сможете запросить новый код</p><p class="PGU-FieldError PGU-PlainText lg-offset-top-24 md-offset-top-24 sm-offset-top-24 lg-offset-bottom-4 md-offset-bottom-4 sm-offset-bottom-4">через <span>{{popup.counterReject}}</span></p></div><div data-ng-if=popup.error500><p class="PGU-FieldError PGU-PlainText lg-offset-top-24 md-offset-top-24 sm-offset-top-24 lg-offset-bottom-4 md-offset-bottom-4 sm-offset-bottom-4">Произошла ошибка при отправке СМС с кодом подтверждения</p><p class="PGU-FieldError PGU-PlainText lg-offset-top-24 md-offset-top-24 sm-offset-top-24 lg-offset-bottom-4 md-offset-bottom-4 sm-offset-bottom-4">Пожалуйста, повторите запрос кода еще раз.</p></div></div></div><div data-ng-if="!popup.rejectError && !popup.error500" class="grid-wrap__row justify-center"><div class="grid-wrap__col-lg-12 grid-wrap__col-md-12 grid-wrap__col-sm-6"><div class=PGU-SMSConfirmDialogInputWrap><form-tree data-ng-repeat="item_i in item.items track by $index" item=item_i></form-tree></div></div></div><div class="grid-wrap__row justify-center lg-offset-top-8 md-offset-top-8 sm-offset-top-8" data-ng-show=popup.errorMessage><div class="grid-wrap__col-lg-12 grid-wrap__col-md-12 grid-wrap__col-sm-6"><div class=PGU-FieldError>{{popup.errorMessage}}</div></div></div><div data-ng-if=!popup.rejectError class="grid-wrap__row justify-center lg-offset-top-36 md-offset-top-32 sm-offset-top-12"><div class="grid-wrap__col-lg-12 grid-wrap__col-md-12 grid-wrap__col-sm-6"><div class="PGU-SMSConfirmDialogWrapButtons cf"><epgu-form-button item=popup.btnApply click-handler-btn=checkCode click-attr=(true)></epgu-form-button></div></div></div><div data-ng-if="!popup.rejectError && !popup.error500" class="grid-wrap__row justify-center lg-offset-top-16 md-offset-top-16 sm-offset-top-24" data-ng-show=popup.counter><div class="grid-wrap__col-lg-12 grid-wrap__col-md-12 grid-wrap__col-sm-6 PGU-sm-Text-Centered"><div>Код действителен еще {{popup.counter}}</div></div></div></div>'),$templateCache.put("js/shared/tmpl/lang.html",'<div class=PGU-Lang ng-if=langs.length full-path={{::fullPath}}><p>На каком языке вы хотите заполнить форму?</p><div class="PGU-Lang-select flag lang-{{selectedLang.key}}" data-ng-class="{\'open\' : isOpen}" data-ng-click=collapsed()>{{selectedLang.value}}<ul data-ng-show=isOpen><li class="flag lang-{{lang.key}}" data-ng-class="{\'selected\' : lang.key === selectedLang.key}" data-ng-repeat="lang in langs" data-ng-click="selected(lang); isOpen = false;">{{lang.value}}</li></ul></div></div>'),$templateCache.put("js/shared/tmpl/modal-dialog-esia.html","<div class=b-ESIAPopup__wrap><div ng-if=\"typeOfEsiaModal.type == 'addressPLV'\" class=modal-address><div class=b-ESIAPopup><div class=PGU-Service-h3>Хотите ли вы изменить данные о месте проживания в Личном кабинете?</div><div class=wrap-popup-scroll when-scrolled-all-time-esia=scrollPopupEsia()><div class=\"h4 bold\">Адрес места проживания</div><div class=x-add-padding><div data-ng-if=address.PLV.strategyAddress class=b-line_esia-address><div class=x-title>Текущий вариант:</div><div class=\"x-value plain-text\">{{address.PLV.strategyAddress}}</div></div><div class=b-line_esia-address><div class=x-title>Новый вариант:</div><div class=\"x-value plain-text\">{{address.PLV.newAddress}}</div></div></div></div><div class=x-clear></div></div></div><div ng-if=\"typeOfEsiaModal.type == 'addressPRG'\" class=modal-address><div class=b-ESIAPopup><div class=PGU-Service-h3>Хотите ли вы изменить данные о месте регистрации в Личном кабинете?</div><div class=wrap-popup-scroll when-scrolled-all-time=scrollPopupEsia()><div class=\"h4 bold\">Адрес места регистрации</div><div class=x-add-padding><div data-ng-if=address.PRG.strategyAddress class=b-line_esia-address><div class=x-title>Текущий вариант:</div><div class=\"x-value plain-text\">{{address.PRG.strategyAddress}}</div></div><div class=b-line_esia-address><div class=x-title>Новый вариант:</div><div class=\"x-value plain-text\">{{address.PRG.newAddress}}</div></div></div></div><div class=x-clear></div></div></div><div ng-if=\"typeOfEsiaModal.type == 'kidData'\" class=modal-address><div class=b-ESIAPopup><div class=PGU-Service-h3>Хотите ли вы сохранить данные ребенка в профиле?</div><div class=wrap-popup-scroll when-scrolled-all-time=scrollPopupEsia()><div data-ng-class=\"{'row': true, 'PGU-Fluid-Row':  isTablet}\"><modal-dialog-esia-input title=\"'Фамилия'\" value=kidData.lastname disabledinp=kidData.lastnameDisabled error=kidData.lastnameErr mobilewidth=100 columns=5 ipadcolumns=4></modal-dialog-esia-input><modal-dialog-esia-input title=\"'Имя'\" value=kidData.firstname disabledinp=kidData.firstnameDisabled error=kidData.firstnameErr columns=4 ipadcolumns=3 mobilewidth=100></modal-dialog-esia-input><modal-dialog-esia-input title=\"'Отчество'\" value=kidData.middlename disabledinp=kidData.middlenameDisabled error=kidData.middlenameErr columns=4 ipadcolumns=3 mobilewidth=100></modal-dialog-esia-input></div><div data-ng-class=\"{'row': true, 'PGU-Fluid-Row':  isTablet}\"><modal-dialog-esia-input title=\"'Дата рождения'\" value=kidData.birthday disabledinp=kidData.birthdayDisabled error=kidData.birthdayErr maskstr=\"'00.00.0000'\" columns=6 ipadcolumns=6 mobilewidth=100></modal-dialog-esia-input><div data-error={{kidData.genderErr}} class=\"radio-esia-popup span_7 PGU-Col-6\"><div><div class=fake-button><label><input name=gender ng-model=kidData.gender data-ng-value=\"'M'\" class=real-button type=radio><div class=\"radio-action item-radio\"></div><div class=\"gender-icon man item-radio\"></div><div class=\"gender-title item-radio\">Мужской</div></label><label><input name=gender ng-model=kidData.gender data-ng-value=\"'F'\" class=real-button type=radio><div class=\"radio-action item-radio\"></div><div class=\"gender-icon women item-radio\"></div><div class=\"gender-title item-radio\">Женский</div></label><div class=err-radio-button data-ng-if=kidData.genderErr>{{kidData.genderErr}}</div></div></div></div></div><div data-ng-class=\"{'row': true, 'PGU-Fluid-Row':  isTablet}\"><modal-dialog-esia-input title=\"'СНИЛС'\" value=kidData.snils disabledinp=kidData.snilsDisabled error=kidData.snilsErr maskstr=\"'000-000-000 00'\" columns=6 ipadcolumns=5 mobilewidth=100></modal-dialog-esia-input><modal-dialog-esia-input title=\"'ИНН'\" value=kidData.inn disabledinp=kidData.innDisabled error=kidData.innErr maskstr=\"'000000000000'\" columns=6 ipadcolumns=5 mobilewidth=100></modal-dialog-esia-input></div><div data-ng-class=\"{'row': true, 'PGU-Fluid-Row':  isTablet}\"><h4 class=\"span_13 h4 bold PGU-Col-12\">Свидетельство о рождении</h4></div><div data-ng-class=\"{'row': true, 'PGU-Fluid-Row':  isTablet}\"><modal-dialog-esia-input title=\"'Серия'\" value=kidData.sr_serial disabledinp=kidData.sr_serialDisabled error=kidData.sr_serialErr columns=3 ipadcolumns=3 mobilewidth=100></modal-dialog-esia-input><modal-dialog-esia-input title=\"'Номер'\" value=kidData.sr_number disabledinp=kidData.sr_numberDisabled error=kidData.sr_numberErr columns=4 ipadcolumns=3 mobilewidth=100></modal-dialog-esia-input><modal-dialog-esia-input title=\"'Дата выдачи'\" value=kidData.sr_iss_date disabledinp=kidData.sr_iss_dateDisabled error=kidData.sr_iss_dateErr maskstr=\"'00.00.0000'\" columns=6 ipadcolumns=5 mobilewidth=100></modal-dialog-esia-input><modal-dialog-esia-input title=\"'Номер актовой записи'\" value=kidData.sr_act_number disabledinp=kidData.sr_act_numberDisabled error=kidData.sr_act_numberErr columns=6 ipadcolumns=5 mobilewidth=100></modal-dialog-esia-input></div><div data-ng-class=\"{'row': true, 'PGU-Fluid-Row':  isTablet}\"><modal-dialog-esia-input title=\"'Место государственной регистрации'\" value=kidData.sr_issued disabledinp=kidData.sr_issuedDisabled error=kidData.sr_issuedErr columns=13 ipadcolumns=11 mobilewidth=100></modal-dialog-esia-input></div><div data-ng-class=\"{'row': true, 'PGU-Fluid-Row':  isTablet}\"><h4 class=\"span_13 h4 bold PGU-Col-12\">Полис обязательного медицинского страхования (ОМС)</h4></div><div data-ng-class=\"{'row': true, 'last-row':true,  'PGU-Fluid-Row':  isTablet}\"><modal-dialog-esia-input title=\"'Номер'\" value=kidData.polis_oms_number disabledinp=kidData.polis_oms_numberDisabled error=kidData.polis_oms_numberErr columns=4 ipadcolumns=4 mobilewidth=100 maxlengthstring=50></modal-dialog-esia-input><modal-dialog-esia-input title=\"'Действителен до (если не бессрочный)'\" value=kidData.polis_oms_exp_date disabledinp=kidData.polis_oms_exp_dateDisabled error=kidData.polis_oms_exp_dateErr maskstr=\"'00.00.0000'\" columns=6 ipadcolumns=6 mobilewidth=100></modal-dialog-esia-input></div></div><div class=x-clear></div></div></div><div ng-if=\"typeOfEsiaModal.type == 'foreignpassport'\" class=modal-address><div class=\"b-ESIAPopup b-ESIAPopup-full\"><div class=PGU-Service-h3>Хотите ли вы сохранить данные заграничного паспорта в профиле?</div><div class=wrap-popup-scroll when-scrolled-all-time=scrollPopupEsia()><div data-ng-class=\"{'row': true, 'PGU-Fluid-Row':  isTablet}\"><modal-dialog-esia-input title=\"'Фамилия'\" value=foreignpassport.lastName disabledinp=foreignpassport.lastNameDisabled error=foreignpassport.lastNameErr columns=7 ipadcolumns=6 mobilewidth=100></modal-dialog-esia-input><modal-dialog-esia-input title=\"'Имя'\" value=foreignpassport.firstName disabledinp=foreignpassport.firstNameDisabled error=foreignpassport.firstNameErr columns=6 ipadcolumns=5 mobilewidth=100></modal-dialog-esia-input></div><div data-ng-class=\"{'row': true, 'PGU-Fluid-Row':  isTablet}\"><modal-dialog-esia-input title=\"'Серия'\" value=foreignpassport.series disabledinp=foreignpassport.seriesDisabled error=foreignpassport.seriesErr columns=3 ipadcolumns=3 mobilewidth=100></modal-dialog-esia-input><modal-dialog-esia-input title=\"'Номер'\" value=foreignpassport.number disabledinp=foreignpassport.numberDisabled error=foreignpassport.numberErr columns=4 ipadcolumns=4 mobilewidth=100></modal-dialog-esia-input></div><div data-ng-class=\"{'row': true, 'PGU-Fluid-Row':  isTablet}\"><modal-dialog-esia-input title=\"'Дата выдачи'\" value=foreignpassport.issueDate disabledinp=foreignpassport.issueDateDisabled error=foreignpassport.issueDateErr columns=6 ipadcolumns=5 mobilewidth=100 maskstr=\"'00.00.0000'\"></modal-dialog-esia-input><modal-dialog-esia-input title=\"'Действителен до'\" value=foreignpassport.expiryDate disabledinp=foreignpassport.expiryDateDisabled error=foreignpassport.expiryDateErr columns=6 ipadcolumns=5 mobilewidth=100 maskstr=\"'00.00.0000'\"></modal-dialog-esia-input></div><div data-ng-class=\"{'row': true, 'last-row':true,  'PGU-Fluid-Row':  isTablet}\"><modal-dialog-esia-input title=\"'Орган, выдавший документ'\" value=foreignpassport.issuedBy disabledinp=foreignpassport.issuedByDisabled error=foreignpassport.issuedByErr columns=13 ipadcolumns=11 mobilewidth=100></modal-dialog-esia-input></div></div><div class=x-clear></div></div></div><div ng-if=\"typeOfEsiaModal.type == 'birthcert'\" class=modal-address><div class=\"b-ESIAPopup b-ESIAPopup-full\"><div class=\"PGU-Service-h3 bold\">Хотите ли вы сохранить данные свидетельства о рождении в профиле?</div><div class=wrap-popup-scroll when-scrolled-all-time=scrollPopupEsia()><div data-ng-class=\"{'row': true, 'PGU-Fluid-Row':  isTablet}\"><modal-dialog-esia-input title=\"'Серия'\" value=birthcert.series disabledinp=birthcert.seriesDisabled error=birthcert.seriesErr columns=4 ipadcolumns=3 mobilewidth=100></modal-dialog-esia-input><modal-dialog-esia-input title=\"'Номер'\" value=birthcert.number disabledinp=birthcert.numberDisabled error=birthcert.numberErr columns=3 ipadcolumns=3 mobilewidth=100></modal-dialog-esia-input></div><div data-ng-class=\"{'row': true, 'PGU-Fluid-Row':  isTablet}\"><modal-dialog-esia-input title=\"'Дата выдачи'\" value=birthcert.issueDate disabledinp=birthcert.issueDateDisabled error=birthcert.issueDateErr columns=6 ipadcolumns=5 mobilewidth=100 maskstr=\"'00.00.0000'\"></modal-dialog-esia-input></div><div data-ng-class=\"{'row': true, 'last-row':true,  'PGU-Fluid-Row':  isTablet}\"><modal-dialog-esia-input title=\"'Место государственной регистрации'\" value=birthcert.issuedBy disabledinp=birthcert.issuedByDisabled error=birthcert.issuedByErr columns=13 ipadcolumns=11 mobilewidth=100></modal-dialog-esia-input></div></div><div class=x-clear></div></div></div><div ng-if=\"typeOfEsiaModal.type == 'militarydoc'\" class=modal-address><div class=b-ESIAPopup><div class=PGU-Service-h3>Хотите ли вы сохранить данные Военного билета в профиле?</div><div class=wrap-popup-scroll when-scrolled-all-time=scrollPopupEsia()><div data-ng-class=\"{'row': true, 'PGU-Fluid-Row':  isTablet}\"><modal-dialog-esia-input title=\"'Серия'\" value=militarydoc.series disabledinp=militarydoc.seriesDisabled error=militarydoc.seriesErr columns=3 ipadcolumns=3 mobilewidth=100></modal-dialog-esia-input><modal-dialog-esia-input title=\"'Номер'\" value=militarydoc.number disabledinp=militarydoc.numberDisabled error=militarydoc.numberErr columns=4 ipadcolumns=4 mobilewidth=100></modal-dialog-esia-input></div><div data-ng-class=\"{'row': true, 'PGU-Fluid-Row':  isTablet}\"><modal-dialog-esia-input title=\"'Выдан военным комиссариатом'\" value=militarydoc.issueDate disabledinp=militarydoc.issueDateDisabled error=militarydoc.issueDateErr columns=6 ipadcolumns=6 mobilewidth=100 maskstr=\"'00.00.0000'\"></modal-dialog-esia-input></div><div data-ng-class=\"{'row': true, 'last-row':true,  'PGU-Fluid-Row':  isTablet}\"><modal-dialog-esia-input title=\"'Выдан военным комиссариатом'\" value=militarydoc.issuedBy disabledinp=militarydoc.issuedByDisabled error=militarydoc.issuedByErr columns=13 ipadcolumns=11 mobilewidth=100></modal-dialog-esia-input></div></div><div class=x-clear></div></div></div><div ng-if=\"typeOfEsiaModal.type == 'medicalpolicy'\" class=modal-address><div class=\"b-ESIAPopup b-ESIAPopup-full\"><div class=PGU-Service-h3>Хотите ли вы сохранить данные ОМС в профиле?</div><div class=wrap-popup-scroll when-scrolled-all-time=scrollPopupEsia()><div data-ng-class=\"{'row': true, 'last-row':true,  'PGU-Fluid-Row':  isTablet}\"><modal-dialog-esia-input title=\"'Номер'\" value=medicalpolicy.number disabledinp=medicalpolicy.numberDisabled error=medicalpolicy.numberErr columns=7 ipadcolumns=6 mobilewidth=100 maxlengthstring=50></modal-dialog-esia-input><modal-dialog-esia-input title=\"'Дата окончания'\" value=medicalpolicy.expiryDate disabledinp=medicalpolicy.expiryDateDisabled error=medicalpolicy.expiryDateErr maskstr=\"'00.00.0000'\" columns=6 ipadcolumns=5 mobilewidth=100 hint=\"'при наличии'\"></modal-dialog-esia-input></div></div><div class=x-clear></div></div></div><div ng-if=\"typeOfEsiaModal.type == 'driverLicense'\" class=modal-address><div class=b-ESIAPopup><div class=PGU-Service-h3>Хотите ли вы сохранить данные водительского удостоверения в профиле?</div><div class=wrap-popup-scroll when-scrolled-all-time=scrollPopupEsia()><div data-ng-class=\"{'row': true, 'PGU-Fluid-Row':  isTablet}\"><modal-dialog-esia-input title=\"'Серия'\" value=driverLicense.series disabledinp=driverLicense.seriesDisabled error=driverLicense.seriesErr columns=3 ipadcolumns=4 mobilewidth=100 space=\"'small-space'\"></modal-dialog-esia-input><modal-dialog-esia-input title=\"'Номер'\" value=driverLicense.number disabledinp=driverLicense.numberDisabled error=driverLicense.numberErr columns=4 ipadcolumns=4 mobilewidth=100 space=\"'small-space'\"></modal-dialog-esia-input></div><div data-ng-class=\"{'row': true, 'last-row':true,  'PGU-Fluid-Row':  isTablet}\"><modal-dialog-esia-input title=\"'Дата выдачи'\" value=driverLicense.issueDate disabledinp=driverLicense.issueDateDisabled error=driverLicense.issueDateErr maskstr=\"'00.00.0000'\" columns=6 ipadcolumns=5 mobilewidth=100 space=\"'small-space'\"></modal-dialog-esia-input><modal-dialog-esia-input title=\"'Действительно до'\" value=driverLicense.expiryDate disabledinp=driverLicense.expiryDateDisabled error=driverLicense.expiryDateErr maskstr=\"'00.00.0000'\" columns=6 ipadcolumns=5 mobilewidth=100 space=\"'small-space'\"></modal-dialog-esia-input></div></div><div class=x-clear></div></div></div><div ng-if=\"typeOfEsiaModal.type == 'car'\" class=modal-address><div class=b-ESIAPopup><div class=PGU-Service-h3>Данные о транспортном средстве будут сохранены в Личном кабинете</div><div class=wrap-popup-scroll when-scrolled-all-time=scrollPopupEsia()><div data-ng-class=\"{'row': true, 'PGU-Fluid-Row':  isTablet}\"><modal-dialog-esia-input title=\"'Наименование'\" value=car.name disabledinp=car.nameDisabled error=car.nameErr columns=10 ipadcolumns=10 mobilewidth=100></modal-dialog-esia-input></div><div data-ng-class=\"{'row': true, 'PGU-Fluid-Row':  isTablet}\"><modal-dialog-esia-input title=\"'Номерной знак'\" value=car.numberPlate disabledinp=car.numberPlateDisabled error=car.numberPlateErr columns=6 ipadcolumns=6 mobilewidth=100></modal-dialog-esia-input></div><div data-ng-class=\"{'row': true, 'last-row':true,  'PGU-Fluid-Row':  isTablet}\"><modal-dialog-esia-input title=\"'Серия свидетельства о регистрации'\" value=car.regCertificate_series disabledinp=car.regCertificate_seriesDisabled error=car.regCertificate_seriesErr columns=6 ipadcolumns=5 mobilewidth=100></modal-dialog-esia-input><modal-dialog-esia-input title=\"'Номер свидетельства о регистрации'\" value=car.regCertificate_number disabledinp=car.regCertificate_numberDisabled error=car.regCertificate_numberErr columns=6 ipadcolumns=5 mobilewidth=100></modal-dialog-esia-input></div></div><div class=x-clear></div></div></div><div class=b-ESIAPopup__border></div><div class=\"x-wrapper__button cf\"><div class=\"PGU-BtnHolder PGU-Button-align-right PGU-BtnFloat\"><div class=PGU-Button-align-right><a class=\"PGU-Button PGU-Btn-Base PGU-Btn-Blue\" data-ng-click=\"setData(typeOfEsiaModal, needShowModal.shift())\"><span class=PGU-Btn-Text>Изменить</span></a></div></div><div class=\"PGU-BtnHolder PGU-BtnFloat\"><div class=PGU-Button-align-right><a class=\"PGU-Button PGU-Btn-Base\" data-ng-click=noChangeEsiaData(needShowModal.shift())><span class=PGU-Btn-Text>Не изменять</span></a></div></div></div></div>"),$templateCache.put("js/shared/tmpl/modal-dialog.html",'<div class=PGU-Popup_fade ng-show=show ng-style="{\'display\' : show ? \'block\' : \'none\'}"><div class=PGU-Popup id=PGU-Popup><b class=close_popup_x ng-click=hideModal($event) ng-if="!backBtnName && !hideClosePopupBtn && !optimizationForMobile"></b> <b class="close_popup_x close_popup_x-with-title" ng-click=hideModal($event) ng-if="device && backBtnName && !hideClosePopupBtn && !optimizationForMobile" ng-bind-html=backBtnName></b><div ng-transclude class=PGU-Popup-Content-Wrap></div></div></div>'),$templateCache.put("js/shared/tmpl/region-selected.html","<div class=\"b-region-selected {{load ? 'load' : ''}} {{position}}\"><div class=\"b-region-selected__wrap {{list.length ? 'open' : ''}}\"><input class=b-region-selected__input required ng-model=search> <label class=b-region-selected__label>{{label}}</label><ul class=\"b-region-selected__result x-length-list-{{list.length}}\"><li class=b-region-selected__result-item data-ng-click=selectRegion(item) data-ng-repeat=\"item in list\">{{item.name}}</li></ul></div></div>"),$templateCache.put("js/shared/tmpl/simple-button.html","<span data-ng-if=attrVisible ng-class=\"{'PGU-btn-base' : true,\n      'PGU-continue-draft' : true,\n      'disabled' : attrDisabled}\" data-ng-click=eventClick()>{{attrLabel}}</span>"),$templateCache.put("js/shared/tmpl/svgCircleProgress.html",'<div class=EPGU-progress-bars><div data-ng-if=!isDesktop class=EPGU-progress-bar><span data-ng-attr-style={{inlineCss}} class=EPGU-progress-bar__line></span> <span data-ng-class="{\'EPGU-progress-bar__percents_100\': percents === \'100%\'}" class=EPGU-progress-bar__percents>{{percents}}</span></div><figure data-ng-if=isDesktop class=EPGU-figure-content><div><svg height=200px width=200px viewBox="0 0 200 200"><g data-ng-repeat="circle in initialValues"><circle data-ng-attr-cx={{config.cx}} data-ng-attr-cy={{config.cy}} data-ng-attr-r={{config.radius}} data-ng-attr-stroke={{circle.color}} data-ng-attr-stroke-width={{config.strokeWidth}} data-ng-attr-stroke-dasharray={{config.strokeDashArray}} data-ng-attr-stroke-dashoffset={{circle.offset}} stroke-linecap=round data-ng-attr-transform="rotate({{circle.degrees}}, {{config.cx}}, {{config.cy}})" fill=transparent class=EPGU-circle-part></circle></g><g class=EPGU-chart-text><text x=50% y=50% dy=.3em class=EPGU-chart-number>{{percents}}</text></g></svg></div><figcaption><h4>Прогресс заполнения данного переписного листа</h4></figcaption></figure></div>'),$templateCache.put("js/shared/tmpl/throbber.html","<div data-ng-class=\"{\n    'PGU-throbber-window': showHeading,\n    'PGU-throbber-inElement': inElement,\n    'PGU-throbber-svg': !msieversion,\n    'PGU-throbber-fallback': msieversion,\n    'PGU-throbber-small-with-message': smallWithMessage\n    }\" class=PGU-throbber-main><div data-ng-if=showHeading class=PGU-throbber-text><h3 class=PGU-line-1 data-ng-if=!smallWithMessage>{{title ? title : defaultTitle}}</h3><div class=PGU-line-2>{{msg ? msg : defaultMsg}}</div></div><div data-ng-class=\"{\n        'PGU-throbber': true,\n        '{{throbberType}}': true\n"+'        }"><div data-ng-if=!msieversion><svg version=1.1 xmlns="" xmlns:xlink=http://www.w3.org/1999/xlink x=0px y=0px width=104px height=104px viewBox="0 0 92 100" enable-background="new 0 0 92 100" xml:space=preserve><path fill=#00aadd class=PGU-throbber-path d="M81.765,82.649L56.607,97.19c-6.479,3.744-14.462,3.746-20.942,0.01L10.493,82.682\n                        C4.012,78.944,0.017,72.032,0.014,64.549L0,35.493c-0.003-7.482,3.985-14.398,10.463-18.141L35.621,2.811\n                        c6.478-3.744,14.46-3.748,20.943-0.011l25.171,14.519c6.481,3.738,10.476,10.648,10.479,18.131l0.014,29.059\n                        C92.231,71.989,88.244,78.905,81.765,82.649"></path></svg></div></div></div>')}]);